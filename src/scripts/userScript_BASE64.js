export const userScriptBase64 = `IWZ1bmN0aW9uKG1vZHVsZXMpe3ZhciBpbnN0YWxsZWRNb2R1bGVzPXt9O2Z1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpe2lmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO3ZhciBtb2R1bGU9aW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF09e2k6bW9kdWxlSWQsbDohMSxleHBvcnRzOnt9fTtyZXR1cm4gbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cyxtb2R1bGUsbW9kdWxlLmV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyksbW9kdWxlLmw9ITAsbW9kdWxlLmV4cG9ydHN9X193ZWJwYWNrX3JlcXVpcmVfXy5tPW1vZHVsZXMsX193ZWJwYWNrX3JlcXVpcmVfXy5jPWluc3RhbGxlZE1vZHVsZXMsX193ZWJwYWNrX3JlcXVpcmVfXy5kPWZ1bmN0aW9uKGV4cG9ydHMsbmFtZSxnZXR0ZXIpe19fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLG5hbWUpfHxPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cyxuYW1lLHtlbnVtZXJhYmxlOiEwLGdldDpnZXR0ZXJ9KX0sX193ZWJwYWNrX3JlcXVpcmVfXy5yPWZ1bmN0aW9uKGV4cG9ydHMpeyJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiZTeW1ib2wudG9TdHJpbmdUYWcmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywiX19lc01vZHVsZSIse3ZhbHVlOiEwfSl9LF9fd2VicGFja19yZXF1aXJlX18udD1mdW5jdGlvbih2YWx1ZSxtb2RlKXtpZigxJm1vZGUmJih2YWx1ZT1fX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKSksOCZtb2RlKXJldHVybiB2YWx1ZTtpZig0Jm1vZGUmJiJvYmplY3QiPT10eXBlb2YgdmFsdWUmJnZhbHVlJiZ2YWx1ZS5fX2VzTW9kdWxlKXJldHVybiB2YWx1ZTt2YXIgbnM9T2JqZWN0LmNyZWF0ZShudWxsKTtpZihfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6dmFsdWV9KSwyJm1vZGUmJiJzdHJpbmciIT10eXBlb2YgdmFsdWUpZm9yKHZhciBrZXkgaW4gdmFsdWUpX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLGtleSxmdW5jdGlvbihrZXkpe3JldHVybiB2YWx1ZVtrZXldfS5iaW5kKG51bGwsa2V5KSk7cmV0dXJuIG5zfSxfX3dlYnBhY2tfcmVxdWlyZV9fLm49ZnVuY3Rpb24obW9kdWxlKXt2YXIgZ2V0dGVyPW1vZHVsZSYmbW9kdWxlLl9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gbW9kdWxlLmRlZmF1bHR9OmZ1bmN0aW9uKCl7cmV0dXJuIG1vZHVsZX07cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsImEiLGdldHRlciksZ2V0dGVyfSxfX3dlYnBhY2tfcmVxdWlyZV9fLm89ZnVuY3Rpb24ob2JqZWN0LHByb3BlcnR5KXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCxwcm9wZXJ0eSl9LF9fd2VicGFja19yZXF1aXJlX18ucD0iIixfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucz00Mil9KFtmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiXG5cbmlmICh0cnVlKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9janMvcmVhY3QucHJvZHVjdGlvbi5taW4uanMgKi8gNjcpO1xufSBlbHNlIHt9XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlYWN0L2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgnLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKHByb2Nlc3MpIHsvKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgU2VydmVyU3R5bGVTaGVldCAqL1xuLyogdW51c2VkIGhhcm1vbnkgZXhwb3J0IFN0eWxlU2hlZXRDb25zdW1lciAqL1xuLyogdW51c2VkIGhhcm1vbnkgZXhwb3J0IFN0eWxlU2hlZXRDb250ZXh0ICovXG4vKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgU3R5bGVTaGVldE1hbmFnZXIgKi9cbi8qIHVudXNlZCBoYXJtb255IGV4cG9ydCBUaGVtZUNvbnN1bWVyICovXG4vKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgVGhlbWVDb250ZXh0ICovXG4vKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgVGhlbWVQcm92aWRlciAqL1xuLyogdW51c2VkIGhhcm1vbnkgZXhwb3J0IF9fUFJJVkFURV9fICovXG4vKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgY3JlYXRlR2xvYmFsU3R5bGUgKi9cbi8qIHVudXNlZCBoYXJtb255IGV4cG9ydCBjc3MgKi9cbi8qIHVudXNlZCBoYXJtb255IGV4cG9ydCBpc1N0eWxlZENvbXBvbmVudCAqL1xuLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiYiIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gV2U7IH0pO1xuLyogdW51c2VkIGhhcm1vbnkgZXhwb3J0IHVzZVRoZW1lICovXG4vKiB1bnVzZWQgaGFybW9ueSBleHBvcnQgdmVyc2lvbiAqL1xuLyogdW51c2VkIGhhcm1vbnkgZXhwb3J0IHdpdGhUaGVtZSAqL1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIHJlYWN0X2lzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISByZWFjdC1pcyAqLyA5KTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciByZWFjdF9pc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKHJlYWN0X2lzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18pO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISByZWFjdCAqLyAwKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciByZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18pO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIHNoYWxsb3dlcXVhbF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgc2hhbGxvd2VxdWFsICovIDMxKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBzaGFsbG93ZXF1YWxfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihzaGFsbG93ZXF1YWxfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXyk7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX2Vtb3Rpb25fc3R5bGlzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8zX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAZW1vdGlvbi9zdHlsaXMgKi8gMzIpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIF9lbW90aW9uX3VuaXRsZXNzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV80X18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAZW1vdGlvbi91bml0bGVzcyAqLyAzMyk7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX2Vtb3Rpb25faXNfcHJvcF92YWxpZF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfNV9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQGVtb3Rpb24vaXMtcHJvcC12YWxpZCAqLyAxOSk7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgaG9pc3Rfbm9uX3JlYWN0X3N0YXRpY3NfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzZfXyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGhvaXN0LW5vbi1yZWFjdC1zdGF0aWNzICovIDgpO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIGhvaXN0X25vbl9yZWFjdF9zdGF0aWNzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV82X19fZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oaG9pc3Rfbm9uX3JlYWN0X3N0YXRpY3NfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzZfXyk7XG5mdW5jdGlvbiB2KCl7cmV0dXJuKHY9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49YXJndW1lbnRzW3RdO2Zvcih2YXIgciBpbiBuKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuLHIpJiYoZVtyXT1uW3JdKX1yZXR1cm4gZX0pLmFwcGx5KHRoaXMsYXJndW1lbnRzKX12YXIgZz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj1bZVswXV0scj0wLG89dC5sZW5ndGg7cjxvO3IrPTEpbi5wdXNoKHRbcl0sZVtyKzFdKTtyZXR1cm4gbn0sUz1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbCE9PXQmJiJvYmplY3QiPT10eXBlb2YgdCYmIltvYmplY3QgT2JqZWN0XSI9PT0odC50b1N0cmluZz90LnRvU3RyaW5nKCk6T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpKSYmIU9iamVjdChyZWFjdF9pc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fWyJ0eXBlT2YiXSkodCl9LHc9T2JqZWN0LmZyZWV6ZShbXSksRT1PYmplY3QuZnJlZXplKHt9KTtmdW5jdGlvbiBiKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlfWZ1bmN0aW9uIF8oZSl7cmV0dXJuIGZhbHNlfHxlLmRpc3BsYXlOYW1lfHxlLm5hbWV8fCJDb21wb25lbnQifWZ1bmN0aW9uIE4oZSl7cmV0dXJuIGUmJiJzdHJpbmciPT10eXBlb2YgZS5zdHlsZWRDb21wb25lbnRJZH12YXIgQT0idW5kZWZpbmVkIiE9dHlwZW9mIHByb2Nlc3MmJihwcm9jZXNzLmVudi5SRUFDVF9BUFBfU0NfQVRUUnx8cHJvY2Vzcy5lbnYuU0NfQVRUUil8fCJkYXRhLXN0eWxlZCIsQz0iNS4yLjEiLEk9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJiJIVE1MRWxlbWVudCJpbiB3aW5kb3csUD1Cb29sZWFuKCJib29sZWFuIj09dHlwZW9mIFNDX0RJU0FCTEVfU1BFRURZP1NDX0RJU0FCTEVfU1BFRURZOiJ1bmRlZmluZWQiIT10eXBlb2YgcHJvY2VzcyYmdm9pZCAwIT09cHJvY2Vzcy5lbnYuUkVBQ1RfQVBQX1NDX0RJU0FCTEVfU1BFRURZJiYiIiE9PXByb2Nlc3MuZW52LlJFQUNUX0FQUF9TQ19ESVNBQkxFX1NQRUVEWT8iZmFsc2UiIT09cHJvY2Vzcy5lbnYuUkVBQ1RfQVBQX1NDX0RJU0FCTEVfU1BFRURZJiZwcm9jZXNzLmVudi5SRUFDVF9BUFBfU0NfRElTQUJMRV9TUEVFRFk6InVuZGVmaW5lZCIhPXR5cGVvZiBwcm9jZXNzJiZ2b2lkIDAhPT1wcm9jZXNzLmVudi5TQ19ESVNBQkxFX1NQRUVEWSYmIiIhPT1wcm9jZXNzLmVudi5TQ19ESVNBQkxFX1NQRUVEWT8iZmFsc2UiIT09cHJvY2Vzcy5lbnYuU0NfRElTQUJMRV9TUEVFRFkmJnByb2Nlc3MuZW52LlNDX0RJU0FCTEVfU1BFRURZOiJwcm9kdWN0aW9uIiE9PSJwcm9kdWN0aW9uIiksTz17fSxSPSBmYWxzZT91bmRlZmluZWQ6e307ZnVuY3Rpb24gRCgpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoPD0wP3ZvaWQgMDphcmd1bWVudHNbMF0sdD1bXSxuPTEscj1hcmd1bWVudHMubGVuZ3RoO248cjtuKz0xKXQucHVzaChuPDB8fGFyZ3VtZW50cy5sZW5ndGg8PW4/dm9pZCAwOmFyZ3VtZW50c1tuXSk7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24odCl7ZT1lLnJlcGxhY2UoLyVbYS16XS8sdCl9KSksZX1mdW5jdGlvbiBqKGUpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLG49bmV3IEFycmF5KHQ+MT90LTE6MCkscj0xO3I8dDtyKyspbltyLTFdPWFyZ3VtZW50c1tyXTt0aHJvdyB0cnVlP25ldyBFcnJvcigiQW4gZXJyb3Igb2NjdXJyZWQuIFNlZSBodHRwczovL2dpdC5pby9KVUlhRSMiK2UrIiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4iKyhuLmxlbmd0aD4wPyIgQXJnczogIituLmpvaW4oIiwgIik6IiIpKTp1bmRlZmluZWR9dmFyIFQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3RoaXMuZ3JvdXBTaXplcz1uZXcgVWludDMyQXJyYXkoNTEyKSx0aGlzLmxlbmd0aD01MTIsdGhpcy50YWc9ZX12YXIgdD1lLnByb3RvdHlwZTtyZXR1cm4gdC5pbmRleE9mR3JvdXA9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTAsbj0wO248ZTtuKyspdCs9dGhpcy5ncm91cFNpemVzW25dO3JldHVybiB0fSx0Lmluc2VydFJ1bGVzPWZ1bmN0aW9uKGUsdCl7aWYoZT49dGhpcy5ncm91cFNpemVzLmxlbmd0aCl7Zm9yKHZhciBuPXRoaXMuZ3JvdXBTaXplcyxyPW4ubGVuZ3RoLG89cjtlPj1vOykobzw8PTEpPDAmJmooMTYsIiIrZSk7dGhpcy5ncm91cFNpemVzPW5ldyBVaW50MzJBcnJheShvKSx0aGlzLmdyb3VwU2l6ZXMuc2V0KG4pLHRoaXMubGVuZ3RoPW87Zm9yKHZhciBzPXI7czxvO3MrKyl0aGlzLmdyb3VwU2l6ZXNbc109MH1mb3IodmFyIGk9dGhpcy5pbmRleE9mR3JvdXAoZSsxKSxhPTAsYz10Lmxlbmd0aDthPGM7YSsrKXRoaXMudGFnLmluc2VydFJ1bGUoaSx0W2FdKSYmKHRoaXMuZ3JvdXBTaXplc1tlXSsrLGkrKyl9LHQuY2xlYXJHcm91cD1mdW5jdGlvbihlKXtpZihlPHRoaXMubGVuZ3RoKXt2YXIgdD10aGlzLmdyb3VwU2l6ZXNbZV0sbj10aGlzLmluZGV4T2ZHcm91cChlKSxyPW4rdDt0aGlzLmdyb3VwU2l6ZXNbZV09MDtmb3IodmFyIG89bjtvPHI7bysrKXRoaXMudGFnLmRlbGV0ZVJ1bGUobil9fSx0LmdldEdyb3VwPWZ1bmN0aW9uKGUpe3ZhciB0PSIiO2lmKGU+PXRoaXMubGVuZ3RofHwwPT09dGhpcy5ncm91cFNpemVzW2VdKXJldHVybiB0O2Zvcih2YXIgbj10aGlzLmdyb3VwU2l6ZXNbZV0scj10aGlzLmluZGV4T2ZHcm91cChlKSxvPXIrbixzPXI7czxvO3MrKyl0Kz10aGlzLnRhZy5nZXRSdWxlKHMpKyIvKiFzYyovXFxuIjtyZXR1cm4gdH0sZX0oKSxrPW5ldyBNYXAseD1uZXcgTWFwLFY9MSxCPWZ1bmN0aW9uKGUpe2lmKGsuaGFzKGUpKXJldHVybiBrLmdldChlKTtmb3IoO3guaGFzKFYpOylWKys7dmFyIHQ9VisrO3JldHVybiBmYWxzZSYmZmFsc2Usay5zZXQoZSx0KSx4LnNldCh0LGUpLHR9LE09ZnVuY3Rpb24oZSl7cmV0dXJuIHguZ2V0KGUpfSx6PWZ1bmN0aW9uKGUsdCl7ay5zZXQoZSx0KSx4LnNldCh0LGUpfSxMPSJzdHlsZVsiK0ErXCddW2RhdGEtc3R5bGVkLXZlcnNpb249IjUuMi4xIl1cJyxHPW5ldyBSZWdFeHAoIl4iK0ErXCdcXFxcLmcoXFxcXGQrKVxcXFxbaWQ9IihbXFxcXHdcXFxcZC1dKykiXFxcXF0uKj8iKFteIl0qKVwnKSxGPWZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIHIsbz1uLnNwbGl0KCIsIikscz0wLGk9by5sZW5ndGg7czxpO3MrKykocj1vW3NdKSYmZS5yZWdpc3Rlck5hbWUodCxyKX0sWT1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj10LmlubmVySFRNTC5zcGxpdCgiLyohc2MqL1xcbiIpLHI9W10sbz0wLHM9bi5sZW5ndGg7bzxzO28rKyl7dmFyIGk9bltvXS50cmltKCk7aWYoaSl7dmFyIGE9aS5tYXRjaChHKTtpZihhKXt2YXIgYz0wfHBhcnNlSW50KGFbMV0sMTApLHU9YVsyXTswIT09YyYmKHoodSxjKSxGKGUsdSxhWzNdKSxlLmdldFRhZygpLmluc2VydFJ1bGVzKGMscikpLHIubGVuZ3RoPTB9ZWxzZSByLnB1c2goaSl9fX0scT1mdW5jdGlvbigpe3JldHVybiB0cnVlP19fd2VicGFja19yZXF1aXJlX18ubmM6dW5kZWZpbmVkfSxIPWZ1bmN0aW9uKGUpe3ZhciB0PWRvY3VtZW50LmhlYWQsbj1lfHx0LHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKSxvPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmNoaWxkTm9kZXMsbj10Lmxlbmd0aDtuPj0wO24tLSl7dmFyIHI9dFtuXTtpZihyJiYxPT09ci5ub2RlVHlwZSYmci5oYXNBdHRyaWJ1dGUoQSkpcmV0dXJuIHJ9fShuKSxzPXZvaWQgMCE9PW8/by5uZXh0U2libGluZzpudWxsO3Iuc2V0QXR0cmlidXRlKEEsImFjdGl2ZSIpLHIuc2V0QXR0cmlidXRlKCJkYXRhLXN0eWxlZC12ZXJzaW9uIiwiNS4yLjEiKTt2YXIgaT1xKCk7cmV0dXJuIGkmJnIuc2V0QXR0cmlidXRlKCJub25jZSIsaSksbi5pbnNlcnRCZWZvcmUocixzKSxyfSwkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXt2YXIgdD10aGlzLmVsZW1lbnQ9SChlKTt0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKSksdGhpcy5zaGVldD1mdW5jdGlvbihlKXtpZihlLnNoZWV0KXJldHVybiBlLnNoZWV0O2Zvcih2YXIgdD1kb2N1bWVudC5zdHlsZVNoZWV0cyxuPTAscj10Lmxlbmd0aDtuPHI7bisrKXt2YXIgbz10W25dO2lmKG8ub3duZXJOb2RlPT09ZSlyZXR1cm4gb31qKDE3KX0odCksdGhpcy5sZW5ndGg9MH12YXIgdD1lLnByb3RvdHlwZTtyZXR1cm4gdC5pbnNlcnRSdWxlPWZ1bmN0aW9uKGUsdCl7dHJ5e3JldHVybiB0aGlzLnNoZWV0Lmluc2VydFJ1bGUodCxlKSx0aGlzLmxlbmd0aCsrLCEwfWNhdGNoKGUpe3JldHVybiExfX0sdC5kZWxldGVSdWxlPWZ1bmN0aW9uKGUpe3RoaXMuc2hlZXQuZGVsZXRlUnVsZShlKSx0aGlzLmxlbmd0aC0tfSx0LmdldFJ1bGU9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zaGVldC5jc3NSdWxlc1tlXTtyZXR1cm4gdm9pZCAwIT09dCYmInN0cmluZyI9PXR5cGVvZiB0LmNzc1RleHQ/dC5jc3NUZXh0OiIifSxlfSgpLFc9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3ZhciB0PXRoaXMuZWxlbWVudD1IKGUpO3RoaXMubm9kZXM9dC5jaGlsZE5vZGVzLHRoaXMubGVuZ3RoPTB9dmFyIHQ9ZS5wcm90b3R5cGU7cmV0dXJuIHQuaW5zZXJ0UnVsZT1mdW5jdGlvbihlLHQpe2lmKGU8PXRoaXMubGVuZ3RoJiZlPj0wKXt2YXIgbj1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0KSxyPXRoaXMubm9kZXNbZV07cmV0dXJuIHRoaXMuZWxlbWVudC5pbnNlcnRCZWZvcmUobixyfHxudWxsKSx0aGlzLmxlbmd0aCsrLCEwfXJldHVybiExfSx0LmRlbGV0ZVJ1bGU9ZnVuY3Rpb24oZSl7dGhpcy5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMubm9kZXNbZV0pLHRoaXMubGVuZ3RoLS19LHQuZ2V0UnVsZT1mdW5jdGlvbihlKXtyZXR1cm4gZTx0aGlzLmxlbmd0aD90aGlzLm5vZGVzW2VdLnRleHRDb250ZW50OiIifSxlfSgpLFU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3RoaXMucnVsZXM9W10sdGhpcy5sZW5ndGg9MH12YXIgdD1lLnByb3RvdHlwZTtyZXR1cm4gdC5pbnNlcnRSdWxlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU8PXRoaXMubGVuZ3RoJiYodGhpcy5ydWxlcy5zcGxpY2UoZSwwLHQpLHRoaXMubGVuZ3RoKyssITApfSx0LmRlbGV0ZVJ1bGU9ZnVuY3Rpb24oZSl7dGhpcy5ydWxlcy5zcGxpY2UoZSwxKSx0aGlzLmxlbmd0aC0tfSx0LmdldFJ1bGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGU8dGhpcy5sZW5ndGg/dGhpcy5ydWxlc1tlXToiIn0sZX0oKSxKPUksWD17aXNTZXJ2ZXI6IUksdXNlQ1NTT01JbmplY3Rpb246IVB9LFo9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCxuKXt2b2lkIDA9PT1lJiYoZT1FKSx2b2lkIDA9PT10JiYodD17fSksdGhpcy5vcHRpb25zPXYoe30sWCx7fSxlKSx0aGlzLmdzPXQsdGhpcy5uYW1lcz1uZXcgTWFwKG4pLCF0aGlzLm9wdGlvbnMuaXNTZXJ2ZXImJkkmJkomJihKPSExLGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKEwpLG49MCxyPXQubGVuZ3RoO248cjtuKyspe3ZhciBvPXRbbl07byYmImFjdGl2ZSIhPT1vLmdldEF0dHJpYnV0ZShBKSYmKFkoZSxvKSxvLnBhcmVudE5vZGUmJm8ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKSl9fSh0aGlzKSl9ZS5yZWdpc3RlcklkPWZ1bmN0aW9uKGUpe3JldHVybiBCKGUpfTt2YXIgdD1lLnByb3RvdHlwZTtyZXR1cm4gdC5yZWNvbnN0cnVjdFdpdGhPcHRpb25zPWZ1bmN0aW9uKHQsbil7cmV0dXJuIHZvaWQgMD09PW4mJihuPSEwKSxuZXcgZSh2KHt9LHRoaXMub3B0aW9ucyx7fSx0KSx0aGlzLmdzLG4mJnRoaXMubmFtZXN8fHZvaWQgMCl9LHQuYWxsb2NhdGVHU0luc3RhbmNlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmdzW2VdPSh0aGlzLmdzW2VdfHwwKSsxfSx0LmdldFRhZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnRhZ3x8KHRoaXMudGFnPShuPSh0PXRoaXMub3B0aW9ucykuaXNTZXJ2ZXIscj10LnVzZUNTU09NSW5qZWN0aW9uLG89dC50YXJnZXQsZT1uP25ldyBVKG8pOnI/bmV3ICQobyk6bmV3IFcobyksbmV3IFQoZSkpKTt2YXIgZSx0LG4scixvfSx0Lmhhc05hbWVGb3JJZD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLm5hbWVzLmhhcyhlKSYmdGhpcy5uYW1lcy5nZXQoZSkuaGFzKHQpfSx0LnJlZ2lzdGVyTmFtZT1mdW5jdGlvbihlLHQpe2lmKEIoZSksdGhpcy5uYW1lcy5oYXMoZSkpdGhpcy5uYW1lcy5nZXQoZSkuYWRkKHQpO2Vsc2V7dmFyIG49bmV3IFNldDtuLmFkZCh0KSx0aGlzLm5hbWVzLnNldChlLG4pfX0sdC5pbnNlcnRSdWxlcz1mdW5jdGlvbihlLHQsbil7dGhpcy5yZWdpc3Rlck5hbWUoZSx0KSx0aGlzLmdldFRhZygpLmluc2VydFJ1bGVzKEIoZSksbil9LHQuY2xlYXJOYW1lcz1mdW5jdGlvbihlKXt0aGlzLm5hbWVzLmhhcyhlKSYmdGhpcy5uYW1lcy5nZXQoZSkuY2xlYXIoKX0sdC5jbGVhclJ1bGVzPWZ1bmN0aW9uKGUpe3RoaXMuZ2V0VGFnKCkuY2xlYXJHcm91cChCKGUpKSx0aGlzLmNsZWFyTmFtZXMoZSl9LHQuY2xlYXJUYWc9ZnVuY3Rpb24oKXt0aGlzLnRhZz12b2lkIDB9LHQudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUuZ2V0VGFnKCksbj10Lmxlbmd0aCxyPSIiLG89MDtvPG47bysrKXt2YXIgcz1NKG8pO2lmKHZvaWQgMCE9PXMpe3ZhciBpPWUubmFtZXMuZ2V0KHMpLGE9dC5nZXRHcm91cChvKTtpZih2b2lkIDAhPT1pJiYwIT09YS5sZW5ndGgpe3ZhciBjPUErIi5nIitvK1wnW2lkPSJcJytzK1wnIl1cJyx1PSIiO3ZvaWQgMCE9PWkmJmkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS5sZW5ndGg+MCYmKHUrPWUrIiwiKX0pKSxyKz0iIithK2MrXCd7Y29udGVudDoiXCcrdStcJyJ9Lyohc2MqL1xcblwnfX19cmV0dXJuIHJ9KHRoaXMpfSxlfSgpLEs9LyhhKShkKS9naSxRPWZ1bmN0aW9uKGUpe3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGUrKGU+MjU/Mzk6OTcpKX07ZnVuY3Rpb24gZWUoZSl7dmFyIHQsbj0iIjtmb3IodD1NYXRoLmFicyhlKTt0PjUyO3Q9dC81MnwwKW49USh0JTUyKStuO3JldHVybihRKHQlNTIpK24pLnJlcGxhY2UoSywiJDEtJDIiKX12YXIgdGU9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49dC5sZW5ndGg7bjspZT0zMyplXnQuY2hhckNvZGVBdCgtLW4pO3JldHVybiBlfSxuZT1mdW5jdGlvbihlKXtyZXR1cm4gdGUoNTM4MSxlKX07ZnVuY3Rpb24gcmUoZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aDt0Kz0xKXt2YXIgbj1lW3RdO2lmKGIobikmJiFOKG4pKXJldHVybiExfXJldHVybiEwfXZhciBvZT1uZSgiNS4yLjEiKSxzZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0LG4pe3RoaXMucnVsZXM9ZSx0aGlzLnN0YXRpY1J1bGVzSWQ9IiIsdGhpcy5pc1N0YXRpYz0gdHJ1ZSYmKHZvaWQgMD09PW58fG4uaXNTdGF0aWMpJiZyZShlKSx0aGlzLmNvbXBvbmVudElkPXQsdGhpcy5iYXNlSGFzaD10ZShvZSx0KSx0aGlzLmJhc2VTdHlsZT1uLFoucmVnaXN0ZXJJZCh0KX1yZXR1cm4gZS5wcm90b3R5cGUuZ2VuZXJhdGVBbmRJbmplY3RTdHlsZXM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPXRoaXMuY29tcG9uZW50SWQsbz1bXTtpZih0aGlzLmJhc2VTdHlsZSYmby5wdXNoKHRoaXMuYmFzZVN0eWxlLmdlbmVyYXRlQW5kSW5qZWN0U3R5bGVzKGUsdCxuKSksdGhpcy5pc1N0YXRpYyYmIW4uaGFzaClpZih0aGlzLnN0YXRpY1J1bGVzSWQmJnQuaGFzTmFtZUZvcklkKHIsdGhpcy5zdGF0aWNSdWxlc0lkKSlvLnB1c2godGhpcy5zdGF0aWNSdWxlc0lkKTtlbHNle3ZhciBzPU5lKHRoaXMucnVsZXMsZSx0LG4pLmpvaW4oIiIpLGk9ZWUodGUodGhpcy5iYXNlSGFzaCxzLmxlbmd0aCk+Pj4wKTtpZighdC5oYXNOYW1lRm9ySWQocixpKSl7dmFyIGE9bihzLCIuIitpLHZvaWQgMCxyKTt0Lmluc2VydFJ1bGVzKHIsaSxhKX1vLnB1c2goaSksdGhpcy5zdGF0aWNSdWxlc0lkPWl9ZWxzZXtmb3IodmFyIGM9dGhpcy5ydWxlcy5sZW5ndGgsdT10ZSh0aGlzLmJhc2VIYXNoLG4uaGFzaCksbD0iIixkPTA7ZDxjO2QrKyl7dmFyIGg9dGhpcy5ydWxlc1tkXTtpZigic3RyaW5nIj09dHlwZW9mIGgpbCs9aCwgZmFsc2UmJihmYWxzZSk7ZWxzZSBpZihoKXt2YXIgcD1OZShoLGUsdCxuKSxmPUFycmF5LmlzQXJyYXkocCk/cC5qb2luKCIiKTpwO3U9dGUodSxmK2QpLGwrPWZ9fWlmKGwpe3ZhciBtPWVlKHU+Pj4wKTtpZighdC5oYXNOYW1lRm9ySWQocixtKSl7dmFyIHk9bihsLCIuIittLHZvaWQgMCxyKTt0Lmluc2VydFJ1bGVzKHIsbSx5KX1vLnB1c2gobSl9fXJldHVybiBvLmpvaW4oIiAiKX0sZX0oKSxpZT0vXlxccypcXC9cXC8uKiQvZ20sYWU9WyI6IiwiWyIsIi4iLCIjIl07ZnVuY3Rpb24gY2UoZSl7dmFyIHQsbixyLG8scz12b2lkIDA9PT1lP0U6ZSxpPXMub3B0aW9ucyxhPXZvaWQgMD09PWk/RTppLGM9cy5wbHVnaW5zLHU9dm9pZCAwPT09Yz93OmMsbD1uZXcgX2Vtb3Rpb25fc3R5bGlzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8zX19bLyogZGVmYXVsdCAqLyAiYSJdKGEpLGQ9W10saD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KHQpe2lmKHQpdHJ5e2UodCsifSIpfWNhdGNoKGUpe319cmV0dXJuIGZ1bmN0aW9uKG4scixvLHMsaSxhLGMsdSxsLGQpe3N3aXRjaChuKXtjYXNlIDE6aWYoMD09PWwmJjY0PT09ci5jaGFyQ29kZUF0KDApKXJldHVybiBlKHIrIjsiKSwiIjticmVhaztjYXNlIDI6aWYoMD09PXUpcmV0dXJuIHIrIi8qfCovIjticmVhaztjYXNlIDM6c3dpdGNoKHUpe2Nhc2UgMTAyOmNhc2UgMTEyOnJldHVybiBlKG9bMF0rciksIiI7ZGVmYXVsdDpyZXR1cm4gcisoMD09PWQ/Ii8qfCovIjoiIil9Y2FzZS0yOnIuc3BsaXQoIi8qfCovfSIpLmZvckVhY2godCl9fX0oKGZ1bmN0aW9uKGUpe2QucHVzaChlKX0pKSxmPWZ1bmN0aW9uKGUscixzKXtyZXR1cm4gMD09PXImJmFlLmluY2x1ZGVzKHNbbi5sZW5ndGhdKXx8cy5tYXRjaChvKT9lOiIuIit0fTtmdW5jdGlvbiBtKGUscyxpLGEpe3ZvaWQgMD09PWEmJihhPSImIik7dmFyIGM9ZS5yZXBsYWNlKGllLCIiKSx1PXMmJmk/aSsiICIrcysiIHsgIitjKyIgfSI6YztyZXR1cm4gdD1hLG49cyxyPW5ldyBSZWdFeHAoIlxcXFwiK24rIlxcXFxiIiwiZyIpLG89bmV3IFJlZ0V4cCgiKFxcXFwiK24rIlxcXFxiKXsyLH0iKSxsKGl8fCFzPyIiOnMsdSl9cmV0dXJuIGwudXNlKFtdLmNvbmNhdCh1LFtmdW5jdGlvbihlLHQsbyl7Mj09PWUmJm8ubGVuZ3RoJiZvWzBdLmxhc3RJbmRleE9mKG4pPjAmJihvWzBdPW9bMF0ucmVwbGFjZShyLGYpKX0saCxmdW5jdGlvbihlKXtpZigtMj09PWUpe3ZhciB0PWQ7cmV0dXJuIGQ9W10sdH19XSkpLG0uaGFzaD11Lmxlbmd0aD91LnJlZHVjZSgoZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC5uYW1lfHxqKDE1KSx0ZShlLHQubmFtZSl9KSw1MzgxKS50b1N0cmluZygpOiIiLG19dmFyIHVlPXJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19fZGVmYXVsdC5hLmNyZWF0ZUNvbnRleHQoKSxsZT11ZS5Db25zdW1lcixkZT1yZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5jcmVhdGVDb250ZXh0KCksaGU9KGRlLkNvbnN1bWVyLG5ldyBaKSxwZT1jZSgpO2Z1bmN0aW9uIGZlKCl7cmV0dXJuIE9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VDb250ZXh0Il0pKHVlKXx8aGV9ZnVuY3Rpb24gbWUoKXtyZXR1cm4gT2JqZWN0KHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19bInVzZUNvbnRleHQiXSkoZGUpfHxwZX1mdW5jdGlvbiB5ZShlKXt2YXIgdD1PYmplY3QocmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX1sidXNlU3RhdGUiXSkoZS5zdHlsaXNQbHVnaW5zKSxuPXRbMF0scz10WzFdLGM9ZmUoKSx1PU9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VNZW1vIl0pKChmdW5jdGlvbigpe3ZhciB0PWM7cmV0dXJuIGUuc2hlZXQ/dD1lLnNoZWV0OmUudGFyZ2V0JiYodD10LnJlY29uc3RydWN0V2l0aE9wdGlvbnMoe3RhcmdldDplLnRhcmdldH0sITEpKSxlLmRpc2FibGVDU1NPTUluamVjdGlvbiYmKHQ9dC5yZWNvbnN0cnVjdFdpdGhPcHRpb25zKHt1c2VDU1NPTUluamVjdGlvbjohMX0pKSx0fSksW2UuZGlzYWJsZUNTU09NSW5qZWN0aW9uLGUuc2hlZXQsZS50YXJnZXRdKSxsPU9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VNZW1vIl0pKChmdW5jdGlvbigpe3JldHVybiBjZSh7b3B0aW9uczp7cHJlZml4OiFlLmRpc2FibGVWZW5kb3JQcmVmaXhlc30scGx1Z2luczpufSl9KSxbZS5kaXNhYmxlVmVuZG9yUHJlZml4ZXMsbl0pO3JldHVybiBPYmplY3QocmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX1sidXNlRWZmZWN0Il0pKChmdW5jdGlvbigpe3NoYWxsb3dlcXVhbF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fX2RlZmF1bHQoKShuLGUuc3R5bGlzUGx1Z2lucyl8fHMoZS5zdHlsaXNQbHVnaW5zKX0pLFtlLnN0eWxpc1BsdWdpbnNdKSxyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVlLlByb3ZpZGVyLHt2YWx1ZTp1fSxyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGRlLlByb3ZpZGVyLHt2YWx1ZTpsfSwgZmFsc2U/dW5kZWZpbmVkOmUuY2hpbGRyZW4pKX12YXIgdmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCl7dmFyIG49dGhpczt0aGlzLmluamVjdD1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PXBlKTt2YXIgcj1uLm5hbWUrdC5oYXNoO2UuaGFzTmFtZUZvcklkKG4uaWQscil8fGUuaW5zZXJ0UnVsZXMobi5pZCxyLHQobi5ydWxlcyxyLCJAa2V5ZnJhbWVzIikpfSx0aGlzLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIGooMTIsU3RyaW5nKG4ubmFtZSkpfSx0aGlzLm5hbWU9ZSx0aGlzLmlkPSJzYy1rZXlmcmFtZXMtIitlLHRoaXMucnVsZXM9dH1yZXR1cm4gZS5wcm90b3R5cGUuZ2V0TmFtZT1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9cGUpLHRoaXMubmFtZStlLmhhc2h9LGV9KCksZ2U9LyhbQS1aXSkvLFNlPS8oW0EtWl0pL2csd2U9L15tcy0vLEVlPWZ1bmN0aW9uKGUpe3JldHVybiItIitlLnRvTG93ZXJDYXNlKCl9O2Z1bmN0aW9uIGJlKGUpe3JldHVybiBnZS50ZXN0KGUpP2UucmVwbGFjZShTZSxFZSkucmVwbGFjZSh3ZSwiLW1zLSIpOmV9dmFyIF9lPWZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lfHwhMT09PWV8fCIiPT09ZX07ZnVuY3Rpb24gTmUoZSxuLHIsbyl7aWYoQXJyYXkuaXNBcnJheShlKSl7Zm9yKHZhciBzLGk9W10sYT0wLGM9ZS5sZW5ndGg7YTxjO2ErPTEpIiIhPT0ocz1OZShlW2FdLG4scixvKSkmJihBcnJheS5pc0FycmF5KHMpP2kucHVzaC5hcHBseShpLHMpOmkucHVzaChzKSk7cmV0dXJuIGl9aWYoX2UoZSkpcmV0dXJuIiI7aWYoTihlKSlyZXR1cm4iLiIrZS5zdHlsZWRDb21wb25lbnRJZDtpZihiKGUpKXtpZigiZnVuY3Rpb24iIT10eXBlb2YobD1lKXx8bC5wcm90b3R5cGUmJmwucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnR8fCFuKXJldHVybiBlO3ZhciB1PWUobik7cmV0dXJuIGZhbHNlJiZmYWxzZSxOZSh1LG4scixvKX12YXIgbDtyZXR1cm4gZSBpbnN0YW5jZW9mIHZlP3I/KGUuaW5qZWN0KHIsbyksZS5nZXROYW1lKG8pKTplOlMoZSk/ZnVuY3Rpb24gZSh0LG4pe3ZhciByLG8scz1bXTtmb3IodmFyIGkgaW4gdCl0Lmhhc093blByb3BlcnR5KGkpJiYhX2UodFtpXSkmJihTKHRbaV0pP3MucHVzaC5hcHBseShzLGUodFtpXSxpKSk6Yih0W2ldKT9zLnB1c2goYmUoaSkrIjoiLHRbaV0sIjsiKTpzLnB1c2goYmUoaSkrIjogIisocj1pLG51bGw9PShvPXRbaV0pfHwiYm9vbGVhbiI9PXR5cGVvZiBvfHwiIj09PW8/IiI6Im51bWJlciIhPXR5cGVvZiBvfHwwPT09b3x8ciBpbiBfZW1vdGlvbl91bml0bGVzc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfNF9fWy8qIGRlZmF1bHQgKi8gImEiXT9TdHJpbmcobykudHJpbSgpOm8rInB4IikrIjsiKSk7cmV0dXJuIG4/W24rIiB7Il0uY29uY2F0KHMsWyJ9Il0pOnN9KGUpOmUudG9TdHJpbmcoKX1mdW5jdGlvbiBBZShlKXtmb3IodmFyIHQ9YXJndW1lbnRzLmxlbmd0aCxuPW5ldyBBcnJheSh0PjE/dC0xOjApLHI9MTtyPHQ7cisrKW5bci0xXT1hcmd1bWVudHNbcl07cmV0dXJuIGIoZSl8fFMoZSk/TmUoZyh3LFtlXS5jb25jYXQobikpKTowPT09bi5sZW5ndGgmJjE9PT1lLmxlbmd0aCYmInN0cmluZyI9PXR5cGVvZiBlWzBdP2U6TmUoZyhlLG4pKX12YXIgQ2U9L2ludmFsaWQgaG9vayBjYWxsL2ksSWU9bmV3IFNldCxQZT1mdW5jdGlvbihlLHQpe2lmKGZhbHNlKXsgdmFyIG47IH19LE9lPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gdm9pZCAwPT09biYmKG49RSksZS50aGVtZSE9PW4udGhlbWUmJmUudGhlbWV8fHR8fG4udGhlbWV9LFJlPS9bISIjJCUmXCcoKSorLC4vOjs8PT4/QFtcXFxcXFxdXmB7fH1+LV0rL2csRGU9LyheLXwtJCkvZztmdW5jdGlvbiBqZShlKXtyZXR1cm4gZS5yZXBsYWNlKFJlLCItIikucmVwbGFjZShEZSwiIil9dmFyIFRlPWZ1bmN0aW9uKGUpe3JldHVybiBlZShuZShlKT4+PjApfTtmdW5jdGlvbiBrZShlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIGUmJiggdHJ1ZXx8ZmFsc2UpfXZhciB4ZT1mdW5jdGlvbihlKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgZXx8Im9iamVjdCI9PXR5cGVvZiBlJiZudWxsIT09ZSYmIUFycmF5LmlzQXJyYXkoZSl9LFZlPWZ1bmN0aW9uKGUpe3JldHVybiJfX3Byb3RvX18iIT09ZSYmImNvbnN0cnVjdG9yIiE9PWUmJiJwcm90b3R5cGUiIT09ZX07ZnVuY3Rpb24gQmUoZSx0LG4pe3ZhciByPWVbbl07eGUodCkmJnhlKHIpP01lKHIsdCk6ZVtuXT10fWZ1bmN0aW9uIE1lKGUpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLG49bmV3IEFycmF5KHQ+MT90LTE6MCkscj0xO3I8dDtyKyspbltyLTFdPWFyZ3VtZW50c1tyXTtmb3IodmFyIG89MCxzPW47bzxzLmxlbmd0aDtvKyspe3ZhciBpPXNbb107aWYoeGUoaSkpZm9yKHZhciBhIGluIGkpVmUoYSkmJkJlKGUsaVthXSxhKX1yZXR1cm4gZX12YXIgemU9cmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX19kZWZhdWx0LmEuY3JlYXRlQ29udGV4dCgpLExlPXplLkNvbnN1bWVyO2Z1bmN0aW9uIEdlKGUpe3ZhciB0PU9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VDb250ZXh0Il0pKHplKSxuPU9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VNZW1vIl0pKChmdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihlLHQpe2lmKCFlKXJldHVybiBqKDE0KTtpZihiKGUpKXt2YXIgbj1lKHQpO3JldHVybiB0cnVlP246dW5kZWZpbmVkfXJldHVybiBBcnJheS5pc0FycmF5KGUpfHwib2JqZWN0IiE9dHlwZW9mIGU/aig4KTp0P3Yoe30sdCx7fSxlKTplfShlLnRoZW1lLHQpfSksW2UudGhlbWUsdF0pO3JldHVybiBlLmNoaWxkcmVuP3JlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19fZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoemUuUHJvdmlkZXIse3ZhbHVlOm59LGUuY2hpbGRyZW4pOm51bGx9dmFyIEZlPXt9O2Z1bmN0aW9uIFllKGUsdCxuKXt2YXIgbz1OKGUpLGk9IWtlKGUpLGE9dC5hdHRycyxjPXZvaWQgMD09PWE/dzphLGQ9dC5jb21wb25lbnRJZCxoPXZvaWQgMD09PWQ/ZnVuY3Rpb24oZSx0KXt2YXIgbj0ic3RyaW5nIiE9dHlwZW9mIGU/InNjIjpqZShlKTtGZVtuXT0oRmVbbl18fDApKzE7dmFyIHI9bisiLSIrVGUoIjUuMi4xIituK0ZlW25dKTtyZXR1cm4gdD90KyItIityOnJ9KHQuZGlzcGxheU5hbWUsdC5wYXJlbnRDb21wb25lbnRJZCk6ZCxwPXQuZGlzcGxheU5hbWUsZj12b2lkIDA9PT1wP2Z1bmN0aW9uKGUpe3JldHVybiBrZShlKT8ic3R5bGVkLiIrZToiU3R5bGVkKCIrXyhlKSsiKSJ9KGUpOnAsZz10LmRpc3BsYXlOYW1lJiZ0LmNvbXBvbmVudElkP2plKHQuZGlzcGxheU5hbWUpKyItIit0LmNvbXBvbmVudElkOnQuY29tcG9uZW50SWR8fGgsUz1vJiZlLmF0dHJzP0FycmF5LnByb3RvdHlwZS5jb25jYXQoZS5hdHRycyxjKS5maWx0ZXIoQm9vbGVhbik6YyxBPXQuc2hvdWxkRm9yd2FyZFByb3A7byYmZS5zaG91bGRGb3J3YXJkUHJvcCYmKEE9dC5zaG91bGRGb3J3YXJkUHJvcD9mdW5jdGlvbihuLHIpe3JldHVybiBlLnNob3VsZEZvcndhcmRQcm9wKG4scikmJnQuc2hvdWxkRm9yd2FyZFByb3AobixyKX06ZS5zaG91bGRGb3J3YXJkUHJvcCk7dmFyIEMsST1uZXcgc2UobixnLG8/ZS5jb21wb25lbnRTdHlsZTp2b2lkIDApLFA9SS5pc1N0YXRpYyYmMD09PWMubGVuZ3RoLE89ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZnVuY3Rpb24oZSx0LG4scil7dmFyIG89ZS5hdHRycyxpPWUuY29tcG9uZW50U3R5bGUsYT1lLmRlZmF1bHRQcm9wcyxjPWUuZm9sZGVkQ29tcG9uZW50SWRzLGQ9ZS5zaG91bGRGb3J3YXJkUHJvcCxoPWUuc3R5bGVkQ29tcG9uZW50SWQscD1lLnRhcmdldDsgZmFsc2UmJmZhbHNlO3ZhciBmPWZ1bmN0aW9uKGUsdCxuKXt2b2lkIDA9PT1lJiYoZT1FKTt2YXIgcj12KHt9LHQse3RoZW1lOmV9KSxvPXt9O3JldHVybiBuLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0LG4scyxpPWU7Zm9yKHQgaW4gYihpKSYmKGk9aShyKSksaSlyW3RdPW9bdF09ImNsYXNzTmFtZSI9PT10PyhuPW9bdF0scz1pW3RdLG4mJnM/bisiICIrczpufHxzKTppW3RdfSkpLFtyLG9dfShPZSh0LE9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VDb250ZXh0Il0pKHplKSxhKXx8RSx0LG8pLHk9ZlswXSxnPWZbMV0sUz1mdW5jdGlvbihlLHQsbixyKXt2YXIgbz1mZSgpLHM9bWUoKSxpPXQ/ZS5nZW5lcmF0ZUFuZEluamVjdFN0eWxlcyhFLG8scyk6ZS5nZW5lcmF0ZUFuZEluamVjdFN0eWxlcyhuLG8scyk7cmV0dXJuIGZhbHNlJiZmYWxzZSwgZmFsc2UmJmZhbHNlLGl9KGkscix5LCBmYWxzZT91bmRlZmluZWQ6dm9pZCAwKSx3PW4sXz1nLiRhc3x8dC4kYXN8fGcuYXN8fHQuYXN8fHAsTj1rZShfKSxBPWchPT10P3Yoe30sdCx7fSxnKTp0LEM9e307Zm9yKHZhciBJIGluIEEpIiQiIT09SVswXSYmImFzIiE9PUkmJigiZm9yd2FyZGVkQXMiPT09ST9DLmFzPUFbSV06KGQ/ZChJLF9lbW90aW9uX2lzX3Byb3BfdmFsaWRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzVfX1svKiBkZWZhdWx0ICovICJhIl0pOiFOfHxPYmplY3QoX2Vtb3Rpb25faXNfcHJvcF92YWxpZF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfNV9fWy8qIGRlZmF1bHQgKi8gImEiXSkoSSkpJiYoQ1tJXT1BW0ldKSk7cmV0dXJuIHQuc3R5bGUmJmcuc3R5bGUhPT10LnN0eWxlJiYoQy5zdHlsZT12KHt9LHQuc3R5bGUse30sZy5zdHlsZSkpLEMuY2xhc3NOYW1lPUFycmF5LnByb3RvdHlwZS5jb25jYXQoYyxoLFMhPT1oP1M6bnVsbCx0LmNsYXNzTmFtZSxnLmNsYXNzTmFtZSkuZmlsdGVyKEJvb2xlYW4pLmpvaW4oIiAiKSxDLnJlZj13LE9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJjcmVhdGVFbGVtZW50Il0pKF8sQyl9KEMsZSx0LFApfTtyZXR1cm4gTy5kaXNwbGF5TmFtZT1mLChDPXJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19fZGVmYXVsdC5hLmZvcndhcmRSZWYoTykpLmF0dHJzPVMsQy5jb21wb25lbnRTdHlsZT1JLEMuZGlzcGxheU5hbWU9ZixDLnNob3VsZEZvcndhcmRQcm9wPUEsQy5mb2xkZWRDb21wb25lbnRJZHM9bz9BcnJheS5wcm90b3R5cGUuY29uY2F0KGUuZm9sZGVkQ29tcG9uZW50SWRzLGUuc3R5bGVkQ29tcG9uZW50SWQpOncsQy5zdHlsZWRDb21wb25lbnRJZD1nLEMudGFyZ2V0PW8/ZS50YXJnZXQ6ZSxDLndpdGhDb21wb25lbnQ9ZnVuY3Rpb24oZSl7dmFyIHI9dC5jb21wb25lbnRJZCxvPWZ1bmN0aW9uKGUsdCl7aWYobnVsbD09ZSlyZXR1cm57fTt2YXIgbixyLG89e30scz1PYmplY3Qua2V5cyhlKTtmb3Iocj0wO3I8cy5sZW5ndGg7cisrKW49c1tyXSx0LmluZGV4T2Yobik+PTB8fChvW25dPWVbbl0pO3JldHVybiBvfSh0LFsiY29tcG9uZW50SWQiXSkscz1yJiZyKyItIisoa2UoZSk/ZTpqZShfKGUpKSk7cmV0dXJuIFllKGUsdih7fSxvLHthdHRyczpTLGNvbXBvbmVudElkOnN9KSxuKX0sT2JqZWN0LmRlZmluZVByb3BlcnR5KEMsImRlZmF1bHRQcm9wcyIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9mb2xkZWREZWZhdWx0UHJvcHN9LHNldDpmdW5jdGlvbih0KXt0aGlzLl9mb2xkZWREZWZhdWx0UHJvcHM9bz9NZSh7fSxlLmRlZmF1bHRQcm9wcyx0KTp0fX0pLCBmYWxzZSYmKGZhbHNlKSxDLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIi4iK0Muc3R5bGVkQ29tcG9uZW50SWR9LGkmJmhvaXN0X25vbl9yZWFjdF9zdGF0aWNzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV82X19fZGVmYXVsdCgpKEMsZSx7YXR0cnM6ITAsY29tcG9uZW50U3R5bGU6ITAsZGlzcGxheU5hbWU6ITAsZm9sZGVkQ29tcG9uZW50SWRzOiEwLHNob3VsZEZvcndhcmRQcm9wOiEwLHN0eWxlZENvbXBvbmVudElkOiEwLHRhcmdldDohMCx3aXRoQ29tcG9uZW50OiEwfSksQ312YXIgcWU9ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uIGUodCxyLG8pe2lmKHZvaWQgMD09PW8mJihvPUUpLCFPYmplY3QocmVhY3RfaXNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX1siaXNWYWxpZEVsZW1lbnRUeXBlIl0pKHIpKXJldHVybiBqKDEsU3RyaW5nKHIpKTt2YXIgcz1mdW5jdGlvbigpe3JldHVybiB0KHIsbyxBZS5hcHBseSh2b2lkIDAsYXJndW1lbnRzKSl9O3JldHVybiBzLndpdGhDb25maWc9ZnVuY3Rpb24obil7cmV0dXJuIGUodCxyLHYoe30sbyx7fSxuKSl9LHMuYXR0cnM9ZnVuY3Rpb24obil7cmV0dXJuIGUodCxyLHYoe30sbyx7YXR0cnM6QXJyYXkucHJvdG90eXBlLmNvbmNhdChvLmF0dHJzLG4pLmZpbHRlcihCb29sZWFuKX0pKX0sc30oWWUsZSl9O1siYSIsImFiYnIiLCJhZGRyZXNzIiwiYXJlYSIsImFydGljbGUiLCJhc2lkZSIsImF1ZGlvIiwiYiIsImJhc2UiLCJiZGkiLCJiZG8iLCJiaWciLCJibG9ja3F1b3RlIiwiYm9keSIsImJyIiwiYnV0dG9uIiwiY2FudmFzIiwiY2FwdGlvbiIsImNpdGUiLCJjb2RlIiwiY29sIiwiY29sZ3JvdXAiLCJkYXRhIiwiZGF0YWxpc3QiLCJkZCIsImRlbCIsImRldGFpbHMiLCJkZm4iLCJkaWFsb2ciLCJkaXYiLCJkbCIsImR0IiwiZW0iLCJlbWJlZCIsImZpZWxkc2V0IiwiZmlnY2FwdGlvbiIsImZpZ3VyZSIsImZvb3RlciIsImZvcm0iLCJoMSIsImgyIiwiaDMiLCJoNCIsImg1IiwiaDYiLCJoZWFkIiwiaGVhZGVyIiwiaGdyb3VwIiwiaHIiLCJodG1sIiwiaSIsImlmcmFtZSIsImltZyIsImlucHV0IiwiaW5zIiwia2JkIiwia2V5Z2VuIiwibGFiZWwiLCJsZWdlbmQiLCJsaSIsImxpbmsiLCJtYWluIiwibWFwIiwibWFyayIsIm1hcnF1ZWUiLCJtZW51IiwibWVudWl0ZW0iLCJtZXRhIiwibWV0ZXIiLCJuYXYiLCJub3NjcmlwdCIsIm9iamVjdCIsIm9sIiwib3B0Z3JvdXAiLCJvcHRpb24iLCJvdXRwdXQiLCJwIiwicGFyYW0iLCJwaWN0dXJlIiwicHJlIiwicHJvZ3Jlc3MiLCJxIiwicnAiLCJydCIsInJ1YnkiLCJzIiwic2FtcCIsInNjcmlwdCIsInNlY3Rpb24iLCJzZWxlY3QiLCJzbWFsbCIsInNvdXJjZSIsInNwYW4iLCJzdHJvbmciLCJzdHlsZSIsInN1YiIsInN1bW1hcnkiLCJzdXAiLCJ0YWJsZSIsInRib2R5IiwidGQiLCJ0ZXh0YXJlYSIsInRmb290IiwidGgiLCJ0aGVhZCIsInRpbWUiLCJ0aXRsZSIsInRyIiwidHJhY2siLCJ1IiwidWwiLCJ2YXIiLCJ2aWRlbyIsIndiciIsImNpcmNsZSIsImNsaXBQYXRoIiwiZGVmcyIsImVsbGlwc2UiLCJmb3JlaWduT2JqZWN0IiwiZyIsImltYWdlIiwibGluZSIsImxpbmVhckdyYWRpZW50IiwibWFya2VyIiwibWFzayIsInBhdGgiLCJwYXR0ZXJuIiwicG9seWdvbiIsInBvbHlsaW5lIiwicmFkaWFsR3JhZGllbnQiLCJyZWN0Iiwic3RvcCIsInN2ZyIsInRleHQiLCJ0c3BhbiJdLmZvckVhY2goKGZ1bmN0aW9uKGUpe3FlW2VdPXFlKGUpfSkpO3ZhciBIZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXt0aGlzLnJ1bGVzPWUsdGhpcy5jb21wb25lbnRJZD10LHRoaXMuaXNTdGF0aWM9cmUoZSksWi5yZWdpc3RlcklkKHRoaXMuY29tcG9uZW50SWQrMSl9dmFyIHQ9ZS5wcm90b3R5cGU7cmV0dXJuIHQuY3JlYXRlU3R5bGVzPWZ1bmN0aW9uKGUsdCxuLHIpe3ZhciBvPXIoTmUodGhpcy5ydWxlcyx0LG4scikuam9pbigiIiksIiIpLHM9dGhpcy5jb21wb25lbnRJZCtlO24uaW5zZXJ0UnVsZXMocyxzLG8pfSx0LnJlbW92ZVN0eWxlcz1mdW5jdGlvbihlLHQpe3QuY2xlYXJSdWxlcyh0aGlzLmNvbXBvbmVudElkK2UpfSx0LnJlbmRlclN0eWxlcz1mdW5jdGlvbihlLHQsbixyKXtlPjImJloucmVnaXN0ZXJJZCh0aGlzLmNvbXBvbmVudElkK2UpLHRoaXMucmVtb3ZlU3R5bGVzKGUsbiksdGhpcy5jcmVhdGVTdHlsZXMoZSx0LG4scil9LGV9KCk7ZnVuY3Rpb24gJGUoZSl7Zm9yKHZhciB0PWFyZ3VtZW50cy5sZW5ndGgsbj1uZXcgQXJyYXkodD4xP3QtMTowKSxvPTE7bzx0O28rKyluW28tMV09YXJndW1lbnRzW29dO3ZhciBpPUFlLmFwcGx5KHZvaWQgMCxbZV0uY29uY2F0KG4pKSxhPSJzYy1nbG9iYWwtIitUZShKU09OLnN0cmluZ2lmeShpKSksdT1uZXcgSGUoaSxhKTtmdW5jdGlvbiBsKGUpe3ZhciB0PWZlKCksbj1tZSgpLG89T2JqZWN0KHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19bInVzZUNvbnRleHQiXSkoemUpLGw9T2JqZWN0KHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19bInVzZVJlZiJdKSh0LmFsbG9jYXRlR1NJbnN0YW5jZShhKSkuY3VycmVudDtyZXR1cm4gZmFsc2UmJmZhbHNlLCBmYWxzZSYmZmFsc2UsT2JqZWN0KHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19bInVzZUxheW91dEVmZmVjdCJdKSgoZnVuY3Rpb24oKXtyZXR1cm4gaChsLGUsdCxvLG4pLGZ1bmN0aW9uKCl7cmV0dXJuIHUucmVtb3ZlU3R5bGVzKGwsdCl9fSksW2wsZSx0LG8sbl0pLG51bGx9ZnVuY3Rpb24gaChlLHQsbixyLG8pe2lmKHUuaXNTdGF0aWMpdS5yZW5kZXJTdHlsZXMoZSxPLG4sbyk7ZWxzZXt2YXIgcz12KHt9LHQse3RoZW1lOk9lKHQscixsLmRlZmF1bHRQcm9wcyl9KTt1LnJlbmRlclN0eWxlcyhlLHMsbixvKX19cmV0dXJuIGZhbHNlJiZmYWxzZSxyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5tZW1vKGwpfWZ1bmN0aW9uIFdlKGUpeyBmYWxzZSYmZmFsc2U7Zm9yKHZhciB0PWFyZ3VtZW50cy5sZW5ndGgsbj1uZXcgQXJyYXkodD4xP3QtMTowKSxyPTE7cjx0O3IrKyluW3ItMV09YXJndW1lbnRzW3JdO3ZhciBvPUFlLmFwcGx5KHZvaWQgMCxbZV0uY29uY2F0KG4pKS5qb2luKCIiKSxzPVRlKG8pO3JldHVybiBuZXcgdmUocyxvKX12YXIgVWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7dmFyIGU9dGhpczt0aGlzLl9lbWl0U2hlZXRDU1M9ZnVuY3Rpb24oKXt2YXIgdD1lLmluc3RhbmNlLnRvU3RyaW5nKCksbj1xKCk7cmV0dXJuIjxzdHlsZSAiK1tuJiZcJ25vbmNlPSJcJytuK1wnIlwnLEErXCc9InRydWUiXCcsXCdkYXRhLXN0eWxlZC12ZXJzaW9uPSI1LjIuMSJcJ10uZmlsdGVyKEJvb2xlYW4pLmpvaW4oIiAiKSsiPiIrdCsiPC9zdHlsZT4ifSx0aGlzLmdldFN0eWxlVGFncz1mdW5jdGlvbigpe3JldHVybiBlLnNlYWxlZD9qKDIpOmUuX2VtaXRTaGVldENTUygpfSx0aGlzLmdldFN0eWxlRWxlbWVudD1mdW5jdGlvbigpe3ZhciB0O2lmKGUuc2VhbGVkKXJldHVybiBqKDIpO3ZhciBuPSgodD17fSlbQV09IiIsdFsiZGF0YS1zdHlsZWQtdmVyc2lvbiJdPSI1LjIuMSIsdC5kYW5nZXJvdXNseVNldElubmVySFRNTD17X19odG1sOmUuaW5zdGFuY2UudG9TdHJpbmcoKX0sdCksbz1xKCk7cmV0dXJuIG8mJihuLm5vbmNlPW8pLFtyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdHlsZSIsdih7fSxuLHtrZXk6InNjLTAtMCJ9KSldfSx0aGlzLnNlYWw9ZnVuY3Rpb24oKXtlLnNlYWxlZD0hMH0sdGhpcy5pbnN0YW5jZT1uZXcgWih7aXNTZXJ2ZXI6ITB9KSx0aGlzLnNlYWxlZD0hMX12YXIgdD1lLnByb3RvdHlwZTtyZXR1cm4gdC5jb2xsZWN0U3R5bGVzPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnNlYWxlZD9qKDIpOnJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19fZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoeWUse3NoZWV0OnRoaXMuaW5zdGFuY2V9LGUpfSx0LmludGVybGVhdmVXaXRoTm9kZVN0cmVhbT1mdW5jdGlvbihlKXtyZXR1cm4gaigzKX0sZX0oKSxKZT1mdW5jdGlvbihlKXt2YXIgdD1yZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fX2RlZmF1bHQuYS5mb3J3YXJkUmVmKChmdW5jdGlvbih0LG4pe3ZhciBvPU9iamVjdChyZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWyJ1c2VDb250ZXh0Il0pKHplKSxpPWUuZGVmYXVsdFByb3BzLGE9T2UodCxvLGkpO3JldHVybiBmYWxzZSYmZmFsc2UscmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX19kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChlLHYoe30sdCx7dGhlbWU6YSxyZWY6bn0pKX0pKTtyZXR1cm4gaG9pc3Rfbm9uX3JlYWN0X3N0YXRpY3NfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzZfX19kZWZhdWx0KCkodCxlKSx0LmRpc3BsYXlOYW1lPSJXaXRoVGhlbWUoIitfKGUpKyIpIix0fSxYZT1mdW5jdGlvbigpe3JldHVybiBPYmplY3QocmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX1sidXNlQ29udGV4dCJdKSh6ZSl9LFplPXtTdHlsZVNoZWV0OlosbWFzdGVyU2hlZXQ6aGV9OyBmYWxzZSYmZmFsc2UsIGZhbHNlJiYoZmFsc2UpOy8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siYSJdID0gKHFlKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0eWxlZC1jb21wb25lbnRzLmJyb3dzZXIuZXNtLmpzLm1hcFxuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi9wcm9jZXNzL2Jyb3dzZXIuanMgKi8gMTEpKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3N0eWxlZC1jb21wb25lbnRzL2Rpc3Qvc3R5bGVkLWNvbXBvbmVudHMuYnJvd3Nlci5lc20uanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxfX3dlYnBhY2tfZXhwb3J0c19fLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCcvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bImEiXSA9ICh7XG4gIGFuYWx5dGljc1VybDogImh0dHBzOi8vdW5pZGxhcGkucnUvc3RhdC8iLFxuICBnZXRVdG1Vcmw6ICJodHRwczovL3VuaWRvd25sb2FkZXIuY29tL3VzZXIiLFxuICBicmFuY2g6ICJIRUFEIixcbiAgaGFzaDogIjkwNTk0NjUiLFxuICB2ZXJzaW9uOiAiMC43LjkiLFxuICB0eXBlOiAidWRsLXVzcnNjciIsXG4gIGFuYWx5dGljczogImh0dHBzOi8vcmVxYXBpLnJ1L2FuYWx5dGljcy8iLFxuICBkZWZhdWx0OiB7XG4gICAgYXR0ZW1wdHM6IDIwLFxuICB9LFxufSk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vc3JjL2NvbmZpZy5qcz8nKX0sLGZ1bmN0aW9uKG1vZHVsZSxfX3dlYnBhY2tfZXhwb3J0c19fLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCcvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24oQnVmZmVyKSB7LyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIGNvbmZpZ19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgY29uZmlnICovIDIpO1xuXG5cbi8vIGl0XCdzIGtpbmQgb2YgdXRpbHMgb3Igc29tZXRoaW5nXG5jb25zdCBjdHggPSB7XG4gIC8vIHByb3BlcnRpZXNcbiAgd2luZG93LFxuXG4gIC8vIG1ldGhvZHNcbiAgZ2V0U2VydmljZVVybCh1cmwsIGxhbmcpIHtcbiAgICBjb25zdCBiYXNlNjRTdHJpbmcgPSBCdWZmZXIuZnJvbSh1cmwpLnRvU3RyaW5nKCJiYXNlNjQiKTtcbiAgICBjb25zdCBtb2RpZmllZEJhc2U2NFN0cmluZyA9IGJhc2U2NFN0cmluZy5yZXBsYWNlKCIvIiwgIl8iKS5yZXBsYWNlKCIrIiwgIi0iKTtcbiAgICBjb25zdCBlbmNvZGVkU3RyaW5nID0gZW5jb2RlVVJJQ29tcG9uZW50KG1vZGlmaWVkQmFzZTY0U3RyaW5nKTtcbiAgICByZXR1cm4gYGh0dHBzOi8vdW5pZG93bmxvYWRlci5jb20vJHtsYW5nIHx8ICJlbiJ9L3ZpZC8ke2VuY29kZWRTdHJpbmd9YDtcbiAgfSxcblxuICBnZXROdGhBbmNlc3Rvcihub2RlLCBuKSB7XG4gICAgbGV0IHJlcyA9IG5vZGU7XG4gICAgbGV0IGNvdW50ZXIgPSBuO1xuICAgIHdoaWxlIChjb3VudGVyID4gMCkge1xuICAgICAgcmVzID0gcmVzLnBhcmVudEVsZW1lbnQ7XG4gICAgICBpZiAocmVzICE9PSBudWxsKSB7XG4gICAgICAgIGNvdW50ZXIgLT0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9LFxuXG4gIGxvZyhzZXJ2aWNlLCBtZXNzYWdlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgIHR5cGU6ICJ1bmlkb3dubG9hZGVyX3VzZXJzY3JpcHQiLFxuICAgICAgICB2ZXJzaW9uOiBjb25maWdfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX1svKiBkZWZhdWx0ICovICJhIl0udmVyc2lvbixcbiAgICAgICAgc2VydmljZSxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgIH07XG4gICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIHhoci5vcGVuKCJQT1NUIiwgY29uZmlnX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19bLyogZGVmYXVsdCAqLyAiYSJdLmFuYWx5dGljcywgdHJ1ZSk7XG4gICAgICAvLyBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmtleXMoZGF0YSkucmVkdWNlKChhY2MsIGtleSkgPT4gYCR7YWNjfSYke2tleX09JHtlbmNvZGVVUklDb21wb25lbnQoZGF0YVtrZXldKX1gLCAiIik7XG4gICAgICAvLyB4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpO1xuICAgICAgLy8geGhyLnNlbmQocGF5bG9hZCk7XG4gICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiKTtcbiAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgfVxuICB9LFxufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fWyJhIl0gPSAoY3R4KTtcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vLi4vbm9kZV9tb2R1bGVzL2J1ZmZlci9pbmRleC5qcyAqLyA0MykuQnVmZmVyKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vc3JjL3V0aWxzL2N0eC5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIlxuXG5mdW5jdGlvbiBjaGVja0RDRSgpIHtcbiAgLyogZ2xvYmFsIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyAqL1xuICBpZiAoXG4gICAgdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyA9PT0gJ3VuZGVmaW5lZCcgfHxcbiAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFICE9PSAnZnVuY3Rpb24nXG4gICkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoZmFsc2UpIHt9XG4gIHRyeSB7XG4gICAgLy8gVmVyaWZ5IHRoYXQgdGhlIGNvZGUgYWJvdmUgaGFzIGJlZW4gZGVhZCBjb2RlIGVsaW1pbmF0ZWQgKERDRSdkKS5cbiAgICBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18uY2hlY2tEQ0UoY2hlY2tEQ0UpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBEZXZUb29scyBzaG91bGRuJ3QgY3Jhc2ggUmVhY3QsIG5vIG1hdHRlciB3aGF0LlxuICAgIC8vIFdlIHNob3VsZCBzdGlsbCByZXBvcnQgaW4gY2FzZSB3ZSBicmVhayB0aGlzIGNvZGUuXG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9XG59XG5cbmlmICh0cnVlKSB7XG4gIC8vIERDRSBjaGVjayBzaG91bGQgaGFwcGVuIGJlZm9yZSBSZWFjdERPTSBidW5kbGUgZXhlY3V0ZXMgc28gdGhhdFxuICAvLyBEZXZUb29scyBjYW4gcmVwb3J0IGJhZCBtaW5pZmljYXRpb24gZHVyaW5nIGluamVjdGlvbi5cbiAgY2hlY2tEQ0UoKTtcbiAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2Nqcy9yZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanMgKi8gNzIpO1xufSBlbHNlIHt9XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlYWN0LWRvbS9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLF9fd2VicGFja19leHBvcnRzX18sX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoJy8qIGhhcm1vbnkgZXhwb3J0IChiaW5kaW5nKSAqLyBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImEiLCBmdW5jdGlvbigpIHsgcmV0dXJuIF9pbmhlcml0c0xvb3NlOyB9KTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfc2V0UHJvdG90eXBlT2ZfanNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc2V0UHJvdG90eXBlT2YuanMgKi8gMTIpO1xuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykge1xuICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTtcbiAgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7XG4gIE9iamVjdChfc2V0UHJvdG90eXBlT2ZfanNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX1svKiBkZWZhdWx0ICovICJhIl0pKHN1YkNsYXNzLCBzdXBlckNsYXNzKTtcbn1cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzTG9vc2UuanM/Jyl9LCxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiXG5cbnZhciByZWFjdElzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcmVhY3QtaXMgKi8gOSk7XG5cbi8qKlxuICogQ29weXJpZ2h0IDIwMTUsIFlhaG9vISBJbmMuXG4gKiBDb3B5cmlnaHRzIGxpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIExpY2Vuc2UuIFNlZSB0aGUgYWNjb21wYW55aW5nIExJQ0VOU0UgZmlsZSBmb3IgdGVybXMuXG4gKi9cbnZhciBSRUFDVF9TVEFUSUNTID0ge1xuICBjaGlsZENvbnRleHRUeXBlczogdHJ1ZSxcbiAgY29udGV4dFR5cGU6IHRydWUsXG4gIGNvbnRleHRUeXBlczogdHJ1ZSxcbiAgZGVmYXVsdFByb3BzOiB0cnVlLFxuICBkaXNwbGF5TmFtZTogdHJ1ZSxcbiAgZ2V0RGVmYXVsdFByb3BzOiB0cnVlLFxuICBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3I6IHRydWUsXG4gIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczogdHJ1ZSxcbiAgbWl4aW5zOiB0cnVlLFxuICBwcm9wVHlwZXM6IHRydWUsXG4gIHR5cGU6IHRydWVcbn07XG52YXIgS05PV05fU1RBVElDUyA9IHtcbiAgbmFtZTogdHJ1ZSxcbiAgbGVuZ3RoOiB0cnVlLFxuICBwcm90b3R5cGU6IHRydWUsXG4gIGNhbGxlcjogdHJ1ZSxcbiAgY2FsbGVlOiB0cnVlLFxuICBhcmd1bWVudHM6IHRydWUsXG4gIGFyaXR5OiB0cnVlXG59O1xudmFyIEZPUldBUkRfUkVGX1NUQVRJQ1MgPSB7XG4gICckJHR5cGVvZic6IHRydWUsXG4gIHJlbmRlcjogdHJ1ZSxcbiAgZGVmYXVsdFByb3BzOiB0cnVlLFxuICBkaXNwbGF5TmFtZTogdHJ1ZSxcbiAgcHJvcFR5cGVzOiB0cnVlXG59O1xudmFyIE1FTU9fU1RBVElDUyA9IHtcbiAgJyQkdHlwZW9mJzogdHJ1ZSxcbiAgY29tcGFyZTogdHJ1ZSxcbiAgZGVmYXVsdFByb3BzOiB0cnVlLFxuICBkaXNwbGF5TmFtZTogdHJ1ZSxcbiAgcHJvcFR5cGVzOiB0cnVlLFxuICB0eXBlOiB0cnVlXG59O1xudmFyIFRZUEVfU1RBVElDUyA9IHt9O1xuVFlQRV9TVEFUSUNTW3JlYWN0SXMuRm9yd2FyZFJlZl0gPSBGT1JXQVJEX1JFRl9TVEFUSUNTO1xuVFlQRV9TVEFUSUNTW3JlYWN0SXMuTWVtb10gPSBNRU1PX1NUQVRJQ1M7XG5cbmZ1bmN0aW9uIGdldFN0YXRpY3MoY29tcG9uZW50KSB7XG4gIC8vIFJlYWN0IHYxNi4xMSBhbmQgYmVsb3dcbiAgaWYgKHJlYWN0SXMuaXNNZW1vKGNvbXBvbmVudCkpIHtcbiAgICByZXR1cm4gTUVNT19TVEFUSUNTO1xuICB9IC8vIFJlYWN0IHYxNi4xMiBhbmQgYWJvdmVcblxuXG4gIHJldHVybiBUWVBFX1NUQVRJQ1NbY29tcG9uZW50WyckJHR5cGVvZiddXSB8fCBSRUFDVF9TVEFUSUNTO1xufVxuXG52YXIgZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7XG52YXIgZ2V0T3duUHJvcGVydHlOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzO1xudmFyIGdldE93blByb3BlcnR5U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG52YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjtcbnZhciBnZXRQcm90b3R5cGVPZiA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjtcbnZhciBvYmplY3RQcm90b3R5cGUgPSBPYmplY3QucHJvdG90eXBlO1xuZnVuY3Rpb24gaG9pc3ROb25SZWFjdFN0YXRpY3ModGFyZ2V0Q29tcG9uZW50LCBzb3VyY2VDb21wb25lbnQsIGJsYWNrbGlzdCkge1xuICBpZiAodHlwZW9mIHNvdXJjZUNvbXBvbmVudCAhPT0gJ3N0cmluZycpIHtcbiAgICAvLyBkb24ndCBob2lzdCBvdmVyIHN0cmluZyAoaHRtbCkgY29tcG9uZW50c1xuICAgIGlmIChvYmplY3RQcm90b3R5cGUpIHtcbiAgICAgIHZhciBpbmhlcml0ZWRDb21wb25lbnQgPSBnZXRQcm90b3R5cGVPZihzb3VyY2VDb21wb25lbnQpO1xuXG4gICAgICBpZiAoaW5oZXJpdGVkQ29tcG9uZW50ICYmIGluaGVyaXRlZENvbXBvbmVudCAhPT0gb2JqZWN0UHJvdG90eXBlKSB7XG4gICAgICAgIGhvaXN0Tm9uUmVhY3RTdGF0aWNzKHRhcmdldENvbXBvbmVudCwgaW5oZXJpdGVkQ29tcG9uZW50LCBibGFja2xpc3QpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBrZXlzID0gZ2V0T3duUHJvcGVydHlOYW1lcyhzb3VyY2VDb21wb25lbnQpO1xuXG4gICAgaWYgKGdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgICAga2V5cyA9IGtleXMuY29uY2F0KGdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2VDb21wb25lbnQpKTtcbiAgICB9XG5cbiAgICB2YXIgdGFyZ2V0U3RhdGljcyA9IGdldFN0YXRpY3ModGFyZ2V0Q29tcG9uZW50KTtcbiAgICB2YXIgc291cmNlU3RhdGljcyA9IGdldFN0YXRpY3Moc291cmNlQ29tcG9uZW50KTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGtleSA9IGtleXNbaV07XG5cbiAgICAgIGlmICghS05PV05fU1RBVElDU1trZXldICYmICEoYmxhY2tsaXN0ICYmIGJsYWNrbGlzdFtrZXldKSAmJiAhKHNvdXJjZVN0YXRpY3MgJiYgc291cmNlU3RhdGljc1trZXldKSAmJiAhKHRhcmdldFN0YXRpY3MgJiYgdGFyZ2V0U3RhdGljc1trZXldKSkge1xuICAgICAgICB2YXIgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2VDb21wb25lbnQsIGtleSk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBBdm9pZCBmYWlsdXJlcyBmcm9tIHJlYWQtb25seSBwcm9wZXJ0aWVzXG4gICAgICAgICAgZGVmaW5lUHJvcGVydHkodGFyZ2V0Q29tcG9uZW50LCBrZXksIGRlc2NyaXB0b3IpO1xuICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YXJnZXRDb21wb25lbnQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gaG9pc3ROb25SZWFjdFN0YXRpY3M7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL2hvaXN0LW5vbi1yZWFjdC1zdGF0aWNzL2Rpc3QvaG9pc3Qtbm9uLXJlYWN0LXN0YXRpY3MuY2pzLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiXG5cbmlmICh0cnVlKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9janMvcmVhY3QtaXMucHJvZHVjdGlvbi5taW4uanMgKi8gNzApO1xufSBlbHNlIHt9XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlYWN0LWlzL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxMy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbmlmIChmYWxzZSkgeyB2YXIgdGhyb3dPbkRpcmVjdEFjY2VzcywgUmVhY3RJczsgfSBlbHNlIHtcbiAgLy8gQnkgZXhwbGljaXRseSB1c2luZyBgcHJvcC10eXBlc2AgeW91IGFyZSBvcHRpbmcgaW50byBuZXcgcHJvZHVjdGlvbiBiZWhhdmlvci5cbiAgLy8gaHR0cDovL2ZiLm1lL3Byb3AtdHlwZXMtaW4tcHJvZFxuICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vZmFjdG9yeVdpdGhUaHJvd2luZ1NoaW1zICovIDY4KSgpO1xufVxuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9wcm9wLXR5cGVzL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbi8vIGNhY2hlZCBmcm9tIHdoYXRldmVyIGdsb2JhbCBpcyBwcmVzZW50IHNvIHRoYXQgdGVzdCBydW5uZXJzIHRoYXQgc3R1YiBpdFxuLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzXG4vLyB3cmFwcGVkIGluIHN0cmljdCBtb2RlIGNvZGUgd2hpY2ggZG9lc24ndCBkZWZpbmUgYW55IGdsb2JhbHMuICBJdCdzIGluc2lkZSBhXG4vLyBmdW5jdGlvbiBiZWNhdXNlIHRyeS9jYXRjaGVzIGRlb3B0aW1pemUgaW4gY2VydGFpbiBlbmdpbmVzLlxuXG52YXIgY2FjaGVkU2V0VGltZW91dDtcbnZhciBjYWNoZWRDbGVhclRpbWVvdXQ7XG5cbmZ1bmN0aW9uIGRlZmF1bHRTZXRUaW1vdXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0ICgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuKGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICB9XG59ICgpKVxuZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHtcbiAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9IGNhdGNoKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKG51bGwsIGZ1biwgMCk7XG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cbmZ1bmN0aW9uIHJ1bkNsZWFyVGltZW91dChtYXJrZXIpIHtcbiAgICBpZiAoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgLy8gaWYgY2xlYXJUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZFxuICAgIGlmICgoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBkZWZhdWx0Q2xlYXJUaW1lb3V0IHx8ICFjYWNoZWRDbGVhclRpbWVvdXQpICYmIGNsZWFyVGltZW91dCkge1xuICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzc1xuICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfSBjYXRjaCAoZSl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgIHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvci5cbiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXRcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cblxufVxudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuXG5mdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7XG4gICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmFpblF1ZXVlKCkge1xuICAgIGlmIChkcmFpbmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spO1xuICAgIGRyYWluaW5nID0gdHJ1ZTtcblxuICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgd2hpbGUobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBjdXJyZW50UXVldWUgPSBudWxsO1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xufVxuXG5wcm9jZXNzLm5leHRUaWNrID0gZnVuY3Rpb24gKGZ1bikge1xuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHF1ZXVlLnB1c2gobmV3IEl0ZW0oZnVuLCBhcmdzKSk7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHtcbiAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTtcbiAgICB9XG59O1xuXG4vLyB2OCBsaWtlcyBwcmVkaWN0aWJsZSBvYmplY3RzXG5mdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHtcbiAgICB0aGlzLmZ1biA9IGZ1bjtcbiAgICB0aGlzLmFycmF5ID0gYXJyYXk7XG59XG5JdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7XG59O1xucHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJztcbnByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG5wcm9jZXNzLmVudiA9IHt9O1xucHJvY2Vzcy5hcmd2ID0gW107XG5wcm9jZXNzLnZlcnNpb24gPSAnJzsgLy8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkIHJlZ2V4cCBpc3N1ZXNcbnByb2Nlc3MudmVyc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kT25jZUxpc3RlbmVyID0gbm9vcDtcblxucHJvY2Vzcy5saXN0ZW5lcnMgPSBmdW5jdGlvbiAobmFtZSkgeyByZXR1cm4gW10gfVxuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5cbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xucHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcHJvY2Vzcy9icm93c2VyLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgnLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCAiYSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gX3NldFByb3RvdHlwZU9mOyB9KTtcbmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7XG4gIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge1xuICAgIG8uX19wcm90b19fID0gcDtcbiAgICByZXR1cm4gbztcbiAgfTtcblxuICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO1xufVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2V0UHJvdG90eXBlT2YuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCdmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWVcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIG9iajtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfZGVmaW5lUHJvcGVydHk7XG5tb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eS5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoJ3ZhciBnO1xuXG4vLyBUaGlzIHdvcmtzIGluIG5vbi1zdHJpY3QgbW9kZVxuZyA9IChmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXM7XG59KSgpO1xuXG50cnkge1xuXHQvLyBUaGlzIHdvcmtzIGlmIGV2YWwgaXMgYWxsb3dlZCAoc2VlIENTUClcblx0ZyA9IGcgfHwgbmV3IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7XG59IGNhdGNoIChlKSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG5cdGlmICh0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IikgZyA9IHdpbmRvdztcbn1cblxuLy8gZyBjYW4gc3RpbGwgYmUgdW5kZWZpbmVkLCBidXQgbm90aGluZyB0byBkbyBhYm91dCBpdC4uLlxuLy8gV2UgcmV0dXJuIHVuZGVmaW5lZCwgaW5zdGVhZCBvZiBub3RoaW5nIGhlcmUsIHNvIGl0XCdzXG4vLyBlYXNpZXIgdG8gaGFuZGxlIHRoaXMgY2FzZS4gaWYoIWdsb2JhbCkgeyAuLi59XG5cbm1vZHVsZS5leHBvcnRzID0gZztcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vZ2xvYmFsLmpzPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCd2YXIgX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsvLyBDb3B5cmlnaHQgMjAxNCBTaW1vbiBMeWRlbGxcclxuLy8gWDExICjigJxNSVTigJ0pIExpY2Vuc2VkLiAoU2VlIExJQ0VOU0UuKVxyXG5cclxudm9pZCAoZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkge1xyXG4gIGlmICh0cnVlKSB7XHJcbiAgICAhKF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9IChmYWN0b3J5KSxcblx0XHRcdFx0X19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSAodHlwZW9mIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9PT0gXCdmdW5jdGlvblwnID9cblx0XHRcdFx0KF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXy5jYWxsKGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18sIGV4cG9ydHMsIG1vZHVsZSkpIDpcblx0XHRcdFx0X19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fKSxcblx0XHRcdFx0X19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpXHJcbiAgfSBlbHNlIHt9XHJcbn0odGhpcywgZnVuY3Rpb24oKSB7XHJcblxyXG4gIGZ1bmN0aW9uIHJlc29sdmVVcmwoLyogLi4udXJscyAqLykge1xyXG4gICAgdmFyIG51bVVybHMgPSBhcmd1bWVudHMubGVuZ3RoXHJcblxyXG4gICAgaWYgKG51bVVybHMgPT09IDApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZXNvbHZlVXJsIHJlcXVpcmVzIGF0IGxlYXN0IG9uZSBhcmd1bWVudDsgZ290IG5vbmUuIilcclxuICAgIH1cclxuXHJcbiAgICB2YXIgYmFzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJhc2UiKVxyXG4gICAgYmFzZS5ocmVmID0gYXJndW1lbnRzWzBdXHJcblxyXG4gICAgaWYgKG51bVVybHMgPT09IDEpIHtcclxuICAgICAgcmV0dXJuIGJhc2UuaHJlZlxyXG4gICAgfVxyXG5cclxuICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXVxyXG4gICAgaGVhZC5pbnNlcnRCZWZvcmUoYmFzZSwgaGVhZC5maXJzdENoaWxkKVxyXG5cclxuICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpXHJcbiAgICB2YXIgcmVzb2x2ZWRcclxuXHJcbiAgICBmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgbnVtVXJsczsgaW5kZXgrKykge1xyXG4gICAgICBhLmhyZWYgPSBhcmd1bWVudHNbaW5kZXhdXHJcbiAgICAgIHJlc29sdmVkID0gYS5ocmVmXHJcbiAgICAgIGJhc2UuaHJlZiA9IHJlc29sdmVkXHJcbiAgICB9XHJcblxyXG4gICAgaGVhZC5yZW1vdmVDaGlsZChiYXNlKVxyXG5cclxuICAgIHJldHVybiByZXNvbHZlZFxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc29sdmVVcmxcclxuXHJcbn0pKTtcclxuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9yZXNvbHZlLXVybC9yZXNvbHZlLXVybC5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLF9fd2VicGFja19leHBvcnRzX18sX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwsIG1vZHVsZSkgey8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBfcG9ueWZpbGxfanNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vcG9ueWZpbGwuanMgKi8gMzApO1xuLyogZ2xvYmFsIHdpbmRvdyAqL1xuXG5cbnZhciByb290O1xuXG5pZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XG4gIHJvb3QgPSBzZWxmO1xufSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICByb290ID0gd2luZG93O1xufSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICByb290ID0gZ2xvYmFsO1xufSBlbHNlIGlmICh0cnVlKSB7XG4gIHJvb3QgPSBtb2R1bGU7XG59IGVsc2Uge31cblxudmFyIHJlc3VsdCA9IE9iamVjdChfcG9ueWZpbGxfanNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX1svKiBkZWZhdWx0ICovIFwiYVwiXSkocm9vdCk7XG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIF9fd2VicGFja19leHBvcnRzX19bXCJhXCJdID0gKHJlc3VsdCk7XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanMgKi8gMTQpLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uL3dlYnBhY2svYnVpbGRpbi9oYXJtb255LW1vZHVsZS5qcyAqLyA3MSkobW9kdWxlKSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zeW1ib2wtb2JzZXJ2YWJsZS9lcy9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLF9fd2VicGFja19leHBvcnRzX18sX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsvKiBoYXJtb255IGltcG9ydCAqLyB2YXIgcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHJlYWN0ICovIDApO1xuLyogaGFybW9ueSBpbXBvcnQgKi8gdmFyIHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19fZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4ocmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyk7XG4vKiBoYXJtb255IGltcG9ydCAqLyB2YXIgX2JhYmVsX3J1bnRpbWVfaGVscGVyc19lc21faW5oZXJpdHNMb29zZV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHNMb29zZSAqLyA2KTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBwcm9wX3R5cGVzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBwcm9wLXR5cGVzICovIDEwKTtcbi8qIGhhcm1vbnkgaW1wb3J0ICovIHZhciBwcm9wX3R5cGVzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX19fZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4ocHJvcF90eXBlc19fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fKTtcblxuXG5cblxuXG52YXIgTUFYX1NJR05FRF8zMV9CSVRfSU5UID0gMTA3Mzc0MTgyMztcbnZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDoge307XG5cbmZ1bmN0aW9uIGdldFVuaXF1ZUlkKCkge1xuICB2YXIga2V5ID0gJ19fZ2xvYmFsX3VuaXF1ZV9pZF9fJztcbiAgcmV0dXJuIGNvbW1vbmpzR2xvYmFsW2tleV0gPSAoY29tbW9uanNHbG9iYWxba2V5XSB8fCAwKSArIDE7XG59XG5cbmZ1bmN0aW9uIG9iamVjdElzKHgsIHkpIHtcbiAgaWYgKHggPT09IHkpIHtcbiAgICByZXR1cm4geCAhPT0gMCB8fCAxIC8geCA9PT0gMSAvIHk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHggIT09IHggJiYgeSAhPT0geTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVFdmVudEVtaXR0ZXIodmFsdWUpIHtcbiAgdmFyIGhhbmRsZXJzID0gW107XG4gIHJldHVybiB7XG4gICAgb246IGZ1bmN0aW9uIG9uKGhhbmRsZXIpIHtcbiAgICAgIGhhbmRsZXJzLnB1c2goaGFuZGxlcik7XG4gICAgfSxcbiAgICBvZmY6IGZ1bmN0aW9uIG9mZihoYW5kbGVyKSB7XG4gICAgICBoYW5kbGVycyA9IGhhbmRsZXJzLmZpbHRlcihmdW5jdGlvbiAoaCkge1xuICAgICAgICByZXR1cm4gaCAhPT0gaGFuZGxlcjtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uIHNldChuZXdWYWx1ZSwgY2hhbmdlZEJpdHMpIHtcbiAgICAgIHZhbHVlID0gbmV3VmFsdWU7XG4gICAgICBoYW5kbGVycy5mb3JFYWNoKGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHJldHVybiBoYW5kbGVyKHZhbHVlLCBjaGFuZ2VkQml0cyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIG9ubHlDaGlsZChjaGlsZHJlbikge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheShjaGlsZHJlbikgPyBjaGlsZHJlblswXSA6IGNoaWxkcmVuO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSZWFjdENvbnRleHQoZGVmYXVsdFZhbHVlLCBjYWxjdWxhdGVDaGFuZ2VkQml0cykge1xuICB2YXIgX1Byb3ZpZGVyJGNoaWxkQ29udGV4LCBfQ29uc3VtZXIkY29udGV4dFR5cGU7XG5cbiAgdmFyIGNvbnRleHRQcm9wID0gJ19fY3JlYXRlLXJlYWN0LWNvbnRleHQtJyArIGdldFVuaXF1ZUlkKCkgKyAnX18nO1xuXG4gIHZhciBQcm92aWRlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgIE9iamVjdChfYmFiZWxfcnVudGltZV9oZWxwZXJzX2VzbV9pbmhlcml0c0xvb3NlX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX19bLyogZGVmYXVsdCAqLyBcImFcIl0pKFByb3ZpZGVyLCBfQ29tcG9uZW50KTtcblxuICAgIGZ1bmN0aW9uIFByb3ZpZGVyKCkge1xuICAgICAgdmFyIF90aGlzO1xuXG4gICAgICBfdGhpcyA9IF9Db21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgX3RoaXMuZW1pdHRlciA9IGNyZWF0ZUV2ZW50RW1pdHRlcihfdGhpcy5wcm9wcy52YWx1ZSk7XG4gICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuXG4gICAgdmFyIF9wcm90byA9IFByb3ZpZGVyLnByb3RvdHlwZTtcblxuICAgIF9wcm90by5nZXRDaGlsZENvbnRleHQgPSBmdW5jdGlvbiBnZXRDaGlsZENvbnRleHQoKSB7XG4gICAgICB2YXIgX3JlZjtcblxuICAgICAgcmV0dXJuIF9yZWYgPSB7fSwgX3JlZltjb250ZXh0UHJvcF0gPSB0aGlzLmVtaXR0ZXIsIF9yZWY7XG4gICAgfTtcblxuICAgIF9wcm90by5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAgIGlmICh0aGlzLnByb3BzLnZhbHVlICE9PSBuZXh0UHJvcHMudmFsdWUpIHtcbiAgICAgICAgdmFyIG9sZFZhbHVlID0gdGhpcy5wcm9wcy52YWx1ZTtcbiAgICAgICAgdmFyIG5ld1ZhbHVlID0gbmV4dFByb3BzLnZhbHVlO1xuICAgICAgICB2YXIgY2hhbmdlZEJpdHM7XG5cbiAgICAgICAgaWYgKG9iamVjdElzKG9sZFZhbHVlLCBuZXdWYWx1ZSkpIHtcbiAgICAgICAgICBjaGFuZ2VkQml0cyA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hhbmdlZEJpdHMgPSB0eXBlb2YgY2FsY3VsYXRlQ2hhbmdlZEJpdHMgPT09ICdmdW5jdGlvbicgPyBjYWxjdWxhdGVDaGFuZ2VkQml0cyhvbGRWYWx1ZSwgbmV3VmFsdWUpIDogTUFYX1NJR05FRF8zMV9CSVRfSU5UO1xuXG4gICAgICAgICAgaWYgKGZhbHNlKSB7fVxuXG4gICAgICAgICAgY2hhbmdlZEJpdHMgfD0gMDtcblxuICAgICAgICAgIGlmIChjaGFuZ2VkQml0cyAhPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5lbWl0dGVyLnNldChuZXh0UHJvcHMudmFsdWUsIGNoYW5nZWRCaXRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuO1xuICAgIH07XG5cbiAgICByZXR1cm4gUHJvdmlkZXI7XG4gIH0ocmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX1tcIkNvbXBvbmVudFwiXSk7XG5cbiAgUHJvdmlkZXIuY2hpbGRDb250ZXh0VHlwZXMgPSAoX1Byb3ZpZGVyJGNoaWxkQ29udGV4ID0ge30sIF9Qcm92aWRlciRjaGlsZENvbnRleFtjb250ZXh0UHJvcF0gPSBwcm9wX3R5cGVzX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX19fZGVmYXVsdC5hLm9iamVjdC5pc1JlcXVpcmVkLCBfUHJvdmlkZXIkY2hpbGRDb250ZXgpO1xuXG4gIHZhciBDb25zdW1lciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudDIpIHtcbiAgICBPYmplY3QoX2JhYmVsX3J1bnRpbWVfaGVscGVyc19lc21faW5oZXJpdHNMb29zZV9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fWy8qIGRlZmF1bHQgKi8gXCJhXCJdKShDb25zdW1lciwgX0NvbXBvbmVudDIpO1xuXG4gICAgZnVuY3Rpb24gQ29uc3VtZXIoKSB7XG4gICAgICB2YXIgX3RoaXMyO1xuXG4gICAgICBfdGhpczIgPSBfQ29tcG9uZW50Mi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICBfdGhpczIuc3RhdGUgPSB7XG4gICAgICAgIHZhbHVlOiBfdGhpczIuZ2V0VmFsdWUoKVxuICAgICAgfTtcblxuICAgICAgX3RoaXMyLm9uVXBkYXRlID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBjaGFuZ2VkQml0cykge1xuICAgICAgICB2YXIgb2JzZXJ2ZWRCaXRzID0gX3RoaXMyLm9ic2VydmVkQml0cyB8IDA7XG5cbiAgICAgICAgaWYgKChvYnNlcnZlZEJpdHMgJiBjaGFuZ2VkQml0cykgIT09IDApIHtcbiAgICAgICAgICBfdGhpczIuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmFsdWU6IF90aGlzMi5nZXRWYWx1ZSgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBfdGhpczI7XG4gICAgfVxuXG4gICAgdmFyIF9wcm90bzIgPSBDb25zdW1lci5wcm90b3R5cGU7XG5cbiAgICBfcHJvdG8yLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgdmFyIG9ic2VydmVkQml0cyA9IG5leHRQcm9wcy5vYnNlcnZlZEJpdHM7XG4gICAgICB0aGlzLm9ic2VydmVkQml0cyA9IG9ic2VydmVkQml0cyA9PT0gdW5kZWZpbmVkIHx8IG9ic2VydmVkQml0cyA9PT0gbnVsbCA/IE1BWF9TSUdORURfMzFfQklUX0lOVCA6IG9ic2VydmVkQml0cztcbiAgICB9O1xuXG4gICAgX3Byb3RvMi5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgaWYgKHRoaXMuY29udGV4dFtjb250ZXh0UHJvcF0pIHtcbiAgICAgICAgdGhpcy5jb250ZXh0W2NvbnRleHRQcm9wXS5vbih0aGlzLm9uVXBkYXRlKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG9ic2VydmVkQml0cyA9IHRoaXMucHJvcHMub2JzZXJ2ZWRCaXRzO1xuICAgICAgdGhpcy5vYnNlcnZlZEJpdHMgPSBvYnNlcnZlZEJpdHMgPT09IHVuZGVmaW5lZCB8fCBvYnNlcnZlZEJpdHMgPT09IG51bGwgPyBNQVhfU0lHTkVEXzMxX0JJVF9JTlQgOiBvYnNlcnZlZEJpdHM7XG4gICAgfTtcblxuICAgIF9wcm90bzIuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIGlmICh0aGlzLmNvbnRleHRbY29udGV4dFByb3BdKSB7XG4gICAgICAgIHRoaXMuY29udGV4dFtjb250ZXh0UHJvcF0ub2ZmKHRoaXMub25VcGRhdGUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBfcHJvdG8yLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgICBpZiAodGhpcy5jb250ZXh0W2NvbnRleHRQcm9wXSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZXh0W2NvbnRleHRQcm9wXS5nZXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9wcm90bzIucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgcmV0dXJuIG9ubHlDaGlsZCh0aGlzLnByb3BzLmNoaWxkcmVuKSh0aGlzLnN0YXRlLnZhbHVlKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIENvbnN1bWVyO1xuICB9KHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19bXCJDb21wb25lbnRcIl0pO1xuXG4gIENvbnN1bWVyLmNvbnRleHRUeXBlcyA9IChfQ29uc3VtZXIkY29udGV4dFR5cGUgPSB7fSwgX0NvbnN1bWVyJGNvbnRleHRUeXBlW2NvbnRleHRQcm9wXSA9IHByb3BfdHlwZXNfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfX19kZWZhdWx0LmEub2JqZWN0LCBfQ29uc3VtZXIkY29udGV4dFR5cGUpO1xuICByZXR1cm4ge1xuICAgIFByb3ZpZGVyOiBQcm92aWRlcixcbiAgICBDb25zdW1lcjogQ29uc3VtZXJcbiAgfTtcbn1cblxudmFyIGluZGV4ID0gcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX19kZWZhdWx0LmEuY3JlYXRlQ29udGV4dCB8fCBjcmVhdGVSZWFjdENvbnRleHQ7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1tcImFcIl0gPSAoaW5kZXgpO1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzICovIDE0KSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9taW5pLWNyZWF0ZS1yZWFjdC1jb250ZXh0L2Rpc3QvZXNtL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCJ2YXIgaXNhcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGlzYXJyYXkgKi8gNzUpXG5cbi8qKlxuICogRXhwb3NlIGBwYXRoVG9SZWdleHBgLlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IHBhdGhUb1JlZ2V4cFxubW9kdWxlLmV4cG9ydHMucGFyc2UgPSBwYXJzZVxubW9kdWxlLmV4cG9ydHMuY29tcGlsZSA9IGNvbXBpbGVcbm1vZHVsZS5leHBvcnRzLnRva2Vuc1RvRnVuY3Rpb24gPSB0b2tlbnNUb0Z1bmN0aW9uXG5tb2R1bGUuZXhwb3J0cy50b2tlbnNUb1JlZ0V4cCA9IHRva2Vuc1RvUmVnRXhwXG5cbi8qKlxuICogVGhlIG1haW4gcGF0aCBtYXRjaGluZyByZWdleHAgdXRpbGl0eS5cbiAqXG4gKiBAdHlwZSB7UmVnRXhwfVxuICovXG52YXIgUEFUSF9SRUdFWFAgPSBuZXcgUmVnRXhwKFtcbiAgLy8gTWF0Y2ggZXNjYXBlZCBjaGFyYWN0ZXJzIHRoYXQgd291bGQgb3RoZXJ3aXNlIGFwcGVhciBpbiBmdXR1cmUgbWF0Y2hlcy5cbiAgLy8gVGhpcyBhbGxvd3MgdGhlIHVzZXIgdG8gZXNjYXBlIHNwZWNpYWwgY2hhcmFjdGVycyB0aGF0IHdvbid0IHRyYW5zZm9ybS5cbiAgJyhcXFxcXFxcXC4pJyxcbiAgLy8gTWF0Y2ggRXhwcmVzcy1zdHlsZSBwYXJhbWV0ZXJzIGFuZCB1bi1uYW1lZCBwYXJhbWV0ZXJzIHdpdGggYSBwcmVmaXhcbiAgLy8gYW5kIG9wdGlvbmFsIHN1ZmZpeGVzLiBNYXRjaGVzIGFwcGVhciBhczpcbiAgLy9cbiAgLy8gXCIvOnRlc3QoXFxcXGQrKT9cIiA9PiBbXCIvXCIsIFwidGVzdFwiLCBcIlxcZCtcIiwgdW5kZWZpbmVkLCBcIj9cIiwgdW5kZWZpbmVkXVxuICAvLyBcIi9yb3V0ZShcXFxcZCspXCIgID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBcIlxcZCtcIiwgdW5kZWZpbmVkLCB1bmRlZmluZWRdXG4gIC8vIFwiLypcIiAgICAgICAgICAgID0+IFtcIi9cIiwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBcIipcIl1cbiAgJyhbXFxcXC8uXSk/KD86KD86XFxcXDooXFxcXHcrKSg/OlxcXFwoKCg/OlxcXFxcXFxcLnxbXlxcXFxcXFxcKCldKSspXFxcXCkpP3xcXFxcKCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpXSkrKVxcXFwpKShbKyo/XSk/fChcXFxcKikpJ1xuXS5qb2luKCd8JyksICdnJylcblxuLyoqXG4gKiBQYXJzZSBhIHN0cmluZyBmb3IgdGhlIHJhdyB0b2tlbnMuXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSAgc3RyXG4gKiBAcGFyYW0gIHtPYmplY3Q9fSBvcHRpb25zXG4gKiBAcmV0dXJuIHshQXJyYXl9XG4gKi9cbmZ1bmN0aW9uIHBhcnNlIChzdHIsIG9wdGlvbnMpIHtcbiAgdmFyIHRva2VucyA9IFtdXG4gIHZhciBrZXkgPSAwXG4gIHZhciBpbmRleCA9IDBcbiAgdmFyIHBhdGggPSAnJ1xuICB2YXIgZGVmYXVsdERlbGltaXRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kZWxpbWl0ZXIgfHwgJy8nXG4gIHZhciByZXNcblxuICB3aGlsZSAoKHJlcyA9IFBBVEhfUkVHRVhQLmV4ZWMoc3RyKSkgIT0gbnVsbCkge1xuICAgIHZhciBtID0gcmVzWzBdXG4gICAgdmFyIGVzY2FwZWQgPSByZXNbMV1cbiAgICB2YXIgb2Zmc2V0ID0gcmVzLmluZGV4XG4gICAgcGF0aCArPSBzdHIuc2xpY2UoaW5kZXgsIG9mZnNldClcbiAgICBpbmRleCA9IG9mZnNldCArIG0ubGVuZ3RoXG5cbiAgICAvLyBJZ25vcmUgYWxyZWFkeSBlc2NhcGVkIHNlcXVlbmNlcy5cbiAgICBpZiAoZXNjYXBlZCkge1xuICAgICAgcGF0aCArPSBlc2NhcGVkWzFdXG4gICAgICBjb250aW51ZVxuICAgIH1cblxuICAgIHZhciBuZXh0ID0gc3RyW2luZGV4XVxuICAgIHZhciBwcmVmaXggPSByZXNbMl1cbiAgICB2YXIgbmFtZSA9IHJlc1szXVxuICAgIHZhciBjYXB0dXJlID0gcmVzWzRdXG4gICAgdmFyIGdyb3VwID0gcmVzWzVdXG4gICAgdmFyIG1vZGlmaWVyID0gcmVzWzZdXG4gICAgdmFyIGFzdGVyaXNrID0gcmVzWzddXG5cbiAgICAvLyBQdXNoIHRoZSBjdXJyZW50IHBhdGggb250byB0aGUgdG9rZW5zLlxuICAgIGlmIChwYXRoKSB7XG4gICAgICB0b2tlbnMucHVzaChwYXRoKVxuICAgICAgcGF0aCA9ICcnXG4gICAgfVxuXG4gICAgdmFyIHBhcnRpYWwgPSBwcmVmaXggIT0gbnVsbCAmJiBuZXh0ICE9IG51bGwgJiYgbmV4dCAhPT0gcHJlZml4XG4gICAgdmFyIHJlcGVhdCA9IG1vZGlmaWVyID09PSAnKycgfHwgbW9kaWZpZXIgPT09ICcqJ1xuICAgIHZhciBvcHRpb25hbCA9IG1vZGlmaWVyID09PSAnPycgfHwgbW9kaWZpZXIgPT09ICcqJ1xuICAgIHZhciBkZWxpbWl0ZXIgPSByZXNbMl0gfHwgZGVmYXVsdERlbGltaXRlclxuICAgIHZhciBwYXR0ZXJuID0gY2FwdHVyZSB8fCBncm91cFxuXG4gICAgdG9rZW5zLnB1c2goe1xuICAgICAgbmFtZTogbmFtZSB8fCBrZXkrKyxcbiAgICAgIHByZWZpeDogcHJlZml4IHx8ICcnLFxuICAgICAgZGVsaW1pdGVyOiBkZWxpbWl0ZXIsXG4gICAgICBvcHRpb25hbDogb3B0aW9uYWwsXG4gICAgICByZXBlYXQ6IHJlcGVhdCxcbiAgICAgIHBhcnRpYWw6IHBhcnRpYWwsXG4gICAgICBhc3RlcmlzazogISFhc3RlcmlzayxcbiAgICAgIHBhdHRlcm46IHBhdHRlcm4gPyBlc2NhcGVHcm91cChwYXR0ZXJuKSA6IChhc3RlcmlzayA/ICcuKicgOiAnW14nICsgZXNjYXBlU3RyaW5nKGRlbGltaXRlcikgKyAnXSs/JylcbiAgICB9KVxuICB9XG5cbiAgLy8gTWF0Y2ggYW55IGNoYXJhY3RlcnMgc3RpbGwgcmVtYWluaW5nLlxuICBpZiAoaW5kZXggPCBzdHIubGVuZ3RoKSB7XG4gICAgcGF0aCArPSBzdHIuc3Vic3RyKGluZGV4KVxuICB9XG5cbiAgLy8gSWYgdGhlIHBhdGggZXhpc3RzLCBwdXNoIGl0IG9udG8gdGhlIGVuZC5cbiAgaWYgKHBhdGgpIHtcbiAgICB0b2tlbnMucHVzaChwYXRoKVxuICB9XG5cbiAgcmV0dXJuIHRva2Vuc1xufVxuXG4vKipcbiAqIENvbXBpbGUgYSBzdHJpbmcgdG8gYSB0ZW1wbGF0ZSBmdW5jdGlvbiBmb3IgdGhlIHBhdGguXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgICAgICBzdHJcbiAqIEBwYXJhbSAge09iamVjdD19ICAgICAgICAgICAgb3B0aW9uc1xuICogQHJldHVybiB7IWZ1bmN0aW9uKE9iamVjdD0sIE9iamVjdD0pfVxuICovXG5mdW5jdGlvbiBjb21waWxlIChzdHIsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIHRva2Vuc1RvRnVuY3Rpb24ocGFyc2Uoc3RyLCBvcHRpb25zKSwgb3B0aW9ucylcbn1cblxuLyoqXG4gKiBQcmV0dGllciBlbmNvZGluZyBvZiBVUkkgcGF0aCBzZWdtZW50cy5cbiAqXG4gKiBAcGFyYW0gIHtzdHJpbmd9XG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGVuY29kZVVSSUNvbXBvbmVudFByZXR0eSAoc3RyKSB7XG4gIHJldHVybiBlbmNvZGVVUkkoc3RyKS5yZXBsYWNlKC9bXFwvPyNdL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgcmV0dXJuICclJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKVxuICB9KVxufVxuXG4vKipcbiAqIEVuY29kZSB0aGUgYXN0ZXJpc2sgcGFyYW1ldGVyLiBTaW1pbGFyIHRvIGBwcmV0dHlgLCBidXQgYWxsb3dzIHNsYXNoZXMuXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfVxuICogQHJldHVybiB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBlbmNvZGVBc3RlcmlzayAoc3RyKSB7XG4gIHJldHVybiBlbmNvZGVVUkkoc3RyKS5yZXBsYWNlKC9bPyNdL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgcmV0dXJuICclJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKVxuICB9KVxufVxuXG4vKipcbiAqIEV4cG9zZSBhIG1ldGhvZCBmb3IgdHJhbnNmb3JtaW5nIHRva2VucyBpbnRvIHRoZSBwYXRoIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiB0b2tlbnNUb0Z1bmN0aW9uICh0b2tlbnMsIG9wdGlvbnMpIHtcbiAgLy8gQ29tcGlsZSBhbGwgdGhlIHRva2VucyBpbnRvIHJlZ2V4cHMuXG4gIHZhciBtYXRjaGVzID0gbmV3IEFycmF5KHRva2Vucy5sZW5ndGgpXG5cbiAgLy8gQ29tcGlsZSBhbGwgdGhlIHBhdHRlcm5zIGJlZm9yZSBjb21waWxhdGlvbi5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodHlwZW9mIHRva2Vuc1tpXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIG1hdGNoZXNbaV0gPSBuZXcgUmVnRXhwKCdeKD86JyArIHRva2Vuc1tpXS5wYXR0ZXJuICsgJykkJywgZmxhZ3Mob3B0aW9ucykpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIChvYmosIG9wdHMpIHtcbiAgICB2YXIgcGF0aCA9ICcnXG4gICAgdmFyIGRhdGEgPSBvYmogfHwge31cbiAgICB2YXIgb3B0aW9ucyA9IG9wdHMgfHwge31cbiAgICB2YXIgZW5jb2RlID0gb3B0aW9ucy5wcmV0dHkgPyBlbmNvZGVVUklDb21wb25lbnRQcmV0dHkgOiBlbmNvZGVVUklDb21wb25lbnRcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV1cblxuICAgICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcGF0aCArPSB0b2tlblxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIHZhciB2YWx1ZSA9IGRhdGFbdG9rZW4ubmFtZV1cbiAgICAgIHZhciBzZWdtZW50XG5cbiAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICAgIGlmICh0b2tlbi5vcHRpb25hbCkge1xuICAgICAgICAgIC8vIFByZXBlbmQgcGFydGlhbCBzZWdtZW50IHByZWZpeGVzLlxuICAgICAgICAgIGlmICh0b2tlbi5wYXJ0aWFsKSB7XG4gICAgICAgICAgICBwYXRoICs9IHRva2VuLnByZWZpeFxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBiZSBkZWZpbmVkJylcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaXNhcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgaWYgKCF0b2tlbi5yZXBlYXQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBcIicgKyB0b2tlbi5uYW1lICsgJ1wiIHRvIG5vdCByZXBlYXQsIGJ1dCByZWNlaXZlZCBgJyArIEpTT04uc3RyaW5naWZ5KHZhbHVlKSArICdgJylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gbm90IGJlIGVtcHR5JylcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZhbHVlLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgc2VnbWVudCA9IGVuY29kZSh2YWx1ZVtqXSlcblxuICAgICAgICAgIGlmICghbWF0Y2hlc1tpXS50ZXN0KHNlZ21lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBhbGwgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBtYXRjaCBcIicgKyB0b2tlbi5wYXR0ZXJuICsgJ1wiLCBidXQgcmVjZWl2ZWQgYCcgKyBKU09OLnN0cmluZ2lmeShzZWdtZW50KSArICdgJylcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwYXRoICs9IChqID09PSAwID8gdG9rZW4ucHJlZml4IDogdG9rZW4uZGVsaW1pdGVyKSArIHNlZ21lbnRcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIHNlZ21lbnQgPSB0b2tlbi5hc3RlcmlzayA/IGVuY29kZUFzdGVyaXNrKHZhbHVlKSA6IGVuY29kZSh2YWx1ZSlcblxuICAgICAgaWYgKCFtYXRjaGVzW2ldLnRlc3Qoc2VnbWVudCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRXhwZWN0ZWQgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBtYXRjaCBcIicgKyB0b2tlbi5wYXR0ZXJuICsgJ1wiLCBidXQgcmVjZWl2ZWQgXCInICsgc2VnbWVudCArICdcIicpXG4gICAgICB9XG5cbiAgICAgIHBhdGggKz0gdG9rZW4ucHJlZml4ICsgc2VnbWVudFxuICAgIH1cblxuICAgIHJldHVybiBwYXRoXG4gIH1cbn1cblxuLyoqXG4gKiBFc2NhcGUgYSByZWd1bGFyIGV4cHJlc3Npb24gc3RyaW5nLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gc3RyXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGVzY2FwZVN0cmluZyAoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvKFsuKyo/PV4hOiR7fSgpW1xcXXxcXC9cXFxcXSkvZywgJ1xcXFwkMScpXG59XG5cbi8qKlxuICogRXNjYXBlIHRoZSBjYXB0dXJpbmcgZ3JvdXAgYnkgZXNjYXBpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBtZWFuaW5nLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gZ3JvdXBcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gZXNjYXBlR3JvdXAgKGdyb3VwKSB7XG4gIHJldHVybiBncm91cC5yZXBsYWNlKC8oWz0hOiRcXC8oKV0pL2csICdcXFxcJDEnKVxufVxuXG4vKipcbiAqIEF0dGFjaCB0aGUga2V5cyBhcyBhIHByb3BlcnR5IG9mIHRoZSByZWdleHAuXG4gKlxuICogQHBhcmFtICB7IVJlZ0V4cH0gcmVcbiAqIEBwYXJhbSAge0FycmF5fSAgIGtleXNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIGF0dGFjaEtleXMgKHJlLCBrZXlzKSB7XG4gIHJlLmtleXMgPSBrZXlzXG4gIHJldHVybiByZVxufVxuXG4vKipcbiAqIEdldCB0aGUgZmxhZ3MgZm9yIGEgcmVnZXhwIGZyb20gdGhlIG9wdGlvbnMuXG4gKlxuICogQHBhcmFtICB7T2JqZWN0fSBvcHRpb25zXG4gKiBAcmV0dXJuIHtzdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIGZsYWdzIChvcHRpb25zKSB7XG4gIHJldHVybiBvcHRpb25zICYmIG9wdGlvbnMuc2Vuc2l0aXZlID8gJycgOiAnaSdcbn1cblxuLyoqXG4gKiBQdWxsIG91dCBrZXlzIGZyb20gYSByZWdleHAuXG4gKlxuICogQHBhcmFtICB7IVJlZ0V4cH0gcGF0aFxuICogQHBhcmFtICB7IUFycmF5fSAga2V5c1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gcmVnZXhwVG9SZWdleHAgKHBhdGgsIGtleXMpIHtcbiAgLy8gVXNlIGEgbmVnYXRpdmUgbG9va2FoZWFkIHRvIG1hdGNoIG9ubHkgY2FwdHVyaW5nIGdyb3Vwcy5cbiAgdmFyIGdyb3VwcyA9IHBhdGguc291cmNlLm1hdGNoKC9cXCgoPyFcXD8pL2cpXG5cbiAgaWYgKGdyb3Vwcykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXlzLnB1c2goe1xuICAgICAgICBuYW1lOiBpLFxuICAgICAgICBwcmVmaXg6IG51bGwsXG4gICAgICAgIGRlbGltaXRlcjogbnVsbCxcbiAgICAgICAgb3B0aW9uYWw6IGZhbHNlLFxuICAgICAgICByZXBlYXQ6IGZhbHNlLFxuICAgICAgICBwYXJ0aWFsOiBmYWxzZSxcbiAgICAgICAgYXN0ZXJpc2s6IGZhbHNlLFxuICAgICAgICBwYXR0ZXJuOiBudWxsXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhdHRhY2hLZXlzKHBhdGgsIGtleXMpXG59XG5cbi8qKlxuICogVHJhbnNmb3JtIGFuIGFycmF5IGludG8gYSByZWdleHAuXG4gKlxuICogQHBhcmFtICB7IUFycmF5fSAgcGF0aFxuICogQHBhcmFtICB7QXJyYXl9ICAga2V5c1xuICogQHBhcmFtICB7IU9iamVjdH0gb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gYXJyYXlUb1JlZ2V4cCAocGF0aCwga2V5cywgb3B0aW9ucykge1xuICB2YXIgcGFydHMgPSBbXVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgIHBhcnRzLnB1c2gocGF0aFRvUmVnZXhwKHBhdGhbaV0sIGtleXMsIG9wdGlvbnMpLnNvdXJjZSlcbiAgfVxuXG4gIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKCcoPzonICsgcGFydHMuam9pbignfCcpICsgJyknLCBmbGFncyhvcHRpb25zKSlcblxuICByZXR1cm4gYXR0YWNoS2V5cyhyZWdleHAsIGtleXMpXG59XG5cbi8qKlxuICogQ3JlYXRlIGEgcGF0aCByZWdleHAgZnJvbSBzdHJpbmcgaW5wdXQuXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSAgcGF0aFxuICogQHBhcmFtICB7IUFycmF5fSAga2V5c1xuICogQHBhcmFtICB7IU9iamVjdH0gb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gc3RyaW5nVG9SZWdleHAgKHBhdGgsIGtleXMsIG9wdGlvbnMpIHtcbiAgcmV0dXJuIHRva2Vuc1RvUmVnRXhwKHBhcnNlKHBhdGgsIG9wdGlvbnMpLCBrZXlzLCBvcHRpb25zKVxufVxuXG4vKipcbiAqIEV4cG9zZSBhIGZ1bmN0aW9uIGZvciB0YWtpbmcgdG9rZW5zIGFuZCByZXR1cm5pbmcgYSBSZWdFeHAuXG4gKlxuICogQHBhcmFtICB7IUFycmF5fSAgICAgICAgICB0b2tlbnNcbiAqIEBwYXJhbSAgeyhBcnJheXxPYmplY3QpPX0ga2V5c1xuICogQHBhcmFtICB7T2JqZWN0PX0gICAgICAgICBvcHRpb25zXG4gKiBAcmV0dXJuIHshUmVnRXhwfVxuICovXG5mdW5jdGlvbiB0b2tlbnNUb1JlZ0V4cCAodG9rZW5zLCBrZXlzLCBvcHRpb25zKSB7XG4gIGlmICghaXNhcnJheShrZXlzKSkge1xuICAgIG9wdGlvbnMgPSAvKiogQHR5cGUgeyFPYmplY3R9ICovIChrZXlzIHx8IG9wdGlvbnMpXG4gICAga2V5cyA9IFtdXG4gIH1cblxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fVxuXG4gIHZhciBzdHJpY3QgPSBvcHRpb25zLnN0cmljdFxuICB2YXIgZW5kID0gb3B0aW9ucy5lbmQgIT09IGZhbHNlXG4gIHZhciByb3V0ZSA9ICcnXG5cbiAgLy8gSXRlcmF0ZSBvdmVyIHRoZSB0b2tlbnMgYW5kIGNyZWF0ZSBvdXIgcmVnZXhwIHN0cmluZy5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV1cblxuICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICByb3V0ZSArPSBlc2NhcGVTdHJpbmcodG9rZW4pXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBwcmVmaXggPSBlc2NhcGVTdHJpbmcodG9rZW4ucHJlZml4KVxuICAgICAgdmFyIGNhcHR1cmUgPSAnKD86JyArIHRva2VuLnBhdHRlcm4gKyAnKSdcblxuICAgICAga2V5cy5wdXNoKHRva2VuKVxuXG4gICAgICBpZiAodG9rZW4ucmVwZWF0KSB7XG4gICAgICAgIGNhcHR1cmUgKz0gJyg/OicgKyBwcmVmaXggKyBjYXB0dXJlICsgJykqJ1xuICAgICAgfVxuXG4gICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHtcbiAgICAgICAgaWYgKCF0b2tlbi5wYXJ0aWFsKSB7XG4gICAgICAgICAgY2FwdHVyZSA9ICcoPzonICsgcHJlZml4ICsgJygnICsgY2FwdHVyZSArICcpKT8nXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FwdHVyZSA9IHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKT8nXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhcHR1cmUgPSBwcmVmaXggKyAnKCcgKyBjYXB0dXJlICsgJyknXG4gICAgICB9XG5cbiAgICAgIHJvdXRlICs9IGNhcHR1cmVcbiAgICB9XG4gIH1cblxuICB2YXIgZGVsaW1pdGVyID0gZXNjYXBlU3RyaW5nKG9wdGlvbnMuZGVsaW1pdGVyIHx8ICcvJylcbiAgdmFyIGVuZHNXaXRoRGVsaW1pdGVyID0gcm91dGUuc2xpY2UoLWRlbGltaXRlci5sZW5ndGgpID09PSBkZWxpbWl0ZXJcblxuICAvLyBJbiBub24tc3RyaWN0IG1vZGUgd2UgYWxsb3cgYSBzbGFzaCBhdCB0aGUgZW5kIG9mIG1hdGNoLiBJZiB0aGUgcGF0aCB0b1xuICAvLyBtYXRjaCBhbHJlYWR5IGVuZHMgd2l0aCBhIHNsYXNoLCB3ZSByZW1vdmUgaXQgZm9yIGNvbnNpc3RlbmN5LiBUaGUgc2xhc2hcbiAgLy8gaXMgdmFsaWQgYXQgdGhlIGVuZCBvZiBhIHBhdGggbWF0Y2gsIG5vdCBpbiB0aGUgbWlkZGxlLiBUaGlzIGlzIGltcG9ydGFudFxuICAvLyBpbiBub24tZW5kaW5nIG1vZGUsIHdoZXJlIFwiL3Rlc3QvXCIgc2hvdWxkbid0IG1hdGNoIFwiL3Rlc3QvL3JvdXRlXCIuXG4gIGlmICghc3RyaWN0KSB7XG4gICAgcm91dGUgPSAoZW5kc1dpdGhEZWxpbWl0ZXIgPyByb3V0ZS5zbGljZSgwLCAtZGVsaW1pdGVyLmxlbmd0aCkgOiByb3V0ZSkgKyAnKD86JyArIGRlbGltaXRlciArICcoPz0kKSk/J1xuICB9XG5cbiAgaWYgKGVuZCkge1xuICAgIHJvdXRlICs9ICckJ1xuICB9IGVsc2Uge1xuICAgIC8vIEluIG5vbi1lbmRpbmcgbW9kZSwgd2UgbmVlZCB0aGUgY2FwdHVyaW5nIGdyb3VwcyB0byBtYXRjaCBhcyBtdWNoIGFzXG4gICAgLy8gcG9zc2libGUgYnkgdXNpbmcgYSBwb3NpdGl2ZSBsb29rYWhlYWQgdG8gdGhlIGVuZCBvciBuZXh0IHBhdGggc2VnbWVudC5cbiAgICByb3V0ZSArPSBzdHJpY3QgJiYgZW5kc1dpdGhEZWxpbWl0ZXIgPyAnJyA6ICcoPz0nICsgZGVsaW1pdGVyICsgJ3wkKSdcbiAgfVxuXG4gIHJldHVybiBhdHRhY2hLZXlzKG5ldyBSZWdFeHAoJ14nICsgcm91dGUsIGZsYWdzKG9wdGlvbnMpKSwga2V5cylcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgdGhlIGdpdmVuIHBhdGggc3RyaW5nLCByZXR1cm5pbmcgYSByZWd1bGFyIGV4cHJlc3Npb24uXG4gKlxuICogQW4gZW1wdHkgYXJyYXkgY2FuIGJlIHBhc3NlZCBpbiBmb3IgdGhlIGtleXMsIHdoaWNoIHdpbGwgaG9sZCB0aGVcbiAqIHBsYWNlaG9sZGVyIGtleSBkZXNjcmlwdGlvbnMuIEZvciBleGFtcGxlLCB1c2luZyBgL3VzZXIvOmlkYCwgYGtleXNgIHdpbGxcbiAqIGNvbnRhaW4gYFt7IG5hbWU6ICdpZCcsIGRlbGltaXRlcjogJy8nLCBvcHRpb25hbDogZmFsc2UsIHJlcGVhdDogZmFsc2UgfV1gLlxuICpcbiAqIEBwYXJhbSAgeyhzdHJpbmd8UmVnRXhwfEFycmF5KX0gcGF0aFxuICogQHBhcmFtICB7KEFycmF5fE9iamVjdCk9fSAgICAgICBrZXlzXG4gKiBAcGFyYW0gIHtPYmplY3Q9fSAgICAgICAgICAgICAgIG9wdGlvbnNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIHBhdGhUb1JlZ2V4cCAocGF0aCwga2V5cywgb3B0aW9ucykge1xuICBpZiAoIWlzYXJyYXkoa2V5cykpIHtcbiAgICBvcHRpb25zID0gLyoqIEB0eXBlIHshT2JqZWN0fSAqLyAoa2V5cyB8fCBvcHRpb25zKVxuICAgIGtleXMgPSBbXVxuICB9XG5cbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge31cblxuICBpZiAocGF0aCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgIHJldHVybiByZWdleHBUb1JlZ2V4cChwYXRoLCAvKiogQHR5cGUgeyFBcnJheX0gKi8gKGtleXMpKVxuICB9XG5cbiAgaWYgKGlzYXJyYXkocGF0aCkpIHtcbiAgICByZXR1cm4gYXJyYXlUb1JlZ2V4cCgvKiogQHR5cGUgeyFBcnJheX0gKi8gKHBhdGgpLCAvKiogQHR5cGUgeyFBcnJheX0gKi8gKGtleXMpLCBvcHRpb25zKVxuICB9XG5cbiAgcmV0dXJuIHN0cmluZ1RvUmVnZXhwKC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAocGF0aCksIC8qKiBAdHlwZSB7IUFycmF5fSAqLyAoa2V5cyksIG9wdGlvbnMpXG59XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3BhdGgtdG8tcmVnZXhwL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgnXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AZW1vdGlvbi9tZW1vaXplL2Rpc3QvbWVtb2l6ZS5icm93c2VyLmVzbS5qc1xuZnVuY3Rpb24gbWVtb2l6ZShmbikge1xuICB2YXIgY2FjaGUgPSB7fTtcbiAgcmV0dXJuIGZ1bmN0aW9uIChhcmcpIHtcbiAgICBpZiAoY2FjaGVbYXJnXSA9PT0gdW5kZWZpbmVkKSBjYWNoZVthcmddID0gZm4oYXJnKTtcbiAgICByZXR1cm4gY2FjaGVbYXJnXTtcbiAgfTtcbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbWVtb2l6ZV9icm93c2VyX2VzbSA9IChtZW1vaXplKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGVtb3Rpb24vaXMtcHJvcC12YWxpZC9kaXN0L2lzLXByb3AtdmFsaWQuYnJvd3Nlci5lc20uanNcblxuXG52YXIgcmVhY3RQcm9wc1JlZ2V4ID0gL14oKGNoaWxkcmVufGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MfGtleXxyZWZ8YXV0b0ZvY3VzfGRlZmF1bHRWYWx1ZXxkZWZhdWx0Q2hlY2tlZHxpbm5lckhUTUx8c3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nfHN1cHByZXNzSHlkcmF0aW9uV2FybmluZ3x2YWx1ZUxpbmt8YWNjZXB0fGFjY2VwdENoYXJzZXR8YWNjZXNzS2V5fGFjdGlvbnxhbGxvd3xhbGxvd1VzZXJNZWRpYXxhbGxvd1BheW1lbnRSZXF1ZXN0fGFsbG93RnVsbFNjcmVlbnxhbGxvd1RyYW5zcGFyZW5jeXxhbHR8YXN5bmN8YXV0b0NvbXBsZXRlfGF1dG9QbGF5fGNhcHR1cmV8Y2VsbFBhZGRpbmd8Y2VsbFNwYWNpbmd8Y2hhbGxlbmdlfGNoYXJTZXR8Y2hlY2tlZHxjaXRlfGNsYXNzSUR8Y2xhc3NOYW1lfGNvbHN8Y29sU3Bhbnxjb250ZW50fGNvbnRlbnRFZGl0YWJsZXxjb250ZXh0TWVudXxjb250cm9sc3xjb250cm9sc0xpc3R8Y29vcmRzfGNyb3NzT3JpZ2lufGRhdGF8ZGF0ZVRpbWV8ZGVjb2Rpbmd8ZGVmYXVsdHxkZWZlcnxkaXJ8ZGlzYWJsZWR8ZGlzYWJsZVBpY3R1cmVJblBpY3R1cmV8ZG93bmxvYWR8ZHJhZ2dhYmxlfGVuY1R5cGV8Zm9ybXxmb3JtQWN0aW9ufGZvcm1FbmNUeXBlfGZvcm1NZXRob2R8Zm9ybU5vVmFsaWRhdGV8Zm9ybVRhcmdldHxmcmFtZUJvcmRlcnxoZWFkZXJzfGhlaWdodHxoaWRkZW58aGlnaHxocmVmfGhyZWZMYW5nfGh0bWxGb3J8aHR0cEVxdWl2fGlkfGlucHV0TW9kZXxpbnRlZ3JpdHl8aXN8a2V5UGFyYW1zfGtleVR5cGV8a2luZHxsYWJlbHxsYW5nfGxpc3R8bG9hZGluZ3xsb29wfGxvd3xtYXJnaW5IZWlnaHR8bWFyZ2luV2lkdGh8bWF4fG1heExlbmd0aHxtZWRpYXxtZWRpYUdyb3VwfG1ldGhvZHxtaW58bWluTGVuZ3RofG11bHRpcGxlfG11dGVkfG5hbWV8bm9uY2V8bm9WYWxpZGF0ZXxvcGVufG9wdGltdW18cGF0dGVybnxwbGFjZWhvbGRlcnxwbGF5c0lubGluZXxwb3N0ZXJ8cHJlbG9hZHxwcm9maWxlfHJhZGlvR3JvdXB8cmVhZE9ubHl8cmVmZXJyZXJQb2xpY3l8cmVsfHJlcXVpcmVkfHJldmVyc2VkfHJvbGV8cm93c3xyb3dTcGFufHNhbmRib3h8c2NvcGV8c2NvcGVkfHNjcm9sbGluZ3xzZWFtbGVzc3xzZWxlY3RlZHxzaGFwZXxzaXplfHNpemVzfHNsb3R8c3BhbnxzcGVsbENoZWNrfHNyY3xzcmNEb2N8c3JjTGFuZ3xzcmNTZXR8c3RhcnR8c3RlcHxzdHlsZXxzdW1tYXJ5fHRhYkluZGV4fHRhcmdldHx0aXRsZXx0eXBlfHVzZU1hcHx2YWx1ZXx3aWR0aHx3bW9kZXx3cmFwfGFib3V0fGRhdGF0eXBlfGlubGlzdHxwcmVmaXh8cHJvcGVydHl8cmVzb3VyY2V8dHlwZW9mfHZvY2FifGF1dG9DYXBpdGFsaXplfGF1dG9Db3JyZWN0fGF1dG9TYXZlfGNvbG9yfGluZXJ0fGl0ZW1Qcm9wfGl0ZW1TY29wZXxpdGVtVHlwZXxpdGVtSUR8aXRlbVJlZnxvbnxyZXN1bHRzfHNlY3VyaXR5fHVuc2VsZWN0YWJsZXxhY2NlbnRIZWlnaHR8YWNjdW11bGF0ZXxhZGRpdGl2ZXxhbGlnbm1lbnRCYXNlbGluZXxhbGxvd1Jlb3JkZXJ8YWxwaGFiZXRpY3xhbXBsaXR1ZGV8YXJhYmljRm9ybXxhc2NlbnR8YXR0cmlidXRlTmFtZXxhdHRyaWJ1dGVUeXBlfGF1dG9SZXZlcnNlfGF6aW11dGh8YmFzZUZyZXF1ZW5jeXxiYXNlbGluZVNoaWZ0fGJhc2VQcm9maWxlfGJib3h8YmVnaW58Ymlhc3xieXxjYWxjTW9kZXxjYXBIZWlnaHR8Y2xpcHxjbGlwUGF0aFVuaXRzfGNsaXBQYXRofGNsaXBSdWxlfGNvbG9ySW50ZXJwb2xhdGlvbnxjb2xvckludGVycG9sYXRpb25GaWx0ZXJzfGNvbG9yUHJvZmlsZXxjb2xvclJlbmRlcmluZ3xjb250ZW50U2NyaXB0VHlwZXxjb250ZW50U3R5bGVUeXBlfGN1cnNvcnxjeHxjeXxkfGRlY2VsZXJhdGV8ZGVzY2VudHxkaWZmdXNlQ29uc3RhbnR8ZGlyZWN0aW9ufGRpc3BsYXl8ZGl2aXNvcnxkb21pbmFudEJhc2VsaW5lfGR1cnxkeHxkeXxlZGdlTW9kZXxlbGV2YXRpb258ZW5hYmxlQmFja2dyb3VuZHxlbmR8ZXhwb25lbnR8ZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZHxmaWxsfGZpbGxPcGFjaXR5fGZpbGxSdWxlfGZpbHRlcnxmaWx0ZXJSZXN8ZmlsdGVyVW5pdHN8Zmxvb2RDb2xvcnxmbG9vZE9wYWNpdHl8Zm9jdXNhYmxlfGZvbnRGYW1pbHl8Zm9udFNpemV8Zm9udFNpemVBZGp1c3R8Zm9udFN0cmV0Y2h8Zm9udFN0eWxlfGZvbnRWYXJpYW50fGZvbnRXZWlnaHR8Zm9ybWF0fGZyb218ZnJ8Znh8Znl8ZzF8ZzJ8Z2x5cGhOYW1lfGdseXBoT3JpZW50YXRpb25Ib3Jpem9udGFsfGdseXBoT3JpZW50YXRpb25WZXJ0aWNhbHxnbHlwaFJlZnxncmFkaWVudFRyYW5zZm9ybXxncmFkaWVudFVuaXRzfGhhbmdpbmd8aG9yaXpBZHZYfGhvcml6T3JpZ2luWHxpZGVvZ3JhcGhpY3xpbWFnZVJlbmRlcmluZ3xpbnxpbjJ8aW50ZXJjZXB0fGt8azF8azJ8azN8azR8a2VybmVsTWF0cml4fGtlcm5lbFVuaXRMZW5ndGh8a2VybmluZ3xrZXlQb2ludHN8a2V5U3BsaW5lc3xrZXlUaW1lc3xsZW5ndGhBZGp1c3R8bGV0dGVyU3BhY2luZ3xsaWdodGluZ0NvbG9yfGxpbWl0aW5nQ29uZUFuZ2xlfGxvY2FsfG1hcmtlckVuZHxtYXJrZXJNaWR8bWFya2VyU3RhcnR8bWFya2VySGVpZ2h0fG1hcmtlclVuaXRzfG1hcmtlcldpZHRofG1hc2t8bWFza0NvbnRlbnRVbml0c3xtYXNrVW5pdHN8bWF0aGVtYXRpY2FsfG1vZGV8bnVtT2N0YXZlc3xvZmZzZXR8b3BhY2l0eXxvcGVyYXRvcnxvcmRlcnxvcmllbnR8b3JpZW50YXRpb258b3JpZ2lufG92ZXJmbG93fG92ZXJsaW5lUG9zaXRpb258b3ZlcmxpbmVUaGlja25lc3N8cGFub3NlMXxwYWludE9yZGVyfHBhdGhMZW5ndGh8cGF0dGVybkNvbnRlbnRVbml0c3xwYXR0ZXJuVHJhbnNmb3JtfHBhdHRlcm5Vbml0c3xwb2ludGVyRXZlbnRzfHBvaW50c3xwb2ludHNBdFh8cG9pbnRzQXRZfHBvaW50c0F0WnxwcmVzZXJ2ZUFscGhhfHByZXNlcnZlQXNwZWN0UmF0aW98cHJpbWl0aXZlVW5pdHN8cnxyYWRpdXN8cmVmWHxyZWZZfHJlbmRlcmluZ0ludGVudHxyZXBlYXRDb3VudHxyZXBlYXREdXJ8cmVxdWlyZWRFeHRlbnNpb25zfHJlcXVpcmVkRmVhdHVyZXN8cmVzdGFydHxyZXN1bHR8cm90YXRlfHJ4fHJ5fHNjYWxlfHNlZWR8c2hhcGVSZW5kZXJpbmd8c2xvcGV8c3BhY2luZ3xzcGVjdWxhckNvbnN0YW50fHNwZWN1bGFyRXhwb25lbnR8c3BlZWR8c3ByZWFkTWV0aG9kfHN0YXJ0T2Zmc2V0fHN0ZERldmlhdGlvbnxzdGVtaHxzdGVtdnxzdGl0Y2hUaWxlc3xzdG9wQ29sb3J8c3RvcE9wYWNpdHl8c3RyaWtldGhyb3VnaFBvc2l0aW9ufHN0cmlrZXRocm91Z2hUaGlja25lc3N8c3RyaW5nfHN0cm9rZXxzdHJva2VEYXNoYXJyYXl8c3Ryb2tlRGFzaG9mZnNldHxzdHJva2VMaW5lY2FwfHN0cm9rZUxpbmVqb2lufHN0cm9rZU1pdGVybGltaXR8c3Ryb2tlT3BhY2l0eXxzdHJva2VXaWR0aHxzdXJmYWNlU2NhbGV8c3lzdGVtTGFuZ3VhZ2V8dGFibGVWYWx1ZXN8dGFyZ2V0WHx0YXJnZXRZfHRleHRBbmNob3J8dGV4dERlY29yYXRpb258dGV4dFJlbmRlcmluZ3x0ZXh0TGVuZ3RofHRvfHRyYW5zZm9ybXx1MXx1Mnx1bmRlcmxpbmVQb3NpdGlvbnx1bmRlcmxpbmVUaGlja25lc3N8dW5pY29kZXx1bmljb2RlQmlkaXx1bmljb2RlUmFuZ2V8dW5pdHNQZXJFbXx2QWxwaGFiZXRpY3x2SGFuZ2luZ3x2SWRlb2dyYXBoaWN8dk1hdGhlbWF0aWNhbHx2YWx1ZXN8dmVjdG9yRWZmZWN0fHZlcnNpb258dmVydEFkdll8dmVydE9yaWdpblh8dmVydE9yaWdpbll8dmlld0JveHx2aWV3VGFyZ2V0fHZpc2liaWxpdHl8d2lkdGhzfHdvcmRTcGFjaW5nfHdyaXRpbmdNb2RlfHh8eEhlaWdodHx4MXx4Mnx4Q2hhbm5lbFNlbGVjdG9yfHhsaW5rQWN0dWF0ZXx4bGlua0FyY3JvbGV8eGxpbmtIcmVmfHhsaW5rUm9sZXx4bGlua1Nob3d8eGxpbmtUaXRsZXx4bGlua1R5cGV8eG1sQmFzZXx4bWxuc3x4bWxuc1hsaW5rfHhtbExhbmd8eG1sU3BhY2V8eXx5MXx5Mnx5Q2hhbm5lbFNlbGVjdG9yfHp8em9vbUFuZFBhbnxmb3J8Y2xhc3N8YXV0b2ZvY3VzKXwoKFtEZF1bQWFdW1R0XVtBYV18W0FhXVtScl1bSWldW0FhXXx4KS0uKikpJC87IC8vIGh0dHBzOi8vZXNiZW5jaC5jb20vYmVuY2gvNWJmZWU2OGE0Y2Q3ZTYwMDllZjYxZDIzXG5cbnZhciBpbmRleCA9IG1lbW9pemVfYnJvd3Nlcl9lc20oZnVuY3Rpb24gKHByb3ApIHtcbiAgcmV0dXJuIHJlYWN0UHJvcHNSZWdleC50ZXN0KHByb3ApIHx8IHByb3AuY2hhckNvZGVBdCgwKSA9PT0gMTExXG4gIC8qIG8gKi9cbiAgJiYgcHJvcC5jaGFyQ29kZUF0KDEpID09PSAxMTBcbiAgLyogbiAqL1xuICAmJiBwcm9wLmNoYXJDb2RlQXQoMikgPCA5MTtcbn1cbi8qIForMSAqL1xuKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgaXNfcHJvcF92YWxpZF9icm93c2VyX2VzbSA9IF9fd2VicGFja19leHBvcnRzX19bImEiXSA9IChpbmRleCk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BlbW90aW9uL2lzLXByb3AtdmFsaWQvZGlzdC9pcy1wcm9wLXZhbGlkLmJyb3dzZXIuZXNtLmpzXytfMV9tb2R1bGVzPycpfSwsZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoImxldCBsb2dnaW5nID0gZmFsc2U7XG5cbmV4cG9ydHMubG9nZ2luZyA9IGxvZ2dpbmc7XG5cbmV4cG9ydHMuc2V0TG9nZ2luZyA9IChfbG9nZ2luZykgPT4ge1xuICBsb2dnaW5nID0gX2xvZ2dpbmc7XG59O1xuXG5leHBvcnRzLmxvZyA9ICguLi5hcmdzKSA9PiAobG9nZ2luZyA/IGNvbnNvbGUubG9nLmFwcGx5KHRoaXMsIGFyZ3MpIDogbnVsbCk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy91dGlscy9sb2cuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCJtb2R1bGUuZXhwb3J0cyA9IChwcmVmaXgsIGNudCkgPT4gKFxuICBgJHtwcmVmaXh9LSR7Y250fS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDMsIDgpfWBcbik7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy91dGlscy9nZXRJZC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIi8qXG5vYmplY3QtYXNzaWduXG4oYykgU2luZHJlIFNvcmh1c1xuQGxpY2Vuc2UgTUlUXG4qL1xuXG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzICovXG52YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scztcbnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgcHJvcElzRW51bWVyYWJsZSA9IE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGU7XG5cbmZ1bmN0aW9uIHRvT2JqZWN0KHZhbCkge1xuXHRpZiAodmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignT2JqZWN0LmFzc2lnbiBjYW5ub3QgYmUgY2FsbGVkIHdpdGggbnVsbCBvciB1bmRlZmluZWQnKTtcblx0fVxuXG5cdHJldHVybiBPYmplY3QodmFsKTtcbn1cblxuZnVuY3Rpb24gc2hvdWxkVXNlTmF0aXZlKCkge1xuXHR0cnkge1xuXHRcdGlmICghT2JqZWN0LmFzc2lnbikge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIERldGVjdCBidWdneSBwcm9wZXJ0eSBlbnVtZXJhdGlvbiBvcmRlciBpbiBvbGRlciBWOCB2ZXJzaW9ucy5cblxuXHRcdC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTQxMThcblx0XHR2YXIgdGVzdDEgPSBuZXcgU3RyaW5nKCdhYmMnKTsgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3LXdyYXBwZXJzXG5cdFx0dGVzdDFbNV0gPSAnZGUnO1xuXHRcdGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0ZXN0MSlbMF0gPT09ICc1Jykge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdC8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTMwNTZcblx0XHR2YXIgdGVzdDIgPSB7fTtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcblx0XHRcdHRlc3QyWydfJyArIFN0cmluZy5mcm9tQ2hhckNvZGUoaSldID0gaTtcblx0XHR9XG5cdFx0dmFyIG9yZGVyMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRlc3QyKS5tYXAoZnVuY3Rpb24gKG4pIHtcblx0XHRcdHJldHVybiB0ZXN0MltuXTtcblx0XHR9KTtcblx0XHRpZiAob3JkZXIyLmpvaW4oJycpICE9PSAnMDEyMzQ1Njc4OScpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zMDU2XG5cdFx0dmFyIHRlc3QzID0ge307XG5cdFx0J2FiY2RlZmdoaWprbG1ub3BxcnN0Jy5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbiAobGV0dGVyKSB7XG5cdFx0XHR0ZXN0M1tsZXR0ZXJdID0gbGV0dGVyO1xuXHRcdH0pO1xuXHRcdGlmIChPYmplY3Qua2V5cyhPYmplY3QuYXNzaWduKHt9LCB0ZXN0MykpLmpvaW4oJycpICE9PVxuXHRcdFx0XHQnYWJjZGVmZ2hpamtsbW5vcHFyc3QnKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRydWU7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdC8vIFdlIGRvbid0IGV4cGVjdCBhbnkgb2YgdGhlIGFib3ZlIHRvIHRocm93LCBidXQgYmV0dGVyIHRvIGJlIHNhZmUuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gc2hvdWxkVXNlTmF0aXZlKCkgPyBPYmplY3QuYXNzaWduIDogZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG5cdHZhciBmcm9tO1xuXHR2YXIgdG8gPSB0b09iamVjdCh0YXJnZXQpO1xuXHR2YXIgc3ltYm9scztcblxuXHRmb3IgKHZhciBzID0gMTsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKykge1xuXHRcdGZyb20gPSBPYmplY3QoYXJndW1lbnRzW3NdKTtcblxuXHRcdGZvciAodmFyIGtleSBpbiBmcm9tKSB7XG5cdFx0XHRpZiAoaGFzT3duUHJvcGVydHkuY2FsbChmcm9tLCBrZXkpKSB7XG5cdFx0XHRcdHRvW2tleV0gPSBmcm9tW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKGdldE93blByb3BlcnR5U3ltYm9scykge1xuXHRcdFx0c3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9scyhmcm9tKTtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZiAocHJvcElzRW51bWVyYWJsZS5jYWxsKGZyb20sIHN5bWJvbHNbaV0pKSB7XG5cdFx0XHRcdFx0dG9bc3ltYm9sc1tpXV0gPSBmcm9tW3N5bWJvbHNbaV1dO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHRvO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvb2JqZWN0LWFzc2lnbi9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoIm1vZHVsZS5leHBvcnRzID0ge1xuXHRNT0RFX05VTUJFUiA6XHRcdDEgPDwgMCxcblx0TU9ERV9BTFBIQV9OVU0gOiBcdDEgPDwgMSxcblx0TU9ERV84QklUX0JZVEUgOiBcdDEgPDwgMixcblx0TU9ERV9LQU5KSSA6XHRcdDEgPDwgM1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcXIuanMvbGliL21vZGUuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCJtb2R1bGUuZXhwb3J0cyA9IHtcblx0TCA6IDEsXG5cdE0gOiAwLFxuXHRRIDogMyxcblx0SCA6IDJcbn07XG5cblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcXIuanMvbGliL0Vycm9yQ29ycmVjdExldmVsLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCd2YXIgbWF0aCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbWF0aCAqLyAyNyk7XG5cbmZ1bmN0aW9uIFFSUG9seW5vbWlhbChudW0sIHNoaWZ0KSB7XG5cblx0aWYgKG51bS5sZW5ndGggPT0gdW5kZWZpbmVkKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKG51bS5sZW5ndGggKyAiLyIgKyBzaGlmdCk7XG5cdH1cblxuXHR2YXIgb2Zmc2V0ID0gMDtcblxuXHR3aGlsZSAob2Zmc2V0IDwgbnVtLmxlbmd0aCAmJiBudW1bb2Zmc2V0XSA9PSAwKSB7XG5cdFx0b2Zmc2V0Kys7XG5cdH1cblxuXHR0aGlzLm51bSA9IG5ldyBBcnJheShudW0ubGVuZ3RoIC0gb2Zmc2V0ICsgc2hpZnQpO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IG51bS5sZW5ndGggLSBvZmZzZXQ7IGkrKykge1xuXHRcdHRoaXMubnVtW2ldID0gbnVtW2kgKyBvZmZzZXRdO1xuXHR9XG59XG5cblFSUG9seW5vbWlhbC5wcm90b3R5cGUgPSB7XG5cblx0Z2V0IDogZnVuY3Rpb24oaW5kZXgpIHtcblx0XHRyZXR1cm4gdGhpcy5udW1baW5kZXhdO1xuXHR9LFxuXHRcblx0Z2V0TGVuZ3RoIDogZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIHRoaXMubnVtLmxlbmd0aDtcblx0fSxcblx0XG5cdG11bHRpcGx5IDogZnVuY3Rpb24oZSkge1xuXHRcblx0XHR2YXIgbnVtID0gbmV3IEFycmF5KHRoaXMuZ2V0TGVuZ3RoKCkgKyBlLmdldExlbmd0aCgpIC0gMSk7XG5cdFxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRMZW5ndGgoKTsgaSsrKSB7XG5cdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGUuZ2V0TGVuZ3RoKCk7IGorKykge1xuXHRcdFx0XHRudW1baSArIGpdIF49IG1hdGguZ2V4cChtYXRoLmdsb2codGhpcy5nZXQoaSkgKSArIG1hdGguZ2xvZyhlLmdldChqKSApICk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcblx0XHRyZXR1cm4gbmV3IFFSUG9seW5vbWlhbChudW0sIDApO1xuXHR9LFxuXHRcblx0bW9kIDogZnVuY3Rpb24oZSkge1xuXHRcblx0XHRpZiAodGhpcy5nZXRMZW5ndGgoKSAtIGUuZ2V0TGVuZ3RoKCkgPCAwKSB7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdFxuXHRcdHZhciByYXRpbyA9IG1hdGguZ2xvZyh0aGlzLmdldCgwKSApIC0gbWF0aC5nbG9nKGUuZ2V0KDApICk7XG5cdFxuXHRcdHZhciBudW0gPSBuZXcgQXJyYXkodGhpcy5nZXRMZW5ndGgoKSApO1xuXHRcdFxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRMZW5ndGgoKTsgaSsrKSB7XG5cdFx0XHRudW1baV0gPSB0aGlzLmdldChpKTtcblx0XHR9XG5cdFx0XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBlLmdldExlbmd0aCgpOyBpKyspIHtcblx0XHRcdG51bVtpXSBePSBtYXRoLmdleHAobWF0aC5nbG9nKGUuZ2V0KGkpICkgKyByYXRpbyk7XG5cdFx0fVxuXHRcblx0XHQvLyByZWN1cnNpdmUgY2FsbFxuXHRcdHJldHVybiBuZXcgUVJQb2x5bm9taWFsKG51bSwgMCkubW9kKGUpO1xuXHR9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFFSUG9seW5vbWlhbDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcXIuanMvbGliL1BvbHlub21pYWwuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCd2YXIgUVJNYXRoID0ge1xuXG5cdGdsb2cgOiBmdW5jdGlvbihuKSB7XG5cdFxuXHRcdGlmIChuIDwgMSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCJnbG9nKCIgKyBuICsgIikiKTtcblx0XHR9XG5cdFx0XG5cdFx0cmV0dXJuIFFSTWF0aC5MT0dfVEFCTEVbbl07XG5cdH0sXG5cdFxuXHRnZXhwIDogZnVuY3Rpb24obikge1xuXHRcblx0XHR3aGlsZSAobiA8IDApIHtcblx0XHRcdG4gKz0gMjU1O1xuXHRcdH1cblx0XG5cdFx0d2hpbGUgKG4gPj0gMjU2KSB7XG5cdFx0XHRuIC09IDI1NTtcblx0XHR9XG5cdFxuXHRcdHJldHVybiBRUk1hdGguRVhQX1RBQkxFW25dO1xuXHR9LFxuXHRcblx0RVhQX1RBQkxFIDogbmV3IEFycmF5KDI1NiksXG5cdFxuXHRMT0dfVEFCTEUgOiBuZXcgQXJyYXkoMjU2KVxuXG59O1xuXHRcbmZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7XG5cdFFSTWF0aC5FWFBfVEFCTEVbaV0gPSAxIDw8IGk7XG59XG5mb3IgKHZhciBpID0gODsgaSA8IDI1NjsgaSsrKSB7XG5cdFFSTWF0aC5FWFBfVEFCTEVbaV0gPSBRUk1hdGguRVhQX1RBQkxFW2kgLSA0XVxuXHRcdF4gUVJNYXRoLkVYUF9UQUJMRVtpIC0gNV1cblx0XHReIFFSTWF0aC5FWFBfVEFCTEVbaSAtIDZdXG5cdFx0XiBRUk1hdGguRVhQX1RBQkxFW2kgLSA4XTtcbn1cbmZvciAodmFyIGkgPSAwOyBpIDwgMjU1OyBpKyspIHtcblx0UVJNYXRoLkxPR19UQUJMRVtRUk1hdGguRVhQX1RBQkxFW2ldIF0gPSBpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFFSTWF0aDtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcXIuanMvbGliL21hdGguanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IEV2ZW50RW1pdHRlciA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGV2ZW50ZW1pdHRlcjMgKi8gNDcpO1xuY29uc3QgcF90aW1lb3V0XzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBwLXRpbWVvdXQgKi8gNDgpO1xuY29uc3QgcHJpb3JpdHlfcXVldWVfMSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vcHJpb3JpdHktcXVldWUgKi8gNTApO1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvblxuY29uc3QgZW1wdHkgPSAoKSA9PiB7IH07XG5jb25zdCB0aW1lb3V0RXJyb3IgPSBuZXcgcF90aW1lb3V0XzEuVGltZW91dEVycm9yKCk7XG4vKipcblByb21pc2UgcXVldWUgd2l0aCBjb25jdXJyZW5jeSBjb250cm9sLlxuKi9cbmNsYXNzIFBRdWV1ZSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2Q7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX2ludGVydmFsQ291bnQgPSAwO1xuICAgICAgICB0aGlzLl9pbnRlcnZhbEVuZCA9IDA7XG4gICAgICAgIHRoaXMuX3BlbmRpbmdDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuX3Jlc29sdmVFbXB0eSA9IGVtcHR5O1xuICAgICAgICB0aGlzLl9yZXNvbHZlSWRsZSA9IGVtcHR5O1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2NvbnNpc3RlbnQtdHlwZS1hc3NlcnRpb25zXG4gICAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgY2FycnlvdmVyQ29uY3VycmVuY3lDb3VudDogZmFsc2UsIGludGVydmFsQ2FwOiBJbmZpbml0eSwgaW50ZXJ2YWw6IDAsIGNvbmN1cnJlbmN5OiBJbmZpbml0eSwgYXV0b1N0YXJ0OiB0cnVlLCBxdWV1ZUNsYXNzOiBwcmlvcml0eV9xdWV1ZV8xLmRlZmF1bHQgfSwgb3B0aW9ucyk7XG4gICAgICAgIGlmICghKHR5cGVvZiBvcHRpb25zLmludGVydmFsQ2FwID09PSAnbnVtYmVyJyAmJiBvcHRpb25zLmludGVydmFsQ2FwID49IDEpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBFeHBlY3RlZCBcXGBpbnRlcnZhbENhcFxcYCB0byBiZSBhIG51bWJlciBmcm9tIDEgYW5kIHVwLCBnb3QgXFxgJHsoX2IgPSAoX2EgPSBvcHRpb25zLmludGVydmFsQ2FwKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9TdHJpbmcoKSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogJyd9XFxgICgke3R5cGVvZiBvcHRpb25zLmludGVydmFsQ2FwfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5pbnRlcnZhbCA9PT0gdW5kZWZpbmVkIHx8ICEoTnVtYmVyLmlzRmluaXRlKG9wdGlvbnMuaW50ZXJ2YWwpICYmIG9wdGlvbnMuaW50ZXJ2YWwgPj0gMCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYEV4cGVjdGVkIFxcYGludGVydmFsXFxgIHRvIGJlIGEgZmluaXRlIG51bWJlciA+PSAwLCBnb3QgXFxgJHsoX2QgPSAoX2MgPSBvcHRpb25zLmludGVydmFsKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudG9TdHJpbmcoKSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogJyd9XFxgICgke3R5cGVvZiBvcHRpb25zLmludGVydmFsfSlgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jYXJyeW92ZXJDb25jdXJyZW5jeUNvdW50ID0gb3B0aW9ucy5jYXJyeW92ZXJDb25jdXJyZW5jeUNvdW50O1xuICAgICAgICB0aGlzLl9pc0ludGVydmFsSWdub3JlZCA9IG9wdGlvbnMuaW50ZXJ2YWxDYXAgPT09IEluZmluaXR5IHx8IG9wdGlvbnMuaW50ZXJ2YWwgPT09IDA7XG4gICAgICAgIHRoaXMuX2ludGVydmFsQ2FwID0gb3B0aW9ucy5pbnRlcnZhbENhcDtcbiAgICAgICAgdGhpcy5faW50ZXJ2YWwgPSBvcHRpb25zLmludGVydmFsO1xuICAgICAgICB0aGlzLl9xdWV1ZSA9IG5ldyBvcHRpb25zLnF1ZXVlQ2xhc3MoKTtcbiAgICAgICAgdGhpcy5fcXVldWVDbGFzcyA9IG9wdGlvbnMucXVldWVDbGFzcztcbiAgICAgICAgdGhpcy5jb25jdXJyZW5jeSA9IG9wdGlvbnMuY29uY3VycmVuY3k7XG4gICAgICAgIHRoaXMuX3RpbWVvdXQgPSBvcHRpb25zLnRpbWVvdXQ7XG4gICAgICAgIHRoaXMuX3Rocm93T25UaW1lb3V0ID0gb3B0aW9ucy50aHJvd09uVGltZW91dCA9PT0gdHJ1ZTtcbiAgICAgICAgdGhpcy5faXNQYXVzZWQgPSBvcHRpb25zLmF1dG9TdGFydCA9PT0gZmFsc2U7XG4gICAgfVxuICAgIGdldCBfZG9lc0ludGVydmFsQWxsb3dBbm90aGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNJbnRlcnZhbElnbm9yZWQgfHwgdGhpcy5faW50ZXJ2YWxDb3VudCA8IHRoaXMuX2ludGVydmFsQ2FwO1xuICAgIH1cbiAgICBnZXQgX2RvZXNDb25jdXJyZW50QWxsb3dBbm90aGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGVuZGluZ0NvdW50IDwgdGhpcy5fY29uY3VycmVuY3k7XG4gICAgfVxuICAgIF9uZXh0KCkge1xuICAgICAgICB0aGlzLl9wZW5kaW5nQ291bnQtLTtcbiAgICAgICAgdGhpcy5fdHJ5VG9TdGFydEFub3RoZXIoKTtcbiAgICAgICAgdGhpcy5lbWl0KCduZXh0Jyk7XG4gICAgfVxuICAgIF9yZXNvbHZlUHJvbWlzZXMoKSB7XG4gICAgICAgIHRoaXMuX3Jlc29sdmVFbXB0eSgpO1xuICAgICAgICB0aGlzLl9yZXNvbHZlRW1wdHkgPSBlbXB0eTtcbiAgICAgICAgaWYgKHRoaXMuX3BlbmRpbmdDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUlkbGUoKTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVJZGxlID0gZW1wdHk7XG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2lkbGUnKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfb25SZXN1bWVJbnRlcnZhbCgpIHtcbiAgICAgICAgdGhpcy5fb25JbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLl9pbml0aWFsaXplSW50ZXJ2YWxJZk5lZWRlZCgpO1xuICAgICAgICB0aGlzLl90aW1lb3V0SWQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIF9pc0ludGVydmFsUGF1c2VkKCkge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBpZiAodGhpcy5faW50ZXJ2YWxJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBkZWxheSA9IHRoaXMuX2ludGVydmFsRW5kIC0gbm93O1xuICAgICAgICAgICAgaWYgKGRlbGF5IDwgMCkge1xuICAgICAgICAgICAgICAgIC8vIEFjdCBhcyB0aGUgaW50ZXJ2YWwgd2FzIGRvbmVcbiAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBuZWVkIHRvIHJlc3VtZSBpdCBoZXJlIGJlY2F1c2UgaXQgd2lsbCBiZSByZXN1bWVkIG9uIGxpbmUgMTYwXG4gICAgICAgICAgICAgICAgdGhpcy5faW50ZXJ2YWxDb3VudCA9ICh0aGlzLl9jYXJyeW92ZXJDb25jdXJyZW5jeUNvdW50KSA/IHRoaXMuX3BlbmRpbmdDb3VudCA6IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBBY3QgYXMgdGhlIGludGVydmFsIGlzIHBlbmRpbmdcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGltZW91dElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlc3VtZUludGVydmFsKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGRlbGF5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBfdHJ5VG9TdGFydEFub3RoZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLl9xdWV1ZS5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAvLyBXZSBjYW4gY2xlYXIgdGhlIGludGVydmFsIChcInBhdXNlXCIpXG4gICAgICAgICAgICAvLyBCZWNhdXNlIHdlIGNhbiByZWRvIGl0IGxhdGVyIChcInJlc3VtZVwiKVxuICAgICAgICAgICAgaWYgKHRoaXMuX2ludGVydmFsSWQpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5faW50ZXJ2YWxJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVQcm9taXNlcygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5faXNQYXVzZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGNhbkluaXRpYWxpemVJbnRlcnZhbCA9ICF0aGlzLl9pc0ludGVydmFsUGF1c2VkKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fZG9lc0ludGVydmFsQWxsb3dBbm90aGVyICYmIHRoaXMuX2RvZXNDb25jdXJyZW50QWxsb3dBbm90aGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZS5kZXF1ZXVlKCkoKTtcbiAgICAgICAgICAgICAgICBpZiAoY2FuSW5pdGlhbGl6ZUludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVJbnRlcnZhbElmTmVlZGVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgX2luaXRpYWxpemVJbnRlcnZhbElmTmVlZGVkKCkge1xuICAgICAgICBpZiAodGhpcy5faXNJbnRlcnZhbElnbm9yZWQgfHwgdGhpcy5faW50ZXJ2YWxJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX29uSW50ZXJ2YWwoKTtcbiAgICAgICAgfSwgdGhpcy5faW50ZXJ2YWwpO1xuICAgICAgICB0aGlzLl9pbnRlcnZhbEVuZCA9IERhdGUubm93KCkgKyB0aGlzLl9pbnRlcnZhbDtcbiAgICB9XG4gICAgX29uSW50ZXJ2YWwoKSB7XG4gICAgICAgIGlmICh0aGlzLl9pbnRlcnZhbENvdW50ID09PSAwICYmIHRoaXMuX3BlbmRpbmdDb3VudCA9PT0gMCAmJiB0aGlzLl9pbnRlcnZhbElkKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsSWQpO1xuICAgICAgICAgICAgdGhpcy5faW50ZXJ2YWxJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pbnRlcnZhbENvdW50ID0gdGhpcy5fY2FycnlvdmVyQ29uY3VycmVuY3lDb3VudCA/IHRoaXMuX3BlbmRpbmdDb3VudCA6IDA7XG4gICAgICAgIHRoaXMuX3Byb2Nlc3NRdWV1ZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICBFeGVjdXRlcyBhbGwgcXVldWVkIGZ1bmN0aW9ucyB1bnRpbCBpdCByZWFjaGVzIHRoZSBsaW1pdC5cbiAgICAqL1xuICAgIF9wcm9jZXNzUXVldWUoKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eVxuICAgICAgICB3aGlsZSAodGhpcy5fdHJ5VG9TdGFydEFub3RoZXIoKSkgeyB9XG4gICAgfVxuICAgIGdldCBjb25jdXJyZW5jeSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmN1cnJlbmN5O1xuICAgIH1cbiAgICBzZXQgY29uY3VycmVuY3kobmV3Q29uY3VycmVuY3kpIHtcbiAgICAgICAgaWYgKCEodHlwZW9mIG5ld0NvbmN1cnJlbmN5ID09PSAnbnVtYmVyJyAmJiBuZXdDb25jdXJyZW5jeSA+PSAxKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgRXhwZWN0ZWQgXFxgY29uY3VycmVuY3lcXGAgdG8gYmUgYSBudW1iZXIgZnJvbSAxIGFuZCB1cCwgZ290IFxcYCR7bmV3Q29uY3VycmVuY3l9XFxgICgke3R5cGVvZiBuZXdDb25jdXJyZW5jeX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY29uY3VycmVuY3kgPSBuZXdDb25jdXJyZW5jeTtcbiAgICAgICAgdGhpcy5fcHJvY2Vzc1F1ZXVlKCk7XG4gICAgfVxuICAgIC8qKlxuICAgIEFkZHMgYSBzeW5jIG9yIGFzeW5jIHRhc2sgdG8gdGhlIHF1ZXVlLiBBbHdheXMgcmV0dXJucyBhIHByb21pc2UuXG4gICAgKi9cbiAgICBhc3luYyBhZGQoZm4sIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcnVuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdDb3VudCsrO1xuICAgICAgICAgICAgICAgIHRoaXMuX2ludGVydmFsQ291bnQrKztcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcGVyYXRpb24gPSAodGhpcy5fdGltZW91dCA9PT0gdW5kZWZpbmVkICYmIG9wdGlvbnMudGltZW91dCA9PT0gdW5kZWZpbmVkKSA/IGZuKCkgOiBwX3RpbWVvdXRfMS5kZWZhdWx0KFByb21pc2UucmVzb2x2ZShmbigpKSwgKG9wdGlvbnMudGltZW91dCA9PT0gdW5kZWZpbmVkID8gdGhpcy5fdGltZW91dCA6IG9wdGlvbnMudGltZW91dCksICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnRocm93T25UaW1lb3V0ID09PSB1bmRlZmluZWQgPyB0aGlzLl90aHJvd09uVGltZW91dCA6IG9wdGlvbnMudGhyb3dPblRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QodGltZW91dEVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGF3YWl0IG9wZXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0KCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5fcXVldWUuZW5xdWV1ZShydW4sIG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5fdHJ5VG9TdGFydEFub3RoZXIoKTtcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnYWRkJyk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICBTYW1lIGFzIGAuYWRkKClgLCBidXQgYWNjZXB0cyBhbiBhcnJheSBvZiBzeW5jIG9yIGFzeW5jIGZ1bmN0aW9ucy5cblxuICAgIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gYWxsIGZ1bmN0aW9ucyBhcmUgcmVzb2x2ZWQuXG4gICAgKi9cbiAgICBhc3luYyBhZGRBbGwoZnVuY3Rpb25zLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChmdW5jdGlvbnMubWFwKGFzeW5jIChmdW5jdGlvbl8pID0+IHRoaXMuYWRkKGZ1bmN0aW9uXywgb3B0aW9ucykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgU3RhcnQgKG9yIHJlc3VtZSkgZXhlY3V0aW5nIGVucXVldWVkIHRhc2tzIHdpdGhpbiBjb25jdXJyZW5jeSBsaW1pdC4gTm8gbmVlZCB0byBjYWxsIHRoaXMgaWYgcXVldWUgaXMgbm90IHBhdXNlZCAodmlhIGBvcHRpb25zLmF1dG9TdGFydCA9IGZhbHNlYCBvciBieSBgLnBhdXNlKClgIG1ldGhvZC4pXG4gICAgKi9cbiAgICBzdGFydCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc1BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faXNQYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fcHJvY2Vzc1F1ZXVlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICBQdXQgcXVldWUgZXhlY3V0aW9uIG9uIGhvbGQuXG4gICAgKi9cbiAgICBwYXVzZSgpIHtcbiAgICAgICAgdGhpcy5faXNQYXVzZWQgPSB0cnVlO1xuICAgIH1cbiAgICAvKipcbiAgICBDbGVhciB0aGUgcXVldWUuXG4gICAgKi9cbiAgICBjbGVhcigpIHtcbiAgICAgICAgdGhpcy5fcXVldWUgPSBuZXcgdGhpcy5fcXVldWVDbGFzcygpO1xuICAgIH1cbiAgICAvKipcbiAgICBDYW4gYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzLiBVc2VmdWwgaWYgeW91IGZvciBleGFtcGxlIGFkZCBhZGRpdGlvbmFsIGl0ZW1zIGF0IGEgbGF0ZXIgdGltZS5cblxuICAgIEByZXR1cm5zIEEgcHJvbWlzZSB0aGF0IHNldHRsZXMgd2hlbiB0aGUgcXVldWUgYmVjb21lcyBlbXB0eS5cbiAgICAqL1xuICAgIGFzeW5jIG9uRW1wdHkoKSB7XG4gICAgICAgIC8vIEluc3RhbnRseSByZXNvbHZlIGlmIHRoZSBxdWV1ZSBpcyBlbXB0eVxuICAgICAgICBpZiAodGhpcy5fcXVldWUuc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nUmVzb2x2ZSA9IHRoaXMuX3Jlc29sdmVFbXB0eTtcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVFbXB0eSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBleGlzdGluZ1Jlc29sdmUoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgVGhlIGRpZmZlcmVuY2Ugd2l0aCBgLm9uRW1wdHlgIGlzIHRoYXQgYC5vbklkbGVgIGd1YXJhbnRlZXMgdGhhdCBhbGwgd29yayBmcm9tIHRoZSBxdWV1ZSBoYXMgZmluaXNoZWQuIGAub25FbXB0eWAgbWVyZWx5IHNpZ25hbHMgdGhhdCB0aGUgcXVldWUgaXMgZW1wdHksIGJ1dCBpdCBjb3VsZCBtZWFuIHRoYXQgc29tZSBwcm9taXNlcyBoYXZlbid0IGNvbXBsZXRlZCB5ZXQuXG5cbiAgICBAcmV0dXJucyBBIHByb21pc2UgdGhhdCBzZXR0bGVzIHdoZW4gdGhlIHF1ZXVlIGJlY29tZXMgZW1wdHksIGFuZCBhbGwgcHJvbWlzZXMgaGF2ZSBjb21wbGV0ZWQ7IGBxdWV1ZS5zaXplID09PSAwICYmIHF1ZXVlLnBlbmRpbmcgPT09IDBgLlxuICAgICovXG4gICAgYXN5bmMgb25JZGxlKCkge1xuICAgICAgICAvLyBJbnN0YW50bHkgcmVzb2x2ZSBpZiBub25lIHBlbmRpbmcgYW5kIGlmIG5vdGhpbmcgZWxzZSBpcyBxdWV1ZWRcbiAgICAgICAgaWYgKHRoaXMuX3BlbmRpbmdDb3VudCA9PT0gMCAmJiB0aGlzLl9xdWV1ZS5zaXplID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdSZXNvbHZlID0gdGhpcy5fcmVzb2x2ZUlkbGU7XG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlSWRsZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBleGlzdGluZ1Jlc29sdmUoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgU2l6ZSBvZiB0aGUgcXVldWUuXG4gICAgKi9cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXVlLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgIFNpemUgb2YgdGhlIHF1ZXVlLCBmaWx0ZXJlZCBieSB0aGUgZ2l2ZW4gb3B0aW9ucy5cblxuICAgIEZvciBleGFtcGxlLCB0aGlzIGNhbiBiZSB1c2VkIHRvIGZpbmQgdGhlIG51bWJlciBvZiBpdGVtcyByZW1haW5pbmcgaW4gdGhlIHF1ZXVlIHdpdGggYSBzcGVjaWZpYyBwcmlvcml0eSBsZXZlbC5cbiAgICAqL1xuICAgIHNpemVCeShvcHRpb25zKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB1bmljb3JuL25vLWZuLXJlZmVyZW5jZS1pbi1pdGVyYXRvclxuICAgICAgICByZXR1cm4gdGhpcy5fcXVldWUuZmlsdGVyKG9wdGlvbnMpLmxlbmd0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgTnVtYmVyIG9mIHBlbmRpbmcgcHJvbWlzZXMuXG4gICAgKi9cbiAgICBnZXQgcGVuZGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BlbmRpbmdDb3VudDtcbiAgICB9XG4gICAgLyoqXG4gICAgV2hldGhlciB0aGUgcXVldWUgaXMgY3VycmVudGx5IHBhdXNlZC5cbiAgICAqL1xuICAgIGdldCBpc1BhdXNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzUGF1c2VkO1xuICAgIH1cbiAgICBnZXQgdGltZW91dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVvdXQ7XG4gICAgfVxuICAgIC8qKlxuICAgIFNldCB0aGUgdGltZW91dCBmb3IgZnV0dXJlIG9wZXJhdGlvbnMuXG4gICAgKi9cbiAgICBzZXQgdGltZW91dChtaWxsaXNlY29uZHMpIHtcbiAgICAgICAgdGhpcy5fdGltZW91dCA9IG1pbGxpc2Vjb25kcztcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBQUXVldWU7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3AtcXVldWUvZGlzdC9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7ZXZhbCgiX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lICovIDUyKTtcbmNvbnN0IHsgbG9nZ2luZywgc2V0TG9nZ2luZyB9ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91dGlscy9sb2cgKi8gMjEpO1xuY29uc3QgY3JlYXRlV29ya2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9jcmVhdGVXb3JrZXIgKi8gNTMpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgbG9nZ2luZyxcbiAgc2V0TG9nZ2luZyxcbiAgY3JlYXRlV29ya2VyLFxufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZmbXBlZy9mZm1wZWcvc3JjL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiLyogaGFybW9ueSBleHBvcnQgKGJpbmRpbmcpICovIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCBcImFcIiwgZnVuY3Rpb24oKSB7IHJldHVybiBzeW1ib2xPYnNlcnZhYmxlUG9ueWZpbGw7IH0pO1xuZnVuY3Rpb24gc3ltYm9sT2JzZXJ2YWJsZVBvbnlmaWxsKHJvb3QpIHtcblx0dmFyIHJlc3VsdDtcblx0dmFyIFN5bWJvbCA9IHJvb3QuU3ltYm9sO1xuXG5cdGlmICh0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0aWYgKFN5bWJvbC5vYnNlcnZhYmxlKSB7XG5cdFx0XHRyZXN1bHQgPSBTeW1ib2wub2JzZXJ2YWJsZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzdWx0ID0gU3ltYm9sKCdvYnNlcnZhYmxlJyk7XG5cdFx0XHRTeW1ib2wub2JzZXJ2YWJsZSA9IHJlc3VsdDtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0cmVzdWx0ID0gJ0BAb2JzZXJ2YWJsZSc7XG5cdH1cblxuXHRyZXR1cm4gcmVzdWx0O1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvc3ltYm9sLW9ic2VydmFibGUvZXMvcG9ueWZpbGwuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCcvL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIHNoYWxsb3dFcXVhbChvYmpBLCBvYmpCLCBjb21wYXJlLCBjb21wYXJlQ29udGV4dCkge1xuICB2YXIgcmV0ID0gY29tcGFyZSA/IGNvbXBhcmUuY2FsbChjb21wYXJlQ29udGV4dCwgb2JqQSwgb2JqQikgOiB2b2lkIDA7XG5cbiAgaWYgKHJldCAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuICEhcmV0O1xuICB9XG5cbiAgaWYgKG9iakEgPT09IG9iakIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygb2JqQSAhPT0gIm9iamVjdCIgfHwgIW9iakEgfHwgdHlwZW9mIG9iakIgIT09ICJvYmplY3QiIHx8ICFvYmpCKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMob2JqQSk7XG4gIHZhciBrZXlzQiA9IE9iamVjdC5rZXlzKG9iakIpO1xuXG4gIGlmIChrZXlzQS5sZW5ndGggIT09IGtleXNCLmxlbmd0aCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBiSGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmJpbmQob2JqQik7XG5cbiAgLy8gVGVzdCBmb3IgQVwncyBrZXlzIGRpZmZlcmVudCBmcm9tIEIuXG4gIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGtleXNBLmxlbmd0aDsgaWR4KyspIHtcbiAgICB2YXIga2V5ID0ga2V5c0FbaWR4XTtcblxuICAgIGlmICghYkhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgdmFsdWVBID0gb2JqQVtrZXldO1xuICAgIHZhciB2YWx1ZUIgPSBvYmpCW2tleV07XG5cbiAgICByZXQgPSBjb21wYXJlID8gY29tcGFyZS5jYWxsKGNvbXBhcmVDb250ZXh0LCB2YWx1ZUEsIHZhbHVlQiwga2V5KSA6IHZvaWQgMDtcblxuICAgIGlmIChyZXQgPT09IGZhbHNlIHx8IChyZXQgPT09IHZvaWQgMCAmJiB2YWx1ZUEgIT09IHZhbHVlQikpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3NoYWxsb3dlcXVhbC9pbmRleC5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLF9fd2VicGFja19leHBvcnRzX18sX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoImZ1bmN0aW9uIHN0eWxpc19taW4gKFcpIHtcbiAgZnVuY3Rpb24gTShkLCBjLCBlLCBoLCBhKSB7XG4gICAgZm9yICh2YXIgbSA9IDAsIGIgPSAwLCB2ID0gMCwgbiA9IDAsIHEsIGcsIHggPSAwLCBLID0gMCwgaywgdSA9IGsgPSBxID0gMCwgbCA9IDAsIHIgPSAwLCBJID0gMCwgdCA9IDAsIEIgPSBlLmxlbmd0aCwgSiA9IEIgLSAxLCB5LCBmID0gJycsIHAgPSAnJywgRiA9ICcnLCBHID0gJycsIEM7IGwgPCBCOykge1xuICAgICAgZyA9IGUuY2hhckNvZGVBdChsKTtcbiAgICAgIGwgPT09IEogJiYgMCAhPT0gYiArIG4gKyB2ICsgbSAmJiAoMCAhPT0gYiAmJiAoZyA9IDQ3ID09PSBiID8gMTAgOiA0NyksIG4gPSB2ID0gbSA9IDAsIEIrKywgSisrKTtcblxuICAgICAgaWYgKDAgPT09IGIgKyBuICsgdiArIG0pIHtcbiAgICAgICAgaWYgKGwgPT09IEogJiYgKDAgPCByICYmIChmID0gZi5yZXBsYWNlKE4sICcnKSksIDAgPCBmLnRyaW0oKS5sZW5ndGgpKSB7XG4gICAgICAgICAgc3dpdGNoIChnKSB7XG4gICAgICAgICAgICBjYXNlIDMyOlxuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgY2FzZSA1OTpcbiAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgZiArPSBlLmNoYXJBdChsKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBnID0gNTk7XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKGcpIHtcbiAgICAgICAgICBjYXNlIDEyMzpcbiAgICAgICAgICAgIGYgPSBmLnRyaW0oKTtcbiAgICAgICAgICAgIHEgPSBmLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBrID0gMTtcblxuICAgICAgICAgICAgZm9yICh0ID0gKytsOyBsIDwgQjspIHtcbiAgICAgICAgICAgICAgc3dpdGNoIChnID0gZS5jaGFyQ29kZUF0KGwpKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxMjM6XG4gICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgMTI1OlxuICAgICAgICAgICAgICAgICAgay0tO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDQ3OlxuICAgICAgICAgICAgICAgICAgc3dpdGNoIChnID0gZS5jaGFyQ29kZUF0KGwgKyAxKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDQyOlxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ3OlxuICAgICAgICAgICAgICAgICAgICAgIGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodSA9IGwgKyAxOyB1IDwgSjsgKyt1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5jaGFyQ29kZUF0KHUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0NzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICg0MiA9PT0gZyAmJiA0MiA9PT0gZS5jaGFyQ29kZUF0KHUgLSAxKSAmJiBsICsgMiAhPT0gdSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gdSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICg0NyA9PT0gZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsID0gdSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsID0gdTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDkxOlxuICAgICAgICAgICAgICAgICAgZysrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgICAgICAgICAgIGcrKztcblxuICAgICAgICAgICAgICAgIGNhc2UgMzQ6XG4gICAgICAgICAgICAgICAgY2FzZSAzOTpcbiAgICAgICAgICAgICAgICAgIGZvciAoOyBsKysgPCBKICYmIGUuY2hhckNvZGVBdChsKSAhPT0gZzspIHtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKDAgPT09IGspIGJyZWFrO1xuICAgICAgICAgICAgICBsKys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGsgPSBlLnN1YnN0cmluZyh0LCBsKTtcbiAgICAgICAgICAgIDAgPT09IHEgJiYgKHEgPSAoZiA9IGYucmVwbGFjZShjYSwgJycpLnRyaW0oKSkuY2hhckNvZGVBdCgwKSk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAocSkge1xuICAgICAgICAgICAgICBjYXNlIDY0OlxuICAgICAgICAgICAgICAgIDAgPCByICYmIChmID0gZi5yZXBsYWNlKE4sICcnKSk7XG4gICAgICAgICAgICAgICAgZyA9IGYuY2hhckNvZGVBdCgxKTtcblxuICAgICAgICAgICAgICAgIHN3aXRjaCAoZykge1xuICAgICAgICAgICAgICAgICAgY2FzZSAxMDA6XG4gICAgICAgICAgICAgICAgICBjYXNlIDEwOTpcbiAgICAgICAgICAgICAgICAgIGNhc2UgMTE1OlxuICAgICAgICAgICAgICAgICAgY2FzZSA0NTpcbiAgICAgICAgICAgICAgICAgICAgciA9IGM7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByID0gTztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBrID0gTShjLCByLCBrLCBnLCBhICsgMSk7XG4gICAgICAgICAgICAgICAgdCA9IGsubGVuZ3RoO1xuICAgICAgICAgICAgICAgIDAgPCBBICYmIChyID0gWChPLCBmLCBJKSwgQyA9IEgoMywgaywgciwgYywgRCwgeiwgdCwgZywgYSwgaCksIGYgPSByLmpvaW4oJycpLCB2b2lkIDAgIT09IEMgJiYgMCA9PT0gKHQgPSAoayA9IEMudHJpbSgpKS5sZW5ndGgpICYmIChnID0gMCwgayA9ICcnKSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgPCB0KSBzd2l0Y2ggKGcpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgMTE1OlxuICAgICAgICAgICAgICAgICAgICBmID0gZi5yZXBsYWNlKGRhLCBlYSk7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMTAwOlxuICAgICAgICAgICAgICAgICAgY2FzZSAxMDk6XG4gICAgICAgICAgICAgICAgICBjYXNlIDQ1OlxuICAgICAgICAgICAgICAgICAgICBrID0gZiArICd7JyArIGsgKyAnfSc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDEwNzpcbiAgICAgICAgICAgICAgICAgICAgZiA9IGYucmVwbGFjZShmYSwgJyQxICQyJyk7XG4gICAgICAgICAgICAgICAgICAgIGsgPSBmICsgJ3snICsgayArICd9JztcbiAgICAgICAgICAgICAgICAgICAgayA9IDEgPT09IHcgfHwgMiA9PT0gdyAmJiBMKCdAJyArIGssIDMpID8gJ0Atd2Via2l0LScgKyBrICsgJ0AnICsgayA6ICdAJyArIGs7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBrID0gZiArIGssIDExMiA9PT0gaCAmJiAoayA9IChwICs9IGssICcnKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGsgPSAnJztcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGsgPSBNKGMsIFgoYywgZiwgSSksIGssIGgsIGEgKyAxKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgRiArPSBrO1xuICAgICAgICAgICAgayA9IEkgPSByID0gdSA9IHEgPSAwO1xuICAgICAgICAgICAgZiA9ICcnO1xuICAgICAgICAgICAgZyA9IGUuY2hhckNvZGVBdCgrK2wpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEyNTpcbiAgICAgICAgICBjYXNlIDU5OlxuICAgICAgICAgICAgZiA9ICgwIDwgciA/IGYucmVwbGFjZShOLCAnJykgOiBmKS50cmltKCk7XG4gICAgICAgICAgICBpZiAoMSA8ICh0ID0gZi5sZW5ndGgpKSBzd2l0Y2ggKDAgPT09IHUgJiYgKHEgPSBmLmNoYXJDb2RlQXQoMCksIDQ1ID09PSBxIHx8IDk2IDwgcSAmJiAxMjMgPiBxKSAmJiAodCA9IChmID0gZi5yZXBsYWNlKCcgJywgJzonKSkubGVuZ3RoKSwgMCA8IEEgJiYgdm9pZCAwICE9PSAoQyA9IEgoMSwgZiwgYywgZCwgRCwgeiwgcC5sZW5ndGgsIGgsIGEsIGgpKSAmJiAwID09PSAodCA9IChmID0gQy50cmltKCkpLmxlbmd0aCkgJiYgKGYgPSAnXFx4MDBcXHgwMCcpLCBxID0gZi5jaGFyQ29kZUF0KDApLCBnID0gZi5jaGFyQ29kZUF0KDEpLCBxKSB7XG4gICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDY0OlxuICAgICAgICAgICAgICAgIGlmICgxMDUgPT09IGcgfHwgOTkgPT09IGcpIHtcbiAgICAgICAgICAgICAgICAgIEcgKz0gZiArIGUuY2hhckF0KGwpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgNTggIT09IGYuY2hhckNvZGVBdCh0IC0gMSkgJiYgKHAgKz0gUChmLCBxLCBnLCBmLmNoYXJDb2RlQXQoMikpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEkgPSByID0gdSA9IHEgPSAwO1xuICAgICAgICAgICAgZiA9ICcnO1xuICAgICAgICAgICAgZyA9IGUuY2hhckNvZGVBdCgrK2wpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHN3aXRjaCAoZykge1xuICAgICAgICBjYXNlIDEzOlxuICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgIDQ3ID09PSBiID8gYiA9IDAgOiAwID09PSAxICsgcSAmJiAxMDcgIT09IGggJiYgMCA8IGYubGVuZ3RoICYmIChyID0gMSwgZiArPSAnXFx4MDAnKTtcbiAgICAgICAgICAwIDwgQSAqIFkgJiYgSCgwLCBmLCBjLCBkLCBELCB6LCBwLmxlbmd0aCwgaCwgYSwgaCk7XG4gICAgICAgICAgeiA9IDE7XG4gICAgICAgICAgRCsrO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgNTk6XG4gICAgICAgIGNhc2UgMTI1OlxuICAgICAgICAgIGlmICgwID09PSBiICsgbiArIHYgKyBtKSB7XG4gICAgICAgICAgICB6Kys7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB6Kys7XG4gICAgICAgICAgeSA9IGUuY2hhckF0KGwpO1xuXG4gICAgICAgICAgc3dpdGNoIChnKSB7XG4gICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICBjYXNlIDMyOlxuICAgICAgICAgICAgICBpZiAoMCA9PT0gbiArIG0gKyBiKSBzd2l0Y2ggKHgpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDQ0OlxuICAgICAgICAgICAgICAgIGNhc2UgNTg6XG4gICAgICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIGNhc2UgMzI6XG4gICAgICAgICAgICAgICAgICB5ID0gJyc7XG4gICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAzMiAhPT0gZyAmJiAoeSA9ICcgJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgeSA9ICdcXFxcMCc7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICB5ID0gJ1xcXFxmJztcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgMTE6XG4gICAgICAgICAgICAgIHkgPSAnXFxcXHYnO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAzODpcbiAgICAgICAgICAgICAgMCA9PT0gbiArIGIgKyBtICYmIChyID0gSSA9IDEsIHkgPSAnXFxmJyArIHkpO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAxMDg6XG4gICAgICAgICAgICAgIGlmICgwID09PSBuICsgYiArIG0gKyBFICYmIDAgPCB1KSBzd2l0Y2ggKGwgLSB1KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgMTEyID09PSB4ICYmIDU4ID09PSBlLmNoYXJDb2RlQXQobCAtIDMpICYmIChFID0geCk7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAxMTEgPT09IEsgJiYgKEUgPSBLKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSA1ODpcbiAgICAgICAgICAgICAgMCA9PT0gbiArIGIgKyBtICYmICh1ID0gbCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDQ0OlxuICAgICAgICAgICAgICAwID09PSBiICsgdiArIG4gKyBtICYmIChyID0gMSwgeSArPSAnXFxyJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDM0OlxuICAgICAgICAgICAgY2FzZSAzOTpcbiAgICAgICAgICAgICAgMCA9PT0gYiAmJiAobiA9IG4gPT09IGcgPyAwIDogMCA9PT0gbiA/IGcgOiBuKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgOTE6XG4gICAgICAgICAgICAgIDAgPT09IG4gKyBiICsgdiAmJiBtKys7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDkzOlxuICAgICAgICAgICAgICAwID09PSBuICsgYiArIHYgJiYgbS0tO1xuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSA0MTpcbiAgICAgICAgICAgICAgMCA9PT0gbiArIGIgKyBtICYmIHYtLTtcbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgNDA6XG4gICAgICAgICAgICAgIGlmICgwID09PSBuICsgYiArIG0pIHtcbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gcSkgc3dpdGNoICgyICogeCArIDMgKiBLKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIDUzMzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHEgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2Kys7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSA2NDpcbiAgICAgICAgICAgICAgMCA9PT0gYiArIHYgKyBuICsgbSArIHUgKyBrICYmIChrID0gMSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIDQyOlxuICAgICAgICAgICAgY2FzZSA0NzpcbiAgICAgICAgICAgICAgaWYgKCEoMCA8IG4gKyBtICsgdikpIHN3aXRjaCAoYikge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoMiAqIGcgKyAzICogZS5jaGFyQ29kZUF0KGwgKyAxKSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDIzNTpcbiAgICAgICAgICAgICAgICAgICAgICBiID0gNDc7XG4gICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMjA6XG4gICAgICAgICAgICAgICAgICAgICAgdCA9IGwsIGIgPSA0MjtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDQyOlxuICAgICAgICAgICAgICAgICAgNDcgPT09IGcgJiYgNDIgPT09IHggJiYgdCArIDIgIT09IGwgJiYgKDMzID09PSBlLmNoYXJDb2RlQXQodCArIDIpICYmIChwICs9IGUuc3Vic3RyaW5nKHQsIGwgKyAxKSksIHkgPSAnJywgYiA9IDApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgMCA9PT0gYiAmJiAoZiArPSB5KTtcbiAgICAgIH1cblxuICAgICAgSyA9IHg7XG4gICAgICB4ID0gZztcbiAgICAgIGwrKztcbiAgICB9XG5cbiAgICB0ID0gcC5sZW5ndGg7XG5cbiAgICBpZiAoMCA8IHQpIHtcbiAgICAgIHIgPSBjO1xuICAgICAgaWYgKDAgPCBBICYmIChDID0gSCgyLCBwLCByLCBkLCBELCB6LCB0LCBoLCBhLCBoKSwgdm9pZCAwICE9PSBDICYmIDAgPT09IChwID0gQykubGVuZ3RoKSkgcmV0dXJuIEcgKyBwICsgRjtcbiAgICAgIHAgPSByLmpvaW4oJywnKSArICd7JyArIHAgKyAnfSc7XG5cbiAgICAgIGlmICgwICE9PSB3ICogRSkge1xuICAgICAgICAyICE9PSB3IHx8IEwocCwgMikgfHwgKEUgPSAwKTtcblxuICAgICAgICBzd2l0Y2ggKEUpIHtcbiAgICAgICAgICBjYXNlIDExMTpcbiAgICAgICAgICAgIHAgPSBwLnJlcGxhY2UoaGEsICc6LW1vei0kMScpICsgcDtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxMTI6XG4gICAgICAgICAgICBwID0gcC5yZXBsYWNlKFEsICc6Oi13ZWJraXQtaW5wdXQtJDEnKSArIHAucmVwbGFjZShRLCAnOjotbW96LSQxJykgKyBwLnJlcGxhY2UoUSwgJzotbXMtaW5wdXQtJDEnKSArIHA7XG4gICAgICAgIH1cblxuICAgICAgICBFID0gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gRyArIHAgKyBGO1xuICB9XG5cbiAgZnVuY3Rpb24gWChkLCBjLCBlKSB7XG4gICAgdmFyIGggPSBjLnRyaW0oKS5zcGxpdChpYSk7XG4gICAgYyA9IGg7XG4gICAgdmFyIGEgPSBoLmxlbmd0aCxcbiAgICAgICAgbSA9IGQubGVuZ3RoO1xuXG4gICAgc3dpdGNoIChtKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHZhciBiID0gMDtcblxuICAgICAgICBmb3IgKGQgPSAwID09PSBtID8gJycgOiBkWzBdICsgJyAnOyBiIDwgYTsgKytiKSB7XG4gICAgICAgICAgY1tiXSA9IFooZCwgY1tiXSwgZSkudHJpbSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHZhciB2ID0gYiA9IDA7XG5cbiAgICAgICAgZm9yIChjID0gW107IGIgPCBhOyArK2IpIHtcbiAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IG07ICsrbikge1xuICAgICAgICAgICAgY1t2KytdID0gWihkW25dICsgJyAnLCBoW2JdLCBlKS50cmltKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gYztcbiAgfVxuXG4gIGZ1bmN0aW9uIFooZCwgYywgZSkge1xuICAgIHZhciBoID0gYy5jaGFyQ29kZUF0KDApO1xuICAgIDMzID4gaCAmJiAoaCA9IChjID0gYy50cmltKCkpLmNoYXJDb2RlQXQoMCkpO1xuXG4gICAgc3dpdGNoIChoKSB7XG4gICAgICBjYXNlIDM4OlxuICAgICAgICByZXR1cm4gYy5yZXBsYWNlKEYsICckMScgKyBkLnRyaW0oKSk7XG5cbiAgICAgIGNhc2UgNTg6XG4gICAgICAgIHJldHVybiBkLnRyaW0oKSArIGMucmVwbGFjZShGLCAnJDEnICsgZC50cmltKCkpO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpZiAoMCA8IDEgKiBlICYmIDAgPCBjLmluZGV4T2YoJ1xcZicpKSByZXR1cm4gYy5yZXBsYWNlKEYsICg1OCA9PT0gZC5jaGFyQ29kZUF0KDApID8gJycgOiAnJDEnKSArIGQudHJpbSgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZCArIGM7XG4gIH1cblxuICBmdW5jdGlvbiBQKGQsIGMsIGUsIGgpIHtcbiAgICB2YXIgYSA9IGQgKyAnOycsXG4gICAgICAgIG0gPSAyICogYyArIDMgKiBlICsgNCAqIGg7XG5cbiAgICBpZiAoOTQ0ID09PSBtKSB7XG4gICAgICBkID0gYS5pbmRleE9mKCc6JywgOSkgKyAxO1xuICAgICAgdmFyIGIgPSBhLnN1YnN0cmluZyhkLCBhLmxlbmd0aCAtIDEpLnRyaW0oKTtcbiAgICAgIGIgPSBhLnN1YnN0cmluZygwLCBkKS50cmltKCkgKyBiICsgJzsnO1xuICAgICAgcmV0dXJuIDEgPT09IHcgfHwgMiA9PT0gdyAmJiBMKGIsIDEpID8gJy13ZWJraXQtJyArIGIgKyBiIDogYjtcbiAgICB9XG5cbiAgICBpZiAoMCA9PT0gdyB8fCAyID09PSB3ICYmICFMKGEsIDEpKSByZXR1cm4gYTtcblxuICAgIHN3aXRjaCAobSkge1xuICAgICAgY2FzZSAxMDE1OlxuICAgICAgICByZXR1cm4gOTcgPT09IGEuY2hhckNvZGVBdCgxMCkgPyAnLXdlYmtpdC0nICsgYSArIGEgOiBhO1xuXG4gICAgICBjYXNlIDk1MTpcbiAgICAgICAgcmV0dXJuIDExNiA9PT0gYS5jaGFyQ29kZUF0KDMpID8gJy13ZWJraXQtJyArIGEgKyBhIDogYTtcblxuICAgICAgY2FzZSA5NjM6XG4gICAgICAgIHJldHVybiAxMTAgPT09IGEuY2hhckNvZGVBdCg1KSA/ICctd2Via2l0LScgKyBhICsgYSA6IGE7XG5cbiAgICAgIGNhc2UgMTAwOTpcbiAgICAgICAgaWYgKDEwMCAhPT0gYS5jaGFyQ29kZUF0KDQpKSBicmVhaztcblxuICAgICAgY2FzZSA5Njk6XG4gICAgICBjYXNlIDk0MjpcbiAgICAgICAgcmV0dXJuICctd2Via2l0LScgKyBhICsgYTtcblxuICAgICAgY2FzZSA5Nzg6XG4gICAgICAgIHJldHVybiAnLXdlYmtpdC0nICsgYSArICctbW96LScgKyBhICsgYTtcblxuICAgICAgY2FzZSAxMDE5OlxuICAgICAgY2FzZSA5ODM6XG4gICAgICAgIHJldHVybiAnLXdlYmtpdC0nICsgYSArICctbW96LScgKyBhICsgJy1tcy0nICsgYSArIGE7XG5cbiAgICAgIGNhc2UgODgzOlxuICAgICAgICBpZiAoNDUgPT09IGEuY2hhckNvZGVBdCg4KSkgcmV0dXJuICctd2Via2l0LScgKyBhICsgYTtcbiAgICAgICAgaWYgKDAgPCBhLmluZGV4T2YoJ2ltYWdlLXNldCgnLCAxMSkpIHJldHVybiBhLnJlcGxhY2UoamEsICckMS13ZWJraXQtJDInKSArIGE7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDkzMjpcbiAgICAgICAgaWYgKDQ1ID09PSBhLmNoYXJDb2RlQXQoNCkpIHN3aXRjaCAoYS5jaGFyQ29kZUF0KDUpKSB7XG4gICAgICAgICAgY2FzZSAxMDM6XG4gICAgICAgICAgICByZXR1cm4gJy13ZWJraXQtYm94LScgKyBhLnJlcGxhY2UoJy1ncm93JywgJycpICsgJy13ZWJraXQtJyArIGEgKyAnLW1zLScgKyBhLnJlcGxhY2UoJ2dyb3cnLCAncG9zaXRpdmUnKSArIGE7XG5cbiAgICAgICAgICBjYXNlIDExNTpcbiAgICAgICAgICAgIHJldHVybiAnLXdlYmtpdC0nICsgYSArICctbXMtJyArIGEucmVwbGFjZSgnc2hyaW5rJywgJ25lZ2F0aXZlJykgKyBhO1xuXG4gICAgICAgICAgY2FzZSA5ODpcbiAgICAgICAgICAgIHJldHVybiAnLXdlYmtpdC0nICsgYSArICctbXMtJyArIGEucmVwbGFjZSgnYmFzaXMnLCAncHJlZmVycmVkLXNpemUnKSArIGE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICctd2Via2l0LScgKyBhICsgJy1tcy0nICsgYSArIGE7XG5cbiAgICAgIGNhc2UgOTY0OlxuICAgICAgICByZXR1cm4gJy13ZWJraXQtJyArIGEgKyAnLW1zLWZsZXgtJyArIGEgKyBhO1xuXG4gICAgICBjYXNlIDEwMjM6XG4gICAgICAgIGlmICg5OSAhPT0gYS5jaGFyQ29kZUF0KDgpKSBicmVhaztcbiAgICAgICAgYiA9IGEuc3Vic3RyaW5nKGEuaW5kZXhPZignOicsIDE1KSkucmVwbGFjZSgnZmxleC0nLCAnJykucmVwbGFjZSgnc3BhY2UtYmV0d2VlbicsICdqdXN0aWZ5Jyk7XG4gICAgICAgIHJldHVybiAnLXdlYmtpdC1ib3gtcGFjaycgKyBiICsgJy13ZWJraXQtJyArIGEgKyAnLW1zLWZsZXgtcGFjaycgKyBiICsgYTtcblxuICAgICAgY2FzZSAxMDA1OlxuICAgICAgICByZXR1cm4ga2EudGVzdChhKSA/IGEucmVwbGFjZShhYSwgJzotd2Via2l0LScpICsgYS5yZXBsYWNlKGFhLCAnOi1tb3otJykgKyBhIDogYTtcblxuICAgICAgY2FzZSAxZTM6XG4gICAgICAgIGIgPSBhLnN1YnN0cmluZygxMykudHJpbSgpO1xuICAgICAgICBjID0gYi5pbmRleE9mKCctJykgKyAxO1xuXG4gICAgICAgIHN3aXRjaCAoYi5jaGFyQ29kZUF0KDApICsgYi5jaGFyQ29kZUF0KGMpKSB7XG4gICAgICAgICAgY2FzZSAyMjY6XG4gICAgICAgICAgICBiID0gYS5yZXBsYWNlKEcsICd0YicpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDIzMjpcbiAgICAgICAgICAgIGIgPSBhLnJlcGxhY2UoRywgJ3RiLXJsJyk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMjIwOlxuICAgICAgICAgICAgYiA9IGEucmVwbGFjZShHLCAnbHInKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICctd2Via2l0LScgKyBhICsgJy1tcy0nICsgYiArIGE7XG5cbiAgICAgIGNhc2UgMTAxNzpcbiAgICAgICAgaWYgKC0xID09PSBhLmluZGV4T2YoJ3N0aWNreScsIDkpKSBicmVhaztcblxuICAgICAgY2FzZSA5NzU6XG4gICAgICAgIGMgPSAoYSA9IGQpLmxlbmd0aCAtIDEwO1xuICAgICAgICBiID0gKDMzID09PSBhLmNoYXJDb2RlQXQoYykgPyBhLnN1YnN0cmluZygwLCBjKSA6IGEpLnN1YnN0cmluZyhkLmluZGV4T2YoJzonLCA3KSArIDEpLnRyaW0oKTtcblxuICAgICAgICBzd2l0Y2ggKG0gPSBiLmNoYXJDb2RlQXQoMCkgKyAoYi5jaGFyQ29kZUF0KDcpIHwgMCkpIHtcbiAgICAgICAgICBjYXNlIDIwMzpcbiAgICAgICAgICAgIGlmICgxMTEgPiBiLmNoYXJDb2RlQXQoOCkpIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxMTU6XG4gICAgICAgICAgICBhID0gYS5yZXBsYWNlKGIsICctd2Via2l0LScgKyBiKSArICc7JyArIGE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgMjA3OlxuICAgICAgICAgIGNhc2UgMTAyOlxuICAgICAgICAgICAgYSA9IGEucmVwbGFjZShiLCAnLXdlYmtpdC0nICsgKDEwMiA8IG0gPyAnaW5saW5lLScgOiAnJykgKyAnYm94JykgKyAnOycgKyBhLnJlcGxhY2UoYiwgJy13ZWJraXQtJyArIGIpICsgJzsnICsgYS5yZXBsYWNlKGIsICctbXMtJyArIGIgKyAnYm94JykgKyAnOycgKyBhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGEgKyAnOyc7XG5cbiAgICAgIGNhc2UgOTM4OlxuICAgICAgICBpZiAoNDUgPT09IGEuY2hhckNvZGVBdCg1KSkgc3dpdGNoIChhLmNoYXJDb2RlQXQoNikpIHtcbiAgICAgICAgICBjYXNlIDEwNTpcbiAgICAgICAgICAgIHJldHVybiBiID0gYS5yZXBsYWNlKCctaXRlbXMnLCAnJyksICctd2Via2l0LScgKyBhICsgJy13ZWJraXQtYm94LScgKyBiICsgJy1tcy1mbGV4LScgKyBiICsgYTtcblxuICAgICAgICAgIGNhc2UgMTE1OlxuICAgICAgICAgICAgcmV0dXJuICctd2Via2l0LScgKyBhICsgJy1tcy1mbGV4LWl0ZW0tJyArIGEucmVwbGFjZShiYSwgJycpICsgYTtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gJy13ZWJraXQtJyArIGEgKyAnLW1zLWZsZXgtbGluZS1wYWNrJyArIGEucmVwbGFjZSgnYWxpZ24tY29udGVudCcsICcnKS5yZXBsYWNlKGJhLCAnJykgKyBhO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDk3MzpcbiAgICAgIGNhc2UgOTg5OlxuICAgICAgICBpZiAoNDUgIT09IGEuY2hhckNvZGVBdCgzKSB8fCAxMjIgPT09IGEuY2hhckNvZGVBdCg0KSkgYnJlYWs7XG5cbiAgICAgIGNhc2UgOTMxOlxuICAgICAgY2FzZSA5NTM6XG4gICAgICAgIGlmICghMCA9PT0gbGEudGVzdChkKSkgcmV0dXJuIDExNSA9PT0gKGIgPSBkLnN1YnN0cmluZyhkLmluZGV4T2YoJzonKSArIDEpKS5jaGFyQ29kZUF0KDApID8gUChkLnJlcGxhY2UoJ3N0cmV0Y2gnLCAnZmlsbC1hdmFpbGFibGUnKSwgYywgZSwgaCkucmVwbGFjZSgnOmZpbGwtYXZhaWxhYmxlJywgJzpzdHJldGNoJykgOiBhLnJlcGxhY2UoYiwgJy13ZWJraXQtJyArIGIpICsgYS5yZXBsYWNlKGIsICctbW96LScgKyBiLnJlcGxhY2UoJ2ZpbGwtJywgJycpKSArIGE7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDk2MjpcbiAgICAgICAgaWYgKGEgPSAnLXdlYmtpdC0nICsgYSArICgxMDIgPT09IGEuY2hhckNvZGVBdCg1KSA/ICctbXMtJyArIGEgOiAnJykgKyBhLCAyMTEgPT09IGUgKyBoICYmIDEwNSA9PT0gYS5jaGFyQ29kZUF0KDEzKSAmJiAwIDwgYS5pbmRleE9mKCd0cmFuc2Zvcm0nLCAxMCkpIHJldHVybiBhLnN1YnN0cmluZygwLCBhLmluZGV4T2YoJzsnLCAyNykgKyAxKS5yZXBsYWNlKG1hLCAnJDEtd2Via2l0LSQyJykgKyBhO1xuICAgIH1cblxuICAgIHJldHVybiBhO1xuICB9XG5cbiAgZnVuY3Rpb24gTChkLCBjKSB7XG4gICAgdmFyIGUgPSBkLmluZGV4T2YoMSA9PT0gYyA/ICc6JyA6ICd7JyksXG4gICAgICAgIGggPSBkLnN1YnN0cmluZygwLCAzICE9PSBjID8gZSA6IDEwKTtcbiAgICBlID0gZC5zdWJzdHJpbmcoZSArIDEsIGQubGVuZ3RoIC0gMSk7XG4gICAgcmV0dXJuIFIoMiAhPT0gYyA/IGggOiBoLnJlcGxhY2UobmEsICckMScpLCBlLCBjKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVhKGQsIGMpIHtcbiAgICB2YXIgZSA9IFAoYywgYy5jaGFyQ29kZUF0KDApLCBjLmNoYXJDb2RlQXQoMSksIGMuY2hhckNvZGVBdCgyKSk7XG4gICAgcmV0dXJuIGUgIT09IGMgKyAnOycgPyBlLnJlcGxhY2Uob2EsICcgb3IgKCQxKScpLnN1YnN0cmluZyg0KSA6ICcoJyArIGMgKyAnKSc7XG4gIH1cblxuICBmdW5jdGlvbiBIKGQsIGMsIGUsIGgsIGEsIG0sIGIsIHYsIG4sIHEpIHtcbiAgICBmb3IgKHZhciBnID0gMCwgeCA9IGMsIHc7IGcgPCBBOyArK2cpIHtcbiAgICAgIHN3aXRjaCAodyA9IFNbZ10uY2FsbChCLCBkLCB4LCBlLCBoLCBhLCBtLCBiLCB2LCBuLCBxKSkge1xuICAgICAgICBjYXNlIHZvaWQgMDpcbiAgICAgICAgY2FzZSAhMTpcbiAgICAgICAgY2FzZSAhMDpcbiAgICAgICAgY2FzZSBudWxsOlxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgeCA9IHc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHggIT09IGMpIHJldHVybiB4O1xuICB9XG5cbiAgZnVuY3Rpb24gVChkKSB7XG4gICAgc3dpdGNoIChkKSB7XG4gICAgICBjYXNlIHZvaWQgMDpcbiAgICAgIGNhc2UgbnVsbDpcbiAgICAgICAgQSA9IFMubGVuZ3RoID0gMDtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmICgnZnVuY3Rpb24nID09PSB0eXBlb2YgZCkgU1tBKytdID0gZDtlbHNlIGlmICgnb2JqZWN0JyA9PT0gdHlwZW9mIGQpIGZvciAodmFyIGMgPSAwLCBlID0gZC5sZW5ndGg7IGMgPCBlOyArK2MpIHtcbiAgICAgICAgICBUKGRbY10pO1xuICAgICAgICB9IGVsc2UgWSA9ICEhZCB8IDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIFQ7XG4gIH1cblxuICBmdW5jdGlvbiBVKGQpIHtcbiAgICBkID0gZC5wcmVmaXg7XG4gICAgdm9pZCAwICE9PSBkICYmIChSID0gbnVsbCwgZCA/ICdmdW5jdGlvbicgIT09IHR5cGVvZiBkID8gdyA9IDEgOiAodyA9IDIsIFIgPSBkKSA6IHcgPSAwKTtcbiAgICByZXR1cm4gVTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEIoZCwgYykge1xuICAgIHZhciBlID0gZDtcbiAgICAzMyA+IGUuY2hhckNvZGVBdCgwKSAmJiAoZSA9IGUudHJpbSgpKTtcbiAgICBWID0gZTtcbiAgICBlID0gW1ZdO1xuXG4gICAgaWYgKDAgPCBBKSB7XG4gICAgICB2YXIgaCA9IEgoLTEsIGMsIGUsIGUsIEQsIHosIDAsIDAsIDAsIDApO1xuICAgICAgdm9pZCAwICE9PSBoICYmICdzdHJpbmcnID09PSB0eXBlb2YgaCAmJiAoYyA9IGgpO1xuICAgIH1cblxuICAgIHZhciBhID0gTShPLCBlLCBjLCAwLCAwKTtcbiAgICAwIDwgQSAmJiAoaCA9IEgoLTIsIGEsIGUsIGUsIEQsIHosIGEubGVuZ3RoLCAwLCAwLCAwKSwgdm9pZCAwICE9PSBoICYmIChhID0gaCkpO1xuICAgIFYgPSAnJztcbiAgICBFID0gMDtcbiAgICB6ID0gRCA9IDE7XG4gICAgcmV0dXJuIGE7XG4gIH1cblxuICB2YXIgY2EgPSAvXlxcMCsvZyxcbiAgICAgIE4gPSAvW1xcMFxcclxcZl0vZyxcbiAgICAgIGFhID0gLzogKi9nLFxuICAgICAga2EgPSAvem9vfGdyYS8sXG4gICAgICBtYSA9IC8oWyw6IF0pKHRyYW5zZm9ybSkvZyxcbiAgICAgIGlhID0gLyxcXHIrPy9nLFxuICAgICAgRiA9IC8oW1xcdFxcclxcbiBdKSpcXGY/Ji9nLFxuICAgICAgZmEgPSAvQChrXFx3KylcXHMqKFxcUyopXFxzKi8sXG4gICAgICBRID0gLzo6KHBsYWNlKS9nLFxuICAgICAgaGEgPSAvOihyZWFkLW9ubHkpL2csXG4gICAgICBHID0gL1tzdmhdXFx3Ky1bdGJscl17Mn0vLFxuICAgICAgZGEgPSAvXFwoXFxzKiguKilcXHMqXFwpL2csXG4gICAgICBvYSA9IC8oW1xcc1xcU10qPyk7L2csXG4gICAgICBiYSA9IC8tc2VsZnxmbGV4LS9nLFxuICAgICAgbmEgPSAvW15dKj8oOltycF1bZWxdYVtcXHctXSspW15dKi8sXG4gICAgICBsYSA9IC9zdHJldGNofDpcXHMqXFx3K1xcLSg/OmNvbnRlfGF2YWlsKS8sXG4gICAgICBqYSA9IC8oW14tXSkoaW1hZ2Utc2V0XFwoKS8sXG4gICAgICB6ID0gMSxcbiAgICAgIEQgPSAxLFxuICAgICAgRSA9IDAsXG4gICAgICB3ID0gMSxcbiAgICAgIE8gPSBbXSxcbiAgICAgIFMgPSBbXSxcbiAgICAgIEEgPSAwLFxuICAgICAgUiA9IG51bGwsXG4gICAgICBZID0gMCxcbiAgICAgIFYgPSAnJztcbiAgQi51c2UgPSBUO1xuICBCLnNldCA9IFU7XG4gIHZvaWQgMCAhPT0gVyAmJiBVKFcpO1xuICByZXR1cm4gQjtcbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyBfX3dlYnBhY2tfZXhwb3J0c19fW1wiYVwiXSA9IChzdHlsaXNfbWluKTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGVtb3Rpb24vc3R5bGlzL2Rpc3Qvc3R5bGlzLmJyb3dzZXIuZXNtLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgndmFyIHVuaXRsZXNzS2V5cyA9IHtcbiAgYW5pbWF0aW9uSXRlcmF0aW9uQ291bnQ6IDEsXG4gIGJvcmRlckltYWdlT3V0c2V0OiAxLFxuICBib3JkZXJJbWFnZVNsaWNlOiAxLFxuICBib3JkZXJJbWFnZVdpZHRoOiAxLFxuICBib3hGbGV4OiAxLFxuICBib3hGbGV4R3JvdXA6IDEsXG4gIGJveE9yZGluYWxHcm91cDogMSxcbiAgY29sdW1uQ291bnQ6IDEsXG4gIGNvbHVtbnM6IDEsXG4gIGZsZXg6IDEsXG4gIGZsZXhHcm93OiAxLFxuICBmbGV4UG9zaXRpdmU6IDEsXG4gIGZsZXhTaHJpbms6IDEsXG4gIGZsZXhOZWdhdGl2ZTogMSxcbiAgZmxleE9yZGVyOiAxLFxuICBncmlkUm93OiAxLFxuICBncmlkUm93RW5kOiAxLFxuICBncmlkUm93U3BhbjogMSxcbiAgZ3JpZFJvd1N0YXJ0OiAxLFxuICBncmlkQ29sdW1uOiAxLFxuICBncmlkQ29sdW1uRW5kOiAxLFxuICBncmlkQ29sdW1uU3BhbjogMSxcbiAgZ3JpZENvbHVtblN0YXJ0OiAxLFxuICBtc0dyaWRSb3c6IDEsXG4gIG1zR3JpZFJvd1NwYW46IDEsXG4gIG1zR3JpZENvbHVtbjogMSxcbiAgbXNHcmlkQ29sdW1uU3BhbjogMSxcbiAgZm9udFdlaWdodDogMSxcbiAgbGluZUhlaWdodDogMSxcbiAgb3BhY2l0eTogMSxcbiAgb3JkZXI6IDEsXG4gIG9ycGhhbnM6IDEsXG4gIHRhYlNpemU6IDEsXG4gIHdpZG93czogMSxcbiAgekluZGV4OiAxLFxuICB6b29tOiAxLFxuICBXZWJraXRMaW5lQ2xhbXA6IDEsXG4gIC8vIFNWRy1yZWxhdGVkIHByb3BlcnRpZXNcbiAgZmlsbE9wYWNpdHk6IDEsXG4gIGZsb29kT3BhY2l0eTogMSxcbiAgc3RvcE9wYWNpdHk6IDEsXG4gIHN0cm9rZURhc2hhcnJheTogMSxcbiAgc3Ryb2tlRGFzaG9mZnNldDogMSxcbiAgc3Ryb2tlTWl0ZXJsaW1pdDogMSxcbiAgc3Ryb2tlT3BhY2l0eTogMSxcbiAgc3Ryb2tlV2lkdGg6IDFcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gX193ZWJwYWNrX2V4cG9ydHNfX1siYSJdID0gKHVuaXRsZXNzS2V5cyk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BlbW90aW9uL3VuaXRsZXNzL2Rpc3QvdW5pdGxlc3MuYnJvd3Nlci5lc20uanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoJ3ZhciBhcnJheVdpdGhIb2xlcyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vYXJyYXlXaXRoSG9sZXMuanMgKi8gNzYpO1xuXG52YXIgaXRlcmFibGVUb0FycmF5TGltaXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2l0ZXJhYmxlVG9BcnJheUxpbWl0LmpzICovIDc3KTtcblxudmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheS5qcyAqLyA3OCk7XG5cbnZhciBub25JdGVyYWJsZVJlc3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL25vbkl0ZXJhYmxlUmVzdC5qcyAqLyA4MCk7XG5cbmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge1xuICByZXR1cm4gYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBpdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgbm9uSXRlcmFibGVSZXN0KCk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX3NsaWNlZFRvQXJyYXk7XG5tb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9zbGljZWRUb0FycmF5LmpzPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgnZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge1xuICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX2NsYXNzQ2FsbENoZWNrO1xubW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2suanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCdmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO1xuICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtcbiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICB9XG59XG5cbmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtcbiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7XG4gIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcbiAgcmV0dXJuIENvbnN0cnVjdG9yO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9jcmVhdGVDbGFzcztcbm1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzLmpzPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCchZnVuY3Rpb24oZSx0KXtpZih0cnVlKW1vZHVsZS5leHBvcnRzPXQoKTtlbHNlIHsgdmFyIHIsIG47IH19KHdpbmRvdywoZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9e307ZnVuY3Rpb24gbihyKXtpZih0W3JdKXJldHVybiB0W3JdLmV4cG9ydHM7dmFyIG89dFtyXT17aTpyLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIGVbcl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsbiksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gbi5tPWUsbi5jPXQsbi5kPWZ1bmN0aW9uKGUsdCxyKXtuLm8oZSx0KXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7ZW51bWVyYWJsZTohMCxnZXQ6cn0pfSxuLnI9ZnVuY3Rpb24oZSl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sbi50PWZ1bmN0aW9uKGUsdCl7aWYoMSZ0JiYoZT1uKGUpKSw4JnQpcmV0dXJuIGU7aWYoNCZ0JiYib2JqZWN0Ij09dHlwZW9mIGUmJmUmJmUuX19lc01vZHVsZSlyZXR1cm4gZTt2YXIgcj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKG4ucihyKSxPYmplY3QuZGVmaW5lUHJvcGVydHkociwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6ZX0pLDImdCYmInN0cmluZyIhPXR5cGVvZiBlKWZvcih2YXIgbyBpbiBlKW4uZChyLG8sZnVuY3Rpb24odCl7cmV0dXJuIGVbdF19LmJpbmQobnVsbCxvKSk7cmV0dXJuIHJ9LG4ubj1mdW5jdGlvbihlKXt2YXIgdD1lJiZlLl9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gZS5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiBlfTtyZXR1cm4gbi5kKHQsImEiLHQpLHR9LG4ubz1mdW5jdGlvbihlLHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX0sbi5wPSIvIixuKG4ucz0xKX0oW2Z1bmN0aW9uKGUsdCl7ZS5leHBvcnRzPV9fd2VicGFja19yZXF1aXJlX18oLyohIHJlYWN0ICovIDApfSxmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO24ucih0KTt2YXIgcj1uKDApLG89bi5uKHIpO2Z1bmN0aW9uIHUoZSl7Y29uc3RbdCxuXT1PYmplY3Qoci51c2VTdGF0ZSkoITApLFtvLHVdPU9iamVjdChyLnVzZVN0YXRlKSgpO3JldHVybiBPYmplY3Qoci51c2VFZmZlY3QpKCgpPT57bGV0IHQ9ITA7cmV0dXJuIGFzeW5jIGZ1bmN0aW9uKCl7Y29uc3Qgcj1lKCk7aWYobnVsbD09PXIpcmV0dXJuO24oITApLHUodm9pZCAwKTtjb25zdCBvPWF3YWl0IHI7dCYmKHUobyksbighMSkpfSgpLCgpPT57dD0hMX19LFtlXSkse2lzRmV0Y2hpbmc6dCxkYXRhOm99fWNvbnN0IGM9e307ZnVuY3Rpb24gaShlLHQpe2NvbnN0W24sb109T2JqZWN0KHIudXNlU3RhdGUpKDApLGk9T2JqZWN0KHIudXNlTWVtbykoKCk9PiJzdHJpbmciPT10eXBlb2YgdD90OnQoKSxbdF0pLGY9T2JqZWN0KHIudXNlQ2FsbGJhY2spKGU9PntjW2ldPVByb21pc2UucmVzb2x2ZShlKSxvKERhdGUubm93KCkpfSxbaV0pLGE9T2JqZWN0KHIudXNlQ2FsbGJhY2spKCgpPT57ZGVsZXRlIGNbaV0sbyhEYXRlLm5vdygpKX0sW2ldKSxzPU9iamVjdChyLnVzZUNhbGxiYWNrKSgoKT0+e2xldCB0PWNbaV07aWYodm9pZCAwPT09dCl7Y29uc3Qgbj1lKCk7aWYobnVsbD09PW4pcmV0dXJuIG51bGw7dD1jW2ldPW59cmV0dXJuIHR9LFtpLG5dKSx7ZGF0YTpsLGlzRmV0Y2hpbmc6ZH09dShzKTtyZXR1cm57aXNGZXRjaGluZzpkLGRhdGE6bCx1cGRhdGVDYWNoZTpmLHJlbW92ZUNhY2hlOmF9fWNvbnN0IGY9T2JqZWN0KHIuY3JlYXRlQ29udGV4dCkoe30pO2Z1bmN0aW9uIGEoKXtyZXR1cm4gT2JqZWN0KHIudXNlQ29udGV4dCkoZil9ZnVuY3Rpb24gcyh7c3RvcmU6ZSxjaGlsZHJlbjp0fSl7Y29uc3Rbbix1XT1PYmplY3Qoci51c2VTdGF0ZSkoe30pO2NvbnN0IGM9T2JqZWN0LmtleXMoZSkucmVkdWNlKCh0LG4pPT57Y29uc3Qgbz1lW25dO3JldHVybiB0W25dPSguLi5lKT0+e2NvbnN0IHQ9W24sLi4uZV0uam9pbigiXyIpLGM9aSgoKT0+byguLi5lKSx0KTtyZXR1cm4gT2JqZWN0KHIudXNlRWZmZWN0KSgoKT0+eyFmdW5jdGlvbihlLHQpe3Uobj0+KHsuLi5uLFtlXTp0fSkpfSh0LGMucmVtb3ZlQ2FjaGUpfSxbdCxjLnJlbW92ZUNhY2hlXSksY30sdH0se2NsZWFyQ2FjaGUoLi4uZSl7IWZ1bmN0aW9uKGUpe2NvbnN0IHQ9bltlXTt0JiZ0KCl9KFsuLi5lXS5qb2luKCJfIikpfX0pLGE9ZjtyZXR1cm4gby5hLmNyZWF0ZUVsZW1lbnQoYS5Qcm92aWRlcix7dmFsdWU6Y30sdCl9bi5kKHQsInVzZUNhY2hlIiwoZnVuY3Rpb24oKXtyZXR1cm4gaX0pKSxuLmQodCwidXNlUHJvbWlzZSIsKGZ1bmN0aW9uKCl7cmV0dXJuIHV9KSksbi5kKHQsInVzZVN0b3JlIiwoZnVuY3Rpb24oKXtyZXR1cm4gYX0pKSxuLmQodCwiU3RvcmVQcm92aWRlciIsKGZ1bmN0aW9uKCl7cmV0dXJuIHN9KSksbi5kKHQsIlN0b3JlQ29udGV4dCIsKGZ1bmN0aW9uKCl7cmV0dXJuIGZ9KSl9XSl9KSk7XG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9yZWFjdC11c2UtY2FjaGUvZGlzdC9pbmRleC5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoJ1xuXG5mdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH1cblxuZnVuY3Rpb24gX2V4dGVuZHMoKSB7IF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTsgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cblxuZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH1cblxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH1cblxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsgdmFyIGtleSwgaTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSB7fTsgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOyB2YXIga2V5LCBpOyBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykgeyBrZXkgPSBzb3VyY2VLZXlzW2ldOyBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IHJldHVybiB0YXJnZXQ7IH1cblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfVxuXG5mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9XG5cbmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuXCd0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc25cJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9XG5cbmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9XG5cbnZhciBSZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHJlYWN0ICovIDApO1xuXG52YXIgUHJvcFR5cGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcHJvcC10eXBlcyAqLyAxMCk7IC8vIHFyLmpzIGRvZXNuXCd0IGhhbmRsZSBlcnJvciBsZXZlbCBvZiB6ZXJvIChNKSBzbyB3ZSBuZWVkIHRvIGRvIGl0IHJpZ2h0LFxuLy8gdGh1cyB0aGUgZGVlcCByZXF1aXJlLlxuXG5cbnZhciBRUkNvZGVJbXBsID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcXIuanMvbGliL1FSQ29kZSAqLyA4MSk7XG5cbnZhciBFcnJvckNvcnJlY3RMZXZlbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIHFyLmpzL2xpYi9FcnJvckNvcnJlY3RMZXZlbCAqLyAyNSk7IC8vIFRPRE86IHB1bGwgdGhpcyBvZmYgb2YgdGhlIFFSQ29kZSBjbGFzcyB0eXBlIHNvIGl0IG1hdGNoZXMuXG5cblxuLy8gQ29udmVydCBmcm9tIFVURi0xNiwgZm9yY2luZyB0aGUgdXNlIG9mIGJ5dGUtbW9kZSBlbmNvZGluZyBpbiBvdXIgUVIgQ29kZS5cbi8vIFRoaXMgYWxsb3dzIHVzIHRvIGVuY29kZSBIYW5qaSwgS2FuamksIGVtb2ppLCBldGMuIElkZWFsbHkgd2VcJ2QgZG8gbW9yZVxuLy8gZGV0ZWN0aW9uIGFuZCBub3QgcmVzb3J0IHRvIGJ5dGUtbW9kZSBpZiBwb3NzaWJsZSwgYnV0IHdlXCdyZSB0cmFkaW5nIG9mZlxuLy8gYSBzbWFsbGVyIGxpYnJhcnkgZm9yIGEgc21hbGxlciBhbW91bnQgb2YgZGF0YSB3ZSBjYW4gcG90ZW50aWFsbHkgZW5jb2RlLlxuLy8gQmFzZWQgb24gaHR0cDovL2pvbmlzYWxvbmVuLmNvbS8yMDEyL2Zyb20tdXRmLTE2LXRvLXV0Zi04LWluLWphdmFzY3JpcHQvXG5mdW5jdGlvbiBjb252ZXJ0U3RyKHN0cikge1xuICB2YXIgb3V0ID0gXCdcJztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgIHZhciBjaGFyY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuXG4gICAgaWYgKGNoYXJjb2RlIDwgMHgwMDgwKSB7XG4gICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyY29kZSk7XG4gICAgfSBlbHNlIGlmIChjaGFyY29kZSA8IDB4MDgwMCkge1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhjMCB8IGNoYXJjb2RlID4+IDYpO1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHg4MCB8IGNoYXJjb2RlICYgMHgzZik7XG4gICAgfSBlbHNlIGlmIChjaGFyY29kZSA8IDB4ZDgwMCB8fCBjaGFyY29kZSA+PSAweGUwMDApIHtcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZTAgfCBjaGFyY29kZSA+PiAxMik7XG4gICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgweDgwIHwgY2hhcmNvZGUgPj4gNiAmIDB4M2YpO1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHg4MCB8IGNoYXJjb2RlICYgMHgzZik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgaXMgYSBzdXJyb2dhdGUgcGFpciwgc28gd2VcJ2xsIHJlY29uc2l0dXRlIHRoZSBwaWVjZXMgYW5kIHdvcmtcbiAgICAgIC8vIGZyb20gdGhhdFxuICAgICAgaSsrO1xuICAgICAgY2hhcmNvZGUgPSAweDEwMDAwICsgKChjaGFyY29kZSAmIDB4M2ZmKSA8PCAxMCB8IHN0ci5jaGFyQ29kZUF0KGkpICYgMHgzZmYpO1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHhmMCB8IGNoYXJjb2RlID4+IDE4KTtcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ODAgfCBjaGFyY29kZSA+PiAxMiAmIDB4M2YpO1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHg4MCB8IGNoYXJjb2RlID4+IDYgJiAweDNmKTtcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ODAgfCBjaGFyY29kZSAmIDB4M2YpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59XG5cbnZhciBERUZBVUxUX1BST1BTID0ge1xuICBzaXplOiAxMjgsXG4gIGxldmVsOiBcJ0xcJyxcbiAgYmdDb2xvcjogXCcjRkZGRkZGXCcsXG4gIGZnQ29sb3I6IFwnIzAwMDAwMFwnLFxuICBpbmNsdWRlTWFyZ2luOiBmYWxzZVxufTtcbnZhciBQUk9QX1RZUEVTID0gIGZhbHNlID8gdW5kZWZpbmVkIDoge307XG52YXIgTUFSR0lOX1NJWkUgPSA0OyAvLyBUaGlzIGlzICp2ZXJ5KiByb3VnaCBlc3RpbWF0ZSBvZiBtYXggYW1vdW50IG9mIFFSQ29kZSBhbGxvd2VkIHRvIGJlIGNvdmVyZWQuXG4vLyBJdCBpcyAid3JvbmciIGluIGEgbG90IG9mIHdheXMgKGFyZWEgaXMgYSB0ZXJyaWJsZSB3YXkgdG8gZXN0aW1hdGUsIGl0XG4vLyByZWFsbHkgc2hvdWxkIGJlIG51bWJlciBvZiBtb2R1bGVzIGNvdmVyZWQpLCBidXQgaWYgZm9yIHNvbWUgcmVhc29uIHdlIGRvblwndFxuLy8gZ2V0IGFuIGV4cGxpY2l0IGhlaWdodCBvciB3aWR0aCwgSVwnZCByYXRoZXIgZGVmYXVsdCB0byBzb21ldGhpbmcgdGhhbiB0aHJvdy5cblxudmFyIERFRkFVTFRfSU1HX1NDQUxFID0gMC4xO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZVBhdGgobW9kdWxlcykge1xuICB2YXIgbWFyZ2luID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwO1xuICB2YXIgb3BzID0gW107XG4gIG1vZHVsZXMuZm9yRWFjaChmdW5jdGlvbiAocm93LCB5KSB7XG4gICAgdmFyIHN0YXJ0ID0gbnVsbDtcbiAgICByb3cuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCwgeCkge1xuICAgICAgaWYgKCFjZWxsICYmIHN0YXJ0ICE9PSBudWxsKSB7XG4gICAgICAgIC8vIE0wIDBoN3YxSDB6IGluamVjdHMgdGhlIHNwYWNlIHdpdGggdGhlIG1vdmUgYW5kIGRyb3BzIHRoZSBjb21tYSxcbiAgICAgICAgLy8gc2F2aW5nIGEgY2hhciBwZXIgb3BlcmF0aW9uXG4gICAgICAgIG9wcy5wdXNoKCJNIi5jb25jYXQoc3RhcnQgKyBtYXJnaW4sICIgIikuY29uY2F0KHkgKyBtYXJnaW4sICJoIikuY29uY2F0KHggLSBzdGFydCwgInYxSCIpLmNvbmNhdChzdGFydCArIG1hcmdpbiwgInoiKSk7XG4gICAgICAgIHN0YXJ0ID0gbnVsbDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAvLyBlbmQgb2Ygcm93LCBjbGVhbiB1cCBvciBza2lwXG5cblxuICAgICAgaWYgKHggPT09IHJvdy5sZW5ndGggLSAxKSB7XG4gICAgICAgIGlmICghY2VsbCkge1xuICAgICAgICAgIC8vIFdlIHdvdWxkIGhhdmUgY2xvc2VkIHRoZSBvcCBhYm92ZSBhbHJlYWR5IHNvIHRoaXMgY2FuIG9ubHkgbWVhblxuICAgICAgICAgIC8vIDIrIGxpZ2h0IG1vZHVsZXMgaW4gYSByb3cuXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0YXJ0ID09PSBudWxsKSB7XG4gICAgICAgICAgLy8gSnVzdCBhIHNpbmdsZSBkYXJrIG1vZHVsZS5cbiAgICAgICAgICBvcHMucHVzaCgiTSIuY29uY2F0KHggKyBtYXJnaW4sICIsIikuY29uY2F0KHkgKyBtYXJnaW4sICIgaDF2MUgiKS5jb25jYXQoeCArIG1hcmdpbiwgInoiKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gT3RoZXJ3aXNlIGZpbmlzaCB0aGUgY3VycmVudCBsaW5lLlxuICAgICAgICAgIG9wcy5wdXNoKCJNIi5jb25jYXQoc3RhcnQgKyBtYXJnaW4sICIsIikuY29uY2F0KHkgKyBtYXJnaW4sICIgaCIpLmNvbmNhdCh4ICsgMSAtIHN0YXJ0LCAidjFIIikuY29uY2F0KHN0YXJ0ICsgbWFyZ2luLCAieiIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGNlbGwgJiYgc3RhcnQgPT09IG51bGwpIHtcbiAgICAgICAgc3RhcnQgPSB4O1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgcmV0dXJuIG9wcy5qb2luKFwnXCcpO1xufSAvLyBXZSBjb3VsZCBqdXN0IGRvIHRoaXMgaW4gZ2VuZXJhdGVQYXRoLCBleGNlcHQgdGhhdCB3ZSB3YW50IHRvIHN1cHBvcnRcbi8vIG5vbi1QYXRoMkQgY2FudmFzLCBzbyB3ZSBuZWVkIHRvIGtlZXAgaXQgYW4gZXhwbGljaXQgc3RlcC5cblxuXG5mdW5jdGlvbiBleGNhdmF0ZU1vZHVsZXMobW9kdWxlcywgZXhjYXZhdGlvbikge1xuICByZXR1cm4gbW9kdWxlcy5zbGljZSgpLm1hcChmdW5jdGlvbiAocm93LCB5KSB7XG4gICAgaWYgKHkgPCBleGNhdmF0aW9uLnkgfHwgeSA+PSBleGNhdmF0aW9uLnkgKyBleGNhdmF0aW9uLmgpIHtcbiAgICAgIHJldHVybiByb3c7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJvdy5tYXAoZnVuY3Rpb24gKGNlbGwsIHgpIHtcbiAgICAgIGlmICh4IDwgZXhjYXZhdGlvbi54IHx8IHggPj0gZXhjYXZhdGlvbi54ICsgZXhjYXZhdGlvbi53KSB7XG4gICAgICAgIHJldHVybiBjZWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRJbWFnZVNldHRpbmdzKHByb3BzLCBjZWxscykge1xuICB2YXIgaW1hZ2VTZXR0aW5ncyA9IHByb3BzLmltYWdlU2V0dGluZ3MsXG4gICAgICBzaXplID0gcHJvcHMuc2l6ZSxcbiAgICAgIGluY2x1ZGVNYXJnaW4gPSBwcm9wcy5pbmNsdWRlTWFyZ2luO1xuXG4gIGlmIChpbWFnZVNldHRpbmdzID09IG51bGwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHZhciBtYXJnaW4gPSBpbmNsdWRlTWFyZ2luID8gTUFSR0lOX1NJWkUgOiAwO1xuICB2YXIgbnVtQ2VsbHMgPSBjZWxscy5sZW5ndGggKyBtYXJnaW4gKiAyO1xuICB2YXIgZGVmYXVsdFNpemUgPSBNYXRoLmZsb29yKHNpemUgKiBERUZBVUxUX0lNR19TQ0FMRSk7XG4gIHZhciBzY2FsZSA9IG51bUNlbGxzIC8gc2l6ZTtcbiAgdmFyIHcgPSAoaW1hZ2VTZXR0aW5ncy53aWR0aCB8fCBkZWZhdWx0U2l6ZSkgKiBzY2FsZTtcbiAgdmFyIGggPSAoaW1hZ2VTZXR0aW5ncy5oZWlnaHQgfHwgZGVmYXVsdFNpemUpICogc2NhbGU7XG4gIHZhciB4ID0gaW1hZ2VTZXR0aW5ncy54ID09IG51bGwgPyBjZWxscy5sZW5ndGggLyAyIC0gdyAvIDIgOiBpbWFnZVNldHRpbmdzLnggKiBzY2FsZTtcbiAgdmFyIHkgPSBpbWFnZVNldHRpbmdzLnkgPT0gbnVsbCA/IGNlbGxzLmxlbmd0aCAvIDIgLSBoIC8gMiA6IGltYWdlU2V0dGluZ3MueSAqIHNjYWxlO1xuICB2YXIgZXhjYXZhdGlvbiA9IG51bGw7XG5cbiAgaWYgKGltYWdlU2V0dGluZ3MuZXhjYXZhdGUpIHtcbiAgICB2YXIgZmxvb3JYID0gTWF0aC5mbG9vcih4KTtcbiAgICB2YXIgZmxvb3JZID0gTWF0aC5mbG9vcih5KTtcbiAgICB2YXIgY2VpbFcgPSBNYXRoLmNlaWwodyArIHggLSBmbG9vclgpO1xuICAgIHZhciBjZWlsSCA9IE1hdGguY2VpbChoICsgeSAtIGZsb29yWSk7XG4gICAgZXhjYXZhdGlvbiA9IHtcbiAgICAgIHg6IGZsb29yWCxcbiAgICAgIHk6IGZsb29yWSxcbiAgICAgIHc6IGNlaWxXLFxuICAgICAgaDogY2VpbEhcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB4OiB4LFxuICAgIHk6IHksXG4gICAgaDogaCxcbiAgICB3OiB3LFxuICAgIGV4Y2F2YXRpb246IGV4Y2F2YXRpb25cbiAgfTtcbn0gLy8gRm9yIGNhbnZhcyB3ZVwncmUgZ29pbmcgdG8gc3dpdGNoIG91ciBkcmF3aW5nIG1vZGUgYmFzZWQgb24gd2hldGhlciBvciBub3Rcbi8vIHRoZSBlbnZpcm9ubWVudCBzdXBwb3J0cyBQYXRoMkQuIFdlIG9ubHkgbmVlZCB0aGUgY29uc3RydWN0b3IgdG8gYmVcbi8vIHN1cHBvcnRlZCwgYnV0IEVkZ2UgZG9lc25cJ3QgYWN0dWFsbHkgc3VwcG9ydCB0aGUgcGF0aCAoc3RyaW5nKSB0eXBlXG4vLyBhcmd1bWVudC4gTHVja2lseSBpdCBhbHNvIGRvZXNuXCd0IHN1cHBvcnQgdGhlIGFkZFBhdGgoKSBtZXRob2QuIFdlIGNhblxuLy8gdHJlYXQgdGhhdCBhcyB0aGUgc2FtZSB0aGluZy5cblxuXG52YXIgU1VQUE9SVFNfUEFUSDJEID0gZnVuY3Rpb24gKCkge1xuICB0cnkge1xuICAgIG5ldyBQYXRoMkQoKS5hZGRQYXRoKG5ldyBQYXRoMkQoKSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn0oKTtcblxudmFyIFFSQ29kZUNhbnZhcyA9XG4vKiNfX1BVUkVfXyovXG5mdW5jdGlvbiAoX1JlYWN0JFB1cmVDb21wb25lbnQpIHtcbiAgX2luaGVyaXRzKFFSQ29kZUNhbnZhcywgX1JlYWN0JFB1cmVDb21wb25lbnQpO1xuXG4gIGZ1bmN0aW9uIFFSQ29kZUNhbnZhcygpIHtcbiAgICB2YXIgX2dldFByb3RvdHlwZU9mMjtcblxuICAgIHZhciBfdGhpcztcblxuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBRUkNvZGVDYW52YXMpO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgKF9nZXRQcm90b3R5cGVPZjIgPSBfZ2V0UHJvdG90eXBlT2YoUVJDb2RlQ2FudmFzKSkuY2FsbC5hcHBseShfZ2V0UHJvdG90eXBlT2YyLCBbdGhpc10uY29uY2F0KGFyZ3MpKSk7XG5cbiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfY2FudmFzIiwgdm9pZCAwKTtcblxuICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9pbWFnZSIsIHZvaWQgMCk7XG5cbiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHtcbiAgICAgIGltZ0xvYWRlZDogZmFsc2VcbiAgICB9KTtcblxuICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZUltYWdlTG9hZCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF90aGlzLnNldFN0YXRlKHtcbiAgICAgICAgaW1nTG9hZGVkOiB0cnVlXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhRUkNvZGVDYW52YXMsIFt7XG4gICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIGlmICh0aGlzLl9pbWFnZSAmJiB0aGlzLl9pbWFnZS5jb21wbGV0ZSkge1xuICAgICAgICB0aGlzLmhhbmRsZUltYWdlTG9hZCgpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgdmFyIF90aGlzJHByb3BzJGltYWdlU2V0dCwgX25leHRQcm9wcyRpbWFnZVNldHRpO1xuXG4gICAgICB2YXIgY3VycmVudFNyYyA9IChfdGhpcyRwcm9wcyRpbWFnZVNldHQgPSB0aGlzLnByb3BzLmltYWdlU2V0dGluZ3MpID09PSBudWxsIHx8IF90aGlzJHByb3BzJGltYWdlU2V0dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkcHJvcHMkaW1hZ2VTZXR0LnNyYztcbiAgICAgIHZhciBuZXh0U3JjID0gKF9uZXh0UHJvcHMkaW1hZ2VTZXR0aSA9IG5leHRQcm9wcy5pbWFnZVNldHRpbmdzKSA9PT0gbnVsbCB8fCBfbmV4dFByb3BzJGltYWdlU2V0dGkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9uZXh0UHJvcHMkaW1hZ2VTZXR0aS5zcmM7XG5cbiAgICAgIGlmIChjdXJyZW50U3JjICE9PSBuZXh0U3JjKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGltZ0xvYWRlZDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiY29tcG9uZW50RGlkVXBkYXRlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJ1cGRhdGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgICB2YXIgX3RoaXMkcHJvcHMgPSB0aGlzLnByb3BzLFxuICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMudmFsdWUsXG4gICAgICAgICAgc2l6ZSA9IF90aGlzJHByb3BzLnNpemUsXG4gICAgICAgICAgbGV2ZWwgPSBfdGhpcyRwcm9wcy5sZXZlbCxcbiAgICAgICAgICBiZ0NvbG9yID0gX3RoaXMkcHJvcHMuYmdDb2xvcixcbiAgICAgICAgICBmZ0NvbG9yID0gX3RoaXMkcHJvcHMuZmdDb2xvcixcbiAgICAgICAgICBpbmNsdWRlTWFyZ2luID0gX3RoaXMkcHJvcHMuaW5jbHVkZU1hcmdpbixcbiAgICAgICAgICBpbWFnZVNldHRpbmdzID0gX3RoaXMkcHJvcHMuaW1hZ2VTZXR0aW5nczsgLy8gV2VcJ2xsIHVzZSB0eXBlPT09LTEgdG8gZm9yY2UgUVJDb2RlIHRvIGF1dG9tYXRpY2FsbHkgcGljayB0aGUgYmVzdCB0eXBlXG5cbiAgICAgIHZhciBxcmNvZGUgPSBuZXcgUVJDb2RlSW1wbCgtMSwgRXJyb3JDb3JyZWN0TGV2ZWxbbGV2ZWxdKTtcbiAgICAgIHFyY29kZS5hZGREYXRhKGNvbnZlcnRTdHIodmFsdWUpKTtcbiAgICAgIHFyY29kZS5tYWtlKCk7XG5cbiAgICAgIGlmICh0aGlzLl9jYW52YXMgIT0gbnVsbCkge1xuICAgICAgICB2YXIgY2FudmFzID0gdGhpcy5fY2FudmFzO1xuICAgICAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCcyZFwnKTtcblxuICAgICAgICBpZiAoIWN0eCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBjZWxscyA9IHFyY29kZS5tb2R1bGVzO1xuXG4gICAgICAgIGlmIChjZWxscyA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtYXJnaW4gPSBpbmNsdWRlTWFyZ2luID8gTUFSR0lOX1NJWkUgOiAwO1xuICAgICAgICB2YXIgbnVtQ2VsbHMgPSBjZWxscy5sZW5ndGggKyBtYXJnaW4gKiAyO1xuICAgICAgICB2YXIgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MgPSBnZXRJbWFnZVNldHRpbmdzKHRoaXMucHJvcHMsIGNlbGxzKTtcblxuICAgICAgICBpZiAoaW1hZ2VTZXR0aW5ncyAhPSBudWxsICYmIGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAoY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MuZXhjYXZhdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICBjZWxscyA9IGV4Y2F2YXRlTW9kdWxlcyhjZWxscywgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MuZXhjYXZhdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIFdlXCdyZSBnb2luZyB0byBzY2FsZSB0aGlzIHNvIHRoYXQgdGhlIG51bWJlciBvZiBkcmF3YWJsZSB1bml0c1xuICAgICAgICAvLyBtYXRjaGVzIHRoZSBudW1iZXIgb2YgY2VsbHMuIFRoaXMgYXZvaWRzIHJvdW5kaW5nIGlzc3VlcywgYnV0IGRvZXNcbiAgICAgICAgLy8gcmVzdWx0IGluIHNvbWUgcG90ZW50aWFsbHkgdW53YW50ZWQgc2luZ2xlIHBpeGVsIGlzc3VlcyBiZXR3ZWVuXG4gICAgICAgIC8vIGJsb2Nrcywgb25seSBpbiBlbnZpcm9ubWVudHMgdGhhdCBkb25cJ3Qgc3VwcG9ydCBQYXRoMkQuXG5cblxuICAgICAgICB2YXIgcGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBjYW52YXMud2lkdGggPSBzaXplICogcGl4ZWxSYXRpbztcbiAgICAgICAgdmFyIHNjYWxlID0gc2l6ZSAvIG51bUNlbGxzICogcGl4ZWxSYXRpbztcbiAgICAgICAgY3R4LnNjYWxlKHNjYWxlLCBzY2FsZSk7IC8vIERyYXcgc29saWQgYmFja2dyb3VuZCwgb25seSBwYWludCBkYXJrIG1vZHVsZXMuXG5cbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGJnQ29sb3I7XG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBudW1DZWxscywgbnVtQ2VsbHMpO1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gZmdDb2xvcjtcblxuICAgICAgICBpZiAoU1VQUE9SVFNfUEFUSDJEKSB7XG4gICAgICAgICAgLy8gJEZsb3dGaXhNZTogUGF0aDJEIGNcJ3RvciBkb2VzblwndCBzdXBwb3J0IGFyZ3MgeWV0LlxuICAgICAgICAgIGN0eC5maWxsKG5ldyBQYXRoMkQoZ2VuZXJhdGVQYXRoKGNlbGxzLCBtYXJnaW4pKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAocm93LCByZHgpIHtcbiAgICAgICAgICAgIHJvdy5mb3JFYWNoKGZ1bmN0aW9uIChjZWxsLCBjZHgpIHtcbiAgICAgICAgICAgICAgaWYgKGNlbGwpIHtcbiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoY2R4ICsgbWFyZ2luLCByZHggKyBtYXJnaW4sIDEsIDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmltZ0xvYWRlZCAmJiB0aGlzLl9pbWFnZSAmJiBjYWxjdWxhdGVkSW1hZ2VTZXR0aW5ncyAhPSBudWxsKSB7XG4gICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLl9pbWFnZSwgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MueCArIG1hcmdpbiwgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MueSArIG1hcmdpbiwgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MudywgY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MuaCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJyZW5kZXIiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdmFyIF90aGlzJHByb3BzMiA9IHRoaXMucHJvcHMsXG4gICAgICAgICAgdmFsdWUgPSBfdGhpcyRwcm9wczIudmFsdWUsXG4gICAgICAgICAgc2l6ZSA9IF90aGlzJHByb3BzMi5zaXplLFxuICAgICAgICAgIGxldmVsID0gX3RoaXMkcHJvcHMyLmxldmVsLFxuICAgICAgICAgIGJnQ29sb3IgPSBfdGhpcyRwcm9wczIuYmdDb2xvcixcbiAgICAgICAgICBmZ0NvbG9yID0gX3RoaXMkcHJvcHMyLmZnQ29sb3IsXG4gICAgICAgICAgc3R5bGUgPSBfdGhpcyRwcm9wczIuc3R5bGUsXG4gICAgICAgICAgaW5jbHVkZU1hcmdpbiA9IF90aGlzJHByb3BzMi5pbmNsdWRlTWFyZ2luLFxuICAgICAgICAgIGltYWdlU2V0dGluZ3MgPSBfdGhpcyRwcm9wczIuaW1hZ2VTZXR0aW5ncyxcbiAgICAgICAgICBvdGhlclByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF90aGlzJHByb3BzMiwgWyJ2YWx1ZSIsICJzaXplIiwgImxldmVsIiwgImJnQ29sb3IiLCAiZmdDb2xvciIsICJzdHlsZSIsICJpbmNsdWRlTWFyZ2luIiwgImltYWdlU2V0dGluZ3MiXSk7XG5cbiAgICAgIHZhciBjYW52YXNTdHlsZSA9IF9vYmplY3RTcHJlYWQoe1xuICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgIHdpZHRoOiBzaXplXG4gICAgICB9LCBzdHlsZSk7XG5cbiAgICAgIHZhciBpbWcgPSBudWxsO1xuICAgICAgdmFyIGltZ1NyYyA9IGltYWdlU2V0dGluZ3MgJiYgaW1hZ2VTZXR0aW5ncy5zcmM7XG5cbiAgICAgIGlmIChpbWFnZVNldHRpbmdzICE9IG51bGwgJiYgaW1nU3JjICE9IG51bGwpIHtcbiAgICAgICAgaW1nID0gUmVhY3QuY3JlYXRlRWxlbWVudCgiaW1nIiwge1xuICAgICAgICAgIHNyYzogaW1nU3JjLFxuICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiBcJ25vbmVcJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25Mb2FkOiB0aGlzLmhhbmRsZUltYWdlTG9hZCxcbiAgICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihfcmVmKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMyLl9pbWFnZSA9IF9yZWY7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3QuRnJhZ21lbnQsIG51bGwsIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIsIF9leHRlbmRzKHtcbiAgICAgICAgc3R5bGU6IGNhbnZhc1N0eWxlLFxuICAgICAgICBoZWlnaHQ6IHNpemUsXG4gICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICByZWY6IGZ1bmN0aW9uIHJlZihfcmVmMikge1xuICAgICAgICAgIHJldHVybiBfdGhpczIuX2NhbnZhcyA9IF9yZWYyO1xuICAgICAgICB9XG4gICAgICB9LCBvdGhlclByb3BzKSksIGltZyk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFFSQ29kZUNhbnZhcztcbn0oUmVhY3QuUHVyZUNvbXBvbmVudCk7XG5cbl9kZWZpbmVQcm9wZXJ0eShRUkNvZGVDYW52YXMsICJkZWZhdWx0UHJvcHMiLCBERUZBVUxUX1BST1BTKTtcblxuaWYgKGZhbHNlKSB7fVxuXG52YXIgUVJDb2RlU1ZHID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uIChfUmVhY3QkUHVyZUNvbXBvbmVudDIpIHtcbiAgX2luaGVyaXRzKFFSQ29kZVNWRywgX1JlYWN0JFB1cmVDb21wb25lbnQyKTtcblxuICBmdW5jdGlvbiBRUkNvZGVTVkcoKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFFSQ29kZVNWRyk7XG5cbiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFFSQ29kZVNWRykuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoUVJDb2RlU1ZHLCBbe1xuICAgIGtleTogInJlbmRlciIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHZhciBfdGhpcyRwcm9wczMgPSB0aGlzLnByb3BzLFxuICAgICAgICAgIHZhbHVlID0gX3RoaXMkcHJvcHMzLnZhbHVlLFxuICAgICAgICAgIHNpemUgPSBfdGhpcyRwcm9wczMuc2l6ZSxcbiAgICAgICAgICBsZXZlbCA9IF90aGlzJHByb3BzMy5sZXZlbCxcbiAgICAgICAgICBiZ0NvbG9yID0gX3RoaXMkcHJvcHMzLmJnQ29sb3IsXG4gICAgICAgICAgZmdDb2xvciA9IF90aGlzJHByb3BzMy5mZ0NvbG9yLFxuICAgICAgICAgIGluY2x1ZGVNYXJnaW4gPSBfdGhpcyRwcm9wczMuaW5jbHVkZU1hcmdpbixcbiAgICAgICAgICBpbWFnZVNldHRpbmdzID0gX3RoaXMkcHJvcHMzLmltYWdlU2V0dGluZ3MsXG4gICAgICAgICAgb3RoZXJQcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfdGhpcyRwcm9wczMsIFsidmFsdWUiLCAic2l6ZSIsICJsZXZlbCIsICJiZ0NvbG9yIiwgImZnQ29sb3IiLCAiaW5jbHVkZU1hcmdpbiIsICJpbWFnZVNldHRpbmdzIl0pOyAvLyBXZVwnbGwgdXNlIHR5cGU9PT0tMSB0byBmb3JjZSBRUkNvZGUgdG8gYXV0b21hdGljYWxseSBwaWNrIHRoZSBiZXN0IHR5cGVcblxuXG4gICAgICB2YXIgcXJjb2RlID0gbmV3IFFSQ29kZUltcGwoLTEsIEVycm9yQ29ycmVjdExldmVsW2xldmVsXSk7XG4gICAgICBxcmNvZGUuYWRkRGF0YShjb252ZXJ0U3RyKHZhbHVlKSk7XG4gICAgICBxcmNvZGUubWFrZSgpO1xuICAgICAgdmFyIGNlbGxzID0gcXJjb2RlLm1vZHVsZXM7XG5cbiAgICAgIGlmIChjZWxscyA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgdmFyIG1hcmdpbiA9IGluY2x1ZGVNYXJnaW4gPyBNQVJHSU5fU0laRSA6IDA7XG4gICAgICB2YXIgbnVtQ2VsbHMgPSBjZWxscy5sZW5ndGggKyBtYXJnaW4gKiAyO1xuICAgICAgdmFyIGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzID0gZ2V0SW1hZ2VTZXR0aW5ncyh0aGlzLnByb3BzLCBjZWxscyk7XG4gICAgICB2YXIgaW1hZ2UgPSBudWxsO1xuXG4gICAgICBpZiAoaW1hZ2VTZXR0aW5ncyAhPSBudWxsICYmIGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzLmV4Y2F2YXRpb24gIT0gbnVsbCkge1xuICAgICAgICAgIGNlbGxzID0gZXhjYXZhdGVNb2R1bGVzKGNlbGxzLCBjYWxjdWxhdGVkSW1hZ2VTZXR0aW5ncy5leGNhdmF0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGltYWdlID0gUmVhY3QuY3JlYXRlRWxlbWVudCgiaW1hZ2UiLCB7XG4gICAgICAgICAgeGxpbmtIcmVmOiBpbWFnZVNldHRpbmdzLnNyYyxcbiAgICAgICAgICBoZWlnaHQ6IGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzLmgsXG4gICAgICAgICAgd2lkdGg6IGNhbGN1bGF0ZWRJbWFnZVNldHRpbmdzLncsXG4gICAgICAgICAgeDogY2FsY3VsYXRlZEltYWdlU2V0dGluZ3MueCArIG1hcmdpbixcbiAgICAgICAgICB5OiBjYWxjdWxhdGVkSW1hZ2VTZXR0aW5ncy55ICsgbWFyZ2luLFxuICAgICAgICAgIHByZXNlcnZlQXNwZWN0UmF0aW86ICJub25lIlxuICAgICAgICB9KTtcbiAgICAgIH0gLy8gRHJhd2luZyBzdHJhdGVneTogaW5zdGVhZCBvZiBhIHJlY3QgcGVyIG1vZHVsZSwgd2VcJ3JlIGdvaW5nIHRvIGNyZWF0ZSBhXG4gICAgICAvLyBzaW5nbGUgcGF0aCBmb3IgdGhlIGRhcmsgbW9kdWxlcyBhbmQgbGF5ZXIgdGhhdCBvbiB0b3Agb2YgYSBsaWdodCByZWN0LFxuICAgICAgLy8gZm9yIGEgdG90YWwgb2YgMiBET00gbm9kZXMuIFdlIHBheSBhIGJpdCBtb3JlIGluIHN0cmluZyBjb25jYXQgYnV0IHRoYXRcJ3NcbiAgICAgIC8vIHdheSBmYXN0ZXIgdGhhbiBET00gb3BzLlxuICAgICAgLy8gRm9yIGxldmVsIDEsIDQ0MSBub2RlcyAtPiAyXG4gICAgICAvLyBGb3IgbGV2ZWwgNDAsIDMxMzI5IC0+IDJcblxuXG4gICAgICB2YXIgZmdQYXRoID0gZ2VuZXJhdGVQYXRoKGNlbGxzLCBtYXJnaW4pO1xuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIF9leHRlbmRzKHtcbiAgICAgICAgc2hhcGVSZW5kZXJpbmc6ICJjcmlzcEVkZ2VzIixcbiAgICAgICAgaGVpZ2h0OiBzaXplLFxuICAgICAgICB3aWR0aDogc2l6ZSxcbiAgICAgICAgdmlld0JveDogIjAgMCAiLmNvbmNhdChudW1DZWxscywgIiAiKS5jb25jYXQobnVtQ2VsbHMpXG4gICAgICB9LCBvdGhlclByb3BzKSwgUmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgICAgICAgZmlsbDogYmdDb2xvcixcbiAgICAgICAgZDogIk0wLDAgaCIuY29uY2F0KG51bUNlbGxzLCAidiIpLmNvbmNhdChudW1DZWxscywgIkgweiIpXG4gICAgICB9KSwgUmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgICAgICAgZmlsbDogZmdDb2xvcixcbiAgICAgICAgZDogZmdQYXRoXG4gICAgICB9KSwgaW1hZ2UpO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBRUkNvZGVTVkc7XG59KFJlYWN0LlB1cmVDb21wb25lbnQpO1xuXG5fZGVmaW5lUHJvcGVydHkoUVJDb2RlU1ZHLCAiZGVmYXVsdFByb3BzIiwgREVGQVVMVF9QUk9QUyk7XG5cbmlmIChmYWxzZSkge31cblxudmFyIFFSQ29kZSA9IGZ1bmN0aW9uIFFSQ29kZShwcm9wcykge1xuICB2YXIgcmVuZGVyQXMgPSBwcm9wcy5yZW5kZXJBcyxcbiAgICAgIG90aGVyUHJvcHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMocHJvcHMsIFsicmVuZGVyQXMiXSk7XG5cbiAgdmFyIENvbXBvbmVudCA9IHJlbmRlckFzID09PSBcJ3N2Z1wnID8gUVJDb2RlU1ZHIDogUVJDb2RlQ2FudmFzO1xuICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChDb21wb25lbnQsIG90aGVyUHJvcHMpO1xufTtcblxuUVJDb2RlLmRlZmF1bHRQcm9wcyA9IF9vYmplY3RTcHJlYWQoe1xuICByZW5kZXJBczogXCdjYW52YXNcJ1xufSwgREVGQVVMVF9QUk9QUyk7XG5tb2R1bGUuZXhwb3J0cyA9IFFSQ29kZTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3FyY29kZS5yZWFjdC9saWIvaW5kZXguanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCdmdW5jdGlvbiBfdHlwZW9mKG9iaikge1xuICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO1xuXG4gIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtcbiAgICAgIHJldHVybiB0eXBlb2Ygb2JqO1xuICAgIH07XG5cbiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO1xuICAgIH07XG5cbiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIF90eXBlb2Yob2JqKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mO1xubW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzPycpfSxmdW5jdGlvbihtb2R1bGUpe2V2YWwoJ21vZHVsZS5leHBvcnRzID0gSlNPTi5wYXJzZSgie1xcImxhbmd1YWdlXFwiOlxcIkxhbmd1YWdlXFwiLFxcImF1dG9fZGV0ZWN0XFwiOlxcIkF1dG8gRGV0ZWN0XFwiLFxcImRvd25sb2FkXFwiOlxcIkRvd25sb2FkXFwiLFxcImxpdmVfc3RyZWFtXFwiOlxcIkxpdmUgU3RyZWFtXFwiLFxcImxpdmVfc3RyZWFtX3Rvb2x0aXBcXCI6XFwiWW91IGNhblwndCBkb3dubG9hZCBMaXZlIFN0cmVhbXMgeWV0LCBidXQgd2UgYXJlIHdvcmtpbmcgb24gaXQgOilcXCIsXFwicmV0dXJuX3RvX3RoZV9wcmV2aW91c19zY3JlZW5cXCI6XFwiQmFja1xcIixcXCJzZXR0aW5nc1xcIjpcXCJTZXR0aW5nc1xcIixcXCJzZXR0aW5nc19zaG93X2Zvcm1hdHNfYXZhaWxhYmxlX3ZpYV91ZGxcXCI6XFwiU2hvdyBmb3JtYXRzIGF2YWlsYWJsZSB2aWEgVURMIENsaWVudFxcIixcXCJzZXR0aW5nc19zaG93X2Zvcm1hdHNfcmVxdWlyZWRfb25saW5lX2NvbnZlcnNpb25cXCI6XFwiU2hvdyBmb3JtYXRzIHJlcXVpcmVkIG9ubGluZSBjb252ZXJzaW9uXFwiLFxcInNldHRpbmdzX3Nob3dfc25hcHNob3RfYnV0dG9uXFwiOlxcIlNob3cgdGhlIHZpZGVvIOKAi3NuYXBzaG90IGJ1dHRvblxcIixcXCJzZXR0aW5nc193YXJuX2JlZm9yZV9jb252ZXJ0aW5nXFwiOlxcIldhcm4gYmVmb3JlIGNvbnZlcnRpbmdcXCIsXFwiY29uZmlybV9jb252ZXJzaW9uX3RpdGxlXFwiOlxcIlRoZSBzZWxlY3RlZCBmaWxlIGZvcm1hdCByZXF1aXJlcyBjb252ZXJzaW9uIVxcIixcXCJjb25maXJtX2NvbnZlcnNpb25fbWVzc2FnZVxcIjpcXCJDb252ZXJzaW9uIGFjdGl2ZWx5IHVzZXMgaGFyZHdhcmUgcmVzb3VyY2VzLCB0aGlzIG1heSBjYXVzZSBhIHRlbXBvcmFyeSBkZWNyZWFzZSBpbiB0aGUgc3BlZWQgb2YgdGhlIGJyb3dzZXIsIGluY2x1ZGluZyBpbiBvdGhlciB0YWJzLlxcIixcXCJkb19ub3Rfc2hvd19vbl9sb2FkXFwiOlxcIkRvblwndCBzaG93IG9uIGxvYWRcXCIsXFwiY2FuY2VsXFwiOlxcIkNhbmNlbFxcIixcXCJjb250aW51ZVxcIjpcXCJDb250aW51ZVxcIixcXCJmb3JtYXRzX2Zvcl9kb3dubG9hZFxcIjpcXCJGb3JtYXRzIGZvciBkb3dubG9hZFxcIixcXCJhbGxfZm9ybWF0c19mb3JfZG93bmxvYWRcXCI6XFwiQWxsIGZvcm1hdHMgZm9yIGRvd25sb2FkXFwiLFxcIm1vcmVfZm9ybWF0c1xcIjpcXCJNb3JlIGZvcm1hdHNcXCIsXFwiY29udmVyc2lvbl9yZXF1aXJlZFxcIjpcXCJDb252ZXJzaW9uIHJlcXVpcmVkXFwiLFxcInVkbF9wb3J0YWxcXCI6XFwiVURMIFBvcnRhbFxcIixcXCJkb3dubG9hZF92aWFfdW5pZG93bmxvYWRlclxcIjpcXCJEb3dubG9hZCB0aGUgcmVxdWlyZWQgZm9ybWF0IHZpYSB1bmlkb3dubG9hZGVyLmNvbVxcIixcXCJkb3dubG9hZF92aWFfdW5pZG93bmxvYWRlcl90b29sdGlwXFwiOlxcIkRvd25sb2FkIHZpYSB1bmlkb3dubG9hZGVyLmNvbVxcIixcXCJ1ZGxfY2xpZW50XFwiOlxcIlVETCBDbGllbnRcXCIsXFwiZG93bmxvYWRfdXNpbmdfdWRsXFwiOlxcIkRvd25sb2FkIHRoZSByZXF1aXJlZCBmb3JtYXQgdXNpbmcgVURMIENsaWVudFxcIixcXCJkb3dubG9hZF91c2luZ191ZGxfdG9vbHRpcFxcIjpcXCJEb3dubG9hZCB1c2luZyBVREwgQ2xpZW50XFwiLFxcInFyX2NvZGVfdG9vbHRpcFxcIjpcXCJHZXQgUVIgQ29kZVxcIixcXCJjb3B5X2xpbmtfdG9fY2xpcGJvYXJkX3Rvb2x0aXBcXCI6XFwiQ29weSBsaW5rIHRvIGNsaXBib2FyZFxcIixcXCJjb3B5X2xpbmtfdG9fY2xpcGJvYXJkX25vdGlmaWNhdGlvbl9tZXNzYWdlXFwiOlxcIkxpbmsgY29waWVkIHRvIGNsaXBib2FyZFxcIixcXCJhY3RpdmVfZG93bmxvYWRfd2FybmluZ19ub3RpZmljYXRpb25fbWVzc2FnZVxcIjpcXCJFdmVyeXRoaW5nXCdzIHVuZGVyIGNvbnRyb2whXFwiLFxcImFjdGl2ZV9kb3dubG9hZF93YXJuaW5nX25vdGlmaWNhdGlvbl9kZXNjcmlwdGlvblxcIjpcXCJZb3UgaGF2ZSBsZWZ0IHRoZSBwYWdlIHdpdGggYW4gYWN0aXZlIGRvd25sb2FkLCBpdCB3aWxsIGNvbnRpbnVlIGluIHRoZSBiYWNrZ3JvdW5kLlxcIixcXCJjYW5jZWxfY29udmVyc2lvblxcIjpcXCJDYW5jZWwgY29udmVyc2lvblxcIixcXCJjYW5jZWxfZG93bmxvYWRcXCI6XFwiQ2FuY2VsIGRvd25sb2FkXFwiLFxcInRha2Vfc2NyZWVuc2hvdF90b29sdGlwXFwiOlxcIlRha2Ugc2NyZWVuc2hvdFxcIixcXCJkcm9wX3VzX2FfbGluZVxcIjpcXCJEaWRuXCd0IGZpbmQgYW4gYW5zd2VyPyBEcm9wIHVzIGEgbGluZSA7KVxcIixcXCJoZWxwXFwiOlxcIkhlbHBcXCIsXFwiaGVscF9hcnRpY2xlc1xcIjpbe1xcInRpdGxlXFwiOlxcIkhvdyB0byBkb3dubG9hZD9cXCIsXFwiYXJ0aWNsZVxcIjpcXCJZb3UgY2FuIGRvd25sb2FkIHRoZSBkZWZhdWx0IGZvcm1hdCBieSBjbGlja2luZyBvbiB0aGUgPGI+VURMIEhlbHBlcjwvYj4gYnV0dG9uIGJlbG93IHRoZSB2aWRlby4gQWxzbyB5b3UgY2FuIGNob29zZSB0aGUgZGVzaXJlZCBmb3JtYXQgaW4gdGhlIGRyb3AtZG93biBsaXN0LlxcIn0se1xcInRpdGxlXFwiOlxcIldoaWNoIHZpZGVvIGZvcm1hdCBzaG91bGQgSSBjaG9vc2U/XFwiLFxcImFydGljbGVcXCI6XFwiVGhlIGJlc3QgcXVhbGl0eSBpcyBhdmFpbGFibGUgaW4gPGI+RnVsbEhEICgxMDgwcCk8L2I+LCA8Yj4ySyAoMTQ0MHApPC9iPiwgPGI+NEsgKDIxNjBwKTwvYj4gYW5kIDxiPjhLICg0MzIwcCk8L2I+LiBUaGUgZ2VuZXJhbCByZWNvbW1lbmRhdGlvbiBpcyB0aGF0IHRoZSBoaWdoZXIgeW91ciBzY3JlZW4gcmVzb2x1dGlvbiB0aGUgYmV0dGVyIHRoZSB2aWRlbyBxdWFsaXR5IHNob3VsZCBiZS4gSG93ZXZlciwgeW91IGhhdmUgdG8gY29uc2lkZXIgb3RoZXIgZmFjdG9ycyBhcyB3ZWxsOiBkb3dubG9hZCBzcGVlZCwgYW1vdW50IG9mIGZyZWUgc3BhY2UsIGFuZCB0aGUgZGV2aWNlIHBlcmZvcm1hbmNlIGR1cmluZyBwbGF5YmFjay5cXCJ9LHtcXCJ0aXRsZVxcIjpcXCJXaHkgZG9lcyBhIGJyb3dzZXIvY29tcHV0ZXIgZnJlZXplcyB3aGlsZSBkb3dubG9hZGluZz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCJUaGUgYnJvd3Nlci9jb21wdXRlciBzaG91bGQgbm90IGNvbXBsZXRlbHkgZnJlZXplISBJZiB0aGlzIGhhcHBlbnMgcGxlYXNlIHJlcG9ydCBpdCB0aHJvdWdoIHRoZSBmZWVkYmFjayBmb3JtLCBpbmRpY2F0aW5nIHRoZSB2aWRlbyBsaW5rLiBVbmZvcnR1bmF0ZWx5LCBzb21lIHZpZGVvIGZvcm1hdHMgY2Fubm90IGJlIGRvd25sb2FkZWQgZnJvbSBZb3VUdWJlIGRpcmVjdGx5LiBUaGVyZWZvcmUsIHdlIGhhdmUgYWRkZWQgdGhlIHBvc3NpYmlsaXR5IHRvIGNvbnZlcnQgc21hbGwgdmlkZW9zIG9ubGluZSB0byB0aGUgZGVzaXJlZCBmb3JtYXQgaW4gPGI+VURMIEhlbHBlcjwvYj4uIEluIHNvbWUgY2FzZXMgdGhpcyBwcm9jZXNzIHVzZXMgY29tcHV0ZXIgcmVzb3VyY2VzIHRvbyBhY3RpdmVseS5cXCJ9LHtcXCJ0aXRsZVxcIjpcXCJXaHkgSSBjYW5cJ3QgZG93bmxvYWQgYSB2aWRlbyBpbiB0aGUgZGVzaXJlZCBmb3JtYXQgZGlyZWN0bHk/XFwiLFxcImFydGljbGVcXCI6XFwiU29tZSB2aWRlbyBmaWxlIGZvcm1hdHMgY2FuIG5vdCBiZSBkb3dubG9hZGVkIGRpcmVjdGx5IGR1ZSB0byBjZXJ0YWluIHRlY2huaWNhbCBwcm9wZXJ0aWVzIG9mIFlvdVR1YmUuIEhlbmNlLCB0aGUgPGI+VURMIEhlbHBlcjwvYj4gaGFzIGFuIGFkZGl0aW9uYWwgZmVhdHVyZSB0byBjb252ZXJ0IG9ubGluZSBzaG9ydCB2aWRlb3MgaW50byB0aGUgZGVzaXJlZCBmb3JtYXQuIExhcmdlIHZpZGVvcyAobG9uZ2VyIGFuZC9vciBoaWdoIHF1YWxpdHkpIHJlcXVpcmUgbWFueSByZXNvdXJjZXMgZm9yIG9ubGluZSBjb252ZXJzaW9uLCB3aGljaCBzb21ldGltZXMgY2FuIGZyZWV6ZSB5b3VyIGJyb3dzZXIvY29tcHV0ZXIuIFRoZXJlZm9yZSwgaXQgaXMgc3VnZ2VzdGVkIHRvIHVwbG9hZCB0aGVzZSB2aWRlb3MgdGhyb3VnaCB0aGUgPGI+PGEgaHJlZj1cXFxcXFwiaHR0cHM6Ly91bmlkb3dubG9hZGVyLmNvbS97JWxhbmclfS91ZGwtY2xpZW50LXlvdXR1YmUtZG93bmxvYWRlci1hbmQtY29udmVydGVyXFxcXFxcIiB0YXJnZXQ9XFxcXFxcXFxcXFxcXFwiX2JsYW5rXFxcXFxcXFxcXFxcXFwiPlVETCBDbGllbnQgZm9yIFdpbmRvd3M8L2E+PC9iPi5cXCJ9LHtcXCJ0aXRsZVxcIjpcXCJIb3cgY2FuIEkgZ2V0IGEgdmlkZW8vYXVkaW8gZG93bmxvYWQgbGluaz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCJEaXJlY3QgZG93bmxvYWQgbGluayBpcyBhdmFpbGFibGUgb25seSBmb3IgdGhvc2UgZm9ybWF0cyB0aGF0IGRvIG5vdCByZXF1aXJlIGNvbnZlcnNpb24uIFRvIGRvIHNvLCBjbGljayBvbiB0aGUgaWNvbiZuYnNwO1x4M2MhLS1baW1nLWNvcHldLS1ceDNlIGluIGEgbGluZSB3aXRoIGFwcHJvcHJpYXRlIGRvd25sb2FkIG9wdGlvbiwgYW5kIHRoZW4gcGFzdGUgaXQgYXMgdGV4dCB3aGVyZSBuZWNlc3NhcnkuXFwifSx7XFwidGl0bGVcXCI6XFwiSG93IHRvIGRvd25sb2FkIDYwIGZwcyB2aWRlbz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCJJdFwncyBlbm91Z2ggdG8gY2hvb3NlIGNvcnJlc3BvbmRpbmcgZG93bmxvYWQgb3B0aW9uLCB3aGljaCBjYW4gYmUgaWRlbnRpZmllZCBieSB0aGUgaWNvbiZuYnNwO1x4M2MhLS1baW1nLWZwcy02MF0tLVx4M2UuIEhvd2V2ZXIsIHN1Y2ggb3B0aW9ucyBhcmUgbm90IGFsd2F5cyBhdmFpbGFibGUuIEZpcnN0IG9mIGFsbCwgdGhlIG9yaWdpbmFsIHZpZGVvIG11c3QgaGF2ZSBhdCBsZWFzdCA2MCBGUFMuIEFsc28sIGl0IG11c3QgYmUgYXZhaWxhYmxlIGZvciB2aWV3aW5nIGluIHRoZSBZb3VUdWJlIHBsYXllciB3aXRoIDYwIEZQUyByYXRlLlxcIn0se1xcInRpdGxlXFwiOlxcIkhvdyB0byBkb3dubG9hZCBhbiBhdWRpbyB0cmFjayAobXVzaWMpIGluIE1QMz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCJVbmZvcnR1bmF0ZWx5LCBpdFwncyBub3QgcG9zc2libGUgdG8gZG93bmxvYWQgTVAzIGZvcm1hdCBkaXJlY3RseSBhdCB0aGUgbW9tZW50LiBZb3VUdWJlIGRvZXMgbm90IHN1cHBvcnQgaXQsIGFuZCB0aGUgcmVxdWlyZWQgb25saW5lIGNvbnZlcnNpb24gaXMgdW5zdGFibGUuIFVzZSBvdXIgPGI+PGEgaHJlZj1cXFxcXFwiaHR0cHM6Ly91bmlkb3dubG9hZGVyLmNvbS97JWxhbmclfS91ZGwtY2xpZW50LXlvdXR1YmUtZG93bmxvYWRlci1hbmQtY29udmVydGVyXFxcXFxcIiB0YXJnZXQ9XFxcXFxcXFxcXFxcXFwiX2JsYW5rXFxcXFxcXFxcXFxcXFwiPlVETCBDbGllbnQgZm9yIFdpbmRvd3M8L2E+PC9iPiB0aGF0IGNhbiBjb252ZXJ0IHZpZGVvIGZpbGVzIHRvIE1QMy4gT3Igc2VsZWN0IGFueSBvdGhlciBhdWRpbyBmb3JtYXQgZnJvbSB0aGUgbGlzdCAoaW5kaWNhdGVkIGJ5IHRoZSBpY29uJm5ic3A7XHgzYyEtLVtpbWctc291bmQtb25dLS1ceDNlKS5cXCJ9LHtcXCJ0aXRsZVxcIjpcXCJIb3cgdG8gdGFrZSBhIHNjcmVlbnNob3Q/XFwiLFxcImFydGljbGVcXCI6XFwiTWFrZSBzdXJlIHRoYXQgaW4gdGhlIDxhIGRhdGEtdW5pZG93bmxvYWRlci1wYWdlPVxcXFxcXCJzZXR0aW5nc1xcXFxcXCI+c2V0dGluZ3M8L2E+IHRoZXJlIGlzIGEgY2hlY2tib3ggb3Bwb3NpdGUgdGhlIGl0ZW0gPGI+XFxcXFxcIlNob3cgdGhlIHZpZGVvIOKAi3NuYXBzaG90IGJ1dHRvblxcXFxcXCI8L2I+LiBJbiB0aGUgbG93ZXIgcmlnaHQgY29ybmVyIG9mIHRoZSBwbGF5ZXIgdG8gdGhlIGxlZnQgb2YgdGhlIDxiPlxcXFxcXCJTZXR0aW5nc1xcXFxcXCI8L2I+IGljb24sIHRoZSA8Yj5cXFxcXFwiVGFrZSBzY3JlZW5zaG90XFxcXFxcIjwvYj4gaWNvbiZuYnNwO1x4M2MhLS1baW1nLWNhbWVyYV0tLVx4M2Ugc2hvdWxkIGFwcGVhciwgYnkgY2xpY2tpbmcgb24gd2hpY2ggdGhlIGN1cnJlbnQgZnJhbWUgZnJvbSB0aGUgdmlkZW8gd2lsbCBiZSBzYXZlZCB0byB5b3VyIGNvbXB1dGVyIGluIGpwZWcgZm9ybWF0LlxcIn0se1xcInRpdGxlXFwiOlxcIkhvdyB0byBkaXNwbGF5IHRoZSBpbnRlcmZhY2Ugb24gY2xpY2sgdGhlIGRvd25sb2FkIGJ1dHRvbiwgbm90IG9uIGhvdmVyIG92ZXIgaXQ/XFwiLFxcImFydGljbGVcXCI6XFwiWW91IGNhbiBjaG9vc2UgYSBidXR0b24gc3R5bGUgaW4gdGhlIDxhIGRhdGEtdW5pZG93bmxvYWRlci1wYWdlPVxcXFxcXCJzZXR0aW5nc1xcXFxcXCI+c2V0dGluZ3M8L2E+OiA8dWw+PGxpPjxiPm1vZGVybjwvYj4gKGludGVyZmFjZSBhcHBlYXJzIG9uIG1vdXNlIG92ZXIpPC9saT48bGk+PGI+Y2xhc3NpYzwvYj4gKGludGVyZmFjZSBhcHBlYXJzIG9uIGNsaWNrKTwvbGk+PC91bD5cXCJ9LHtcXCJ0aXRsZVxcIjpcXCJXaHkgeW91IG5lZWQgUVIgY29kZXM/XFwiLFxcImFydGljbGVcXCI6XFwiVXNpbmcgUVIgY29kZXMgeW91IGNhbiBnZXQgYSBkaXJlY3QgbGluayB0byB2aWRlbyBvciBhdWRpbyBvbiBhbnkgZGV2aWNlIHdpdGggYSBjYW1lcmEuIE1ha2Ugc3VyZSB0aGUgPGI+XFxcXFxcIkRpc3BsYXkgUVIgQ29kZXNcXFxcXFwiPC9iPiBpdGVtIGlzIGVuYWJsZWQgaW4gdGhlIDxhIGRhdGEtdW5pZG93bmxvYWRlci1wYWdlPVxcXFxcXCJzZXR0aW5nc1xcXFxcXCI+VURMIEhlbHBlciBzZXR0aW5nczwvYT4uIFNvbWUgZG93bmxvYWQgb3B0aW9ucyB3aWxsIGhhdmUgYSBcXFxcXFwiR2V0IFFSIENvZGVcXFxcXFwiIGljb24mbmJzcDtceDNjIS0tW2ltZy1xci1jb2RlXS0tXHgzZSwgYnkgY2xpY2tpbmcgb24gd2hpY2ggeW91IHdpbGwgc2VlIGEgUVIgY29kZSBhbmQgaW5zdHJ1Y3Rpb25zIGZvciB5b3VyIHBob25lIG9yIHRhYmxldC5cXCJ9XSxcXCJzZXR0aW5nc190aXRsZV9hcHBfYnV0dG9uX3N0eWxlXFwiOlxcIkJ1dHRvbiBzdHlsZVxcIixcXCJzZXR0aW5nc19hcHBfYnV0dG9uX3N0eWxlX3NvbGlkXFwiOlxcIk1vZGVybiAoaW50ZXJmYWNlIGFwcGVhcnMgb24gbW91c2Ugb3ZlcilcXCIsXFwic2V0dGluZ3NfYXBwX2J1dHRvbl9zdHlsZV9zcGxpdFxcIjpcXCJDbGFzc2ljIChpbnRlcmZhY2UgYXBwZWFycyBvbiBjbGljaylcXCIsXFwic2V0dGluZ3NfZGlzcGxheV9xcl9jb2Rlc1xcIjpcXCJEaXNwbGF5IFFSIENvZGVzXFwiLFxcInFyX2NvZGVfdGl0bGVcXCI6XFwiUVIgY29kZSBmb3IgbW9iaWxlIGRldmljZVxcIixcXCJxcl9jb2RlX2Rlc2NyaXB0aW9uXFwiOlxcIkl0XCdzIGVhc3kgdG8gc2VuZCB0aGUgZGlyZWN0IGRvd25sb2FkIGxpbmsgdG8geW91ciBzbWFydHBob25lIG9yIHRhYmxldCAtIGp1c3QgbGF1bmNoIGEgUVIgY29kZSBzY2FubmVyIGFuZCBob3ZlciBvdmVyIHRoZSBpbWFnZSBhYm92ZS5cXCIsXFwicXJfY29kZV9lcnJvclxcIjpcXCJRUi1jb2RlIHNlcnZpY2UgaXMgdW5hdmFpbGFiZWwgZm9yIG5vdy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cXCIsXFwic2hvd195YW5kZXhfbWFya2V0X2FkdmlzZXJcXCI6XFwiU2hvdyBZYW5kZXguTWFya2V0IEFkdmlzZXIgLSBiZXN0IGRlYWxzIHByaWNlIGNvbXBhcmlzb24gd2lkZ2V0XFwiLFxcIndhcm5pbmdcXCI6XFwiV2FybmluZyFcXCIsXFwieWFuZGV4X21hcmtldF9hZHZpc2VyX25vdGlmaWNhdGlvbl9kZXNjcmlwdGlvblxcIjpcXCJDaGFuZ2VzIHdpbGwgdGFrZSBlZmZlY3QgYWZ0ZXIgcmVsb2FkaW5nIHRoZSBwYWdlIHdpdGggdGhlIFlhbmRleC5NYXJrZXQgQWR2aXNlciB3aWRnZXQuXFwiLFxcInNvY2lhbF9tZWRpYV9zaGFyaW5nX3RpdGxlXFwiOlxcIkp1c3QgYSBtb21lbnQgcGxlYXNlIVxcIixcXCJzb2NpYWxfbWVkaWFfc2hhcmluZ19tZXNzYWdlXFwiOlxcIldpdGggb3VyIGJyb3dzZXIgZXh0ZW5zaW9uIHlvdSBoYXZlIHslYWxyZWFkeSV9ZG93bmxvYWRlZCB7JWRvd25sb2Fkc0NvdW50JX0geyV2aWRlbyV9IDopXFxcXG5UbyBrZWVwIFVETCBIZWxwZXIgZnJlZSB3ZSBuZWVkIHlvdXIgaGVscCAtIHRlbGwgYWJvdXQgdXMgb24gc29jaWFsIG5ldHdvcmtzIG9yIG1lc3NlbmdlcnMhXFwiLFxcInNvY2lhbF9tZWRpYV9zaGFyaW5nX2J1dHRvbl9va1xcIjpcXCJTaGFyZSB3aXRoIGZyaWVuZHNcXCIsXFwic29jaWFsX21lZGlhX3NoYXJpbmdfYnV0dG9uX2NhbmNlbFxcIjpcXCJOb3Qgbm93XFwiLFxcImFscmVhZHlcXCI6XFwiYWxyZWFkeVxcIixcXCJwbHVyYWxfdmlkZW9cXCI6XFwidmlkZW8sdmlkZW9zXFwiLFxcImRpcmVjdF9saW5rc191bmF2YWlsYWJsZVxcIjpcXCJEaXJlY3QgbGlua3MgYXJlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlLiA8YSBkYXRhLXVuaWRvd25sb2FkZXItZnVuY3Rpb249XFxcXFxcInJlbG9hZFxcXFxcXCI+VHJ5IHRvIHJlbG9hZCB0aGUgcGFnZSAoRjUga2V5KTwvYT5cXCJ9Iik7XG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL3NyYy93aWRnZXQvaTE4bi9lbi90cmFuc2xhdGlvbi5qc29uPycpfSxmdW5jdGlvbihtb2R1bGUpe2V2YWwoJ21vZHVsZS5leHBvcnRzID0gSlNPTi5wYXJzZSgie1xcImxhbmd1YWdlXFwiOlxcItCv0LfRi9C6XFwiLFxcImF1dG9fZGV0ZWN0XFwiOlxcItCQ0LLRgtC+0L7Qv9GA0LXQtNC10LvQtdC90LjQtVxcIixcXCJkb3dubG9hZFxcIjpcXCLQodC60LDRh9Cw0YLRjFxcIixcXCJsaXZlX3N0cmVhbVxcIjpcXCLQotGA0LDQvdGB0LvRj9GG0LjRj1xcIixcXCJsaXZlX3N0cmVhbV90b29sdGlwXFwiOlxcItCi0YDQsNC90YHQu9GP0YbQuNC4INGB0LrQsNGH0LjQstCw0YLRjCDQtdGJ0ZEg0L3QtdC70YzQt9GPLCDQvdC+INC80Ysg0YPQttC1INGA0LDQsdC+0YLQsNC10Lwg0L3QsNC0INGN0YLQuNC8IDopXFwiLFxcInJldHVybl90b190aGVfcHJldmlvdXNfc2NyZWVuXFwiOlxcItCd0LDQt9Cw0LRcXCIsXFwic2V0dGluZ3NcXCI6XFwi0J3QsNGB0YLRgNC+0LnQutC4XFwiLFxcInNldHRpbmdzX3Nob3dfZm9ybWF0c19hdmFpbGFibGVfdmlhX3VkbFxcIjpcXCLQntGC0L7QsdGA0LDQttCw0YLRjCDRhNC+0YDQvNCw0YLRiywg0LTQvtGB0YLRg9C/0L3Ri9C1INGH0LXRgNC10LcgVURMIENsaWVudFxcIixcXCJzZXR0aW5nc19zaG93X2Zvcm1hdHNfcmVxdWlyZWRfb25saW5lX2NvbnZlcnNpb25cXCI6XFwi0J7RgtC+0LHRgNCw0LbQsNGC0Ywg0YTQvtGA0LzQsNGC0YssINGC0YDQtdCx0YPRjtGJ0LjQtSDQvtC90LvQsNC50L0t0LrQvtC90LLQtdGA0YLQsNGG0LjQuFxcIixcXCJzZXR0aW5nc19zaG93X3NuYXBzaG90X2J1dHRvblxcIjpcXCLQntGC0L7QsdGA0LDQttCw0YLRjCDQutC90L7Qv9C60YMg0YHQvtGF0YDQsNC90LXQvdC40Y8g0YHQutGA0LjQvdGI0L7RgtCwINC40Lcg0LLQuNC00LXQvlxcIixcXCJzZXR0aW5nc193YXJuX2JlZm9yZV9jb252ZXJ0aW5nXFwiOlxcItCf0YDQtdC00YPQv9GA0LXQttC00LDRgtGMINC/0YDQuCDQutC+0L3QstC10YDRgtCw0YbQuNC4XFwiLFxcImNvbmZpcm1fY29udmVyc2lvbl90aXRsZVxcIjpcXCLQktGL0LHRgNCw0L3QvdGL0Lkg0YTQvtGA0LzQsNGCINGE0LDQudC70LAg0YLRgNC10LHRg9C10YIg0LrQvtC90LLQtdGA0YLQsNGG0LjQuCFcXCIsXFwiY29uZmlybV9jb252ZXJzaW9uX21lc3NhZ2VcXCI6XFwi0JrQvtC90LLQtdGA0YLQsNGG0LjRjyDQsNC60YLQuNCy0L3QviDQuNGB0L/QvtC70YzQt9GD0LXRgiDRgNC10YHRg9GA0YHRiyDQutC+0LzQv9GM0Y7RgtC10YDQsCwg0YfRgtC+INC80L7QttC10YIg0LLRi9C30LLQsNGC0Ywg0LLRgNC10LzQtdC90L3QvtC1INGB0L3QuNC20LXQvdC40LUg0YHQutC+0YDQvtGB0YLQuCDRgNCw0LHQvtGC0Ysg0LHRgNCw0YPQt9C10YDQsCwg0LIg0YLQvtC8INGH0LjRgdC70LUg0Lgg0LIg0LTRgNGD0LPQuNGFINCy0LrQu9Cw0LTQutCw0YUuXFwiLFxcImRvX25vdF9zaG93X29uX2xvYWRcXCI6XFwi0J3QtSDQv9C+0LrQsNC30YvQstCw0YLRjCDQv9GA0Lgg0LfQsNCz0YDRg9C30LrQtVxcIixcXCJjYW5jZWxcXCI6XFwi0J7RgtC80LXQvdCwXFwiLFxcImNvbnRpbnVlXFwiOlxcItCf0YDQvtC00L7Qu9C20LjRgtGMXFwiLFxcImZvcm1hdHNfZm9yX2Rvd25sb2FkXFwiOlxcItCS0LDRgNC40LDQvdGC0Ysg0LfQsNCz0YDRg9C30LrQuFxcIixcXCJhbGxfZm9ybWF0c19mb3JfZG93bmxvYWRcXCI6XFwi0JLRgdC1INC00L7RgdGC0YPQv9C90YvQtSDRhNC+0YDQvNCw0YLRi1xcIixcXCJtb3JlX2Zvcm1hdHNcXCI6XFwi0JHQvtC70YzRiNC1INGE0L7RgNC80LDRgtC+0LJcXCIsXFwiY29udmVyc2lvbl9yZXF1aXJlZFxcIjpcXCLQvdGD0LbQvdCwINC60L7QvdCy0LXRgNGC0LDRhtC40Y9cXCIsXFwidWRsX3BvcnRhbFxcIjpcXCJVREwgUG9ydGFsXFwiLFxcImRvd25sb2FkX3ZpYV91bmlkb3dubG9hZGVyXFwiOlxcItCh0LrQsNGH0LDRgtGMINCyINC90YPQttC90L7QvCDRhNC+0YDQvNCw0YLQtSDRh9C10YDQtdC3IHVuaWRvd25sb2FkZXIuY29tXFwiLFxcImRvd25sb2FkX3ZpYV91bmlkb3dubG9hZGVyX3Rvb2x0aXBcXCI6XFwi0KHQutCw0YfQsNGC0Ywg0YfQtdGA0LXQtyB1bmlkb3dubG9hZGVyLmNvbVxcIixcXCJ1ZGxfY2xpZW50XFwiOlxcIlVETCBDbGllbnRcXCIsXFwiZG93bmxvYWRfdXNpbmdfdWRsXFwiOlxcItCh0LrQsNGH0LDRgtGMINCyINC90YPQttC90L7QvCDRhNC+0YDQvNCw0YLQtSDRh9C10YDQtdC3IFVETCBDbGllbnRcXCIsXFwiZG93bmxvYWRfdXNpbmdfdWRsX3Rvb2x0aXBcXCI6XFwiQ9C60LDRh9Cw0YLRjCBjINC/0L7QvNC+0YnRjNGOIFVETCBDbGllbnRcXCIsXFwicXJfY29kZV90b29sdGlwXFwiOlxcItCf0L7Qu9GD0YfQuNGC0YwgUVIt0LrQvtC0XFwiLFxcImNvcHlfbGlua190b19jbGlwYm9hcmRfdG9vbHRpcFxcIjpcXCLQmtC+0L/QuNGA0L7QstCw0YLRjCDRgdGB0YvQu9C60YNcXCIsXFwiY29weV9saW5rX3RvX2NsaXBib2FyZF9ub3RpZmljYXRpb25fbWVzc2FnZVxcIjpcXCLQodGB0YvQu9C60LAg0YHQutC+0L/QuNGA0L7QstCw0L3QsCDQsiDQsdGD0YTQtdGAINC+0LHQvNC10L3QsFxcIixcXCJhY3RpdmVfZG93bmxvYWRfd2FybmluZ19ub3RpZmljYXRpb25fbWVzc2FnZVxcIjpcXCLQktGB0LUg0L/QvtC0INC60L7QvdGC0YDQvtC70LXQvCFcXCIsXFwiYWN0aXZlX2Rvd25sb2FkX3dhcm5pbmdfbm90aWZpY2F0aW9uX2Rlc2NyaXB0aW9uXFwiOlxcItCS0Ysg0YPRiNC70Lgg0YHQviDRgdGC0YDQsNC90LjRhtGLINGBINCw0LrRgtC40LLQvdGL0Lwg0YHQutCw0YfQuNCy0LDQvdC40LXQvCwg0L7QvdC+INC/0YDQvtC00L7Qu9C20LjRgtGB0Y8g0LIg0YTQvtC90L7QstC+0Lwg0YDQtdC20LjQvNC1LlxcIixcXCJjYW5jZWxfY29udmVyc2lvblxcIjpcXCLQn9GA0LXQutGA0LDRgtC40YLRjCDQutC+0L3QstC10YDRgtCw0YbQuNGOXFwiLFxcImNhbmNlbF9kb3dubG9hZFxcIjpcXCLQn9GA0LXQutGA0LDRgtC40YLRjCDRgdC60LDRh9C40LLQsNC90LjQtVxcIixcXCJ0YWtlX3NjcmVlbnNob3RfdG9vbHRpcFxcIjpcXCLQodC+0YXRgNCw0L3QuNGC0Ywg0LrQsNC00YBcXCIsXFwiZHJvcF91c19hX2xpbmVcXCI6XFwi0J3QtSDQvdCw0YjQu9C4INC+0YLQstC10YLQsD8g0J3QsNC/0LjRiNC40YLQtSDQvdCw0LwgOylcXCIsXFwiaGVscFxcIjpcXCLQn9C+0LzQvtGJ0YxcXCIsXFwiaGVscF9hcnRpY2xlc1xcIjpbe1xcInRpdGxlXFwiOlxcItCa0LDQuiDQt9C00LXRgdGMINC60LDRh9Cw0YLRjD9cXCIsXFwiYXJ0aWNsZVxcIjpcXCLQktGLINC80L7QttC10YLQtSDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0Ywg0YTQvtGA0LzQsNGCINC/0L4g0YPQvNC+0LvRh9Cw0L3QuNGOLCDQv9GA0L7RgdGC0L4g0L3QsNC20LDQsiDQv9C+INC60L3QvtC/0LrQtSA8Yj5VREwgSGVscGVyPC9iPiDQv9C+0LQg0LLQuNC00LXQvi4g0JjQu9C4INC60LvQuNC60L3QuNGC0LUg0L3QsCDQvdGD0LbQvdGL0Lkg0YTQvtGA0LzQsNGCINCyINGB0L/QuNGB0LrQtSDQtNC+0YHRgtGD0L/QvdGL0YUg0LTQu9GPINGB0LrQsNGH0LjQstCw0L3QuNGPLlxcIn0se1xcInRpdGxlXFwiOlxcItCa0LDQutC+0Lkg0YTQvtGA0LzQsNGCINCy0LjQtNC10L4g0LLRi9Cx0YDQsNGC0Yw/XFwiLFxcImFydGljbGVcXCI6XFwi0J3QsNC40LvRg9GH0YjQtdC1INC60LDRh9C10YHRgtCy0L4g0LjQvNC10Y7RgiDRhNC+0YDQvNCw0YLRiyA8Yj5GdWxsSEQgKDEwODBwKTwvYj4sIDxiPjJLICgxNDQwcCk8L2I+LCA8Yj40SyAoMjE2MHApPC9iPiDQuCA8Yj44SyAoNDMyMHApPC9iPi4g0J7QsdGJ0LDRjyDRgNC10LrQvtC80LXQvdC00LDRhtC40Y8g0YHQvtGB0YLQvtC40YIg0LIg0YLQvtC8LCDRh9GC0L4g0YfQtdC8INCx0L7Qu9GM0YjQtSDRgNCw0LfRgNC10YjQtdC90LjQtSDQstCw0YjQtdCz0L4g0Y3QutGA0LDQvdCwLCDRgtC10Lwg0LvRg9GH0YjQtSDQtNC+0LvQttC90L4g0LHRi9GC0Ywg0LrQsNGH0LXRgdGC0LLQviDQstC40LTQtdC+LiDQntC00L3QsNC60L4g0LLQsNC8INGB0LvQtdC00YPQtdGCINGD0YfQtdGB0YLRjCDQuCDQtNGA0YPQs9C40LUg0YTQsNC60YLQvtGA0Ys6INGB0LrQvtGA0L7RgdGC0Ywg0YHQutCw0YfQuNCy0LDQvdC40Y8sINC60L7Qu9C40YfQtdGB0YLQstC+INGB0LLQvtCx0L7QtNC90L7Qs9C+INC80LXRgdGC0LAsINCwINGC0LDQutC20LUg0L/RgNC+0LjQt9Cy0L7QtNC40YLQtdC70YzQvdC+0YHRgtGMINGD0YHRgtGA0L7QudGB0YLQstCwINC/0YDQuCDQv9GA0L7QuNCz0YDRi9Cy0LDQvdC40LguXFwifSx7XFwidGl0bGVcXCI6XFwi0J/QvtGH0LXQvNGDINCx0YDQsNGD0LfQtdGAL9C60L7QvNC/0YzRjtGC0LXRgCDQt9Cw0LLQuNGB0LDQtdGCINC/0YDQuCDQt9Cw0LPRgNGD0LfQutC1P1xcIixcXCJhcnRpY2xlXFwiOlxcItCf0L7Qu9C90L7RgdGC0YzRjiDQt9Cw0LLQuNGB0LDRgtGMINCx0YDQsNGD0LfQtdGAL9C60L7QvNC/0YzRjtGC0LXRgCDQvdC1INC00L7Qu9C20LXQvSEg0JXRgdC70Lgg0Y3RgtC+INC/0YDQvtC40LfQvtGI0LvQviwg0L/RgNC+0YHRjNCx0LAg0YHQvtC+0LHRidC40YLRjCDQvtCxINGN0YLQvtC8INGH0LXRgNC10Lcg0YTQvtGA0LzRgyDQvtCx0YDQsNGC0L3QvtC5INGB0LLRj9C30LgsINGD0LrQsNC30LDQsiDRgdGB0YvQu9C60YMg0L3QsCDQstC40LTQtdC+LiDQmiDRgdC+0LbQsNC70LXQvdC40Y4sINCy0LjQtNC10L4g0LIg0L3QtdC60L7RgtC+0YDRi9GFINGE0L7RgNC80LDRgtCw0YUg0L3QtdC70YzQt9GPINGB0LrQsNGH0LDRgtGMINGBIFlvdVR1YmUg0L3QsNC/0YDRj9C80YPRji4g0J/QvtGN0YLQvtC80YMg0LzRiyDQtNC+0LHQsNCy0LjQu9C4INCyIDxiPlVETCBIZWxwZXI8L2I+INCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L7QvdC70LDQudC9LdC60L7QvdCy0LXRgNGC0LDRhtC40Lgg0L3QtdCx0L7Qu9GM0YjQuNGFINCy0LjQtNC10L4g0LIg0L3Rg9C20L3Ri9C5INGE0L7RgNC80LDRgi4g0JIg0L7RgtC00LXQu9GM0L3Ri9GFINGB0LvRg9GH0LDRj9GFINGN0YLQvtGCINC/0YDQvtGG0LXRgdGBINGB0LvQuNGI0LrQvtC8INCw0LrRgtC40LLQvdC+INC40YHQv9C+0LvRjNC30YPQtdGCINGA0LXRgdGD0YDRgdGLINC60L7QvNC/0YzRjtGC0LXRgNCwLlxcIn0se1xcInRpdGxlXFwiOlxcItCf0L7Rh9C10LzRgyDRjyDQvdC1INC80L7Qs9GDINGB0LrQsNGH0LDRgtGMINCy0LjQtNC10L4g0LIg0L3Rg9C20L3QvtC8INGE0L7RgNC80LDRgtC1INC90LDQv9GA0Y/QvNGD0Y4/XFwiLFxcImFydGljbGVcXCI6XFwi0JIg0YHQuNC70YMg0YLQtdGF0L3QuNGH0LXRgdC60LjRhSDQvtGB0L7QsdC10L3QvdC+0YHRgtC10LkgWW91VHViZSwg0LLQuNC00LXQviDQsiDQvdC10LrQvtGC0L7RgNGL0YUg0YTQvtGA0LzQsNGC0LDRhSDQvdC10LvRjNC30Y8g0YHQutCw0YfQsNGC0Ywg0L3QsNC/0YDRj9C80YPRji4g0J/QvtGN0YLQvtC80YMg0LIgPGI+VURMIEhlbHBlcjwvYj4g0LTQvtCx0LDQstC70LXQvdCwINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L7QvdC70LDQudC9LdC60L7QvdCy0LXRgNGC0LDRhtC40Lgg0L3QtdCx0L7Qu9GM0YjQuNGFINCy0LjQtNC10L4g0LIg0L3Rg9C20L3Ri9C5INGE0L7RgNC80LDRgi4g0JHQvtC70YzRiNC40LUg0LLQuNC00LXQviAo0L/RgNC+0LTQvtC70LbQuNGC0LXQu9GM0L3Ri9C1INC4L9C40LvQuCDQstGL0YHQvtC60L7Qs9C+INC60LDRh9C10YHRgtCy0LApINGC0YDQtdCx0YPRjtGCINC00LvRjyDQvtC90LvQsNC50L0t0LrQvtC90LLQtdGA0YLQsNGG0LjQuCDRgdC70LjRiNC60L7QvCDQvNC90L7Qs9C+INGA0LXRgdGD0YDRgdC+0LIsINGH0YLQviDQv9C+0YDQvtC5INC/0YDQuNCy0L7QtNC40YIg0Log0LfQsNCy0LjRgdCw0L3QuNGOINCx0YDQsNGD0LfQtdGA0LAv0LrQvtC80L/RjNGO0YLQtdGA0LAuINCf0L7RjdGC0L7QvNGDINC40YUg0L/RgNC10LTQu9Cw0LPQsNC10YLRgdGPINGB0LrQsNGH0LjQstCw0YLRjCDRh9C10YDQtdC3IDxiPjxhIGhyZWY9XFxcXFxcImh0dHBzOi8vdW5pZG93bmxvYWRlci5jb20veyVsYW5nJX0vdWRsLWNsaWVudC15b3V0dWJlLWRvd25sb2FkZXItYW5kLWNvbnZlcnRlclxcXFxcXCIgdGFyZ2V0PVxcXFxcXFxcXFxcXFxcIl9ibGFua1xcXFxcXFxcXFxcXFxcIj5VREwgQ2xpZW50INC00LvRjyBXaW5kb3dzPC9hPjwvYj4uXFwifSx7XFwidGl0bGVcXCI6XFwi0JrQsNC6INC/0L7Qu9GD0YfQuNGC0Ywg0YHRgdGL0LvQutGDINC90LAg0LLQuNC00LXQvi/QsNGD0LTQuNC+P1xcIixcXCJhcnRpY2xlXFwiOlxcItCf0YDRj9C80LDRjyDRgdGB0YvQu9C60LAg0L3QsCDRhNCw0LnQuyDQtNC+0YHRgtGD0L/QvdCwINGC0L7Qu9GM0LrQviDQtNC70Y8g0YTQvtGA0LzQsNGC0L7Qsiwg0LrQvtGC0L7RgNGL0LUg0L3QtSDRgtGA0LXQsdGD0Y7RgiDQutC+0L3QstC10YDRgtCw0YbQuNC4LiDQlNC70Y8g0Y3RgtC+0LPQviDQvdCw0LbQvNC40YLQtSDQvdCwINC40LrQvtC90LrRgyZuYnNwO1x4M2MhLS1baW1nLWNvcHldLS1ceDNlINCyINGB0YLRgNC+0LrQtSDRgSDQv9C+0LTRhdC+0LTRj9GJ0LjQvCDQstCw0YDQuNCw0L3RgtC+0Lwg0YHQutCw0YfQuNCy0LDQvdC40Y8uINCQINC30LDRgtC10Lwg0LLRgdGC0LDQstGM0YLQtSDQtdGRINCyINCy0LjQtNC1INGC0LXQutGB0YLQsCDRgtGD0LTQsCwg0LPQtNC1INC90LXQvtCx0YXQvtC00LjQvNC+LlxcIn0se1xcInRpdGxlXFwiOlxcItCa0LDQuiDRgdC60LDRh9Cw0YLRjCDQstC40LTQtdC+INGBIDYwIEZQUz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCLQlNC+0YHRgtCw0YLQvtGH0L3QviDQstGL0LHRgNCw0YLRjCDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0LLQsNGA0LjQsNC90YIg0YHQutCw0YfQuNCy0LDQvdC40Y8g4oCUINC+0L/RgNC10LTQtdC70LjRgtGMINC10LPQviDQvNC+0LbQvdC+INC/0L4g0LjQutC+0L3QutC1Jm5ic3A7XHgzYyEtLVtpbWctZnBzLTYwXS0tXHgzZS4g0J7QtNC90LDQutC+INC90LUg0LLRgdC10LPQtNCwINGC0LDQutC40LUg0LLQsNGA0LjQsNC90YLRiyDQuNC80LXRjtGC0YHRjy4g0J/RgNC10LbQtNC1INCy0YHQtdCz0L4sINGB0LDQvNC+INC40YHRhdC+0LTQvdC+0LUg0LLQuNC00LXQviDQtNC+0LvQttC90L4g0LjQvNC10YLRjCDRh9Cw0YHRgtC+0YLRgyDQutCw0LTRgNC+0LIg0L3QtSDQvNC10L3RjNGI0LUsINGH0LXQvCA2MC4g0Jgg0L7QvdC+INC00L7Qu9C20L3QviDQsdGL0YLRjCDQtNC+0YHRgtGD0L/QvdC+INC6INC/0YDQvtGB0LzQvtGC0YDRgyDQsiDQv9C70LXQtdGA0LUgWW91VHViZSDRgSA2MCBGUFMuXFwifSx7XFwidGl0bGVcXCI6XFwi0JrQsNC6INGB0LrQsNGH0LDRgtGMINCw0YPQtNC40L7QtNC+0YDQvtC20LrRgyAo0LzRg9C30YvQutGDKSDQsiBNUDM/XFwiLFxcImFydGljbGVcXCI6XFwi0Jog0YHQvtC20LDQu9C10L3QuNGOLCDQsiDQtNCw0L3QvdGL0Lkg0LzQvtC80LXQvdGCINC90LXQu9GM0LfRjyDRgdC60LDRh9Cw0YLRjCDQsiDRhNC+0YDQvNCw0YLQtSBNUDMg0L3QsNC/0YDRj9C80YPRjiDigJQgWW91VHViZSDQtdCz0L4g0L3QtSDQv9C+0LTQtNC10YDQttC40LLQsNC10YIsINCwINC90LXQvtCx0YXQvtC00LjQvNCw0Y8g0L7QvdC70LDQudC9LdC60L7QvdCy0LXRgNGC0LDRhtC40Y8g0YDQsNCx0L7RgtCw0LXRgiDQvdC10YHRgtCw0LHQuNC70YzQvdC+LiDQktC+0YHQv9C+0LvRjNC30YPQudGC0LXRgdGMINC90LDRiNC40LwgPGI+PGEgaHJlZj1cXFxcXFwiaHR0cHM6Ly91bmlkb3dubG9hZGVyLmNvbS97JWxhbmclfS91ZGwtY2xpZW50LXlvdXR1YmUtZG93bmxvYWRlci1hbmQtY29udmVydGVyXFxcXFxcIiB0YXJnZXQ9XFxcXFxcXFxcXFxcXFwiX2JsYW5rXFxcXFxcXFxcXFxcXFwiPlVETCBDbGllbnQg0LTQu9GPIFdpbmRvd3M8L2E+PC9iPiwg0LrQvtGC0L7RgNGL0Lkg0L/QvtC00LTQtdGA0LbQuNCy0LDQtdGCINC60L7QvdCy0LXRgNGC0LDRhtC40Y4g0LLQuNC00LXQviDQsiDRhNC+0YDQvNCw0YIgTVAzLiDQmNC70Lgg0LLRi9Cx0LXRgNC40YLQtSDQsiDRgdC/0LjRgdC60LUg0L7QtNC40L0g0LjQtyDQsNC70YzRgtC10YDQvdCw0YLQuNCy0L3Ri9GFINCw0YPQtNC40L7RhNC+0YDQvNCw0YLQvtCyICjQvtCx0L7Qt9C90LDRh9C10L3RiyDQuNC60L7QvdC60L7QuSZuYnNwO1x4M2MhLS1baW1nLXNvdW5kLW9uXS0tXHgzZSkuXFwifSx7XFwidGl0bGVcXCI6XFwi0JrQsNC6INGB0L7RhdGA0LDQvdC40YLRjCDQutCw0LTRgCDQuNC3INCy0LjQtNC10L4/XFwiLFxcImFydGljbGVcXCI6XFwi0KPQsdC10LTQuNGC0LXRgdGMLCDRh9GC0L4g0LIgPGEgZGF0YS11bmlkb3dubG9hZGVyLXBhZ2U9XFxcXFxcInNldHRpbmdzXFxcXFxcIj7QvdCw0YHRgtGA0L7QudC60LDRhTwvYT4g0L7RgtC80LXRh9C10L0g0L/Rg9C90LrRgiA8Yj7Cq9Ce0YLQvtCx0YDQsNC20LDRgtGMINC60L3QvtC/0LrRgyDRgdC+0YXRgNCw0L3QtdC90LjRjyDRgdC60YDQuNC90YjQvtGC0LAg0LjQtyDQstC40LTQtdC+wrs8L2I+LiDQkiDQv9GA0LDQstC+0Lwg0L3QuNC20L3QtdC8INGD0LPQu9GDINC/0LvQtdC10YDQsCDQu9C10LLQtdC1INC40LrQvtC90LrQuCA8Yj7Cq9Cd0LDRgdGC0YDQvtC50LrQuMK7PC9iPiDQtNC+0LvQttC90LAg0L/QvtGP0LLQuNGC0YzRgdGPINC40LrQvtC90LrQsCZuYnNwO1x4M2MhLS1baW1nLWNhbWVyYV0tLVx4M2UsINC/0L4g0L3QsNC20LDRgtC40Y4g0L3QsCDQutC+0YLQvtGA0YPRjiDRgtC10LrRg9GJ0LjQuSDQutCw0LTRgCDQuNC3INCy0LjQtNC10L4g0LHRg9C00LXRgiDRgdC+0YXRgNCw0L3RkdC9INC90LAg0LLQsNGIINC60L7QvNC/0YzRjtGC0LXRgCDQsiDRhNC+0YDQvNCw0YLQtSBqcGVnLlxcIn0se1xcInRpdGxlXFwiOlxcItCa0LDQuiDQvtGC0L7QsdGA0LDQttCw0YLRjCDQuNC90YLQtdGA0YTQtdC50YEg0L/QviDQutC70LjQutGDINC90LAg0LrQvdC+0L/QutGDINGB0LrQsNGH0LjQstCw0L3QuNGPLCDQsCDQvdC1INC/0YDQuCDQvdCw0LLQtdC00LXQvdC40Lgg0L3QsCDQvdC10ZE/XFwiLFxcImFydGljbGVcXCI6XFwi0JIgPGEgZGF0YS11bmlkb3dubG9hZGVyLXBhZ2U9XFxcXFxcInNldHRpbmdzXFxcXFxcIj7QvdCw0YHRgtGA0L7QudC60LDRhTwvYT4g0LLRiyDQvNC+0LbQtdGC0LUg0LLRi9Cx0YDQsNGC0Ywg0LLQvdC10YjQvdC40Lkg0LLQuNC0INC60L3QvtC/0LrQuDogPHVsPjxsaT48Yj7RgdC+0LLRgNC10LzQtdC90L3Ri9C5PC9iPiAo0LjQvdGC0LXRgNGE0LXQudGBINCy0YvQstC+0LTQuNGC0YHRjyDQv9GA0Lgg0L3QsNCy0LXQtNC10L3QuNC4KTwvbGk+PGxpPjxiPtC60LvQsNGB0YHQuNGH0LXRgdC60LjQuTwvYj4gKNC40L3RgtC10YDRhNC10LnRgSDQstGL0LLQvtC00LjRgtGB0Y8g0L/RgNC4INC60LvQuNC60LUpPC9saT48L3VsPlxcIn0se1xcInRpdGxlXFwiOlxcItCX0LDRh9C10Lwg0L3Rg9C20L3RiyBRUi3QutC+0LTRiz9cXCIsXFwiYXJ0aWNsZVxcIjpcXCLQoSDQv9C+0LzQvtGJ0YzRjiBRUi3QutC+0LTQvtCyINCy0Ysg0LzQvtC20LXRgtC1INC/0L7Qu9GD0YfQuNGC0Ywg0L/RgNGP0LzRg9GOINGB0YHRi9C70LrRgyDQvdCwINCy0LjQtNC10L4g0LjQu9C4INCw0YPQtNC40L4g0L3QsCDQu9GO0LHQvtC8INGD0YHRgtGA0L7QudGB0YLQstC1INGBINC60LDQvNC10YDQvtC5LiDQo9Cx0LXQtNC40YLQtdGB0YwsINGH0YLQviDQsiA8YSBkYXRhLXVuaWRvd25sb2FkZXItcGFnZT1cXFxcXFwic2V0dGluZ3NcXFxcXFwiPtC90LDRgdGC0YDQvtC50LrQsNGFIFVETCBIZWxwZXI8L2E+INCy0LrQu9GO0YfQtdC9INC/0YPQvdC60YIgPGI+wqvQntGC0L7QsdGA0LDQttCw0YLRjCBRUi3QutC+0LTRi8K7PC9iPi4g0KMg0L3QtdC60L7RgtC+0YDRi9GFINCy0LDRgNC40LDQvdGC0L7QsiDQt9Cw0LPRgNGD0LfQutC4INC/0L7Rj9Cy0LjRgtGB0Y8g0LjQutC+0L3QutCwJm5ic3A7XHgzYyEtLVtpbWctcXItY29kZV0tLVx4M2UsINC/0L4g0L3QsNC20LDRgtC40Y4g0L3QsCDQutC+0YLQvtGA0YPRjiDQstGLINGD0LLQuNC00LjRgtC1IFFSLdC60L7QtCDQuCDQuNC90YHRgtGA0YPQutGG0LjRjiDQtNC70Y8g0YLQtdC70LXRhNC+0L3QsCDQuNC70Lgg0L/Qu9Cw0L3RiNC10YLQsC5cXCJ9XSxcXCJzZXR0aW5nc190aXRsZV9hcHBfYnV0dG9uX3N0eWxlXFwiOlxcItCS0L3QtdGI0L3QuNC5INCy0LjQtCDQutC90L7Qv9C60LhcXCIsXFwic2V0dGluZ3NfYXBwX2J1dHRvbl9zdHlsZV9zb2xpZFxcIjpcXCLQodC+0LLRgNC10LzQtdC90L3Ri9C5ICjQuNC90YLQtdGA0YTQtdC50YEg0LLRi9Cy0L7QtNC40YLRgdGPINC/0YDQuCDQvdCw0LLQtdC00LXQvdC40LgpXFwiLFxcInNldHRpbmdzX2FwcF9idXR0b25fc3R5bGVfc3BsaXRcXCI6XFwi0JrQu9Cw0YHRgdC40YfQtdGB0LrQuNC5ICjQuNC90YLQtdGA0YTQtdC50YEg0LLRi9Cy0L7QtNC40YLRgdGPINC/0YDQuCDQutC70LjQutC1KVxcIixcXCJzZXR0aW5nc19kaXNwbGF5X3FyX2NvZGVzXFwiOlxcItCe0YLQvtCx0YDQsNC20LDRgtGMIFFSLdC60L7QtNGLXFwiLFxcInFyX2NvZGVfdGl0bGVcXCI6XFwiUVIt0LrQvtC0INC00LvRjyDQvNC+0LHQuNC70YzQvdC+0LPQviDRg9GB0YLRgNC+0LnRgdGC0LLQsFxcIixcXCJxcl9jb2RlX2Rlc2NyaXB0aW9uXFwiOlxcItCf0LXRgNC10LTQsNGC0Ywg0L/RgNGP0LzRg9GOINGB0YHRi9C70LrRgyDQtNC70Y8g0LfQsNCz0YDRg9C30LrQuCDQvdCwINCy0LDRiCDRgdC80LDRgNGC0YTQvtC9INC40LvQuCDQv9C70LDQvdGI0LXRgiDRgtC10L/QtdGA0Ywg0L/RgNC+0YHRgtC+IOKAlCDQt9Cw0L/Rg9GB0YLQuNGC0LUg0YHQutCw0L3QtdGAIFFSLdC60L7QtNC+0LIg0Lgg0L3QsNCy0LXQtNC40YLQtSDQvdCwINC40LfQvtCx0YDQsNC20LXQvdC40LUg0LLRi9GI0LUuXFwiLFxcInFyX2NvZGVfZXJyb3JcXCI6XFwi0KHQtdGA0LLQuNGBIFFSLdC60L7QtNC+0LIg0YHQtdC50YfQsNGBINC90LXQtNC+0YHRgtGD0L/QtdC9LiDQn9C+0LbQsNC70YPQudGB0YLQsCwg0L/QvtC/0YDQvtCx0YPQudGC0LUg0L/QvtC30LbQtS5cXCIsXFwic2hvd195YW5kZXhfbWFya2V0X2FkdmlzZXJcXCI6XFwi0J7RgtC+0LHRgNCw0LbQsNGC0Ywg0K/QvdC00LXQutGBLtCh0L7QstC10YLQvdC40Log4oCUINCy0LjQtNC20LXRgiDRgdGA0LDQstC90LXQvdC40Y8g0YbQtdC9INC00LvRjyDQstGL0LPQvtC00L3Ri9GFINC/0L7QutGD0L/QvtC6XFwiLFxcIndhcm5pbmdcXCI6XFwi0JLQvdC40LzQsNC90LjQtSFcXCIsXFwieWFuZGV4X21hcmtldF9hZHZpc2VyX25vdGlmaWNhdGlvbl9kZXNjcmlwdGlvblxcIjpcXCLQmNC30LzQtdC90LXQvdC40Y8g0LLRgdGC0YPQv9GP0YIg0LIg0YHQuNC70YMg0L/QvtGB0LvQtSDQv9C10YDQtdC30LDQs9GA0YPQt9C60Lgg0YHRgtGA0LDQvdC40YbRiyDRgSDQstC40LTQttC10YLQvtC8INCv0L3QtNC10LrRgS7QodC+0LLQtdGC0L3QuNC60LAuXFwiLFxcInNvY2lhbF9tZWRpYV9zaGFyaW5nX3RpdGxlXFwiOlxcItCc0LjQvdGD0YLQvtGH0LrRgyDQstC90LjQvNCw0L3QuNGPIVxcIixcXCJzb2NpYWxfbWVkaWFfc2hhcmluZ19tZXNzYWdlXFwiOlxcItChINC/0L7QvNC+0YnRjNGOINC90LDRiNC10LPQviDQsdGA0LDRg9C30LXRgNC90L7Qs9C+INGA0LDRgdGI0LjRgNC10L3QuNGPINCy0Ysg0LfQsNCz0YDRg9C30LjQu9C4IHslYWxyZWFkeSV9eyVkb3dubG9hZHNDb3VudCV9IHsldmlkZW8lfSA6KVxcXFxu0JTQu9GPINGC0L7Qs9C+LCDRh9GC0L7QsdGLIFVETCBIZWxwZXIg0L7RgdGC0LDQstCw0LvRgdGPINCx0LXRgdC/0LvQsNGC0L3Ri9C8LCDQvdCw0Lwg0L3Rg9C20L3QsCDQstCw0YjQsCDQv9C+0LzQvtGJ0Ywg4oCUINGA0LDRgdGB0LrQsNC20LjRgtC1INC+INC90LDRgSDQsiDRgdC+0YbQuNCw0LvRjNC90YvRhSDRgdC10YLRj9GFINC40LvQuCDQvNC10YHQtdC90LTQttC10YDQsNGFIVxcIixcXCJzb2NpYWxfbWVkaWFfc2hhcmluZ19idXR0b25fb2tcXCI6XFwi0J/QvtC00LXQu9C40YLRjNGB0Y8g0YEg0LTRgNGD0LfRjNGP0LzQuFxcIixcXCJzb2NpYWxfbWVkaWFfc2hhcmluZ19idXR0b25fY2FuY2VsXFwiOlxcItCc0L3QtSDRgdC70L7QttC90L4g0Y3RgtC+INGB0LTQtdC70LDRgtGMINGB0LXQudGH0LDRgVxcIixcXCJhbHJlYWR5XFwiOlxcItGD0LbQtVxcIixcXCJwbHVyYWxfdmlkZW9cXCI6XFwi0LLQuNC00LXQvtGA0L7Qu9C40Los0LLQuNC00LXQvtGA0L7Qu9C40LrQsCzQstC40LTQtdC+0YDQvtC70LjQutC+0LJcXCIsXFwiZGlyZWN0X2xpbmtzX3VuYXZhaWxhYmxlXFwiOlxcItCf0YDRj9C80YvQtSDRgdGB0YvQu9C60Lgg0LLRgNC10LzQtdC90L3QviDQvdC10LTQvtGB0YLRg9C/0L3Riy4gPGEgZGF0YS11bmlkb3dubG9hZGVyLWZ1bmN0aW9uPVxcXFxcXCJyZWxvYWRcXFxcXFwiPtCf0L7Qv9GA0L7QsdGD0LnRgtC1INC/0LXRgNC10LfQsNCz0YDRg9C30LjRgtGMINGB0YLRgNCw0L3QuNGG0YMgKNC60LvQsNCy0LjRiNCwIEY1KTwvYT5cXCJ9Iik7XG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL3NyYy93aWRnZXQvaTE4bi9ydS90cmFuc2xhdGlvbi5qc29uPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCJtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc3JjL3dlYmV4dC9jb250ZW50LXNjcmlwdC11c2Vyc2NyaXB0LmpzICovODgpO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy9tdWx0aV8uL3NyYy93ZWJleHQvY29udGVudC1zY3JpcHQtdXNlcnNjcmlwdC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsvKiFcbiAqIFRoZSBidWZmZXIgbW9kdWxlIGZyb20gbm9kZS5qcywgZm9yIHRoZSBicm93c2VyLlxuICpcbiAqIEBhdXRob3IgICBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwOi8vZmVyb3NzLm9yZz5cbiAqIEBsaWNlbnNlICBNSVRcbiAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi9cblxuXG5cbnZhciBiYXNlNjQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBiYXNlNjQtanMgKi8gNDQpXG52YXIgaWVlZTc1NCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGllZWU3NTQgKi8gNDUpXG52YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGlzYXJyYXkgKi8gNDYpXG5cbmV4cG9ydHMuQnVmZmVyID0gQnVmZmVyXG5leHBvcnRzLlNsb3dCdWZmZXIgPSBTbG93QnVmZmVyXG5leHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTBcblxuLyoqXG4gKiBJZiBgQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlRgOlxuICogICA9PT0gdHJ1ZSAgICBVc2UgVWludDhBcnJheSBpbXBsZW1lbnRhdGlvbiAoZmFzdGVzdClcbiAqICAgPT09IGZhbHNlICAgVXNlIE9iamVjdCBpbXBsZW1lbnRhdGlvbiAobW9zdCBjb21wYXRpYmxlLCBldmVuIElFNilcbiAqXG4gKiBCcm93c2VycyB0aGF0IHN1cHBvcnQgdHlwZWQgYXJyYXlzIGFyZSBJRSAxMCssIEZpcmVmb3ggNCssIENocm9tZSA3KywgU2FmYXJpIDUuMSssXG4gKiBPcGVyYSAxMS42KywgaU9TIDQuMisuXG4gKlxuICogRHVlIHRvIHZhcmlvdXMgYnJvd3NlciBidWdzLCBzb21ldGltZXMgdGhlIE9iamVjdCBpbXBsZW1lbnRhdGlvbiB3aWxsIGJlIHVzZWQgZXZlblxuICogd2hlbiB0aGUgYnJvd3NlciBzdXBwb3J0cyB0eXBlZCBhcnJheXMuXG4gKlxuICogTm90ZTpcbiAqXG4gKiAgIC0gRmlyZWZveCA0LTI5IGxhY2tzIHN1cHBvcnQgZm9yIGFkZGluZyBuZXcgcHJvcGVydGllcyB0byBgVWludDhBcnJheWAgaW5zdGFuY2VzLFxuICogICAgIFNlZTogaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9Njk1NDM4LlxuICpcbiAqICAgLSBDaHJvbWUgOS0xMCBpcyBtaXNzaW5nIHRoZSBgVHlwZWRBcnJheS5wcm90b3R5cGUuc3ViYXJyYXlgIGZ1bmN0aW9uLlxuICpcbiAqICAgLSBJRTEwIGhhcyBhIGJyb2tlbiBgVHlwZWRBcnJheS5wcm90b3R5cGUuc3ViYXJyYXlgIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYXJyYXlzIG9mXG4gKiAgICAgaW5jb3JyZWN0IGxlbmd0aCBpbiBzb21lIHNpdHVhdGlvbnMuXG5cbiAqIFdlIGRldGVjdCB0aGVzZSBidWdneSBicm93c2VycyBhbmQgc2V0IGBCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVGAgdG8gYGZhbHNlYCBzbyB0aGV5XG4gKiBnZXQgdGhlIE9iamVjdCBpbXBsZW1lbnRhdGlvbiwgd2hpY2ggaXMgc2xvd2VyIGJ1dCBiZWhhdmVzIGNvcnJlY3RseS5cbiAqL1xuQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQgPSBnbG9iYWwuVFlQRURfQVJSQVlfU1VQUE9SVCAhPT0gdW5kZWZpbmVkXG4gID8gZ2xvYmFsLlRZUEVEX0FSUkFZX1NVUFBPUlRcbiAgOiB0eXBlZEFycmF5U3VwcG9ydCgpXG5cbi8qXG4gKiBFeHBvcnQga01heExlbmd0aCBhZnRlciB0eXBlZCBhcnJheSBzdXBwb3J0IGlzIGRldGVybWluZWQuXG4gKi9cbmV4cG9ydHMua01heExlbmd0aCA9IGtNYXhMZW5ndGgoKVxuXG5mdW5jdGlvbiB0eXBlZEFycmF5U3VwcG9ydCAoKSB7XG4gIHRyeSB7XG4gICAgdmFyIGFyciA9IG5ldyBVaW50OEFycmF5KDEpXG4gICAgYXJyLl9fcHJvdG9fXyA9IHtfX3Byb3RvX186IFVpbnQ4QXJyYXkucHJvdG90eXBlLCBmb286IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDQyIH19XG4gICAgcmV0dXJuIGFyci5mb28oKSA9PT0gNDIgJiYgLy8gdHlwZWQgYXJyYXkgaW5zdGFuY2VzIGNhbiBiZSBhdWdtZW50ZWRcbiAgICAgICAgdHlwZW9mIGFyci5zdWJhcnJheSA9PT0gJ2Z1bmN0aW9uJyAmJiAvLyBjaHJvbWUgOS0xMCBsYWNrIGBzdWJhcnJheWBcbiAgICAgICAgYXJyLnN1YmFycmF5KDEsIDEpLmJ5dGVMZW5ndGggPT09IDAgLy8gaWUxMCBoYXMgYnJva2VuIGBzdWJhcnJheWBcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG5cbmZ1bmN0aW9uIGtNYXhMZW5ndGggKCkge1xuICByZXR1cm4gQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlRcbiAgICA/IDB4N2ZmZmZmZmZcbiAgICA6IDB4M2ZmZmZmZmZcbn1cblxuZnVuY3Rpb24gY3JlYXRlQnVmZmVyICh0aGF0LCBsZW5ndGgpIHtcbiAgaWYgKGtNYXhMZW5ndGgoKSA8IGxlbmd0aCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbnZhbGlkIHR5cGVkIGFycmF5IGxlbmd0aCcpXG4gIH1cbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgLy8gUmV0dXJuIGFuIGF1Z21lbnRlZCBgVWludDhBcnJheWAgaW5zdGFuY2UsIGZvciBiZXN0IHBlcmZvcm1hbmNlXG4gICAgdGhhdCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aClcbiAgICB0aGF0Ll9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGVcbiAgfSBlbHNlIHtcbiAgICAvLyBGYWxsYmFjazogUmV0dXJuIGFuIG9iamVjdCBpbnN0YW5jZSBvZiB0aGUgQnVmZmVyIGNsYXNzXG4gICAgaWYgKHRoYXQgPT09IG51bGwpIHtcbiAgICAgIHRoYXQgPSBuZXcgQnVmZmVyKGxlbmd0aClcbiAgICB9XG4gICAgdGhhdC5sZW5ndGggPSBsZW5ndGhcbiAgfVxuXG4gIHJldHVybiB0aGF0XG59XG5cbi8qKlxuICogVGhlIEJ1ZmZlciBjb25zdHJ1Y3RvciByZXR1cm5zIGluc3RhbmNlcyBvZiBgVWludDhBcnJheWAgdGhhdCBoYXZlIHRoZWlyXG4gKiBwcm90b3R5cGUgY2hhbmdlZCB0byBgQnVmZmVyLnByb3RvdHlwZWAuIEZ1cnRoZXJtb3JlLCBgQnVmZmVyYCBpcyBhIHN1YmNsYXNzIG9mXG4gKiBgVWludDhBcnJheWAsIHNvIHRoZSByZXR1cm5lZCBpbnN0YW5jZXMgd2lsbCBoYXZlIGFsbCB0aGUgbm9kZSBgQnVmZmVyYCBtZXRob2RzXG4gKiBhbmQgdGhlIGBVaW50OEFycmF5YCBtZXRob2RzLiBTcXVhcmUgYnJhY2tldCBub3RhdGlvbiB3b3JrcyBhcyBleHBlY3RlZCAtLSBpdFxuICogcmV0dXJucyBhIHNpbmdsZSBvY3RldC5cbiAqXG4gKiBUaGUgYFVpbnQ4QXJyYXlgIHByb3RvdHlwZSByZW1haW5zIHVubW9kaWZpZWQuXG4gKi9cblxuZnVuY3Rpb24gQnVmZmVyIChhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkge1xuICBpZiAoIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUICYmICEodGhpcyBpbnN0YW5jZW9mIEJ1ZmZlcikpIHtcbiAgICByZXR1cm4gbmV3IEJ1ZmZlcihhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aClcbiAgfVxuXG4gIC8vIENvbW1vbiBjYXNlLlxuICBpZiAodHlwZW9mIGFyZyA9PT0gJ251bWJlcicpIHtcbiAgICBpZiAodHlwZW9mIGVuY29kaW5nT3JPZmZzZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdJZiBlbmNvZGluZyBpcyBzcGVjaWZpZWQgdGhlbiB0aGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZydcbiAgICAgIClcbiAgICB9XG4gICAgcmV0dXJuIGFsbG9jVW5zYWZlKHRoaXMsIGFyZylcbiAgfVxuICByZXR1cm4gZnJvbSh0aGlzLCBhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aClcbn1cblxuQnVmZmVyLnBvb2xTaXplID0gODE5MiAvLyBub3QgdXNlZCBieSB0aGlzIGltcGxlbWVudGF0aW9uXG5cbi8vIFRPRE86IExlZ2FjeSwgbm90IG5lZWRlZCBhbnltb3JlLiBSZW1vdmUgaW4gbmV4dCBtYWpvciB2ZXJzaW9uLlxuQnVmZmVyLl9hdWdtZW50ID0gZnVuY3Rpb24gKGFycikge1xuICBhcnIuX19wcm90b19fID0gQnVmZmVyLnByb3RvdHlwZVxuICByZXR1cm4gYXJyXG59XG5cbmZ1bmN0aW9uIGZyb20gKHRoYXQsIHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcInZhbHVlXCIgYXJndW1lbnQgbXVzdCBub3QgYmUgYSBudW1iZXInKVxuICB9XG5cbiAgaWYgKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xuICAgIHJldHVybiBmcm9tQXJyYXlCdWZmZXIodGhhdCwgdmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aClcbiAgfVxuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGZyb21TdHJpbmcodGhhdCwgdmFsdWUsIGVuY29kaW5nT3JPZmZzZXQpXG4gIH1cblxuICByZXR1cm4gZnJvbU9iamVjdCh0aGF0LCB2YWx1ZSlcbn1cblxuLyoqXG4gKiBGdW5jdGlvbmFsbHkgZXF1aXZhbGVudCB0byBCdWZmZXIoYXJnLCBlbmNvZGluZykgYnV0IHRocm93cyBhIFR5cGVFcnJvclxuICogaWYgdmFsdWUgaXMgYSBudW1iZXIuXG4gKiBCdWZmZXIuZnJvbShzdHJbLCBlbmNvZGluZ10pXG4gKiBCdWZmZXIuZnJvbShhcnJheSlcbiAqIEJ1ZmZlci5mcm9tKGJ1ZmZlcilcbiAqIEJ1ZmZlci5mcm9tKGFycmF5QnVmZmVyWywgYnl0ZU9mZnNldFssIGxlbmd0aF1dKVxuICoqL1xuQnVmZmVyLmZyb20gPSBmdW5jdGlvbiAodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkge1xuICByZXR1cm4gZnJvbShudWxsLCB2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKVxufVxuXG5pZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgQnVmZmVyLnByb3RvdHlwZS5fX3Byb3RvX18gPSBVaW50OEFycmF5LnByb3RvdHlwZVxuICBCdWZmZXIuX19wcm90b19fID0gVWludDhBcnJheVxuICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnNwZWNpZXMgJiZcbiAgICAgIEJ1ZmZlcltTeW1ib2wuc3BlY2llc10gPT09IEJ1ZmZlcikge1xuICAgIC8vIEZpeCBzdWJhcnJheSgpIGluIEVTMjAxNi4gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2J1ZmZlci9wdWxsLzk3XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlciwgU3ltYm9sLnNwZWNpZXMsIHtcbiAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSlcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRTaXplIChzaXplKSB7XG4gIGlmICh0eXBlb2Ygc2l6ZSAhPT0gJ251bWJlcicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcInNpemVcIiBhcmd1bWVudCBtdXN0IGJlIGEgbnVtYmVyJylcbiAgfSBlbHNlIGlmIChzaXplIDwgMCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcInNpemVcIiBhcmd1bWVudCBtdXN0IG5vdCBiZSBuZWdhdGl2ZScpXG4gIH1cbn1cblxuZnVuY3Rpb24gYWxsb2MgKHRoYXQsIHNpemUsIGZpbGwsIGVuY29kaW5nKSB7XG4gIGFzc2VydFNpemUoc2l6ZSlcbiAgaWYgKHNpemUgPD0gMCkge1xuICAgIHJldHVybiBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSlcbiAgfVxuICBpZiAoZmlsbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gT25seSBwYXkgYXR0ZW50aW9uIHRvIGVuY29kaW5nIGlmIGl0J3MgYSBzdHJpbmcuIFRoaXNcbiAgICAvLyBwcmV2ZW50cyBhY2NpZGVudGFsbHkgc2VuZGluZyBpbiBhIG51bWJlciB0aGF0IHdvdWxkXG4gICAgLy8gYmUgaW50ZXJwcmV0dGVkIGFzIGEgc3RhcnQgb2Zmc2V0LlxuICAgIHJldHVybiB0eXBlb2YgZW5jb2RpbmcgPT09ICdzdHJpbmcnXG4gICAgICA/IGNyZWF0ZUJ1ZmZlcih0aGF0LCBzaXplKS5maWxsKGZpbGwsIGVuY29kaW5nKVxuICAgICAgOiBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSkuZmlsbChmaWxsKVxuICB9XG4gIHJldHVybiBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSlcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGZpbGxlZCBCdWZmZXIgaW5zdGFuY2UuXG4gKiBhbGxvYyhzaXplWywgZmlsbFssIGVuY29kaW5nXV0pXG4gKiovXG5CdWZmZXIuYWxsb2MgPSBmdW5jdGlvbiAoc2l6ZSwgZmlsbCwgZW5jb2RpbmcpIHtcbiAgcmV0dXJuIGFsbG9jKG51bGwsIHNpemUsIGZpbGwsIGVuY29kaW5nKVxufVxuXG5mdW5jdGlvbiBhbGxvY1Vuc2FmZSAodGhhdCwgc2l6ZSkge1xuICBhc3NlcnRTaXplKHNpemUpXG4gIHRoYXQgPSBjcmVhdGVCdWZmZXIodGhhdCwgc2l6ZSA8IDAgPyAwIDogY2hlY2tlZChzaXplKSB8IDApXG4gIGlmICghQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7ICsraSkge1xuICAgICAgdGhhdFtpXSA9IDBcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRoYXRcbn1cblxuLyoqXG4gKiBFcXVpdmFsZW50IHRvIEJ1ZmZlcihudW0pLCBieSBkZWZhdWx0IGNyZWF0ZXMgYSBub24temVyby1maWxsZWQgQnVmZmVyIGluc3RhbmNlLlxuICogKi9cbkJ1ZmZlci5hbGxvY1Vuc2FmZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gIHJldHVybiBhbGxvY1Vuc2FmZShudWxsLCBzaXplKVxufVxuLyoqXG4gKiBFcXVpdmFsZW50IHRvIFNsb3dCdWZmZXIobnVtKSwgYnkgZGVmYXVsdCBjcmVhdGVzIGEgbm9uLXplcm8tZmlsbGVkIEJ1ZmZlciBpbnN0YW5jZS5cbiAqL1xuQnVmZmVyLmFsbG9jVW5zYWZlU2xvdyA9IGZ1bmN0aW9uIChzaXplKSB7XG4gIHJldHVybiBhbGxvY1Vuc2FmZShudWxsLCBzaXplKVxufVxuXG5mdW5jdGlvbiBmcm9tU3RyaW5nICh0aGF0LCBzdHJpbmcsIGVuY29kaW5nKSB7XG4gIGlmICh0eXBlb2YgZW5jb2RpbmcgIT09ICdzdHJpbmcnIHx8IGVuY29kaW5nID09PSAnJykge1xuICAgIGVuY29kaW5nID0gJ3V0ZjgnXG4gIH1cblxuICBpZiAoIUJ1ZmZlci5pc0VuY29kaW5nKGVuY29kaW5nKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1wiZW5jb2RpbmdcIiBtdXN0IGJlIGEgdmFsaWQgc3RyaW5nIGVuY29kaW5nJylcbiAgfVxuXG4gIHZhciBsZW5ndGggPSBieXRlTGVuZ3RoKHN0cmluZywgZW5jb2RpbmcpIHwgMFxuICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbmd0aClcblxuICB2YXIgYWN0dWFsID0gdGhhdC53cml0ZShzdHJpbmcsIGVuY29kaW5nKVxuXG4gIGlmIChhY3R1YWwgIT09IGxlbmd0aCkge1xuICAgIC8vIFdyaXRpbmcgYSBoZXggc3RyaW5nLCBmb3IgZXhhbXBsZSwgdGhhdCBjb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnMgd2lsbFxuICAgIC8vIGNhdXNlIGV2ZXJ5dGhpbmcgYWZ0ZXIgdGhlIGZpcnN0IGludmFsaWQgY2hhcmFjdGVyIHRvIGJlIGlnbm9yZWQuIChlLmcuXG4gICAgLy8gJ2FieHhjZCcgd2lsbCBiZSB0cmVhdGVkIGFzICdhYicpXG4gICAgdGhhdCA9IHRoYXQuc2xpY2UoMCwgYWN0dWFsKVxuICB9XG5cbiAgcmV0dXJuIHRoYXRcbn1cblxuZnVuY3Rpb24gZnJvbUFycmF5TGlrZSAodGhhdCwgYXJyYXkpIHtcbiAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCA8IDAgPyAwIDogY2hlY2tlZChhcnJheS5sZW5ndGgpIHwgMFxuICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbmd0aClcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkge1xuICAgIHRoYXRbaV0gPSBhcnJheVtpXSAmIDI1NVxuICB9XG4gIHJldHVybiB0aGF0XG59XG5cbmZ1bmN0aW9uIGZyb21BcnJheUJ1ZmZlciAodGhhdCwgYXJyYXksIGJ5dGVPZmZzZXQsIGxlbmd0aCkge1xuICBhcnJheS5ieXRlTGVuZ3RoIC8vIHRoaXMgdGhyb3dzIGlmIGBhcnJheWAgaXMgbm90IGEgdmFsaWQgQXJyYXlCdWZmZXJcblxuICBpZiAoYnl0ZU9mZnNldCA8IDAgfHwgYXJyYXkuYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQpIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXFwnb2Zmc2V0XFwnIGlzIG91dCBvZiBib3VuZHMnKVxuICB9XG5cbiAgaWYgKGFycmF5LmJ5dGVMZW5ndGggPCBieXRlT2Zmc2V0ICsgKGxlbmd0aCB8fCAwKSkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdcXCdsZW5ndGhcXCcgaXMgb3V0IG9mIGJvdW5kcycpXG4gIH1cblxuICBpZiAoYnl0ZU9mZnNldCA9PT0gdW5kZWZpbmVkICYmIGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSlcbiAgfSBlbHNlIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkge1xuICAgIGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXksIGJ5dGVPZmZzZXQpXG4gIH0gZWxzZSB7XG4gICAgYXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKVxuICB9XG5cbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgLy8gUmV0dXJuIGFuIGF1Z21lbnRlZCBgVWludDhBcnJheWAgaW5zdGFuY2UsIGZvciBiZXN0IHBlcmZvcm1hbmNlXG4gICAgdGhhdCA9IGFycmF5XG4gICAgdGhhdC5fX3Byb3RvX18gPSBCdWZmZXIucHJvdG90eXBlXG4gIH0gZWxzZSB7XG4gICAgLy8gRmFsbGJhY2s6IFJldHVybiBhbiBvYmplY3QgaW5zdGFuY2Ugb2YgdGhlIEJ1ZmZlciBjbGFzc1xuICAgIHRoYXQgPSBmcm9tQXJyYXlMaWtlKHRoYXQsIGFycmF5KVxuICB9XG4gIHJldHVybiB0aGF0XG59XG5cbmZ1bmN0aW9uIGZyb21PYmplY3QgKHRoYXQsIG9iaikge1xuICBpZiAoQnVmZmVyLmlzQnVmZmVyKG9iaikpIHtcbiAgICB2YXIgbGVuID0gY2hlY2tlZChvYmoubGVuZ3RoKSB8IDBcbiAgICB0aGF0ID0gY3JlYXRlQnVmZmVyKHRoYXQsIGxlbilcblxuICAgIGlmICh0aGF0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoYXRcbiAgICB9XG5cbiAgICBvYmouY29weSh0aGF0LCAwLCAwLCBsZW4pXG4gICAgcmV0dXJuIHRoYXRcbiAgfVxuXG4gIGlmIChvYmopIHtcbiAgICBpZiAoKHR5cGVvZiBBcnJheUJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgb2JqLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB8fCAnbGVuZ3RoJyBpbiBvYmopIHtcbiAgICAgIGlmICh0eXBlb2Ygb2JqLmxlbmd0aCAhPT0gJ251bWJlcicgfHwgaXNuYW4ob2JqLmxlbmd0aCkpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcih0aGF0LCAwKVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UodGhhdCwgb2JqKVxuICAgIH1cblxuICAgIGlmIChvYmoudHlwZSA9PT0gJ0J1ZmZlcicgJiYgaXNBcnJheShvYmouZGF0YSkpIHtcbiAgICAgIHJldHVybiBmcm9tQXJyYXlMaWtlKHRoYXQsIG9iai5kYXRhKVxuICAgIH1cbiAgfVxuXG4gIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBhcnJheS1saWtlIG9iamVjdC4nKVxufVxuXG5mdW5jdGlvbiBjaGVja2VkIChsZW5ndGgpIHtcbiAgLy8gTm90ZTogY2Fubm90IHVzZSBgbGVuZ3RoIDwga01heExlbmd0aCgpYCBoZXJlIGJlY2F1c2UgdGhhdCBmYWlscyB3aGVuXG4gIC8vIGxlbmd0aCBpcyBOYU4gKHdoaWNoIGlzIG90aGVyd2lzZSBjb2VyY2VkIHRvIHplcm8uKVxuICBpZiAobGVuZ3RoID49IGtNYXhMZW5ndGgoKSkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICdzaXplOiAweCcgKyBrTWF4TGVuZ3RoKCkudG9TdHJpbmcoMTYpICsgJyBieXRlcycpXG4gIH1cbiAgcmV0dXJuIGxlbmd0aCB8IDBcbn1cblxuZnVuY3Rpb24gU2xvd0J1ZmZlciAobGVuZ3RoKSB7XG4gIGlmICgrbGVuZ3RoICE9IGxlbmd0aCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcVxuICAgIGxlbmd0aCA9IDBcbiAgfVxuICByZXR1cm4gQnVmZmVyLmFsbG9jKCtsZW5ndGgpXG59XG5cbkJ1ZmZlci5pc0J1ZmZlciA9IGZ1bmN0aW9uIGlzQnVmZmVyIChiKSB7XG4gIHJldHVybiAhIShiICE9IG51bGwgJiYgYi5faXNCdWZmZXIpXG59XG5cbkJ1ZmZlci5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZSAoYSwgYikge1xuICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihhKSB8fCAhQnVmZmVyLmlzQnVmZmVyKGIpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnRzIG11c3QgYmUgQnVmZmVycycpXG4gIH1cblxuICBpZiAoYSA9PT0gYikgcmV0dXJuIDBcblxuICB2YXIgeCA9IGEubGVuZ3RoXG4gIHZhciB5ID0gYi5sZW5ndGhcblxuICBmb3IgKHZhciBpID0gMCwgbGVuID0gTWF0aC5taW4oeCwgeSk7IGkgPCBsZW47ICsraSkge1xuICAgIGlmIChhW2ldICE9PSBiW2ldKSB7XG4gICAgICB4ID0gYVtpXVxuICAgICAgeSA9IGJbaV1cbiAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgaWYgKHggPCB5KSByZXR1cm4gLTFcbiAgaWYgKHkgPCB4KSByZXR1cm4gMVxuICByZXR1cm4gMFxufVxuXG5CdWZmZXIuaXNFbmNvZGluZyA9IGZ1bmN0aW9uIGlzRW5jb2RpbmcgKGVuY29kaW5nKSB7XG4gIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgY2FzZSAnaGV4JzpcbiAgICBjYXNlICd1dGY4JzpcbiAgICBjYXNlICd1dGYtOCc6XG4gICAgY2FzZSAnYXNjaWknOlxuICAgIGNhc2UgJ2xhdGluMSc6XG4gICAgY2FzZSAnYmluYXJ5JzpcbiAgICBjYXNlICdiYXNlNjQnOlxuICAgIGNhc2UgJ3VjczInOlxuICAgIGNhc2UgJ3Vjcy0yJzpcbiAgICBjYXNlICd1dGYxNmxlJzpcbiAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuXG5CdWZmZXIuY29uY2F0ID0gZnVuY3Rpb24gY29uY2F0IChsaXN0LCBsZW5ndGgpIHtcbiAgaWYgKCFpc0FycmF5KGxpc3QpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJsaXN0XCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJylcbiAgfVxuXG4gIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBCdWZmZXIuYWxsb2MoMClcbiAgfVxuXG4gIHZhciBpXG4gIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkge1xuICAgIGxlbmd0aCA9IDBcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7ICsraSkge1xuICAgICAgbGVuZ3RoICs9IGxpc3RbaV0ubGVuZ3RoXG4gICAgfVxuICB9XG5cbiAgdmFyIGJ1ZmZlciA9IEJ1ZmZlci5hbGxvY1Vuc2FmZShsZW5ndGgpXG4gIHZhciBwb3MgPSAwXG4gIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGJ1ZiA9IGxpc3RbaV1cbiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihidWYpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdcImxpc3RcIiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKVxuICAgIH1cbiAgICBidWYuY29weShidWZmZXIsIHBvcylcbiAgICBwb3MgKz0gYnVmLmxlbmd0aFxuICB9XG4gIHJldHVybiBidWZmZXJcbn1cblxuZnVuY3Rpb24gYnl0ZUxlbmd0aCAoc3RyaW5nLCBlbmNvZGluZykge1xuICBpZiAoQnVmZmVyLmlzQnVmZmVyKHN0cmluZykpIHtcbiAgICByZXR1cm4gc3RyaW5nLmxlbmd0aFxuICB9XG4gIGlmICh0eXBlb2YgQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBBcnJheUJ1ZmZlci5pc1ZpZXcgPT09ICdmdW5jdGlvbicgJiZcbiAgICAgIChBcnJheUJ1ZmZlci5pc1ZpZXcoc3RyaW5nKSB8fCBzdHJpbmcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcbiAgICByZXR1cm4gc3RyaW5nLmJ5dGVMZW5ndGhcbiAgfVxuICBpZiAodHlwZW9mIHN0cmluZyAhPT0gJ3N0cmluZycpIHtcbiAgICBzdHJpbmcgPSAnJyArIHN0cmluZ1xuICB9XG5cbiAgdmFyIGxlbiA9IHN0cmluZy5sZW5ndGhcbiAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuIDBcblxuICAvLyBVc2UgYSBmb3IgbG9vcCB0byBhdm9pZCByZWN1cnNpb25cbiAgdmFyIGxvd2VyZWRDYXNlID0gZmFsc2VcbiAgZm9yICg7Oykge1xuICAgIHN3aXRjaCAoZW5jb2RpbmcpIHtcbiAgICAgIGNhc2UgJ2FzY2lpJzpcbiAgICAgIGNhc2UgJ2xhdGluMSc6XG4gICAgICBjYXNlICdiaW5hcnknOlxuICAgICAgICByZXR1cm4gbGVuXG4gICAgICBjYXNlICd1dGY4JzpcbiAgICAgIGNhc2UgJ3V0Zi04JzpcbiAgICAgIGNhc2UgdW5kZWZpbmVkOlxuICAgICAgICByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGhcbiAgICAgIGNhc2UgJ3VjczInOlxuICAgICAgY2FzZSAndWNzLTInOlxuICAgICAgY2FzZSAndXRmMTZsZSc6XG4gICAgICBjYXNlICd1dGYtMTZsZSc6XG4gICAgICAgIHJldHVybiBsZW4gKiAyXG4gICAgICBjYXNlICdoZXgnOlxuICAgICAgICByZXR1cm4gbGVuID4+PiAxXG4gICAgICBjYXNlICdiYXNlNjQnOlxuICAgICAgICByZXR1cm4gYmFzZTY0VG9CeXRlcyhzdHJpbmcpLmxlbmd0aFxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKGxvd2VyZWRDYXNlKSByZXR1cm4gdXRmOFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGggLy8gYXNzdW1lIHV0ZjhcbiAgICAgICAgZW5jb2RpbmcgPSAoJycgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKVxuICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWVcbiAgICB9XG4gIH1cbn1cbkJ1ZmZlci5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aFxuXG5mdW5jdGlvbiBzbG93VG9TdHJpbmcgKGVuY29kaW5nLCBzdGFydCwgZW5kKSB7XG4gIHZhciBsb3dlcmVkQ2FzZSA9IGZhbHNlXG5cbiAgLy8gTm8gbmVlZCB0byB2ZXJpZnkgdGhhdCBcInRoaXMubGVuZ3RoIDw9IE1BWF9VSU5UMzJcIiBzaW5jZSBpdCdzIGEgcmVhZC1vbmx5XG4gIC8vIHByb3BlcnR5IG9mIGEgdHlwZWQgYXJyYXkuXG5cbiAgLy8gVGhpcyBiZWhhdmVzIG5laXRoZXIgbGlrZSBTdHJpbmcgbm9yIFVpbnQ4QXJyYXkgaW4gdGhhdCB3ZSBzZXQgc3RhcnQvZW5kXG4gIC8vIHRvIHRoZWlyIHVwcGVyL2xvd2VyIGJvdW5kcyBpZiB0aGUgdmFsdWUgcGFzc2VkIGlzIG91dCBvZiByYW5nZS5cbiAgLy8gdW5kZWZpbmVkIGlzIGhhbmRsZWQgc3BlY2lhbGx5IGFzIHBlciBFQ01BLTI2MiA2dGggRWRpdGlvbixcbiAgLy8gU2VjdGlvbiAxMy4zLjMuNyBSdW50aW1lIFNlbWFudGljczogS2V5ZWRCaW5kaW5nSW5pdGlhbGl6YXRpb24uXG4gIGlmIChzdGFydCA9PT0gdW5kZWZpbmVkIHx8IHN0YXJ0IDwgMCkge1xuICAgIHN0YXJ0ID0gMFxuICB9XG4gIC8vIFJldHVybiBlYXJseSBpZiBzdGFydCA+IHRoaXMubGVuZ3RoLiBEb25lIGhlcmUgdG8gcHJldmVudCBwb3RlbnRpYWwgdWludDMyXG4gIC8vIGNvZXJjaW9uIGZhaWwgYmVsb3cuXG4gIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7XG4gICAgcmV0dXJuICcnXG4gIH1cblxuICBpZiAoZW5kID09PSB1bmRlZmluZWQgfHwgZW5kID4gdGhpcy5sZW5ndGgpIHtcbiAgICBlbmQgPSB0aGlzLmxlbmd0aFxuICB9XG5cbiAgaWYgKGVuZCA8PSAwKSB7XG4gICAgcmV0dXJuICcnXG4gIH1cblxuICAvLyBGb3JjZSBjb2Vyc2lvbiB0byB1aW50MzIuIFRoaXMgd2lsbCBhbHNvIGNvZXJjZSBmYWxzZXkvTmFOIHZhbHVlcyB0byAwLlxuICBlbmQgPj4+PSAwXG4gIHN0YXJ0ID4+Pj0gMFxuXG4gIGlmIChlbmQgPD0gc3RhcnQpIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIGlmICghZW5jb2RpbmcpIGVuY29kaW5nID0gJ3V0ZjgnXG5cbiAgd2hpbGUgKHRydWUpIHtcbiAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICBjYXNlICdoZXgnOlxuICAgICAgICByZXR1cm4gaGV4U2xpY2UodGhpcywgc3RhcnQsIGVuZClcblxuICAgICAgY2FzZSAndXRmOCc6XG4gICAgICBjYXNlICd1dGYtOCc6XG4gICAgICAgIHJldHVybiB1dGY4U2xpY2UodGhpcywgc3RhcnQsIGVuZClcblxuICAgICAgY2FzZSAnYXNjaWknOlxuICAgICAgICByZXR1cm4gYXNjaWlTbGljZSh0aGlzLCBzdGFydCwgZW5kKVxuXG4gICAgICBjYXNlICdsYXRpbjEnOlxuICAgICAgY2FzZSAnYmluYXJ5JzpcbiAgICAgICAgcmV0dXJuIGxhdGluMVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpXG5cbiAgICAgIGNhc2UgJ2Jhc2U2NCc6XG4gICAgICAgIHJldHVybiBiYXNlNjRTbGljZSh0aGlzLCBzdGFydCwgZW5kKVxuXG4gICAgICBjYXNlICd1Y3MyJzpcbiAgICAgIGNhc2UgJ3Vjcy0yJzpcbiAgICAgIGNhc2UgJ3V0ZjE2bGUnOlxuICAgICAgY2FzZSAndXRmLTE2bGUnOlxuICAgICAgICByZXR1cm4gdXRmMTZsZVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpXG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmIChsb3dlcmVkQ2FzZSkgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBlbmNvZGluZzogJyArIGVuY29kaW5nKVxuICAgICAgICBlbmNvZGluZyA9IChlbmNvZGluZyArICcnKS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIGxvd2VyZWRDYXNlID0gdHJ1ZVxuICAgIH1cbiAgfVxufVxuXG4vLyBUaGUgcHJvcGVydHkgaXMgdXNlZCBieSBgQnVmZmVyLmlzQnVmZmVyYCBhbmQgYGlzLWJ1ZmZlcmAgKGluIFNhZmFyaSA1LTcpIHRvIGRldGVjdFxuLy8gQnVmZmVyIGluc3RhbmNlcy5cbkJ1ZmZlci5wcm90b3R5cGUuX2lzQnVmZmVyID0gdHJ1ZVxuXG5mdW5jdGlvbiBzd2FwIChiLCBuLCBtKSB7XG4gIHZhciBpID0gYltuXVxuICBiW25dID0gYlttXVxuICBiW21dID0gaVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uIHN3YXAxNiAoKSB7XG4gIHZhciBsZW4gPSB0aGlzLmxlbmd0aFxuICBpZiAobGVuICUgMiAhPT0gMCkge1xuICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMTYtYml0cycpXG4gIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkgKz0gMikge1xuICAgIHN3YXAodGhpcywgaSwgaSArIDEpXG4gIH1cbiAgcmV0dXJuIHRoaXNcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5zd2FwMzIgPSBmdW5jdGlvbiBzd2FwMzIgKCkge1xuICB2YXIgbGVuID0gdGhpcy5sZW5ndGhcbiAgaWYgKGxlbiAlIDQgIT09IDApIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDMyLWJpdHMnKVxuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgICBzd2FwKHRoaXMsIGksIGkgKyAzKVxuICAgIHN3YXAodGhpcywgaSArIDEsIGkgKyAyKVxuICB9XG4gIHJldHVybiB0aGlzXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuc3dhcDY0ID0gZnVuY3Rpb24gc3dhcDY0ICgpIHtcbiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoXG4gIGlmIChsZW4gJSA4ICE9PSAwKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0J1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA2NC1iaXRzJylcbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSArPSA4KSB7XG4gICAgc3dhcCh0aGlzLCBpLCBpICsgNylcbiAgICBzd2FwKHRoaXMsIGkgKyAxLCBpICsgNilcbiAgICBzd2FwKHRoaXMsIGkgKyAyLCBpICsgNSlcbiAgICBzd2FwKHRoaXMsIGkgKyAzLCBpICsgNClcbiAgfVxuICByZXR1cm4gdGhpc1xufVxuXG5CdWZmZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcgKCkge1xuICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGggfCAwXG4gIGlmIChsZW5ndGggPT09IDApIHJldHVybiAnJ1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCAwLCBsZW5ndGgpXG4gIHJldHVybiBzbG93VG9TdHJpbmcuYXBwbHkodGhpcywgYXJndW1lbnRzKVxufVxuXG5CdWZmZXIucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIGVxdWFscyAoYikge1xuICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlcicpXG4gIGlmICh0aGlzID09PSBiKSByZXR1cm4gdHJ1ZVxuICByZXR1cm4gQnVmZmVyLmNvbXBhcmUodGhpcywgYikgPT09IDBcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5pbnNwZWN0ID0gZnVuY3Rpb24gaW5zcGVjdCAoKSB7XG4gIHZhciBzdHIgPSAnJ1xuICB2YXIgbWF4ID0gZXhwb3J0cy5JTlNQRUNUX01BWF9CWVRFU1xuICBpZiAodGhpcy5sZW5ndGggPiAwKSB7XG4gICAgc3RyID0gdGhpcy50b1N0cmluZygnaGV4JywgMCwgbWF4KS5tYXRjaCgvLnsyfS9nKS5qb2luKCcgJylcbiAgICBpZiAodGhpcy5sZW5ndGggPiBtYXgpIHN0ciArPSAnIC4uLiAnXG4gIH1cbiAgcmV0dXJuICc8QnVmZmVyICcgKyBzdHIgKyAnPidcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZSAodGFyZ2V0LCBzdGFydCwgZW5kLCB0aGlzU3RhcnQsIHRoaXNFbmQpIHtcbiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIodGFyZ2V0KSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXInKVxuICB9XG5cbiAgaWYgKHN0YXJ0ID09PSB1bmRlZmluZWQpIHtcbiAgICBzdGFydCA9IDBcbiAgfVxuICBpZiAoZW5kID09PSB1bmRlZmluZWQpIHtcbiAgICBlbmQgPSB0YXJnZXQgPyB0YXJnZXQubGVuZ3RoIDogMFxuICB9XG4gIGlmICh0aGlzU3RhcnQgPT09IHVuZGVmaW5lZCkge1xuICAgIHRoaXNTdGFydCA9IDBcbiAgfVxuICBpZiAodGhpc0VuZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhpc0VuZCA9IHRoaXMubGVuZ3RoXG4gIH1cblxuICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRhcmdldC5sZW5ndGggfHwgdGhpc1N0YXJ0IDwgMCB8fCB0aGlzRW5kID4gdGhpcy5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignb3V0IG9mIHJhbmdlIGluZGV4JylcbiAgfVxuXG4gIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCAmJiBzdGFydCA+PSBlbmQpIHtcbiAgICByZXR1cm4gMFxuICB9XG4gIGlmICh0aGlzU3RhcnQgPj0gdGhpc0VuZCkge1xuICAgIHJldHVybiAtMVxuICB9XG4gIGlmIChzdGFydCA+PSBlbmQpIHtcbiAgICByZXR1cm4gMVxuICB9XG5cbiAgc3RhcnQgPj4+PSAwXG4gIGVuZCA+Pj49IDBcbiAgdGhpc1N0YXJ0ID4+Pj0gMFxuICB0aGlzRW5kID4+Pj0gMFxuXG4gIGlmICh0aGlzID09PSB0YXJnZXQpIHJldHVybiAwXG5cbiAgdmFyIHggPSB0aGlzRW5kIC0gdGhpc1N0YXJ0XG4gIHZhciB5ID0gZW5kIC0gc3RhcnRcbiAgdmFyIGxlbiA9IE1hdGgubWluKHgsIHkpXG5cbiAgdmFyIHRoaXNDb3B5ID0gdGhpcy5zbGljZSh0aGlzU3RhcnQsIHRoaXNFbmQpXG4gIHZhciB0YXJnZXRDb3B5ID0gdGFyZ2V0LnNsaWNlKHN0YXJ0LCBlbmQpXG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkge1xuICAgIGlmICh0aGlzQ29weVtpXSAhPT0gdGFyZ2V0Q29weVtpXSkge1xuICAgICAgeCA9IHRoaXNDb3B5W2ldXG4gICAgICB5ID0gdGFyZ2V0Q29weVtpXVxuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cblxuICBpZiAoeCA8IHkpIHJldHVybiAtMVxuICBpZiAoeSA8IHgpIHJldHVybiAxXG4gIHJldHVybiAwXG59XG5cbi8vIEZpbmRzIGVpdGhlciB0aGUgZmlyc3QgaW5kZXggb2YgYHZhbGAgaW4gYGJ1ZmZlcmAgYXQgb2Zmc2V0ID49IGBieXRlT2Zmc2V0YCxcbi8vIE9SIHRoZSBsYXN0IGluZGV4IG9mIGB2YWxgIGluIGBidWZmZXJgIGF0IG9mZnNldCA8PSBgYnl0ZU9mZnNldGAuXG4vL1xuLy8gQXJndW1lbnRzOlxuLy8gLSBidWZmZXIgLSBhIEJ1ZmZlciB0byBzZWFyY2hcbi8vIC0gdmFsIC0gYSBzdHJpbmcsIEJ1ZmZlciwgb3IgbnVtYmVyXG4vLyAtIGJ5dGVPZmZzZXQgLSBhbiBpbmRleCBpbnRvIGBidWZmZXJgOyB3aWxsIGJlIGNsYW1wZWQgdG8gYW4gaW50MzJcbi8vIC0gZW5jb2RpbmcgLSBhbiBvcHRpb25hbCBlbmNvZGluZywgcmVsZXZhbnQgaXMgdmFsIGlzIGEgc3RyaW5nXG4vLyAtIGRpciAtIHRydWUgZm9yIGluZGV4T2YsIGZhbHNlIGZvciBsYXN0SW5kZXhPZlxuZnVuY3Rpb24gYmlkaXJlY3Rpb25hbEluZGV4T2YgKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZGlyKSB7XG4gIC8vIEVtcHR5IGJ1ZmZlciBtZWFucyBubyBtYXRjaFxuICBpZiAoYnVmZmVyLmxlbmd0aCA9PT0gMCkgcmV0dXJuIC0xXG5cbiAgLy8gTm9ybWFsaXplIGJ5dGVPZmZzZXRcbiAgaWYgKHR5cGVvZiBieXRlT2Zmc2V0ID09PSAnc3RyaW5nJykge1xuICAgIGVuY29kaW5nID0gYnl0ZU9mZnNldFxuICAgIGJ5dGVPZmZzZXQgPSAwXG4gIH0gZWxzZSBpZiAoYnl0ZU9mZnNldCA+IDB4N2ZmZmZmZmYpIHtcbiAgICBieXRlT2Zmc2V0ID0gMHg3ZmZmZmZmZlxuICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPCAtMHg4MDAwMDAwMCkge1xuICAgIGJ5dGVPZmZzZXQgPSAtMHg4MDAwMDAwMFxuICB9XG4gIGJ5dGVPZmZzZXQgPSArYnl0ZU9mZnNldCAgLy8gQ29lcmNlIHRvIE51bWJlci5cbiAgaWYgKGlzTmFOKGJ5dGVPZmZzZXQpKSB7XG4gICAgLy8gYnl0ZU9mZnNldDogaXQgaXQncyB1bmRlZmluZWQsIG51bGwsIE5hTiwgXCJmb29cIiwgZXRjLCBzZWFyY2ggd2hvbGUgYnVmZmVyXG4gICAgYnl0ZU9mZnNldCA9IGRpciA/IDAgOiAoYnVmZmVyLmxlbmd0aCAtIDEpXG4gIH1cblxuICAvLyBOb3JtYWxpemUgYnl0ZU9mZnNldDogbmVnYXRpdmUgb2Zmc2V0cyBzdGFydCBmcm9tIHRoZSBlbmQgb2YgdGhlIGJ1ZmZlclxuICBpZiAoYnl0ZU9mZnNldCA8IDApIGJ5dGVPZmZzZXQgPSBidWZmZXIubGVuZ3RoICsgYnl0ZU9mZnNldFxuICBpZiAoYnl0ZU9mZnNldCA+PSBidWZmZXIubGVuZ3RoKSB7XG4gICAgaWYgKGRpcikgcmV0dXJuIC0xXG4gICAgZWxzZSBieXRlT2Zmc2V0ID0gYnVmZmVyLmxlbmd0aCAtIDFcbiAgfSBlbHNlIGlmIChieXRlT2Zmc2V0IDwgMCkge1xuICAgIGlmIChkaXIpIGJ5dGVPZmZzZXQgPSAwXG4gICAgZWxzZSByZXR1cm4gLTFcbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSB2YWxcbiAgaWYgKHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7XG4gICAgdmFsID0gQnVmZmVyLmZyb20odmFsLCBlbmNvZGluZylcbiAgfVxuXG4gIC8vIEZpbmFsbHksIHNlYXJjaCBlaXRoZXIgaW5kZXhPZiAoaWYgZGlyIGlzIHRydWUpIG9yIGxhc3RJbmRleE9mXG4gIGlmIChCdWZmZXIuaXNCdWZmZXIodmFsKSkge1xuICAgIC8vIFNwZWNpYWwgY2FzZTogbG9va2luZyBmb3IgZW1wdHkgc3RyaW5nL2J1ZmZlciBhbHdheXMgZmFpbHNcbiAgICBpZiAodmFsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIC0xXG4gICAgfVxuICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpXG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHtcbiAgICB2YWwgPSB2YWwgJiAweEZGIC8vIFNlYXJjaCBmb3IgYSBieXRlIHZhbHVlIFswLTI1NV1cbiAgICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQgJiZcbiAgICAgICAgdHlwZW9mIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGlmIChkaXIpIHtcbiAgICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkucHJvdG90eXBlLmluZGV4T2YuY2FsbChidWZmZXIsIHZhbCwgYnl0ZU9mZnNldClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGJ1ZmZlciwgdmFsLCBieXRlT2Zmc2V0KVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXJyYXlJbmRleE9mKGJ1ZmZlciwgWyB2YWwgXSwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcilcbiAgfVxuXG4gIHRocm93IG5ldyBUeXBlRXJyb3IoJ3ZhbCBtdXN0IGJlIHN0cmluZywgbnVtYmVyIG9yIEJ1ZmZlcicpXG59XG5cbmZ1bmN0aW9uIGFycmF5SW5kZXhPZiAoYXJyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHtcbiAgdmFyIGluZGV4U2l6ZSA9IDFcbiAgdmFyIGFyckxlbmd0aCA9IGFyci5sZW5ndGhcbiAgdmFyIHZhbExlbmd0aCA9IHZhbC5sZW5ndGhcblxuICBpZiAoZW5jb2RpbmcgIT09IHVuZGVmaW5lZCkge1xuICAgIGVuY29kaW5nID0gU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpXG4gICAgaWYgKGVuY29kaW5nID09PSAndWNzMicgfHwgZW5jb2RpbmcgPT09ICd1Y3MtMicgfHxcbiAgICAgICAgZW5jb2RpbmcgPT09ICd1dGYxNmxlJyB8fCBlbmNvZGluZyA9PT0gJ3V0Zi0xNmxlJykge1xuICAgICAgaWYgKGFyci5sZW5ndGggPCAyIHx8IHZhbC5sZW5ndGggPCAyKSB7XG4gICAgICAgIHJldHVybiAtMVxuICAgICAgfVxuICAgICAgaW5kZXhTaXplID0gMlxuICAgICAgYXJyTGVuZ3RoIC89IDJcbiAgICAgIHZhbExlbmd0aCAvPSAyXG4gICAgICBieXRlT2Zmc2V0IC89IDJcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZWFkIChidWYsIGkpIHtcbiAgICBpZiAoaW5kZXhTaXplID09PSAxKSB7XG4gICAgICByZXR1cm4gYnVmW2ldXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBidWYucmVhZFVJbnQxNkJFKGkgKiBpbmRleFNpemUpXG4gICAgfVxuICB9XG5cbiAgdmFyIGlcbiAgaWYgKGRpcikge1xuICAgIHZhciBmb3VuZEluZGV4ID0gLTFcbiAgICBmb3IgKGkgPSBieXRlT2Zmc2V0OyBpIDwgYXJyTGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChyZWFkKGFyciwgaSkgPT09IHJlYWQodmFsLCBmb3VuZEluZGV4ID09PSAtMSA/IDAgOiBpIC0gZm91bmRJbmRleCkpIHtcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPT09IC0xKSBmb3VuZEluZGV4ID0gaVxuICAgICAgICBpZiAoaSAtIGZvdW5kSW5kZXggKyAxID09PSB2YWxMZW5ndGgpIHJldHVybiBmb3VuZEluZGV4ICogaW5kZXhTaXplXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gLTEpIGkgLT0gaSAtIGZvdW5kSW5kZXhcbiAgICAgICAgZm91bmRJbmRleCA9IC0xXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGlmIChieXRlT2Zmc2V0ICsgdmFsTGVuZ3RoID4gYXJyTGVuZ3RoKSBieXRlT2Zmc2V0ID0gYXJyTGVuZ3RoIC0gdmFsTGVuZ3RoXG4gICAgZm9yIChpID0gYnl0ZU9mZnNldDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIHZhciBmb3VuZCA9IHRydWVcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdmFsTGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKHJlYWQoYXJyLCBpICsgaikgIT09IHJlYWQodmFsLCBqKSkge1xuICAgICAgICAgIGZvdW5kID0gZmFsc2VcbiAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZm91bmQpIHJldHVybiBpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIC0xXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbiBpbmNsdWRlcyAodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykge1xuICByZXR1cm4gdGhpcy5pbmRleE9mKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpICE9PSAtMVxufVxuXG5CdWZmZXIucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiBpbmRleE9mICh2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7XG4gIHJldHVybiBiaWRpcmVjdGlvbmFsSW5kZXhPZih0aGlzLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCB0cnVlKVxufVxuXG5CdWZmZXIucHJvdG90eXBlLmxhc3RJbmRleE9mID0gZnVuY3Rpb24gbGFzdEluZGV4T2YgKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHtcbiAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGZhbHNlKVxufVxuXG5mdW5jdGlvbiBoZXhXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIG9mZnNldCA9IE51bWJlcihvZmZzZXQpIHx8IDBcbiAgdmFyIHJlbWFpbmluZyA9IGJ1Zi5sZW5ndGggLSBvZmZzZXRcbiAgaWYgKCFsZW5ndGgpIHtcbiAgICBsZW5ndGggPSByZW1haW5pbmdcbiAgfSBlbHNlIHtcbiAgICBsZW5ndGggPSBOdW1iZXIobGVuZ3RoKVxuICAgIGlmIChsZW5ndGggPiByZW1haW5pbmcpIHtcbiAgICAgIGxlbmd0aCA9IHJlbWFpbmluZ1xuICAgIH1cbiAgfVxuXG4gIC8vIG11c3QgYmUgYW4gZXZlbiBudW1iZXIgb2YgZGlnaXRzXG4gIHZhciBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoXG4gIGlmIChzdHJMZW4gJSAyICE9PSAwKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdJbnZhbGlkIGhleCBzdHJpbmcnKVxuXG4gIGlmIChsZW5ndGggPiBzdHJMZW4gLyAyKSB7XG4gICAgbGVuZ3RoID0gc3RyTGVuIC8gMlxuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgcGFyc2VkID0gcGFyc2VJbnQoc3RyaW5nLnN1YnN0cihpICogMiwgMiksIDE2KVxuICAgIGlmIChpc05hTihwYXJzZWQpKSByZXR1cm4gaVxuICAgIGJ1ZltvZmZzZXQgKyBpXSA9IHBhcnNlZFxuICB9XG4gIHJldHVybiBpXG59XG5cbmZ1bmN0aW9uIHV0ZjhXcml0ZSAoYnVmLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKSB7XG4gIHJldHVybiBibGl0QnVmZmVyKHV0ZjhUb0J5dGVzKHN0cmluZywgYnVmLmxlbmd0aCAtIG9mZnNldCksIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpXG59XG5cbmZ1bmN0aW9uIGFzY2lpV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICByZXR1cm4gYmxpdEJ1ZmZlcihhc2NpaVRvQnl0ZXMoc3RyaW5nKSwgYnVmLCBvZmZzZXQsIGxlbmd0aClcbn1cblxuZnVuY3Rpb24gbGF0aW4xV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICByZXR1cm4gYXNjaWlXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG59XG5cbmZ1bmN0aW9uIGJhc2U2NFdyaXRlIChidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxufVxuXG5mdW5jdGlvbiB1Y3MyV3JpdGUgKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkge1xuICByZXR1cm4gYmxpdEJ1ZmZlcih1dGYxNmxlVG9CeXRlcyhzdHJpbmcsIGJ1Zi5sZW5ndGggLSBvZmZzZXQpLCBidWYsIG9mZnNldCwgbGVuZ3RoKVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gd3JpdGUgKHN0cmluZywgb2Zmc2V0LCBsZW5ndGgsIGVuY29kaW5nKSB7XG4gIC8vIEJ1ZmZlciN3cml0ZShzdHJpbmcpXG4gIGlmIChvZmZzZXQgPT09IHVuZGVmaW5lZCkge1xuICAgIGVuY29kaW5nID0gJ3V0ZjgnXG4gICAgbGVuZ3RoID0gdGhpcy5sZW5ndGhcbiAgICBvZmZzZXQgPSAwXG4gIC8vIEJ1ZmZlciN3cml0ZShzdHJpbmcsIGVuY29kaW5nKVxuICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkICYmIHR5cGVvZiBvZmZzZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgZW5jb2RpbmcgPSBvZmZzZXRcbiAgICBsZW5ndGggPSB0aGlzLmxlbmd0aFxuICAgIG9mZnNldCA9IDBcbiAgLy8gQnVmZmVyI3dyaXRlKHN0cmluZywgb2Zmc2V0WywgbGVuZ3RoXVssIGVuY29kaW5nXSlcbiAgfSBlbHNlIGlmIChpc0Zpbml0ZShvZmZzZXQpKSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICAgIGlmIChpc0Zpbml0ZShsZW5ndGgpKSB7XG4gICAgICBsZW5ndGggPSBsZW5ndGggfCAwXG4gICAgICBpZiAoZW5jb2RpbmcgPT09IHVuZGVmaW5lZCkgZW5jb2RpbmcgPSAndXRmOCdcbiAgICB9IGVsc2Uge1xuICAgICAgZW5jb2RpbmcgPSBsZW5ndGhcbiAgICAgIGxlbmd0aCA9IHVuZGVmaW5lZFxuICAgIH1cbiAgLy8gbGVnYWN5IHdyaXRlKHN0cmluZywgZW5jb2RpbmcsIG9mZnNldCwgbGVuZ3RoKSAtIHJlbW92ZSBpbiB2MC4xM1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdCdWZmZXIud3JpdGUoc3RyaW5nLCBlbmNvZGluZywgb2Zmc2V0WywgbGVuZ3RoXSkgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCdcbiAgICApXG4gIH1cblxuICB2YXIgcmVtYWluaW5nID0gdGhpcy5sZW5ndGggLSBvZmZzZXRcbiAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkIHx8IGxlbmd0aCA+IHJlbWFpbmluZykgbGVuZ3RoID0gcmVtYWluaW5nXG5cbiAgaWYgKChzdHJpbmcubGVuZ3RoID4gMCAmJiAobGVuZ3RoIDwgMCB8fCBvZmZzZXQgPCAwKSkgfHwgb2Zmc2V0ID4gdGhpcy5sZW5ndGgpIHtcbiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignQXR0ZW1wdCB0byB3cml0ZSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMnKVxuICB9XG5cbiAgaWYgKCFlbmNvZGluZykgZW5jb2RpbmcgPSAndXRmOCdcblxuICB2YXIgbG93ZXJlZENhc2UgPSBmYWxzZVxuICBmb3IgKDs7KSB7XG4gICAgc3dpdGNoIChlbmNvZGluZykge1xuICAgICAgY2FzZSAnaGV4JzpcbiAgICAgICAgcmV0dXJuIGhleFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG5cbiAgICAgIGNhc2UgJ3V0ZjgnOlxuICAgICAgY2FzZSAndXRmLTgnOlxuICAgICAgICByZXR1cm4gdXRmOFdyaXRlKHRoaXMsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpXG5cbiAgICAgIGNhc2UgJ2FzY2lpJzpcbiAgICAgICAgcmV0dXJuIGFzY2lpV3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcblxuICAgICAgY2FzZSAnbGF0aW4xJzpcbiAgICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICAgIHJldHVybiBsYXRpbjFXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuXG4gICAgICBjYXNlICdiYXNlNjQnOlxuICAgICAgICAvLyBXYXJuaW5nOiBtYXhMZW5ndGggbm90IHRha2VuIGludG8gYWNjb3VudCBpbiBiYXNlNjRXcml0ZVxuICAgICAgICByZXR1cm4gYmFzZTY0V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aClcblxuICAgICAgY2FzZSAndWNzMic6XG4gICAgICBjYXNlICd1Y3MtMic6XG4gICAgICBjYXNlICd1dGYxNmxlJzpcbiAgICAgIGNhc2UgJ3V0Zi0xNmxlJzpcbiAgICAgICAgcmV0dXJuIHVjczJXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKVxuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpZiAobG93ZXJlZENhc2UpIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZW5jb2Rpbmc6ICcgKyBlbmNvZGluZylcbiAgICAgICAgZW5jb2RpbmcgPSAoJycgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKVxuICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWVcbiAgICB9XG4gIH1cbn1cblxuQnVmZmVyLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiB0b0pTT04gKCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdCdWZmZXInLFxuICAgIGRhdGE6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMuX2FyciB8fCB0aGlzLCAwKVxuICB9XG59XG5cbmZ1bmN0aW9uIGJhc2U2NFNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHtcbiAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkge1xuICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGJhc2U2NC5mcm9tQnl0ZUFycmF5KGJ1Zi5zbGljZShzdGFydCwgZW5kKSlcbiAgfVxufVxuXG5mdW5jdGlvbiB1dGY4U2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICBlbmQgPSBNYXRoLm1pbihidWYubGVuZ3RoLCBlbmQpXG4gIHZhciByZXMgPSBbXVxuXG4gIHZhciBpID0gc3RhcnRcbiAgd2hpbGUgKGkgPCBlbmQpIHtcbiAgICB2YXIgZmlyc3RCeXRlID0gYnVmW2ldXG4gICAgdmFyIGNvZGVQb2ludCA9IG51bGxcbiAgICB2YXIgYnl0ZXNQZXJTZXF1ZW5jZSA9IChmaXJzdEJ5dGUgPiAweEVGKSA/IDRcbiAgICAgIDogKGZpcnN0Qnl0ZSA+IDB4REYpID8gM1xuICAgICAgOiAoZmlyc3RCeXRlID4gMHhCRikgPyAyXG4gICAgICA6IDFcblxuICAgIGlmIChpICsgYnl0ZXNQZXJTZXF1ZW5jZSA8PSBlbmQpIHtcbiAgICAgIHZhciBzZWNvbmRCeXRlLCB0aGlyZEJ5dGUsIGZvdXJ0aEJ5dGUsIHRlbXBDb2RlUG9pbnRcblxuICAgICAgc3dpdGNoIChieXRlc1BlclNlcXVlbmNlKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBpZiAoZmlyc3RCeXRlIDwgMHg4MCkge1xuICAgICAgICAgICAgY29kZVBvaW50ID0gZmlyc3RCeXRlXG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXVxuICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwKSB7XG4gICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDB4MUYpIDw8IDB4NiB8IChzZWNvbmRCeXRlICYgMHgzRilcbiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHg3Rikge1xuICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXVxuICAgICAgICAgIHRoaXJkQnl0ZSA9IGJ1ZltpICsgMl1cbiAgICAgICAgICBpZiAoKHNlY29uZEJ5dGUgJiAweEMwKSA9PT0gMHg4MCAmJiAodGhpcmRCeXRlICYgMHhDMCkgPT09IDB4ODApIHtcbiAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMHhGKSA8PCAweEMgfCAoc2Vjb25kQnl0ZSAmIDB4M0YpIDw8IDB4NiB8ICh0aGlyZEJ5dGUgJiAweDNGKVxuICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAweDdGRiAmJiAodGVtcENvZGVQb2ludCA8IDB4RDgwMCB8fCB0ZW1wQ29kZVBvaW50ID4gMHhERkZGKSkge1xuICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrXG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kgKyAxXVxuICAgICAgICAgIHRoaXJkQnl0ZSA9IGJ1ZltpICsgMl1cbiAgICAgICAgICBmb3VydGhCeXRlID0gYnVmW2kgKyAzXVxuICAgICAgICAgIGlmICgoc2Vjb25kQnl0ZSAmIDB4QzApID09PSAweDgwICYmICh0aGlyZEJ5dGUgJiAweEMwKSA9PT0gMHg4MCAmJiAoZm91cnRoQnl0ZSAmIDB4QzApID09PSAweDgwKSB7XG4gICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDB4RikgPDwgMHgxMiB8IChzZWNvbmRCeXRlICYgMHgzRikgPDwgMHhDIHwgKHRoaXJkQnl0ZSAmIDB4M0YpIDw8IDB4NiB8IChmb3VydGhCeXRlICYgMHgzRilcbiAgICAgICAgICAgIGlmICh0ZW1wQ29kZVBvaW50ID4gMHhGRkZGICYmIHRlbXBDb2RlUG9pbnQgPCAweDExMDAwMCkge1xuICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb2RlUG9pbnQgPT09IG51bGwpIHtcbiAgICAgIC8vIHdlIGRpZCBub3QgZ2VuZXJhdGUgYSB2YWxpZCBjb2RlUG9pbnQgc28gaW5zZXJ0IGFcbiAgICAgIC8vIHJlcGxhY2VtZW50IGNoYXIgKFUrRkZGRCkgYW5kIGFkdmFuY2Ugb25seSAxIGJ5dGVcbiAgICAgIGNvZGVQb2ludCA9IDB4RkZGRFxuICAgICAgYnl0ZXNQZXJTZXF1ZW5jZSA9IDFcbiAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA+IDB4RkZGRikge1xuICAgICAgLy8gZW5jb2RlIHRvIHV0ZjE2IChzdXJyb2dhdGUgcGFpciBkYW5jZSlcbiAgICAgIGNvZGVQb2ludCAtPSAweDEwMDAwXG4gICAgICByZXMucHVzaChjb2RlUG9pbnQgPj4+IDEwICYgMHgzRkYgfCAweEQ4MDApXG4gICAgICBjb2RlUG9pbnQgPSAweERDMDAgfCBjb2RlUG9pbnQgJiAweDNGRlxuICAgIH1cblxuICAgIHJlcy5wdXNoKGNvZGVQb2ludClcbiAgICBpICs9IGJ5dGVzUGVyU2VxdWVuY2VcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVDb2RlUG9pbnRzQXJyYXkocmVzKVxufVxuXG4vLyBCYXNlZCBvbiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yMjc0NzI3Mi82ODA3NDIsIHRoZSBicm93c2VyIHdpdGhcbi8vIHRoZSBsb3dlc3QgbGltaXQgaXMgQ2hyb21lLCB3aXRoIDB4MTAwMDAgYXJncy5cbi8vIFdlIGdvIDEgbWFnbml0dWRlIGxlc3MsIGZvciBzYWZldHlcbnZhciBNQVhfQVJHVU1FTlRTX0xFTkdUSCA9IDB4MTAwMFxuXG5mdW5jdGlvbiBkZWNvZGVDb2RlUG9pbnRzQXJyYXkgKGNvZGVQb2ludHMpIHtcbiAgdmFyIGxlbiA9IGNvZGVQb2ludHMubGVuZ3RoXG4gIGlmIChsZW4gPD0gTUFYX0FSR1VNRU5UU19MRU5HVEgpIHtcbiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIGNvZGVQb2ludHMpIC8vIGF2b2lkIGV4dHJhIHNsaWNlKClcbiAgfVxuXG4gIC8vIERlY29kZSBpbiBjaHVua3MgdG8gYXZvaWQgXCJjYWxsIHN0YWNrIHNpemUgZXhjZWVkZWRcIi5cbiAgdmFyIHJlcyA9ICcnXG4gIHZhciBpID0gMFxuICB3aGlsZSAoaSA8IGxlbikge1xuICAgIHJlcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFxuICAgICAgU3RyaW5nLFxuICAgICAgY29kZVBvaW50cy5zbGljZShpLCBpICs9IE1BWF9BUkdVTUVOVFNfTEVOR1RIKVxuICAgIClcbiAgfVxuICByZXR1cm4gcmVzXG59XG5cbmZ1bmN0aW9uIGFzY2lpU2xpY2UgKGJ1Ziwgc3RhcnQsIGVuZCkge1xuICB2YXIgcmV0ID0gJydcbiAgZW5kID0gTWF0aC5taW4oYnVmLmxlbmd0aCwgZW5kKVxuXG4gIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldICYgMHg3RilcbiAgfVxuICByZXR1cm4gcmV0XG59XG5cbmZ1bmN0aW9uIGxhdGluMVNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIHJldCA9ICcnXG4gIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZClcblxuICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkge1xuICAgIHJldCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSlcbiAgfVxuICByZXR1cm4gcmV0XG59XG5cbmZ1bmN0aW9uIGhleFNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIGxlbiA9IGJ1Zi5sZW5ndGhcblxuICBpZiAoIXN0YXJ0IHx8IHN0YXJ0IDwgMCkgc3RhcnQgPSAwXG4gIGlmICghZW5kIHx8IGVuZCA8IDAgfHwgZW5kID4gbGVuKSBlbmQgPSBsZW5cblxuICB2YXIgb3V0ID0gJydcbiAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHtcbiAgICBvdXQgKz0gdG9IZXgoYnVmW2ldKVxuICB9XG4gIHJldHVybiBvdXRcbn1cblxuZnVuY3Rpb24gdXRmMTZsZVNsaWNlIChidWYsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIGJ5dGVzID0gYnVmLnNsaWNlKHN0YXJ0LCBlbmQpXG4gIHZhciByZXMgPSAnJ1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAyKSB7XG4gICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0gKyBieXRlc1tpICsgMV0gKiAyNTYpXG4gIH1cbiAgcmV0dXJuIHJlc1xufVxuXG5CdWZmZXIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gc2xpY2UgKHN0YXJ0LCBlbmQpIHtcbiAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoXG4gIHN0YXJ0ID0gfn5zdGFydFxuICBlbmQgPSBlbmQgPT09IHVuZGVmaW5lZCA/IGxlbiA6IH5+ZW5kXG5cbiAgaWYgKHN0YXJ0IDwgMCkge1xuICAgIHN0YXJ0ICs9IGxlblxuICAgIGlmIChzdGFydCA8IDApIHN0YXJ0ID0gMFxuICB9IGVsc2UgaWYgKHN0YXJ0ID4gbGVuKSB7XG4gICAgc3RhcnQgPSBsZW5cbiAgfVxuXG4gIGlmIChlbmQgPCAwKSB7XG4gICAgZW5kICs9IGxlblxuICAgIGlmIChlbmQgPCAwKSBlbmQgPSAwXG4gIH0gZWxzZSBpZiAoZW5kID4gbGVuKSB7XG4gICAgZW5kID0gbGVuXG4gIH1cblxuICBpZiAoZW5kIDwgc3RhcnQpIGVuZCA9IHN0YXJ0XG5cbiAgdmFyIG5ld0J1ZlxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICBuZXdCdWYgPSB0aGlzLnN1YmFycmF5KHN0YXJ0LCBlbmQpXG4gICAgbmV3QnVmLl9fcHJvdG9fXyA9IEJ1ZmZlci5wcm90b3R5cGVcbiAgfSBlbHNlIHtcbiAgICB2YXIgc2xpY2VMZW4gPSBlbmQgLSBzdGFydFxuICAgIG5ld0J1ZiA9IG5ldyBCdWZmZXIoc2xpY2VMZW4sIHVuZGVmaW5lZClcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWNlTGVuOyArK2kpIHtcbiAgICAgIG5ld0J1ZltpXSA9IHRoaXNbaSArIHN0YXJ0XVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBuZXdCdWZcbn1cblxuLypcbiAqIE5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgYnVmZmVyIGlzbid0IHRyeWluZyB0byB3cml0ZSBvdXQgb2YgYm91bmRzLlxuICovXG5mdW5jdGlvbiBjaGVja09mZnNldCAob2Zmc2V0LCBleHQsIGxlbmd0aCkge1xuICBpZiAoKG9mZnNldCAlIDEpICE9PSAwIHx8IG9mZnNldCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCdvZmZzZXQgaXMgbm90IHVpbnQnKVxuICBpZiAob2Zmc2V0ICsgZXh0ID4gbGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVHJ5aW5nIHRvIGFjY2VzcyBiZXlvbmQgYnVmZmVyIGxlbmd0aCcpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnRMRSA9IGZ1bmN0aW9uIHJlYWRVSW50TEUgKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoLCB0aGlzLmxlbmd0aClcblxuICB2YXIgdmFsID0gdGhpc1tvZmZzZXRdXG4gIHZhciBtdWwgPSAxXG4gIHZhciBpID0gMFxuICB3aGlsZSAoKytpIDwgYnl0ZUxlbmd0aCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIHZhbCArPSB0aGlzW29mZnNldCArIGldICogbXVsXG4gIH1cblxuICByZXR1cm4gdmFsXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnRCRSA9IGZ1bmN0aW9uIHJlYWRVSW50QkUgKG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpXG4gIH1cblxuICB2YXIgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGhdXG4gIHZhciBtdWwgPSAxXG4gIHdoaWxlIChieXRlTGVuZ3RoID4gMCAmJiAobXVsICo9IDB4MTAwKSkge1xuICAgIHZhbCArPSB0aGlzW29mZnNldCArIC0tYnl0ZUxlbmd0aF0gKiBtdWxcbiAgfVxuXG4gIHJldHVybiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiByZWFkVUludDggKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAxLCB0aGlzLmxlbmd0aClcbiAgcmV0dXJuIHRoaXNbb2Zmc2V0XVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MTZMRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZMRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkVUludDE2QkUgPSBmdW5jdGlvbiByZWFkVUludDE2QkUgKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aClcbiAgcmV0dXJuICh0aGlzW29mZnNldF0gPDwgOCkgfCB0aGlzW29mZnNldCArIDFdXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZFVJbnQzMkxFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkxFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpXG5cbiAgcmV0dXJuICgodGhpc1tvZmZzZXRdKSB8XG4gICAgICAodGhpc1tvZmZzZXQgKyAxXSA8PCA4KSB8XG4gICAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCAxNikpICtcbiAgICAgICh0aGlzW29mZnNldCArIDNdICogMHgxMDAwMDAwKVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRVSW50MzJCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MzJCRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKVxuXG4gIHJldHVybiAodGhpc1tvZmZzZXRdICogMHgxMDAwMDAwKSArXG4gICAgKCh0aGlzW29mZnNldCArIDFdIDw8IDE2KSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgMl0gPDwgOCkgfFxuICAgIHRoaXNbb2Zmc2V0ICsgM10pXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludExFID0gZnVuY3Rpb24gcmVhZEludExFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpXG5cbiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0XVxuICB2YXIgbXVsID0gMVxuICB2YXIgaSA9IDBcbiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpXSAqIG11bFxuICB9XG4gIG11bCAqPSAweDgwXG5cbiAgaWYgKHZhbCA+PSBtdWwpIHZhbCAtPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aClcblxuICByZXR1cm4gdmFsXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludEJFID0gZnVuY3Rpb24gcmVhZEludEJFIChvZmZzZXQsIGJ5dGVMZW5ndGgsIG5vQXNzZXJ0KSB7XG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aCwgdGhpcy5sZW5ndGgpXG5cbiAgdmFyIGkgPSBieXRlTGVuZ3RoXG4gIHZhciBtdWwgPSAxXG4gIHZhciB2YWwgPSB0aGlzW29mZnNldCArIC0taV1cbiAgd2hpbGUgKGkgPiAwICYmIChtdWwgKj0gMHgxMDApKSB7XG4gICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1pXSAqIG11bFxuICB9XG4gIG11bCAqPSAweDgwXG5cbiAgaWYgKHZhbCA+PSBtdWwpIHZhbCAtPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aClcblxuICByZXR1cm4gdmFsXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiByZWFkSW50OCAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKVxuICBpZiAoISh0aGlzW29mZnNldF0gJiAweDgwKSkgcmV0dXJuICh0aGlzW29mZnNldF0pXG4gIHJldHVybiAoKDB4ZmYgLSB0aGlzW29mZnNldF0gKyAxKSAqIC0xKVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWRJbnQxNkxFID0gZnVuY3Rpb24gcmVhZEludDE2TEUgKG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aClcbiAgdmFyIHZhbCA9IHRoaXNbb2Zmc2V0XSB8ICh0aGlzW29mZnNldCArIDFdIDw8IDgpXG4gIHJldHVybiAodmFsICYgMHg4MDAwKSA/IHZhbCB8IDB4RkZGRjAwMDAgOiB2YWxcbn1cblxuQnVmZmVyLnByb3RvdHlwZS5yZWFkSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRJbnQxNkJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpXG4gIHZhciB2YWwgPSB0aGlzW29mZnNldCArIDFdIHwgKHRoaXNbb2Zmc2V0XSA8PCA4KVxuICByZXR1cm4gKHZhbCAmIDB4ODAwMCkgPyB2YWwgfCAweEZGRkYwMDAwIDogdmFsXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyTEUgPSBmdW5jdGlvbiByZWFkSW50MzJMRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKVxuXG4gIHJldHVybiAodGhpc1tvZmZzZXRdKSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgOCkgfFxuICAgICh0aGlzW29mZnNldCArIDJdIDw8IDE2KSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgM10gPDwgMjQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEludDMyQkUgPSBmdW5jdGlvbiByZWFkSW50MzJCRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKVxuXG4gIHJldHVybiAodGhpc1tvZmZzZXRdIDw8IDI0KSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYpIHxcbiAgICAodGhpc1tvZmZzZXQgKyAyXSA8PCA4KSB8XG4gICAgKHRoaXNbb2Zmc2V0ICsgM10pXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiByZWFkRmxvYXRMRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgMjMsIDQpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZEZsb2F0QkUgPSBmdW5jdGlvbiByZWFkRmxvYXRCRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgZmFsc2UsIDIzLCA0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLnJlYWREb3VibGVMRSA9IGZ1bmN0aW9uIHJlYWREb3VibGVMRSAob2Zmc2V0LCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSBjaGVja09mZnNldChvZmZzZXQsIDgsIHRoaXMubGVuZ3RoKVxuICByZXR1cm4gaWVlZTc1NC5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgNTIsIDgpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUucmVhZERvdWJsZUJFID0gZnVuY3Rpb24gcmVhZERvdWJsZUJFIChvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrT2Zmc2V0KG9mZnNldCwgOCwgdGhpcy5sZW5ndGgpXG4gIHJldHVybiBpZWVlNzU0LnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgNTIsIDgpXG59XG5cbmZ1bmN0aW9uIGNoZWNrSW50IChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHtcbiAgaWYgKCFCdWZmZXIuaXNCdWZmZXIoYnVmKSkgdGhyb3cgbmV3IFR5cGVFcnJvcignXCJidWZmZXJcIiBhcmd1bWVudCBtdXN0IGJlIGEgQnVmZmVyIGluc3RhbmNlJylcbiAgaWYgKHZhbHVlID4gbWF4IHx8IHZhbHVlIDwgbWluKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcignXCJ2YWx1ZVwiIGFyZ3VtZW50IGlzIG91dCBvZiBib3VuZHMnKVxuICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50TEUgPSBmdW5jdGlvbiB3cml0ZVVJbnRMRSAodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIHZhciBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKSAtIDFcbiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMClcbiAgfVxuXG4gIHZhciBtdWwgPSAxXG4gIHZhciBpID0gMFxuICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDB4RkZcbiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsKSAmIDB4RkZcbiAgfVxuXG4gIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnRCRSAodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aCB8IDBcbiAgaWYgKCFub0Fzc2VydCkge1xuICAgIHZhciBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoKSAtIDFcbiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBtYXhCeXRlcywgMClcbiAgfVxuXG4gIHZhciBpID0gYnl0ZUxlbmd0aCAtIDFcbiAgdmFyIG11bCA9IDFcbiAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMHhGRlxuICB3aGlsZSAoLS1pID49IDAgJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICB0aGlzW29mZnNldCArIGldID0gKHZhbHVlIC8gbXVsKSAmIDB4RkZcbiAgfVxuXG4gIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoXG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVVSW50OCA9IGZ1bmN0aW9uIHdyaXRlVUludDggKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMSwgMHhmZiwgMClcbiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlKVxuICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKVxuICByZXR1cm4gb2Zmc2V0ICsgMVxufVxuXG5mdW5jdGlvbiBvYmplY3RXcml0ZVVJbnQxNiAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHtcbiAgaWYgKHZhbHVlIDwgMCkgdmFsdWUgPSAweGZmZmYgKyB2YWx1ZSArIDFcbiAgZm9yICh2YXIgaSA9IDAsIGogPSBNYXRoLm1pbihidWYubGVuZ3RoIC0gb2Zmc2V0LCAyKTsgaSA8IGo7ICsraSkge1xuICAgIGJ1ZltvZmZzZXQgKyBpXSA9ICh2YWx1ZSAmICgweGZmIDw8ICg4ICogKGxpdHRsZUVuZGlhbiA/IGkgOiAxIC0gaSkpKSkgPj4+XG4gICAgICAobGl0dGxlRW5kaWFuID8gaSA6IDEgLSBpKSAqIDhcbiAgfVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludDE2TEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQxNkxFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDB4ZmZmZiwgMClcbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZilcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KVxuICB9IGVsc2Uge1xuICAgIG9iamVjdFdyaXRlVUludDE2KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpXG4gIH1cbiAgcmV0dXJuIG9mZnNldCArIDJcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweGZmZmYsIDApXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOClcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlICYgMHhmZilcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgMlxufVxuXG5mdW5jdGlvbiBvYmplY3RXcml0ZVVJbnQzMiAoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHtcbiAgaWYgKHZhbHVlIDwgMCkgdmFsdWUgPSAweGZmZmZmZmZmICsgdmFsdWUgKyAxXG4gIGZvciAodmFyIGkgPSAwLCBqID0gTWF0aC5taW4oYnVmLmxlbmd0aCAtIG9mZnNldCwgNCk7IGkgPCBqOyArK2kpIHtcbiAgICBidWZbb2Zmc2V0ICsgaV0gPSAodmFsdWUgPj4+IChsaXR0bGVFbmRpYW4gPyBpIDogMyAtIGkpICogOCkgJiAweGZmXG4gIH1cbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZVVJbnQzMkxFID0gZnVuY3Rpb24gd3JpdGVVSW50MzJMRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAweGZmZmZmZmZmLCAwKVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlID4+PiAyNClcbiAgICB0aGlzW29mZnNldCArIDJdID0gKHZhbHVlID4+PiAxNilcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KVxuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSAmIDB4ZmYpXG4gIH0gZWxzZSB7XG4gICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgNFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlVUludDMyQkUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDB4ZmZmZmZmZmYsIDApXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gMjQpXG4gICAgdGhpc1tvZmZzZXQgKyAxXSA9ICh2YWx1ZSA+Pj4gMTYpXG4gICAgdGhpc1tvZmZzZXQgKyAyXSA9ICh2YWx1ZSA+Pj4gOClcbiAgICB0aGlzW29mZnNldCArIDNdID0gKHZhbHVlICYgMHhmZilcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQzMih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgNFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50TEUgPSBmdW5jdGlvbiB3cml0ZUludExFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICB2YXIgbGltaXQgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCAtIDEpXG5cbiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBsaW1pdCAtIDEsIC1saW1pdClcbiAgfVxuXG4gIHZhciBpID0gMFxuICB2YXIgbXVsID0gMVxuICB2YXIgc3ViID0gMFxuICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDB4RkZcbiAgd2hpbGUgKCsraSA8IGJ5dGVMZW5ndGggJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgLSAxXSAhPT0gMCkge1xuICAgICAgc3ViID0gMVxuICAgIH1cbiAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGXG4gIH1cblxuICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50QkUgPSBmdW5jdGlvbiB3cml0ZUludEJFICh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBub0Fzc2VydCkge1xuICB2YWx1ZSA9ICt2YWx1ZVxuICBvZmZzZXQgPSBvZmZzZXQgfCAwXG4gIGlmICghbm9Bc3NlcnQpIHtcbiAgICB2YXIgbGltaXQgPSBNYXRoLnBvdygyLCA4ICogYnl0ZUxlbmd0aCAtIDEpXG5cbiAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoLCBsaW1pdCAtIDEsIC1saW1pdClcbiAgfVxuXG4gIHZhciBpID0gYnl0ZUxlbmd0aCAtIDFcbiAgdmFyIG11bCA9IDFcbiAgdmFyIHN1YiA9IDBcbiAgdGhpc1tvZmZzZXQgKyBpXSA9IHZhbHVlICYgMHhGRlxuICB3aGlsZSAoLS1pID49IDAgJiYgKG11bCAqPSAweDEwMCkpIHtcbiAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkgKyAxXSAhPT0gMCkge1xuICAgICAgc3ViID0gMVxuICAgIH1cbiAgICB0aGlzW29mZnNldCArIGldID0gKCh2YWx1ZSAvIG11bCkgPj4gMCkgLSBzdWIgJiAweEZGXG4gIH1cblxuICByZXR1cm4gb2Zmc2V0ICsgYnl0ZUxlbmd0aFxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50OCA9IGZ1bmN0aW9uIHdyaXRlSW50OCAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAxLCAweDdmLCAtMHg4MClcbiAgaWYgKCFCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlKVxuICBpZiAodmFsdWUgPCAwKSB2YWx1ZSA9IDB4ZmYgKyB2YWx1ZSArIDFcbiAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZilcbiAgcmV0dXJuIG9mZnNldCArIDFcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDE2TEUgPSBmdW5jdGlvbiB3cml0ZUludDE2TEUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMHg3ZmZmLCAtMHg4MDAwKVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgJiAweGZmKVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDgpXG4gIH0gZWxzZSB7XG4gICAgb2JqZWN0V3JpdGVVSW50MTYodGhpcywgdmFsdWUsIG9mZnNldCwgdHJ1ZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgMlxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MTZCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MTZCRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCAweDdmZmYsIC0weDgwMDApXG4gIGlmIChCdWZmZXIuVFlQRURfQVJSQVlfU1VQUE9SVCkge1xuICAgIHRoaXNbb2Zmc2V0XSA9ICh2YWx1ZSA+Pj4gOClcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlICYgMHhmZilcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RXcml0ZVVJbnQxNih0aGlzLCB2YWx1ZSwgb2Zmc2V0LCBmYWxzZSlcbiAgfVxuICByZXR1cm4gb2Zmc2V0ICsgMlxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlSW50MzJMRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJMRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgdmFsdWUgPSArdmFsdWVcbiAgb2Zmc2V0ID0gb2Zmc2V0IHwgMFxuICBpZiAoIW5vQXNzZXJ0KSBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAweDdmZmZmZmZmLCAtMHg4MDAwMDAwMClcbiAgaWYgKEJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgdGhpc1tvZmZzZXRdID0gKHZhbHVlICYgMHhmZilcbiAgICB0aGlzW29mZnNldCArIDFdID0gKHZhbHVlID4+PiA4KVxuICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDE2KVxuICAgIHRoaXNbb2Zmc2V0ICsgM10gPSAodmFsdWUgPj4+IDI0KVxuICB9IGVsc2Uge1xuICAgIG9iamVjdFdyaXRlVUludDMyKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUpXG4gIH1cbiAgcmV0dXJuIG9mZnNldCArIDRcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUludDMyQkUgPSBmdW5jdGlvbiB3cml0ZUludDMyQkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHZhbHVlID0gK3ZhbHVlXG4gIG9mZnNldCA9IG9mZnNldCB8IDBcbiAgaWYgKCFub0Fzc2VydCkgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgMHg3ZmZmZmZmZiwgLTB4ODAwMDAwMDApXG4gIGlmICh2YWx1ZSA8IDApIHZhbHVlID0gMHhmZmZmZmZmZiArIHZhbHVlICsgMVxuICBpZiAoQnVmZmVyLlRZUEVEX0FSUkFZX1NVUFBPUlQpIHtcbiAgICB0aGlzW29mZnNldF0gPSAodmFsdWUgPj4+IDI0KVxuICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSAodmFsdWUgPj4+IDE2KVxuICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSAodmFsdWUgPj4+IDgpXG4gICAgdGhpc1tvZmZzZXQgKyAzXSA9ICh2YWx1ZSAmIDB4ZmYpXG4gIH0gZWxzZSB7XG4gICAgb2JqZWN0V3JpdGVVSW50MzIodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UpXG4gIH1cbiAgcmV0dXJuIG9mZnNldCArIDRcbn1cblxuZnVuY3Rpb24gY2hlY2tJRUVFNzU0IChidWYsIHZhbHVlLCBvZmZzZXQsIGV4dCwgbWF4LCBtaW4pIHtcbiAgaWYgKG9mZnNldCArIGV4dCA+IGJ1Zi5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCdJbmRleCBvdXQgb2YgcmFuZ2UnKVxuICBpZiAob2Zmc2V0IDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ0luZGV4IG91dCBvZiByYW5nZScpXG59XG5cbmZ1bmN0aW9uIHdyaXRlRmxvYXQgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgNCwgMy40MDI4MjM0NjYzODUyODg2ZSszOCwgLTMuNDAyODIzNDY2Mzg1Mjg4NmUrMzgpXG4gIH1cbiAgaWVlZTc1NC53cml0ZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgMjMsIDQpXG4gIHJldHVybiBvZmZzZXQgKyA0XG59XG5cbkJ1ZmZlci5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gd3JpdGVGbG9hdExFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICByZXR1cm4gd3JpdGVGbG9hdCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydClcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZUZsb2F0QkUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0QkUgKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7XG4gIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydClcbn1cblxuZnVuY3Rpb24gd3JpdGVEb3VibGUgKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkge1xuICBpZiAoIW5vQXNzZXJ0KSB7XG4gICAgY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgOCwgMS43OTc2OTMxMzQ4NjIzMTU3RSszMDgsIC0xLjc5NzY5MzEzNDg2MjMxNTdFKzMwOClcbiAgfVxuICBpZWVlNzU0LndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCA1MiwgOClcbiAgcmV0dXJuIG9mZnNldCArIDhcbn1cblxuQnVmZmVyLnByb3RvdHlwZS53cml0ZURvdWJsZUxFID0gZnVuY3Rpb24gd3JpdGVEb3VibGVMRSAodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHtcbiAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KVxufVxuXG5CdWZmZXIucHJvdG90eXBlLndyaXRlRG91YmxlQkUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUJFICh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkge1xuICByZXR1cm4gd3JpdGVEb3VibGUodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KVxufVxuXG4vLyBjb3B5KHRhcmdldEJ1ZmZlciwgdGFyZ2V0U3RhcnQ9MCwgc291cmNlU3RhcnQ9MCwgc291cmNlRW5kPWJ1ZmZlci5sZW5ndGgpXG5CdWZmZXIucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiBjb3B5ICh0YXJnZXQsIHRhcmdldFN0YXJ0LCBzdGFydCwgZW5kKSB7XG4gIGlmICghc3RhcnQpIHN0YXJ0ID0gMFxuICBpZiAoIWVuZCAmJiBlbmQgIT09IDApIGVuZCA9IHRoaXMubGVuZ3RoXG4gIGlmICh0YXJnZXRTdGFydCA+PSB0YXJnZXQubGVuZ3RoKSB0YXJnZXRTdGFydCA9IHRhcmdldC5sZW5ndGhcbiAgaWYgKCF0YXJnZXRTdGFydCkgdGFyZ2V0U3RhcnQgPSAwXG4gIGlmIChlbmQgPiAwICYmIGVuZCA8IHN0YXJ0KSBlbmQgPSBzdGFydFxuXG4gIC8vIENvcHkgMCBieXRlczsgd2UncmUgZG9uZVxuICBpZiAoZW5kID09PSBzdGFydCkgcmV0dXJuIDBcbiAgaWYgKHRhcmdldC5sZW5ndGggPT09IDAgfHwgdGhpcy5sZW5ndGggPT09IDApIHJldHVybiAwXG5cbiAgLy8gRmF0YWwgZXJyb3IgY29uZGl0aW9uc1xuICBpZiAodGFyZ2V0U3RhcnQgPCAwKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ3RhcmdldFN0YXJ0IG91dCBvZiBib3VuZHMnKVxuICB9XG4gIGlmIChzdGFydCA8IDAgfHwgc3RhcnQgPj0gdGhpcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCdzb3VyY2VTdGFydCBvdXQgb2YgYm91bmRzJylcbiAgaWYgKGVuZCA8IDApIHRocm93IG5ldyBSYW5nZUVycm9yKCdzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcycpXG5cbiAgLy8gQXJlIHdlIG9vYj9cbiAgaWYgKGVuZCA+IHRoaXMubGVuZ3RoKSBlbmQgPSB0aGlzLmxlbmd0aFxuICBpZiAodGFyZ2V0Lmxlbmd0aCAtIHRhcmdldFN0YXJ0IDwgZW5kIC0gc3RhcnQpIHtcbiAgICBlbmQgPSB0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgKyBzdGFydFxuICB9XG5cbiAgdmFyIGxlbiA9IGVuZCAtIHN0YXJ0XG4gIHZhciBpXG5cbiAgaWYgKHRoaXMgPT09IHRhcmdldCAmJiBzdGFydCA8IHRhcmdldFN0YXJ0ICYmIHRhcmdldFN0YXJ0IDwgZW5kKSB7XG4gICAgLy8gZGVzY2VuZGluZyBjb3B5IGZyb20gZW5kXG4gICAgZm9yIChpID0gbGVuIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgIHRhcmdldFtpICsgdGFyZ2V0U3RhcnRdID0gdGhpc1tpICsgc3RhcnRdXG4gICAgfVxuICB9IGVsc2UgaWYgKGxlbiA8IDEwMDAgfHwgIUJ1ZmZlci5UWVBFRF9BUlJBWV9TVVBQT1JUKSB7XG4gICAgLy8gYXNjZW5kaW5nIGNvcHkgZnJvbSBzdGFydFxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkge1xuICAgICAgdGFyZ2V0W2kgKyB0YXJnZXRTdGFydF0gPSB0aGlzW2kgKyBzdGFydF1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwoXG4gICAgICB0YXJnZXQsXG4gICAgICB0aGlzLnN1YmFycmF5KHN0YXJ0LCBzdGFydCArIGxlbiksXG4gICAgICB0YXJnZXRTdGFydFxuICAgIClcbiAgfVxuXG4gIHJldHVybiBsZW5cbn1cblxuLy8gVXNhZ2U6XG4vLyAgICBidWZmZXIuZmlsbChudW1iZXJbLCBvZmZzZXRbLCBlbmRdXSlcbi8vICAgIGJ1ZmZlci5maWxsKGJ1ZmZlclssIG9mZnNldFssIGVuZF1dKVxuLy8gICAgYnVmZmVyLmZpbGwoc3RyaW5nWywgb2Zmc2V0WywgZW5kXV1bLCBlbmNvZGluZ10pXG5CdWZmZXIucHJvdG90eXBlLmZpbGwgPSBmdW5jdGlvbiBmaWxsICh2YWwsIHN0YXJ0LCBlbmQsIGVuY29kaW5nKSB7XG4gIC8vIEhhbmRsZSBzdHJpbmcgY2FzZXM6XG4gIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJykge1xuICAgIGlmICh0eXBlb2Ygc3RhcnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICBlbmNvZGluZyA9IHN0YXJ0XG4gICAgICBzdGFydCA9IDBcbiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZW5kID09PSAnc3RyaW5nJykge1xuICAgICAgZW5jb2RpbmcgPSBlbmRcbiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoXG4gICAgfVxuICAgIGlmICh2YWwubGVuZ3RoID09PSAxKSB7XG4gICAgICB2YXIgY29kZSA9IHZhbC5jaGFyQ29kZUF0KDApXG4gICAgICBpZiAoY29kZSA8IDI1Nikge1xuICAgICAgICB2YWwgPSBjb2RlXG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlbmNvZGluZyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBlbmNvZGluZyAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2VuY29kaW5nIG11c3QgYmUgYSBzdHJpbmcnKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIGVuY29kaW5nID09PSAnc3RyaW5nJyAmJiAhQnVmZmVyLmlzRW5jb2RpbmcoZW5jb2RpbmcpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGVuY29kaW5nOiAnICsgZW5jb2RpbmcpXG4gICAgfVxuICB9IGVsc2UgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7XG4gICAgdmFsID0gdmFsICYgMjU1XG4gIH1cblxuICAvLyBJbnZhbGlkIHJhbmdlcyBhcmUgbm90IHNldCB0byBhIGRlZmF1bHQsIHNvIGNhbiByYW5nZSBjaGVjayBlYXJseS5cbiAgaWYgKHN0YXJ0IDwgMCB8fCB0aGlzLmxlbmd0aCA8IHN0YXJ0IHx8IHRoaXMubGVuZ3RoIDwgZW5kKSB7XG4gICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ091dCBvZiByYW5nZSBpbmRleCcpXG4gIH1cblxuICBpZiAoZW5kIDw9IHN0YXJ0KSB7XG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHN0YXJ0ID0gc3RhcnQgPj4+IDBcbiAgZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyB0aGlzLmxlbmd0aCA6IGVuZCA+Pj4gMFxuXG4gIGlmICghdmFsKSB2YWwgPSAwXG5cbiAgdmFyIGlcbiAgaWYgKHR5cGVvZiB2YWwgPT09ICdudW1iZXInKSB7XG4gICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkge1xuICAgICAgdGhpc1tpXSA9IHZhbFxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgYnl0ZXMgPSBCdWZmZXIuaXNCdWZmZXIodmFsKVxuICAgICAgPyB2YWxcbiAgICAgIDogdXRmOFRvQnl0ZXMobmV3IEJ1ZmZlcih2YWwsIGVuY29kaW5nKS50b1N0cmluZygpKVxuICAgIHZhciBsZW4gPSBieXRlcy5sZW5ndGhcbiAgICBmb3IgKGkgPSAwOyBpIDwgZW5kIC0gc3RhcnQ7ICsraSkge1xuICAgICAgdGhpc1tpICsgc3RhcnRdID0gYnl0ZXNbaSAlIGxlbl1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGhpc1xufVxuXG4vLyBIRUxQRVIgRlVOQ1RJT05TXG4vLyA9PT09PT09PT09PT09PT09XG5cbnZhciBJTlZBTElEX0JBU0U2NF9SRSA9IC9bXitcXC8wLTlBLVphLXotX10vZ1xuXG5mdW5jdGlvbiBiYXNlNjRjbGVhbiAoc3RyKSB7XG4gIC8vIE5vZGUgc3RyaXBzIG91dCBpbnZhbGlkIGNoYXJhY3RlcnMgbGlrZSBcXG4gYW5kIFxcdCBmcm9tIHRoZSBzdHJpbmcsIGJhc2U2NC1qcyBkb2VzIG5vdFxuICBzdHIgPSBzdHJpbmd0cmltKHN0cikucmVwbGFjZShJTlZBTElEX0JBU0U2NF9SRSwgJycpXG4gIC8vIE5vZGUgY29udmVydHMgc3RyaW5ncyB3aXRoIGxlbmd0aCA8IDIgdG8gJydcbiAgaWYgKHN0ci5sZW5ndGggPCAyKSByZXR1cm4gJydcbiAgLy8gTm9kZSBhbGxvd3MgZm9yIG5vbi1wYWRkZWQgYmFzZTY0IHN0cmluZ3MgKG1pc3NpbmcgdHJhaWxpbmcgPT09KSwgYmFzZTY0LWpzIGRvZXMgbm90XG4gIHdoaWxlIChzdHIubGVuZ3RoICUgNCAhPT0gMCkge1xuICAgIHN0ciA9IHN0ciArICc9J1xuICB9XG4gIHJldHVybiBzdHJcbn1cblxuZnVuY3Rpb24gc3RyaW5ndHJpbSAoc3RyKSB7XG4gIGlmIChzdHIudHJpbSkgcmV0dXJuIHN0ci50cmltKClcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJylcbn1cblxuZnVuY3Rpb24gdG9IZXggKG4pIHtcbiAgaWYgKG4gPCAxNikgcmV0dXJuICcwJyArIG4udG9TdHJpbmcoMTYpXG4gIHJldHVybiBuLnRvU3RyaW5nKDE2KVxufVxuXG5mdW5jdGlvbiB1dGY4VG9CeXRlcyAoc3RyaW5nLCB1bml0cykge1xuICB1bml0cyA9IHVuaXRzIHx8IEluZmluaXR5XG4gIHZhciBjb2RlUG9pbnRcbiAgdmFyIGxlbmd0aCA9IHN0cmluZy5sZW5ndGhcbiAgdmFyIGxlYWRTdXJyb2dhdGUgPSBudWxsXG4gIHZhciBieXRlcyA9IFtdXG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIGNvZGVQb2ludCA9IHN0cmluZy5jaGFyQ29kZUF0KGkpXG5cbiAgICAvLyBpcyBzdXJyb2dhdGUgY29tcG9uZW50XG4gICAgaWYgKGNvZGVQb2ludCA+IDB4RDdGRiAmJiBjb2RlUG9pbnQgPCAweEUwMDApIHtcbiAgICAgIC8vIGxhc3QgY2hhciB3YXMgYSBsZWFkXG4gICAgICBpZiAoIWxlYWRTdXJyb2dhdGUpIHtcbiAgICAgICAgLy8gbm8gbGVhZCB5ZXRcbiAgICAgICAgaWYgKGNvZGVQb2ludCA+IDB4REJGRikge1xuICAgICAgICAgIC8vIHVuZXhwZWN0ZWQgdHJhaWxcbiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpIGJ5dGVzLnB1c2goMHhFRiwgMHhCRiwgMHhCRClcbiAgICAgICAgICBjb250aW51ZVxuICAgICAgICB9IGVsc2UgaWYgKGkgKyAxID09PSBsZW5ndGgpIHtcbiAgICAgICAgICAvLyB1bnBhaXJlZCBsZWFkXG4gICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHZhbGlkIGxlYWRcbiAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludFxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIC8vIDIgbGVhZHMgaW4gYSByb3dcbiAgICAgIGlmIChjb2RlUG9pbnQgPCAweERDMDApIHtcbiAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKSBieXRlcy5wdXNoKDB4RUYsIDB4QkYsIDB4QkQpXG4gICAgICAgIGxlYWRTdXJyb2dhdGUgPSBjb2RlUG9pbnRcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgLy8gdmFsaWQgc3Vycm9nYXRlIHBhaXJcbiAgICAgIGNvZGVQb2ludCA9IChsZWFkU3Vycm9nYXRlIC0gMHhEODAwIDw8IDEwIHwgY29kZVBvaW50IC0gMHhEQzAwKSArIDB4MTAwMDBcbiAgICB9IGVsc2UgaWYgKGxlYWRTdXJyb2dhdGUpIHtcbiAgICAgIC8vIHZhbGlkIGJtcCBjaGFyLCBidXQgbGFzdCBjaGFyIHdhcyBhIGxlYWRcbiAgICAgIGlmICgodW5pdHMgLT0gMykgPiAtMSkgYnl0ZXMucHVzaCgweEVGLCAweEJGLCAweEJEKVxuICAgIH1cblxuICAgIGxlYWRTdXJyb2dhdGUgPSBudWxsXG5cbiAgICAvLyBlbmNvZGUgdXRmOFxuICAgIGlmIChjb2RlUG9pbnQgPCAweDgwKSB7XG4gICAgICBpZiAoKHVuaXRzIC09IDEpIDwgMCkgYnJlYWtcbiAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KVxuICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMHg4MDApIHtcbiAgICAgIGlmICgodW5pdHMgLT0gMikgPCAwKSBicmVha1xuICAgICAgYnl0ZXMucHVzaChcbiAgICAgICAgY29kZVBvaW50ID4+IDB4NiB8IDB4QzAsXG4gICAgICAgIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwXG4gICAgICApXG4gICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDEwMDAwKSB7XG4gICAgICBpZiAoKHVuaXRzIC09IDMpIDwgMCkgYnJlYWtcbiAgICAgIGJ5dGVzLnB1c2goXG4gICAgICAgIGNvZGVQb2ludCA+PiAweEMgfCAweEUwLFxuICAgICAgICBjb2RlUG9pbnQgPj4gMHg2ICYgMHgzRiB8IDB4ODAsXG4gICAgICAgIGNvZGVQb2ludCAmIDB4M0YgfCAweDgwXG4gICAgICApXG4gICAgfSBlbHNlIGlmIChjb2RlUG9pbnQgPCAweDExMDAwMCkge1xuICAgICAgaWYgKCh1bml0cyAtPSA0KSA8IDApIGJyZWFrXG4gICAgICBieXRlcy5wdXNoKFxuICAgICAgICBjb2RlUG9pbnQgPj4gMHgxMiB8IDB4RjAsXG4gICAgICAgIGNvZGVQb2ludCA+PiAweEMgJiAweDNGIHwgMHg4MCxcbiAgICAgICAgY29kZVBvaW50ID4+IDB4NiAmIDB4M0YgfCAweDgwLFxuICAgICAgICBjb2RlUG9pbnQgJiAweDNGIHwgMHg4MFxuICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY29kZSBwb2ludCcpXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJ5dGVzXG59XG5cbmZ1bmN0aW9uIGFzY2lpVG9CeXRlcyAoc3RyKSB7XG4gIHZhciBieXRlQXJyYXkgPSBbXVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7ICsraSkge1xuICAgIC8vIE5vZGUncyBjb2RlIHNlZW1zIHRvIGJlIGRvaW5nIHRoaXMgYW5kIG5vdCAmIDB4N0YuLlxuICAgIGJ5dGVBcnJheS5wdXNoKHN0ci5jaGFyQ29kZUF0KGkpICYgMHhGRilcbiAgfVxuICByZXR1cm4gYnl0ZUFycmF5XG59XG5cbmZ1bmN0aW9uIHV0ZjE2bGVUb0J5dGVzIChzdHIsIHVuaXRzKSB7XG4gIHZhciBjLCBoaSwgbG9cbiAgdmFyIGJ5dGVBcnJheSA9IFtdXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKCh1bml0cyAtPSAyKSA8IDApIGJyZWFrXG5cbiAgICBjID0gc3RyLmNoYXJDb2RlQXQoaSlcbiAgICBoaSA9IGMgPj4gOFxuICAgIGxvID0gYyAlIDI1NlxuICAgIGJ5dGVBcnJheS5wdXNoKGxvKVxuICAgIGJ5dGVBcnJheS5wdXNoKGhpKVxuICB9XG5cbiAgcmV0dXJuIGJ5dGVBcnJheVxufVxuXG5mdW5jdGlvbiBiYXNlNjRUb0J5dGVzIChzdHIpIHtcbiAgcmV0dXJuIGJhc2U2NC50b0J5dGVBcnJheShiYXNlNjRjbGVhbihzdHIpKVxufVxuXG5mdW5jdGlvbiBibGl0QnVmZmVyIChzcmMsIGRzdCwgb2Zmc2V0LCBsZW5ndGgpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIGlmICgoaSArIG9mZnNldCA+PSBkc3QubGVuZ3RoKSB8fCAoaSA+PSBzcmMubGVuZ3RoKSkgYnJlYWtcbiAgICBkc3RbaSArIG9mZnNldF0gPSBzcmNbaV1cbiAgfVxuICByZXR1cm4gaVxufVxuXG5mdW5jdGlvbiBpc25hbiAodmFsKSB7XG4gIHJldHVybiB2YWwgIT09IHZhbCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtY29tcGFyZVxufVxuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzICovIDE0KSkpXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9idWZmZXIvaW5kZXguanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCJcblxuZXhwb3J0cy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aFxuZXhwb3J0cy50b0J5dGVBcnJheSA9IHRvQnl0ZUFycmF5XG5leHBvcnRzLmZyb21CeXRlQXJyYXkgPSBmcm9tQnl0ZUFycmF5XG5cbnZhciBsb29rdXAgPSBbXVxudmFyIHJldkxvb2t1cCA9IFtdXG52YXIgQXJyID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09ICd1bmRlZmluZWQnID8gVWludDhBcnJheSA6IEFycmF5XG5cbnZhciBjb2RlID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nXG5mb3IgKHZhciBpID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICBsb29rdXBbaV0gPSBjb2RlW2ldXG4gIHJldkxvb2t1cFtjb2RlLmNoYXJDb2RlQXQoaSldID0gaVxufVxuXG4vLyBTdXBwb3J0IGRlY29kaW5nIFVSTC1zYWZlIGJhc2U2NCBzdHJpbmdzLCBhcyBOb2RlLmpzIGRvZXMuXG4vLyBTZWU6IGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Jhc2U2NCNVUkxfYXBwbGljYXRpb25zXG5yZXZMb29rdXBbJy0nLmNoYXJDb2RlQXQoMCldID0gNjJcbnJldkxvb2t1cFsnXycuY2hhckNvZGVBdCgwKV0gPSA2M1xuXG5mdW5jdGlvbiBnZXRMZW5zIChiNjQpIHtcbiAgdmFyIGxlbiA9IGI2NC5sZW5ndGhcblxuICBpZiAobGVuICUgNCA+IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQnKVxuICB9XG5cbiAgLy8gVHJpbSBvZmYgZXh0cmEgYnl0ZXMgYWZ0ZXIgcGxhY2Vob2xkZXIgYnl0ZXMgYXJlIGZvdW5kXG4gIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2JlYXRnYW1taXQvYmFzZTY0LWpzL2lzc3Vlcy80MlxuICB2YXIgdmFsaWRMZW4gPSBiNjQuaW5kZXhPZignPScpXG4gIGlmICh2YWxpZExlbiA9PT0gLTEpIHZhbGlkTGVuID0gbGVuXG5cbiAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IHZhbGlkTGVuID09PSBsZW5cbiAgICA/IDBcbiAgICA6IDQgLSAodmFsaWRMZW4gJSA0KVxuXG4gIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl1cbn1cblxuLy8gYmFzZTY0IGlzIDQvMyArIHVwIHRvIHR3byBjaGFyYWN0ZXJzIG9mIHRoZSBvcmlnaW5hbCBkYXRhXG5mdW5jdGlvbiBieXRlTGVuZ3RoIChiNjQpIHtcbiAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NClcbiAgdmFyIHZhbGlkTGVuID0gbGVuc1swXVxuICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXVxuICByZXR1cm4gKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCkgLSBwbGFjZUhvbGRlcnNMZW5cbn1cblxuZnVuY3Rpb24gX2J5dGVMZW5ndGggKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikge1xuICByZXR1cm4gKCh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCkgLSBwbGFjZUhvbGRlcnNMZW5cbn1cblxuZnVuY3Rpb24gdG9CeXRlQXJyYXkgKGI2NCkge1xuICB2YXIgdG1wXG4gIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpXG4gIHZhciB2YWxpZExlbiA9IGxlbnNbMF1cbiAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV1cblxuICB2YXIgYXJyID0gbmV3IEFycihfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pKVxuXG4gIHZhciBjdXJCeXRlID0gMFxuXG4gIC8vIGlmIHRoZXJlIGFyZSBwbGFjZWhvbGRlcnMsIG9ubHkgZ2V0IHVwIHRvIHRoZSBsYXN0IGNvbXBsZXRlIDQgY2hhcnNcbiAgdmFyIGxlbiA9IHBsYWNlSG9sZGVyc0xlbiA+IDBcbiAgICA/IHZhbGlkTGVuIC0gNFxuICAgIDogdmFsaWRMZW5cblxuICB2YXIgaVxuICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgICB0bXAgPVxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpKV0gPDwgMTgpIHxcbiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA8PCAxMikgfFxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMildIDw8IDYpIHxcbiAgICAgIHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMyldXG4gICAgYXJyW2N1ckJ5dGUrK10gPSAodG1wID4+IDE2KSAmIDB4RkZcbiAgICBhcnJbY3VyQnl0ZSsrXSA9ICh0bXAgPj4gOCkgJiAweEZGXG4gICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAweEZGXG4gIH1cblxuICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7XG4gICAgdG1wID1cbiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSldIDw8IDIpIHxcbiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDEpXSA+PiA0KVxuICAgIGFycltjdXJCeXRlKytdID0gdG1wICYgMHhGRlxuICB9XG5cbiAgaWYgKHBsYWNlSG9sZGVyc0xlbiA9PT0gMSkge1xuICAgIHRtcCA9XG4gICAgICAocmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkpXSA8PCAxMCkgfFxuICAgICAgKHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpICsgMSldIDw8IDQpIHxcbiAgICAgIChyZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaSArIDIpXSA+PiAyKVxuICAgIGFycltjdXJCeXRlKytdID0gKHRtcCA+PiA4KSAmIDB4RkZcbiAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDB4RkZcbiAgfVxuXG4gIHJldHVybiBhcnJcbn1cblxuZnVuY3Rpb24gdHJpcGxldFRvQmFzZTY0IChudW0pIHtcbiAgcmV0dXJuIGxvb2t1cFtudW0gPj4gMTggJiAweDNGXSArXG4gICAgbG9va3VwW251bSA+PiAxMiAmIDB4M0ZdICtcbiAgICBsb29rdXBbbnVtID4+IDYgJiAweDNGXSArXG4gICAgbG9va3VwW251bSAmIDB4M0ZdXG59XG5cbmZ1bmN0aW9uIGVuY29kZUNodW5rICh1aW50OCwgc3RhcnQsIGVuZCkge1xuICB2YXIgdG1wXG4gIHZhciBvdXRwdXQgPSBbXVxuICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkgKz0gMykge1xuICAgIHRtcCA9XG4gICAgICAoKHVpbnQ4W2ldIDw8IDE2KSAmIDB4RkYwMDAwKSArXG4gICAgICAoKHVpbnQ4W2kgKyAxXSA8PCA4KSAmIDB4RkYwMCkgK1xuICAgICAgKHVpbnQ4W2kgKyAyXSAmIDB4RkYpXG4gICAgb3V0cHV0LnB1c2godHJpcGxldFRvQmFzZTY0KHRtcCkpXG4gIH1cbiAgcmV0dXJuIG91dHB1dC5qb2luKCcnKVxufVxuXG5mdW5jdGlvbiBmcm9tQnl0ZUFycmF5ICh1aW50OCkge1xuICB2YXIgdG1wXG4gIHZhciBsZW4gPSB1aW50OC5sZW5ndGhcbiAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4gJSAzIC8vIGlmIHdlIGhhdmUgMSBieXRlIGxlZnQsIHBhZCAyIGJ5dGVzXG4gIHZhciBwYXJ0cyA9IFtdXG4gIHZhciBtYXhDaHVua0xlbmd0aCA9IDE2MzgzIC8vIG11c3QgYmUgbXVsdGlwbGUgb2YgM1xuXG4gIC8vIGdvIHRocm91Z2ggdGhlIGFycmF5IGV2ZXJ5IHRocmVlIGJ5dGVzLCB3ZSdsbCBkZWFsIHdpdGggdHJhaWxpbmcgc3R1ZmYgbGF0ZXJcbiAgZm9yICh2YXIgaSA9IDAsIGxlbjIgPSBsZW4gLSBleHRyYUJ5dGVzOyBpIDwgbGVuMjsgaSArPSBtYXhDaHVua0xlbmd0aCkge1xuICAgIHBhcnRzLnB1c2goZW5jb2RlQ2h1bmsodWludDgsIGksIChpICsgbWF4Q2h1bmtMZW5ndGgpID4gbGVuMiA/IGxlbjIgOiAoaSArIG1heENodW5rTGVuZ3RoKSkpXG4gIH1cblxuICAvLyBwYWQgdGhlIGVuZCB3aXRoIHplcm9zLCBidXQgbWFrZSBzdXJlIHRvIG5vdCBmb3JnZXQgdGhlIGV4dHJhIGJ5dGVzXG4gIGlmIChleHRyYUJ5dGVzID09PSAxKSB7XG4gICAgdG1wID0gdWludDhbbGVuIC0gMV1cbiAgICBwYXJ0cy5wdXNoKFxuICAgICAgbG9va3VwW3RtcCA+PiAyXSArXG4gICAgICBsb29rdXBbKHRtcCA8PCA0KSAmIDB4M0ZdICtcbiAgICAgICc9PSdcbiAgICApXG4gIH0gZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikge1xuICAgIHRtcCA9ICh1aW50OFtsZW4gLSAyXSA8PCA4KSArIHVpbnQ4W2xlbiAtIDFdXG4gICAgcGFydHMucHVzaChcbiAgICAgIGxvb2t1cFt0bXAgPj4gMTBdICtcbiAgICAgIGxvb2t1cFsodG1wID4+IDQpICYgMHgzRl0gK1xuICAgICAgbG9va3VwWyh0bXAgPDwgMikgJiAweDNGXSArXG4gICAgICAnPSdcbiAgICApXG4gIH1cblxuICByZXR1cm4gcGFydHMuam9pbignJylcbn1cblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYmFzZTY0LWpzL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgiLyohIGllZWU3NTQuIEJTRC0zLUNsYXVzZSBMaWNlbnNlLiBGZXJvc3MgQWJvdWtoYWRpamVoIDxodHRwczovL2Zlcm9zcy5vcmcvb3BlbnNvdXJjZT4gKi9cbmV4cG9ydHMucmVhZCA9IGZ1bmN0aW9uIChidWZmZXIsIG9mZnNldCwgaXNMRSwgbUxlbiwgbkJ5dGVzKSB7XG4gIHZhciBlLCBtXG4gIHZhciBlTGVuID0gKG5CeXRlcyAqIDgpIC0gbUxlbiAtIDFcbiAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDFcbiAgdmFyIGVCaWFzID0gZU1heCA+PiAxXG4gIHZhciBuQml0cyA9IC03XG4gIHZhciBpID0gaXNMRSA/IChuQnl0ZXMgLSAxKSA6IDBcbiAgdmFyIGQgPSBpc0xFID8gLTEgOiAxXG4gIHZhciBzID0gYnVmZmVyW29mZnNldCArIGldXG5cbiAgaSArPSBkXG5cbiAgZSA9IHMgJiAoKDEgPDwgKC1uQml0cykpIC0gMSlcbiAgcyA+Pj0gKC1uQml0cylcbiAgbkJpdHMgKz0gZUxlblxuICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gKGUgKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9XG5cbiAgbSA9IGUgJiAoKDEgPDwgKC1uQml0cykpIC0gMSlcbiAgZSA+Pj0gKC1uQml0cylcbiAgbkJpdHMgKz0gbUxlblxuICBmb3IgKDsgbkJpdHMgPiAwOyBtID0gKG0gKiAyNTYpICsgYnVmZmVyW29mZnNldCArIGldLCBpICs9IGQsIG5CaXRzIC09IDgpIHt9XG5cbiAgaWYgKGUgPT09IDApIHtcbiAgICBlID0gMSAtIGVCaWFzXG4gIH0gZWxzZSBpZiAoZSA9PT0gZU1heCkge1xuICAgIHJldHVybiBtID8gTmFOIDogKChzID8gLTEgOiAxKSAqIEluZmluaXR5KVxuICB9IGVsc2Uge1xuICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbilcbiAgICBlID0gZSAtIGVCaWFzXG4gIH1cbiAgcmV0dXJuIChzID8gLTEgOiAxKSAqIG0gKiBNYXRoLnBvdygyLCBlIC0gbUxlbilcbn1cblxuZXhwb3J0cy53cml0ZSA9IGZ1bmN0aW9uIChidWZmZXIsIHZhbHVlLCBvZmZzZXQsIGlzTEUsIG1MZW4sIG5CeXRlcykge1xuICB2YXIgZSwgbSwgY1xuICB2YXIgZUxlbiA9IChuQnl0ZXMgKiA4KSAtIG1MZW4gLSAxXG4gIHZhciBlTWF4ID0gKDEgPDwgZUxlbikgLSAxXG4gIHZhciBlQmlhcyA9IGVNYXggPj4gMVxuICB2YXIgcnQgPSAobUxlbiA9PT0gMjMgPyBNYXRoLnBvdygyLCAtMjQpIC0gTWF0aC5wb3coMiwgLTc3KSA6IDApXG4gIHZhciBpID0gaXNMRSA/IDAgOiAobkJ5dGVzIC0gMSlcbiAgdmFyIGQgPSBpc0xFID8gMSA6IC0xXG4gIHZhciBzID0gdmFsdWUgPCAwIHx8ICh2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwKSA/IDEgOiAwXG5cbiAgdmFsdWUgPSBNYXRoLmFicyh2YWx1ZSlcblxuICBpZiAoaXNOYU4odmFsdWUpIHx8IHZhbHVlID09PSBJbmZpbml0eSkge1xuICAgIG0gPSBpc05hTih2YWx1ZSkgPyAxIDogMFxuICAgIGUgPSBlTWF4XG4gIH0gZWxzZSB7XG4gICAgZSA9IE1hdGguZmxvb3IoTWF0aC5sb2codmFsdWUpIC8gTWF0aC5MTjIpXG4gICAgaWYgKHZhbHVlICogKGMgPSBNYXRoLnBvdygyLCAtZSkpIDwgMSkge1xuICAgICAgZS0tXG4gICAgICBjICo9IDJcbiAgICB9XG4gICAgaWYgKGUgKyBlQmlhcyA+PSAxKSB7XG4gICAgICB2YWx1ZSArPSBydCAvIGNcbiAgICB9IGVsc2Uge1xuICAgICAgdmFsdWUgKz0gcnQgKiBNYXRoLnBvdygyLCAxIC0gZUJpYXMpXG4gICAgfVxuICAgIGlmICh2YWx1ZSAqIGMgPj0gMikge1xuICAgICAgZSsrXG4gICAgICBjIC89IDJcbiAgICB9XG5cbiAgICBpZiAoZSArIGVCaWFzID49IGVNYXgpIHtcbiAgICAgIG0gPSAwXG4gICAgICBlID0gZU1heFxuICAgIH0gZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHtcbiAgICAgIG0gPSAoKHZhbHVlICogYykgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pXG4gICAgICBlID0gZSArIGVCaWFzXG4gICAgfSBlbHNlIHtcbiAgICAgIG0gPSB2YWx1ZSAqIE1hdGgucG93KDIsIGVCaWFzIC0gMSkgKiBNYXRoLnBvdygyLCBtTGVuKVxuICAgICAgZSA9IDBcbiAgICB9XG4gIH1cblxuICBmb3IgKDsgbUxlbiA+PSA4OyBidWZmZXJbb2Zmc2V0ICsgaV0gPSBtICYgMHhmZiwgaSArPSBkLCBtIC89IDI1NiwgbUxlbiAtPSA4KSB7fVxuXG4gIGUgPSAoZSA8PCBtTGVuKSB8IG1cbiAgZUxlbiArPSBtTGVuXG4gIGZvciAoOyBlTGVuID4gMDsgYnVmZmVyW29mZnNldCArIGldID0gZSAmIDB4ZmYsIGkgKz0gZCwgZSAvPSAyNTYsIGVMZW4gLT0gOCkge31cblxuICBidWZmZXJbb2Zmc2V0ICsgaSAtIGRdIHw9IHMgKiAxMjhcbn1cblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaWVlZTc1NC9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoInZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gKGFycikge1xuICByZXR1cm4gdG9TdHJpbmcuY2FsbChhcnIpID09ICdbb2JqZWN0IEFycmF5XSc7XG59O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9idWZmZXIvbm9kZV9tb2R1bGVzL2lzYXJyYXkvaW5kZXguanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCJcblxudmFyIGhhcyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHlcbiAgLCBwcmVmaXggPSAnfic7XG5cbi8qKlxuICogQ29uc3RydWN0b3IgdG8gY3JlYXRlIGEgc3RvcmFnZSBmb3Igb3VyIGBFRWAgb2JqZWN0cy5cbiAqIEFuIGBFdmVudHNgIGluc3RhbmNlIGlzIGEgcGxhaW4gb2JqZWN0IHdob3NlIHByb3BlcnRpZXMgYXJlIGV2ZW50IG5hbWVzLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gRXZlbnRzKCkge31cblxuLy9cbi8vIFdlIHRyeSB0byBub3QgaW5oZXJpdCBmcm9tIGBPYmplY3QucHJvdG90eXBlYC4gSW4gc29tZSBlbmdpbmVzIGNyZWF0aW5nIGFuXG4vLyBpbnN0YW5jZSBpbiB0aGlzIHdheSBpcyBmYXN0ZXIgdGhhbiBjYWxsaW5nIGBPYmplY3QuY3JlYXRlKG51bGwpYCBkaXJlY3RseS5cbi8vIElmIGBPYmplY3QuY3JlYXRlKG51bGwpYCBpcyBub3Qgc3VwcG9ydGVkIHdlIHByZWZpeCB0aGUgZXZlbnQgbmFtZXMgd2l0aCBhXG4vLyBjaGFyYWN0ZXIgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIGJ1aWx0LWluIG9iamVjdCBwcm9wZXJ0aWVzIGFyZSBub3Rcbi8vIG92ZXJyaWRkZW4gb3IgdXNlZCBhcyBhbiBhdHRhY2sgdmVjdG9yLlxuLy9cbmlmIChPYmplY3QuY3JlYXRlKSB7XG4gIEV2ZW50cy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gIC8vXG4gIC8vIFRoaXMgaGFjayBpcyBuZWVkZWQgYmVjYXVzZSB0aGUgYF9fcHJvdG9fX2AgcHJvcGVydHkgaXMgc3RpbGwgaW5oZXJpdGVkIGluXG4gIC8vIHNvbWUgb2xkIGJyb3dzZXJzIGxpa2UgQW5kcm9pZCA0LCBpUGhvbmUgNS4xLCBPcGVyYSAxMSBhbmQgU2FmYXJpIDUuXG4gIC8vXG4gIGlmICghbmV3IEV2ZW50cygpLl9fcHJvdG9fXykgcHJlZml4ID0gZmFsc2U7XG59XG5cbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYSBzaW5nbGUgZXZlbnQgbGlzdGVuZXIuXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICogQHBhcmFtIHsqfSBjb250ZXh0IFRoZSBjb250ZXh0IHRvIGludm9rZSB0aGUgbGlzdGVuZXIgd2l0aC5cbiAqIEBwYXJhbSB7Qm9vbGVhbn0gW29uY2U9ZmFsc2VdIFNwZWNpZnkgaWYgdGhlIGxpc3RlbmVyIGlzIGEgb25lLXRpbWUgbGlzdGVuZXIuXG4gKiBAY29uc3RydWN0b3JcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIEVFKGZuLCBjb250ZXh0LCBvbmNlKSB7XG4gIHRoaXMuZm4gPSBmbjtcbiAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcbiAgdGhpcy5vbmNlID0gb25jZSB8fCBmYWxzZTtcbn1cblxuLyoqXG4gKiBBZGQgYSBsaXN0ZW5lciBmb3IgYSBnaXZlbiBldmVudC5cbiAqXG4gKiBAcGFyYW0ge0V2ZW50RW1pdHRlcn0gZW1pdHRlciBSZWZlcmVuY2UgdG8gdGhlIGBFdmVudEVtaXR0ZXJgIGluc3RhbmNlLlxuICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICogQHBhcmFtIHsqfSBjb250ZXh0IFRoZSBjb250ZXh0IHRvIGludm9rZSB0aGUgbGlzdGVuZXIgd2l0aC5cbiAqIEBwYXJhbSB7Qm9vbGVhbn0gb25jZSBTcGVjaWZ5IGlmIHRoZSBsaXN0ZW5lciBpcyBhIG9uZS10aW1lIGxpc3RlbmVyLlxuICogQHJldHVybnMge0V2ZW50RW1pdHRlcn1cbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGFkZExpc3RlbmVyKGVtaXR0ZXIsIGV2ZW50LCBmbiwgY29udGV4dCwgb25jZSkge1xuICBpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlIGxpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyID0gbmV3IEVFKGZuLCBjb250ZXh0IHx8IGVtaXR0ZXIsIG9uY2UpXG4gICAgLCBldnQgPSBwcmVmaXggPyBwcmVmaXggKyBldmVudCA6IGV2ZW50O1xuXG4gIGlmICghZW1pdHRlci5fZXZlbnRzW2V2dF0pIGVtaXR0ZXIuX2V2ZW50c1tldnRdID0gbGlzdGVuZXIsIGVtaXR0ZXIuX2V2ZW50c0NvdW50Kys7XG4gIGVsc2UgaWYgKCFlbWl0dGVyLl9ldmVudHNbZXZ0XS5mbikgZW1pdHRlci5fZXZlbnRzW2V2dF0ucHVzaChsaXN0ZW5lcik7XG4gIGVsc2UgZW1pdHRlci5fZXZlbnRzW2V2dF0gPSBbZW1pdHRlci5fZXZlbnRzW2V2dF0sIGxpc3RlbmVyXTtcblxuICByZXR1cm4gZW1pdHRlcjtcbn1cblxuLyoqXG4gKiBDbGVhciBldmVudCBieSBuYW1lLlxuICpcbiAqIEBwYXJhbSB7RXZlbnRFbWl0dGVyfSBlbWl0dGVyIFJlZmVyZW5jZSB0byB0aGUgYEV2ZW50RW1pdHRlcmAgaW5zdGFuY2UuXG4gKiBAcGFyYW0geyhTdHJpbmd8U3ltYm9sKX0gZXZ0IFRoZSBFdmVudCBuYW1lLlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gY2xlYXJFdmVudChlbWl0dGVyLCBldnQpIHtcbiAgaWYgKC0tZW1pdHRlci5fZXZlbnRzQ291bnQgPT09IDApIGVtaXR0ZXIuX2V2ZW50cyA9IG5ldyBFdmVudHMoKTtcbiAgZWxzZSBkZWxldGUgZW1pdHRlci5fZXZlbnRzW2V2dF07XG59XG5cbi8qKlxuICogTWluaW1hbCBgRXZlbnRFbWl0dGVyYCBpbnRlcmZhY2UgdGhhdCBpcyBtb2xkZWQgYWdhaW5zdCB0aGUgTm9kZS5qc1xuICogYEV2ZW50RW1pdHRlcmAgaW50ZXJmYWNlLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7XG4gIHRoaXMuX2V2ZW50cyA9IG5ldyBFdmVudHMoKTtcbiAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xufVxuXG4vKipcbiAqIFJldHVybiBhbiBhcnJheSBsaXN0aW5nIHRoZSBldmVudHMgZm9yIHdoaWNoIHRoZSBlbWl0dGVyIGhhcyByZWdpc3RlcmVkXG4gKiBsaXN0ZW5lcnMuXG4gKlxuICogQHJldHVybnMge0FycmF5fVxuICogQHB1YmxpY1xuICovXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmV2ZW50TmFtZXMgPSBmdW5jdGlvbiBldmVudE5hbWVzKCkge1xuICB2YXIgbmFtZXMgPSBbXVxuICAgICwgZXZlbnRzXG4gICAgLCBuYW1lO1xuXG4gIGlmICh0aGlzLl9ldmVudHNDb3VudCA9PT0gMCkgcmV0dXJuIG5hbWVzO1xuXG4gIGZvciAobmFtZSBpbiAoZXZlbnRzID0gdGhpcy5fZXZlbnRzKSkge1xuICAgIGlmIChoYXMuY2FsbChldmVudHMsIG5hbWUpKSBuYW1lcy5wdXNoKHByZWZpeCA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lKTtcbiAgfVxuXG4gIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7XG4gICAgcmV0dXJuIG5hbWVzLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGV2ZW50cykpO1xuICB9XG5cbiAgcmV0dXJuIG5hbWVzO1xufTtcblxuLyoqXG4gKiBSZXR1cm4gdGhlIGxpc3RlbmVycyByZWdpc3RlcmVkIGZvciBhIGdpdmVuIGV2ZW50LlxuICpcbiAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBldmVudCBUaGUgZXZlbnQgbmFtZS5cbiAqIEByZXR1cm5zIHtBcnJheX0gVGhlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLlxuICogQHB1YmxpY1xuICovXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uIGxpc3RlbmVycyhldmVudCkge1xuICB2YXIgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudFxuICAgICwgaGFuZGxlcnMgPSB0aGlzLl9ldmVudHNbZXZ0XTtcblxuICBpZiAoIWhhbmRsZXJzKSByZXR1cm4gW107XG4gIGlmIChoYW5kbGVycy5mbikgcmV0dXJuIFtoYW5kbGVycy5mbl07XG5cbiAgZm9yICh2YXIgaSA9IDAsIGwgPSBoYW5kbGVycy5sZW5ndGgsIGVlID0gbmV3IEFycmF5KGwpOyBpIDwgbDsgaSsrKSB7XG4gICAgZWVbaV0gPSBoYW5kbGVyc1tpXS5mbjtcbiAgfVxuXG4gIHJldHVybiBlZTtcbn07XG5cbi8qKlxuICogUmV0dXJuIHRoZSBudW1iZXIgb2YgbGlzdGVuZXJzIGxpc3RlbmluZyB0byBhIGdpdmVuIGV2ZW50LlxuICpcbiAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBldmVudCBUaGUgZXZlbnQgbmFtZS5cbiAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBudW1iZXIgb2YgbGlzdGVuZXJzLlxuICogQHB1YmxpY1xuICovXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbiBsaXN0ZW5lckNvdW50KGV2ZW50KSB7XG4gIHZhciBldnQgPSBwcmVmaXggPyBwcmVmaXggKyBldmVudCA6IGV2ZW50XG4gICAgLCBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZ0XTtcblxuICBpZiAoIWxpc3RlbmVycykgcmV0dXJuIDA7XG4gIGlmIChsaXN0ZW5lcnMuZm4pIHJldHVybiAxO1xuICByZXR1cm4gbGlzdGVuZXJzLmxlbmd0aDtcbn07XG5cbi8qKlxuICogQ2FsbHMgZWFjaCBvZiB0aGUgbGlzdGVuZXJzIHJlZ2lzdGVyZWQgZm9yIGEgZ2l2ZW4gZXZlbnQuXG4gKlxuICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLlxuICogQHJldHVybnMge0Jvb2xlYW59IGB0cnVlYCBpZiB0aGUgZXZlbnQgaGFkIGxpc3RlbmVycywgZWxzZSBgZmFsc2VgLlxuICogQHB1YmxpY1xuICovXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiBlbWl0KGV2ZW50LCBhMSwgYTIsIGEzLCBhNCwgYTUpIHtcbiAgdmFyIGV2dCA9IHByZWZpeCA/IHByZWZpeCArIGV2ZW50IDogZXZlbnQ7XG5cbiAgaWYgKCF0aGlzLl9ldmVudHNbZXZ0XSkgcmV0dXJuIGZhbHNlO1xuXG4gIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZ0XVxuICAgICwgbGVuID0gYXJndW1lbnRzLmxlbmd0aFxuICAgICwgYXJnc1xuICAgICwgaTtcblxuICBpZiAobGlzdGVuZXJzLmZuKSB7XG4gICAgaWYgKGxpc3RlbmVycy5vbmNlKSB0aGlzLnJlbW92ZUxpc3RlbmVyKGV2ZW50LCBsaXN0ZW5lcnMuZm4sIHVuZGVmaW5lZCwgdHJ1ZSk7XG5cbiAgICBzd2l0Y2ggKGxlbikge1xuICAgICAgY2FzZSAxOiByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQpLCB0cnVlO1xuICAgICAgY2FzZSAyOiByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExKSwgdHJ1ZTtcbiAgICAgIGNhc2UgMzogcmV0dXJuIGxpc3RlbmVycy5mbi5jYWxsKGxpc3RlbmVycy5jb250ZXh0LCBhMSwgYTIpLCB0cnVlO1xuICAgICAgY2FzZSA0OiByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExLCBhMiwgYTMpLCB0cnVlO1xuICAgICAgY2FzZSA1OiByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExLCBhMiwgYTMsIGE0KSwgdHJ1ZTtcbiAgICAgIGNhc2UgNjogcmV0dXJuIGxpc3RlbmVycy5mbi5jYWxsKGxpc3RlbmVycy5jb250ZXh0LCBhMSwgYTIsIGEzLCBhNCwgYTUpLCB0cnVlO1xuICAgIH1cblxuICAgIGZvciAoaSA9IDEsIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0xKTsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICB9XG5cbiAgICBsaXN0ZW5lcnMuZm4uYXBwbHkobGlzdGVuZXJzLmNvbnRleHQsIGFyZ3MpO1xuICB9IGVsc2Uge1xuICAgIHZhciBsZW5ndGggPSBsaXN0ZW5lcnMubGVuZ3RoXG4gICAgICAsIGo7XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChsaXN0ZW5lcnNbaV0ub25jZSkgdGhpcy5yZW1vdmVMaXN0ZW5lcihldmVudCwgbGlzdGVuZXJzW2ldLmZuLCB1bmRlZmluZWQsIHRydWUpO1xuXG4gICAgICBzd2l0Y2ggKGxlbikge1xuICAgICAgICBjYXNlIDE6IGxpc3RlbmVyc1tpXS5mbi5jYWxsKGxpc3RlbmVyc1tpXS5jb250ZXh0KTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogbGlzdGVuZXJzW2ldLmZuLmNhbGwobGlzdGVuZXJzW2ldLmNvbnRleHQsIGExKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMzogbGlzdGVuZXJzW2ldLmZuLmNhbGwobGlzdGVuZXJzW2ldLmNvbnRleHQsIGExLCBhMik7IGJyZWFrO1xuICAgICAgICBjYXNlIDQ6IGxpc3RlbmVyc1tpXS5mbi5jYWxsKGxpc3RlbmVyc1tpXS5jb250ZXh0LCBhMSwgYTIsIGEzKTsgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgaWYgKCFhcmdzKSBmb3IgKGogPSAxLCBhcmdzID0gbmV3IEFycmF5KGxlbiAtMSk7IGogPCBsZW47IGorKykge1xuICAgICAgICAgICAgYXJnc1tqIC0gMV0gPSBhcmd1bWVudHNbal07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGlzdGVuZXJzW2ldLmZuLmFwcGx5KGxpc3RlbmVyc1tpXS5jb250ZXh0LCBhcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogQWRkIGEgbGlzdGVuZXIgZm9yIGEgZ2l2ZW4gZXZlbnQuXG4gKlxuICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICogQHBhcmFtIHsqfSBbY29udGV4dD10aGlzXSBUaGUgY29udGV4dCB0byBpbnZva2UgdGhlIGxpc3RlbmVyIHdpdGguXG4gKiBAcmV0dXJucyB7RXZlbnRFbWl0dGVyfSBgdGhpc2AuXG4gKiBAcHVibGljXG4gKi9cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbiBvbihldmVudCwgZm4sIGNvbnRleHQpIHtcbiAgcmV0dXJuIGFkZExpc3RlbmVyKHRoaXMsIGV2ZW50LCBmbiwgY29udGV4dCwgZmFsc2UpO1xufTtcblxuLyoqXG4gKiBBZGQgYSBvbmUtdGltZSBsaXN0ZW5lciBmb3IgYSBnaXZlbiBldmVudC5cbiAqXG4gKiBAcGFyYW0geyhTdHJpbmd8U3ltYm9sKX0gZXZlbnQgVGhlIGV2ZW50IG5hbWUuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgbGlzdGVuZXIgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyp9IFtjb250ZXh0PXRoaXNdIFRoZSBjb250ZXh0IHRvIGludm9rZSB0aGUgbGlzdGVuZXIgd2l0aC5cbiAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IGB0aGlzYC5cbiAqIEBwdWJsaWNcbiAqL1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gb25jZShldmVudCwgZm4sIGNvbnRleHQpIHtcbiAgcmV0dXJuIGFkZExpc3RlbmVyKHRoaXMsIGV2ZW50LCBmbiwgY29udGV4dCwgdHJ1ZSk7XG59O1xuXG4vKipcbiAqIFJlbW92ZSB0aGUgbGlzdGVuZXJzIG9mIGEgZ2l2ZW4gZXZlbnQuXG4gKlxuICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gT25seSByZW1vdmUgdGhlIGxpc3RlbmVycyB0aGF0IG1hdGNoIHRoaXMgZnVuY3Rpb24uXG4gKiBAcGFyYW0geyp9IGNvbnRleHQgT25seSByZW1vdmUgdGhlIGxpc3RlbmVycyB0aGF0IGhhdmUgdGhpcyBjb250ZXh0LlxuICogQHBhcmFtIHtCb29sZWFufSBvbmNlIE9ubHkgcmVtb3ZlIG9uZS10aW1lIGxpc3RlbmVycy5cbiAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IGB0aGlzYC5cbiAqIEBwdWJsaWNcbiAqL1xuRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGV2ZW50LCBmbiwgY29udGV4dCwgb25jZSkge1xuICB2YXIgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudDtcblxuICBpZiAoIXRoaXMuX2V2ZW50c1tldnRdKSByZXR1cm4gdGhpcztcbiAgaWYgKCFmbikge1xuICAgIGNsZWFyRXZlbnQodGhpcywgZXZ0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZ0XTtcblxuICBpZiAobGlzdGVuZXJzLmZuKSB7XG4gICAgaWYgKFxuICAgICAgbGlzdGVuZXJzLmZuID09PSBmbiAmJlxuICAgICAgKCFvbmNlIHx8IGxpc3RlbmVycy5vbmNlKSAmJlxuICAgICAgKCFjb250ZXh0IHx8IGxpc3RlbmVycy5jb250ZXh0ID09PSBjb250ZXh0KVxuICAgICkge1xuICAgICAgY2xlYXJFdmVudCh0aGlzLCBldnQpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKHZhciBpID0gMCwgZXZlbnRzID0gW10sIGxlbmd0aCA9IGxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKFxuICAgICAgICBsaXN0ZW5lcnNbaV0uZm4gIT09IGZuIHx8XG4gICAgICAgIChvbmNlICYmICFsaXN0ZW5lcnNbaV0ub25jZSkgfHxcbiAgICAgICAgKGNvbnRleHQgJiYgbGlzdGVuZXJzW2ldLmNvbnRleHQgIT09IGNvbnRleHQpXG4gICAgICApIHtcbiAgICAgICAgZXZlbnRzLnB1c2gobGlzdGVuZXJzW2ldKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIFJlc2V0IHRoZSBhcnJheSwgb3IgcmVtb3ZlIGl0IGNvbXBsZXRlbHkgaWYgd2UgaGF2ZSBubyBtb3JlIGxpc3RlbmVycy5cbiAgICAvL1xuICAgIGlmIChldmVudHMubGVuZ3RoKSB0aGlzLl9ldmVudHNbZXZ0XSA9IGV2ZW50cy5sZW5ndGggPT09IDEgPyBldmVudHNbMF0gOiBldmVudHM7XG4gICAgZWxzZSBjbGVhckV2ZW50KHRoaXMsIGV2dCk7XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogUmVtb3ZlIGFsbCBsaXN0ZW5lcnMsIG9yIHRob3NlIG9mIHRoZSBzcGVjaWZpZWQgZXZlbnQuXG4gKlxuICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IFtldmVudF0gVGhlIGV2ZW50IG5hbWUuXG4gKiBAcmV0dXJucyB7RXZlbnRFbWl0dGVyfSBgdGhpc2AuXG4gKiBAcHVibGljXG4gKi9cbkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKGV2ZW50KSB7XG4gIHZhciBldnQ7XG5cbiAgaWYgKGV2ZW50KSB7XG4gICAgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudDtcbiAgICBpZiAodGhpcy5fZXZlbnRzW2V2dF0pIGNsZWFyRXZlbnQodGhpcywgZXZ0KTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLl9ldmVudHMgPSBuZXcgRXZlbnRzKCk7XG4gICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vL1xuLy8gQWxpYXMgbWV0aG9kcyBuYW1lcyBiZWNhdXNlIHBlb3BsZSByb2xsIGxpa2UgdGhhdC5cbi8vXG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9mZiA9IEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI7XG5FdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbjtcblxuLy9cbi8vIEV4cG9zZSB0aGUgcHJlZml4LlxuLy9cbkV2ZW50RW1pdHRlci5wcmVmaXhlZCA9IHByZWZpeDtcblxuLy9cbi8vIEFsbG93IGBFdmVudEVtaXR0ZXJgIHRvIGJlIGltcG9ydGVkIGFzIG1vZHVsZSBuYW1lc3BhY2UuXG4vL1xuRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcblxuLy9cbi8vIEV4cG9zZSB0aGUgbW9kdWxlLlxuLy9cbmlmICh0cnVlKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyO1xufVxuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9ldmVudGVtaXR0ZXIzL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiXG5cbmNvbnN0IHBGaW5hbGx5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcC1maW5hbGx5ICovIDQ5KTtcblxuY2xhc3MgVGltZW91dEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuXHRjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG5cdFx0c3VwZXIobWVzc2FnZSk7XG5cdFx0dGhpcy5uYW1lID0gJ1RpbWVvdXRFcnJvcic7XG5cdH1cbn1cblxuY29uc3QgcFRpbWVvdXQgPSAocHJvbWlzZSwgbWlsbGlzZWNvbmRzLCBmYWxsYmFjaykgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRpZiAodHlwZW9mIG1pbGxpc2Vjb25kcyAhPT0gJ251bWJlcicgfHwgbWlsbGlzZWNvbmRzIDwgMCkge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIGBtaWxsaXNlY29uZHNgIHRvIGJlIGEgcG9zaXRpdmUgbnVtYmVyJyk7XG5cdH1cblxuXHRpZiAobWlsbGlzZWNvbmRzID09PSBJbmZpbml0eSkge1xuXHRcdHJlc29sdmUocHJvbWlzZSk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Y29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRpZiAodHlwZW9mIGZhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRyZXNvbHZlKGZhbGxiYWNrKCkpO1xuXHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZmFsbGJhY2sgPT09ICdzdHJpbmcnID8gZmFsbGJhY2sgOiBgUHJvbWlzZSB0aW1lZCBvdXQgYWZ0ZXIgJHttaWxsaXNlY29uZHN9IG1pbGxpc2Vjb25kc2A7XG5cdFx0Y29uc3QgdGltZW91dEVycm9yID0gZmFsbGJhY2sgaW5zdGFuY2VvZiBFcnJvciA/IGZhbGxiYWNrIDogbmV3IFRpbWVvdXRFcnJvcihtZXNzYWdlKTtcblxuXHRcdGlmICh0eXBlb2YgcHJvbWlzZS5jYW5jZWwgPT09ICdmdW5jdGlvbicpIHtcblx0XHRcdHByb21pc2UuY2FuY2VsKCk7XG5cdFx0fVxuXG5cdFx0cmVqZWN0KHRpbWVvdXRFcnJvcik7XG5cdH0sIG1pbGxpc2Vjb25kcyk7XG5cblx0Ly8gVE9ETzogVXNlIG5hdGl2ZSBgZmluYWxseWAga2V5d29yZCB3aGVuIHRhcmdldGluZyBOb2RlLmpzIDEwXG5cdHBGaW5hbGx5KFxuXHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG5cdFx0cHJvbWlzZS50aGVuKHJlc29sdmUsIHJlamVjdCksXG5cdFx0KCkgPT4ge1xuXHRcdFx0Y2xlYXJUaW1lb3V0KHRpbWVyKTtcblx0XHR9XG5cdCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBwVGltZW91dDtcbi8vIFRPRE86IFJlbW92ZSB0aGlzIGZvciB0aGUgbmV4dCBtYWpvciByZWxlYXNlXG5tb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gcFRpbWVvdXQ7XG5cbm1vZHVsZS5leHBvcnRzLlRpbWVvdXRFcnJvciA9IFRpbWVvdXRFcnJvcjtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcC10aW1lb3V0L2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgiXG5tb2R1bGUuZXhwb3J0cyA9IChwcm9taXNlLCBvbkZpbmFsbHkpID0+IHtcblx0b25GaW5hbGx5ID0gb25GaW5hbGx5IHx8ICgoKSA9PiB7fSk7XG5cblx0cmV0dXJuIHByb21pc2UudGhlbihcblx0XHR2YWwgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG5cdFx0XHRyZXNvbHZlKG9uRmluYWxseSgpKTtcblx0XHR9KS50aGVuKCgpID0+IHZhbCksXG5cdFx0ZXJyID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuXHRcdFx0cmVzb2x2ZShvbkZpbmFsbHkoKSk7XG5cdFx0fSkudGhlbigoKSA9PiB7XG5cdFx0XHR0aHJvdyBlcnI7XG5cdFx0fSlcblx0KTtcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3AtZmluYWxseS9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoJ1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGxvd2VyX2JvdW5kXzEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2xvd2VyLWJvdW5kICovIDUxKTtcbmNsYXNzIFByaW9yaXR5UXVldWUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgIH1cbiAgICBlbnF1ZXVlKHJ1biwgb3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IHByaW9yaXR5OiAwIH0sIG9wdGlvbnMpO1xuICAgICAgICBjb25zdCBlbGVtZW50ID0ge1xuICAgICAgICAgICAgcHJpb3JpdHk6IG9wdGlvbnMucHJpb3JpdHksXG4gICAgICAgICAgICBydW5cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuc2l6ZSAmJiB0aGlzLl9xdWV1ZVt0aGlzLnNpemUgLSAxXS5wcmlvcml0eSA+PSBvcHRpb25zLnByaW9yaXR5KSB7XG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5wdXNoKGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluZGV4ID0gbG93ZXJfYm91bmRfMS5kZWZhdWx0KHRoaXMuX3F1ZXVlLCBlbGVtZW50LCAoYSwgYikgPT4gYi5wcmlvcml0eSAtIGEucHJpb3JpdHkpO1xuICAgICAgICB0aGlzLl9xdWV1ZS5zcGxpY2UoaW5kZXgsIDAsIGVsZW1lbnQpO1xuICAgIH1cbiAgICBkZXF1ZXVlKCkge1xuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5fcXVldWUuc2hpZnQoKTtcbiAgICAgICAgcmV0dXJuIGl0ZW0gPT09IG51bGwgfHwgaXRlbSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaXRlbS5ydW47XG4gICAgfVxuICAgIGZpbHRlcihvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWV1ZS5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQucHJpb3JpdHkgPT09IG9wdGlvbnMucHJpb3JpdHkpLm1hcCgoZWxlbWVudCkgPT4gZWxlbWVudC5ydW4pO1xuICAgIH1cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXVlLmxlbmd0aDtcbiAgICB9XG59XG5leHBvcnRzLmRlZmF1bHQgPSBQcmlvcml0eVF1ZXVlO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9wLXF1ZXVlL2Rpc3QvcHJpb3JpdHktcXVldWUuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCdcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyBQb3J0IG9mIGxvd2VyX2JvdW5kIGZyb20gaHR0cHM6Ly9lbi5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2FsZ29yaXRobS9sb3dlcl9ib3VuZFxuLy8gVXNlZCB0byBjb21wdXRlIGluc2VydGlvbiBpbmRleCB0byBrZWVwIHF1ZXVlIHNvcnRlZCBhZnRlciBpbnNlcnRpb25cbmZ1bmN0aW9uIGxvd2VyQm91bmQoYXJyYXksIHZhbHVlLCBjb21wYXJhdG9yKSB7XG4gICAgbGV0IGZpcnN0ID0gMDtcbiAgICBsZXQgY291bnQgPSBhcnJheS5sZW5ndGg7XG4gICAgd2hpbGUgKGNvdW50ID4gMCkge1xuICAgICAgICBjb25zdCBzdGVwID0gKGNvdW50IC8gMikgfCAwO1xuICAgICAgICBsZXQgaXQgPSBmaXJzdCArIHN0ZXA7XG4gICAgICAgIGlmIChjb21wYXJhdG9yKGFycmF5W2l0XSwgdmFsdWUpIDw9IDApIHtcbiAgICAgICAgICAgIGZpcnN0ID0gKytpdDtcbiAgICAgICAgICAgIGNvdW50IC09IHN0ZXAgKyAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY291bnQgPSBzdGVwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmaXJzdDtcbn1cbmV4cG9ydHMuZGVmYXVsdCA9IGxvd2VyQm91bmQ7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3AtcXVldWUvZGlzdC9sb3dlci1ib3VuZC5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7ZXZhbCgnLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG52YXIgcnVudGltZSA9IChmdW5jdGlvbiAoZXhwb3J0cykge1xuICAidXNlIHN0cmljdCI7XG5cbiAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTtcbiAgdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5O1xuICB2YXIgdW5kZWZpbmVkOyAvLyBNb3JlIGNvbXByZXNzaWJsZSB0aGFuIHZvaWQgMC5cbiAgdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iID8gU3ltYm9sIDoge307XG4gIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiO1xuICB2YXIgYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIjtcbiAgdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7XG5cbiAgZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9XG4gIHRyeSB7XG4gICAgLy8gSUUgOCBoYXMgYSBicm9rZW4gT2JqZWN0LmRlZmluZVByb3BlcnR5IHRoYXQgb25seSB3b3JrcyBvbiBET00gb2JqZWN0cy5cbiAgICBkZWZpbmUoe30sICIiKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgZGVmaW5lID0gZnVuY3Rpb24ob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgICByZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge1xuICAgIC8vIElmIG91dGVyRm4gcHJvdmlkZWQgYW5kIG91dGVyRm4ucHJvdG90eXBlIGlzIGEgR2VuZXJhdG9yLCB0aGVuIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yLlxuICAgIHZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yO1xuICAgIHZhciBnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSk7XG4gICAgdmFyIGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7XG5cbiAgICAvLyBUaGUgLl9pbnZva2UgbWV0aG9kIHVuaWZpZXMgdGhlIGltcGxlbWVudGF0aW9ucyBvZiB0aGUgLm5leHQsXG4gICAgLy8gLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzLlxuICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtcblxuICAgIHJldHVybiBnZW5lcmF0b3I7XG4gIH1cbiAgZXhwb3J0cy53cmFwID0gd3JhcDtcblxuICAvLyBUcnkvY2F0Y2ggaGVscGVyIHRvIG1pbmltaXplIGRlb3B0aW1pemF0aW9ucy4gUmV0dXJucyBhIGNvbXBsZXRpb25cbiAgLy8gcmVjb3JkIGxpa2UgY29udGV4dC50cnlFbnRyaWVzW2ldLmNvbXBsZXRpb24uIFRoaXMgaW50ZXJmYWNlIGNvdWxkXG4gIC8vIGhhdmUgYmVlbiAoYW5kIHdhcyBwcmV2aW91c2x5KSBkZXNpZ25lZCB0byB0YWtlIGEgY2xvc3VyZSB0byBiZVxuICAvLyBpbnZva2VkIHdpdGhvdXQgYXJndW1lbnRzLCBidXQgaW4gYWxsIHRoZSBjYXNlcyB3ZSBjYXJlIGFib3V0IHdlXG4gIC8vIGFscmVhZHkgaGF2ZSBhbiBleGlzdGluZyBtZXRob2Qgd2Ugd2FudCB0byBjYWxsLCBzbyB0aGVyZVwncyBubyBuZWVkXG4gIC8vIHRvIGNyZWF0ZSBhIG5ldyBmdW5jdGlvbiBvYmplY3QuIFdlIGNhbiBldmVuIGdldCBhd2F5IHdpdGggYXNzdW1pbmdcbiAgLy8gdGhlIG1ldGhvZCB0YWtlcyBleGFjdGx5IG9uZSBhcmd1bWVudCwgc2luY2UgdGhhdCBoYXBwZW5zIHRvIGJlIHRydWVcbiAgLy8gaW4gZXZlcnkgY2FzZSwgc28gd2UgZG9uXCd0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZVxuICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoXG4gIC8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS5cbiAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O1xuICAgIH1cbiAgfVxuXG4gIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0ID0gInN1c3BlbmRlZFN0YXJ0IjtcbiAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSAic3VzcGVuZGVkWWllbGQiO1xuICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjtcbiAgdmFyIEdlblN0YXRlQ29tcGxldGVkID0gImNvbXBsZXRlZCI7XG5cbiAgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhc1xuICAvLyBicmVha2luZyBvdXQgb2YgdGhlIGRpc3BhdGNoIHN3aXRjaCBzdGF0ZW1lbnQuXG4gIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307XG5cbiAgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kXG4gIC8vIC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgcHJvcGVydGllcyBmb3IgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIEdlbmVyYXRvclxuICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91clxuICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLlxuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cblxuICAvLyBUaGlzIGlzIGEgcG9seWZpbGwgZm9yICVJdGVyYXRvclByb3RvdHlwZSUgZm9yIGVudmlyb25tZW50cyB0aGF0XG4gIC8vIGRvblwndCBuYXRpdmVseSBzdXBwb3J0IGl0LlxuICB2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtcbiAgSXRlcmF0b3JQcm90b3R5cGVbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIHZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjtcbiAgdmFyIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO1xuICBpZiAoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiZcbiAgICAgIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJlxuICAgICAgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSkge1xuICAgIC8vIFRoaXMgZW52aXJvbm1lbnQgaGFzIGEgbmF0aXZlICVJdGVyYXRvclByb3RvdHlwZSU7IHVzZSBpdCBpbnN0ZWFkXG4gICAgLy8gb2YgdGhlIHBvbHlmaWxsLlxuICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGU7XG4gIH1cblxuICB2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPVxuICAgIEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTtcbiAgR2VuZXJhdG9yRnVuY3Rpb24ucHJvdG90eXBlID0gR3AuY29uc3RydWN0b3IgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTtcbiAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUuY29uc3RydWN0b3IgPSBHZW5lcmF0b3JGdW5jdGlvbjtcbiAgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoXG4gICAgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsXG4gICAgdG9TdHJpbmdUYWdTeW1ib2wsXG4gICAgIkdlbmVyYXRvckZ1bmN0aW9uIlxuICApO1xuXG4gIC8vIEhlbHBlciBmb3IgZGVmaW5pbmcgdGhlIC5uZXh0LCAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMgb2YgdGhlXG4gIC8vIEl0ZXJhdG9yIGludGVyZmFjZSBpbiB0ZXJtcyBvZiBhIHNpbmdsZSAuX2ludm9rZSBtZXRob2QuXG4gIGZ1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtcbiAgICBbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgIGRlZmluZShwcm90b3R5cGUsIG1ldGhvZCwgZnVuY3Rpb24oYXJnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbihnZW5GdW4pIHtcbiAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09ICJmdW5jdGlvbiIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yO1xuICAgIHJldHVybiBjdG9yXG4gICAgICA/IGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8XG4gICAgICAgIC8vIEZvciB0aGUgbmF0aXZlIEdlbmVyYXRvckZ1bmN0aW9uIGNvbnN0cnVjdG9yLCB0aGUgYmVzdCB3ZSBjYW5cbiAgICAgICAgLy8gZG8gaXMgdG8gY2hlY2sgaXRzIC5uYW1lIHByb3BlcnR5LlxuICAgICAgICAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSAiR2VuZXJhdG9yRnVuY3Rpb24iXG4gICAgICA6IGZhbHNlO1xuICB9O1xuXG4gIGV4cG9ydHMubWFyayA9IGZ1bmN0aW9uKGdlbkZ1bikge1xuICAgIGlmIChPYmplY3Quc2V0UHJvdG90eXBlT2YpIHtcbiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICAgICAgZGVmaW5lKGdlbkZ1biwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpO1xuICAgIH1cbiAgICBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCk7XG4gICAgcmV0dXJuIGdlbkZ1bjtcbiAgfTtcblxuICAvLyBXaXRoaW4gdGhlIGJvZHkgb2YgYW55IGFzeW5jIGZ1bmN0aW9uLCBgYXdhaXQgeGAgaXMgdHJhbnNmb3JtZWQgdG9cbiAgLy8gYHlpZWxkIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh4KWAsIHNvIHRoYXQgdGhlIHJ1bnRpbWUgY2FuIHRlc3RcbiAgLy8gYGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpYCB0byBkZXRlcm1pbmUgaWYgdGhlIHlpZWxkZWQgdmFsdWUgaXNcbiAgLy8gbWVhbnQgdG8gYmUgYXdhaXRlZC5cbiAgZXhwb3J0cy5hd3JhcCA9IGZ1bmN0aW9uKGFyZykge1xuICAgIHJldHVybiB7IF9fYXdhaXQ6IGFyZyB9O1xuICB9O1xuXG4gIGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge1xuICAgIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtcbiAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93Iikge1xuICAgICAgICByZWplY3QocmVjb3JkLmFyZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZztcbiAgICAgICAgdmFyIHZhbHVlID0gcmVzdWx0LnZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgJiZcbiAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiZcbiAgICAgICAgICAgIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24odW53cmFwcGVkKSB7XG4gICAgICAgICAgLy8gV2hlbiBhIHlpZWxkZWQgUHJvbWlzZSBpcyByZXNvbHZlZCwgaXRzIGZpbmFsIHZhbHVlIGJlY29tZXNcbiAgICAgICAgICAvLyB0aGUgLnZhbHVlIG9mIHRoZSBQcm9taXNlPHt2YWx1ZSxkb25lfT4gcmVzdWx0IGZvciB0aGVcbiAgICAgICAgICAvLyBjdXJyZW50IGl0ZXJhdGlvbi5cbiAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7XG4gICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIC8vIElmIGEgcmVqZWN0ZWQgUHJvbWlzZSB3YXMgeWllbGRlZCwgdGhyb3cgdGhlIHJlamVjdGlvbiBiYWNrXG4gICAgICAgICAgLy8gaW50byB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIHNvIGl0IGNhbiBiZSBoYW5kbGVkIHRoZXJlLlxuICAgICAgICAgIHJldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBwcmV2aW91c1Byb21pc2U7XG5cbiAgICBmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID1cbiAgICAgICAgLy8gSWYgZW5xdWV1ZSBoYXMgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIHdlIHdhbnQgdG8gd2FpdCB1bnRpbFxuICAgICAgICAvLyBhbGwgcHJldmlvdXMgUHJvbWlzZXMgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSBjYWxsaW5nIGludm9rZSxcbiAgICAgICAgLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZlxuICAgICAgICAvLyBlbnF1ZXVlIGhhcyBub3QgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIGl0IGlzIGltcG9ydGFudCB0b1xuICAgICAgICAvLyBjYWxsIGludm9rZSBpbW1lZGlhdGVseSwgd2l0aG91dCB3YWl0aW5nIG9uIGEgY2FsbGJhY2sgdG8gZmlyZSxcbiAgICAgICAgLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG9cbiAgICAgICAgLy8gYW55IG5lY2Vzc2FyeSBzZXR1cCBpbiBhIHByZWRpY3RhYmxlIHdheS4gVGhpcyBwcmVkaWN0YWJpbGl0eVxuICAgICAgICAvLyBpcyB3aHkgdGhlIFByb21pc2UgY29uc3RydWN0b3Igc3luY2hyb25vdXNseSBpbnZva2VzIGl0c1xuICAgICAgICAvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseVxuICAgICAgICAvLyBleGVjdXRlIGNvZGUgYmVmb3JlIHRoZSBmaXJzdCBhd2FpdC4gU2luY2Ugd2UgaW1wbGVtZW50IHNpbXBsZVxuICAgICAgICAvLyBhc3luYyBmdW5jdGlvbnMgaW4gdGVybXMgb2YgYXN5bmMgZ2VuZXJhdG9ycywgaXQgaXMgZXNwZWNpYWxseVxuICAgICAgICAvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuXG4gICAgICAgIHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKFxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLFxuICAgICAgICAgIC8vIEF2b2lkIHByb3BhZ2F0aW5nIGZhaWx1cmVzIHRvIFByb21pc2VzIHJldHVybmVkIGJ5IGxhdGVyXG4gICAgICAgICAgLy8gaW52b2NhdGlvbnMgb2YgdGhlIGl0ZXJhdG9yLlxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnXG4gICAgICAgICkgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO1xuICAgIH1cblxuICAgIC8vIERlZmluZSB0aGUgdW5pZmllZCBoZWxwZXIgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgLm5leHQsXG4gICAgLy8gLnRocm93LCBhbmQgLnJldHVybiAoc2VlIGRlZmluZUl0ZXJhdG9yTWV0aG9kcykuXG4gICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTtcbiAgfVxuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7XG4gIEFzeW5jSXRlcmF0b3IucHJvdG90eXBlW2FzeW5jSXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuICBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yO1xuXG4gIC8vIE5vdGUgdGhhdCBzaW1wbGUgYXN5bmMgZnVuY3Rpb25zIGFyZSBpbXBsZW1lbnRlZCBvbiB0b3Agb2ZcbiAgLy8gQXN5bmNJdGVyYXRvciBvYmplY3RzOyB0aGV5IGp1c3QgcmV0dXJuIGEgUHJvbWlzZSBmb3IgdGhlIHZhbHVlIG9mXG4gIC8vIHRoZSBmaW5hbCByZXN1bHQgcHJvZHVjZWQgYnkgdGhlIGl0ZXJhdG9yLlxuICBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24oaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7XG4gICAgaWYgKFByb21pc2VJbXBsID09PSB2b2lkIDApIFByb21pc2VJbXBsID0gUHJvbWlzZTtcblxuICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3IoXG4gICAgICB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSxcbiAgICAgIFByb21pc2VJbXBsXG4gICAgKTtcblxuICAgIHJldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbilcbiAgICAgID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuXG4gICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7XG4gICAgICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge1xuICAgIHZhciBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQ7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7XG4gICAgICAgIGlmIChtZXRob2QgPT09ICJ0aHJvdyIpIHtcbiAgICAgICAgICB0aHJvdyBhcmc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBCZSBmb3JnaXZpbmcsIHBlciAyNS4zLjMuMy4zIG9mIHRoZSBzcGVjOlxuICAgICAgICAvLyBodHRwczovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtZ2VuZXJhdG9ycmVzdW1lXG4gICAgICAgIHJldHVybiBkb25lUmVzdWx0KCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRleHQubWV0aG9kID0gbWV0aG9kO1xuICAgICAgY29udGV4dC5hcmcgPSBhcmc7XG5cbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIHZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7XG4gICAgICAgIGlmIChkZWxlZ2F0ZSkge1xuICAgICAgICAgIHZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO1xuICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCkge1xuICAgICAgICAgICAgaWYgKGRlbGVnYXRlUmVzdWx0ID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtcbiAgICAgICAgICAgIHJldHVybiBkZWxlZ2F0ZVJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJuZXh0Iikge1xuICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWxcJ3NcbiAgICAgICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLlxuICAgICAgICAgIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztcblxuICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7XG4gICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0KSB7XG4gICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkO1xuICAgICAgICAgICAgdGhyb3cgY29udGV4dC5hcmc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7XG5cbiAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInJldHVybiIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUV4ZWN1dGluZztcblxuICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7XG4gICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gIm5vcm1hbCIpIHtcbiAgICAgICAgICAvLyBJZiBhbiBleGNlcHRpb24gaXMgdGhyb3duIGZyb20gaW5uZXJGbiwgd2UgbGVhdmUgc3RhdGUgPT09XG4gICAgICAgICAgLy8gR2VuU3RhdGVFeGVjdXRpbmcgYW5kIGxvb3AgYmFjayBmb3IgYW5vdGhlciBpbnZvY2F0aW9uLlxuICAgICAgICAgIHN0YXRlID0gY29udGV4dC5kb25lXG4gICAgICAgICAgICA/IEdlblN0YXRlQ29tcGxldGVkXG4gICAgICAgICAgICA6IEdlblN0YXRlU3VzcGVuZGVkWWllbGQ7XG5cbiAgICAgICAgICBpZiAocmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbHVlOiByZWNvcmQuYXJnLFxuICAgICAgICAgICAgZG9uZTogY29udGV4dC5kb25lXG4gICAgICAgICAgfTtcblxuICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7XG4gICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlXG4gICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7XG4gICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIC8vIENhbGwgZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdKGNvbnRleHQuYXJnKSBhbmQgaGFuZGxlIHRoZVxuICAvLyByZXN1bHQsIGVpdGhlciBieSByZXR1cm5pbmcgYSB7IHZhbHVlLCBkb25lIH0gcmVzdWx0IGZyb20gdGhlXG4gIC8vIGRlbGVnYXRlIGl0ZXJhdG9yLCBvciBieSBtb2RpZnlpbmcgY29udGV4dC5tZXRob2QgYW5kIGNvbnRleHQuYXJnLFxuICAvLyBzZXR0aW5nIGNvbnRleHQuZGVsZWdhdGUgdG8gbnVsbCwgYW5kIHJldHVybmluZyB0aGUgQ29udGludWVTZW50aW5lbC5cbiAgZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge1xuICAgIHZhciBtZXRob2QgPSBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF07XG4gICAgaWYgKG1ldGhvZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBBIC50aHJvdyBvciAucmV0dXJuIHdoZW4gdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBubyAudGhyb3dcbiAgICAgIC8vIG1ldGhvZCBhbHdheXMgdGVybWluYXRlcyB0aGUgeWllbGQqIGxvb3AuXG4gICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcblxuICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7XG4gICAgICAgIC8vIE5vdGU6IFsicmV0dXJuIl0gbXVzdCBiZSB1c2VkIGZvciBFUzMgcGFyc2luZyBjb21wYXRpYmlsaXR5LlxuICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdKSB7XG4gICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBhIHJldHVybiBtZXRob2QsIGdpdmUgaXQgYVxuICAgICAgICAgIC8vIGNoYW5jZSB0byBjbGVhbiB1cC5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iO1xuICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgICAgIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO1xuXG4gICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7XG4gICAgICAgICAgICAvLyBJZiBtYXliZUludm9rZURlbGVnYXRlKGNvbnRleHQpIGNoYW5nZWQgY29udGV4dC5tZXRob2QgZnJvbVxuICAgICAgICAgICAgLy8gInJldHVybiIgdG8gInRocm93IiwgbGV0IHRoYXQgb3ZlcnJpZGUgdGhlIFR5cGVFcnJvciBiZWxvdy5cbiAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjtcbiAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhIFwndGhyb3dcJyBtZXRob2QiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtcblxuICAgIGlmIChyZWNvcmQudHlwZSA9PT0gInRocm93Iikge1xuICAgICAgY29udGV4dC5tZXRob2QgPSAidGhyb3ciO1xuICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnO1xuICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7XG4gICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICB9XG5cbiAgICB2YXIgaW5mbyA9IHJlY29yZC5hcmc7XG5cbiAgICBpZiAoISBpbmZvKSB7XG4gICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7XG4gICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0Iik7XG4gICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cblxuICAgIGlmIChpbmZvLmRvbmUpIHtcbiAgICAgIC8vIEFzc2lnbiB0aGUgcmVzdWx0IG9mIHRoZSBmaW5pc2hlZCBkZWxlZ2F0ZSB0byB0aGUgdGVtcG9yYXJ5XG4gICAgICAvLyB2YXJpYWJsZSBzcGVjaWZpZWQgYnkgZGVsZWdhdGUucmVzdWx0TmFtZSAoc2VlIGRlbGVnYXRlWWllbGQpLlxuICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7XG5cbiAgICAgIC8vIFJlc3VtZSBleGVjdXRpb24gYXQgdGhlIGRlc2lyZWQgbG9jYXRpb24gKHNlZSBkZWxlZ2F0ZVlpZWxkKS5cbiAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7XG5cbiAgICAgIC8vIElmIGNvbnRleHQubWV0aG9kIHdhcyAidGhyb3ciIGJ1dCB0aGUgZGVsZWdhdGUgaGFuZGxlZCB0aGVcbiAgICAgIC8vIGV4Y2VwdGlvbiwgbGV0IHRoZSBvdXRlciBnZW5lcmF0b3IgcHJvY2VlZCBub3JtYWxseS4gSWZcbiAgICAgIC8vIGNvbnRleHQubWV0aG9kIHdhcyAibmV4dCIsIGZvcmdldCBjb250ZXh0LmFyZyBzaW5jZSBpdCBoYXMgYmVlblxuICAgICAgLy8gImNvbnN1bWVkIiBieSB0aGUgZGVsZWdhdGUgaXRlcmF0b3IuIElmIGNvbnRleHQubWV0aG9kIHdhc1xuICAgICAgLy8gInJldHVybiIsIGFsbG93IHRoZSBvcmlnaW5hbCAucmV0dXJuIGNhbGwgdG8gY29udGludWUgaW4gdGhlXG4gICAgICAvLyBvdXRlciBnZW5lcmF0b3IuXG4gICAgICBpZiAoY29udGV4dC5tZXRob2QgIT09ICJyZXR1cm4iKSB7XG4gICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiO1xuICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZS15aWVsZCB0aGUgcmVzdWx0IHJldHVybmVkIGJ5IHRoZSBkZWxlZ2F0ZSBtZXRob2QuXG4gICAgICByZXR1cm4gaW5mbztcbiAgICB9XG5cbiAgICAvLyBUaGUgZGVsZWdhdGUgaXRlcmF0b3IgaXMgZmluaXNoZWQsIHNvIGZvcmdldCBpdCBhbmQgY29udGludWUgd2l0aFxuICAgIC8vIHRoZSBvdXRlciBnZW5lcmF0b3IuXG4gICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7XG4gICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gIH1cblxuICAvLyBEZWZpbmUgR2VuZXJhdG9yLnByb3RvdHlwZS57bmV4dCx0aHJvdyxyZXR1cm59IGluIHRlcm1zIG9mIHRoZVxuICAvLyB1bmlmaWVkIC5faW52b2tlIGhlbHBlciBtZXRob2QuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCk7XG5cbiAgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpO1xuXG4gIC8vIEEgR2VuZXJhdG9yIHNob3VsZCBhbHdheXMgcmV0dXJuIGl0c2VsZiBhcyB0aGUgaXRlcmF0b3Igb2JqZWN0IHdoZW4gdGhlXG4gIC8vIEBAaXRlcmF0b3IgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGl0LiBTb21lIGJyb3dzZXJzXCcgaW1wbGVtZW50YXRpb25zIG9mIHRoZVxuICAvLyBpdGVyYXRvciBwcm90b3R5cGUgY2hhaW4gaW5jb3JyZWN0bHkgaW1wbGVtZW50IHRoaXMsIGNhdXNpbmcgdGhlIEdlbmVyYXRvclxuICAvLyBvYmplY3QgdG8gbm90IGJlIHJldHVybmVkIGZyb20gdGhpcyBjYWxsLiBUaGlzIGVuc3VyZXMgdGhhdCBkb2VzblwndCBoYXBwZW4uXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvaXNzdWVzLzI3NCBmb3IgbW9yZSBkZXRhaWxzLlxuICBHcFtpdGVyYXRvclN5bWJvbF0gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjtcbiAgfTtcblxuICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge1xuICAgIHZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07XG5cbiAgICBpZiAoMSBpbiBsb2NzKSB7XG4gICAgICBlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV07XG4gICAgfVxuXG4gICAgaWYgKDIgaW4gbG9jcykge1xuICAgICAgZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl07XG4gICAgICBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM107XG4gICAgfVxuXG4gICAgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge1xuICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O1xuICAgIHJlY29yZC50eXBlID0gIm5vcm1hbCI7XG4gICAgZGVsZXRlIHJlY29yZC5hcmc7XG4gICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHtcbiAgICAvLyBUaGUgcm9vdCBlbnRyeSBvYmplY3QgKGVmZmVjdGl2ZWx5IGEgdHJ5IHN0YXRlbWVudCB3aXRob3V0IGEgY2F0Y2hcbiAgICAvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tXG4gICAgLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LlxuICAgIHRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dO1xuICAgIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKTtcbiAgICB0aGlzLnJlc2V0KHRydWUpO1xuICB9XG5cbiAgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICBrZXlzLnB1c2goa2V5KTtcbiAgICB9XG4gICAga2V5cy5yZXZlcnNlKCk7XG5cbiAgICAvLyBSYXRoZXIgdGhhbiByZXR1cm5pbmcgYW4gb2JqZWN0IHdpdGggYSBuZXh0IG1ldGhvZCwgd2Uga2VlcFxuICAgIC8vIHRoaW5ncyBzaW1wbGUgYW5kIHJldHVybiB0aGUgbmV4dCBmdW5jdGlvbiBpdHNlbGYuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICB3aGlsZSAoa2V5cy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGtleSA9IGtleXMucG9wKCk7XG4gICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgbmV4dC52YWx1ZSA9IGtleTtcbiAgICAgICAgICBuZXh0LmRvbmUgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUbyBhdm9pZCBjcmVhdGluZyBhbiBhZGRpdGlvbmFsIG9iamVjdCwgd2UganVzdCBoYW5nIHRoZSAudmFsdWVcbiAgICAgIC8vIGFuZCAuZG9uZSBwcm9wZXJ0aWVzIG9mZiB0aGUgbmV4dCBmdW5jdGlvbiBvYmplY3QgaXRzZWxmLiBUaGlzXG4gICAgICAvLyBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgbWluaWZpZXIgd2lsbCBub3QgYW5vbnltaXplIHRoZSBmdW5jdGlvbi5cbiAgICAgIG5leHQuZG9uZSA9IHRydWU7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9O1xuICB9O1xuXG4gIGZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge1xuICAgIGlmIChpdGVyYWJsZSkge1xuICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdO1xuICAgICAgaWYgKGl0ZXJhdG9yTWV0aG9kKSB7XG4gICAgICAgIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBpdGVyYWJsZS5uZXh0ID09PSAiZnVuY3Rpb24iKSB7XG4gICAgICAgIHJldHVybiBpdGVyYWJsZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7XG4gICAgICAgIHZhciBpID0gLTEsIG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgICAgICAgIHdoaWxlICgrK2kgPCBpdGVyYWJsZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHtcbiAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldO1xuICAgICAgICAgICAgICBuZXh0LmRvbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmV4dC52YWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBuZXh0LmRvbmUgPSB0cnVlO1xuXG4gICAgICAgICAgcmV0dXJuIG5leHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG5leHQubmV4dCA9IG5leHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIGFuIGl0ZXJhdG9yIHdpdGggbm8gdmFsdWVzLlxuICAgIHJldHVybiB7IG5leHQ6IGRvbmVSZXN1bHQgfTtcbiAgfVxuICBleHBvcnRzLnZhbHVlcyA9IHZhbHVlcztcblxuICBmdW5jdGlvbiBkb25lUmVzdWx0KCkge1xuICAgIHJldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6IHRydWUgfTtcbiAgfVxuXG4gIENvbnRleHQucHJvdG90eXBlID0ge1xuICAgIGNvbnN0cnVjdG9yOiBDb250ZXh0LFxuXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKHNraXBUZW1wUmVzZXQpIHtcbiAgICAgIHRoaXMucHJldiA9IDA7XG4gICAgICB0aGlzLm5leHQgPSAwO1xuICAgICAgLy8gUmVzZXR0aW5nIGNvbnRleHQuX3NlbnQgZm9yIGxlZ2FjeSBzdXBwb3J0IG9mIEJhYmVsXCdzXG4gICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLlxuICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgICAgdGhpcy5kZWxlZ2F0ZSA9IG51bGw7XG5cbiAgICAgIHRoaXMubWV0aG9kID0gIm5leHQiO1xuICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpO1xuXG4gICAgICBpZiAoIXNraXBUZW1wUmVzZXQpIHtcbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7XG4gICAgICAgICAgLy8gTm90IHN1cmUgYWJvdXQgdGhlIG9wdGltYWwgb3JkZXIgb2YgdGhlc2UgY29uZGl0aW9uczpcbiAgICAgICAgICBpZiAobmFtZS5jaGFyQXQoMCkgPT09ICJ0IiAmJlxuICAgICAgICAgICAgICBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJlxuICAgICAgICAgICAgICAhaXNOYU4oK25hbWUuc2xpY2UoMSkpKSB7XG4gICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG5cbiAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07XG4gICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uO1xuICAgICAgaWYgKHJvb3RSZWNvcmQudHlwZSA9PT0gInRocm93Iikge1xuICAgICAgICB0aHJvdyByb290UmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMucnZhbDtcbiAgICB9LFxuXG4gICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xuICAgICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgICB0aHJvdyBleGNlcHRpb247XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge1xuICAgICAgICByZWNvcmQudHlwZSA9ICJ0aHJvdyI7XG4gICAgICAgIHJlY29yZC5hcmcgPSBleGNlcHRpb247XG4gICAgICAgIGNvbnRleHQubmV4dCA9IGxvYztcblxuICAgICAgICBpZiAoY2F1Z2h0KSB7XG4gICAgICAgICAgLy8gSWYgdGhlIGRpc3BhdGNoZWQgZXhjZXB0aW9uIHdhcyBjYXVnaHQgYnkgYSBjYXRjaCBibG9jayxcbiAgICAgICAgICAvLyB0aGVuIGxldCB0aGF0IGNhdGNoIGJsb2NrIGhhbmRsZSB0aGUgZXhjZXB0aW9uIG5vcm1hbGx5LlxuICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gIm5leHQiO1xuICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICEhIGNhdWdodDtcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO1xuXG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290Iikge1xuICAgICAgICAgIC8vIEV4Y2VwdGlvbiB0aHJvd24gb3V0c2lkZSBvZiBhbnkgdHJ5IGJsb2NrIHRoYXQgY291bGQgaGFuZGxlXG4gICAgICAgICAgLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvXG4gICAgICAgICAgLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAgICByZXR1cm4gaGFuZGxlKCJlbmQiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7XG4gICAgICAgICAgdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpO1xuICAgICAgICAgIHZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7XG5cbiAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhdGNoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZpbmFsbHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhYnJ1cHQ6IGZ1bmN0aW9uKHR5cGUsIGFyZykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmXG4gICAgICAgICAgICBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJlxuICAgICAgICAgICAgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykge1xuICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZmluYWxseUVudHJ5ICYmXG4gICAgICAgICAgKHR5cGUgPT09ICJicmVhayIgfHxcbiAgICAgICAgICAgdHlwZSA9PT0gImNvbnRpbnVlIikgJiZcbiAgICAgICAgICBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJlxuICAgICAgICAgIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYykge1xuICAgICAgICAvLyBJZ25vcmUgdGhlIGZpbmFsbHkgZW50cnkgaWYgY29udHJvbCBpcyBub3QganVtcGluZyB0byBhXG4gICAgICAgIC8vIGxvY2F0aW9uIG91dHNpZGUgdGhlIHRyeS9jYXRjaCBibG9jay5cbiAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307XG4gICAgICByZWNvcmQudHlwZSA9IHR5cGU7XG4gICAgICByZWNvcmQuYXJnID0gYXJnO1xuXG4gICAgICBpZiAoZmluYWxseUVudHJ5KSB7XG4gICAgICAgIHRoaXMubWV0aG9kID0gIm5leHQiO1xuICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYztcbiAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7XG4gICAgfSxcblxuICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZWNvcmQsIGFmdGVyTG9jKSB7XG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHtcbiAgICAgICAgdGhyb3cgcmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgaWYgKHJlY29yZC50eXBlID09PSAiYnJlYWsiIHx8XG4gICAgICAgICAgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHtcbiAgICAgICAgdGhpcy5uZXh0ID0gcmVjb3JkLmFyZztcbiAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJyZXR1cm4iKSB7XG4gICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgdGhpcy5tZXRob2QgPSAicmV0dXJuIjtcbiAgICAgICAgdGhpcy5uZXh0ID0gImVuZCI7XG4gICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykge1xuICAgICAgICB0aGlzLm5leHQgPSBhZnRlckxvYztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfSxcblxuICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7XG4gICAgICAgICAgdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7XG4gICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7XG4gICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgImNhdGNoIjogZnVuY3Rpb24odHJ5TG9jKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtcbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7XG4gICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247XG4gICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7XG4gICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZztcbiAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhyb3duO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBjb250ZXh0LmNhdGNoIG1ldGhvZCBtdXN0IG9ubHkgYmUgY2FsbGVkIHdpdGggYSBsb2NhdGlvblxuICAgICAgLy8gYXJndW1lbnQgdGhhdCBjb3JyZXNwb25kcyB0byBhIGtub3duIGNhdGNoIGJsb2NrLlxuICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKTtcbiAgICB9LFxuXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLFxuICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLFxuICAgICAgICBuZXh0TG9jOiBuZXh0TG9jXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5tZXRob2QgPT09ICJuZXh0Iikge1xuICAgICAgICAvLyBEZWxpYmVyYXRlbHkgZm9yZ2V0IHRoZSBsYXN0IHNlbnQgdmFsdWUgc28gdGhhdCB3ZSBkb25cJ3RcbiAgICAgICAgLy8gYWNjaWRlbnRhbGx5IHBhc3MgaXQgb24gdG8gdGhlIGRlbGVnYXRlLlxuICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfVxuICB9O1xuXG4gIC8vIFJlZ2FyZGxlc3Mgb2Ygd2hldGhlciB0aGlzIHNjcmlwdCBpcyBleGVjdXRpbmcgYXMgYSBDb21tb25KUyBtb2R1bGVcbiAgLy8gb3Igbm90LCByZXR1cm4gdGhlIHJ1bnRpbWUgb2JqZWN0IHNvIHRoYXQgd2UgY2FuIGRlY2xhcmUgdGhlIHZhcmlhYmxlXG4gIC8vIHJlZ2VuZXJhdG9yUnVudGltZSBpbiB0aGUgb3V0ZXIgc2NvcGUsIHdoaWNoIGFsbG93cyB0aGlzIG1vZHVsZSB0byBiZVxuICAvLyBpbmplY3RlZCBlYXNpbHkgYnkgYGJpbi9yZWdlbmVyYXRvciAtLWluY2x1ZGUtcnVudGltZSBzY3JpcHQuanNgLlxuICByZXR1cm4gZXhwb3J0cztcblxufShcbiAgLy8gSWYgdGhpcyBzY3JpcHQgaXMgZXhlY3V0aW5nIGFzIGEgQ29tbW9uSlMgbW9kdWxlLCB1c2UgbW9kdWxlLmV4cG9ydHNcbiAgLy8gYXMgdGhlIHJlZ2VuZXJhdG9yUnVudGltZSBuYW1lc3BhY2UuIE90aGVyd2lzZSBjcmVhdGUgYSBuZXcgZW1wdHlcbiAgLy8gb2JqZWN0LiBFaXRoZXIgd2F5LCB0aGUgcmVzdWx0aW5nIG9iamVjdCB3aWxsIGJlIHVzZWQgdG8gaW5pdGlhbGl6ZVxuICAvLyB0aGUgcmVnZW5lcmF0b3JSdW50aW1lIHZhcmlhYmxlIGF0IHRoZSB0b3Agb2YgdGhpcyBmaWxlLlxuICAgdHJ1ZSA/IG1vZHVsZS5leHBvcnRzIDogdW5kZWZpbmVkXG4pKTtcblxudHJ5IHtcbiAgcmVnZW5lcmF0b3JSdW50aW1lID0gcnVudGltZTtcbn0gY2F0Y2ggKGFjY2lkZW50YWxTdHJpY3RNb2RlKSB7XG4gIC8vIFRoaXMgbW9kdWxlIHNob3VsZCBub3QgYmUgcnVubmluZyBpbiBzdHJpY3QgbW9kZSwgc28gdGhlIGFib3ZlXG4gIC8vIGFzc2lnbm1lbnQgc2hvdWxkIGFsd2F5cyB3b3JrIHVubGVzcyBzb21ldGhpbmcgaXMgbWlzY29uZmlndXJlZC4gSnVzdFxuICAvLyBpbiBjYXNlIHJ1bnRpbWUuanMgYWNjaWRlbnRhbGx5IHJ1bnMgaW4gc3RyaWN0IG1vZGUsIHdlIGNhbiBlc2NhcGVcbiAgLy8gc3RyaWN0IG1vZGUgdXNpbmcgYSBnbG9iYWwgRnVuY3Rpb24gY2FsbC4gVGhpcyBjb3VsZCBjb25jZWl2YWJseSBmYWlsXG4gIC8vIGlmIGEgQ29udGVudCBTZWN1cml0eSBQb2xpY3kgZm9yYmlkcyB1c2luZyBGdW5jdGlvbiwgYnV0IGluIHRoYXQgY2FzZVxuICAvLyB0aGUgcHJvcGVyIHNvbHV0aW9uIGlzIHRvIGZpeCB0aGUgYWNjaWRlbnRhbCBzdHJpY3QgbW9kZSBwcm9ibGVtLiBJZlxuICAvLyB5b3VcJ3ZlIG1pc2NvbmZpZ3VyZWQgeW91ciBidW5kbGVyIHRvIGZvcmNlIHN0cmljdCBtb2RlIGFuZCBhcHBsaWVkIGFcbiAgLy8gQ1NQIHRvIGZvcmJpZCBGdW5jdGlvbiwgYW5kIHlvdVwncmUgbm90IHdpbGxpbmcgdG8gZml4IGVpdGhlciBvZiB0aG9zZVxuICAvLyBwcm9ibGVtcywgcGxlYXNlIGRldGFpbCB5b3VyIHVuaXF1ZSBwcmVkaWNhbWVudCBpbiBhIEdpdEh1YiBpc3N1ZS5cbiAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUpO1xufVxuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9yZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoImNvbnN0IGNyZWF0ZUpvYiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vY3JlYXRlSm9iICovIDU0KTtcbmNvbnN0IHsgbG9nIH0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3V0aWxzL2xvZyAqLyAyMSk7XG5jb25zdCBnZXRJZCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbHMvZ2V0SWQgKi8gMjIpO1xuY29uc3QgcGFyc2VQcm9ncmVzcyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbHMvcGFyc2VQcm9ncmVzcyAqLyA1NSk7XG5jb25zdCByZXNvbHZlUGF0aHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3V0aWxzL3Jlc29sdmVQYXRocyAqLyA1Nik7XG5jb25zdCBnZXRUcmFuc2ZlcmFibGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi91dGlscy9nZXRUcmFuc2ZlcmFibGVzICovIDU5KTtcbmNvbnN0IHtcbiAgZGVmYXVsdE9wdGlvbnMsXG4gIHNwYXduV29ya2VyLFxuICBvbk1lc3NhZ2UsXG4gIGZldGNoRmlsZSxcbn0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3dvcmtlci9ub2RlICovIDYwKTtcblxubGV0IHdvcmtlckNvdW50ZXIgPSAwO1xuXG5tb2R1bGUuZXhwb3J0cyA9IChfb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IGlkID0gZ2V0SWQoJ1dvcmtlcicsIHdvcmtlckNvdW50ZXIpO1xuICBjb25zdCB7XG4gICAgbG9nZ2VyLFxuICAgIHByb2dyZXNzLFxuICAgIC4uLm9wdGlvbnNcbiAgfSA9IHJlc29sdmVQYXRocyh7XG4gICAgLi4uZGVmYXVsdE9wdGlvbnMsXG4gICAgLi4uX29wdGlvbnMsXG4gIH0pO1xuICBjb25zdCByZXNvbHZlcyA9IHt9O1xuICBjb25zdCByZWplY3RzID0ge307XG4gIGxldCB3b3JrZXIgPSBzcGF3bldvcmtlcihvcHRpb25zKTtcblxuICB3b3JrZXJDb3VudGVyICs9IDE7XG5cbiAgY29uc3Qgc2V0UmVzb2x2ZSA9IChhY3Rpb24sIHJlcykgPT4ge1xuICAgIHJlc29sdmVzW2FjdGlvbl0gPSByZXM7XG4gIH07XG5cbiAgY29uc3Qgc2V0UmVqZWN0ID0gKGFjdGlvbiwgcmVqKSA9PiB7XG4gICAgcmVqZWN0c1thY3Rpb25dID0gcmVqO1xuICB9O1xuXG4gIGNvbnN0IHN0YXJ0Sm9iID0gKHsgaWQ6IGpvYklkLCBhY3Rpb24sIHBheWxvYWQgfSkgPT4gKFxuICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHBhY2tldCA9IHtcbiAgICAgICAgd29ya2VySWQ6IGlkLFxuICAgICAgICBqb2JJZCxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgfTtcbiAgICAgIGxvZyhgWyR7aWR9XTogU3RhcnQgJHtqb2JJZH0sIGFjdGlvbj0ke2FjdGlvbn1gKTtcbiAgICAgIHNldFJlc29sdmUoYWN0aW9uLCByZXNvbHZlKTtcbiAgICAgIHNldFJlamVjdChhY3Rpb24sIHJlamVjdCk7XG4gICAgICAvKlxuICAgICAgICogQnkgdXNpbmcgVHJhbnNmZXJhYmxlIGluIHBvc3RNZXNzYWdlLCB3ZSBhcmUgYWJsZVxuICAgICAgICogdG8gc2VuZCBsYXJnZSBmaWxlcyB0byB3b3JrZXJcbiAgICAgICAqIEByZWY6IGh0dHBzOi8vZ2l0aHViLmNvbS9mZm1wZWdqcy9mZm1wZWcuanMvaXNzdWVzLzgjaXNzdWVjb21tZW50LTU3MjIzMDEyOFxuICAgICAgICovXG4gICAgICB3b3JrZXIucG9zdE1lc3NhZ2UocGFja2V0LCBnZXRUcmFuc2ZlcmFibGVzKHBhY2tldCkpO1xuICAgIH0pXG4gICk7XG5cbiAgY29uc3QgbG9hZCA9IChqb2JJZCkgPT4gKFxuICAgIHN0YXJ0Sm9iKGNyZWF0ZUpvYih7XG4gICAgICBpZDogam9iSWQsIGFjdGlvbjogJ2xvYWQnLCBwYXlsb2FkOiB7IG9wdGlvbnMgfSxcbiAgICB9KSlcbiAgKTtcblxuICBjb25zdCB3cml0ZSA9IGFzeW5jIChwYXRoLCBkYXRhLCBqb2JJZCkgPT4gKFxuICAgIHN0YXJ0Sm9iKGNyZWF0ZUpvYih7XG4gICAgICBpZDogam9iSWQsXG4gICAgICBhY3Rpb246ICdGUycsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIG1ldGhvZDogJ3dyaXRlRmlsZScsXG4gICAgICAgIGFyZ3M6IFtwYXRoLCBhd2FpdCBmZXRjaEZpbGUoZGF0YSldLFxuICAgICAgfSxcbiAgICB9KSlcbiAgKTtcblxuICBjb25zdCB3cml0ZVRleHQgPSAocGF0aCwgdGV4dCwgam9iSWQpID0+IChcbiAgICBzdGFydEpvYihjcmVhdGVKb2Ioe1xuICAgICAgaWQ6IGpvYklkLFxuICAgICAgYWN0aW9uOiAnRlMnLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICBtZXRob2Q6ICd3cml0ZUZpbGUnLFxuICAgICAgICBhcmdzOiBbcGF0aCwgdGV4dF0sXG4gICAgICB9LFxuICAgIH0pKVxuICApO1xuXG4gIGNvbnN0IHJlYWQgPSAocGF0aCwgam9iSWQpID0+IChcbiAgICBzdGFydEpvYihjcmVhdGVKb2Ioe1xuICAgICAgaWQ6IGpvYklkLFxuICAgICAgYWN0aW9uOiAnRlMnLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICBtZXRob2Q6ICdyZWFkRmlsZScsXG4gICAgICAgIGFyZ3M6IFtwYXRoXSxcbiAgICAgIH0sXG4gICAgfSkpXG4gICk7XG5cbiAgY29uc3QgcmVtb3ZlID0gKHBhdGgsIGpvYklkKSA9PiAoXG4gICAgc3RhcnRKb2IoY3JlYXRlSm9iKHtcbiAgICAgIGlkOiBqb2JJZCxcbiAgICAgIGFjdGlvbjogJ0ZTJyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgbWV0aG9kOiAndW5saW5rJyxcbiAgICAgICAgYXJnczogW3BhdGhdLFxuICAgICAgfSxcbiAgICB9KSlcbiAgKTtcblxuICBjb25zdCBydW4gPSAoYXJncywgam9iSWQpID0+IChcbiAgICBzdGFydEpvYihjcmVhdGVKb2Ioe1xuICAgICAgaWQ6IGpvYklkLFxuICAgICAgYWN0aW9uOiAncnVuJyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgYXJncyxcbiAgICAgIH0sXG4gICAgfSkpXG4gICk7XG5cbiAgY29uc3QgbHMgPSAocGF0aCwgam9iSWQpID0+IChcbiAgICBzdGFydEpvYihjcmVhdGVKb2Ioe1xuICAgICAgaWQ6IGpvYklkLFxuICAgICAgYWN0aW9uOiAnRlMnLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICBtZXRob2Q6ICdyZWFkZGlyJyxcbiAgICAgICAgYXJnczogW3BhdGhdLFxuICAgICAgfSxcbiAgICB9KSlcbiAgKTtcblxuICBjb25zdCB0cmFuc2NvZGUgPSAoaW5wdXQsIG91dHB1dCwgb3B0cyA9ICcnLCBqb2JJZCkgPT4gKFxuICAgIHJ1bihcbiAgICAgIGAtaSAke2lucHV0fSAke29wdHN9ICR7b3V0cHV0fWAsXG4gICAgICBqb2JJZCxcbiAgICApXG4gICk7XG5cbiAgY29uc3QgdHJpbSA9IChpbnB1dCwgb3V0cHV0LCBmcm9tLCB0bywgb3B0cyA9ICcnLCBqb2JJZCkgPT4gKFxuICAgIHJ1bihcbiAgICAgIGAtaSAke2lucHV0fSAtc3MgJHtmcm9tfSAtdG8gJHt0b30gJHtvcHRzfSAke291dHB1dH1gLFxuICAgICAgam9iSWQsXG4gICAgKVxuICApO1xuXG4gIGNvbnN0IGNvbmNhdERlbXV4ZXIgPSBhc3luYyAoaW5wdXQsIG91dHB1dCwgb3B0cyA9ICcnLCBqb2JJZCkgPT4ge1xuICAgIGNvbnN0IHRleHQgPSBpbnB1dC5yZWR1Y2UoKGFjYywgcGF0aCkgPT4gYCR7YWNjfVxcbmZpbGUgJHtwYXRofWAsICcnKTtcbiAgICBhd2FpdCB3cml0ZVRleHQoJ2NvbmNhdF9saXN0LnR4dCcsIHRleHQpO1xuICAgIHJldHVybiBydW4oYC1mIGNvbmNhdCAtc2FmZSAwIC1pIGNvbmNhdF9saXN0LnR4dCAke29wdHN9ICR7b3V0cHV0fWAsIGpvYklkKTtcbiAgfTtcblxuICBjb25zdCB0ZXJtaW5hdGUgPSBhc3luYyAoam9iSWQpID0+IHtcbiAgICBpZiAod29ya2VyICE9PSBudWxsKSB7XG4gICAgICBhd2FpdCBzdGFydEpvYihjcmVhdGVKb2Ioe1xuICAgICAgICBpZDogam9iSWQsXG4gICAgICAgIGFjdGlvbjogJ3Rlcm1pbmF0ZScsXG4gICAgICB9KSk7XG4gICAgICB3b3JrZXIudGVybWluYXRlKCk7XG4gICAgICB3b3JrZXIgPSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH07XG5cbiAgb25NZXNzYWdlKHdvcmtlciwgKHtcbiAgICB3b3JrZXJJZCwgam9iSWQsIGFjdGlvbiwgc3RhdHVzLCBwYXlsb2FkLFxuICB9KSA9PiB7XG4gICAgaWYgKHN0YXR1cyA9PT0gJ3Jlc29sdmUnKSB7XG4gICAgICBjb25zdCB7IG1lc3NhZ2UsIGRhdGEgfSA9IHBheWxvYWQ7XG4gICAgICBsb2coYFske3dvcmtlcklkfV06IENvbXBsZXRlICR7am9iSWR9YCk7XG4gICAgICByZXNvbHZlc1thY3Rpb25dKHtcbiAgICAgICAgd29ya2VySWQsXG4gICAgICAgIGpvYklkLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBkYXRhLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdyZWplY3QnKSB7XG4gICAgICByZWplY3RzW2FjdGlvbl0ocGF5bG9hZCk7XG4gICAgICB0aHJvdyBFcnJvcihwYXlsb2FkKTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ3Byb2dyZXNzJykge1xuICAgICAgcGFyc2VQcm9ncmVzcyhwYXlsb2FkLCBwcm9ncmVzcyk7XG4gICAgICBsb2dnZXIocGF5bG9hZCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIGlkLFxuICAgIHdvcmtlcixcbiAgICBzZXRSZXNvbHZlLFxuICAgIHNldFJlamVjdCxcbiAgICBsb2FkLFxuICAgIHdyaXRlLFxuICAgIHdyaXRlVGV4dCxcbiAgICByZWFkLFxuICAgIHJlbW92ZSxcbiAgICBscyxcbiAgICBydW4sXG4gICAgdHJhbnNjb2RlLFxuICAgIHRyaW0sXG4gICAgY29uY2F0RGVtdXhlcixcbiAgICB0ZXJtaW5hdGUsXG4gIH07XG59O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AZmZtcGVnL2ZmbXBlZy9zcmMvY3JlYXRlV29ya2VyLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCJjb25zdCBnZXRJZCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbHMvZ2V0SWQgKi8gMjIpO1xuXG5sZXQgam9iQ291bnRlciA9IDA7XG5cbm1vZHVsZS5leHBvcnRzID0gKHtcbiAgaWQ6IF9pZCxcbiAgYWN0aW9uLFxuICBwYXlsb2FkID0ge30sXG59KSA9PiB7XG4gIGxldCBpZCA9IF9pZDtcbiAgaWYgKHR5cGVvZiBpZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZCA9IGdldElkKCdKb2InLCBqb2JDb3VudGVyKTtcbiAgICBqb2JDb3VudGVyICs9IDE7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGlkLFxuICAgIGFjdGlvbixcbiAgICBwYXlsb2FkLFxuICB9O1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZmbXBlZy9mZm1wZWcvc3JjL2NyZWF0ZUpvYi5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoImxldCBkdXJhdGlvbiA9IDA7XG5cbmNvbnN0IHRzMnNlYyA9ICh0cykgPT4ge1xuICBjb25zdCBbaCwgbSwgc10gPSB0cy5zcGxpdCgnOicpO1xuICByZXR1cm4gKHBhcnNlRmxvYXQoaCkgKiA2MCAqIDYwKSArIChwYXJzZUZsb2F0KG0pICogNjApICsgcGFyc2VGbG9hdChzKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gKHsgbWVzc2FnZSB9LCBwcm9ncmVzcykgPT4ge1xuICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKG1lc3NhZ2Uuc3RhcnRzV2l0aCgnICBEdXJhdGlvbicpKSB7XG4gICAgICBjb25zdCB0cyA9IG1lc3NhZ2Uuc3BsaXQoJywgJylbMF0uc3BsaXQoJzogJylbMV07XG4gICAgICBjb25zdCBkID0gdHMyc2VjKHRzKTtcbiAgICAgIGlmIChkdXJhdGlvbiA9PT0gMCB8fCBkdXJhdGlvbiA+IGQpIHtcbiAgICAgICAgZHVyYXRpb24gPSBkO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobWVzc2FnZS5zdGFydHNXaXRoKCdmcmFtZScpKSB7XG4gICAgICBjb25zdCB0cyA9IG1lc3NhZ2Uuc3BsaXQoJ3RpbWU9JylbMV0uc3BsaXQoJyAnKVswXTtcbiAgICAgIGNvbnN0IHQgPSB0czJzZWModHMpO1xuICAgICAgcHJvZ3Jlc3MoeyByYXRpbzogdCAvIGR1cmF0aW9uIH0pO1xuICAgIH0gZWxzZSBpZiAobWVzc2FnZS5zdGFydHNXaXRoKCd2aWRlbzonKSkge1xuICAgICAgcHJvZ3Jlc3MoeyByYXRpbzogMSB9KTtcbiAgICB9XG4gIH1cbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy91dGlscy9wYXJzZVByb2dyZXNzLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCJjb25zdCBpc0Jyb3dzZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2dldEVudmlyb25tZW50ICovIDU3KSgndHlwZScpID09PSAnYnJvd3Nlcic7XG5jb25zdCByZXNvbHZlVVJMID0gaXNCcm93c2VyID8gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgcmVzb2x2ZS11cmwgKi8gMTUpIDogcyA9PiBzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cbm1vZHVsZS5leHBvcnRzID0gKG9wdGlvbnMpID0+IHtcbiAgY29uc3Qgb3B0cyA9IHsgLi4ub3B0aW9ucyB9O1xuICBbJ2NvcmVQYXRoJywgJ3dvcmtlclBhdGgnXS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnNba2V5XSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIG9wdHNba2V5XSA9IHJlc29sdmVVUkwob3B0c1trZXldKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gb3B0cztcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy91dGlscy9yZXNvbHZlUGF0aHMuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoIi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzKSB7Y29uc3QgaXNFbGVjdHJvbiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIGlzLWVsZWN0cm9uICovIDU4KTtcblxubW9kdWxlLmV4cG9ydHMgPSAoa2V5KSA9PiB7XG4gIGNvbnN0IGVudiA9IHt9O1xuXG4gIGlmIChpc0VsZWN0cm9uKCkpIHtcbiAgICBlbnYudHlwZSA9ICdlbGVjdHJvbic7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHtcbiAgICBlbnYudHlwZSA9ICdicm93c2VyJztcbiAgfSBlbHNlIGlmICh0eXBlb2YgaW1wb3J0U2NyaXB0cyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGVudi50eXBlID0gJ3dlYndvcmtlcic7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHByb2Nlc3MgPT09ICdvYmplY3QnICYmIFwiZnVuY3Rpb25cIiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGVudi50eXBlID0gJ25vZGUnO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBrZXkgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIGVudjtcbiAgfVxuXG4gIHJldHVybiBlbnZba2V5XTtcbn07XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uLy4uLy4uLy4uL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyAxMSkpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZmbXBlZy9mZm1wZWcvc3JjL3V0aWxzL2dldEVudmlyb25tZW50LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCIvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24ocHJvY2Vzcykgey8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGVjdHJvbi9lbGVjdHJvbi9pc3N1ZXMvMjI4OFxuZnVuY3Rpb24gaXNFbGVjdHJvbigpIHtcbiAgICAvLyBSZW5kZXJlciBwcm9jZXNzXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cucHJvY2VzcyA9PT0gJ29iamVjdCcgJiYgd2luZG93LnByb2Nlc3MudHlwZSA9PT0gJ3JlbmRlcmVyJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBNYWluIHByb2Nlc3NcbiAgICBpZiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBwcm9jZXNzLnZlcnNpb25zID09PSAnb2JqZWN0JyAmJiAhIXByb2Nlc3MudmVyc2lvbnMuZWxlY3Ryb24pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gRGV0ZWN0IHRoZSB1c2VyIGFnZW50IHdoZW4gdGhlIGBub2RlSW50ZWdyYXRpb25gIG9wdGlvbiBpcyBzZXQgdG8gdHJ1ZVxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbmF2aWdhdG9yLnVzZXJBZ2VudCA9PT0gJ3N0cmluZycgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdFbGVjdHJvbicpID49IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGlzRWxlY3Ryb247XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyAxMSkpKVxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaXMtZWxlY3Ryb24vaW5kZXguanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCJtb2R1bGUuZXhwb3J0cyA9IChwYWNrZXQpID0+IHtcbiAgY29uc3QgdHJhbnNmZXJhYmxlcyA9IFtdO1xuICBjb25zdCBjaGVjayA9IChiKSA9PiB7XG4gICAgaWYgKGIgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgICB0cmFuc2ZlcmFibGVzLnB1c2goYi5idWZmZXIpO1xuICAgIH0gZWxzZSBpZiAoYiBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgICB0cmFuc2ZlcmFibGVzLnB1c2goYik7XG4gICAgfVxuICB9O1xuICBjb25zdCB7IHBheWxvYWQ6IHsgYXJncywgZGF0YSB9IH0gPSBwYWNrZXQ7XG4gIGNoZWNrKGRhdGEpO1xuICBpZiAoQXJyYXkuaXNBcnJheShhcmdzKSkge1xuICAgIGFyZ3MuZm9yRWFjaCgoYXJnKSA9PiBjaGVjayhhcmcpKTtcbiAgfVxuICByZXR1cm4gdHJhbnNmZXJhYmxlcztcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy91dGlscy9nZXRUcmFuc2ZlcmFibGVzLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCIvKipcbiAqXG4gKiBUZXNzZXJhY3QgV29ya2VyIGFkYXB0ZXIgZm9yIGJyb3dzZXJcbiAqXG4gKiBAZmlsZW92ZXJ2aWV3IFRlc3NlcmFjdCBXb3JrZXIgYWRhcHRlciBmb3IgYnJvd3NlclxuICogQGF1dGhvciBLZXZpbiBLd29rIDxhbnRpbWF0dGVyMTVAZ21haWwuY29tPlxuICogQGF1dGhvciBHdWlsbGVybW8gV2Vic3RlciA8Z3VpQG1pdC5lZHU+XG4gKiBAYXV0aG9yIEplcm9tZSBXdSA8amVyb21ld3VzQGdtYWlsLmNvbT5cbiAqL1xuY29uc3QgZGVmYXVsdE9wdGlvbnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2RlZmF1bHRPcHRpb25zICovIDYxKTtcbmNvbnN0IHNwYXduV29ya2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9zcGF3bldvcmtlciAqLyA2NCk7XG5jb25zdCBvbk1lc3NhZ2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL29uTWVzc2FnZSAqLyA2NSk7XG5jb25zdCBmZXRjaEZpbGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2ZldGNoRmlsZSAqLyA2Nik7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBkZWZhdWx0T3B0aW9ucyxcbiAgc3Bhd25Xb3JrZXIsXG4gIG9uTWVzc2FnZSxcbiAgZmV0Y2hGaWxlLFxufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZmbXBlZy9mZm1wZWcvc3JjL3dvcmtlci9icm93c2VyL2luZGV4LmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCIvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24ocHJvY2Vzcykge2NvbnN0IHJlc29sdmVVUkwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISByZXNvbHZlLXVybCAqLyAxNSk7XG5jb25zdCB7IHZlcnNpb24sIGRlcGVuZGVuY2llcyB9ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vLi4vLi4vcGFja2FnZS5qc29uICovIDYyKTtcbmNvbnN0IGRlZmF1bHRPcHRpb25zID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vLi4vY29uc3RhbnRzL2RlZmF1bHRPcHRpb25zICovIDYzKTtcblxuLypcbiAqIERlZmF1bHQgb3B0aW9ucyBmb3IgYnJvd3NlciB3b3JrZXJcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIC4uLmRlZmF1bHRPcHRpb25zLFxuICB3b3JrZXJQYXRoOiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MuZW52LkZGTVBFR19FTlYgPT09ICdkZXZlbG9wbWVudCcpXG4gICAgPyByZXNvbHZlVVJMKGAvZGlzdC93b3JrZXIuZGV2LmpzP25vY2FjaGU9JHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgzKX1gKVxuICAgIDogYGh0dHBzOi8vdW5wa2cuY29tL0BmZm1wZWcvZmZtcGVnQHYke3ZlcnNpb259L2Rpc3Qvd29ya2VyLm1pbi5qc2AsXG4gIGNvcmVQYXRoOiBgaHR0cHM6Ly91bnBrZy5jb20vQGZmbXBlZy9jb3JlQHYke2RlcGVuZGVuY2llc1snQGZmbXBlZy9jb3JlJ10uc3Vic3RyaW5nKDEpfS9mZm1wZWctY29yZS5qc2AsXG4gIHdvcmtlckJsb2JVUkw6IHRydWUsXG59O1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwodGhpcywgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi8uLi8uLi8uLi8uLi9wcm9jZXNzL2Jyb3dzZXIuanMgKi8gMTEpKSlcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy93b3JrZXIvYnJvd3Nlci9kZWZhdWx0T3B0aW9ucy5qcz8iKX0sZnVuY3Rpb24obW9kdWxlKXtldmFsKCdtb2R1bGUuZXhwb3J0cyA9IEpTT04ucGFyc2UoIntcXCJfYXJnc1xcIjpbW1xcIkBmZm1wZWcvZmZtcGVnQDAuNi4xXFwiLFxcIi9hcHAvdXNlci1zY3JpcHQtYnVpbGRcXCJdXSxcXCJfZnJvbVxcIjpcXCJAZmZtcGVnL2ZmbXBlZ0AwLjYuMVxcIixcXCJfaWRcXCI6XFwiQGZmbXBlZy9mZm1wZWdAMC42LjFcXCIsXFwiX2luQnVuZGxlXFwiOmZhbHNlLFxcIl9pbnRlZ3JpdHlcXCI6XFwic2hhNTEyLUxCKzFaa0RnNWVISDd2RGp3NllnZXBYMVc5OWNOQm1CUGlBV3dQbHR4NDAwQkliblJDd3gxcDE3NVd3QXJDN0JPSitHdnNXTEZkbEp2dE5UWVNZbjJBPT1cXCIsXFwiX2xvY2F0aW9uXFwiOlxcIi9AZmZtcGVnL2ZmbXBlZ1xcIixcXCJfcGhhbnRvbUNoaWxkcmVuXFwiOnt9LFxcIl9yZXF1ZXN0ZWRcXCI6e1xcInR5cGVcXCI6XFwidmVyc2lvblxcIixcXCJyZWdpc3RyeVxcIjp0cnVlLFxcInJhd1xcIjpcXCJAZmZtcGVnL2ZmbXBlZ0AwLjYuMVxcIixcXCJuYW1lXFwiOlxcIkBmZm1wZWcvZmZtcGVnXFwiLFxcImVzY2FwZWROYW1lXFwiOlxcIkBmZm1wZWclMmZmZm1wZWdcXCIsXFwic2NvcGVcXCI6XFwiQGZmbXBlZ1xcIixcXCJyYXdTcGVjXFwiOlxcIjAuNi4xXFwiLFxcInNhdmVTcGVjXFwiOm51bGwsXFwiZmV0Y2hTcGVjXFwiOlxcIjAuNi4xXFwifSxcXCJfcmVxdWlyZWRCeVxcIjpbXFwiL1xcIl0sXFwiX3Jlc29sdmVkXFwiOlxcImh0dHBzOi8vcmVnaXN0cnkubnBtanMub3JnL0BmZm1wZWcvZmZtcGVnLy0vZmZtcGVnLTAuNi4xLnRnelxcIixcXCJfc3BlY1xcIjpcXCIwLjYuMVxcIixcXCJfd2hlcmVcXCI6XFwiL2FwcC91c2VyLXNjcmlwdC1idWlsZFxcIixcXCJhdXRob3JcXCI6e1xcIm5hbWVcXCI6XFwiSmVyb21lIFd1XFwiLFxcImVtYWlsXFwiOlxcImplcm9tZXd1c0BnbWFpbC5jb21cXCJ9LFxcImJyb3dzZXJcXCI6e1xcIi4vc3JjL3dvcmtlci9ub2RlL2luZGV4LmpzXFwiOlxcIi4vc3JjL3dvcmtlci9icm93c2VyL2luZGV4LmpzXFwifSxcXCJidWdzXFwiOntcXCJ1cmxcXCI6XFwiaHR0cHM6Ly9naXRodWIuY29tL2ZmbXBlZ2pzL2ZmbXBlZy5qcy9pc3N1ZXNcXCJ9LFxcImRlcGVuZGVuY2llc1xcIjp7XFwiQGZmbXBlZy9jb3JlXFwiOlxcIl4wLjYuMFxcIixcXCJpZGJcXCI6XFwiXjQuMC41XFwiLFxcImlzLWVsZWN0cm9uXFwiOlxcIl4yLjIuMFxcIixcXCJpcy11cmxcXCI6XFwiXjEuMi40XFwiLFxcIm5vZGUtZmV0Y2hcXCI6XFwiXjIuNi4wXFwiLFxcInJlZ2VuZXJhdG9yLXJ1bnRpbWVcXCI6XFwiXjAuMTMuM1xcIixcXCJyZXNvbHZlLXVybFxcIjpcXCJeMC4yLjFcXCJ9LFxcImRlc2NyaXB0aW9uXFwiOlxcIkZGbXBlZyBXZWJBc3NlbWJseSB2ZXJzaW9uXFwiLFxcImRldkRlcGVuZGVuY2llc1xcIjp7XFwiQGJhYmVsL2NvcmVcXCI6XFwiXjcuNi40XFwiLFxcIkBiYWJlbC9wcmVzZXQtZW52XFwiOlxcIl43LjYuM1xcIixcXCJiYWJlbC1sb2FkZXJcXCI6XFwiXjguMC42XFwiLFxcImNvcnNcXCI6XFwiXjIuOC41XFwiLFxcImVzbGludFxcIjpcXCJeNi4xLjBcXCIsXFwiZXNsaW50LWNvbmZpZy1haXJibmItYmFzZVxcIjpcXCJeMTQuMC4wXFwiLFxcImVzbGludC1wbHVnaW4taW1wb3J0XFwiOlxcIl4yLjE4LjJcXCIsXFwiZXhwZWN0LmpzXFwiOlxcIl4wLjMuMVxcIixcXCJleHByZXNzXFwiOlxcIl40LjE3LjFcXCIsXFwibW9jaGFcXCI6XFwiXjYuMi4yXFwiLFxcIm1vY2hhLWhlYWRsZXNzLWNocm9tZVxcIjpcXCJeMi4wLjNcXCIsXFwibnBtLXJ1bi1hbGxcXCI6XFwiXjQuMS41XFwiLFxcIm55Y1xcIjpcXCJeMTQuMS4xXFwiLFxcIndhaXQtb25cXCI6XFwiXjMuMy4wXFwiLFxcIndlYnBhY2tcXCI6XFwiXjQuNDEuMlxcIixcXCJ3ZWJwYWNrLWNsaVxcIjpcXCJeMy4zLjlcXCIsXFwid2VicGFjay1kZXYtbWlkZGxld2FyZVxcIjpcXCJeMy43LjJcXCJ9LFxcImRpcmVjdG9yaWVzXFwiOntcXCJleGFtcGxlXFwiOlxcImV4YW1wbGVzXFwifSxcXCJlbmdpbmVzXFwiOntcXCJub2RlXFwiOlxcIj49MTAuNS4wXFwifSxcXCJob21lcGFnZVxcIjpcXCJodHRwczovL2dpdGh1Yi5jb20vZmZtcGVnanMvZmZtcGVnLmpzI3JlYWRtZVxcIixcXCJrZXl3b3Jkc1xcIjpbXFwiZmZtcGVnXFwiLFxcIldlYkFzc2VtYmx5XFwiLFxcInZpZGVvXFwiXSxcXCJsaWNlbnNlXFwiOlxcIk1JVFxcIixcXCJtYWluXFwiOlxcInNyYy9pbmRleC5qc1xcIixcXCJuYW1lXFwiOlxcIkBmZm1wZWcvZmZtcGVnXFwiLFxcInJlcG9zaXRvcnlcXCI6e1xcInR5cGVcXCI6XFwiZ2l0XFwiLFxcInVybFxcIjpcXCJnaXQraHR0cHM6Ly9naXRodWIuY29tL2ZmbXBlZ2pzL2ZmbXBlZy5qcy5naXRcXCJ9LFxcInNjcmlwdHNcXCI6e1xcImJ1aWxkXFwiOlxcInJpbXJhZiBkaXN0ICYmIHdlYnBhY2sgLS1jb25maWcgc2NyaXB0cy93ZWJwYWNrLmNvbmZpZy5wcm9kLmpzXFwiLFxcImxpbnRcXCI6XFwiZXNsaW50IHNyY1xcIixcXCJwcmVwdWJsaXNoT25seVxcIjpcXCJucG0gcnVuIGJ1aWxkXFwiLFxcInN0YXJ0XFwiOlxcIm5vZGUgc2NyaXB0cy9zZXJ2ZXIuanNcXCIsXFwidGVzdFxcIjpcXCJucG0tcnVuLWFsbCAtcCAtciBzdGFydCB0ZXN0OmFsbFxcIixcXCJ0ZXN0OmFsbFxcIjpcXCJucG0tcnVuLWFsbCB3YWl0IHRlc3Q6YnJvd3NlcjpmZm1wZWcgdGVzdDpub2RlOmFsbFxcIixcXCJ0ZXN0OmJyb3dzZXJcXCI6XFwibW9jaGEtaGVhZGxlc3MtY2hyb21lIC1hIGluY29nbml0byAtYSBuby1zYW5kYm94IC1hIGRpc2FibGUtc2V0dWlkLXNhbmRib3ggLWEgZGlzYWJsZS1sb2dnaW5nIC10IDMwMDAwMFxcIixcXCJ0ZXN0OmJyb3dzZXI6ZmZtcGVnXFwiOlxcIm5wbSBydW4gdGVzdDpicm93c2VyIC0tIC1mIC4vdGVzdHMvZmZtcGVnLnRlc3QuaHRtbFxcIixcXCJ0ZXN0Om5vZGVcXCI6XFwibnljIG1vY2hhIC0tZXhpdCAtLWJhaWwgLS1yZXF1aXJlIC4vc2NyaXB0cy90ZXN0LWhlbHBlci5qc1xcIixcXCJ0ZXN0Om5vZGU6YWxsXFwiOlxcIm5wbSBydW4gdGVzdDpub2RlIC0tIC4vdGVzdHMvKi50ZXN0LmpzXFwiLFxcIndhaXRcXCI6XFwicmltcmFmIGRpc3QgJiYgd2FpdC1vbiBodHRwOi8vbG9jYWxob3N0OjMwMDAvZGlzdC9mZm1wZWcuZGV2LmpzXFwifSxcXCJ2ZXJzaW9uXFwiOlxcIjAuNi4xXFwifSIpO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGZmbXBlZy9mZm1wZWcvcGFja2FnZS5qc29uPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgibW9kdWxlLmV4cG9ydHMgPSB7XG4gIGxvZ2dlcjogKCkgPT4ge30sXG4gIHByb2dyZXNzOiAoKSA9PiB7fSxcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy9jb25zdGFudHMvZGVmYXVsdE9wdGlvbnMuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCIvKipcbiAqIHNwYXduV29ya2VyXG4gKlxuICogQG5hbWUgc3Bhd25Xb3JrZXJcbiAqIEBmdW5jdGlvbiBjcmVhdGUgYSBuZXcgV29ya2VyIGluIGJyb3dzZXJcbiAqIEBhY2Nlc3MgcHVibGljXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gKHsgd29ya2VyUGF0aCwgd29ya2VyQmxvYlVSTCB9KSA9PiB7XG4gIGxldCB3b3JrZXI7XG4gIGlmIChCbG9iICYmIFVSTCAmJiB3b3JrZXJCbG9iVVJMKSB7XG4gICAgLyogVXNlIEJsb2IgdG8gbG9hZCBjcm9zcyBkb21haW4gd29ya2VyIHNjcmlwdCAqL1xuICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYGltcG9ydFNjcmlwdHMoXCIke3dvcmtlclBhdGh9XCIpO2BdLCB7XG4gICAgICB0eXBlOiAnYXBwbGljYXRpb24vamF2YXNjcmlwdCcsXG4gICAgfSk7XG4gICAgd29ya2VyID0gbmV3IFdvcmtlcihVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKTtcbiAgfSBlbHNlIHtcbiAgICB3b3JrZXIgPSBuZXcgV29ya2VyKHdvcmtlclBhdGgpO1xuICB9XG4gIHJldHVybiB3b3JrZXI7XG59O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AZmZtcGVnL2ZmbXBlZy9zcmMvd29ya2VyL2Jyb3dzZXIvc3Bhd25Xb3JrZXIuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCJtb2R1bGUuZXhwb3J0cyA9ICh3b3JrZXIsIGhhbmRsZXIpID0+IHtcbiAgd29ya2VyLm9ubWVzc2FnZSA9ICh7IGRhdGEgfSkgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgaGFuZGxlcihkYXRhKTtcbiAgfTtcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy93b3JrZXIvYnJvd3Nlci9vbk1lc3NhZ2UuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoImNvbnN0IHJlc29sdmVVUkwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISByZXNvbHZlLXVybCAqLyAxNSk7XG5cbi8qKlxuICogcmVhZEZyb21CbG9iT3JGaWxlXG4gKlxuICogQG5hbWUgcmVhZEZyb21CbG9iT3JGaWxlXG4gKiBAZnVuY3Rpb25cbiAqIEBhY2Nlc3MgcHJpdmF0ZVxuICovXG5jb25zdCByZWFkRnJvbUJsb2JPckZpbGUgPSAoYmxvYikgPT4gKFxuICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgZmlsZVJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICByZXNvbHZlKGZpbGVSZWFkZXIucmVzdWx0KTtcbiAgICB9O1xuICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICh7IHRhcmdldDogeyBlcnJvcjogeyBjb2RlIH0gfSB9KSA9PiB7XG4gICAgICByZWplY3QoRXJyb3IoYEZpbGUgY291bGQgbm90IGJlIHJlYWQhIENvZGU9JHtjb2RlfWApKTtcbiAgICB9O1xuICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7XG4gIH0pXG4pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChfZGF0YSkgPT4ge1xuICBsZXQgZGF0YSA9IF9kYXRhO1xuICBpZiAodHlwZW9mIF9kYXRhID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiAndW5kZWZpbmVkJztcbiAgfVxuXG4gIGlmICh0eXBlb2YgX2RhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgLy8gQmFzZTY0IF9kYXRhXG4gICAgaWYgKC9kYXRhOl9kYXRhXFwvKFthLXpBLVpdKik7YmFzZTY0LChbXlwiXSopLy50ZXN0KF9kYXRhKSkge1xuICAgICAgZGF0YSA9IGF0b2IoX2RhdGEuc3BsaXQoJywnKVsxXSlcbiAgICAgICAgLnNwbGl0KCcnKVxuICAgICAgICAubWFwKChjKSA9PiBjLmNoYXJDb2RlQXQoMCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChyZXNvbHZlVVJMKF9kYXRhKSk7XG4gICAgICBkYXRhID0gYXdhaXQgcmVzLmFycmF5QnVmZmVyKCk7XG4gICAgfVxuICB9IGVsc2UgaWYgKF9kYXRhIGluc3RhbmNlb2YgRmlsZSB8fCBfZGF0YSBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICBkYXRhID0gYXdhaXQgcmVhZEZyb21CbG9iT3JGaWxlKF9kYXRhKTtcbiAgfVxuXG4gIHJldHVybiBuZXcgVWludDhBcnJheShkYXRhKTtcbn07XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy93b3JrZXIvYnJvd3Nlci9mZXRjaEZpbGUuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCcvKiogQGxpY2Vuc2UgUmVhY3QgdjE2LjEzLjFcbiAqIHJlYWN0LnByb2R1Y3Rpb24ubWluLmpzXG4gKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIGw9X193ZWJwYWNrX3JlcXVpcmVfXygvKiEgb2JqZWN0LWFzc2lnbiAqLyAyMyksbj0iZnVuY3Rpb24iPT09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLmZvcixwPW4/U3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpOjYwMTAzLHE9bj9TeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKTo2MDEwNixyPW4/U3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKTo2MDEwNyx0PW4/U3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKTo2MDEwOCx1PW4/U3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKTo2MDExNCx2PW4/U3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKTo2MDEwOSx3PW4/U3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpOjYwMTEwLHg9bj9TeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpOjYwMTEyLHk9bj9TeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpOjYwMTEzLHo9bj9TeW1ib2wuZm9yKCJyZWFjdC5tZW1vIik6NjAxMTUsQT1uP1N5bWJvbC5mb3IoInJlYWN0LmxhenkiKTpcbjYwMTE2LEI9ImZ1bmN0aW9uIj09PXR5cGVvZiBTeW1ib2wmJlN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBDKGEpe2Zvcih2YXIgYj0iaHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2Vycm9yLWRlY29kZXIuaHRtbD9pbnZhcmlhbnQ9IithLGM9MTtjPGFyZ3VtZW50cy5sZW5ndGg7YysrKWIrPSImYXJnc1tdPSIrZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tjXSk7cmV0dXJuIk1pbmlmaWVkIFJlYWN0IGVycm9yICMiK2ErIjsgdmlzaXQgIitiKyIgZm9yIHRoZSBmdWxsIG1lc3NhZ2Ugb3IgdXNlIHRoZSBub24tbWluaWZpZWQgZGV2IGVudmlyb25tZW50IGZvciBmdWxsIGVycm9ycyBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLiJ9XG52YXIgRD17aXNNb3VudGVkOmZ1bmN0aW9uKCl7cmV0dXJuITF9LGVucXVldWVGb3JjZVVwZGF0ZTpmdW5jdGlvbigpe30sZW5xdWV1ZVJlcGxhY2VTdGF0ZTpmdW5jdGlvbigpe30sZW5xdWV1ZVNldFN0YXRlOmZ1bmN0aW9uKCl7fX0sRT17fTtmdW5jdGlvbiBGKGEsYixjKXt0aGlzLnByb3BzPWE7dGhpcy5jb250ZXh0PWI7dGhpcy5yZWZzPUU7dGhpcy51cGRhdGVyPWN8fER9Ri5wcm90b3R5cGUuaXNSZWFjdENvbXBvbmVudD17fTtGLnByb3RvdHlwZS5zZXRTdGF0ZT1mdW5jdGlvbihhLGIpe2lmKCJvYmplY3QiIT09dHlwZW9mIGEmJiJmdW5jdGlvbiIhPT10eXBlb2YgYSYmbnVsbCE9YSl0aHJvdyBFcnJvcihDKDg1KSk7dGhpcy51cGRhdGVyLmVucXVldWVTZXRTdGF0ZSh0aGlzLGEsYiwic2V0U3RhdGUiKX07Ri5wcm90b3R5cGUuZm9yY2VVcGRhdGU9ZnVuY3Rpb24oYSl7dGhpcy51cGRhdGVyLmVucXVldWVGb3JjZVVwZGF0ZSh0aGlzLGEsImZvcmNlVXBkYXRlIil9O1xuZnVuY3Rpb24gRygpe31HLnByb3RvdHlwZT1GLnByb3RvdHlwZTtmdW5jdGlvbiBIKGEsYixjKXt0aGlzLnByb3BzPWE7dGhpcy5jb250ZXh0PWI7dGhpcy5yZWZzPUU7dGhpcy51cGRhdGVyPWN8fER9dmFyIEk9SC5wcm90b3R5cGU9bmV3IEc7SS5jb25zdHJ1Y3Rvcj1IO2woSSxGLnByb3RvdHlwZSk7SS5pc1B1cmVSZWFjdENvbXBvbmVudD0hMDt2YXIgSj17Y3VycmVudDpudWxsfSxLPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksTD17a2V5OiEwLHJlZjohMCxfX3NlbGY6ITAsX19zb3VyY2U6ITB9O1xuZnVuY3Rpb24gTShhLGIsYyl7dmFyIGUsZD17fSxnPW51bGwsaz1udWxsO2lmKG51bGwhPWIpZm9yKGUgaW4gdm9pZCAwIT09Yi5yZWYmJihrPWIucmVmKSx2b2lkIDAhPT1iLmtleSYmKGc9IiIrYi5rZXkpLGIpSy5jYWxsKGIsZSkmJiFMLmhhc093blByb3BlcnR5KGUpJiYoZFtlXT1iW2VdKTt2YXIgZj1hcmd1bWVudHMubGVuZ3RoLTI7aWYoMT09PWYpZC5jaGlsZHJlbj1jO2Vsc2UgaWYoMTxmKXtmb3IodmFyIGg9QXJyYXkoZiksbT0wO208ZjttKyspaFttXT1hcmd1bWVudHNbbSsyXTtkLmNoaWxkcmVuPWh9aWYoYSYmYS5kZWZhdWx0UHJvcHMpZm9yKGUgaW4gZj1hLmRlZmF1bHRQcm9wcyxmKXZvaWQgMD09PWRbZV0mJihkW2VdPWZbZV0pO3JldHVybnskJHR5cGVvZjpwLHR5cGU6YSxrZXk6ZyxyZWY6ayxwcm9wczpkLF9vd25lcjpKLmN1cnJlbnR9fVxuZnVuY3Rpb24gTihhLGIpe3JldHVybnskJHR5cGVvZjpwLHR5cGU6YS50eXBlLGtleTpiLHJlZjphLnJlZixwcm9wczphLnByb3BzLF9vd25lcjphLl9vd25lcn19ZnVuY3Rpb24gTyhhKXtyZXR1cm4ib2JqZWN0Ij09PXR5cGVvZiBhJiZudWxsIT09YSYmYS4kJHR5cGVvZj09PXB9ZnVuY3Rpb24gZXNjYXBlKGEpe3ZhciBiPXsiPSI6Ij0wIiwiOiI6Ij0yIn07cmV0dXJuIiQiKygiIithKS5yZXBsYWNlKC9bPTpdL2csZnVuY3Rpb24oYSl7cmV0dXJuIGJbYV19KX12YXIgUD0vXFwvKy9nLFE9W107ZnVuY3Rpb24gUihhLGIsYyxlKXtpZihRLmxlbmd0aCl7dmFyIGQ9US5wb3AoKTtkLnJlc3VsdD1hO2Qua2V5UHJlZml4PWI7ZC5mdW5jPWM7ZC5jb250ZXh0PWU7ZC5jb3VudD0wO3JldHVybiBkfXJldHVybntyZXN1bHQ6YSxrZXlQcmVmaXg6YixmdW5jOmMsY29udGV4dDplLGNvdW50OjB9fVxuZnVuY3Rpb24gUyhhKXthLnJlc3VsdD1udWxsO2Eua2V5UHJlZml4PW51bGw7YS5mdW5jPW51bGw7YS5jb250ZXh0PW51bGw7YS5jb3VudD0wOzEwPlEubGVuZ3RoJiZRLnB1c2goYSl9XG5mdW5jdGlvbiBUKGEsYixjLGUpe3ZhciBkPXR5cGVvZiBhO2lmKCJ1bmRlZmluZWQiPT09ZHx8ImJvb2xlYW4iPT09ZClhPW51bGw7dmFyIGc9ITE7aWYobnVsbD09PWEpZz0hMDtlbHNlIHN3aXRjaChkKXtjYXNlICJzdHJpbmciOmNhc2UgIm51bWJlciI6Zz0hMDticmVhaztjYXNlICJvYmplY3QiOnN3aXRjaChhLiQkdHlwZW9mKXtjYXNlIHA6Y2FzZSBxOmc9ITB9fWlmKGcpcmV0dXJuIGMoZSxhLCIiPT09Yj8iLiIrVShhLDApOmIpLDE7Zz0wO2I9IiI9PT1iPyIuIjpiKyI6IjtpZihBcnJheS5pc0FycmF5KGEpKWZvcih2YXIgaz0wO2s8YS5sZW5ndGg7aysrKXtkPWFba107dmFyIGY9YitVKGQsayk7Zys9VChkLGYsYyxlKX1lbHNlIGlmKG51bGw9PT1hfHwib2JqZWN0IiE9PXR5cGVvZiBhP2Y9bnVsbDooZj1CJiZhW0JdfHxhWyJAQGl0ZXJhdG9yIl0sZj0iZnVuY3Rpb24iPT09dHlwZW9mIGY/ZjpudWxsKSwiZnVuY3Rpb24iPT09dHlwZW9mIGYpZm9yKGE9Zi5jYWxsKGEpLGs9XG4wOyEoZD1hLm5leHQoKSkuZG9uZTspZD1kLnZhbHVlLGY9YitVKGQsaysrKSxnKz1UKGQsZixjLGUpO2Vsc2UgaWYoIm9iamVjdCI9PT1kKXRocm93IGM9IiIrYSxFcnJvcihDKDMxLCJbb2JqZWN0IE9iamVjdF0iPT09Yz8ib2JqZWN0IHdpdGgga2V5cyB7IitPYmplY3Qua2V5cyhhKS5qb2luKCIsICIpKyJ9IjpjLCIiKSk7cmV0dXJuIGd9ZnVuY3Rpb24gVihhLGIsYyl7cmV0dXJuIG51bGw9PWE/MDpUKGEsIiIsYixjKX1mdW5jdGlvbiBVKGEsYil7cmV0dXJuIm9iamVjdCI9PT10eXBlb2YgYSYmbnVsbCE9PWEmJm51bGwhPWEua2V5P2VzY2FwZShhLmtleSk6Yi50b1N0cmluZygzNil9ZnVuY3Rpb24gVyhhLGIpe2EuZnVuYy5jYWxsKGEuY29udGV4dCxiLGEuY291bnQrKyl9XG5mdW5jdGlvbiBhYShhLGIsYyl7dmFyIGU9YS5yZXN1bHQsZD1hLmtleVByZWZpeDthPWEuZnVuYy5jYWxsKGEuY29udGV4dCxiLGEuY291bnQrKyk7QXJyYXkuaXNBcnJheShhKT9YKGEsZSxjLGZ1bmN0aW9uKGEpe3JldHVybiBhfSk6bnVsbCE9YSYmKE8oYSkmJihhPU4oYSxkKyghYS5rZXl8fGImJmIua2V5PT09YS5rZXk/IiI6KCIiK2Eua2V5KS5yZXBsYWNlKFAsIiQmLyIpKyIvIikrYykpLGUucHVzaChhKSl9ZnVuY3Rpb24gWChhLGIsYyxlLGQpe3ZhciBnPSIiO251bGwhPWMmJihnPSgiIitjKS5yZXBsYWNlKFAsIiQmLyIpKyIvIik7Yj1SKGIsZyxlLGQpO1YoYSxhYSxiKTtTKGIpfXZhciBZPXtjdXJyZW50Om51bGx9O2Z1bmN0aW9uIFooKXt2YXIgYT1ZLmN1cnJlbnQ7aWYobnVsbD09PWEpdGhyb3cgRXJyb3IoQygzMjEpKTtyZXR1cm4gYX1cbnZhciBiYT17UmVhY3RDdXJyZW50RGlzcGF0Y2hlcjpZLFJlYWN0Q3VycmVudEJhdGNoQ29uZmlnOntzdXNwZW5zZTpudWxsfSxSZWFjdEN1cnJlbnRPd25lcjpKLElzU29tZVJlbmRlcmVyQWN0aW5nOntjdXJyZW50OiExfSxhc3NpZ246bH07ZXhwb3J0cy5DaGlsZHJlbj17bWFwOmZ1bmN0aW9uKGEsYixjKXtpZihudWxsPT1hKXJldHVybiBhO3ZhciBlPVtdO1goYSxlLG51bGwsYixjKTtyZXR1cm4gZX0sZm9yRWFjaDpmdW5jdGlvbihhLGIsYyl7aWYobnVsbD09YSlyZXR1cm4gYTtiPVIobnVsbCxudWxsLGIsYyk7VihhLFcsYik7UyhiKX0sY291bnQ6ZnVuY3Rpb24oYSl7cmV0dXJuIFYoYSxmdW5jdGlvbigpe3JldHVybiBudWxsfSxudWxsKX0sdG9BcnJheTpmdW5jdGlvbihhKXt2YXIgYj1bXTtYKGEsYixudWxsLGZ1bmN0aW9uKGEpe3JldHVybiBhfSk7cmV0dXJuIGJ9LG9ubHk6ZnVuY3Rpb24oYSl7aWYoIU8oYSkpdGhyb3cgRXJyb3IoQygxNDMpKTtyZXR1cm4gYX19O1xuZXhwb3J0cy5Db21wb25lbnQ9RjtleHBvcnRzLkZyYWdtZW50PXI7ZXhwb3J0cy5Qcm9maWxlcj11O2V4cG9ydHMuUHVyZUNvbXBvbmVudD1IO2V4cG9ydHMuU3RyaWN0TW9kZT10O2V4cG9ydHMuU3VzcGVuc2U9eTtleHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEPWJhO1xuZXhwb3J0cy5jbG9uZUVsZW1lbnQ9ZnVuY3Rpb24oYSxiLGMpe2lmKG51bGw9PT1hfHx2b2lkIDA9PT1hKXRocm93IEVycm9yKEMoMjY3LGEpKTt2YXIgZT1sKHt9LGEucHJvcHMpLGQ9YS5rZXksZz1hLnJlZixrPWEuX293bmVyO2lmKG51bGwhPWIpe3ZvaWQgMCE9PWIucmVmJiYoZz1iLnJlZixrPUouY3VycmVudCk7dm9pZCAwIT09Yi5rZXkmJihkPSIiK2Iua2V5KTtpZihhLnR5cGUmJmEudHlwZS5kZWZhdWx0UHJvcHMpdmFyIGY9YS50eXBlLmRlZmF1bHRQcm9wcztmb3IoaCBpbiBiKUsuY2FsbChiLGgpJiYhTC5oYXNPd25Qcm9wZXJ0eShoKSYmKGVbaF09dm9pZCAwPT09YltoXSYmdm9pZCAwIT09Zj9mW2hdOmJbaF0pfXZhciBoPWFyZ3VtZW50cy5sZW5ndGgtMjtpZigxPT09aCllLmNoaWxkcmVuPWM7ZWxzZSBpZigxPGgpe2Y9QXJyYXkoaCk7Zm9yKHZhciBtPTA7bTxoO20rKylmW21dPWFyZ3VtZW50c1ttKzJdO2UuY2hpbGRyZW49Zn1yZXR1cm57JCR0eXBlb2Y6cCx0eXBlOmEudHlwZSxcbmtleTpkLHJlZjpnLHByb3BzOmUsX293bmVyOmt9fTtleHBvcnRzLmNyZWF0ZUNvbnRleHQ9ZnVuY3Rpb24oYSxiKXt2b2lkIDA9PT1iJiYoYj1udWxsKTthPXskJHR5cGVvZjp3LF9jYWxjdWxhdGVDaGFuZ2VkQml0czpiLF9jdXJyZW50VmFsdWU6YSxfY3VycmVudFZhbHVlMjphLF90aHJlYWRDb3VudDowLFByb3ZpZGVyOm51bGwsQ29uc3VtZXI6bnVsbH07YS5Qcm92aWRlcj17JCR0eXBlb2Y6dixfY29udGV4dDphfTtyZXR1cm4gYS5Db25zdW1lcj1hfTtleHBvcnRzLmNyZWF0ZUVsZW1lbnQ9TTtleHBvcnRzLmNyZWF0ZUZhY3Rvcnk9ZnVuY3Rpb24oYSl7dmFyIGI9TS5iaW5kKG51bGwsYSk7Yi50eXBlPWE7cmV0dXJuIGJ9O2V4cG9ydHMuY3JlYXRlUmVmPWZ1bmN0aW9uKCl7cmV0dXJue2N1cnJlbnQ6bnVsbH19O2V4cG9ydHMuZm9yd2FyZFJlZj1mdW5jdGlvbihhKXtyZXR1cm57JCR0eXBlb2Y6eCxyZW5kZXI6YX19O2V4cG9ydHMuaXNWYWxpZEVsZW1lbnQ9TztcbmV4cG9ydHMubGF6eT1mdW5jdGlvbihhKXtyZXR1cm57JCR0eXBlb2Y6QSxfY3RvcjphLF9zdGF0dXM6LTEsX3Jlc3VsdDpudWxsfX07ZXhwb3J0cy5tZW1vPWZ1bmN0aW9uKGEsYil7cmV0dXJueyQkdHlwZW9mOnosdHlwZTphLGNvbXBhcmU6dm9pZCAwPT09Yj9udWxsOmJ9fTtleHBvcnRzLnVzZUNhbGxiYWNrPWZ1bmN0aW9uKGEsYil7cmV0dXJuIFooKS51c2VDYWxsYmFjayhhLGIpfTtleHBvcnRzLnVzZUNvbnRleHQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gWigpLnVzZUNvbnRleHQoYSxiKX07ZXhwb3J0cy51c2VEZWJ1Z1ZhbHVlPWZ1bmN0aW9uKCl7fTtleHBvcnRzLnVzZUVmZmVjdD1mdW5jdGlvbihhLGIpe3JldHVybiBaKCkudXNlRWZmZWN0KGEsYil9O2V4cG9ydHMudXNlSW1wZXJhdGl2ZUhhbmRsZT1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIFooKS51c2VJbXBlcmF0aXZlSGFuZGxlKGEsYixjKX07XG5leHBvcnRzLnVzZUxheW91dEVmZmVjdD1mdW5jdGlvbihhLGIpe3JldHVybiBaKCkudXNlTGF5b3V0RWZmZWN0KGEsYil9O2V4cG9ydHMudXNlTWVtbz1mdW5jdGlvbihhLGIpe3JldHVybiBaKCkudXNlTWVtbyhhLGIpfTtleHBvcnRzLnVzZVJlZHVjZXI9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBaKCkudXNlUmVkdWNlcihhLGIsYyl9O2V4cG9ydHMudXNlUmVmPWZ1bmN0aW9uKGEpe3JldHVybiBaKCkudXNlUmVmKGEpfTtleHBvcnRzLnVzZVN0YXRlPWZ1bmN0aW9uKGEpe3JldHVybiBaKCkudXNlU3RhdGUoYSl9O2V4cG9ydHMudmVyc2lvbj0iMTYuMTMuMSI7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlYWN0L2Nqcy9yZWFjdC5wcm9kdWN0aW9uLm1pbi5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDEzLXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuXG5cbnZhciBSZWFjdFByb3BUeXBlc1NlY3JldCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbGliL1JlYWN0UHJvcFR5cGVzU2VjcmV0ICovIDY5KTtcblxuZnVuY3Rpb24gZW1wdHlGdW5jdGlvbigpIHt9XG5mdW5jdGlvbiBlbXB0eUZ1bmN0aW9uV2l0aFJlc2V0KCkge31cbmVtcHR5RnVuY3Rpb25XaXRoUmVzZXQucmVzZXRXYXJuaW5nQ2FjaGUgPSBlbXB0eUZ1bmN0aW9uO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBzaGltKHByb3BzLCBwcm9wTmFtZSwgY29tcG9uZW50TmFtZSwgbG9jYXRpb24sIHByb3BGdWxsTmFtZSwgc2VjcmV0KSB7XG4gICAgaWYgKHNlY3JldCA9PT0gUmVhY3RQcm9wVHlwZXNTZWNyZXQpIHtcbiAgICAgIC8vIEl0IGlzIHN0aWxsIHNhZmUgd2hlbiBjYWxsZWQgZnJvbSBSZWFjdC5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGVyciA9IG5ldyBFcnJvcihcbiAgICAgICdDYWxsaW5nIFByb3BUeXBlcyB2YWxpZGF0b3JzIGRpcmVjdGx5IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGBwcm9wLXR5cGVzYCBwYWNrYWdlLiAnICtcbiAgICAgICdVc2UgUHJvcFR5cGVzLmNoZWNrUHJvcFR5cGVzKCkgdG8gY2FsbCB0aGVtLiAnICtcbiAgICAgICdSZWFkIG1vcmUgYXQgaHR0cDovL2ZiLm1lL3VzZS1jaGVjay1wcm9wLXR5cGVzJ1xuICAgICk7XG4gICAgZXJyLm5hbWUgPSAnSW52YXJpYW50IFZpb2xhdGlvbic7XG4gICAgdGhyb3cgZXJyO1xuICB9O1xuICBzaGltLmlzUmVxdWlyZWQgPSBzaGltO1xuICBmdW5jdGlvbiBnZXRTaGltKCkge1xuICAgIHJldHVybiBzaGltO1xuICB9O1xuICAvLyBJbXBvcnRhbnQhXG4gIC8vIEtlZXAgdGhpcyBsaXN0IGluIHN5bmMgd2l0aCBwcm9kdWN0aW9uIHZlcnNpb24gaW4gYC4vZmFjdG9yeVdpdGhUeXBlQ2hlY2tlcnMuanNgLlxuICB2YXIgUmVhY3RQcm9wVHlwZXMgPSB7XG4gICAgYXJyYXk6IHNoaW0sXG4gICAgYm9vbDogc2hpbSxcbiAgICBmdW5jOiBzaGltLFxuICAgIG51bWJlcjogc2hpbSxcbiAgICBvYmplY3Q6IHNoaW0sXG4gICAgc3RyaW5nOiBzaGltLFxuICAgIHN5bWJvbDogc2hpbSxcblxuICAgIGFueTogc2hpbSxcbiAgICBhcnJheU9mOiBnZXRTaGltLFxuICAgIGVsZW1lbnQ6IHNoaW0sXG4gICAgZWxlbWVudFR5cGU6IHNoaW0sXG4gICAgaW5zdGFuY2VPZjogZ2V0U2hpbSxcbiAgICBub2RlOiBzaGltLFxuICAgIG9iamVjdE9mOiBnZXRTaGltLFxuICAgIG9uZU9mOiBnZXRTaGltLFxuICAgIG9uZU9mVHlwZTogZ2V0U2hpbSxcbiAgICBzaGFwZTogZ2V0U2hpbSxcbiAgICBleGFjdDogZ2V0U2hpbSxcblxuICAgIGNoZWNrUHJvcFR5cGVzOiBlbXB0eUZ1bmN0aW9uV2l0aFJlc2V0LFxuICAgIHJlc2V0V2FybmluZ0NhY2hlOiBlbXB0eUZ1bmN0aW9uXG4gIH07XG5cbiAgUmVhY3RQcm9wVHlwZXMuUHJvcFR5cGVzID0gUmVhY3RQcm9wVHlwZXM7XG5cbiAgcmV0dXJuIFJlYWN0UHJvcFR5cGVzO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcHJvcC10eXBlcy9mYWN0b3J5V2l0aFRocm93aW5nU2hpbXMuanM/Iil9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxMy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cblxuXG52YXIgUmVhY3RQcm9wVHlwZXNTZWNyZXQgPSAnU0VDUkVUX0RPX05PVF9QQVNTX1RISVNfT1JfWU9VX1dJTExfQkVfRklSRUQnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0UHJvcFR5cGVzU2VjcmV0O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9wcm9wLXR5cGVzL2xpYi9SZWFjdFByb3BUeXBlc1NlY3JldC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoJy8qKiBAbGljZW5zZSBSZWFjdCB2MTYuMTMuMVxuICogcmVhY3QtaXMucHJvZHVjdGlvbi5taW4uanNcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG52YXIgYj0iZnVuY3Rpb24iPT09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLmZvcixjPWI/U3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpOjYwMTAzLGQ9Yj9TeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKTo2MDEwNixlPWI/U3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKTo2MDEwNyxmPWI/U3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKTo2MDEwOCxnPWI/U3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKTo2MDExNCxoPWI/U3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKTo2MDEwOSxrPWI/U3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpOjYwMTEwLGw9Yj9TeW1ib2wuZm9yKCJyZWFjdC5hc3luY19tb2RlIik6NjAxMTEsbT1iP1N5bWJvbC5mb3IoInJlYWN0LmNvbmN1cnJlbnRfbW9kZSIpOjYwMTExLG49Yj9TeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpOjYwMTEyLHA9Yj9TeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpOjYwMTEzLHE9Yj9cblN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlX2xpc3QiKTo2MDEyMCxyPWI/U3ltYm9sLmZvcigicmVhY3QubWVtbyIpOjYwMTE1LHQ9Yj9TeW1ib2wuZm9yKCJyZWFjdC5sYXp5Iik6NjAxMTYsdj1iP1N5bWJvbC5mb3IoInJlYWN0LmJsb2NrIik6NjAxMjEsdz1iP1N5bWJvbC5mb3IoInJlYWN0LmZ1bmRhbWVudGFsIik6NjAxMTcseD1iP1N5bWJvbC5mb3IoInJlYWN0LnJlc3BvbmRlciIpOjYwMTE4LHk9Yj9TeW1ib2wuZm9yKCJyZWFjdC5zY29wZSIpOjYwMTE5O1xuZnVuY3Rpb24geihhKXtpZigib2JqZWN0Ij09PXR5cGVvZiBhJiZudWxsIT09YSl7dmFyIHU9YS4kJHR5cGVvZjtzd2l0Y2godSl7Y2FzZSBjOnN3aXRjaChhPWEudHlwZSxhKXtjYXNlIGw6Y2FzZSBtOmNhc2UgZTpjYXNlIGc6Y2FzZSBmOmNhc2UgcDpyZXR1cm4gYTtkZWZhdWx0OnN3aXRjaChhPWEmJmEuJCR0eXBlb2YsYSl7Y2FzZSBrOmNhc2UgbjpjYXNlIHQ6Y2FzZSByOmNhc2UgaDpyZXR1cm4gYTtkZWZhdWx0OnJldHVybiB1fX1jYXNlIGQ6cmV0dXJuIHV9fX1mdW5jdGlvbiBBKGEpe3JldHVybiB6KGEpPT09bX1leHBvcnRzLkFzeW5jTW9kZT1sO2V4cG9ydHMuQ29uY3VycmVudE1vZGU9bTtleHBvcnRzLkNvbnRleHRDb25zdW1lcj1rO2V4cG9ydHMuQ29udGV4dFByb3ZpZGVyPWg7ZXhwb3J0cy5FbGVtZW50PWM7ZXhwb3J0cy5Gb3J3YXJkUmVmPW47ZXhwb3J0cy5GcmFnbWVudD1lO2V4cG9ydHMuTGF6eT10O2V4cG9ydHMuTWVtbz1yO2V4cG9ydHMuUG9ydGFsPWQ7XG5leHBvcnRzLlByb2ZpbGVyPWc7ZXhwb3J0cy5TdHJpY3RNb2RlPWY7ZXhwb3J0cy5TdXNwZW5zZT1wO2V4cG9ydHMuaXNBc3luY01vZGU9ZnVuY3Rpb24oYSl7cmV0dXJuIEEoYSl8fHooYSk9PT1sfTtleHBvcnRzLmlzQ29uY3VycmVudE1vZGU9QTtleHBvcnRzLmlzQ29udGV4dENvbnN1bWVyPWZ1bmN0aW9uKGEpe3JldHVybiB6KGEpPT09a307ZXhwb3J0cy5pc0NvbnRleHRQcm92aWRlcj1mdW5jdGlvbihhKXtyZXR1cm4geihhKT09PWh9O2V4cG9ydHMuaXNFbGVtZW50PWZ1bmN0aW9uKGEpe3JldHVybiJvYmplY3QiPT09dHlwZW9mIGEmJm51bGwhPT1hJiZhLiQkdHlwZW9mPT09Y307ZXhwb3J0cy5pc0ZvcndhcmRSZWY9ZnVuY3Rpb24oYSl7cmV0dXJuIHooYSk9PT1ufTtleHBvcnRzLmlzRnJhZ21lbnQ9ZnVuY3Rpb24oYSl7cmV0dXJuIHooYSk9PT1lfTtleHBvcnRzLmlzTGF6eT1mdW5jdGlvbihhKXtyZXR1cm4geihhKT09PXR9O1xuZXhwb3J0cy5pc01lbW89ZnVuY3Rpb24oYSl7cmV0dXJuIHooYSk9PT1yfTtleHBvcnRzLmlzUG9ydGFsPWZ1bmN0aW9uKGEpe3JldHVybiB6KGEpPT09ZH07ZXhwb3J0cy5pc1Byb2ZpbGVyPWZ1bmN0aW9uKGEpe3JldHVybiB6KGEpPT09Z307ZXhwb3J0cy5pc1N0cmljdE1vZGU9ZnVuY3Rpb24oYSl7cmV0dXJuIHooYSk9PT1mfTtleHBvcnRzLmlzU3VzcGVuc2U9ZnVuY3Rpb24oYSl7cmV0dXJuIHooYSk9PT1wfTtcbmV4cG9ydHMuaXNWYWxpZEVsZW1lbnRUeXBlPWZ1bmN0aW9uKGEpe3JldHVybiJzdHJpbmciPT09dHlwZW9mIGF8fCJmdW5jdGlvbiI9PT10eXBlb2YgYXx8YT09PWV8fGE9PT1tfHxhPT09Z3x8YT09PWZ8fGE9PT1wfHxhPT09cXx8Im9iamVjdCI9PT10eXBlb2YgYSYmbnVsbCE9PWEmJihhLiQkdHlwZW9mPT09dHx8YS4kJHR5cGVvZj09PXJ8fGEuJCR0eXBlb2Y9PT1ofHxhLiQkdHlwZW9mPT09a3x8YS4kJHR5cGVvZj09PW58fGEuJCR0eXBlb2Y9PT13fHxhLiQkdHlwZW9mPT09eHx8YS4kJHR5cGVvZj09PXl8fGEuJCR0eXBlb2Y9PT12KX07ZXhwb3J0cy50eXBlT2Y9ejtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcmVhY3QtaXMvY2pzL3JlYWN0LWlzLnByb2R1Y3Rpb24ubWluLmpzPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgnbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvcmlnaW5hbE1vZHVsZSkge1xuXHRpZiAoIW9yaWdpbmFsTW9kdWxlLndlYnBhY2tQb2x5ZmlsbCkge1xuXHRcdHZhciBtb2R1bGUgPSBPYmplY3QuY3JlYXRlKG9yaWdpbmFsTW9kdWxlKTtcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcblx0XHRpZiAoIW1vZHVsZS5jaGlsZHJlbikgbW9kdWxlLmNoaWxkcmVuID0gW107XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImxvYWRlZCIsIHtcblx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmw7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgImlkIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBtb2R1bGUuaTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCAiZXhwb3J0cyIsIHtcblx0XHRcdGVudW1lcmFibGU6IHRydWVcblx0XHR9KTtcblx0XHRtb2R1bGUud2VicGFja1BvbHlmaWxsID0gMTtcblx0fVxuXHRyZXR1cm4gbW9kdWxlO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vaGFybW9ueS1tb2R1bGUuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCcvKiogQGxpY2Vuc2UgUmVhY3QgdjE2LjEzLjFcbiAqIHJlYWN0LWRvbS5wcm9kdWN0aW9uLm1pbi5qc1xuICpcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5cbi8qXG4gTW9kZXJuaXpyIDMuMC4wcHJlIChDdXN0b20gQnVpbGQpIHwgTUlUXG4qL1xudmFyIGFhPV9fd2VicGFja19yZXF1aXJlX18oLyohIHJlYWN0ICovIDApLG49X193ZWJwYWNrX3JlcXVpcmVfXygvKiEgb2JqZWN0LWFzc2lnbiAqLyAyMykscj1fX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBzY2hlZHVsZXIgKi8gNzMpO2Z1bmN0aW9uIHUoYSl7Zm9yKHZhciBiPSJodHRwczovL3JlYWN0anMub3JnL2RvY3MvZXJyb3ItZGVjb2Rlci5odG1sP2ludmFyaWFudD0iK2EsYz0xO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspYis9IiZhcmdzW109IitlbmNvZGVVUklDb21wb25lbnQoYXJndW1lbnRzW2NdKTtyZXR1cm4iTWluaWZpZWQgUmVhY3QgZXJyb3IgIyIrYSsiOyB2aXNpdCAiK2IrIiBmb3IgdGhlIGZ1bGwgbWVzc2FnZSBvciB1c2UgdGhlIG5vbi1taW5pZmllZCBkZXYgZW52aXJvbm1lbnQgZm9yIGZ1bGwgZXJyb3JzIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuIn1pZighYWEpdGhyb3cgRXJyb3IodSgyMjcpKTtcbmZ1bmN0aW9uIGJhKGEsYixjLGQsZSxmLGcsaCxrKXt2YXIgbD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMyk7dHJ5e2IuYXBwbHkoYyxsKX1jYXRjaChtKXt0aGlzLm9uRXJyb3IobSl9fXZhciBkYT0hMSxlYT1udWxsLGZhPSExLGhhPW51bGwsaWE9e29uRXJyb3I6ZnVuY3Rpb24oYSl7ZGE9ITA7ZWE9YX19O2Z1bmN0aW9uIGphKGEsYixjLGQsZSxmLGcsaCxrKXtkYT0hMTtlYT1udWxsO2JhLmFwcGx5KGlhLGFyZ3VtZW50cyl9ZnVuY3Rpb24ga2EoYSxiLGMsZCxlLGYsZyxoLGspe2phLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihkYSl7aWYoZGEpe3ZhciBsPWVhO2RhPSExO2VhPW51bGx9ZWxzZSB0aHJvdyBFcnJvcih1KDE5OCkpO2ZhfHwoZmE9ITAsaGE9bCl9fXZhciBsYT1udWxsLG1hPW51bGwsbmE9bnVsbDtcbmZ1bmN0aW9uIG9hKGEsYixjKXt2YXIgZD1hLnR5cGV8fCJ1bmtub3duLWV2ZW50IjthLmN1cnJlbnRUYXJnZXQ9bmEoYyk7a2EoZCxiLHZvaWQgMCxhKTthLmN1cnJlbnRUYXJnZXQ9bnVsbH12YXIgcGE9bnVsbCxxYT17fTtcbmZ1bmN0aW9uIHJhKCl7aWYocGEpZm9yKHZhciBhIGluIHFhKXt2YXIgYj1xYVthXSxjPXBhLmluZGV4T2YoYSk7aWYoISgtMTxjKSl0aHJvdyBFcnJvcih1KDk2LGEpKTtpZighc2FbY10pe2lmKCFiLmV4dHJhY3RFdmVudHMpdGhyb3cgRXJyb3IodSg5NyxhKSk7c2FbY109YjtjPWIuZXZlbnRUeXBlcztmb3IodmFyIGQgaW4gYyl7dmFyIGU9dm9pZCAwO3ZhciBmPWNbZF0sZz1iLGg9ZDtpZih0YS5oYXNPd25Qcm9wZXJ0eShoKSl0aHJvdyBFcnJvcih1KDk5LGgpKTt0YVtoXT1mO3ZhciBrPWYucGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM7aWYoayl7Zm9yKGUgaW4gaylrLmhhc093blByb3BlcnR5KGUpJiZ1YShrW2VdLGcsaCk7ZT0hMH1lbHNlIGYucmVnaXN0cmF0aW9uTmFtZT8odWEoZi5yZWdpc3RyYXRpb25OYW1lLGcsaCksZT0hMCk6ZT0hMTtpZighZSl0aHJvdyBFcnJvcih1KDk4LGQsYSkpO319fX1cbmZ1bmN0aW9uIHVhKGEsYixjKXtpZih2YVthXSl0aHJvdyBFcnJvcih1KDEwMCxhKSk7dmFbYV09Yjt3YVthXT1iLmV2ZW50VHlwZXNbY10uZGVwZW5kZW5jaWVzfXZhciBzYT1bXSx0YT17fSx2YT17fSx3YT17fTtmdW5jdGlvbiB4YShhKXt2YXIgYj0hMSxjO2ZvcihjIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShjKSl7dmFyIGQ9YVtjXTtpZighcWEuaGFzT3duUHJvcGVydHkoYyl8fHFhW2NdIT09ZCl7aWYocWFbY10pdGhyb3cgRXJyb3IodSgxMDIsYykpO3FhW2NdPWQ7Yj0hMH19YiYmcmEoKX12YXIgeWE9ISgidW5kZWZpbmVkIj09PXR5cGVvZiB3aW5kb3d8fCJ1bmRlZmluZWQiPT09dHlwZW9mIHdpbmRvdy5kb2N1bWVudHx8InVuZGVmaW5lZCI9PT10eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpLHphPW51bGwsQWE9bnVsbCxCYT1udWxsO1xuZnVuY3Rpb24gQ2EoYSl7aWYoYT1tYShhKSl7aWYoImZ1bmN0aW9uIiE9PXR5cGVvZiB6YSl0aHJvdyBFcnJvcih1KDI4MCkpO3ZhciBiPWEuc3RhdGVOb2RlO2ImJihiPWxhKGIpLHphKGEuc3RhdGVOb2RlLGEudHlwZSxiKSl9fWZ1bmN0aW9uIERhKGEpe0FhP0JhP0JhLnB1c2goYSk6QmE9W2FdOkFhPWF9ZnVuY3Rpb24gRWEoKXtpZihBYSl7dmFyIGE9QWEsYj1CYTtCYT1BYT1udWxsO0NhKGEpO2lmKGIpZm9yKGE9MDthPGIubGVuZ3RoO2ErKylDYShiW2FdKX19ZnVuY3Rpb24gRmEoYSxiKXtyZXR1cm4gYShiKX1mdW5jdGlvbiBHYShhLGIsYyxkLGUpe3JldHVybiBhKGIsYyxkLGUpfWZ1bmN0aW9uIEhhKCl7fXZhciBJYT1GYSxKYT0hMSxLYT0hMTtmdW5jdGlvbiBMYSgpe2lmKG51bGwhPT1BYXx8bnVsbCE9PUJhKUhhKCksRWEoKX1cbmZ1bmN0aW9uIE1hKGEsYixjKXtpZihLYSlyZXR1cm4gYShiLGMpO0thPSEwO3RyeXtyZXR1cm4gSWEoYSxiLGMpfWZpbmFsbHl7S2E9ITEsTGEoKX19dmFyIE5hPS9eWzpBLVpfYS16XFx1MDBDMC1cXHUwMEQ2XFx1MDBEOC1cXHUwMEY2XFx1MDBGOC1cXHUwMkZGXFx1MDM3MC1cXHUwMzdEXFx1MDM3Ri1cXHUxRkZGXFx1MjAwQy1cXHUyMDBEXFx1MjA3MC1cXHUyMThGXFx1MkMwMC1cXHUyRkVGXFx1MzAwMS1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkZEXVs6QS1aX2EtelxcdTAwQzAtXFx1MDBENlxcdTAwRDgtXFx1MDBGNlxcdTAwRjgtXFx1MDJGRlxcdTAzNzAtXFx1MDM3RFxcdTAzN0YtXFx1MUZGRlxcdTIwMEMtXFx1MjAwRFxcdTIwNzAtXFx1MjE4RlxcdTJDMDAtXFx1MkZFRlxcdTMwMDEtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZGRFxcLS4wLTlcXHUwMEI3XFx1MDMwMC1cXHUwMzZGXFx1MjAzRi1cXHUyMDQwXSokLyxPYT1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LFBhPXt9LFFhPXt9O1xuZnVuY3Rpb24gUmEoYSl7aWYoT2EuY2FsbChRYSxhKSlyZXR1cm4hMDtpZihPYS5jYWxsKFBhLGEpKXJldHVybiExO2lmKE5hLnRlc3QoYSkpcmV0dXJuIFFhW2FdPSEwO1BhW2FdPSEwO3JldHVybiExfWZ1bmN0aW9uIFNhKGEsYixjLGQpe2lmKG51bGwhPT1jJiYwPT09Yy50eXBlKXJldHVybiExO3N3aXRjaCh0eXBlb2YgYil7Y2FzZSAiZnVuY3Rpb24iOmNhc2UgInN5bWJvbCI6cmV0dXJuITA7Y2FzZSAiYm9vbGVhbiI6aWYoZClyZXR1cm4hMTtpZihudWxsIT09YylyZXR1cm4hYy5hY2NlcHRzQm9vbGVhbnM7YT1hLnRvTG93ZXJDYXNlKCkuc2xpY2UoMCw1KTtyZXR1cm4iZGF0YS0iIT09YSYmImFyaWEtIiE9PWE7ZGVmYXVsdDpyZXR1cm4hMX19XG5mdW5jdGlvbiBUYShhLGIsYyxkKXtpZihudWxsPT09Ynx8InVuZGVmaW5lZCI9PT10eXBlb2YgYnx8U2EoYSxiLGMsZCkpcmV0dXJuITA7aWYoZClyZXR1cm4hMTtpZihudWxsIT09Yylzd2l0Y2goYy50eXBlKXtjYXNlIDM6cmV0dXJuIWI7Y2FzZSA0OnJldHVybiExPT09YjtjYXNlIDU6cmV0dXJuIGlzTmFOKGIpO2Nhc2UgNjpyZXR1cm4gaXNOYU4oYil8fDE+Yn1yZXR1cm4hMX1mdW5jdGlvbiB2KGEsYixjLGQsZSxmKXt0aGlzLmFjY2VwdHNCb29sZWFucz0yPT09Ynx8Mz09PWJ8fDQ9PT1iO3RoaXMuYXR0cmlidXRlTmFtZT1kO3RoaXMuYXR0cmlidXRlTmFtZXNwYWNlPWU7dGhpcy5tdXN0VXNlUHJvcGVydHk9Yzt0aGlzLnByb3BlcnR5TmFtZT1hO3RoaXMudHlwZT1iO3RoaXMuc2FuaXRpemVVUkw9Zn12YXIgQz17fTtcbiJjaGlsZHJlbiBkYW5nZXJvdXNseVNldElubmVySFRNTCBkZWZhdWx0VmFsdWUgZGVmYXVsdENoZWNrZWQgaW5uZXJIVE1MIHN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyBzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgc3R5bGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXtDW2FdPW5ldyB2KGEsMCwhMSxhLG51bGwsITEpfSk7W1siYWNjZXB0Q2hhcnNldCIsImFjY2VwdC1jaGFyc2V0Il0sWyJjbGFzc05hbWUiLCJjbGFzcyJdLFsiaHRtbEZvciIsImZvciJdLFsiaHR0cEVxdWl2IiwiaHR0cC1lcXVpdiJdXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe3ZhciBiPWFbMF07Q1tiXT1uZXcgdihiLDEsITEsYVsxXSxudWxsLCExKX0pO1siY29udGVudEVkaXRhYmxlIiwiZHJhZ2dhYmxlIiwic3BlbGxDaGVjayIsInZhbHVlIl0uZm9yRWFjaChmdW5jdGlvbihhKXtDW2FdPW5ldyB2KGEsMiwhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMSl9KTtcblsiYXV0b1JldmVyc2UiLCJleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkIiwiZm9jdXNhYmxlIiwicHJlc2VydmVBbHBoYSJdLmZvckVhY2goZnVuY3Rpb24oYSl7Q1thXT1uZXcgdihhLDIsITEsYSxudWxsLCExKX0pOyJhbGxvd0Z1bGxTY3JlZW4gYXN5bmMgYXV0b0ZvY3VzIGF1dG9QbGF5IGNvbnRyb2xzIGRlZmF1bHQgZGVmZXIgZGlzYWJsZWQgZGlzYWJsZVBpY3R1cmVJblBpY3R1cmUgZm9ybU5vVmFsaWRhdGUgaGlkZGVuIGxvb3Agbm9Nb2R1bGUgbm9WYWxpZGF0ZSBvcGVuIHBsYXlzSW5saW5lIHJlYWRPbmx5IHJlcXVpcmVkIHJldmVyc2VkIHNjb3BlZCBzZWFtbGVzcyBpdGVtU2NvcGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXtDW2FdPW5ldyB2KGEsMywhMSxhLnRvTG93ZXJDYXNlKCksbnVsbCwhMSl9KTtcblsiY2hlY2tlZCIsIm11bHRpcGxlIiwibXV0ZWQiLCJzZWxlY3RlZCJdLmZvckVhY2goZnVuY3Rpb24oYSl7Q1thXT1uZXcgdihhLDMsITAsYSxudWxsLCExKX0pO1siY2FwdHVyZSIsImRvd25sb2FkIl0uZm9yRWFjaChmdW5jdGlvbihhKXtDW2FdPW5ldyB2KGEsNCwhMSxhLG51bGwsITEpfSk7WyJjb2xzIiwicm93cyIsInNpemUiLCJzcGFuIl0uZm9yRWFjaChmdW5jdGlvbihhKXtDW2FdPW5ldyB2KGEsNiwhMSxhLG51bGwsITEpfSk7WyJyb3dTcGFuIiwic3RhcnQiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0NbYV09bmV3IHYoYSw1LCExLGEudG9Mb3dlckNhc2UoKSxudWxsLCExKX0pO3ZhciBVYT0vW1xcLTpdKFthLXpdKS9nO2Z1bmN0aW9uIFZhKGEpe3JldHVybiBhWzFdLnRvVXBwZXJDYXNlKCl9XG4iYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHQiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoVWEsXG5WYSk7Q1tiXT1uZXcgdihiLDEsITEsYSxudWxsLCExKX0pOyJ4bGluazphY3R1YXRlIHhsaW5rOmFyY3JvbGUgeGxpbms6cm9sZSB4bGluazpzaG93IHhsaW5rOnRpdGxlIHhsaW5rOnR5cGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgYj1hLnJlcGxhY2UoVWEsVmEpO0NbYl09bmV3IHYoYiwxLCExLGEsImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCExKX0pO1sieG1sOmJhc2UiLCJ4bWw6bGFuZyIsInhtbDpzcGFjZSJdLmZvckVhY2goZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXBsYWNlKFVhLFZhKTtDW2JdPW5ldyB2KGIsMSwhMSxhLCJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLCExKX0pO1sidGFiSW5kZXgiLCJjcm9zc09yaWdpbiJdLmZvckVhY2goZnVuY3Rpb24oYSl7Q1thXT1uZXcgdihhLDEsITEsYS50b0xvd2VyQ2FzZSgpLG51bGwsITEpfSk7XG5DLnhsaW5rSHJlZj1uZXcgdigieGxpbmtIcmVmIiwxLCExLCJ4bGluazpocmVmIiwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsITApO1sic3JjIiwiaHJlZiIsImFjdGlvbiIsImZvcm1BY3Rpb24iXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe0NbYV09bmV3IHYoYSwxLCExLGEudG9Mb3dlckNhc2UoKSxudWxsLCEwKX0pO3ZhciBXYT1hYS5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRDtXYS5oYXNPd25Qcm9wZXJ0eSgiUmVhY3RDdXJyZW50RGlzcGF0Y2hlciIpfHwoV2EuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcj17Y3VycmVudDpudWxsfSk7V2EuaGFzT3duUHJvcGVydHkoIlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnIil8fChXYS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZz17c3VzcGVuc2U6bnVsbH0pO1xuZnVuY3Rpb24gWGEoYSxiLGMsZCl7dmFyIGU9Qy5oYXNPd25Qcm9wZXJ0eShiKT9DW2JdOm51bGw7dmFyIGY9bnVsbCE9PWU/MD09PWUudHlwZTpkPyExOiEoMjxiLmxlbmd0aCl8fCJvIiE9PWJbMF0mJiJPIiE9PWJbMF18fCJuIiE9PWJbMV0mJiJOIiE9PWJbMV0/ITE6ITA7Znx8KFRhKGIsYyxlLGQpJiYoYz1udWxsKSxkfHxudWxsPT09ZT9SYShiKSYmKG51bGw9PT1jP2EucmVtb3ZlQXR0cmlidXRlKGIpOmEuc2V0QXR0cmlidXRlKGIsIiIrYykpOmUubXVzdFVzZVByb3BlcnR5P2FbZS5wcm9wZXJ0eU5hbWVdPW51bGw9PT1jPzM9PT1lLnR5cGU/ITE6IiI6YzooYj1lLmF0dHJpYnV0ZU5hbWUsZD1lLmF0dHJpYnV0ZU5hbWVzcGFjZSxudWxsPT09Yz9hLnJlbW92ZUF0dHJpYnV0ZShiKTooZT1lLnR5cGUsYz0zPT09ZXx8ND09PWUmJiEwPT09Yz8iIjoiIitjLGQ/YS5zZXRBdHRyaWJ1dGVOUyhkLGIsYyk6YS5zZXRBdHRyaWJ1dGUoYixjKSkpKX1cbnZhciBZYT0vXiguKilbXFxcXFxcL10vLEU9ImZ1bmN0aW9uIj09PXR5cGVvZiBTeW1ib2wmJlN5bWJvbC5mb3IsWmE9RT9TeW1ib2wuZm9yKCJyZWFjdC5lbGVtZW50Iik6NjAxMDMsJGE9RT9TeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKTo2MDEwNixhYj1FP1N5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50Iik6NjAxMDcsYmI9RT9TeW1ib2wuZm9yKCJyZWFjdC5zdHJpY3RfbW9kZSIpOjYwMTA4LGNiPUU/U3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKTo2MDExNCxkYj1FP1N5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIik6NjAxMDksZWI9RT9TeW1ib2wuZm9yKCJyZWFjdC5jb250ZXh0Iik6NjAxMTAsZmI9RT9TeW1ib2wuZm9yKCJyZWFjdC5jb25jdXJyZW50X21vZGUiKTo2MDExMSxnYj1FP1N5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIik6NjAxMTIsaGI9RT9TeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpOjYwMTEzLGliPUU/U3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2VfbGlzdCIpOlxuNjAxMjAsamI9RT9TeW1ib2wuZm9yKCJyZWFjdC5tZW1vIik6NjAxMTUsa2I9RT9TeW1ib2wuZm9yKCJyZWFjdC5sYXp5Iik6NjAxMTYsbGI9RT9TeW1ib2wuZm9yKCJyZWFjdC5ibG9jayIpOjYwMTIxLG1iPSJmdW5jdGlvbiI9PT10eXBlb2YgU3ltYm9sJiZTeW1ib2wuaXRlcmF0b3I7ZnVuY3Rpb24gbmIoYSl7aWYobnVsbD09PWF8fCJvYmplY3QiIT09dHlwZW9mIGEpcmV0dXJuIG51bGw7YT1tYiYmYVttYl18fGFbIkBAaXRlcmF0b3IiXTtyZXR1cm4iZnVuY3Rpb24iPT09dHlwZW9mIGE/YTpudWxsfWZ1bmN0aW9uIG9iKGEpe2lmKC0xPT09YS5fc3RhdHVzKXthLl9zdGF0dXM9MDt2YXIgYj1hLl9jdG9yO2I9YigpO2EuX3Jlc3VsdD1iO2IudGhlbihmdW5jdGlvbihiKXswPT09YS5fc3RhdHVzJiYoYj1iLmRlZmF1bHQsYS5fc3RhdHVzPTEsYS5fcmVzdWx0PWIpfSxmdW5jdGlvbihiKXswPT09YS5fc3RhdHVzJiYoYS5fc3RhdHVzPTIsYS5fcmVzdWx0PWIpfSl9fVxuZnVuY3Rpb24gcGIoYSl7aWYobnVsbD09YSlyZXR1cm4gbnVsbDtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGEpcmV0dXJuIGEuZGlzcGxheU5hbWV8fGEubmFtZXx8bnVsbDtpZigic3RyaW5nIj09PXR5cGVvZiBhKXJldHVybiBhO3N3aXRjaChhKXtjYXNlIGFiOnJldHVybiJGcmFnbWVudCI7Y2FzZSAkYTpyZXR1cm4iUG9ydGFsIjtjYXNlIGNiOnJldHVybiJQcm9maWxlciI7Y2FzZSBiYjpyZXR1cm4iU3RyaWN0TW9kZSI7Y2FzZSBoYjpyZXR1cm4iU3VzcGVuc2UiO2Nhc2UgaWI6cmV0dXJuIlN1c3BlbnNlTGlzdCJ9aWYoIm9iamVjdCI9PT10eXBlb2YgYSlzd2l0Y2goYS4kJHR5cGVvZil7Y2FzZSBlYjpyZXR1cm4iQ29udGV4dC5Db25zdW1lciI7Y2FzZSBkYjpyZXR1cm4iQ29udGV4dC5Qcm92aWRlciI7Y2FzZSBnYjp2YXIgYj1hLnJlbmRlcjtiPWIuZGlzcGxheU5hbWV8fGIubmFtZXx8IiI7cmV0dXJuIGEuZGlzcGxheU5hbWV8fCgiIiE9PWI/IkZvcndhcmRSZWYoIitiKyIpIjpcbiJGb3J3YXJkUmVmIik7Y2FzZSBqYjpyZXR1cm4gcGIoYS50eXBlKTtjYXNlIGxiOnJldHVybiBwYihhLnJlbmRlcik7Y2FzZSBrYjppZihhPTE9PT1hLl9zdGF0dXM/YS5fcmVzdWx0Om51bGwpcmV0dXJuIHBiKGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHFiKGEpe3ZhciBiPSIiO2Rve2E6c3dpdGNoKGEudGFnKXtjYXNlIDM6Y2FzZSA0OmNhc2UgNjpjYXNlIDc6Y2FzZSAxMDpjYXNlIDk6dmFyIGM9IiI7YnJlYWsgYTtkZWZhdWx0OnZhciBkPWEuX2RlYnVnT3duZXIsZT1hLl9kZWJ1Z1NvdXJjZSxmPXBiKGEudHlwZSk7Yz1udWxsO2QmJihjPXBiKGQudHlwZSkpO2Q9ZjtmPSIiO2U/Zj0iIChhdCAiK2UuZmlsZU5hbWUucmVwbGFjZShZYSwiIikrIjoiK2UubGluZU51bWJlcisiKSI6YyYmKGY9IiAoY3JlYXRlZCBieSAiK2MrIikiKTtjPSJcXG4gICAgaW4gIisoZHx8IlVua25vd24iKStmfWIrPWM7YT1hLnJldHVybn13aGlsZShhKTtyZXR1cm4gYn1cbmZ1bmN0aW9uIHJiKGEpe3N3aXRjaCh0eXBlb2YgYSl7Y2FzZSAiYm9vbGVhbiI6Y2FzZSAibnVtYmVyIjpjYXNlICJvYmplY3QiOmNhc2UgInN0cmluZyI6Y2FzZSAidW5kZWZpbmVkIjpyZXR1cm4gYTtkZWZhdWx0OnJldHVybiIifX1mdW5jdGlvbiBzYihhKXt2YXIgYj1hLnR5cGU7cmV0dXJuKGE9YS5ub2RlTmFtZSkmJiJpbnB1dCI9PT1hLnRvTG93ZXJDYXNlKCkmJigiY2hlY2tib3giPT09Ynx8InJhZGlvIj09PWIpfVxuZnVuY3Rpb24gdGIoYSl7dmFyIGI9c2IoYSk/ImNoZWNrZWQiOiJ2YWx1ZSIsYz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGEuY29uc3RydWN0b3IucHJvdG90eXBlLGIpLGQ9IiIrYVtiXTtpZighYS5oYXNPd25Qcm9wZXJ0eShiKSYmInVuZGVmaW5lZCIhPT10eXBlb2YgYyYmImZ1bmN0aW9uIj09PXR5cGVvZiBjLmdldCYmImZ1bmN0aW9uIj09PXR5cGVvZiBjLnNldCl7dmFyIGU9Yy5nZXQsZj1jLnNldDtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxiLHtjb25maWd1cmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGUuY2FsbCh0aGlzKX0sc2V0OmZ1bmN0aW9uKGEpe2Q9IiIrYTtmLmNhbGwodGhpcyxhKX19KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxiLHtlbnVtZXJhYmxlOmMuZW51bWVyYWJsZX0pO3JldHVybntnZXRWYWx1ZTpmdW5jdGlvbigpe3JldHVybiBkfSxzZXRWYWx1ZTpmdW5jdGlvbihhKXtkPSIiK2F9LHN0b3BUcmFja2luZzpmdW5jdGlvbigpe2EuX3ZhbHVlVHJhY2tlcj1cbm51bGw7ZGVsZXRlIGFbYl19fX19ZnVuY3Rpb24geGIoYSl7YS5fdmFsdWVUcmFja2VyfHwoYS5fdmFsdWVUcmFja2VyPXRiKGEpKX1mdW5jdGlvbiB5YihhKXtpZighYSlyZXR1cm4hMTt2YXIgYj1hLl92YWx1ZVRyYWNrZXI7aWYoIWIpcmV0dXJuITA7dmFyIGM9Yi5nZXRWYWx1ZSgpO3ZhciBkPSIiO2EmJihkPXNiKGEpP2EuY2hlY2tlZD8idHJ1ZSI6ImZhbHNlIjphLnZhbHVlKTthPWQ7cmV0dXJuIGEhPT1jPyhiLnNldFZhbHVlKGEpLCEwKTohMX1mdW5jdGlvbiB6YihhLGIpe3ZhciBjPWIuY2hlY2tlZDtyZXR1cm4gbih7fSxiLHtkZWZhdWx0Q2hlY2tlZDp2b2lkIDAsZGVmYXVsdFZhbHVlOnZvaWQgMCx2YWx1ZTp2b2lkIDAsY2hlY2tlZDpudWxsIT1jP2M6YS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkfSl9XG5mdW5jdGlvbiBBYihhLGIpe3ZhciBjPW51bGw9PWIuZGVmYXVsdFZhbHVlPyIiOmIuZGVmYXVsdFZhbHVlLGQ9bnVsbCE9Yi5jaGVja2VkP2IuY2hlY2tlZDpiLmRlZmF1bHRDaGVja2VkO2M9cmIobnVsbCE9Yi52YWx1ZT9iLnZhbHVlOmMpO2EuX3dyYXBwZXJTdGF0ZT17aW5pdGlhbENoZWNrZWQ6ZCxpbml0aWFsVmFsdWU6Yyxjb250cm9sbGVkOiJjaGVja2JveCI9PT1iLnR5cGV8fCJyYWRpbyI9PT1iLnR5cGU/bnVsbCE9Yi5jaGVja2VkOm51bGwhPWIudmFsdWV9fWZ1bmN0aW9uIEJiKGEsYil7Yj1iLmNoZWNrZWQ7bnVsbCE9YiYmWGEoYSwiY2hlY2tlZCIsYiwhMSl9XG5mdW5jdGlvbiBDYihhLGIpe0JiKGEsYik7dmFyIGM9cmIoYi52YWx1ZSksZD1iLnR5cGU7aWYobnVsbCE9YylpZigibnVtYmVyIj09PWQpe2lmKDA9PT1jJiYiIj09PWEudmFsdWV8fGEudmFsdWUhPWMpYS52YWx1ZT0iIitjfWVsc2UgYS52YWx1ZSE9PSIiK2MmJihhLnZhbHVlPSIiK2MpO2Vsc2UgaWYoInN1Ym1pdCI9PT1kfHwicmVzZXQiPT09ZCl7YS5yZW1vdmVBdHRyaWJ1dGUoInZhbHVlIik7cmV0dXJufWIuaGFzT3duUHJvcGVydHkoInZhbHVlIik/RGIoYSxiLnR5cGUsYyk6Yi5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdFZhbHVlIikmJkRiKGEsYi50eXBlLHJiKGIuZGVmYXVsdFZhbHVlKSk7bnVsbD09Yi5jaGVja2VkJiZudWxsIT1iLmRlZmF1bHRDaGVja2VkJiYoYS5kZWZhdWx0Q2hlY2tlZD0hIWIuZGVmYXVsdENoZWNrZWQpfVxuZnVuY3Rpb24gRWIoYSxiLGMpe2lmKGIuaGFzT3duUHJvcGVydHkoInZhbHVlIil8fGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpKXt2YXIgZD1iLnR5cGU7aWYoISgic3VibWl0IiE9PWQmJiJyZXNldCIhPT1kfHx2b2lkIDAhPT1iLnZhbHVlJiZudWxsIT09Yi52YWx1ZSkpcmV0dXJuO2I9IiIrYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZTtjfHxiPT09YS52YWx1ZXx8KGEudmFsdWU9Yik7YS5kZWZhdWx0VmFsdWU9Yn1jPWEubmFtZTsiIiE9PWMmJihhLm5hbWU9IiIpO2EuZGVmYXVsdENoZWNrZWQ9ISFhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQ7IiIhPT1jJiYoYS5uYW1lPWMpfVxuZnVuY3Rpb24gRGIoYSxiLGMpe2lmKCJudW1iZXIiIT09Ynx8YS5vd25lckRvY3VtZW50LmFjdGl2ZUVsZW1lbnQhPT1hKW51bGw9PWM/YS5kZWZhdWx0VmFsdWU9IiIrYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZTphLmRlZmF1bHRWYWx1ZSE9PSIiK2MmJihhLmRlZmF1bHRWYWx1ZT0iIitjKX1mdW5jdGlvbiBGYihhKXt2YXIgYj0iIjthYS5DaGlsZHJlbi5mb3JFYWNoKGEsZnVuY3Rpb24oYSl7bnVsbCE9YSYmKGIrPWEpfSk7cmV0dXJuIGJ9ZnVuY3Rpb24gR2IoYSxiKXthPW4oe2NoaWxkcmVuOnZvaWQgMH0sYik7aWYoYj1GYihiLmNoaWxkcmVuKSlhLmNoaWxkcmVuPWI7cmV0dXJuIGF9XG5mdW5jdGlvbiBIYihhLGIsYyxkKXthPWEub3B0aW9ucztpZihiKXtiPXt9O2Zvcih2YXIgZT0wO2U8Yy5sZW5ndGg7ZSsrKWJbIiQiK2NbZV1dPSEwO2ZvcihjPTA7YzxhLmxlbmd0aDtjKyspZT1iLmhhc093blByb3BlcnR5KCIkIithW2NdLnZhbHVlKSxhW2NdLnNlbGVjdGVkIT09ZSYmKGFbY10uc2VsZWN0ZWQ9ZSksZSYmZCYmKGFbY10uZGVmYXVsdFNlbGVjdGVkPSEwKX1lbHNle2M9IiIrcmIoYyk7Yj1udWxsO2ZvcihlPTA7ZTxhLmxlbmd0aDtlKyspe2lmKGFbZV0udmFsdWU9PT1jKXthW2VdLnNlbGVjdGVkPSEwO2QmJihhW2VdLmRlZmF1bHRTZWxlY3RlZD0hMCk7cmV0dXJufW51bGwhPT1ifHxhW2VdLmRpc2FibGVkfHwoYj1hW2VdKX1udWxsIT09YiYmKGIuc2VsZWN0ZWQ9ITApfX1cbmZ1bmN0aW9uIEliKGEsYil7aWYobnVsbCE9Yi5kYW5nZXJvdXNseVNldElubmVySFRNTCl0aHJvdyBFcnJvcih1KDkxKSk7cmV0dXJuIG4oe30sYix7dmFsdWU6dm9pZCAwLGRlZmF1bHRWYWx1ZTp2b2lkIDAsY2hpbGRyZW46IiIrYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZX0pfWZ1bmN0aW9uIEpiKGEsYil7dmFyIGM9Yi52YWx1ZTtpZihudWxsPT1jKXtjPWIuY2hpbGRyZW47Yj1iLmRlZmF1bHRWYWx1ZTtpZihudWxsIT1jKXtpZihudWxsIT1iKXRocm93IEVycm9yKHUoOTIpKTtpZihBcnJheS5pc0FycmF5KGMpKXtpZighKDE+PWMubGVuZ3RoKSl0aHJvdyBFcnJvcih1KDkzKSk7Yz1jWzBdfWI9Y31udWxsPT1iJiYoYj0iIik7Yz1ifWEuX3dyYXBwZXJTdGF0ZT17aW5pdGlhbFZhbHVlOnJiKGMpfX1cbmZ1bmN0aW9uIEtiKGEsYil7dmFyIGM9cmIoYi52YWx1ZSksZD1yYihiLmRlZmF1bHRWYWx1ZSk7bnVsbCE9YyYmKGM9IiIrYyxjIT09YS52YWx1ZSYmKGEudmFsdWU9YyksbnVsbD09Yi5kZWZhdWx0VmFsdWUmJmEuZGVmYXVsdFZhbHVlIT09YyYmKGEuZGVmYXVsdFZhbHVlPWMpKTtudWxsIT1kJiYoYS5kZWZhdWx0VmFsdWU9IiIrZCl9ZnVuY3Rpb24gTGIoYSl7dmFyIGI9YS50ZXh0Q29udGVudDtiPT09YS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSYmIiIhPT1iJiZudWxsIT09YiYmKGEudmFsdWU9Yil9dmFyIE1iPXtodG1sOiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIixtYXRobWw6Imh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiLHN2ZzoiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcifTtcbmZ1bmN0aW9uIE5iKGEpe3N3aXRjaChhKXtjYXNlICJzdmciOnJldHVybiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI7Y2FzZSAibWF0aCI6cmV0dXJuImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiO2RlZmF1bHQ6cmV0dXJuImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwifX1mdW5jdGlvbiBPYihhLGIpe3JldHVybiBudWxsPT1hfHwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI9PT1hP05iKGIpOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI9PT1hJiYiZm9yZWlnbk9iamVjdCI9PT1iPyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjphfVxudmFyIFBiLFFiPWZ1bmN0aW9uKGEpe3JldHVybiJ1bmRlZmluZWQiIT09dHlwZW9mIE1TQXBwJiZNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbj9mdW5jdGlvbihiLGMsZCxlKXtNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbihmdW5jdGlvbigpe3JldHVybiBhKGIsYyxkLGUpfSl9OmF9KGZ1bmN0aW9uKGEsYil7aWYoYS5uYW1lc3BhY2VVUkkhPT1NYi5zdmd8fCJpbm5lckhUTUwiaW4gYSlhLmlubmVySFRNTD1iO2Vsc2V7UGI9UGJ8fGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO1BiLmlubmVySFRNTD0iPHN2Zz4iK2IudmFsdWVPZigpLnRvU3RyaW5nKCkrIjwvc3ZnPiI7Zm9yKGI9UGIuZmlyc3RDaGlsZDthLmZpcnN0Q2hpbGQ7KWEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTtmb3IoO2IuZmlyc3RDaGlsZDspYS5hcHBlbmRDaGlsZChiLmZpcnN0Q2hpbGQpfX0pO1xuZnVuY3Rpb24gUmIoYSxiKXtpZihiKXt2YXIgYz1hLmZpcnN0Q2hpbGQ7aWYoYyYmYz09PWEubGFzdENoaWxkJiYzPT09Yy5ub2RlVHlwZSl7Yy5ub2RlVmFsdWU9YjtyZXR1cm59fWEudGV4dENvbnRlbnQ9Yn1mdW5jdGlvbiBTYihhLGIpe3ZhciBjPXt9O2NbYS50b0xvd2VyQ2FzZSgpXT1iLnRvTG93ZXJDYXNlKCk7Y1siV2Via2l0IithXT0id2Via2l0IitiO2NbIk1veiIrYV09Im1veiIrYjtyZXR1cm4gY312YXIgVGI9e2FuaW1hdGlvbmVuZDpTYigiQW5pbWF0aW9uIiwiQW5pbWF0aW9uRW5kIiksYW5pbWF0aW9uaXRlcmF0aW9uOlNiKCJBbmltYXRpb24iLCJBbmltYXRpb25JdGVyYXRpb24iKSxhbmltYXRpb25zdGFydDpTYigiQW5pbWF0aW9uIiwiQW5pbWF0aW9uU3RhcnQiKSx0cmFuc2l0aW9uZW5kOlNiKCJUcmFuc2l0aW9uIiwiVHJhbnNpdGlvbkVuZCIpfSxVYj17fSxWYj17fTtcbnlhJiYoVmI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsIkFuaW1hdGlvbkV2ZW50ImluIHdpbmRvd3x8KGRlbGV0ZSBUYi5hbmltYXRpb25lbmQuYW5pbWF0aW9uLGRlbGV0ZSBUYi5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLGRlbGV0ZSBUYi5hbmltYXRpb25zdGFydC5hbmltYXRpb24pLCJUcmFuc2l0aW9uRXZlbnQiaW4gd2luZG93fHxkZWxldGUgVGIudHJhbnNpdGlvbmVuZC50cmFuc2l0aW9uKTtmdW5jdGlvbiBXYihhKXtpZihVYlthXSlyZXR1cm4gVWJbYV07aWYoIVRiW2FdKXJldHVybiBhO3ZhciBiPVRiW2FdLGM7Zm9yKGMgaW4gYilpZihiLmhhc093blByb3BlcnR5KGMpJiZjIGluIFZiKXJldHVybiBVYlthXT1iW2NdO3JldHVybiBhfVxudmFyIFhiPVdiKCJhbmltYXRpb25lbmQiKSxZYj1XYigiYW5pbWF0aW9uaXRlcmF0aW9uIiksWmI9V2IoImFuaW1hdGlvbnN0YXJ0IiksJGI9V2IoInRyYW5zaXRpb25lbmQiKSxhYz0iYWJvcnQgY2FucGxheSBjYW5wbGF5dGhyb3VnaCBkdXJhdGlvbmNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBsb2FkZWRkYXRhIGxvYWRlZG1ldGFkYXRhIGxvYWRzdGFydCBwYXVzZSBwbGF5IHBsYXlpbmcgcHJvZ3Jlc3MgcmF0ZWNoYW5nZSBzZWVrZWQgc2Vla2luZyBzdGFsbGVkIHN1c3BlbmQgdGltZXVwZGF0ZSB2b2x1bWVjaGFuZ2Ugd2FpdGluZyIuc3BsaXQoIiAiKSxiYz1uZXcgKCJmdW5jdGlvbiI9PT10eXBlb2YgV2Vha01hcD9XZWFrTWFwOk1hcCk7ZnVuY3Rpb24gY2MoYSl7dmFyIGI9YmMuZ2V0KGEpO3ZvaWQgMD09PWImJihiPW5ldyBNYXAsYmMuc2V0KGEsYikpO3JldHVybiBifVxuZnVuY3Rpb24gZGMoYSl7dmFyIGI9YSxjPWE7aWYoYS5hbHRlcm5hdGUpZm9yKDtiLnJldHVybjspYj1iLnJldHVybjtlbHNle2E9YjtkbyBiPWEsMCE9PShiLmVmZmVjdFRhZyYxMDI2KSYmKGM9Yi5yZXR1cm4pLGE9Yi5yZXR1cm47d2hpbGUoYSl9cmV0dXJuIDM9PT1iLnRhZz9jOm51bGx9ZnVuY3Rpb24gZWMoYSl7aWYoMTM9PT1hLnRhZyl7dmFyIGI9YS5tZW1vaXplZFN0YXRlO251bGw9PT1iJiYoYT1hLmFsdGVybmF0ZSxudWxsIT09YSYmKGI9YS5tZW1vaXplZFN0YXRlKSk7aWYobnVsbCE9PWIpcmV0dXJuIGIuZGVoeWRyYXRlZH1yZXR1cm4gbnVsbH1mdW5jdGlvbiBmYyhhKXtpZihkYyhhKSE9PWEpdGhyb3cgRXJyb3IodSgxODgpKTt9XG5mdW5jdGlvbiBnYyhhKXt2YXIgYj1hLmFsdGVybmF0ZTtpZighYil7Yj1kYyhhKTtpZihudWxsPT09Yil0aHJvdyBFcnJvcih1KDE4OCkpO3JldHVybiBiIT09YT9udWxsOmF9Zm9yKHZhciBjPWEsZD1iOzspe3ZhciBlPWMucmV0dXJuO2lmKG51bGw9PT1lKWJyZWFrO3ZhciBmPWUuYWx0ZXJuYXRlO2lmKG51bGw9PT1mKXtkPWUucmV0dXJuO2lmKG51bGwhPT1kKXtjPWQ7Y29udGludWV9YnJlYWt9aWYoZS5jaGlsZD09PWYuY2hpbGQpe2ZvcihmPWUuY2hpbGQ7Zjspe2lmKGY9PT1jKXJldHVybiBmYyhlKSxhO2lmKGY9PT1kKXJldHVybiBmYyhlKSxiO2Y9Zi5zaWJsaW5nfXRocm93IEVycm9yKHUoMTg4KSk7fWlmKGMucmV0dXJuIT09ZC5yZXR1cm4pYz1lLGQ9ZjtlbHNle2Zvcih2YXIgZz0hMSxoPWUuY2hpbGQ7aDspe2lmKGg9PT1jKXtnPSEwO2M9ZTtkPWY7YnJlYWt9aWYoaD09PWQpe2c9ITA7ZD1lO2M9ZjticmVha31oPWguc2libGluZ31pZighZyl7Zm9yKGg9Zi5jaGlsZDtoOyl7aWYoaD09PVxuYyl7Zz0hMDtjPWY7ZD1lO2JyZWFrfWlmKGg9PT1kKXtnPSEwO2Q9ZjtjPWU7YnJlYWt9aD1oLnNpYmxpbmd9aWYoIWcpdGhyb3cgRXJyb3IodSgxODkpKTt9fWlmKGMuYWx0ZXJuYXRlIT09ZCl0aHJvdyBFcnJvcih1KDE5MCkpO31pZigzIT09Yy50YWcpdGhyb3cgRXJyb3IodSgxODgpKTtyZXR1cm4gYy5zdGF0ZU5vZGUuY3VycmVudD09PWM/YTpifWZ1bmN0aW9uIGhjKGEpe2E9Z2MoYSk7aWYoIWEpcmV0dXJuIG51bGw7Zm9yKHZhciBiPWE7Oyl7aWYoNT09PWIudGFnfHw2PT09Yi50YWcpcmV0dXJuIGI7aWYoYi5jaGlsZCliLmNoaWxkLnJldHVybj1iLGI9Yi5jaGlsZDtlbHNle2lmKGI9PT1hKWJyZWFrO2Zvcig7IWIuc2libGluZzspe2lmKCFiLnJldHVybnx8Yi5yZXR1cm49PT1hKXJldHVybiBudWxsO2I9Yi5yZXR1cm59Yi5zaWJsaW5nLnJldHVybj1iLnJldHVybjtiPWIuc2libGluZ319cmV0dXJuIG51bGx9XG5mdW5jdGlvbiBpYyhhLGIpe2lmKG51bGw9PWIpdGhyb3cgRXJyb3IodSgzMCkpO2lmKG51bGw9PWEpcmV0dXJuIGI7aWYoQXJyYXkuaXNBcnJheShhKSl7aWYoQXJyYXkuaXNBcnJheShiKSlyZXR1cm4gYS5wdXNoLmFwcGx5KGEsYiksYTthLnB1c2goYik7cmV0dXJuIGF9cmV0dXJuIEFycmF5LmlzQXJyYXkoYik/W2FdLmNvbmNhdChiKTpbYSxiXX1mdW5jdGlvbiBqYyhhLGIsYyl7QXJyYXkuaXNBcnJheShhKT9hLmZvckVhY2goYixjKTphJiZiLmNhbGwoYyxhKX12YXIga2M9bnVsbDtcbmZ1bmN0aW9uIGxjKGEpe2lmKGEpe3ZhciBiPWEuX2Rpc3BhdGNoTGlzdGVuZXJzLGM9YS5fZGlzcGF0Y2hJbnN0YW5jZXM7aWYoQXJyYXkuaXNBcnJheShiKSlmb3IodmFyIGQ9MDtkPGIubGVuZ3RoJiYhYS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpO2QrKylvYShhLGJbZF0sY1tkXSk7ZWxzZSBiJiZvYShhLGIsYyk7YS5fZGlzcGF0Y2hMaXN0ZW5lcnM9bnVsbDthLl9kaXNwYXRjaEluc3RhbmNlcz1udWxsO2EuaXNQZXJzaXN0ZW50KCl8fGEuY29uc3RydWN0b3IucmVsZWFzZShhKX19ZnVuY3Rpb24gbWMoYSl7bnVsbCE9PWEmJihrYz1pYyhrYyxhKSk7YT1rYztrYz1udWxsO2lmKGEpe2pjKGEsbGMpO2lmKGtjKXRocm93IEVycm9yKHUoOTUpKTtpZihmYSl0aHJvdyBhPWhhLGZhPSExLGhhPW51bGwsYTt9fVxuZnVuY3Rpb24gbmMoYSl7YT1hLnRhcmdldHx8YS5zcmNFbGVtZW50fHx3aW5kb3c7YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCYmKGE9YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCk7cmV0dXJuIDM9PT1hLm5vZGVUeXBlP2EucGFyZW50Tm9kZTphfWZ1bmN0aW9uIG9jKGEpe2lmKCF5YSlyZXR1cm4hMTthPSJvbiIrYTt2YXIgYj1hIGluIGRvY3VtZW50O2J8fChiPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLGIuc2V0QXR0cmlidXRlKGEsInJldHVybjsiKSxiPSJmdW5jdGlvbiI9PT10eXBlb2YgYlthXSk7cmV0dXJuIGJ9dmFyIHBjPVtdO2Z1bmN0aW9uIHFjKGEpe2EudG9wTGV2ZWxUeXBlPW51bGw7YS5uYXRpdmVFdmVudD1udWxsO2EudGFyZ2V0SW5zdD1udWxsO2EuYW5jZXN0b3JzLmxlbmd0aD0wOzEwPnBjLmxlbmd0aCYmcGMucHVzaChhKX1cbmZ1bmN0aW9uIHJjKGEsYixjLGQpe2lmKHBjLmxlbmd0aCl7dmFyIGU9cGMucG9wKCk7ZS50b3BMZXZlbFR5cGU9YTtlLmV2ZW50U3lzdGVtRmxhZ3M9ZDtlLm5hdGl2ZUV2ZW50PWI7ZS50YXJnZXRJbnN0PWM7cmV0dXJuIGV9cmV0dXJue3RvcExldmVsVHlwZTphLGV2ZW50U3lzdGVtRmxhZ3M6ZCxuYXRpdmVFdmVudDpiLHRhcmdldEluc3Q6YyxhbmNlc3RvcnM6W119fVxuZnVuY3Rpb24gc2MoYSl7dmFyIGI9YS50YXJnZXRJbnN0LGM9Yjtkb3tpZighYyl7YS5hbmNlc3RvcnMucHVzaChjKTticmVha312YXIgZD1jO2lmKDM9PT1kLnRhZylkPWQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87ZWxzZXtmb3IoO2QucmV0dXJuOylkPWQucmV0dXJuO2Q9MyE9PWQudGFnP251bGw6ZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mb31pZighZClicmVhaztiPWMudGFnOzUhPT1iJiY2IT09Ynx8YS5hbmNlc3RvcnMucHVzaChjKTtjPXRjKGQpfXdoaWxlKGMpO2ZvcihjPTA7YzxhLmFuY2VzdG9ycy5sZW5ndGg7YysrKXtiPWEuYW5jZXN0b3JzW2NdO3ZhciBlPW5jKGEubmF0aXZlRXZlbnQpO2Q9YS50b3BMZXZlbFR5cGU7dmFyIGY9YS5uYXRpdmVFdmVudCxnPWEuZXZlbnRTeXN0ZW1GbGFnczswPT09YyYmKGd8PTY0KTtmb3IodmFyIGg9bnVsbCxrPTA7azxzYS5sZW5ndGg7aysrKXt2YXIgbD1zYVtrXTtsJiYobD1sLmV4dHJhY3RFdmVudHMoZCxiLGYsZSxnKSkmJihoPVxuaWMoaCxsKSl9bWMoaCl9fWZ1bmN0aW9uIHVjKGEsYixjKXtpZighYy5oYXMoYSkpe3N3aXRjaChhKXtjYXNlICJzY3JvbGwiOnZjKGIsInNjcm9sbCIsITApO2JyZWFrO2Nhc2UgImZvY3VzIjpjYXNlICJibHVyIjp2YyhiLCJmb2N1cyIsITApO3ZjKGIsImJsdXIiLCEwKTtjLnNldCgiYmx1ciIsbnVsbCk7Yy5zZXQoImZvY3VzIixudWxsKTticmVhaztjYXNlICJjYW5jZWwiOmNhc2UgImNsb3NlIjpvYyhhKSYmdmMoYixhLCEwKTticmVhaztjYXNlICJpbnZhbGlkIjpjYXNlICJzdWJtaXQiOmNhc2UgInJlc2V0IjpicmVhaztkZWZhdWx0Oi0xPT09YWMuaW5kZXhPZihhKSYmRihhLGIpfWMuc2V0KGEsbnVsbCl9fVxudmFyIHdjLHhjLHljLHpjPSExLEFjPVtdLEJjPW51bGwsQ2M9bnVsbCxEYz1udWxsLEVjPW5ldyBNYXAsRmM9bmV3IE1hcCxHYz1bXSxIYz0ibW91c2Vkb3duIG1vdXNldXAgdG91Y2hjYW5jZWwgdG91Y2hlbmQgdG91Y2hzdGFydCBhdXhjbGljayBkYmxjbGljayBwb2ludGVyY2FuY2VsIHBvaW50ZXJkb3duIHBvaW50ZXJ1cCBkcmFnZW5kIGRyYWdzdGFydCBkcm9wIGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9uc3RhcnQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBpbnB1dCB0ZXh0SW5wdXQgY2xvc2UgY2FuY2VsIGNvcHkgY3V0IHBhc3RlIGNsaWNrIGNoYW5nZSBjb250ZXh0bWVudSByZXNldCBzdWJtaXQiLnNwbGl0KCIgIiksSWM9ImZvY3VzIGJsdXIgZHJhZ2VudGVyIGRyYWdsZWF2ZSBtb3VzZW92ZXIgbW91c2VvdXQgcG9pbnRlcm92ZXIgcG9pbnRlcm91dCBnb3Rwb2ludGVyY2FwdHVyZSBsb3N0cG9pbnRlcmNhcHR1cmUiLnNwbGl0KCIgIik7XG5mdW5jdGlvbiBKYyhhLGIpe3ZhciBjPWNjKGIpO0hjLmZvckVhY2goZnVuY3Rpb24oYSl7dWMoYSxiLGMpfSk7SWMuZm9yRWFjaChmdW5jdGlvbihhKXt1YyhhLGIsYyl9KX1mdW5jdGlvbiBLYyhhLGIsYyxkLGUpe3JldHVybntibG9ja2VkT246YSx0b3BMZXZlbFR5cGU6YixldmVudFN5c3RlbUZsYWdzOmN8MzIsbmF0aXZlRXZlbnQ6ZSxjb250YWluZXI6ZH19XG5mdW5jdGlvbiBMYyhhLGIpe3N3aXRjaChhKXtjYXNlICJmb2N1cyI6Y2FzZSAiYmx1ciI6QmM9bnVsbDticmVhaztjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdsZWF2ZSI6Q2M9bnVsbDticmVhaztjYXNlICJtb3VzZW92ZXIiOmNhc2UgIm1vdXNlb3V0IjpEYz1udWxsO2JyZWFrO2Nhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVyb3V0IjpFYy5kZWxldGUoYi5wb2ludGVySWQpO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOkZjLmRlbGV0ZShiLnBvaW50ZXJJZCl9fWZ1bmN0aW9uIE1jKGEsYixjLGQsZSxmKXtpZihudWxsPT09YXx8YS5uYXRpdmVFdmVudCE9PWYpcmV0dXJuIGE9S2MoYixjLGQsZSxmKSxudWxsIT09YiYmKGI9TmMoYiksbnVsbCE9PWImJnhjKGIpKSxhO2EuZXZlbnRTeXN0ZW1GbGFnc3w9ZDtyZXR1cm4gYX1cbmZ1bmN0aW9uIE9jKGEsYixjLGQsZSl7c3dpdGNoKGIpe2Nhc2UgImZvY3VzIjpyZXR1cm4gQmM9TWMoQmMsYSxiLGMsZCxlKSwhMDtjYXNlICJkcmFnZW50ZXIiOnJldHVybiBDYz1NYyhDYyxhLGIsYyxkLGUpLCEwO2Nhc2UgIm1vdXNlb3ZlciI6cmV0dXJuIERjPU1jKERjLGEsYixjLGQsZSksITA7Y2FzZSAicG9pbnRlcm92ZXIiOnZhciBmPWUucG9pbnRlcklkO0VjLnNldChmLE1jKEVjLmdldChmKXx8bnVsbCxhLGIsYyxkLGUpKTtyZXR1cm4hMDtjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6cmV0dXJuIGY9ZS5wb2ludGVySWQsRmMuc2V0KGYsTWMoRmMuZ2V0KGYpfHxudWxsLGEsYixjLGQsZSkpLCEwfXJldHVybiExfVxuZnVuY3Rpb24gUGMoYSl7dmFyIGI9dGMoYS50YXJnZXQpO2lmKG51bGwhPT1iKXt2YXIgYz1kYyhiKTtpZihudWxsIT09YylpZihiPWMudGFnLDEzPT09Yil7aWYoYj1lYyhjKSxudWxsIT09Yil7YS5ibG9ja2VkT249YjtyLnVuc3RhYmxlX3J1bldpdGhQcmlvcml0eShhLnByaW9yaXR5LGZ1bmN0aW9uKCl7eWMoYyl9KTtyZXR1cm59fWVsc2UgaWYoMz09PWImJmMuc3RhdGVOb2RlLmh5ZHJhdGUpe2EuYmxvY2tlZE9uPTM9PT1jLnRhZz9jLnN0YXRlTm9kZS5jb250YWluZXJJbmZvOm51bGw7cmV0dXJufX1hLmJsb2NrZWRPbj1udWxsfWZ1bmN0aW9uIFFjKGEpe2lmKG51bGwhPT1hLmJsb2NrZWRPbilyZXR1cm4hMTt2YXIgYj1SYyhhLnRvcExldmVsVHlwZSxhLmV2ZW50U3lzdGVtRmxhZ3MsYS5jb250YWluZXIsYS5uYXRpdmVFdmVudCk7aWYobnVsbCE9PWIpe3ZhciBjPU5jKGIpO251bGwhPT1jJiZ4YyhjKTthLmJsb2NrZWRPbj1iO3JldHVybiExfXJldHVybiEwfVxuZnVuY3Rpb24gU2MoYSxiLGMpe1FjKGEpJiZjLmRlbGV0ZShiKX1mdW5jdGlvbiBUYygpe2Zvcih6Yz0hMTswPEFjLmxlbmd0aDspe3ZhciBhPUFjWzBdO2lmKG51bGwhPT1hLmJsb2NrZWRPbil7YT1OYyhhLmJsb2NrZWRPbik7bnVsbCE9PWEmJndjKGEpO2JyZWFrfXZhciBiPVJjKGEudG9wTGV2ZWxUeXBlLGEuZXZlbnRTeXN0ZW1GbGFncyxhLmNvbnRhaW5lcixhLm5hdGl2ZUV2ZW50KTtudWxsIT09Yj9hLmJsb2NrZWRPbj1iOkFjLnNoaWZ0KCl9bnVsbCE9PUJjJiZRYyhCYykmJihCYz1udWxsKTtudWxsIT09Q2MmJlFjKENjKSYmKENjPW51bGwpO251bGwhPT1EYyYmUWMoRGMpJiYoRGM9bnVsbCk7RWMuZm9yRWFjaChTYyk7RmMuZm9yRWFjaChTYyl9ZnVuY3Rpb24gVWMoYSxiKXthLmJsb2NrZWRPbj09PWImJihhLmJsb2NrZWRPbj1udWxsLHpjfHwoemM9ITAsci51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrKHIudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksVGMpKSl9XG5mdW5jdGlvbiBWYyhhKXtmdW5jdGlvbiBiKGIpe3JldHVybiBVYyhiLGEpfWlmKDA8QWMubGVuZ3RoKXtVYyhBY1swXSxhKTtmb3IodmFyIGM9MTtjPEFjLmxlbmd0aDtjKyspe3ZhciBkPUFjW2NdO2QuYmxvY2tlZE9uPT09YSYmKGQuYmxvY2tlZE9uPW51bGwpfX1udWxsIT09QmMmJlVjKEJjLGEpO251bGwhPT1DYyYmVWMoQ2MsYSk7bnVsbCE9PURjJiZVYyhEYyxhKTtFYy5mb3JFYWNoKGIpO0ZjLmZvckVhY2goYik7Zm9yKGM9MDtjPEdjLmxlbmd0aDtjKyspZD1HY1tjXSxkLmJsb2NrZWRPbj09PWEmJihkLmJsb2NrZWRPbj1udWxsKTtmb3IoOzA8R2MubGVuZ3RoJiYoYz1HY1swXSxudWxsPT09Yy5ibG9ja2VkT24pOylQYyhjKSxudWxsPT09Yy5ibG9ja2VkT24mJkdjLnNoaWZ0KCl9XG52YXIgV2M9e30sWWM9bmV3IE1hcCxaYz1uZXcgTWFwLCRjPVsiYWJvcnQiLCJhYm9ydCIsWGIsImFuaW1hdGlvbkVuZCIsWWIsImFuaW1hdGlvbkl0ZXJhdGlvbiIsWmIsImFuaW1hdGlvblN0YXJ0IiwiY2FucGxheSIsImNhblBsYXkiLCJjYW5wbGF5dGhyb3VnaCIsImNhblBsYXlUaHJvdWdoIiwiZHVyYXRpb25jaGFuZ2UiLCJkdXJhdGlvbkNoYW5nZSIsImVtcHRpZWQiLCJlbXB0aWVkIiwiZW5jcnlwdGVkIiwiZW5jcnlwdGVkIiwiZW5kZWQiLCJlbmRlZCIsImVycm9yIiwiZXJyb3IiLCJnb3Rwb2ludGVyY2FwdHVyZSIsImdvdFBvaW50ZXJDYXB0dXJlIiwibG9hZCIsImxvYWQiLCJsb2FkZWRkYXRhIiwibG9hZGVkRGF0YSIsImxvYWRlZG1ldGFkYXRhIiwibG9hZGVkTWV0YWRhdGEiLCJsb2Fkc3RhcnQiLCJsb2FkU3RhcnQiLCJsb3N0cG9pbnRlcmNhcHR1cmUiLCJsb3N0UG9pbnRlckNhcHR1cmUiLCJwbGF5aW5nIiwicGxheWluZyIsInByb2dyZXNzIiwicHJvZ3Jlc3MiLCJzZWVraW5nIixcbiJzZWVraW5nIiwic3RhbGxlZCIsInN0YWxsZWQiLCJzdXNwZW5kIiwic3VzcGVuZCIsInRpbWV1cGRhdGUiLCJ0aW1lVXBkYXRlIiwkYiwidHJhbnNpdGlvbkVuZCIsIndhaXRpbmciLCJ3YWl0aW5nIl07ZnVuY3Rpb24gYWQoYSxiKXtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrPTIpe3ZhciBkPWFbY10sZT1hW2MrMV0sZj0ib24iKyhlWzBdLnRvVXBwZXJDYXNlKCkrZS5zbGljZSgxKSk7Zj17cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6ZixjYXB0dXJlZDpmKyJDYXB0dXJlIn0sZGVwZW5kZW5jaWVzOltkXSxldmVudFByaW9yaXR5OmJ9O1pjLnNldChkLGIpO1ljLnNldChkLGYpO1djW2VdPWZ9fVxuYWQoImJsdXIgYmx1ciBjYW5jZWwgY2FuY2VsIGNsaWNrIGNsaWNrIGNsb3NlIGNsb3NlIGNvbnRleHRtZW51IGNvbnRleHRNZW51IGNvcHkgY29weSBjdXQgY3V0IGF1eGNsaWNrIGF1eENsaWNrIGRibGNsaWNrIGRvdWJsZUNsaWNrIGRyYWdlbmQgZHJhZ0VuZCBkcmFnc3RhcnQgZHJhZ1N0YXJ0IGRyb3AgZHJvcCBmb2N1cyBmb2N1cyBpbnB1dCBpbnB1dCBpbnZhbGlkIGludmFsaWQga2V5ZG93biBrZXlEb3duIGtleXByZXNzIGtleVByZXNzIGtleXVwIGtleVVwIG1vdXNlZG93biBtb3VzZURvd24gbW91c2V1cCBtb3VzZVVwIHBhc3RlIHBhc3RlIHBhdXNlIHBhdXNlIHBsYXkgcGxheSBwb2ludGVyY2FuY2VsIHBvaW50ZXJDYW5jZWwgcG9pbnRlcmRvd24gcG9pbnRlckRvd24gcG9pbnRlcnVwIHBvaW50ZXJVcCByYXRlY2hhbmdlIHJhdGVDaGFuZ2UgcmVzZXQgcmVzZXQgc2Vla2VkIHNlZWtlZCBzdWJtaXQgc3VibWl0IHRvdWNoY2FuY2VsIHRvdWNoQ2FuY2VsIHRvdWNoZW5kIHRvdWNoRW5kIHRvdWNoc3RhcnQgdG91Y2hTdGFydCB2b2x1bWVjaGFuZ2Ugdm9sdW1lQ2hhbmdlIi5zcGxpdCgiICIpLDApO1xuYWQoImRyYWcgZHJhZyBkcmFnZW50ZXIgZHJhZ0VudGVyIGRyYWdleGl0IGRyYWdFeGl0IGRyYWdsZWF2ZSBkcmFnTGVhdmUgZHJhZ292ZXIgZHJhZ092ZXIgbW91c2Vtb3ZlIG1vdXNlTW92ZSBtb3VzZW91dCBtb3VzZU91dCBtb3VzZW92ZXIgbW91c2VPdmVyIHBvaW50ZXJtb3ZlIHBvaW50ZXJNb3ZlIHBvaW50ZXJvdXQgcG9pbnRlck91dCBwb2ludGVyb3ZlciBwb2ludGVyT3ZlciBzY3JvbGwgc2Nyb2xsIHRvZ2dsZSB0b2dnbGUgdG91Y2htb3ZlIHRvdWNoTW92ZSB3aGVlbCB3aGVlbCIuc3BsaXQoIiAiKSwxKTthZCgkYywyKTtmb3IodmFyIGJkPSJjaGFuZ2Ugc2VsZWN0aW9uY2hhbmdlIHRleHRJbnB1dCBjb21wb3NpdGlvbnN0YXJ0IGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9udXBkYXRlIi5zcGxpdCgiICIpLGNkPTA7Y2Q8YmQubGVuZ3RoO2NkKyspWmMuc2V0KGJkW2NkXSwwKTtcbnZhciBkZD1yLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5LGVkPXIudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5LGZkPSEwO2Z1bmN0aW9uIEYoYSxiKXt2YyhiLGEsITEpfWZ1bmN0aW9uIHZjKGEsYixjKXt2YXIgZD1aYy5nZXQoYik7c3dpdGNoKHZvaWQgMD09PWQ/MjpkKXtjYXNlIDA6ZD1nZC5iaW5kKG51bGwsYiwxLGEpO2JyZWFrO2Nhc2UgMTpkPWhkLmJpbmQobnVsbCxiLDEsYSk7YnJlYWs7ZGVmYXVsdDpkPWlkLmJpbmQobnVsbCxiLDEsYSl9Yz9hLmFkZEV2ZW50TGlzdGVuZXIoYixkLCEwKTphLmFkZEV2ZW50TGlzdGVuZXIoYixkLCExKX1mdW5jdGlvbiBnZChhLGIsYyxkKXtKYXx8SGEoKTt2YXIgZT1pZCxmPUphO0phPSEwO3RyeXtHYShlLGEsYixjLGQpfWZpbmFsbHl7KEphPWYpfHxMYSgpfX1mdW5jdGlvbiBoZChhLGIsYyxkKXtlZChkZCxpZC5iaW5kKG51bGwsYSxiLGMsZCkpfVxuZnVuY3Rpb24gaWQoYSxiLGMsZCl7aWYoZmQpaWYoMDxBYy5sZW5ndGgmJi0xPEhjLmluZGV4T2YoYSkpYT1LYyhudWxsLGEsYixjLGQpLEFjLnB1c2goYSk7ZWxzZXt2YXIgZT1SYyhhLGIsYyxkKTtpZihudWxsPT09ZSlMYyhhLGQpO2Vsc2UgaWYoLTE8SGMuaW5kZXhPZihhKSlhPUtjKGUsYSxiLGMsZCksQWMucHVzaChhKTtlbHNlIGlmKCFPYyhlLGEsYixjLGQpKXtMYyhhLGQpO2E9cmMoYSxkLG51bGwsYik7dHJ5e01hKHNjLGEpfWZpbmFsbHl7cWMoYSl9fX19XG5mdW5jdGlvbiBSYyhhLGIsYyxkKXtjPW5jKGQpO2M9dGMoYyk7aWYobnVsbCE9PWMpe3ZhciBlPWRjKGMpO2lmKG51bGw9PT1lKWM9bnVsbDtlbHNle3ZhciBmPWUudGFnO2lmKDEzPT09Zil7Yz1lYyhlKTtpZihudWxsIT09YylyZXR1cm4gYztjPW51bGx9ZWxzZSBpZigzPT09Zil7aWYoZS5zdGF0ZU5vZGUuaHlkcmF0ZSlyZXR1cm4gMz09PWUudGFnP2Uuc3RhdGVOb2RlLmNvbnRhaW5lckluZm86bnVsbDtjPW51bGx9ZWxzZSBlIT09YyYmKGM9bnVsbCl9fWE9cmMoYSxkLGMsYik7dHJ5e01hKHNjLGEpfWZpbmFsbHl7cWMoYSl9cmV0dXJuIG51bGx9XG52YXIgamQ9e2FuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiEwLGJvcmRlckltYWdlT3V0c2V0OiEwLGJvcmRlckltYWdlU2xpY2U6ITAsYm9yZGVySW1hZ2VXaWR0aDohMCxib3hGbGV4OiEwLGJveEZsZXhHcm91cDohMCxib3hPcmRpbmFsR3JvdXA6ITAsY29sdW1uQ291bnQ6ITAsY29sdW1uczohMCxmbGV4OiEwLGZsZXhHcm93OiEwLGZsZXhQb3NpdGl2ZTohMCxmbGV4U2hyaW5rOiEwLGZsZXhOZWdhdGl2ZTohMCxmbGV4T3JkZXI6ITAsZ3JpZEFyZWE6ITAsZ3JpZFJvdzohMCxncmlkUm93RW5kOiEwLGdyaWRSb3dTcGFuOiEwLGdyaWRSb3dTdGFydDohMCxncmlkQ29sdW1uOiEwLGdyaWRDb2x1bW5FbmQ6ITAsZ3JpZENvbHVtblNwYW46ITAsZ3JpZENvbHVtblN0YXJ0OiEwLGZvbnRXZWlnaHQ6ITAsbGluZUNsYW1wOiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHRhYlNpemU6ITAsd2lkb3dzOiEwLHpJbmRleDohMCx6b29tOiEwLGZpbGxPcGFjaXR5OiEwLFxuZmxvb2RPcGFjaXR5OiEwLHN0b3BPcGFjaXR5OiEwLHN0cm9rZURhc2hhcnJheTohMCxzdHJva2VEYXNob2Zmc2V0OiEwLHN0cm9rZU1pdGVybGltaXQ6ITAsc3Ryb2tlT3BhY2l0eTohMCxzdHJva2VXaWR0aDohMH0sa2Q9WyJXZWJraXQiLCJtcyIsIk1veiIsIk8iXTtPYmplY3Qua2V5cyhqZCkuZm9yRWFjaChmdW5jdGlvbihhKXtrZC5mb3JFYWNoKGZ1bmN0aW9uKGIpe2I9YithLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK2Euc3Vic3RyaW5nKDEpO2pkW2JdPWpkW2FdfSl9KTtmdW5jdGlvbiBsZChhLGIsYyl7cmV0dXJuIG51bGw9PWJ8fCJib29sZWFuIj09PXR5cGVvZiBifHwiIj09PWI/IiI6Y3x8Im51bWJlciIhPT10eXBlb2YgYnx8MD09PWJ8fGpkLmhhc093blByb3BlcnR5KGEpJiZqZFthXT8oIiIrYikudHJpbSgpOmIrInB4In1cbmZ1bmN0aW9uIG1kKGEsYil7YT1hLnN0eWxlO2Zvcih2YXIgYyBpbiBiKWlmKGIuaGFzT3duUHJvcGVydHkoYykpe3ZhciBkPTA9PT1jLmluZGV4T2YoIi0tIiksZT1sZChjLGJbY10sZCk7ImZsb2F0Ij09PWMmJihjPSJjc3NGbG9hdCIpO2Q/YS5zZXRQcm9wZXJ0eShjLGUpOmFbY109ZX19dmFyIG5kPW4oe21lbnVpdGVtOiEwfSx7YXJlYTohMCxiYXNlOiEwLGJyOiEwLGNvbDohMCxlbWJlZDohMCxocjohMCxpbWc6ITAsaW5wdXQ6ITAsa2V5Z2VuOiEwLGxpbms6ITAsbWV0YTohMCxwYXJhbTohMCxzb3VyY2U6ITAsdHJhY2s6ITAsd2JyOiEwfSk7XG5mdW5jdGlvbiBvZChhLGIpe2lmKGIpe2lmKG5kW2FdJiYobnVsbCE9Yi5jaGlsZHJlbnx8bnVsbCE9Yi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpdGhyb3cgRXJyb3IodSgxMzcsYSwiIikpO2lmKG51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpe2lmKG51bGwhPWIuY2hpbGRyZW4pdGhyb3cgRXJyb3IodSg2MCkpO2lmKCEoIm9iamVjdCI9PT10eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCYmIl9faHRtbCJpbiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSl0aHJvdyBFcnJvcih1KDYxKSk7fWlmKG51bGwhPWIuc3R5bGUmJiJvYmplY3QiIT09dHlwZW9mIGIuc3R5bGUpdGhyb3cgRXJyb3IodSg2MiwiIikpO319XG5mdW5jdGlvbiBwZChhLGIpe2lmKC0xPT09YS5pbmRleE9mKCItIikpcmV0dXJuInN0cmluZyI9PT10eXBlb2YgYi5pcztzd2l0Y2goYSl7Y2FzZSAiYW5ub3RhdGlvbi14bWwiOmNhc2UgImNvbG9yLXByb2ZpbGUiOmNhc2UgImZvbnQtZmFjZSI6Y2FzZSAiZm9udC1mYWNlLXNyYyI6Y2FzZSAiZm9udC1mYWNlLXVyaSI6Y2FzZSAiZm9udC1mYWNlLWZvcm1hdCI6Y2FzZSAiZm9udC1mYWNlLW5hbWUiOmNhc2UgIm1pc3NpbmctZ2x5cGgiOnJldHVybiExO2RlZmF1bHQ6cmV0dXJuITB9fXZhciBxZD1NYi5odG1sO2Z1bmN0aW9uIHJkKGEsYil7YT05PT09YS5ub2RlVHlwZXx8MTE9PT1hLm5vZGVUeXBlP2E6YS5vd25lckRvY3VtZW50O3ZhciBjPWNjKGEpO2I9d2FbYl07Zm9yKHZhciBkPTA7ZDxiLmxlbmd0aDtkKyspdWMoYltkXSxhLGMpfWZ1bmN0aW9uIHNkKCl7fVxuZnVuY3Rpb24gdGQoYSl7YT1hfHwoInVuZGVmaW5lZCIhPT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQ6dm9pZCAwKTtpZigidW5kZWZpbmVkIj09PXR5cGVvZiBhKXJldHVybiBudWxsO3RyeXtyZXR1cm4gYS5hY3RpdmVFbGVtZW50fHxhLmJvZHl9Y2F0Y2goYil7cmV0dXJuIGEuYm9keX19ZnVuY3Rpb24gdWQoYSl7Zm9yKDthJiZhLmZpcnN0Q2hpbGQ7KWE9YS5maXJzdENoaWxkO3JldHVybiBhfWZ1bmN0aW9uIHZkKGEsYil7dmFyIGM9dWQoYSk7YT0wO2Zvcih2YXIgZDtjOyl7aWYoMz09PWMubm9kZVR5cGUpe2Q9YStjLnRleHRDb250ZW50Lmxlbmd0aDtpZihhPD1iJiZkPj1iKXJldHVybntub2RlOmMsb2Zmc2V0OmItYX07YT1kfWE6e2Zvcig7Yzspe2lmKGMubmV4dFNpYmxpbmcpe2M9Yy5uZXh0U2libGluZzticmVhayBhfWM9Yy5wYXJlbnROb2RlfWM9dm9pZCAwfWM9dWQoYyl9fVxuZnVuY3Rpb24gd2QoYSxiKXtyZXR1cm4gYSYmYj9hPT09Yj8hMDphJiYzPT09YS5ub2RlVHlwZT8hMTpiJiYzPT09Yi5ub2RlVHlwZT93ZChhLGIucGFyZW50Tm9kZSk6ImNvbnRhaW5zImluIGE/YS5jb250YWlucyhiKTphLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPyEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikmMTYpOiExOiExfWZ1bmN0aW9uIHhkKCl7Zm9yKHZhciBhPXdpbmRvdyxiPXRkKCk7YiBpbnN0YW5jZW9mIGEuSFRNTElGcmFtZUVsZW1lbnQ7KXt0cnl7dmFyIGM9InN0cmluZyI9PT10eXBlb2YgYi5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWZ9Y2F0Y2goZCl7Yz0hMX1pZihjKWE9Yi5jb250ZW50V2luZG93O2Vsc2UgYnJlYWs7Yj10ZChhLmRvY3VtZW50KX1yZXR1cm4gYn1cbmZ1bmN0aW9uIHlkKGEpe3ZhciBiPWEmJmEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYiYmKCJpbnB1dCI9PT1iJiYoInRleHQiPT09YS50eXBlfHwic2VhcmNoIj09PWEudHlwZXx8InRlbCI9PT1hLnR5cGV8fCJ1cmwiPT09YS50eXBlfHwicGFzc3dvcmQiPT09YS50eXBlKXx8InRleHRhcmVhIj09PWJ8fCJ0cnVlIj09PWEuY29udGVudEVkaXRhYmxlKX12YXIgemQ9IiQiLEFkPSIvJCIsQmQ9IiQ/IixDZD0iJCEiLERkPW51bGwsRWQ9bnVsbDtmdW5jdGlvbiBGZChhLGIpe3N3aXRjaChhKXtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjpyZXR1cm4hIWIuYXV0b0ZvY3VzfXJldHVybiExfVxuZnVuY3Rpb24gR2QoYSxiKXtyZXR1cm4idGV4dGFyZWEiPT09YXx8Im9wdGlvbiI9PT1hfHwibm9zY3JpcHQiPT09YXx8InN0cmluZyI9PT10eXBlb2YgYi5jaGlsZHJlbnx8Im51bWJlciI9PT10eXBlb2YgYi5jaGlsZHJlbnx8Im9iamVjdCI9PT10eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCYmbnVsbCE9PWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwmJm51bGwhPWIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwuX19odG1sfXZhciBIZD0iZnVuY3Rpb24iPT09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDp2b2lkIDAsSWQ9ImZ1bmN0aW9uIj09PXR5cGVvZiBjbGVhclRpbWVvdXQ/Y2xlYXJUaW1lb3V0OnZvaWQgMDtmdW5jdGlvbiBKZChhKXtmb3IoO251bGwhPWE7YT1hLm5leHRTaWJsaW5nKXt2YXIgYj1hLm5vZGVUeXBlO2lmKDE9PT1ifHwzPT09YilicmVha31yZXR1cm4gYX1cbmZ1bmN0aW9uIEtkKGEpe2E9YS5wcmV2aW91c1NpYmxpbmc7Zm9yKHZhciBiPTA7YTspe2lmKDg9PT1hLm5vZGVUeXBlKXt2YXIgYz1hLmRhdGE7aWYoYz09PXpkfHxjPT09Q2R8fGM9PT1CZCl7aWYoMD09PWIpcmV0dXJuIGE7Yi0tfWVsc2UgYz09PUFkJiZiKyt9YT1hLnByZXZpb3VzU2libGluZ31yZXR1cm4gbnVsbH12YXIgTGQ9TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiksTWQ9Il9fcmVhY3RJbnRlcm5hbEluc3RhbmNlJCIrTGQsTmQ9Il9fcmVhY3RFdmVudEhhbmRsZXJzJCIrTGQsT2Q9Il9fcmVhY3RDb250YWluZXJlJCIrTGQ7XG5mdW5jdGlvbiB0YyhhKXt2YXIgYj1hW01kXTtpZihiKXJldHVybiBiO2Zvcih2YXIgYz1hLnBhcmVudE5vZGU7Yzspe2lmKGI9Y1tPZF18fGNbTWRdKXtjPWIuYWx0ZXJuYXRlO2lmKG51bGwhPT1iLmNoaWxkfHxudWxsIT09YyYmbnVsbCE9PWMuY2hpbGQpZm9yKGE9S2QoYSk7bnVsbCE9PWE7KXtpZihjPWFbTWRdKXJldHVybiBjO2E9S2QoYSl9cmV0dXJuIGJ9YT1jO2M9YS5wYXJlbnROb2RlfXJldHVybiBudWxsfWZ1bmN0aW9uIE5jKGEpe2E9YVtNZF18fGFbT2RdO3JldHVybiFhfHw1IT09YS50YWcmJjYhPT1hLnRhZyYmMTMhPT1hLnRhZyYmMyE9PWEudGFnP251bGw6YX1mdW5jdGlvbiBQZChhKXtpZig1PT09YS50YWd8fDY9PT1hLnRhZylyZXR1cm4gYS5zdGF0ZU5vZGU7dGhyb3cgRXJyb3IodSgzMykpO31mdW5jdGlvbiBRZChhKXtyZXR1cm4gYVtOZF18fG51bGx9XG5mdW5jdGlvbiBSZChhKXtkbyBhPWEucmV0dXJuO3doaWxlKGEmJjUhPT1hLnRhZyk7cmV0dXJuIGE/YTpudWxsfVxuZnVuY3Rpb24gU2QoYSxiKXt2YXIgYz1hLnN0YXRlTm9kZTtpZighYylyZXR1cm4gbnVsbDt2YXIgZD1sYShjKTtpZighZClyZXR1cm4gbnVsbDtjPWRbYl07YTpzd2l0Y2goYil7Y2FzZSAib25DbGljayI6Y2FzZSAib25DbGlja0NhcHR1cmUiOmNhc2UgIm9uRG91YmxlQ2xpY2siOmNhc2UgIm9uRG91YmxlQ2xpY2tDYXB0dXJlIjpjYXNlICJvbk1vdXNlRG93biI6Y2FzZSAib25Nb3VzZURvd25DYXB0dXJlIjpjYXNlICJvbk1vdXNlTW92ZSI6Y2FzZSAib25Nb3VzZU1vdmVDYXB0dXJlIjpjYXNlICJvbk1vdXNlVXAiOmNhc2UgIm9uTW91c2VVcENhcHR1cmUiOmNhc2UgIm9uTW91c2VFbnRlciI6KGQ9IWQuZGlzYWJsZWQpfHwoYT1hLnR5cGUsZD0hKCJidXR0b24iPT09YXx8ImlucHV0Ij09PWF8fCJzZWxlY3QiPT09YXx8InRleHRhcmVhIj09PWEpKTthPSFkO2JyZWFrIGE7ZGVmYXVsdDphPSExfWlmKGEpcmV0dXJuIG51bGw7aWYoYyYmImZ1bmN0aW9uIiE9PXR5cGVvZiBjKXRocm93IEVycm9yKHUoMjMxLFxuYix0eXBlb2YgYykpO3JldHVybiBjfWZ1bmN0aW9uIFRkKGEsYixjKXtpZihiPVNkKGEsYy5kaXNwYXRjaENvbmZpZy5waGFzZWRSZWdpc3RyYXRpb25OYW1lc1tiXSkpYy5fZGlzcGF0Y2hMaXN0ZW5lcnM9aWMoYy5fZGlzcGF0Y2hMaXN0ZW5lcnMsYiksYy5fZGlzcGF0Y2hJbnN0YW5jZXM9aWMoYy5fZGlzcGF0Y2hJbnN0YW5jZXMsYSl9ZnVuY3Rpb24gVWQoYSl7aWYoYSYmYS5kaXNwYXRjaENvbmZpZy5waGFzZWRSZWdpc3RyYXRpb25OYW1lcyl7Zm9yKHZhciBiPWEuX3RhcmdldEluc3QsYz1bXTtiOyljLnB1c2goYiksYj1SZChiKTtmb3IoYj1jLmxlbmd0aDswPGItLTspVGQoY1tiXSwiY2FwdHVyZWQiLGEpO2ZvcihiPTA7YjxjLmxlbmd0aDtiKyspVGQoY1tiXSwiYnViYmxlZCIsYSl9fVxuZnVuY3Rpb24gVmQoYSxiLGMpe2EmJmMmJmMuZGlzcGF0Y2hDb25maWcucmVnaXN0cmF0aW9uTmFtZSYmKGI9U2QoYSxjLmRpc3BhdGNoQ29uZmlnLnJlZ2lzdHJhdGlvbk5hbWUpKSYmKGMuX2Rpc3BhdGNoTGlzdGVuZXJzPWljKGMuX2Rpc3BhdGNoTGlzdGVuZXJzLGIpLGMuX2Rpc3BhdGNoSW5zdGFuY2VzPWljKGMuX2Rpc3BhdGNoSW5zdGFuY2VzLGEpKX1mdW5jdGlvbiBXZChhKXthJiZhLmRpc3BhdGNoQ29uZmlnLnJlZ2lzdHJhdGlvbk5hbWUmJlZkKGEuX3RhcmdldEluc3QsbnVsbCxhKX1mdW5jdGlvbiBYZChhKXtqYyhhLFVkKX12YXIgWWQ9bnVsbCxaZD1udWxsLCRkPW51bGw7XG5mdW5jdGlvbiBhZSgpe2lmKCRkKXJldHVybiAkZDt2YXIgYSxiPVpkLGM9Yi5sZW5ndGgsZCxlPSJ2YWx1ZSJpbiBZZD9ZZC52YWx1ZTpZZC50ZXh0Q29udGVudCxmPWUubGVuZ3RoO2ZvcihhPTA7YTxjJiZiW2FdPT09ZVthXTthKyspO3ZhciBnPWMtYTtmb3IoZD0xO2Q8PWcmJmJbYy1kXT09PWVbZi1kXTtkKyspO3JldHVybiAkZD1lLnNsaWNlKGEsMTxkPzEtZDp2b2lkIDApfWZ1bmN0aW9uIGJlKCl7cmV0dXJuITB9ZnVuY3Rpb24gY2UoKXtyZXR1cm4hMX1cbmZ1bmN0aW9uIEcoYSxiLGMsZCl7dGhpcy5kaXNwYXRjaENvbmZpZz1hO3RoaXMuX3RhcmdldEluc3Q9Yjt0aGlzLm5hdGl2ZUV2ZW50PWM7YT10aGlzLmNvbnN0cnVjdG9yLkludGVyZmFjZTtmb3IodmFyIGUgaW4gYSlhLmhhc093blByb3BlcnR5KGUpJiYoKGI9YVtlXSk/dGhpc1tlXT1iKGMpOiJ0YXJnZXQiPT09ZT90aGlzLnRhcmdldD1kOnRoaXNbZV09Y1tlXSk7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9KG51bGwhPWMuZGVmYXVsdFByZXZlbnRlZD9jLmRlZmF1bHRQcmV2ZW50ZWQ6ITE9PT1jLnJldHVyblZhbHVlKT9iZTpjZTt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPWNlO3JldHVybiB0aGlzfVxubihHLnByb3RvdHlwZSx7cHJldmVudERlZmF1bHQ6ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITA7dmFyIGE9dGhpcy5uYXRpdmVFdmVudDthJiYoYS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6InVua25vd24iIT09dHlwZW9mIGEucmV0dXJuVmFsdWUmJihhLnJldHVyblZhbHVlPSExKSx0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1iZSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3ZhciBhPXRoaXMubmF0aXZlRXZlbnQ7YSYmKGEuc3RvcFByb3BhZ2F0aW9uP2Euc3RvcFByb3BhZ2F0aW9uKCk6InVua25vd24iIT09dHlwZW9mIGEuY2FuY2VsQnViYmxlJiYoYS5jYW5jZWxCdWJibGU9ITApLHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQ9YmUpfSxwZXJzaXN0OmZ1bmN0aW9uKCl7dGhpcy5pc1BlcnNpc3RlbnQ9YmV9LGlzUGVyc2lzdGVudDpjZSxkZXN0cnVjdG9yOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jb25zdHJ1Y3Rvci5JbnRlcmZhY2UsXG5iO2ZvcihiIGluIGEpdGhpc1tiXT1udWxsO3RoaXMubmF0aXZlRXZlbnQ9dGhpcy5fdGFyZ2V0SW5zdD10aGlzLmRpc3BhdGNoQ29uZmlnPW51bGw7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD10aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1jZTt0aGlzLl9kaXNwYXRjaEluc3RhbmNlcz10aGlzLl9kaXNwYXRjaExpc3RlbmVycz1udWxsfX0pO0cuSW50ZXJmYWNlPXt0eXBlOm51bGwsdGFyZ2V0Om51bGwsY3VycmVudFRhcmdldDpmdW5jdGlvbigpe3JldHVybiBudWxsfSxldmVudFBoYXNlOm51bGwsYnViYmxlczpudWxsLGNhbmNlbGFibGU6bnVsbCx0aW1lU3RhbXA6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudGltZVN0YW1wfHxEYXRlLm5vdygpfSxkZWZhdWx0UHJldmVudGVkOm51bGwsaXNUcnVzdGVkOm51bGx9O1xuRy5leHRlbmQ9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe31mdW5jdGlvbiBjKCl7cmV0dXJuIGQuYXBwbHkodGhpcyxhcmd1bWVudHMpfXZhciBkPXRoaXM7Yi5wcm90b3R5cGU9ZC5wcm90b3R5cGU7dmFyIGU9bmV3IGI7bihlLGMucHJvdG90eXBlKTtjLnByb3RvdHlwZT1lO2MucHJvdG90eXBlLmNvbnN0cnVjdG9yPWM7Yy5JbnRlcmZhY2U9bih7fSxkLkludGVyZmFjZSxhKTtjLmV4dGVuZD1kLmV4dGVuZDtkZShjKTtyZXR1cm4gY307ZGUoRyk7ZnVuY3Rpb24gZWUoYSxiLGMsZCl7aWYodGhpcy5ldmVudFBvb2wubGVuZ3RoKXt2YXIgZT10aGlzLmV2ZW50UG9vbC5wb3AoKTt0aGlzLmNhbGwoZSxhLGIsYyxkKTtyZXR1cm4gZX1yZXR1cm4gbmV3IHRoaXMoYSxiLGMsZCl9XG5mdW5jdGlvbiBmZShhKXtpZighKGEgaW5zdGFuY2VvZiB0aGlzKSl0aHJvdyBFcnJvcih1KDI3OSkpO2EuZGVzdHJ1Y3RvcigpOzEwPnRoaXMuZXZlbnRQb29sLmxlbmd0aCYmdGhpcy5ldmVudFBvb2wucHVzaChhKX1mdW5jdGlvbiBkZShhKXthLmV2ZW50UG9vbD1bXTthLmdldFBvb2xlZD1lZTthLnJlbGVhc2U9ZmV9dmFyIGdlPUcuZXh0ZW5kKHtkYXRhOm51bGx9KSxoZT1HLmV4dGVuZCh7ZGF0YTpudWxsfSksaWU9WzksMTMsMjcsMzJdLGplPXlhJiYiQ29tcG9zaXRpb25FdmVudCJpbiB3aW5kb3csa2U9bnVsbDt5YSYmImRvY3VtZW50TW9kZSJpbiBkb2N1bWVudCYmKGtlPWRvY3VtZW50LmRvY3VtZW50TW9kZSk7XG52YXIgbGU9eWEmJiJUZXh0RXZlbnQiaW4gd2luZG93JiYha2UsbWU9eWEmJighamV8fGtlJiY4PGtlJiYxMT49a2UpLG5lPVN0cmluZy5mcm9tQ2hhckNvZGUoMzIpLG9lPXtiZWZvcmVJbnB1dDp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6Im9uQmVmb3JlSW5wdXQiLGNhcHR1cmVkOiJvbkJlZm9yZUlucHV0Q2FwdHVyZSJ9LGRlcGVuZGVuY2llczpbImNvbXBvc2l0aW9uZW5kIiwia2V5cHJlc3MiLCJ0ZXh0SW5wdXQiLCJwYXN0ZSJdfSxjb21wb3NpdGlvbkVuZDp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6Im9uQ29tcG9zaXRpb25FbmQiLGNhcHR1cmVkOiJvbkNvbXBvc2l0aW9uRW5kQ2FwdHVyZSJ9LGRlcGVuZGVuY2llczoiYmx1ciBjb21wb3NpdGlvbmVuZCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKX0sY29tcG9zaXRpb25TdGFydDp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6Im9uQ29tcG9zaXRpb25TdGFydCIsXG5jYXB0dXJlZDoib25Db21wb3NpdGlvblN0YXJ0Q2FwdHVyZSJ9LGRlcGVuZGVuY2llczoiYmx1ciBjb21wb3NpdGlvbnN0YXJ0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpfSxjb21wb3NpdGlvblVwZGF0ZTp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6Im9uQ29tcG9zaXRpb25VcGRhdGUiLGNhcHR1cmVkOiJvbkNvbXBvc2l0aW9uVXBkYXRlQ2FwdHVyZSJ9LGRlcGVuZGVuY2llczoiYmx1ciBjb21wb3NpdGlvbnVwZGF0ZSBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKX19LHBlPSExO1xuZnVuY3Rpb24gcWUoYSxiKXtzd2l0Y2goYSl7Y2FzZSAia2V5dXAiOnJldHVybi0xIT09aWUuaW5kZXhPZihiLmtleUNvZGUpO2Nhc2UgImtleWRvd24iOnJldHVybiAyMjkhPT1iLmtleUNvZGU7Y2FzZSAia2V5cHJlc3MiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAiYmx1ciI6cmV0dXJuITA7ZGVmYXVsdDpyZXR1cm4hMX19ZnVuY3Rpb24gcmUoYSl7YT1hLmRldGFpbDtyZXR1cm4ib2JqZWN0Ij09PXR5cGVvZiBhJiYiZGF0YSJpbiBhP2EuZGF0YTpudWxsfXZhciBzZT0hMTtmdW5jdGlvbiB0ZShhLGIpe3N3aXRjaChhKXtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIHJlKGIpO2Nhc2UgImtleXByZXNzIjppZigzMiE9PWIud2hpY2gpcmV0dXJuIG51bGw7cGU9ITA7cmV0dXJuIG5lO2Nhc2UgInRleHRJbnB1dCI6cmV0dXJuIGE9Yi5kYXRhLGE9PT1uZSYmcGU/bnVsbDphO2RlZmF1bHQ6cmV0dXJuIG51bGx9fVxuZnVuY3Rpb24gdWUoYSxiKXtpZihzZSlyZXR1cm4iY29tcG9zaXRpb25lbmQiPT09YXx8IWplJiZxZShhLGIpPyhhPWFlKCksJGQ9WmQ9WWQ9bnVsbCxzZT0hMSxhKTpudWxsO3N3aXRjaChhKXtjYXNlICJwYXN0ZSI6cmV0dXJuIG51bGw7Y2FzZSAia2V5cHJlc3MiOmlmKCEoYi5jdHJsS2V5fHxiLmFsdEtleXx8Yi5tZXRhS2V5KXx8Yi5jdHJsS2V5JiZiLmFsdEtleSl7aWYoYi5jaGFyJiYxPGIuY2hhci5sZW5ndGgpcmV0dXJuIGIuY2hhcjtpZihiLndoaWNoKXJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGIud2hpY2gpfXJldHVybiBudWxsO2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gbWUmJiJrbyIhPT1iLmxvY2FsZT9udWxsOmIuZGF0YTtkZWZhdWx0OnJldHVybiBudWxsfX1cbnZhciB2ZT17ZXZlbnRUeXBlczpvZSxleHRyYWN0RXZlbnRzOmZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlO2lmKGplKWI6e3N3aXRjaChhKXtjYXNlICJjb21wb3NpdGlvbnN0YXJ0Ijp2YXIgZj1vZS5jb21wb3NpdGlvblN0YXJ0O2JyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb25lbmQiOmY9b2UuY29tcG9zaXRpb25FbmQ7YnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6Zj1vZS5jb21wb3NpdGlvblVwZGF0ZTticmVhayBifWY9dm9pZCAwfWVsc2Ugc2U/cWUoYSxjKSYmKGY9b2UuY29tcG9zaXRpb25FbmQpOiJrZXlkb3duIj09PWEmJjIyOT09PWMua2V5Q29kZSYmKGY9b2UuY29tcG9zaXRpb25TdGFydCk7Zj8obWUmJiJrbyIhPT1jLmxvY2FsZSYmKHNlfHxmIT09b2UuY29tcG9zaXRpb25TdGFydD9mPT09b2UuY29tcG9zaXRpb25FbmQmJnNlJiYoZT1hZSgpKTooWWQ9ZCxaZD0idmFsdWUiaW4gWWQ/WWQudmFsdWU6WWQudGV4dENvbnRlbnQsc2U9ITApKSxmPWdlLmdldFBvb2xlZChmLFxuYixjLGQpLGU/Zi5kYXRhPWU6KGU9cmUoYyksbnVsbCE9PWUmJihmLmRhdGE9ZSkpLFhkKGYpLGU9Zik6ZT1udWxsOyhhPWxlP3RlKGEsYyk6dWUoYSxjKSk/KGI9aGUuZ2V0UG9vbGVkKG9lLmJlZm9yZUlucHV0LGIsYyxkKSxiLmRhdGE9YSxYZChiKSk6Yj1udWxsO3JldHVybiBudWxsPT09ZT9iOm51bGw9PT1iP2U6W2UsYl19fSx3ZT17Y29sb3I6ITAsZGF0ZTohMCxkYXRldGltZTohMCwiZGF0ZXRpbWUtbG9jYWwiOiEwLGVtYWlsOiEwLG1vbnRoOiEwLG51bWJlcjohMCxwYXNzd29yZDohMCxyYW5nZTohMCxzZWFyY2g6ITAsdGVsOiEwLHRleHQ6ITAsdGltZTohMCx1cmw6ITAsd2VlazohMH07ZnVuY3Rpb24geGUoYSl7dmFyIGI9YSYmYS5ub2RlTmFtZSYmYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiJpbnB1dCI9PT1iPyEhd2VbYS50eXBlXToidGV4dGFyZWEiPT09Yj8hMDohMX1cbnZhciB5ZT17Y2hhbmdlOntwaGFzZWRSZWdpc3RyYXRpb25OYW1lczp7YnViYmxlZDoib25DaGFuZ2UiLGNhcHR1cmVkOiJvbkNoYW5nZUNhcHR1cmUifSxkZXBlbmRlbmNpZXM6ImJsdXIgY2hhbmdlIGNsaWNrIGZvY3VzIGlucHV0IGtleWRvd24ga2V5dXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpfX07ZnVuY3Rpb24gemUoYSxiLGMpe2E9Ry5nZXRQb29sZWQoeWUuY2hhbmdlLGEsYixjKTthLnR5cGU9ImNoYW5nZSI7RGEoYyk7WGQoYSk7cmV0dXJuIGF9dmFyIEFlPW51bGwsQmU9bnVsbDtmdW5jdGlvbiBDZShhKXttYyhhKX1mdW5jdGlvbiBEZShhKXt2YXIgYj1QZChhKTtpZih5YihiKSlyZXR1cm4gYX1mdW5jdGlvbiBFZShhLGIpe2lmKCJjaGFuZ2UiPT09YSlyZXR1cm4gYn12YXIgRmU9ITE7eWEmJihGZT1vYygiaW5wdXQiKSYmKCFkb2N1bWVudC5kb2N1bWVudE1vZGV8fDk8ZG9jdW1lbnQuZG9jdW1lbnRNb2RlKSk7XG5mdW5jdGlvbiBHZSgpe0FlJiYoQWUuZGV0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLEhlKSxCZT1BZT1udWxsKX1mdW5jdGlvbiBIZShhKXtpZigidmFsdWUiPT09YS5wcm9wZXJ0eU5hbWUmJkRlKEJlKSlpZihhPXplKEJlLGEsbmMoYSkpLEphKW1jKGEpO2Vsc2V7SmE9ITA7dHJ5e0ZhKENlLGEpfWZpbmFsbHl7SmE9ITEsTGEoKX19fWZ1bmN0aW9uIEllKGEsYixjKXsiZm9jdXMiPT09YT8oR2UoKSxBZT1iLEJlPWMsQWUuYXR0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLEhlKSk6ImJsdXIiPT09YSYmR2UoKX1mdW5jdGlvbiBKZShhKXtpZigic2VsZWN0aW9uY2hhbmdlIj09PWF8fCJrZXl1cCI9PT1hfHwia2V5ZG93biI9PT1hKXJldHVybiBEZShCZSl9ZnVuY3Rpb24gS2UoYSxiKXtpZigiY2xpY2siPT09YSlyZXR1cm4gRGUoYil9ZnVuY3Rpb24gTGUoYSxiKXtpZigiaW5wdXQiPT09YXx8ImNoYW5nZSI9PT1hKXJldHVybiBEZShiKX1cbnZhciBNZT17ZXZlbnRUeXBlczp5ZSxfaXNJbnB1dEV2ZW50U3VwcG9ydGVkOkZlLGV4dHJhY3RFdmVudHM6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9Yj9QZChiKTp3aW5kb3csZj1lLm5vZGVOYW1lJiZlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoInNlbGVjdCI9PT1mfHwiaW5wdXQiPT09ZiYmImZpbGUiPT09ZS50eXBlKXZhciBnPUVlO2Vsc2UgaWYoeGUoZSkpaWYoRmUpZz1MZTtlbHNle2c9SmU7dmFyIGg9SWV9ZWxzZShmPWUubm9kZU5hbWUpJiYiaW5wdXQiPT09Zi50b0xvd2VyQ2FzZSgpJiYoImNoZWNrYm94Ij09PWUudHlwZXx8InJhZGlvIj09PWUudHlwZSkmJihnPUtlKTtpZihnJiYoZz1nKGEsYikpKXJldHVybiB6ZShnLGMsZCk7aCYmaChhLGUsYik7ImJsdXIiPT09YSYmKGE9ZS5fd3JhcHBlclN0YXRlKSYmYS5jb250cm9sbGVkJiYibnVtYmVyIj09PWUudHlwZSYmRGIoZSwibnVtYmVyIixlLnZhbHVlKX19LE5lPUcuZXh0ZW5kKHt2aWV3Om51bGwsZGV0YWlsOm51bGx9KSxcbk9lPXtBbHQ6ImFsdEtleSIsQ29udHJvbDoiY3RybEtleSIsTWV0YToibWV0YUtleSIsU2hpZnQ6InNoaWZ0S2V5In07ZnVuY3Rpb24gUGUoYSl7dmFyIGI9dGhpcy5uYXRpdmVFdmVudDtyZXR1cm4gYi5nZXRNb2RpZmllclN0YXRlP2IuZ2V0TW9kaWZpZXJTdGF0ZShhKTooYT1PZVthXSk/ISFiW2FdOiExfWZ1bmN0aW9uIFFlKCl7cmV0dXJuIFBlfVxudmFyIFJlPTAsU2U9MCxUZT0hMSxVZT0hMSxWZT1OZS5leHRlbmQoe3NjcmVlblg6bnVsbCxzY3JlZW5ZOm51bGwsY2xpZW50WDpudWxsLGNsaWVudFk6bnVsbCxwYWdlWDpudWxsLHBhZ2VZOm51bGwsY3RybEtleTpudWxsLHNoaWZ0S2V5Om51bGwsYWx0S2V5Om51bGwsbWV0YUtleTpudWxsLGdldE1vZGlmaWVyU3RhdGU6UWUsYnV0dG9uOm51bGwsYnV0dG9uczpudWxsLHJlbGF0ZWRUYXJnZXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVsYXRlZFRhcmdldHx8KGEuZnJvbUVsZW1lbnQ9PT1hLnNyY0VsZW1lbnQ/YS50b0VsZW1lbnQ6YS5mcm9tRWxlbWVudCl9LG1vdmVtZW50WDpmdW5jdGlvbihhKXtpZigibW92ZW1lbnRYImluIGEpcmV0dXJuIGEubW92ZW1lbnRYO3ZhciBiPVJlO1JlPWEuc2NyZWVuWDtyZXR1cm4gVGU/Im1vdXNlbW92ZSI9PT1hLnR5cGU/YS5zY3JlZW5YLWI6MDooVGU9ITAsMCl9LG1vdmVtZW50WTpmdW5jdGlvbihhKXtpZigibW92ZW1lbnRZImluIGEpcmV0dXJuIGEubW92ZW1lbnRZO1xudmFyIGI9U2U7U2U9YS5zY3JlZW5ZO3JldHVybiBVZT8ibW91c2Vtb3ZlIj09PWEudHlwZT9hLnNjcmVlblktYjowOihVZT0hMCwwKX19KSxXZT1WZS5leHRlbmQoe3BvaW50ZXJJZDpudWxsLHdpZHRoOm51bGwsaGVpZ2h0Om51bGwscHJlc3N1cmU6bnVsbCx0YW5nZW50aWFsUHJlc3N1cmU6bnVsbCx0aWx0WDpudWxsLHRpbHRZOm51bGwsdHdpc3Q6bnVsbCxwb2ludGVyVHlwZTpudWxsLGlzUHJpbWFyeTpudWxsfSksWGU9e21vdXNlRW50ZXI6e3JlZ2lzdHJhdGlvbk5hbWU6Im9uTW91c2VFbnRlciIsZGVwZW5kZW5jaWVzOlsibW91c2VvdXQiLCJtb3VzZW92ZXIiXX0sbW91c2VMZWF2ZTp7cmVnaXN0cmF0aW9uTmFtZToib25Nb3VzZUxlYXZlIixkZXBlbmRlbmNpZXM6WyJtb3VzZW91dCIsIm1vdXNlb3ZlciJdfSxwb2ludGVyRW50ZXI6e3JlZ2lzdHJhdGlvbk5hbWU6Im9uUG9pbnRlckVudGVyIixkZXBlbmRlbmNpZXM6WyJwb2ludGVyb3V0IiwicG9pbnRlcm92ZXIiXX0scG9pbnRlckxlYXZlOntyZWdpc3RyYXRpb25OYW1lOiJvblBvaW50ZXJMZWF2ZSIsXG5kZXBlbmRlbmNpZXM6WyJwb2ludGVyb3V0IiwicG9pbnRlcm92ZXIiXX19LFllPXtldmVudFR5cGVzOlhlLGV4dHJhY3RFdmVudHM6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZj0ibW91c2VvdmVyIj09PWF8fCJwb2ludGVyb3ZlciI9PT1hLGc9Im1vdXNlb3V0Ij09PWF8fCJwb2ludGVyb3V0Ij09PWE7aWYoZiYmMD09PShlJjMyKSYmKGMucmVsYXRlZFRhcmdldHx8Yy5mcm9tRWxlbWVudCl8fCFnJiYhZilyZXR1cm4gbnVsbDtmPWQud2luZG93PT09ZD9kOihmPWQub3duZXJEb2N1bWVudCk/Zi5kZWZhdWx0Vmlld3x8Zi5wYXJlbnRXaW5kb3c6d2luZG93O2lmKGcpe2lmKGc9YixiPShiPWMucmVsYXRlZFRhcmdldHx8Yy50b0VsZW1lbnQpP3RjKGIpOm51bGwsbnVsbCE9PWIpe3ZhciBoPWRjKGIpO2lmKGIhPT1ofHw1IT09Yi50YWcmJjYhPT1iLnRhZyliPW51bGx9fWVsc2UgZz1udWxsO2lmKGc9PT1iKXJldHVybiBudWxsO2lmKCJtb3VzZW91dCI9PT1hfHwibW91c2VvdmVyIj09PVxuYSl7dmFyIGs9VmU7dmFyIGw9WGUubW91c2VMZWF2ZTt2YXIgbT1YZS5tb3VzZUVudGVyO3ZhciBwPSJtb3VzZSJ9ZWxzZSBpZigicG9pbnRlcm91dCI9PT1hfHwicG9pbnRlcm92ZXIiPT09YSlrPVdlLGw9WGUucG9pbnRlckxlYXZlLG09WGUucG9pbnRlckVudGVyLHA9InBvaW50ZXIiO2E9bnVsbD09Zz9mOlBkKGcpO2Y9bnVsbD09Yj9mOlBkKGIpO2w9ay5nZXRQb29sZWQobCxnLGMsZCk7bC50eXBlPXArImxlYXZlIjtsLnRhcmdldD1hO2wucmVsYXRlZFRhcmdldD1mO2M9ay5nZXRQb29sZWQobSxiLGMsZCk7Yy50eXBlPXArImVudGVyIjtjLnRhcmdldD1mO2MucmVsYXRlZFRhcmdldD1hO2Q9ZztwPWI7aWYoZCYmcClhOntrPWQ7bT1wO2c9MDtmb3IoYT1rO2E7YT1SZChhKSlnKys7YT0wO2ZvcihiPW07YjtiPVJkKGIpKWErKztmb3IoOzA8Zy1hOylrPVJkKGspLGctLTtmb3IoOzA8YS1nOyltPVJkKG0pLGEtLTtmb3IoO2ctLTspe2lmKGs9PT1tfHxrPT09bS5hbHRlcm5hdGUpYnJlYWsgYTtcbms9UmQoayk7bT1SZChtKX1rPW51bGx9ZWxzZSBrPW51bGw7bT1rO2ZvcihrPVtdO2QmJmQhPT1tOyl7Zz1kLmFsdGVybmF0ZTtpZihudWxsIT09ZyYmZz09PW0pYnJlYWs7ay5wdXNoKGQpO2Q9UmQoZCl9Zm9yKGQ9W107cCYmcCE9PW07KXtnPXAuYWx0ZXJuYXRlO2lmKG51bGwhPT1nJiZnPT09bSlicmVhaztkLnB1c2gocCk7cD1SZChwKX1mb3IocD0wO3A8ay5sZW5ndGg7cCsrKVZkKGtbcF0sImJ1YmJsZWQiLGwpO2ZvcihwPWQubGVuZ3RoOzA8cC0tOylWZChkW3BdLCJjYXB0dXJlZCIsYyk7cmV0dXJuIDA9PT0oZSY2NCk/W2xdOltsLGNdfX07ZnVuY3Rpb24gWmUoYSxiKXtyZXR1cm4gYT09PWImJigwIT09YXx8MS9hPT09MS9iKXx8YSE9PWEmJmIhPT1ifXZhciAkZT0iZnVuY3Rpb24iPT09dHlwZW9mIE9iamVjdC5pcz9PYmplY3QuaXM6WmUsYWY9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbmZ1bmN0aW9uIGJmKGEsYil7aWYoJGUoYSxiKSlyZXR1cm4hMDtpZigib2JqZWN0IiE9PXR5cGVvZiBhfHxudWxsPT09YXx8Im9iamVjdCIhPT10eXBlb2YgYnx8bnVsbD09PWIpcmV0dXJuITE7dmFyIGM9T2JqZWN0LmtleXMoYSksZD1PYmplY3Qua2V5cyhiKTtpZihjLmxlbmd0aCE9PWQubGVuZ3RoKXJldHVybiExO2ZvcihkPTA7ZDxjLmxlbmd0aDtkKyspaWYoIWFmLmNhbGwoYixjW2RdKXx8ISRlKGFbY1tkXV0sYltjW2RdXSkpcmV0dXJuITE7cmV0dXJuITB9XG52YXIgY2Y9eWEmJiJkb2N1bWVudE1vZGUiaW4gZG9jdW1lbnQmJjExPj1kb2N1bWVudC5kb2N1bWVudE1vZGUsZGY9e3NlbGVjdDp7cGhhc2VkUmVnaXN0cmF0aW9uTmFtZXM6e2J1YmJsZWQ6Im9uU2VsZWN0IixjYXB0dXJlZDoib25TZWxlY3RDYXB0dXJlIn0sZGVwZW5kZW5jaWVzOiJibHVyIGNvbnRleHRtZW51IGRyYWdlbmQgZm9jdXMga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIil9fSxlZj1udWxsLGZmPW51bGwsZ2Y9bnVsbCxoZj0hMTtcbmZ1bmN0aW9uIGpmKGEsYil7dmFyIGM9Yi53aW5kb3c9PT1iP2IuZG9jdW1lbnQ6OT09PWIubm9kZVR5cGU/YjpiLm93bmVyRG9jdW1lbnQ7aWYoaGZ8fG51bGw9PWVmfHxlZiE9PXRkKGMpKXJldHVybiBudWxsO2M9ZWY7InNlbGVjdGlvblN0YXJ0ImluIGMmJnlkKGMpP2M9e3N0YXJ0OmMuc2VsZWN0aW9uU3RhcnQsZW5kOmMuc2VsZWN0aW9uRW5kfTooYz0oYy5vd25lckRvY3VtZW50JiZjLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXd8fHdpbmRvdykuZ2V0U2VsZWN0aW9uKCksYz17YW5jaG9yTm9kZTpjLmFuY2hvck5vZGUsYW5jaG9yT2Zmc2V0OmMuYW5jaG9yT2Zmc2V0LGZvY3VzTm9kZTpjLmZvY3VzTm9kZSxmb2N1c09mZnNldDpjLmZvY3VzT2Zmc2V0fSk7cmV0dXJuIGdmJiZiZihnZixjKT9udWxsOihnZj1jLGE9Ry5nZXRQb29sZWQoZGYuc2VsZWN0LGZmLGEsYiksYS50eXBlPSJzZWxlY3QiLGEudGFyZ2V0PWVmLFhkKGEpLGEpfVxudmFyIGtmPXtldmVudFR5cGVzOmRmLGV4dHJhY3RFdmVudHM6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2U9Znx8KGQud2luZG93PT09ZD9kLmRvY3VtZW50Ojk9PT1kLm5vZGVUeXBlP2Q6ZC5vd25lckRvY3VtZW50KTtpZighKGY9IWUpKXthOntlPWNjKGUpO2Y9d2Eub25TZWxlY3Q7Zm9yKHZhciBnPTA7ZzxmLmxlbmd0aDtnKyspaWYoIWUuaGFzKGZbZ10pKXtlPSExO2JyZWFrIGF9ZT0hMH1mPSFlfWlmKGYpcmV0dXJuIG51bGw7ZT1iP1BkKGIpOndpbmRvdztzd2l0Y2goYSl7Y2FzZSAiZm9jdXMiOmlmKHhlKGUpfHwidHJ1ZSI9PT1lLmNvbnRlbnRFZGl0YWJsZSllZj1lLGZmPWIsZ2Y9bnVsbDticmVhaztjYXNlICJibHVyIjpnZj1mZj1lZj1udWxsO2JyZWFrO2Nhc2UgIm1vdXNlZG93biI6aGY9ITA7YnJlYWs7Y2FzZSAiY29udGV4dG1lbnUiOmNhc2UgIm1vdXNldXAiOmNhc2UgImRyYWdlbmQiOnJldHVybiBoZj0hMSxqZihjLGQpO2Nhc2UgInNlbGVjdGlvbmNoYW5nZSI6aWYoY2YpYnJlYWs7XG5jYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6cmV0dXJuIGpmKGMsZCl9cmV0dXJuIG51bGx9fSxsZj1HLmV4dGVuZCh7YW5pbWF0aW9uTmFtZTpudWxsLGVsYXBzZWRUaW1lOm51bGwscHNldWRvRWxlbWVudDpudWxsfSksbWY9Ry5leHRlbmQoe2NsaXBib2FyZERhdGE6ZnVuY3Rpb24oYSl7cmV0dXJuImNsaXBib2FyZERhdGEiaW4gYT9hLmNsaXBib2FyZERhdGE6d2luZG93LmNsaXBib2FyZERhdGF9fSksbmY9TmUuZXh0ZW5kKHtyZWxhdGVkVGFyZ2V0Om51bGx9KTtmdW5jdGlvbiBvZihhKXt2YXIgYj1hLmtleUNvZGU7ImNoYXJDb2RlImluIGE/KGE9YS5jaGFyQ29kZSwwPT09YSYmMTM9PT1iJiYoYT0xMykpOmE9YjsxMD09PWEmJihhPTEzKTtyZXR1cm4gMzI8PWF8fDEzPT09YT9hOjB9XG52YXIgcGY9e0VzYzoiRXNjYXBlIixTcGFjZWJhcjoiICIsTGVmdDoiQXJyb3dMZWZ0IixVcDoiQXJyb3dVcCIsUmlnaHQ6IkFycm93UmlnaHQiLERvd246IkFycm93RG93biIsRGVsOiJEZWxldGUiLFdpbjoiT1MiLE1lbnU6IkNvbnRleHRNZW51IixBcHBzOiJDb250ZXh0TWVudSIsU2Nyb2xsOiJTY3JvbGxMb2NrIixNb3pQcmludGFibGVLZXk6IlVuaWRlbnRpZmllZCJ9LHFmPXs4OiJCYWNrc3BhY2UiLDk6IlRhYiIsMTI6IkNsZWFyIiwxMzoiRW50ZXIiLDE2OiJTaGlmdCIsMTc6IkNvbnRyb2wiLDE4OiJBbHQiLDE5OiJQYXVzZSIsMjA6IkNhcHNMb2NrIiwyNzoiRXNjYXBlIiwzMjoiICIsMzM6IlBhZ2VVcCIsMzQ6IlBhZ2VEb3duIiwzNToiRW5kIiwzNjoiSG9tZSIsMzc6IkFycm93TGVmdCIsMzg6IkFycm93VXAiLDM5OiJBcnJvd1JpZ2h0Iiw0MDoiQXJyb3dEb3duIiw0NToiSW5zZXJ0Iiw0NjoiRGVsZXRlIiwxMTI6IkYxIiwxMTM6IkYyIiwxMTQ6IkYzIiwxMTU6IkY0IixcbjExNjoiRjUiLDExNzoiRjYiLDExODoiRjciLDExOToiRjgiLDEyMDoiRjkiLDEyMToiRjEwIiwxMjI6IkYxMSIsMTIzOiJGMTIiLDE0NDoiTnVtTG9jayIsMTQ1OiJTY3JvbGxMb2NrIiwyMjQ6Ik1ldGEifSxyZj1OZS5leHRlbmQoe2tleTpmdW5jdGlvbihhKXtpZihhLmtleSl7dmFyIGI9cGZbYS5rZXldfHxhLmtleTtpZigiVW5pZGVudGlmaWVkIiE9PWIpcmV0dXJuIGJ9cmV0dXJuImtleXByZXNzIj09PWEudHlwZT8oYT1vZihhKSwxMz09PWE/IkVudGVyIjpTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKToia2V5ZG93biI9PT1hLnR5cGV8fCJrZXl1cCI9PT1hLnR5cGU/cWZbYS5rZXlDb2RlXXx8IlVuaWRlbnRpZmllZCI6IiJ9LGxvY2F0aW9uOm51bGwsY3RybEtleTpudWxsLHNoaWZ0S2V5Om51bGwsYWx0S2V5Om51bGwsbWV0YUtleTpudWxsLHJlcGVhdDpudWxsLGxvY2FsZTpudWxsLGdldE1vZGlmaWVyU3RhdGU6UWUsY2hhckNvZGU6ZnVuY3Rpb24oYSl7cmV0dXJuImtleXByZXNzIj09PVxuYS50eXBlP29mKGEpOjB9LGtleUNvZGU6ZnVuY3Rpb24oYSl7cmV0dXJuImtleWRvd24iPT09YS50eXBlfHwia2V5dXAiPT09YS50eXBlP2Eua2V5Q29kZTowfSx3aGljaDpmdW5jdGlvbihhKXtyZXR1cm4ia2V5cHJlc3MiPT09YS50eXBlP29mKGEpOiJrZXlkb3duIj09PWEudHlwZXx8ImtleXVwIj09PWEudHlwZT9hLmtleUNvZGU6MH19KSxzZj1WZS5leHRlbmQoe2RhdGFUcmFuc2ZlcjpudWxsfSksdGY9TmUuZXh0ZW5kKHt0b3VjaGVzOm51bGwsdGFyZ2V0VG91Y2hlczpudWxsLGNoYW5nZWRUb3VjaGVzOm51bGwsYWx0S2V5Om51bGwsbWV0YUtleTpudWxsLGN0cmxLZXk6bnVsbCxzaGlmdEtleTpudWxsLGdldE1vZGlmaWVyU3RhdGU6UWV9KSx1Zj1HLmV4dGVuZCh7cHJvcGVydHlOYW1lOm51bGwsZWxhcHNlZFRpbWU6bnVsbCxwc2V1ZG9FbGVtZW50Om51bGx9KSx2Zj1WZS5leHRlbmQoe2RlbHRhWDpmdW5jdGlvbihhKXtyZXR1cm4iZGVsdGFYImluIGE/YS5kZWx0YVg6IndoZWVsRGVsdGFYImluXG5hPy1hLndoZWVsRGVsdGFYOjB9LGRlbHRhWTpmdW5jdGlvbihhKXtyZXR1cm4iZGVsdGFZImluIGE/YS5kZWx0YVk6IndoZWVsRGVsdGFZImluIGE/LWEud2hlZWxEZWx0YVk6IndoZWVsRGVsdGEiaW4gYT8tYS53aGVlbERlbHRhOjB9LGRlbHRhWjpudWxsLGRlbHRhTW9kZTpudWxsfSksd2Y9e2V2ZW50VHlwZXM6V2MsZXh0cmFjdEV2ZW50czpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1ZYy5nZXQoYSk7aWYoIWUpcmV0dXJuIG51bGw7c3dpdGNoKGEpe2Nhc2UgImtleXByZXNzIjppZigwPT09b2YoYykpcmV0dXJuIG51bGw7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOmE9cmY7YnJlYWs7Y2FzZSAiYmx1ciI6Y2FzZSAiZm9jdXMiOmE9bmY7YnJlYWs7Y2FzZSAiY2xpY2siOmlmKDI9PT1jLmJ1dHRvbilyZXR1cm4gbnVsbDtjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZXVwIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJjb250ZXh0bWVudSI6YT1cblZlO2JyZWFrO2Nhc2UgImRyYWciOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2V4aXQiOmNhc2UgImRyYWdsZWF2ZSI6Y2FzZSAiZHJhZ292ZXIiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6YT1zZjticmVhaztjYXNlICJ0b3VjaGNhbmNlbCI6Y2FzZSAidG91Y2hlbmQiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAidG91Y2hzdGFydCI6YT10ZjticmVhaztjYXNlIFhiOmNhc2UgWWI6Y2FzZSBaYjphPWxmO2JyZWFrO2Nhc2UgJGI6YT11ZjticmVhaztjYXNlICJzY3JvbGwiOmE9TmU7YnJlYWs7Y2FzZSAid2hlZWwiOmE9dmY7YnJlYWs7Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJwYXN0ZSI6YT1tZjticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcm1vdmUiOmNhc2UgInBvaW50ZXJvdXQiOmNhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVydXAiOmE9XG5XZTticmVhaztkZWZhdWx0OmE9R31iPWEuZ2V0UG9vbGVkKGUsYixjLGQpO1hkKGIpO3JldHVybiBifX07aWYocGEpdGhyb3cgRXJyb3IodSgxMDEpKTtwYT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCgiUmVzcG9uZGVyRXZlbnRQbHVnaW4gU2ltcGxlRXZlbnRQbHVnaW4gRW50ZXJMZWF2ZUV2ZW50UGx1Z2luIENoYW5nZUV2ZW50UGx1Z2luIFNlbGVjdEV2ZW50UGx1Z2luIEJlZm9yZUlucHV0RXZlbnRQbHVnaW4iLnNwbGl0KCIgIikpO3JhKCk7dmFyIHhmPU5jO2xhPVFkO21hPXhmO25hPVBkO3hhKHtTaW1wbGVFdmVudFBsdWdpbjp3ZixFbnRlckxlYXZlRXZlbnRQbHVnaW46WWUsQ2hhbmdlRXZlbnRQbHVnaW46TWUsU2VsZWN0RXZlbnRQbHVnaW46a2YsQmVmb3JlSW5wdXRFdmVudFBsdWdpbjp2ZX0pO3ZhciB5Zj1bXSx6Zj0tMTtmdW5jdGlvbiBIKGEpezA+emZ8fChhLmN1cnJlbnQ9eWZbemZdLHlmW3pmXT1udWxsLHpmLS0pfVxuZnVuY3Rpb24gSShhLGIpe3pmKys7eWZbemZdPWEuY3VycmVudDthLmN1cnJlbnQ9Yn12YXIgQWY9e30sSj17Y3VycmVudDpBZn0sSz17Y3VycmVudDohMX0sQmY9QWY7ZnVuY3Rpb24gQ2YoYSxiKXt2YXIgYz1hLnR5cGUuY29udGV4dFR5cGVzO2lmKCFjKXJldHVybiBBZjt2YXIgZD1hLnN0YXRlTm9kZTtpZihkJiZkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQ9PT1iKXJldHVybiBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0O3ZhciBlPXt9LGY7Zm9yKGYgaW4gYyllW2ZdPWJbZl07ZCYmKGE9YS5zdGF0ZU5vZGUsYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0PWIsYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dD1lKTtyZXR1cm4gZX1mdW5jdGlvbiBMKGEpe2E9YS5jaGlsZENvbnRleHRUeXBlcztyZXR1cm4gbnVsbCE9PWEmJnZvaWQgMCE9PWF9XG5mdW5jdGlvbiBEZigpe0goSyk7SChKKX1mdW5jdGlvbiBFZihhLGIsYyl7aWYoSi5jdXJyZW50IT09QWYpdGhyb3cgRXJyb3IodSgxNjgpKTtJKEosYik7SShLLGMpfWZ1bmN0aW9uIEZmKGEsYixjKXt2YXIgZD1hLnN0YXRlTm9kZTthPWIuY2hpbGRDb250ZXh0VHlwZXM7aWYoImZ1bmN0aW9uIiE9PXR5cGVvZiBkLmdldENoaWxkQ29udGV4dClyZXR1cm4gYztkPWQuZ2V0Q2hpbGRDb250ZXh0KCk7Zm9yKHZhciBlIGluIGQpaWYoIShlIGluIGEpKXRocm93IEVycm9yKHUoMTA4LHBiKGIpfHwiVW5rbm93biIsZSkpO3JldHVybiBuKHt9LGMse30sZCl9ZnVuY3Rpb24gR2YoYSl7YT0oYT1hLnN0YXRlTm9kZSkmJmEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHR8fEFmO0JmPUouY3VycmVudDtJKEosYSk7SShLLEsuY3VycmVudCk7cmV0dXJuITB9XG5mdW5jdGlvbiBIZihhLGIsYyl7dmFyIGQ9YS5zdGF0ZU5vZGU7aWYoIWQpdGhyb3cgRXJyb3IodSgxNjkpKTtjPyhhPUZmKGEsYixCZiksZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dD1hLEgoSyksSChKKSxJKEosYSkpOkgoSyk7SShLLGMpfVxudmFyIElmPXIudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5LEpmPXIudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayxLZj1yLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrLExmPXIudW5zdGFibGVfcmVxdWVzdFBhaW50LE1mPXIudW5zdGFibGVfbm93LE5mPXIudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWwsT2Y9ci51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSxQZj1yLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5LFFmPXIudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksUmY9ci51bnN0YWJsZV9Mb3dQcmlvcml0eSxTZj1yLnVuc3RhYmxlX0lkbGVQcmlvcml0eSxUZj17fSxVZj1yLnVuc3RhYmxlX3Nob3VsZFlpZWxkLFZmPXZvaWQgMCE9PUxmP0xmOmZ1bmN0aW9uKCl7fSxXZj1udWxsLFhmPW51bGwsWWY9ITEsWmY9TWYoKSwkZj0xRTQ+WmY/TWY6ZnVuY3Rpb24oKXtyZXR1cm4gTWYoKS1aZn07XG5mdW5jdGlvbiBhZygpe3N3aXRjaChOZigpKXtjYXNlIE9mOnJldHVybiA5OTtjYXNlIFBmOnJldHVybiA5ODtjYXNlIFFmOnJldHVybiA5NztjYXNlIFJmOnJldHVybiA5NjtjYXNlIFNmOnJldHVybiA5NTtkZWZhdWx0OnRocm93IEVycm9yKHUoMzMyKSk7fX1mdW5jdGlvbiBiZyhhKXtzd2l0Y2goYSl7Y2FzZSA5OTpyZXR1cm4gT2Y7Y2FzZSA5ODpyZXR1cm4gUGY7Y2FzZSA5NzpyZXR1cm4gUWY7Y2FzZSA5NjpyZXR1cm4gUmY7Y2FzZSA5NTpyZXR1cm4gU2Y7ZGVmYXVsdDp0aHJvdyBFcnJvcih1KDMzMikpO319ZnVuY3Rpb24gY2coYSxiKXthPWJnKGEpO3JldHVybiBJZihhLGIpfWZ1bmN0aW9uIGRnKGEsYixjKXthPWJnKGEpO3JldHVybiBKZihhLGIsYyl9ZnVuY3Rpb24gZWcoYSl7bnVsbD09PVdmPyhXZj1bYV0sWGY9SmYoT2YsZmcpKTpXZi5wdXNoKGEpO3JldHVybiBUZn1mdW5jdGlvbiBnZygpe2lmKG51bGwhPT1YZil7dmFyIGE9WGY7WGY9bnVsbDtLZihhKX1mZygpfVxuZnVuY3Rpb24gZmcoKXtpZighWWYmJm51bGwhPT1XZil7WWY9ITA7dmFyIGE9MDt0cnl7dmFyIGI9V2Y7Y2coOTksZnVuY3Rpb24oKXtmb3IoO2E8Yi5sZW5ndGg7YSsrKXt2YXIgYz1iW2FdO2RvIGM9YyghMCk7d2hpbGUobnVsbCE9PWMpfX0pO1dmPW51bGx9Y2F0Y2goYyl7dGhyb3cgbnVsbCE9PVdmJiYoV2Y9V2Yuc2xpY2UoYSsxKSksSmYoT2YsZ2cpLGM7fWZpbmFsbHl7WWY9ITF9fX1mdW5jdGlvbiBoZyhhLGIsYyl7Yy89MTA7cmV0dXJuIDEwNzM3NDE4MjEtKCgoMTA3Mzc0MTgyMS1hK2IvMTApL2N8MCkrMSkqY31mdW5jdGlvbiBpZyhhLGIpe2lmKGEmJmEuZGVmYXVsdFByb3BzKXtiPW4oe30sYik7YT1hLmRlZmF1bHRQcm9wcztmb3IodmFyIGMgaW4gYSl2b2lkIDA9PT1iW2NdJiYoYltjXT1hW2NdKX1yZXR1cm4gYn12YXIgamc9e2N1cnJlbnQ6bnVsbH0sa2c9bnVsbCxsZz1udWxsLG1nPW51bGw7ZnVuY3Rpb24gbmcoKXttZz1sZz1rZz1udWxsfVxuZnVuY3Rpb24gb2coYSl7dmFyIGI9amcuY3VycmVudDtIKGpnKTthLnR5cGUuX2NvbnRleHQuX2N1cnJlbnRWYWx1ZT1ifWZ1bmN0aW9uIHBnKGEsYil7Zm9yKDtudWxsIT09YTspe3ZhciBjPWEuYWx0ZXJuYXRlO2lmKGEuY2hpbGRFeHBpcmF0aW9uVGltZTxiKWEuY2hpbGRFeHBpcmF0aW9uVGltZT1iLG51bGwhPT1jJiZjLmNoaWxkRXhwaXJhdGlvblRpbWU8YiYmKGMuY2hpbGRFeHBpcmF0aW9uVGltZT1iKTtlbHNlIGlmKG51bGwhPT1jJiZjLmNoaWxkRXhwaXJhdGlvblRpbWU8YiljLmNoaWxkRXhwaXJhdGlvblRpbWU9YjtlbHNlIGJyZWFrO2E9YS5yZXR1cm59fWZ1bmN0aW9uIHFnKGEsYil7a2c9YTttZz1sZz1udWxsO2E9YS5kZXBlbmRlbmNpZXM7bnVsbCE9PWEmJm51bGwhPT1hLmZpcnN0Q29udGV4dCYmKGEuZXhwaXJhdGlvblRpbWU+PWImJihyZz0hMCksYS5maXJzdENvbnRleHQ9bnVsbCl9XG5mdW5jdGlvbiBzZyhhLGIpe2lmKG1nIT09YSYmITEhPT1iJiYwIT09Yil7aWYoIm51bWJlciIhPT10eXBlb2YgYnx8MTA3Mzc0MTgyMz09PWIpbWc9YSxiPTEwNzM3NDE4MjM7Yj17Y29udGV4dDphLG9ic2VydmVkQml0czpiLG5leHQ6bnVsbH07aWYobnVsbD09PWxnKXtpZihudWxsPT09a2cpdGhyb3cgRXJyb3IodSgzMDgpKTtsZz1iO2tnLmRlcGVuZGVuY2llcz17ZXhwaXJhdGlvblRpbWU6MCxmaXJzdENvbnRleHQ6YixyZXNwb25kZXJzOm51bGx9fWVsc2UgbGc9bGcubmV4dD1ifXJldHVybiBhLl9jdXJyZW50VmFsdWV9dmFyIHRnPSExO2Z1bmN0aW9uIHVnKGEpe2EudXBkYXRlUXVldWU9e2Jhc2VTdGF0ZTphLm1lbW9pemVkU3RhdGUsYmFzZVF1ZXVlOm51bGwsc2hhcmVkOntwZW5kaW5nOm51bGx9LGVmZmVjdHM6bnVsbH19XG5mdW5jdGlvbiB2ZyhhLGIpe2E9YS51cGRhdGVRdWV1ZTtiLnVwZGF0ZVF1ZXVlPT09YSYmKGIudXBkYXRlUXVldWU9e2Jhc2VTdGF0ZTphLmJhc2VTdGF0ZSxiYXNlUXVldWU6YS5iYXNlUXVldWUsc2hhcmVkOmEuc2hhcmVkLGVmZmVjdHM6YS5lZmZlY3RzfSl9ZnVuY3Rpb24gd2coYSxiKXthPXtleHBpcmF0aW9uVGltZTphLHN1c3BlbnNlQ29uZmlnOmIsdGFnOjAscGF5bG9hZDpudWxsLGNhbGxiYWNrOm51bGwsbmV4dDpudWxsfTtyZXR1cm4gYS5uZXh0PWF9ZnVuY3Rpb24geGcoYSxiKXthPWEudXBkYXRlUXVldWU7aWYobnVsbCE9PWEpe2E9YS5zaGFyZWQ7dmFyIGM9YS5wZW5kaW5nO251bGw9PT1jP2IubmV4dD1iOihiLm5leHQ9Yy5uZXh0LGMubmV4dD1iKTthLnBlbmRpbmc9Yn19XG5mdW5jdGlvbiB5ZyhhLGIpe3ZhciBjPWEuYWx0ZXJuYXRlO251bGwhPT1jJiZ2ZyhjLGEpO2E9YS51cGRhdGVRdWV1ZTtjPWEuYmFzZVF1ZXVlO251bGw9PT1jPyhhLmJhc2VRdWV1ZT1iLm5leHQ9YixiLm5leHQ9Yik6KGIubmV4dD1jLm5leHQsYy5uZXh0PWIpfVxuZnVuY3Rpb24gemcoYSxiLGMsZCl7dmFyIGU9YS51cGRhdGVRdWV1ZTt0Zz0hMTt2YXIgZj1lLmJhc2VRdWV1ZSxnPWUuc2hhcmVkLnBlbmRpbmc7aWYobnVsbCE9PWcpe2lmKG51bGwhPT1mKXt2YXIgaD1mLm5leHQ7Zi5uZXh0PWcubmV4dDtnLm5leHQ9aH1mPWc7ZS5zaGFyZWQucGVuZGluZz1udWxsO2g9YS5hbHRlcm5hdGU7bnVsbCE9PWgmJihoPWgudXBkYXRlUXVldWUsbnVsbCE9PWgmJihoLmJhc2VRdWV1ZT1nKSl9aWYobnVsbCE9PWYpe2g9Zi5uZXh0O3ZhciBrPWUuYmFzZVN0YXRlLGw9MCxtPW51bGwscD1udWxsLHg9bnVsbDtpZihudWxsIT09aCl7dmFyIHo9aDtkb3tnPXouZXhwaXJhdGlvblRpbWU7aWYoZzxkKXt2YXIgY2E9e2V4cGlyYXRpb25UaW1lOnouZXhwaXJhdGlvblRpbWUsc3VzcGVuc2VDb25maWc6ei5zdXNwZW5zZUNvbmZpZyx0YWc6ei50YWcscGF5bG9hZDp6LnBheWxvYWQsY2FsbGJhY2s6ei5jYWxsYmFjayxuZXh0Om51bGx9O251bGw9PT14PyhwPXg9XG5jYSxtPWspOng9eC5uZXh0PWNhO2c+bCYmKGw9Zyl9ZWxzZXtudWxsIT09eCYmKHg9eC5uZXh0PXtleHBpcmF0aW9uVGltZToxMDczNzQxODIzLHN1c3BlbnNlQ29uZmlnOnouc3VzcGVuc2VDb25maWcsdGFnOnoudGFnLHBheWxvYWQ6ei5wYXlsb2FkLGNhbGxiYWNrOnouY2FsbGJhY2ssbmV4dDpudWxsfSk7QWcoZyx6LnN1c3BlbnNlQ29uZmlnKTthOnt2YXIgRD1hLHQ9ejtnPWI7Y2E9Yztzd2l0Y2godC50YWcpe2Nhc2UgMTpEPXQucGF5bG9hZDtpZigiZnVuY3Rpb24iPT09dHlwZW9mIEQpe2s9RC5jYWxsKGNhLGssZyk7YnJlYWsgYX1rPUQ7YnJlYWsgYTtjYXNlIDM6RC5lZmZlY3RUYWc9RC5lZmZlY3RUYWcmLTQwOTd8NjQ7Y2FzZSAwOkQ9dC5wYXlsb2FkO2c9ImZ1bmN0aW9uIj09PXR5cGVvZiBEP0QuY2FsbChjYSxrLGcpOkQ7aWYobnVsbD09PWd8fHZvaWQgMD09PWcpYnJlYWsgYTtrPW4oe30sayxnKTticmVhayBhO2Nhc2UgMjp0Zz0hMH19bnVsbCE9PXouY2FsbGJhY2smJlxuKGEuZWZmZWN0VGFnfD0zMixnPWUuZWZmZWN0cyxudWxsPT09Zz9lLmVmZmVjdHM9W3pdOmcucHVzaCh6KSl9ej16Lm5leHQ7aWYobnVsbD09PXp8fHo9PT1oKWlmKGc9ZS5zaGFyZWQucGVuZGluZyxudWxsPT09ZylicmVhaztlbHNlIHo9Zi5uZXh0PWcubmV4dCxnLm5leHQ9aCxlLmJhc2VRdWV1ZT1mPWcsZS5zaGFyZWQucGVuZGluZz1udWxsfXdoaWxlKDEpfW51bGw9PT14P209azp4Lm5leHQ9cDtlLmJhc2VTdGF0ZT1tO2UuYmFzZVF1ZXVlPXg7QmcobCk7YS5leHBpcmF0aW9uVGltZT1sO2EubWVtb2l6ZWRTdGF0ZT1rfX1cbmZ1bmN0aW9uIENnKGEsYixjKXthPWIuZWZmZWN0cztiLmVmZmVjdHM9bnVsbDtpZihudWxsIT09YSlmb3IoYj0wO2I8YS5sZW5ndGg7YisrKXt2YXIgZD1hW2JdLGU9ZC5jYWxsYmFjaztpZihudWxsIT09ZSl7ZC5jYWxsYmFjaz1udWxsO2Q9ZTtlPWM7aWYoImZ1bmN0aW9uIiE9PXR5cGVvZiBkKXRocm93IEVycm9yKHUoMTkxLGQpKTtkLmNhbGwoZSl9fX12YXIgRGc9V2EuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsRWc9KG5ldyBhYS5Db21wb25lbnQpLnJlZnM7ZnVuY3Rpb24gRmcoYSxiLGMsZCl7Yj1hLm1lbW9pemVkU3RhdGU7Yz1jKGQsYik7Yz1udWxsPT09Y3x8dm9pZCAwPT09Yz9iOm4oe30sYixjKTthLm1lbW9pemVkU3RhdGU9YzswPT09YS5leHBpcmF0aW9uVGltZSYmKGEudXBkYXRlUXVldWUuYmFzZVN0YXRlPWMpfVxudmFyIEpnPXtpc01vdW50ZWQ6ZnVuY3Rpb24oYSl7cmV0dXJuKGE9YS5fcmVhY3RJbnRlcm5hbEZpYmVyKT9kYyhhKT09PWE6ITF9LGVucXVldWVTZXRTdGF0ZTpmdW5jdGlvbihhLGIsYyl7YT1hLl9yZWFjdEludGVybmFsRmliZXI7dmFyIGQ9R2coKSxlPURnLnN1c3BlbnNlO2Q9SGcoZCxhLGUpO2U9d2coZCxlKTtlLnBheWxvYWQ9Yjt2b2lkIDAhPT1jJiZudWxsIT09YyYmKGUuY2FsbGJhY2s9Yyk7eGcoYSxlKTtJZyhhLGQpfSxlbnF1ZXVlUmVwbGFjZVN0YXRlOmZ1bmN0aW9uKGEsYixjKXthPWEuX3JlYWN0SW50ZXJuYWxGaWJlcjt2YXIgZD1HZygpLGU9RGcuc3VzcGVuc2U7ZD1IZyhkLGEsZSk7ZT13ZyhkLGUpO2UudGFnPTE7ZS5wYXlsb2FkPWI7dm9pZCAwIT09YyYmbnVsbCE9PWMmJihlLmNhbGxiYWNrPWMpO3hnKGEsZSk7SWcoYSxkKX0sZW5xdWV1ZUZvcmNlVXBkYXRlOmZ1bmN0aW9uKGEsYil7YT1hLl9yZWFjdEludGVybmFsRmliZXI7dmFyIGM9R2coKSxkPURnLnN1c3BlbnNlO1xuYz1IZyhjLGEsZCk7ZD13ZyhjLGQpO2QudGFnPTI7dm9pZCAwIT09YiYmbnVsbCE9PWImJihkLmNhbGxiYWNrPWIpO3hnKGEsZCk7SWcoYSxjKX19O2Z1bmN0aW9uIEtnKGEsYixjLGQsZSxmLGcpe2E9YS5zdGF0ZU5vZGU7cmV0dXJuImZ1bmN0aW9uIj09PXR5cGVvZiBhLnNob3VsZENvbXBvbmVudFVwZGF0ZT9hLnNob3VsZENvbXBvbmVudFVwZGF0ZShkLGYsZyk6Yi5wcm90b3R5cGUmJmIucHJvdG90eXBlLmlzUHVyZVJlYWN0Q29tcG9uZW50PyFiZihjLGQpfHwhYmYoZSxmKTohMH1cbmZ1bmN0aW9uIExnKGEsYixjKXt2YXIgZD0hMSxlPUFmO3ZhciBmPWIuY29udGV4dFR5cGU7Im9iamVjdCI9PT10eXBlb2YgZiYmbnVsbCE9PWY/Zj1zZyhmKTooZT1MKGIpP0JmOkouY3VycmVudCxkPWIuY29udGV4dFR5cGVzLGY9KGQ9bnVsbCE9PWQmJnZvaWQgMCE9PWQpP0NmKGEsZSk6QWYpO2I9bmV3IGIoYyxmKTthLm1lbW9pemVkU3RhdGU9bnVsbCE9PWIuc3RhdGUmJnZvaWQgMCE9PWIuc3RhdGU/Yi5zdGF0ZTpudWxsO2IudXBkYXRlcj1KZzthLnN0YXRlTm9kZT1iO2IuX3JlYWN0SW50ZXJuYWxGaWJlcj1hO2QmJihhPWEuc3RhdGVOb2RlLGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dD1lLGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ9Zik7cmV0dXJuIGJ9XG5mdW5jdGlvbiBNZyhhLGIsYyxkKXthPWIuc3RhdGU7ImZ1bmN0aW9uIj09PXR5cGVvZiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJmIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLGQpOyJmdW5jdGlvbiI9PT10eXBlb2YgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyYmYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLGQpO2Iuc3RhdGUhPT1hJiZKZy5lbnF1ZXVlUmVwbGFjZVN0YXRlKGIsYi5zdGF0ZSxudWxsKX1cbmZ1bmN0aW9uIE5nKGEsYixjLGQpe3ZhciBlPWEuc3RhdGVOb2RlO2UucHJvcHM9YztlLnN0YXRlPWEubWVtb2l6ZWRTdGF0ZTtlLnJlZnM9RWc7dWcoYSk7dmFyIGY9Yi5jb250ZXh0VHlwZTsib2JqZWN0Ij09PXR5cGVvZiBmJiZudWxsIT09Zj9lLmNvbnRleHQ9c2coZik6KGY9TChiKT9CZjpKLmN1cnJlbnQsZS5jb250ZXh0PUNmKGEsZikpO3pnKGEsYyxlLGQpO2Uuc3RhdGU9YS5tZW1vaXplZFN0YXRlO2Y9Yi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7ImZ1bmN0aW9uIj09PXR5cGVvZiBmJiYoRmcoYSxiLGYsYyksZS5zdGF0ZT1hLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiI9PT10eXBlb2YgYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHN8fCJmdW5jdGlvbiI9PT10eXBlb2YgZS5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZXx8ImZ1bmN0aW9uIiE9PXR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQmJiJmdW5jdGlvbiIhPT10eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnR8fFxuKGI9ZS5zdGF0ZSwiZnVuY3Rpb24iPT09dHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50JiZlLmNvbXBvbmVudFdpbGxNb3VudCgpLCJmdW5jdGlvbiI9PT10eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50JiZlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSxiIT09ZS5zdGF0ZSYmSmcuZW5xdWV1ZVJlcGxhY2VTdGF0ZShlLGUuc3RhdGUsbnVsbCksemcoYSxjLGUsZCksZS5zdGF0ZT1hLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiI9PT10eXBlb2YgZS5jb21wb25lbnREaWRNb3VudCYmKGEuZWZmZWN0VGFnfD00KX12YXIgT2c9QXJyYXkuaXNBcnJheTtcbmZ1bmN0aW9uIFBnKGEsYixjKXthPWMucmVmO2lmKG51bGwhPT1hJiYiZnVuY3Rpb24iIT09dHlwZW9mIGEmJiJvYmplY3QiIT09dHlwZW9mIGEpe2lmKGMuX293bmVyKXtjPWMuX293bmVyO2lmKGMpe2lmKDEhPT1jLnRhZyl0aHJvdyBFcnJvcih1KDMwOSkpO3ZhciBkPWMuc3RhdGVOb2RlfWlmKCFkKXRocm93IEVycm9yKHUoMTQ3LGEpKTt2YXIgZT0iIithO2lmKG51bGwhPT1iJiZudWxsIT09Yi5yZWYmJiJmdW5jdGlvbiI9PT10eXBlb2YgYi5yZWYmJmIucmVmLl9zdHJpbmdSZWY9PT1lKXJldHVybiBiLnJlZjtiPWZ1bmN0aW9uKGEpe3ZhciBiPWQucmVmcztiPT09RWcmJihiPWQucmVmcz17fSk7bnVsbD09PWE/ZGVsZXRlIGJbZV06YltlXT1hfTtiLl9zdHJpbmdSZWY9ZTtyZXR1cm4gYn1pZigic3RyaW5nIiE9PXR5cGVvZiBhKXRocm93IEVycm9yKHUoMjg0KSk7aWYoIWMuX293bmVyKXRocm93IEVycm9yKHUoMjkwLGEpKTt9cmV0dXJuIGF9XG5mdW5jdGlvbiBRZyhhLGIpe2lmKCJ0ZXh0YXJlYSIhPT1hLnR5cGUpdGhyb3cgRXJyb3IodSgzMSwiW29iamVjdCBPYmplY3RdIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiKT8ib2JqZWN0IHdpdGgga2V5cyB7IitPYmplY3Qua2V5cyhiKS5qb2luKCIsICIpKyJ9IjpiLCIiKSk7fVxuZnVuY3Rpb24gUmcoYSl7ZnVuY3Rpb24gYihiLGMpe2lmKGEpe3ZhciBkPWIubGFzdEVmZmVjdDtudWxsIT09ZD8oZC5uZXh0RWZmZWN0PWMsYi5sYXN0RWZmZWN0PWMpOmIuZmlyc3RFZmZlY3Q9Yi5sYXN0RWZmZWN0PWM7Yy5uZXh0RWZmZWN0PW51bGw7Yy5lZmZlY3RUYWc9OH19ZnVuY3Rpb24gYyhjLGQpe2lmKCFhKXJldHVybiBudWxsO2Zvcig7bnVsbCE9PWQ7KWIoYyxkKSxkPWQuc2libGluZztyZXR1cm4gbnVsbH1mdW5jdGlvbiBkKGEsYil7Zm9yKGE9bmV3IE1hcDtudWxsIT09YjspbnVsbCE9PWIua2V5P2Euc2V0KGIua2V5LGIpOmEuc2V0KGIuaW5kZXgsYiksYj1iLnNpYmxpbmc7cmV0dXJuIGF9ZnVuY3Rpb24gZShhLGIpe2E9U2coYSxiKTthLmluZGV4PTA7YS5zaWJsaW5nPW51bGw7cmV0dXJuIGF9ZnVuY3Rpb24gZihiLGMsZCl7Yi5pbmRleD1kO2lmKCFhKXJldHVybiBjO2Q9Yi5hbHRlcm5hdGU7aWYobnVsbCE9PWQpcmV0dXJuIGQ9ZC5pbmRleCxkPGM/KGIuZWZmZWN0VGFnPVxuMixjKTpkO2IuZWZmZWN0VGFnPTI7cmV0dXJuIGN9ZnVuY3Rpb24gZyhiKXthJiZudWxsPT09Yi5hbHRlcm5hdGUmJihiLmVmZmVjdFRhZz0yKTtyZXR1cm4gYn1mdW5jdGlvbiBoKGEsYixjLGQpe2lmKG51bGw9PT1ifHw2IT09Yi50YWcpcmV0dXJuIGI9VGcoYyxhLm1vZGUsZCksYi5yZXR1cm49YSxiO2I9ZShiLGMpO2IucmV0dXJuPWE7cmV0dXJuIGJ9ZnVuY3Rpb24gayhhLGIsYyxkKXtpZihudWxsIT09YiYmYi5lbGVtZW50VHlwZT09PWMudHlwZSlyZXR1cm4gZD1lKGIsYy5wcm9wcyksZC5yZWY9UGcoYSxiLGMpLGQucmV0dXJuPWEsZDtkPVVnKGMudHlwZSxjLmtleSxjLnByb3BzLG51bGwsYS5tb2RlLGQpO2QucmVmPVBnKGEsYixjKTtkLnJldHVybj1hO3JldHVybiBkfWZ1bmN0aW9uIGwoYSxiLGMsZCl7aWYobnVsbD09PWJ8fDQhPT1iLnRhZ3x8Yi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyE9PWMuY29udGFpbmVySW5mb3x8Yi5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24hPT1cbmMuaW1wbGVtZW50YXRpb24pcmV0dXJuIGI9VmcoYyxhLm1vZGUsZCksYi5yZXR1cm49YSxiO2I9ZShiLGMuY2hpbGRyZW58fFtdKTtiLnJldHVybj1hO3JldHVybiBifWZ1bmN0aW9uIG0oYSxiLGMsZCxmKXtpZihudWxsPT09Ynx8NyE9PWIudGFnKXJldHVybiBiPVdnKGMsYS5tb2RlLGQsZiksYi5yZXR1cm49YSxiO2I9ZShiLGMpO2IucmV0dXJuPWE7cmV0dXJuIGJ9ZnVuY3Rpb24gcChhLGIsYyl7aWYoInN0cmluZyI9PT10eXBlb2YgYnx8Im51bWJlciI9PT10eXBlb2YgYilyZXR1cm4gYj1UZygiIitiLGEubW9kZSxjKSxiLnJldHVybj1hLGI7aWYoIm9iamVjdCI9PT10eXBlb2YgYiYmbnVsbCE9PWIpe3N3aXRjaChiLiQkdHlwZW9mKXtjYXNlIFphOnJldHVybiBjPVVnKGIudHlwZSxiLmtleSxiLnByb3BzLG51bGwsYS5tb2RlLGMpLGMucmVmPVBnKGEsbnVsbCxiKSxjLnJldHVybj1hLGM7Y2FzZSAkYTpyZXR1cm4gYj1WZyhiLGEubW9kZSxjKSxiLnJldHVybj1hLGJ9aWYoT2coYil8fFxubmIoYikpcmV0dXJuIGI9V2coYixhLm1vZGUsYyxudWxsKSxiLnJldHVybj1hLGI7UWcoYSxiKX1yZXR1cm4gbnVsbH1mdW5jdGlvbiB4KGEsYixjLGQpe3ZhciBlPW51bGwhPT1iP2Iua2V5Om51bGw7aWYoInN0cmluZyI9PT10eXBlb2YgY3x8Im51bWJlciI9PT10eXBlb2YgYylyZXR1cm4gbnVsbCE9PWU/bnVsbDpoKGEsYiwiIitjLGQpO2lmKCJvYmplY3QiPT09dHlwZW9mIGMmJm51bGwhPT1jKXtzd2l0Y2goYy4kJHR5cGVvZil7Y2FzZSBaYTpyZXR1cm4gYy5rZXk9PT1lP2MudHlwZT09PWFiP20oYSxiLGMucHJvcHMuY2hpbGRyZW4sZCxlKTprKGEsYixjLGQpOm51bGw7Y2FzZSAkYTpyZXR1cm4gYy5rZXk9PT1lP2woYSxiLGMsZCk6bnVsbH1pZihPZyhjKXx8bmIoYykpcmV0dXJuIG51bGwhPT1lP251bGw6bShhLGIsYyxkLG51bGwpO1FnKGEsYyl9cmV0dXJuIG51bGx9ZnVuY3Rpb24geihhLGIsYyxkLGUpe2lmKCJzdHJpbmciPT09dHlwZW9mIGR8fCJudW1iZXIiPT09dHlwZW9mIGQpcmV0dXJuIGE9XG5hLmdldChjKXx8bnVsbCxoKGIsYSwiIitkLGUpO2lmKCJvYmplY3QiPT09dHlwZW9mIGQmJm51bGwhPT1kKXtzd2l0Y2goZC4kJHR5cGVvZil7Y2FzZSBaYTpyZXR1cm4gYT1hLmdldChudWxsPT09ZC5rZXk/YzpkLmtleSl8fG51bGwsZC50eXBlPT09YWI/bShiLGEsZC5wcm9wcy5jaGlsZHJlbixlLGQua2V5KTprKGIsYSxkLGUpO2Nhc2UgJGE6cmV0dXJuIGE9YS5nZXQobnVsbD09PWQua2V5P2M6ZC5rZXkpfHxudWxsLGwoYixhLGQsZSl9aWYoT2coZCl8fG5iKGQpKXJldHVybiBhPWEuZ2V0KGMpfHxudWxsLG0oYixhLGQsZSxudWxsKTtRZyhiLGQpfXJldHVybiBudWxsfWZ1bmN0aW9uIGNhKGUsZyxoLGspe2Zvcih2YXIgbD1udWxsLHQ9bnVsbCxtPWcseT1nPTAsQT1udWxsO251bGwhPT1tJiZ5PGgubGVuZ3RoO3krKyl7bS5pbmRleD55PyhBPW0sbT1udWxsKTpBPW0uc2libGluZzt2YXIgcT14KGUsbSxoW3ldLGspO2lmKG51bGw9PT1xKXtudWxsPT09bSYmKG09QSk7YnJlYWt9YSYmXG5tJiZudWxsPT09cS5hbHRlcm5hdGUmJmIoZSxtKTtnPWYocSxnLHkpO251bGw9PT10P2w9cTp0LnNpYmxpbmc9cTt0PXE7bT1BfWlmKHk9PT1oLmxlbmd0aClyZXR1cm4gYyhlLG0pLGw7aWYobnVsbD09PW0pe2Zvcig7eTxoLmxlbmd0aDt5KyspbT1wKGUsaFt5XSxrKSxudWxsIT09bSYmKGc9ZihtLGcseSksbnVsbD09PXQ/bD1tOnQuc2libGluZz1tLHQ9bSk7cmV0dXJuIGx9Zm9yKG09ZChlLG0pO3k8aC5sZW5ndGg7eSsrKUE9eihtLGUseSxoW3ldLGspLG51bGwhPT1BJiYoYSYmbnVsbCE9PUEuYWx0ZXJuYXRlJiZtLmRlbGV0ZShudWxsPT09QS5rZXk/eTpBLmtleSksZz1mKEEsZyx5KSxudWxsPT09dD9sPUE6dC5zaWJsaW5nPUEsdD1BKTthJiZtLmZvckVhY2goZnVuY3Rpb24oYSl7cmV0dXJuIGIoZSxhKX0pO3JldHVybiBsfWZ1bmN0aW9uIEQoZSxnLGgsbCl7dmFyIGs9bmIoaCk7aWYoImZ1bmN0aW9uIiE9PXR5cGVvZiBrKXRocm93IEVycm9yKHUoMTUwKSk7aD1rLmNhbGwoaCk7XG5pZihudWxsPT1oKXRocm93IEVycm9yKHUoMTUxKSk7Zm9yKHZhciBtPWs9bnVsbCx0PWcseT1nPTAsQT1udWxsLHE9aC5uZXh0KCk7bnVsbCE9PXQmJiFxLmRvbmU7eSsrLHE9aC5uZXh0KCkpe3QuaW5kZXg+eT8oQT10LHQ9bnVsbCk6QT10LnNpYmxpbmc7dmFyIEQ9eChlLHQscS52YWx1ZSxsKTtpZihudWxsPT09RCl7bnVsbD09PXQmJih0PUEpO2JyZWFrfWEmJnQmJm51bGw9PT1ELmFsdGVybmF0ZSYmYihlLHQpO2c9ZihELGcseSk7bnVsbD09PW0/az1EOm0uc2libGluZz1EO209RDt0PUF9aWYocS5kb25lKXJldHVybiBjKGUsdCksaztpZihudWxsPT09dCl7Zm9yKDshcS5kb25lO3krKyxxPWgubmV4dCgpKXE9cChlLHEudmFsdWUsbCksbnVsbCE9PXEmJihnPWYocSxnLHkpLG51bGw9PT1tP2s9cTptLnNpYmxpbmc9cSxtPXEpO3JldHVybiBrfWZvcih0PWQoZSx0KTshcS5kb25lO3krKyxxPWgubmV4dCgpKXE9eih0LGUseSxxLnZhbHVlLGwpLG51bGwhPT1xJiYoYSYmbnVsbCE9PVxucS5hbHRlcm5hdGUmJnQuZGVsZXRlKG51bGw9PT1xLmtleT95OnEua2V5KSxnPWYocSxnLHkpLG51bGw9PT1tP2s9cTptLnNpYmxpbmc9cSxtPXEpO2EmJnQuZm9yRWFjaChmdW5jdGlvbihhKXtyZXR1cm4gYihlLGEpfSk7cmV0dXJuIGt9cmV0dXJuIGZ1bmN0aW9uKGEsZCxmLGgpe3ZhciBrPSJvYmplY3QiPT09dHlwZW9mIGYmJm51bGwhPT1mJiZmLnR5cGU9PT1hYiYmbnVsbD09PWYua2V5O2smJihmPWYucHJvcHMuY2hpbGRyZW4pO3ZhciBsPSJvYmplY3QiPT09dHlwZW9mIGYmJm51bGwhPT1mO2lmKGwpc3dpdGNoKGYuJCR0eXBlb2Ype2Nhc2UgWmE6YTp7bD1mLmtleTtmb3Ioaz1kO251bGwhPT1rOyl7aWYoay5rZXk9PT1sKXtzd2l0Y2goay50YWcpe2Nhc2UgNzppZihmLnR5cGU9PT1hYil7YyhhLGsuc2libGluZyk7ZD1lKGssZi5wcm9wcy5jaGlsZHJlbik7ZC5yZXR1cm49YTthPWQ7YnJlYWsgYX1icmVhaztkZWZhdWx0OmlmKGsuZWxlbWVudFR5cGU9PT1mLnR5cGUpe2MoYSxcbmsuc2libGluZyk7ZD1lKGssZi5wcm9wcyk7ZC5yZWY9UGcoYSxrLGYpO2QucmV0dXJuPWE7YT1kO2JyZWFrIGF9fWMoYSxrKTticmVha31lbHNlIGIoYSxrKTtrPWsuc2libGluZ31mLnR5cGU9PT1hYj8oZD1XZyhmLnByb3BzLmNoaWxkcmVuLGEubW9kZSxoLGYua2V5KSxkLnJldHVybj1hLGE9ZCk6KGg9VWcoZi50eXBlLGYua2V5LGYucHJvcHMsbnVsbCxhLm1vZGUsaCksaC5yZWY9UGcoYSxkLGYpLGgucmV0dXJuPWEsYT1oKX1yZXR1cm4gZyhhKTtjYXNlICRhOmE6e2ZvcihrPWYua2V5O251bGwhPT1kOyl7aWYoZC5rZXk9PT1rKWlmKDQ9PT1kLnRhZyYmZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbz09PWYuY29udGFpbmVySW5mbyYmZC5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb249PT1mLmltcGxlbWVudGF0aW9uKXtjKGEsZC5zaWJsaW5nKTtkPWUoZCxmLmNoaWxkcmVufHxbXSk7ZC5yZXR1cm49YTthPWQ7YnJlYWsgYX1lbHNle2MoYSxkKTticmVha31lbHNlIGIoYSxkKTtkPVxuZC5zaWJsaW5nfWQ9VmcoZixhLm1vZGUsaCk7ZC5yZXR1cm49YTthPWR9cmV0dXJuIGcoYSl9aWYoInN0cmluZyI9PT10eXBlb2YgZnx8Im51bWJlciI9PT10eXBlb2YgZilyZXR1cm4gZj0iIitmLG51bGwhPT1kJiY2PT09ZC50YWc/KGMoYSxkLnNpYmxpbmcpLGQ9ZShkLGYpLGQucmV0dXJuPWEsYT1kKTooYyhhLGQpLGQ9VGcoZixhLm1vZGUsaCksZC5yZXR1cm49YSxhPWQpLGcoYSk7aWYoT2coZikpcmV0dXJuIGNhKGEsZCxmLGgpO2lmKG5iKGYpKXJldHVybiBEKGEsZCxmLGgpO2wmJlFnKGEsZik7aWYoInVuZGVmaW5lZCI9PT10eXBlb2YgZiYmIWspc3dpdGNoKGEudGFnKXtjYXNlIDE6Y2FzZSAwOnRocm93IGE9YS50eXBlLEVycm9yKHUoMTUyLGEuZGlzcGxheU5hbWV8fGEubmFtZXx8IkNvbXBvbmVudCIpKTt9cmV0dXJuIGMoYSxkKX19dmFyIFhnPVJnKCEwKSxZZz1SZyghMSksWmc9e30sJGc9e2N1cnJlbnQ6Wmd9LGFoPXtjdXJyZW50OlpnfSxiaD17Y3VycmVudDpaZ307XG5mdW5jdGlvbiBjaChhKXtpZihhPT09WmcpdGhyb3cgRXJyb3IodSgxNzQpKTtyZXR1cm4gYX1mdW5jdGlvbiBkaChhLGIpe0koYmgsYik7SShhaCxhKTtJKCRnLFpnKTthPWIubm9kZVR5cGU7c3dpdGNoKGEpe2Nhc2UgOTpjYXNlIDExOmI9KGI9Yi5kb2N1bWVudEVsZW1lbnQpP2IubmFtZXNwYWNlVVJJOk9iKG51bGwsIiIpO2JyZWFrO2RlZmF1bHQ6YT04PT09YT9iLnBhcmVudE5vZGU6YixiPWEubmFtZXNwYWNlVVJJfHxudWxsLGE9YS50YWdOYW1lLGI9T2IoYixhKX1IKCRnKTtJKCRnLGIpfWZ1bmN0aW9uIGVoKCl7SCgkZyk7SChhaCk7SChiaCl9ZnVuY3Rpb24gZmgoYSl7Y2goYmguY3VycmVudCk7dmFyIGI9Y2goJGcuY3VycmVudCk7dmFyIGM9T2IoYixhLnR5cGUpO2IhPT1jJiYoSShhaCxhKSxJKCRnLGMpKX1mdW5jdGlvbiBnaChhKXthaC5jdXJyZW50PT09YSYmKEgoJGcpLEgoYWgpKX12YXIgTT17Y3VycmVudDowfTtcbmZ1bmN0aW9uIGhoKGEpe2Zvcih2YXIgYj1hO251bGwhPT1iOyl7aWYoMTM9PT1iLnRhZyl7dmFyIGM9Yi5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1jJiYoYz1jLmRlaHlkcmF0ZWQsbnVsbD09PWN8fGMuZGF0YT09PUJkfHxjLmRhdGE9PT1DZCkpcmV0dXJuIGJ9ZWxzZSBpZigxOT09PWIudGFnJiZ2b2lkIDAhPT1iLm1lbW9pemVkUHJvcHMucmV2ZWFsT3JkZXIpe2lmKDAhPT0oYi5lZmZlY3RUYWcmNjQpKXJldHVybiBifWVsc2UgaWYobnVsbCE9PWIuY2hpbGQpe2IuY2hpbGQucmV0dXJuPWI7Yj1iLmNoaWxkO2NvbnRpbnVlfWlmKGI9PT1hKWJyZWFrO2Zvcig7bnVsbD09PWIuc2libGluZzspe2lmKG51bGw9PT1iLnJldHVybnx8Yi5yZXR1cm49PT1hKXJldHVybiBudWxsO2I9Yi5yZXR1cm59Yi5zaWJsaW5nLnJldHVybj1iLnJldHVybjtiPWIuc2libGluZ31yZXR1cm4gbnVsbH1mdW5jdGlvbiBpaChhLGIpe3JldHVybntyZXNwb25kZXI6YSxwcm9wczpifX1cbnZhciBqaD1XYS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLGtoPVdhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLGxoPTAsTj1udWxsLE89bnVsbCxQPW51bGwsbWg9ITE7ZnVuY3Rpb24gUSgpe3Rocm93IEVycm9yKHUoMzIxKSk7fWZ1bmN0aW9uIG5oKGEsYil7aWYobnVsbD09PWIpcmV0dXJuITE7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aCYmYzxhLmxlbmd0aDtjKyspaWYoISRlKGFbY10sYltjXSkpcmV0dXJuITE7cmV0dXJuITB9XG5mdW5jdGlvbiBvaChhLGIsYyxkLGUsZil7bGg9ZjtOPWI7Yi5tZW1vaXplZFN0YXRlPW51bGw7Yi51cGRhdGVRdWV1ZT1udWxsO2IuZXhwaXJhdGlvblRpbWU9MDtqaC5jdXJyZW50PW51bGw9PT1hfHxudWxsPT09YS5tZW1vaXplZFN0YXRlP3BoOnFoO2E9YyhkLGUpO2lmKGIuZXhwaXJhdGlvblRpbWU9PT1saCl7Zj0wO2Rve2IuZXhwaXJhdGlvblRpbWU9MDtpZighKDI1PmYpKXRocm93IEVycm9yKHUoMzAxKSk7Zis9MTtQPU89bnVsbDtiLnVwZGF0ZVF1ZXVlPW51bGw7amguY3VycmVudD1yaDthPWMoZCxlKX13aGlsZShiLmV4cGlyYXRpb25UaW1lPT09bGgpfWpoLmN1cnJlbnQ9c2g7Yj1udWxsIT09TyYmbnVsbCE9PU8ubmV4dDtsaD0wO1A9Tz1OPW51bGw7bWg9ITE7aWYoYil0aHJvdyBFcnJvcih1KDMwMCkpO3JldHVybiBhfVxuZnVuY3Rpb24gdGgoKXt2YXIgYT17bWVtb2l6ZWRTdGF0ZTpudWxsLGJhc2VTdGF0ZTpudWxsLGJhc2VRdWV1ZTpudWxsLHF1ZXVlOm51bGwsbmV4dDpudWxsfTtudWxsPT09UD9OLm1lbW9pemVkU3RhdGU9UD1hOlA9UC5uZXh0PWE7cmV0dXJuIFB9ZnVuY3Rpb24gdWgoKXtpZihudWxsPT09Tyl7dmFyIGE9Ti5hbHRlcm5hdGU7YT1udWxsIT09YT9hLm1lbW9pemVkU3RhdGU6bnVsbH1lbHNlIGE9Ty5uZXh0O3ZhciBiPW51bGw9PT1QP04ubWVtb2l6ZWRTdGF0ZTpQLm5leHQ7aWYobnVsbCE9PWIpUD1iLE89YTtlbHNle2lmKG51bGw9PT1hKXRocm93IEVycm9yKHUoMzEwKSk7Tz1hO2E9e21lbW9pemVkU3RhdGU6Ty5tZW1vaXplZFN0YXRlLGJhc2VTdGF0ZTpPLmJhc2VTdGF0ZSxiYXNlUXVldWU6Ty5iYXNlUXVldWUscXVldWU6Ty5xdWV1ZSxuZXh0Om51bGx9O251bGw9PT1QP04ubWVtb2l6ZWRTdGF0ZT1QPWE6UD1QLm5leHQ9YX1yZXR1cm4gUH1cbmZ1bmN0aW9uIHZoKGEsYil7cmV0dXJuImZ1bmN0aW9uIj09PXR5cGVvZiBiP2IoYSk6Yn1cbmZ1bmN0aW9uIHdoKGEpe3ZhciBiPXVoKCksYz1iLnF1ZXVlO2lmKG51bGw9PT1jKXRocm93IEVycm9yKHUoMzExKSk7Yy5sYXN0UmVuZGVyZWRSZWR1Y2VyPWE7dmFyIGQ9TyxlPWQuYmFzZVF1ZXVlLGY9Yy5wZW5kaW5nO2lmKG51bGwhPT1mKXtpZihudWxsIT09ZSl7dmFyIGc9ZS5uZXh0O2UubmV4dD1mLm5leHQ7Zi5uZXh0PWd9ZC5iYXNlUXVldWU9ZT1mO2MucGVuZGluZz1udWxsfWlmKG51bGwhPT1lKXtlPWUubmV4dDtkPWQuYmFzZVN0YXRlO3ZhciBoPWc9Zj1udWxsLGs9ZTtkb3t2YXIgbD1rLmV4cGlyYXRpb25UaW1lO2lmKGw8bGgpe3ZhciBtPXtleHBpcmF0aW9uVGltZTprLmV4cGlyYXRpb25UaW1lLHN1c3BlbnNlQ29uZmlnOmsuc3VzcGVuc2VDb25maWcsYWN0aW9uOmsuYWN0aW9uLGVhZ2VyUmVkdWNlcjprLmVhZ2VyUmVkdWNlcixlYWdlclN0YXRlOmsuZWFnZXJTdGF0ZSxuZXh0Om51bGx9O251bGw9PT1oPyhnPWg9bSxmPWQpOmg9aC5uZXh0PW07bD5OLmV4cGlyYXRpb25UaW1lJiZcbihOLmV4cGlyYXRpb25UaW1lPWwsQmcobCkpfWVsc2UgbnVsbCE9PWgmJihoPWgubmV4dD17ZXhwaXJhdGlvblRpbWU6MTA3Mzc0MTgyMyxzdXNwZW5zZUNvbmZpZzprLnN1c3BlbnNlQ29uZmlnLGFjdGlvbjprLmFjdGlvbixlYWdlclJlZHVjZXI6ay5lYWdlclJlZHVjZXIsZWFnZXJTdGF0ZTprLmVhZ2VyU3RhdGUsbmV4dDpudWxsfSksQWcobCxrLnN1c3BlbnNlQ29uZmlnKSxkPWsuZWFnZXJSZWR1Y2VyPT09YT9rLmVhZ2VyU3RhdGU6YShkLGsuYWN0aW9uKTtrPWsubmV4dH13aGlsZShudWxsIT09ayYmayE9PWUpO251bGw9PT1oP2Y9ZDpoLm5leHQ9ZzskZShkLGIubWVtb2l6ZWRTdGF0ZSl8fChyZz0hMCk7Yi5tZW1vaXplZFN0YXRlPWQ7Yi5iYXNlU3RhdGU9ZjtiLmJhc2VRdWV1ZT1oO2MubGFzdFJlbmRlcmVkU3RhdGU9ZH1yZXR1cm5bYi5tZW1vaXplZFN0YXRlLGMuZGlzcGF0Y2hdfVxuZnVuY3Rpb24geGgoYSl7dmFyIGI9dWgoKSxjPWIucXVldWU7aWYobnVsbD09PWMpdGhyb3cgRXJyb3IodSgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXI9YTt2YXIgZD1jLmRpc3BhdGNoLGU9Yy5wZW5kaW5nLGY9Yi5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1lKXtjLnBlbmRpbmc9bnVsbDt2YXIgZz1lPWUubmV4dDtkbyBmPWEoZixnLmFjdGlvbiksZz1nLm5leHQ7d2hpbGUoZyE9PWUpOyRlKGYsYi5tZW1vaXplZFN0YXRlKXx8KHJnPSEwKTtiLm1lbW9pemVkU3RhdGU9ZjtudWxsPT09Yi5iYXNlUXVldWUmJihiLmJhc2VTdGF0ZT1mKTtjLmxhc3RSZW5kZXJlZFN0YXRlPWZ9cmV0dXJuW2YsZF19XG5mdW5jdGlvbiB5aChhKXt2YXIgYj10aCgpOyJmdW5jdGlvbiI9PT10eXBlb2YgYSYmKGE9YSgpKTtiLm1lbW9pemVkU3RhdGU9Yi5iYXNlU3RhdGU9YTthPWIucXVldWU9e3BlbmRpbmc6bnVsbCxkaXNwYXRjaDpudWxsLGxhc3RSZW5kZXJlZFJlZHVjZXI6dmgsbGFzdFJlbmRlcmVkU3RhdGU6YX07YT1hLmRpc3BhdGNoPXpoLmJpbmQobnVsbCxOLGEpO3JldHVybltiLm1lbW9pemVkU3RhdGUsYV19ZnVuY3Rpb24gQWgoYSxiLGMsZCl7YT17dGFnOmEsY3JlYXRlOmIsZGVzdHJveTpjLGRlcHM6ZCxuZXh0Om51bGx9O2I9Ti51cGRhdGVRdWV1ZTtudWxsPT09Yj8oYj17bGFzdEVmZmVjdDpudWxsfSxOLnVwZGF0ZVF1ZXVlPWIsYi5sYXN0RWZmZWN0PWEubmV4dD1hKTooYz1iLmxhc3RFZmZlY3QsbnVsbD09PWM/Yi5sYXN0RWZmZWN0PWEubmV4dD1hOihkPWMubmV4dCxjLm5leHQ9YSxhLm5leHQ9ZCxiLmxhc3RFZmZlY3Q9YSkpO3JldHVybiBhfVxuZnVuY3Rpb24gQmgoKXtyZXR1cm4gdWgoKS5tZW1vaXplZFN0YXRlfWZ1bmN0aW9uIENoKGEsYixjLGQpe3ZhciBlPXRoKCk7Ti5lZmZlY3RUYWd8PWE7ZS5tZW1vaXplZFN0YXRlPUFoKDF8YixjLHZvaWQgMCx2b2lkIDA9PT1kP251bGw6ZCl9ZnVuY3Rpb24gRGgoYSxiLGMsZCl7dmFyIGU9dWgoKTtkPXZvaWQgMD09PWQ/bnVsbDpkO3ZhciBmPXZvaWQgMDtpZihudWxsIT09Tyl7dmFyIGc9Ty5tZW1vaXplZFN0YXRlO2Y9Zy5kZXN0cm95O2lmKG51bGwhPT1kJiZuaChkLGcuZGVwcykpe0FoKGIsYyxmLGQpO3JldHVybn19Ti5lZmZlY3RUYWd8PWE7ZS5tZW1vaXplZFN0YXRlPUFoKDF8YixjLGYsZCl9ZnVuY3Rpb24gRWgoYSxiKXtyZXR1cm4gQ2goNTE2LDQsYSxiKX1mdW5jdGlvbiBGaChhLGIpe3JldHVybiBEaCg1MTYsNCxhLGIpfWZ1bmN0aW9uIEdoKGEsYil7cmV0dXJuIERoKDQsMixhLGIpfVxuZnVuY3Rpb24gSGgoYSxiKXtpZigiZnVuY3Rpb24iPT09dHlwZW9mIGIpcmV0dXJuIGE9YSgpLGIoYSksZnVuY3Rpb24oKXtiKG51bGwpfTtpZihudWxsIT09YiYmdm9pZCAwIT09YilyZXR1cm4gYT1hKCksYi5jdXJyZW50PWEsZnVuY3Rpb24oKXtiLmN1cnJlbnQ9bnVsbH19ZnVuY3Rpb24gSWgoYSxiLGMpe2M9bnVsbCE9PWMmJnZvaWQgMCE9PWM/Yy5jb25jYXQoW2FdKTpudWxsO3JldHVybiBEaCg0LDIsSGguYmluZChudWxsLGIsYSksYyl9ZnVuY3Rpb24gSmgoKXt9ZnVuY3Rpb24gS2goYSxiKXt0aCgpLm1lbW9pemVkU3RhdGU9W2Esdm9pZCAwPT09Yj9udWxsOmJdO3JldHVybiBhfWZ1bmN0aW9uIExoKGEsYil7dmFyIGM9dWgoKTtiPXZvaWQgMD09PWI/bnVsbDpiO3ZhciBkPWMubWVtb2l6ZWRTdGF0ZTtpZihudWxsIT09ZCYmbnVsbCE9PWImJm5oKGIsZFsxXSkpcmV0dXJuIGRbMF07Yy5tZW1vaXplZFN0YXRlPVthLGJdO3JldHVybiBhfVxuZnVuY3Rpb24gTWgoYSxiKXt2YXIgYz11aCgpO2I9dm9pZCAwPT09Yj9udWxsOmI7dmFyIGQ9Yy5tZW1vaXplZFN0YXRlO2lmKG51bGwhPT1kJiZudWxsIT09YiYmbmgoYixkWzFdKSlyZXR1cm4gZFswXTthPWEoKTtjLm1lbW9pemVkU3RhdGU9W2EsYl07cmV0dXJuIGF9ZnVuY3Rpb24gTmgoYSxiLGMpe3ZhciBkPWFnKCk7Y2coOTg+ZD85ODpkLGZ1bmN0aW9uKCl7YSghMCl9KTtjZyg5NzxkPzk3OmQsZnVuY3Rpb24oKXt2YXIgZD1raC5zdXNwZW5zZTtraC5zdXNwZW5zZT12b2lkIDA9PT1iP251bGw6Yjt0cnl7YSghMSksYygpfWZpbmFsbHl7a2guc3VzcGVuc2U9ZH19KX1cbmZ1bmN0aW9uIHpoKGEsYixjKXt2YXIgZD1HZygpLGU9RGcuc3VzcGVuc2U7ZD1IZyhkLGEsZSk7ZT17ZXhwaXJhdGlvblRpbWU6ZCxzdXNwZW5zZUNvbmZpZzplLGFjdGlvbjpjLGVhZ2VyUmVkdWNlcjpudWxsLGVhZ2VyU3RhdGU6bnVsbCxuZXh0Om51bGx9O3ZhciBmPWIucGVuZGluZztudWxsPT09Zj9lLm5leHQ9ZTooZS5uZXh0PWYubmV4dCxmLm5leHQ9ZSk7Yi5wZW5kaW5nPWU7Zj1hLmFsdGVybmF0ZTtpZihhPT09Tnx8bnVsbCE9PWYmJmY9PT1OKW1oPSEwLGUuZXhwaXJhdGlvblRpbWU9bGgsTi5leHBpcmF0aW9uVGltZT1saDtlbHNle2lmKDA9PT1hLmV4cGlyYXRpb25UaW1lJiYobnVsbD09PWZ8fDA9PT1mLmV4cGlyYXRpb25UaW1lKSYmKGY9Yi5sYXN0UmVuZGVyZWRSZWR1Y2VyLG51bGwhPT1mKSl0cnl7dmFyIGc9Yi5sYXN0UmVuZGVyZWRTdGF0ZSxoPWYoZyxjKTtlLmVhZ2VyUmVkdWNlcj1mO2UuZWFnZXJTdGF0ZT1oO2lmKCRlKGgsZykpcmV0dXJufWNhdGNoKGspe31maW5hbGx5e31JZyhhLFxuZCl9fVxudmFyIHNoPXtyZWFkQ29udGV4dDpzZyx1c2VDYWxsYmFjazpRLHVzZUNvbnRleHQ6USx1c2VFZmZlY3Q6USx1c2VJbXBlcmF0aXZlSGFuZGxlOlEsdXNlTGF5b3V0RWZmZWN0OlEsdXNlTWVtbzpRLHVzZVJlZHVjZXI6USx1c2VSZWY6USx1c2VTdGF0ZTpRLHVzZURlYnVnVmFsdWU6USx1c2VSZXNwb25kZXI6USx1c2VEZWZlcnJlZFZhbHVlOlEsdXNlVHJhbnNpdGlvbjpRfSxwaD17cmVhZENvbnRleHQ6c2csdXNlQ2FsbGJhY2s6S2gsdXNlQ29udGV4dDpzZyx1c2VFZmZlY3Q6RWgsdXNlSW1wZXJhdGl2ZUhhbmRsZTpmdW5jdGlvbihhLGIsYyl7Yz1udWxsIT09YyYmdm9pZCAwIT09Yz9jLmNvbmNhdChbYV0pOm51bGw7cmV0dXJuIENoKDQsMixIaC5iaW5kKG51bGwsYixhKSxjKX0sdXNlTGF5b3V0RWZmZWN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIENoKDQsMixhLGIpfSx1c2VNZW1vOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGgoKTtiPXZvaWQgMD09PWI/bnVsbDpiO2E9YSgpO2MubWVtb2l6ZWRTdGF0ZT1bYSxcbmJdO3JldHVybiBhfSx1c2VSZWR1Y2VyOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD10aCgpO2I9dm9pZCAwIT09Yz9jKGIpOmI7ZC5tZW1vaXplZFN0YXRlPWQuYmFzZVN0YXRlPWI7YT1kLnF1ZXVlPXtwZW5kaW5nOm51bGwsZGlzcGF0Y2g6bnVsbCxsYXN0UmVuZGVyZWRSZWR1Y2VyOmEsbGFzdFJlbmRlcmVkU3RhdGU6Yn07YT1hLmRpc3BhdGNoPXpoLmJpbmQobnVsbCxOLGEpO3JldHVybltkLm1lbW9pemVkU3RhdGUsYV19LHVzZVJlZjpmdW5jdGlvbihhKXt2YXIgYj10aCgpO2E9e2N1cnJlbnQ6YX07cmV0dXJuIGIubWVtb2l6ZWRTdGF0ZT1hfSx1c2VTdGF0ZTp5aCx1c2VEZWJ1Z1ZhbHVlOkpoLHVzZVJlc3BvbmRlcjppaCx1c2VEZWZlcnJlZFZhbHVlOmZ1bmN0aW9uKGEsYil7dmFyIGM9eWgoYSksZD1jWzBdLGU9Y1sxXTtFaChmdW5jdGlvbigpe3ZhciBjPWtoLnN1c3BlbnNlO2toLnN1c3BlbnNlPXZvaWQgMD09PWI/bnVsbDpiO3RyeXtlKGEpfWZpbmFsbHl7a2guc3VzcGVuc2U9XG5jfX0sW2EsYl0pO3JldHVybiBkfSx1c2VUcmFuc2l0aW9uOmZ1bmN0aW9uKGEpe3ZhciBiPXloKCExKSxjPWJbMF07Yj1iWzFdO3JldHVybltLaChOaC5iaW5kKG51bGwsYixhKSxbYixhXSksY119fSxxaD17cmVhZENvbnRleHQ6c2csdXNlQ2FsbGJhY2s6TGgsdXNlQ29udGV4dDpzZyx1c2VFZmZlY3Q6RmgsdXNlSW1wZXJhdGl2ZUhhbmRsZTpJaCx1c2VMYXlvdXRFZmZlY3Q6R2gsdXNlTWVtbzpNaCx1c2VSZWR1Y2VyOndoLHVzZVJlZjpCaCx1c2VTdGF0ZTpmdW5jdGlvbigpe3JldHVybiB3aCh2aCl9LHVzZURlYnVnVmFsdWU6SmgsdXNlUmVzcG9uZGVyOmloLHVzZURlZmVycmVkVmFsdWU6ZnVuY3Rpb24oYSxiKXt2YXIgYz13aCh2aCksZD1jWzBdLGU9Y1sxXTtGaChmdW5jdGlvbigpe3ZhciBjPWtoLnN1c3BlbnNlO2toLnN1c3BlbnNlPXZvaWQgMD09PWI/bnVsbDpiO3RyeXtlKGEpfWZpbmFsbHl7a2guc3VzcGVuc2U9Y319LFthLGJdKTtyZXR1cm4gZH0sdXNlVHJhbnNpdGlvbjpmdW5jdGlvbihhKXt2YXIgYj1cbndoKHZoKSxjPWJbMF07Yj1iWzFdO3JldHVybltMaChOaC5iaW5kKG51bGwsYixhKSxbYixhXSksY119fSxyaD17cmVhZENvbnRleHQ6c2csdXNlQ2FsbGJhY2s6TGgsdXNlQ29udGV4dDpzZyx1c2VFZmZlY3Q6RmgsdXNlSW1wZXJhdGl2ZUhhbmRsZTpJaCx1c2VMYXlvdXRFZmZlY3Q6R2gsdXNlTWVtbzpNaCx1c2VSZWR1Y2VyOnhoLHVzZVJlZjpCaCx1c2VTdGF0ZTpmdW5jdGlvbigpe3JldHVybiB4aCh2aCl9LHVzZURlYnVnVmFsdWU6SmgsdXNlUmVzcG9uZGVyOmloLHVzZURlZmVycmVkVmFsdWU6ZnVuY3Rpb24oYSxiKXt2YXIgYz14aCh2aCksZD1jWzBdLGU9Y1sxXTtGaChmdW5jdGlvbigpe3ZhciBjPWtoLnN1c3BlbnNlO2toLnN1c3BlbnNlPXZvaWQgMD09PWI/bnVsbDpiO3RyeXtlKGEpfWZpbmFsbHl7a2guc3VzcGVuc2U9Y319LFthLGJdKTtyZXR1cm4gZH0sdXNlVHJhbnNpdGlvbjpmdW5jdGlvbihhKXt2YXIgYj14aCh2aCksYz1iWzBdO2I9YlsxXTtyZXR1cm5bTGgoTmguYmluZChudWxsLFxuYixhKSxbYixhXSksY119fSxPaD1udWxsLFBoPW51bGwsUWg9ITE7ZnVuY3Rpb24gUmgoYSxiKXt2YXIgYz1TaCg1LG51bGwsbnVsbCwwKTtjLmVsZW1lbnRUeXBlPSJERUxFVEVEIjtjLnR5cGU9IkRFTEVURUQiO2Muc3RhdGVOb2RlPWI7Yy5yZXR1cm49YTtjLmVmZmVjdFRhZz04O251bGwhPT1hLmxhc3RFZmZlY3Q/KGEubGFzdEVmZmVjdC5uZXh0RWZmZWN0PWMsYS5sYXN0RWZmZWN0PWMpOmEuZmlyc3RFZmZlY3Q9YS5sYXN0RWZmZWN0PWN9XG5mdW5jdGlvbiBUaChhLGIpe3N3aXRjaChhLnRhZyl7Y2FzZSA1OnZhciBjPWEudHlwZTtiPTEhPT1iLm5vZGVUeXBlfHxjLnRvTG93ZXJDYXNlKCkhPT1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/bnVsbDpiO3JldHVybiBudWxsIT09Yj8oYS5zdGF0ZU5vZGU9YiwhMCk6ITE7Y2FzZSA2OnJldHVybiBiPSIiPT09YS5wZW5kaW5nUHJvcHN8fDMhPT1iLm5vZGVUeXBlP251bGw6YixudWxsIT09Yj8oYS5zdGF0ZU5vZGU9YiwhMCk6ITE7Y2FzZSAxMzpyZXR1cm4hMTtkZWZhdWx0OnJldHVybiExfX1cbmZ1bmN0aW9uIFVoKGEpe2lmKFFoKXt2YXIgYj1QaDtpZihiKXt2YXIgYz1iO2lmKCFUaChhLGIpKXtiPUpkKGMubmV4dFNpYmxpbmcpO2lmKCFifHwhVGgoYSxiKSl7YS5lZmZlY3RUYWc9YS5lZmZlY3RUYWcmLTEwMjV8MjtRaD0hMTtPaD1hO3JldHVybn1SaChPaCxjKX1PaD1hO1BoPUpkKGIuZmlyc3RDaGlsZCl9ZWxzZSBhLmVmZmVjdFRhZz1hLmVmZmVjdFRhZyYtMTAyNXwyLFFoPSExLE9oPWF9fWZ1bmN0aW9uIFZoKGEpe2ZvcihhPWEucmV0dXJuO251bGwhPT1hJiY1IT09YS50YWcmJjMhPT1hLnRhZyYmMTMhPT1hLnRhZzspYT1hLnJldHVybjtPaD1hfVxuZnVuY3Rpb24gV2goYSl7aWYoYSE9PU9oKXJldHVybiExO2lmKCFRaClyZXR1cm4gVmgoYSksUWg9ITAsITE7dmFyIGI9YS50eXBlO2lmKDUhPT1hLnRhZ3x8ImhlYWQiIT09YiYmImJvZHkiIT09YiYmIUdkKGIsYS5tZW1vaXplZFByb3BzKSlmb3IoYj1QaDtiOylSaChhLGIpLGI9SmQoYi5uZXh0U2libGluZyk7VmgoYSk7aWYoMTM9PT1hLnRhZyl7YT1hLm1lbW9pemVkU3RhdGU7YT1udWxsIT09YT9hLmRlaHlkcmF0ZWQ6bnVsbDtpZighYSl0aHJvdyBFcnJvcih1KDMxNykpO2E6e2E9YS5uZXh0U2libGluZztmb3IoYj0wO2E7KXtpZig4PT09YS5ub2RlVHlwZSl7dmFyIGM9YS5kYXRhO2lmKGM9PT1BZCl7aWYoMD09PWIpe1BoPUpkKGEubmV4dFNpYmxpbmcpO2JyZWFrIGF9Yi0tfWVsc2UgYyE9PXpkJiZjIT09Q2QmJmMhPT1CZHx8YisrfWE9YS5uZXh0U2libGluZ31QaD1udWxsfX1lbHNlIFBoPU9oP0pkKGEuc3RhdGVOb2RlLm5leHRTaWJsaW5nKTpudWxsO3JldHVybiEwfVxuZnVuY3Rpb24gWGgoKXtQaD1PaD1udWxsO1FoPSExfXZhciBZaD1XYS5SZWFjdEN1cnJlbnRPd25lcixyZz0hMTtmdW5jdGlvbiBSKGEsYixjLGQpe2IuY2hpbGQ9bnVsbD09PWE/WWcoYixudWxsLGMsZCk6WGcoYixhLmNoaWxkLGMsZCl9ZnVuY3Rpb24gWmgoYSxiLGMsZCxlKXtjPWMucmVuZGVyO3ZhciBmPWIucmVmO3FnKGIsZSk7ZD1vaChhLGIsYyxkLGYsZSk7aWYobnVsbCE9PWEmJiFyZylyZXR1cm4gYi51cGRhdGVRdWV1ZT1hLnVwZGF0ZVF1ZXVlLGIuZWZmZWN0VGFnJj0tNTE3LGEuZXhwaXJhdGlvblRpbWU8PWUmJihhLmV4cGlyYXRpb25UaW1lPTApLCRoKGEsYixlKTtiLmVmZmVjdFRhZ3w9MTtSKGEsYixkLGUpO3JldHVybiBiLmNoaWxkfVxuZnVuY3Rpb24gYWkoYSxiLGMsZCxlLGYpe2lmKG51bGw9PT1hKXt2YXIgZz1jLnR5cGU7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBnJiYhYmkoZykmJnZvaWQgMD09PWcuZGVmYXVsdFByb3BzJiZudWxsPT09Yy5jb21wYXJlJiZ2b2lkIDA9PT1jLmRlZmF1bHRQcm9wcylyZXR1cm4gYi50YWc9MTUsYi50eXBlPWcsY2koYSxiLGcsZCxlLGYpO2E9VWcoYy50eXBlLG51bGwsZCxudWxsLGIubW9kZSxmKTthLnJlZj1iLnJlZjthLnJldHVybj1iO3JldHVybiBiLmNoaWxkPWF9Zz1hLmNoaWxkO2lmKGU8ZiYmKGU9Zy5tZW1vaXplZFByb3BzLGM9Yy5jb21wYXJlLGM9bnVsbCE9PWM/YzpiZixjKGUsZCkmJmEucmVmPT09Yi5yZWYpKXJldHVybiAkaChhLGIsZik7Yi5lZmZlY3RUYWd8PTE7YT1TZyhnLGQpO2EucmVmPWIucmVmO2EucmV0dXJuPWI7cmV0dXJuIGIuY2hpbGQ9YX1cbmZ1bmN0aW9uIGNpKGEsYixjLGQsZSxmKXtyZXR1cm4gbnVsbCE9PWEmJmJmKGEubWVtb2l6ZWRQcm9wcyxkKSYmYS5yZWY9PT1iLnJlZiYmKHJnPSExLGU8Zik/KGIuZXhwaXJhdGlvblRpbWU9YS5leHBpcmF0aW9uVGltZSwkaChhLGIsZikpOmRpKGEsYixjLGQsZil9ZnVuY3Rpb24gZWkoYSxiKXt2YXIgYz1iLnJlZjtpZihudWxsPT09YSYmbnVsbCE9PWN8fG51bGwhPT1hJiZhLnJlZiE9PWMpYi5lZmZlY3RUYWd8PTEyOH1mdW5jdGlvbiBkaShhLGIsYyxkLGUpe3ZhciBmPUwoYyk/QmY6Si5jdXJyZW50O2Y9Q2YoYixmKTtxZyhiLGUpO2M9b2goYSxiLGMsZCxmLGUpO2lmKG51bGwhPT1hJiYhcmcpcmV0dXJuIGIudXBkYXRlUXVldWU9YS51cGRhdGVRdWV1ZSxiLmVmZmVjdFRhZyY9LTUxNyxhLmV4cGlyYXRpb25UaW1lPD1lJiYoYS5leHBpcmF0aW9uVGltZT0wKSwkaChhLGIsZSk7Yi5lZmZlY3RUYWd8PTE7UihhLGIsYyxlKTtyZXR1cm4gYi5jaGlsZH1cbmZ1bmN0aW9uIGZpKGEsYixjLGQsZSl7aWYoTChjKSl7dmFyIGY9ITA7R2YoYil9ZWxzZSBmPSExO3FnKGIsZSk7aWYobnVsbD09PWIuc3RhdGVOb2RlKW51bGwhPT1hJiYoYS5hbHRlcm5hdGU9bnVsbCxiLmFsdGVybmF0ZT1udWxsLGIuZWZmZWN0VGFnfD0yKSxMZyhiLGMsZCksTmcoYixjLGQsZSksZD0hMDtlbHNlIGlmKG51bGw9PT1hKXt2YXIgZz1iLnN0YXRlTm9kZSxoPWIubWVtb2l6ZWRQcm9wcztnLnByb3BzPWg7dmFyIGs9Zy5jb250ZXh0LGw9Yy5jb250ZXh0VHlwZTsib2JqZWN0Ij09PXR5cGVvZiBsJiZudWxsIT09bD9sPXNnKGwpOihsPUwoYyk/QmY6Si5jdXJyZW50LGw9Q2YoYixsKSk7dmFyIG09Yy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMscD0iZnVuY3Rpb24iPT09dHlwZW9mIG18fCJmdW5jdGlvbiI9PT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZTtwfHwiZnVuY3Rpb24iIT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJlxuImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHN8fChoIT09ZHx8ayE9PWwpJiZNZyhiLGcsZCxsKTt0Zz0hMTt2YXIgeD1iLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZT14O3pnKGIsZCxnLGUpO2s9Yi5tZW1vaXplZFN0YXRlO2ghPT1kfHx4IT09a3x8Sy5jdXJyZW50fHx0Zz8oImZ1bmN0aW9uIj09PXR5cGVvZiBtJiYoRmcoYixjLG0sZCksaz1iLm1lbW9pemVkU3RhdGUpLChoPXRnfHxLZyhiLGMsaCxkLHgsayxsKSk/KHB8fCJmdW5jdGlvbiIhPT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50JiYiZnVuY3Rpb24iIT09dHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50fHwoImZ1bmN0aW9uIj09PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCYmZy5jb21wb25lbnRXaWxsTW91bnQoKSwiZnVuY3Rpb24iPT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCYmZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkpLCJmdW5jdGlvbiI9PT1cbnR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50JiYoYi5lZmZlY3RUYWd8PTQpKTooImZ1bmN0aW9uIj09PXR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50JiYoYi5lZmZlY3RUYWd8PTQpLGIubWVtb2l6ZWRQcm9wcz1kLGIubWVtb2l6ZWRTdGF0ZT1rKSxnLnByb3BzPWQsZy5zdGF0ZT1rLGcuY29udGV4dD1sLGQ9aCk6KCJmdW5jdGlvbiI9PT10eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCYmKGIuZWZmZWN0VGFnfD00KSxkPSExKX1lbHNlIGc9Yi5zdGF0ZU5vZGUsdmcoYSxiKSxoPWIubWVtb2l6ZWRQcm9wcyxnLnByb3BzPWIudHlwZT09PWIuZWxlbWVudFR5cGU/aDppZyhiLnR5cGUsaCksaz1nLmNvbnRleHQsbD1jLmNvbnRleHRUeXBlLCJvYmplY3QiPT09dHlwZW9mIGwmJm51bGwhPT1sP2w9c2cobCk6KGw9TChjKT9CZjpKLmN1cnJlbnQsbD1DZihiLGwpKSxtPWMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzLChwPSJmdW5jdGlvbiI9PT10eXBlb2YgbXx8ImZ1bmN0aW9uIj09PVxudHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUpfHwiZnVuY3Rpb24iIT09dHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJiJmdW5jdGlvbiIhPT10eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzfHwoaCE9PWR8fGshPT1sKSYmTWcoYixnLGQsbCksdGc9ITEsaz1iLm1lbW9pemVkU3RhdGUsZy5zdGF0ZT1rLHpnKGIsZCxnLGUpLHg9Yi5tZW1vaXplZFN0YXRlLGghPT1kfHxrIT09eHx8Sy5jdXJyZW50fHx0Zz8oImZ1bmN0aW9uIj09PXR5cGVvZiBtJiYoRmcoYixjLG0sZCkseD1iLm1lbW9pemVkU3RhdGUpLChtPXRnfHxLZyhiLGMsaCxkLGsseCxsKSk/KHB8fCJmdW5jdGlvbiIhPT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSYmImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGV8fCgiZnVuY3Rpb24iPT09dHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSYmZy5jb21wb25lbnRXaWxsVXBkYXRlKGQsXG54LGwpLCJmdW5jdGlvbiI9PT10eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSYmZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZShkLHgsbCkpLCJmdW5jdGlvbiI9PT10eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUmJihiLmVmZmVjdFRhZ3w9NCksImZ1bmN0aW9uIj09PXR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlJiYoYi5lZmZlY3RUYWd8PTI1NikpOigiZnVuY3Rpb24iIT09dHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlfHxoPT09YS5tZW1vaXplZFByb3BzJiZrPT09YS5tZW1vaXplZFN0YXRlfHwoYi5lZmZlY3RUYWd8PTQpLCJmdW5jdGlvbiIhPT10eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZXx8aD09PWEubWVtb2l6ZWRQcm9wcyYmaz09PWEubWVtb2l6ZWRTdGF0ZXx8KGIuZWZmZWN0VGFnfD0yNTYpLGIubWVtb2l6ZWRQcm9wcz1kLGIubWVtb2l6ZWRTdGF0ZT14KSxnLnByb3BzPWQsZy5zdGF0ZT14LGcuY29udGV4dD1sLGQ9bSk6XG4oImZ1bmN0aW9uIiE9PXR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZXx8aD09PWEubWVtb2l6ZWRQcm9wcyYmaz09PWEubWVtb2l6ZWRTdGF0ZXx8KGIuZWZmZWN0VGFnfD00KSwiZnVuY3Rpb24iIT09dHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGV8fGg9PT1hLm1lbW9pemVkUHJvcHMmJms9PT1hLm1lbW9pemVkU3RhdGV8fChiLmVmZmVjdFRhZ3w9MjU2KSxkPSExKTtyZXR1cm4gZ2koYSxiLGMsZCxmLGUpfVxuZnVuY3Rpb24gZ2koYSxiLGMsZCxlLGYpe2VpKGEsYik7dmFyIGc9MCE9PShiLmVmZmVjdFRhZyY2NCk7aWYoIWQmJiFnKXJldHVybiBlJiZIZihiLGMsITEpLCRoKGEsYixmKTtkPWIuc3RhdGVOb2RlO1loLmN1cnJlbnQ9Yjt2YXIgaD1nJiYiZnVuY3Rpb24iIT09dHlwZW9mIGMuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yP251bGw6ZC5yZW5kZXIoKTtiLmVmZmVjdFRhZ3w9MTtudWxsIT09YSYmZz8oYi5jaGlsZD1YZyhiLGEuY2hpbGQsbnVsbCxmKSxiLmNoaWxkPVhnKGIsbnVsbCxoLGYpKTpSKGEsYixoLGYpO2IubWVtb2l6ZWRTdGF0ZT1kLnN0YXRlO2UmJkhmKGIsYywhMCk7cmV0dXJuIGIuY2hpbGR9ZnVuY3Rpb24gaGkoYSl7dmFyIGI9YS5zdGF0ZU5vZGU7Yi5wZW5kaW5nQ29udGV4dD9FZihhLGIucGVuZGluZ0NvbnRleHQsYi5wZW5kaW5nQ29udGV4dCE9PWIuY29udGV4dCk6Yi5jb250ZXh0JiZFZihhLGIuY29udGV4dCwhMSk7ZGgoYSxiLmNvbnRhaW5lckluZm8pfVxudmFyIGlpPXtkZWh5ZHJhdGVkOm51bGwscmV0cnlUaW1lOjB9O1xuZnVuY3Rpb24gamkoYSxiLGMpe3ZhciBkPWIubW9kZSxlPWIucGVuZGluZ1Byb3BzLGY9TS5jdXJyZW50LGc9ITEsaDsoaD0wIT09KGIuZWZmZWN0VGFnJjY0KSl8fChoPTAhPT0oZiYyKSYmKG51bGw9PT1hfHxudWxsIT09YS5tZW1vaXplZFN0YXRlKSk7aD8oZz0hMCxiLmVmZmVjdFRhZyY9LTY1KTpudWxsIT09YSYmbnVsbD09PWEubWVtb2l6ZWRTdGF0ZXx8dm9pZCAwPT09ZS5mYWxsYmFja3x8ITA9PT1lLnVuc3RhYmxlX2F2b2lkVGhpc0ZhbGxiYWNrfHwoZnw9MSk7SShNLGYmMSk7aWYobnVsbD09PWEpe3ZvaWQgMCE9PWUuZmFsbGJhY2smJlVoKGIpO2lmKGcpe2c9ZS5mYWxsYmFjaztlPVdnKG51bGwsZCwwLG51bGwpO2UucmV0dXJuPWI7aWYoMD09PShiLm1vZGUmMikpZm9yKGE9bnVsbCE9PWIubWVtb2l6ZWRTdGF0ZT9iLmNoaWxkLmNoaWxkOmIuY2hpbGQsZS5jaGlsZD1hO251bGwhPT1hOylhLnJldHVybj1lLGE9YS5zaWJsaW5nO2M9V2coZyxkLGMsbnVsbCk7Yy5yZXR1cm49XG5iO2Uuc2libGluZz1jO2IubWVtb2l6ZWRTdGF0ZT1paTtiLmNoaWxkPWU7cmV0dXJuIGN9ZD1lLmNoaWxkcmVuO2IubWVtb2l6ZWRTdGF0ZT1udWxsO3JldHVybiBiLmNoaWxkPVlnKGIsbnVsbCxkLGMpfWlmKG51bGwhPT1hLm1lbW9pemVkU3RhdGUpe2E9YS5jaGlsZDtkPWEuc2libGluZztpZihnKXtlPWUuZmFsbGJhY2s7Yz1TZyhhLGEucGVuZGluZ1Byb3BzKTtjLnJldHVybj1iO2lmKDA9PT0oYi5tb2RlJjIpJiYoZz1udWxsIT09Yi5tZW1vaXplZFN0YXRlP2IuY2hpbGQuY2hpbGQ6Yi5jaGlsZCxnIT09YS5jaGlsZCkpZm9yKGMuY2hpbGQ9ZztudWxsIT09ZzspZy5yZXR1cm49YyxnPWcuc2libGluZztkPVNnKGQsZSk7ZC5yZXR1cm49YjtjLnNpYmxpbmc9ZDtjLmNoaWxkRXhwaXJhdGlvblRpbWU9MDtiLm1lbW9pemVkU3RhdGU9aWk7Yi5jaGlsZD1jO3JldHVybiBkfWM9WGcoYixhLmNoaWxkLGUuY2hpbGRyZW4sYyk7Yi5tZW1vaXplZFN0YXRlPW51bGw7cmV0dXJuIGIuY2hpbGQ9XG5jfWE9YS5jaGlsZDtpZihnKXtnPWUuZmFsbGJhY2s7ZT1XZyhudWxsLGQsMCxudWxsKTtlLnJldHVybj1iO2UuY2hpbGQ9YTtudWxsIT09YSYmKGEucmV0dXJuPWUpO2lmKDA9PT0oYi5tb2RlJjIpKWZvcihhPW51bGwhPT1iLm1lbW9pemVkU3RhdGU/Yi5jaGlsZC5jaGlsZDpiLmNoaWxkLGUuY2hpbGQ9YTtudWxsIT09YTspYS5yZXR1cm49ZSxhPWEuc2libGluZztjPVdnKGcsZCxjLG51bGwpO2MucmV0dXJuPWI7ZS5zaWJsaW5nPWM7Yy5lZmZlY3RUYWd8PTI7ZS5jaGlsZEV4cGlyYXRpb25UaW1lPTA7Yi5tZW1vaXplZFN0YXRlPWlpO2IuY2hpbGQ9ZTtyZXR1cm4gY31iLm1lbW9pemVkU3RhdGU9bnVsbDtyZXR1cm4gYi5jaGlsZD1YZyhiLGEsZS5jaGlsZHJlbixjKX1cbmZ1bmN0aW9uIGtpKGEsYil7YS5leHBpcmF0aW9uVGltZTxiJiYoYS5leHBpcmF0aW9uVGltZT1iKTt2YXIgYz1hLmFsdGVybmF0ZTtudWxsIT09YyYmYy5leHBpcmF0aW9uVGltZTxiJiYoYy5leHBpcmF0aW9uVGltZT1iKTtwZyhhLnJldHVybixiKX1mdW5jdGlvbiBsaShhLGIsYyxkLGUsZil7dmFyIGc9YS5tZW1vaXplZFN0YXRlO251bGw9PT1nP2EubWVtb2l6ZWRTdGF0ZT17aXNCYWNrd2FyZHM6YixyZW5kZXJpbmc6bnVsbCxyZW5kZXJpbmdTdGFydFRpbWU6MCxsYXN0OmQsdGFpbDpjLHRhaWxFeHBpcmF0aW9uOjAsdGFpbE1vZGU6ZSxsYXN0RWZmZWN0OmZ9OihnLmlzQmFja3dhcmRzPWIsZy5yZW5kZXJpbmc9bnVsbCxnLnJlbmRlcmluZ1N0YXJ0VGltZT0wLGcubGFzdD1kLGcudGFpbD1jLGcudGFpbEV4cGlyYXRpb249MCxnLnRhaWxNb2RlPWUsZy5sYXN0RWZmZWN0PWYpfVxuZnVuY3Rpb24gbWkoYSxiLGMpe3ZhciBkPWIucGVuZGluZ1Byb3BzLGU9ZC5yZXZlYWxPcmRlcixmPWQudGFpbDtSKGEsYixkLmNoaWxkcmVuLGMpO2Q9TS5jdXJyZW50O2lmKDAhPT0oZCYyKSlkPWQmMXwyLGIuZWZmZWN0VGFnfD02NDtlbHNle2lmKG51bGwhPT1hJiYwIT09KGEuZWZmZWN0VGFnJjY0KSlhOmZvcihhPWIuY2hpbGQ7bnVsbCE9PWE7KXtpZigxMz09PWEudGFnKW51bGwhPT1hLm1lbW9pemVkU3RhdGUmJmtpKGEsYyk7ZWxzZSBpZigxOT09PWEudGFnKWtpKGEsYyk7ZWxzZSBpZihudWxsIT09YS5jaGlsZCl7YS5jaGlsZC5yZXR1cm49YTthPWEuY2hpbGQ7Y29udGludWV9aWYoYT09PWIpYnJlYWsgYTtmb3IoO251bGw9PT1hLnNpYmxpbmc7KXtpZihudWxsPT09YS5yZXR1cm58fGEucmV0dXJuPT09YilicmVhayBhO2E9YS5yZXR1cm59YS5zaWJsaW5nLnJldHVybj1hLnJldHVybjthPWEuc2libGluZ31kJj0xfUkoTSxkKTtpZigwPT09KGIubW9kZSYyKSliLm1lbW9pemVkU3RhdGU9XG5udWxsO2Vsc2Ugc3dpdGNoKGUpe2Nhc2UgImZvcndhcmRzIjpjPWIuY2hpbGQ7Zm9yKGU9bnVsbDtudWxsIT09YzspYT1jLmFsdGVybmF0ZSxudWxsIT09YSYmbnVsbD09PWhoKGEpJiYoZT1jKSxjPWMuc2libGluZztjPWU7bnVsbD09PWM/KGU9Yi5jaGlsZCxiLmNoaWxkPW51bGwpOihlPWMuc2libGluZyxjLnNpYmxpbmc9bnVsbCk7bGkoYiwhMSxlLGMsZixiLmxhc3RFZmZlY3QpO2JyZWFrO2Nhc2UgImJhY2t3YXJkcyI6Yz1udWxsO2U9Yi5jaGlsZDtmb3IoYi5jaGlsZD1udWxsO251bGwhPT1lOyl7YT1lLmFsdGVybmF0ZTtpZihudWxsIT09YSYmbnVsbD09PWhoKGEpKXtiLmNoaWxkPWU7YnJlYWt9YT1lLnNpYmxpbmc7ZS5zaWJsaW5nPWM7Yz1lO2U9YX1saShiLCEwLGMsbnVsbCxmLGIubGFzdEVmZmVjdCk7YnJlYWs7Y2FzZSAidG9nZXRoZXIiOmxpKGIsITEsbnVsbCxudWxsLHZvaWQgMCxiLmxhc3RFZmZlY3QpO2JyZWFrO2RlZmF1bHQ6Yi5tZW1vaXplZFN0YXRlPW51bGx9cmV0dXJuIGIuY2hpbGR9XG5mdW5jdGlvbiAkaChhLGIsYyl7bnVsbCE9PWEmJihiLmRlcGVuZGVuY2llcz1hLmRlcGVuZGVuY2llcyk7dmFyIGQ9Yi5leHBpcmF0aW9uVGltZTswIT09ZCYmQmcoZCk7aWYoYi5jaGlsZEV4cGlyYXRpb25UaW1lPGMpcmV0dXJuIG51bGw7aWYobnVsbCE9PWEmJmIuY2hpbGQhPT1hLmNoaWxkKXRocm93IEVycm9yKHUoMTUzKSk7aWYobnVsbCE9PWIuY2hpbGQpe2E9Yi5jaGlsZDtjPVNnKGEsYS5wZW5kaW5nUHJvcHMpO2IuY2hpbGQ9Yztmb3IoYy5yZXR1cm49YjtudWxsIT09YS5zaWJsaW5nOylhPWEuc2libGluZyxjPWMuc2libGluZz1TZyhhLGEucGVuZGluZ1Byb3BzKSxjLnJldHVybj1iO2Muc2libGluZz1udWxsfXJldHVybiBiLmNoaWxkfXZhciBuaSxvaSxwaSxxaTtcbm5pPWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPWIuY2hpbGQ7bnVsbCE9PWM7KXtpZig1PT09Yy50YWd8fDY9PT1jLnRhZylhLmFwcGVuZENoaWxkKGMuc3RhdGVOb2RlKTtlbHNlIGlmKDQhPT1jLnRhZyYmbnVsbCE9PWMuY2hpbGQpe2MuY2hpbGQucmV0dXJuPWM7Yz1jLmNoaWxkO2NvbnRpbnVlfWlmKGM9PT1iKWJyZWFrO2Zvcig7bnVsbD09PWMuc2libGluZzspe2lmKG51bGw9PT1jLnJldHVybnx8Yy5yZXR1cm49PT1iKXJldHVybjtjPWMucmV0dXJufWMuc2libGluZy5yZXR1cm49Yy5yZXR1cm47Yz1jLnNpYmxpbmd9fTtvaT1mdW5jdGlvbigpe307XG5waT1mdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPWEubWVtb2l6ZWRQcm9wcztpZihmIT09ZCl7dmFyIGc9Yi5zdGF0ZU5vZGU7Y2goJGcuY3VycmVudCk7YT1udWxsO3N3aXRjaChjKXtjYXNlICJpbnB1dCI6Zj16YihnLGYpO2Q9emIoZyxkKTthPVtdO2JyZWFrO2Nhc2UgIm9wdGlvbiI6Zj1HYihnLGYpO2Q9R2IoZyxkKTthPVtdO2JyZWFrO2Nhc2UgInNlbGVjdCI6Zj1uKHt9LGYse3ZhbHVlOnZvaWQgMH0pO2Q9bih7fSxkLHt2YWx1ZTp2b2lkIDB9KTthPVtdO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpmPUliKGcsZik7ZD1JYihnLGQpO2E9W107YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iIT09dHlwZW9mIGYub25DbGljayYmImZ1bmN0aW9uIj09PXR5cGVvZiBkLm9uQ2xpY2smJihnLm9uY2xpY2s9c2QpfW9kKGMsZCk7dmFyIGgsaztjPW51bGw7Zm9yKGggaW4gZilpZighZC5oYXNPd25Qcm9wZXJ0eShoKSYmZi5oYXNPd25Qcm9wZXJ0eShoKSYmbnVsbCE9ZltoXSlpZigic3R5bGUiPT09XG5oKWZvcihrIGluIGc9ZltoXSxnKWcuaGFzT3duUHJvcGVydHkoaykmJihjfHwoYz17fSksY1trXT0iIik7ZWxzZSJkYW5nZXJvdXNseVNldElubmVySFRNTCIhPT1oJiYiY2hpbGRyZW4iIT09aCYmInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIhPT1oJiYic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiE9PWgmJiJhdXRvRm9jdXMiIT09aCYmKHZhLmhhc093blByb3BlcnR5KGgpP2F8fChhPVtdKTooYT1hfHxbXSkucHVzaChoLG51bGwpKTtmb3IoaCBpbiBkKXt2YXIgbD1kW2hdO2c9bnVsbCE9Zj9mW2hdOnZvaWQgMDtpZihkLmhhc093blByb3BlcnR5KGgpJiZsIT09ZyYmKG51bGwhPWx8fG51bGwhPWcpKWlmKCJzdHlsZSI9PT1oKWlmKGcpe2ZvcihrIGluIGcpIWcuaGFzT3duUHJvcGVydHkoayl8fGwmJmwuaGFzT3duUHJvcGVydHkoayl8fChjfHwoYz17fSksY1trXT0iIik7Zm9yKGsgaW4gbClsLmhhc093blByb3BlcnR5KGspJiZnW2tdIT09bFtrXSYmKGN8fChjPXt9KSxcbmNba109bFtrXSl9ZWxzZSBjfHwoYXx8KGE9W10pLGEucHVzaChoLGMpKSxjPWw7ZWxzZSJkYW5nZXJvdXNseVNldElubmVySFRNTCI9PT1oPyhsPWw/bC5fX2h0bWw6dm9pZCAwLGc9Zz9nLl9faHRtbDp2b2lkIDAsbnVsbCE9bCYmZyE9PWwmJihhPWF8fFtdKS5wdXNoKGgsbCkpOiJjaGlsZHJlbiI9PT1oP2c9PT1sfHwic3RyaW5nIiE9PXR5cGVvZiBsJiYibnVtYmVyIiE9PXR5cGVvZiBsfHwoYT1hfHxbXSkucHVzaChoLCIiK2wpOiJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciIT09aCYmInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIhPT1oJiYodmEuaGFzT3duUHJvcGVydHkoaCk/KG51bGwhPWwmJnJkKGUsaCksYXx8Zz09PWx8fChhPVtdKSk6KGE9YXx8W10pLnB1c2goaCxsKSl9YyYmKGE9YXx8W10pLnB1c2goInN0eWxlIixjKTtlPWE7aWYoYi51cGRhdGVRdWV1ZT1lKWIuZWZmZWN0VGFnfD00fX07XG5xaT1mdW5jdGlvbihhLGIsYyxkKXtjIT09ZCYmKGIuZWZmZWN0VGFnfD00KX07ZnVuY3Rpb24gcmkoYSxiKXtzd2l0Y2goYS50YWlsTW9kZSl7Y2FzZSAiaGlkZGVuIjpiPWEudGFpbDtmb3IodmFyIGM9bnVsbDtudWxsIT09YjspbnVsbCE9PWIuYWx0ZXJuYXRlJiYoYz1iKSxiPWIuc2libGluZztudWxsPT09Yz9hLnRhaWw9bnVsbDpjLnNpYmxpbmc9bnVsbDticmVhaztjYXNlICJjb2xsYXBzZWQiOmM9YS50YWlsO2Zvcih2YXIgZD1udWxsO251bGwhPT1jOyludWxsIT09Yy5hbHRlcm5hdGUmJihkPWMpLGM9Yy5zaWJsaW5nO251bGw9PT1kP2J8fG51bGw9PT1hLnRhaWw/YS50YWlsPW51bGw6YS50YWlsLnNpYmxpbmc9bnVsbDpkLnNpYmxpbmc9bnVsbH19XG5mdW5jdGlvbiBzaShhLGIsYyl7dmFyIGQ9Yi5wZW5kaW5nUHJvcHM7c3dpdGNoKGIudGFnKXtjYXNlIDI6Y2FzZSAxNjpjYXNlIDE1OmNhc2UgMDpjYXNlIDExOmNhc2UgNzpjYXNlIDg6Y2FzZSAxMjpjYXNlIDk6Y2FzZSAxNDpyZXR1cm4gbnVsbDtjYXNlIDE6cmV0dXJuIEwoYi50eXBlKSYmRGYoKSxudWxsO2Nhc2UgMzpyZXR1cm4gZWgoKSxIKEspLEgoSiksYz1iLnN0YXRlTm9kZSxjLnBlbmRpbmdDb250ZXh0JiYoYy5jb250ZXh0PWMucGVuZGluZ0NvbnRleHQsYy5wZW5kaW5nQ29udGV4dD1udWxsKSxudWxsIT09YSYmbnVsbCE9PWEuY2hpbGR8fCFXaChiKXx8KGIuZWZmZWN0VGFnfD00KSxvaShiKSxudWxsO2Nhc2UgNTpnaChiKTtjPWNoKGJoLmN1cnJlbnQpO3ZhciBlPWIudHlwZTtpZihudWxsIT09YSYmbnVsbCE9Yi5zdGF0ZU5vZGUpcGkoYSxiLGUsZCxjKSxhLnJlZiE9PWIucmVmJiYoYi5lZmZlY3RUYWd8PTEyOCk7ZWxzZXtpZighZCl7aWYobnVsbD09PWIuc3RhdGVOb2RlKXRocm93IEVycm9yKHUoMTY2KSk7XG5yZXR1cm4gbnVsbH1hPWNoKCRnLmN1cnJlbnQpO2lmKFdoKGIpKXtkPWIuc3RhdGVOb2RlO2U9Yi50eXBlO3ZhciBmPWIubWVtb2l6ZWRQcm9wcztkW01kXT1iO2RbTmRdPWY7c3dpdGNoKGUpe2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RigibG9hZCIsZCk7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IoYT0wO2E8YWMubGVuZ3RoO2ErKylGKGFjW2FdLGQpO2JyZWFrO2Nhc2UgInNvdXJjZSI6RigiZXJyb3IiLGQpO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkYoImVycm9yIixkKTtGKCJsb2FkIixkKTticmVhaztjYXNlICJmb3JtIjpGKCJyZXNldCIsZCk7Rigic3VibWl0IixkKTticmVhaztjYXNlICJkZXRhaWxzIjpGKCJ0b2dnbGUiLGQpO2JyZWFrO2Nhc2UgImlucHV0IjpBYihkLGYpO0YoImludmFsaWQiLGQpO3JkKGMsIm9uQ2hhbmdlIik7YnJlYWs7Y2FzZSAic2VsZWN0IjpkLl93cmFwcGVyU3RhdGU9XG57d2FzTXVsdGlwbGU6ISFmLm11bHRpcGxlfTtGKCJpbnZhbGlkIixkKTtyZChjLCJvbkNoYW5nZSIpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpKYihkLGYpLEYoImludmFsaWQiLGQpLHJkKGMsIm9uQ2hhbmdlIil9b2QoZSxmKTthPW51bGw7Zm9yKHZhciBnIGluIGYpaWYoZi5oYXNPd25Qcm9wZXJ0eShnKSl7dmFyIGg9ZltnXTsiY2hpbGRyZW4iPT09Zz8ic3RyaW5nIj09PXR5cGVvZiBoP2QudGV4dENvbnRlbnQhPT1oJiYoYT1bImNoaWxkcmVuIixoXSk6Im51bWJlciI9PT10eXBlb2YgaCYmZC50ZXh0Q29udGVudCE9PSIiK2gmJihhPVsiY2hpbGRyZW4iLCIiK2hdKTp2YS5oYXNPd25Qcm9wZXJ0eShnKSYmbnVsbCE9aCYmcmQoYyxnKX1zd2l0Y2goZSl7Y2FzZSAiaW5wdXQiOnhiKGQpO0ViKGQsZiwhMCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOnhiKGQpO0xiKGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6Y2FzZSAib3B0aW9uIjpicmVhaztkZWZhdWx0OiJmdW5jdGlvbiI9PT10eXBlb2YgZi5vbkNsaWNrJiZcbihkLm9uY2xpY2s9c2QpfWM9YTtiLnVwZGF0ZVF1ZXVlPWM7bnVsbCE9PWMmJihiLmVmZmVjdFRhZ3w9NCl9ZWxzZXtnPTk9PT1jLm5vZGVUeXBlP2M6Yy5vd25lckRvY3VtZW50O2E9PT1xZCYmKGE9TmIoZSkpO2E9PT1xZD8ic2NyaXB0Ij09PWU/KGE9Zy5jcmVhdGVFbGVtZW50KCJkaXYiKSxhLmlubmVySFRNTD0iPHNjcmlwdD5cXHgzYy9zY3JpcHQ+IixhPWEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKSk6InN0cmluZyI9PT10eXBlb2YgZC5pcz9hPWcuY3JlYXRlRWxlbWVudChlLHtpczpkLmlzfSk6KGE9Zy5jcmVhdGVFbGVtZW50KGUpLCJzZWxlY3QiPT09ZSYmKGc9YSxkLm11bHRpcGxlP2cubXVsdGlwbGU9ITA6ZC5zaXplJiYoZy5zaXplPWQuc2l6ZSkpKTphPWcuY3JlYXRlRWxlbWVudE5TKGEsZSk7YVtNZF09YjthW05kXT1kO25pKGEsYiwhMSwhMSk7Yi5zdGF0ZU5vZGU9YTtnPXBkKGUsZCk7c3dpdGNoKGUpe2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RigibG9hZCIsXG5hKTtoPWQ7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IoaD0wO2g8YWMubGVuZ3RoO2grKylGKGFjW2hdLGEpO2g9ZDticmVhaztjYXNlICJzb3VyY2UiOkYoImVycm9yIixhKTtoPWQ7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RigiZXJyb3IiLGEpO0YoImxvYWQiLGEpO2g9ZDticmVhaztjYXNlICJmb3JtIjpGKCJyZXNldCIsYSk7Rigic3VibWl0IixhKTtoPWQ7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RigidG9nZ2xlIixhKTtoPWQ7YnJlYWs7Y2FzZSAiaW5wdXQiOkFiKGEsZCk7aD16YihhLGQpO0YoImludmFsaWQiLGEpO3JkKGMsIm9uQ2hhbmdlIik7YnJlYWs7Y2FzZSAib3B0aW9uIjpoPUdiKGEsZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjphLl93cmFwcGVyU3RhdGU9e3dhc011bHRpcGxlOiEhZC5tdWx0aXBsZX07aD1uKHt9LGQse3ZhbHVlOnZvaWQgMH0pO0YoImludmFsaWQiLGEpO3JkKGMsIm9uQ2hhbmdlIik7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOkpiKGEsXG5kKTtoPUliKGEsZCk7RigiaW52YWxpZCIsYSk7cmQoYywib25DaGFuZ2UiKTticmVhaztkZWZhdWx0Omg9ZH1vZChlLGgpO3ZhciBrPWg7Zm9yKGYgaW4gaylpZihrLmhhc093blByb3BlcnR5KGYpKXt2YXIgbD1rW2ZdOyJzdHlsZSI9PT1mP21kKGEsbCk6ImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIj09PWY/KGw9bD9sLl9faHRtbDp2b2lkIDAsbnVsbCE9bCYmUWIoYSxsKSk6ImNoaWxkcmVuIj09PWY/InN0cmluZyI9PT10eXBlb2YgbD8oInRleHRhcmVhIiE9PWV8fCIiIT09bCkmJlJiKGEsbCk6Im51bWJlciI9PT10eXBlb2YgbCYmUmIoYSwiIitsKToic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiE9PWYmJiJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciIT09ZiYmImF1dG9Gb2N1cyIhPT1mJiYodmEuaGFzT3duUHJvcGVydHkoZik/bnVsbCE9bCYmcmQoYyxmKTpudWxsIT1sJiZYYShhLGYsbCxnKSl9c3dpdGNoKGUpe2Nhc2UgImlucHV0Ijp4YihhKTtFYihhLGQsITEpO1xuYnJlYWs7Y2FzZSAidGV4dGFyZWEiOnhiKGEpO0xiKGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6bnVsbCE9ZC52YWx1ZSYmYS5zZXRBdHRyaWJ1dGUoInZhbHVlIiwiIityYihkLnZhbHVlKSk7YnJlYWs7Y2FzZSAic2VsZWN0IjphLm11bHRpcGxlPSEhZC5tdWx0aXBsZTtjPWQudmFsdWU7bnVsbCE9Yz9IYihhLCEhZC5tdWx0aXBsZSxjLCExKTpudWxsIT1kLmRlZmF1bHRWYWx1ZSYmSGIoYSwhIWQubXVsdGlwbGUsZC5kZWZhdWx0VmFsdWUsITApO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIj09PXR5cGVvZiBoLm9uQ2xpY2smJihhLm9uY2xpY2s9c2QpfUZkKGUsZCkmJihiLmVmZmVjdFRhZ3w9NCl9bnVsbCE9PWIucmVmJiYoYi5lZmZlY3RUYWd8PTEyOCl9cmV0dXJuIG51bGw7Y2FzZSA2OmlmKGEmJm51bGwhPWIuc3RhdGVOb2RlKXFpKGEsYixhLm1lbW9pemVkUHJvcHMsZCk7ZWxzZXtpZigic3RyaW5nIiE9PXR5cGVvZiBkJiZudWxsPT09Yi5zdGF0ZU5vZGUpdGhyb3cgRXJyb3IodSgxNjYpKTtcbmM9Y2goYmguY3VycmVudCk7Y2goJGcuY3VycmVudCk7V2goYik/KGM9Yi5zdGF0ZU5vZGUsZD1iLm1lbW9pemVkUHJvcHMsY1tNZF09YixjLm5vZGVWYWx1ZSE9PWQmJihiLmVmZmVjdFRhZ3w9NCkpOihjPSg5PT09Yy5ub2RlVHlwZT9jOmMub3duZXJEb2N1bWVudCkuY3JlYXRlVGV4dE5vZGUoZCksY1tNZF09YixiLnN0YXRlTm9kZT1jKX1yZXR1cm4gbnVsbDtjYXNlIDEzOkgoTSk7ZD1iLm1lbW9pemVkU3RhdGU7aWYoMCE9PShiLmVmZmVjdFRhZyY2NCkpcmV0dXJuIGIuZXhwaXJhdGlvblRpbWU9YyxiO2M9bnVsbCE9PWQ7ZD0hMTtudWxsPT09YT92b2lkIDAhPT1iLm1lbW9pemVkUHJvcHMuZmFsbGJhY2smJldoKGIpOihlPWEubWVtb2l6ZWRTdGF0ZSxkPW51bGwhPT1lLGN8fG51bGw9PT1lfHwoZT1hLmNoaWxkLnNpYmxpbmcsbnVsbCE9PWUmJihmPWIuZmlyc3RFZmZlY3QsbnVsbCE9PWY/KGIuZmlyc3RFZmZlY3Q9ZSxlLm5leHRFZmZlY3Q9Zik6KGIuZmlyc3RFZmZlY3Q9Yi5sYXN0RWZmZWN0PVxuZSxlLm5leHRFZmZlY3Q9bnVsbCksZS5lZmZlY3RUYWc9OCkpKTtpZihjJiYhZCYmMCE9PShiLm1vZGUmMikpaWYobnVsbD09PWEmJiEwIT09Yi5tZW1vaXplZFByb3BzLnVuc3RhYmxlX2F2b2lkVGhpc0ZhbGxiYWNrfHwwIT09KE0uY3VycmVudCYxKSlTPT09dGkmJihTPXVpKTtlbHNle2lmKFM9PT10aXx8Uz09PXVpKVM9dmk7MCE9PXdpJiZudWxsIT09VCYmKHhpKFQsVSkseWkoVCx3aSkpfWlmKGN8fGQpYi5lZmZlY3RUYWd8PTQ7cmV0dXJuIG51bGw7Y2FzZSA0OnJldHVybiBlaCgpLG9pKGIpLG51bGw7Y2FzZSAxMDpyZXR1cm4gb2coYiksbnVsbDtjYXNlIDE3OnJldHVybiBMKGIudHlwZSkmJkRmKCksbnVsbDtjYXNlIDE5OkgoTSk7ZD1iLm1lbW9pemVkU3RhdGU7aWYobnVsbD09PWQpcmV0dXJuIG51bGw7ZT0wIT09KGIuZWZmZWN0VGFnJjY0KTtmPWQucmVuZGVyaW5nO2lmKG51bGw9PT1mKWlmKGUpcmkoZCwhMSk7ZWxzZXtpZihTIT09dGl8fG51bGwhPT1hJiYwIT09KGEuZWZmZWN0VGFnJlxuNjQpKWZvcihmPWIuY2hpbGQ7bnVsbCE9PWY7KXthPWhoKGYpO2lmKG51bGwhPT1hKXtiLmVmZmVjdFRhZ3w9NjQ7cmkoZCwhMSk7ZT1hLnVwZGF0ZVF1ZXVlO251bGwhPT1lJiYoYi51cGRhdGVRdWV1ZT1lLGIuZWZmZWN0VGFnfD00KTtudWxsPT09ZC5sYXN0RWZmZWN0JiYoYi5maXJzdEVmZmVjdD1udWxsKTtiLmxhc3RFZmZlY3Q9ZC5sYXN0RWZmZWN0O2ZvcihkPWIuY2hpbGQ7bnVsbCE9PWQ7KWU9ZCxmPWMsZS5lZmZlY3RUYWcmPTIsZS5uZXh0RWZmZWN0PW51bGwsZS5maXJzdEVmZmVjdD1udWxsLGUubGFzdEVmZmVjdD1udWxsLGE9ZS5hbHRlcm5hdGUsbnVsbD09PWE/KGUuY2hpbGRFeHBpcmF0aW9uVGltZT0wLGUuZXhwaXJhdGlvblRpbWU9ZixlLmNoaWxkPW51bGwsZS5tZW1vaXplZFByb3BzPW51bGwsZS5tZW1vaXplZFN0YXRlPW51bGwsZS51cGRhdGVRdWV1ZT1udWxsLGUuZGVwZW5kZW5jaWVzPW51bGwpOihlLmNoaWxkRXhwaXJhdGlvblRpbWU9YS5jaGlsZEV4cGlyYXRpb25UaW1lLFxuZS5leHBpcmF0aW9uVGltZT1hLmV4cGlyYXRpb25UaW1lLGUuY2hpbGQ9YS5jaGlsZCxlLm1lbW9pemVkUHJvcHM9YS5tZW1vaXplZFByb3BzLGUubWVtb2l6ZWRTdGF0ZT1hLm1lbW9pemVkU3RhdGUsZS51cGRhdGVRdWV1ZT1hLnVwZGF0ZVF1ZXVlLGY9YS5kZXBlbmRlbmNpZXMsZS5kZXBlbmRlbmNpZXM9bnVsbD09PWY/bnVsbDp7ZXhwaXJhdGlvblRpbWU6Zi5leHBpcmF0aW9uVGltZSxmaXJzdENvbnRleHQ6Zi5maXJzdENvbnRleHQscmVzcG9uZGVyczpmLnJlc3BvbmRlcnN9KSxkPWQuc2libGluZztJKE0sTS5jdXJyZW50JjF8Mik7cmV0dXJuIGIuY2hpbGR9Zj1mLnNpYmxpbmd9fWVsc2V7aWYoIWUpaWYoYT1oaChmKSxudWxsIT09YSl7aWYoYi5lZmZlY3RUYWd8PTY0LGU9ITAsYz1hLnVwZGF0ZVF1ZXVlLG51bGwhPT1jJiYoYi51cGRhdGVRdWV1ZT1jLGIuZWZmZWN0VGFnfD00KSxyaShkLCEwKSxudWxsPT09ZC50YWlsJiYiaGlkZGVuIj09PWQudGFpbE1vZGUmJiFmLmFsdGVybmF0ZSlyZXR1cm4gYj1cbmIubGFzdEVmZmVjdD1kLmxhc3RFZmZlY3QsbnVsbCE9PWImJihiLm5leHRFZmZlY3Q9bnVsbCksbnVsbH1lbHNlIDIqJGYoKS1kLnJlbmRlcmluZ1N0YXJ0VGltZT5kLnRhaWxFeHBpcmF0aW9uJiYxPGMmJihiLmVmZmVjdFRhZ3w9NjQsZT0hMCxyaShkLCExKSxiLmV4cGlyYXRpb25UaW1lPWIuY2hpbGRFeHBpcmF0aW9uVGltZT1jLTEpO2QuaXNCYWNrd2FyZHM/KGYuc2libGluZz1iLmNoaWxkLGIuY2hpbGQ9Zik6KGM9ZC5sYXN0LG51bGwhPT1jP2Muc2libGluZz1mOmIuY2hpbGQ9ZixkLmxhc3Q9Zil9cmV0dXJuIG51bGwhPT1kLnRhaWw/KDA9PT1kLnRhaWxFeHBpcmF0aW9uJiYoZC50YWlsRXhwaXJhdGlvbj0kZigpKzUwMCksYz1kLnRhaWwsZC5yZW5kZXJpbmc9YyxkLnRhaWw9Yy5zaWJsaW5nLGQubGFzdEVmZmVjdD1iLmxhc3RFZmZlY3QsZC5yZW5kZXJpbmdTdGFydFRpbWU9JGYoKSxjLnNpYmxpbmc9bnVsbCxiPU0uY3VycmVudCxJKE0sZT9iJjF8MjpiJjEpLGMpOm51bGx9dGhyb3cgRXJyb3IodSgxNTYsXG5iLnRhZykpO31mdW5jdGlvbiB6aShhKXtzd2l0Y2goYS50YWcpe2Nhc2UgMTpMKGEudHlwZSkmJkRmKCk7dmFyIGI9YS5lZmZlY3RUYWc7cmV0dXJuIGImNDA5Nj8oYS5lZmZlY3RUYWc9YiYtNDA5N3w2NCxhKTpudWxsO2Nhc2UgMzplaCgpO0goSyk7SChKKTtiPWEuZWZmZWN0VGFnO2lmKDAhPT0oYiY2NCkpdGhyb3cgRXJyb3IodSgyODUpKTthLmVmZmVjdFRhZz1iJi00MDk3fDY0O3JldHVybiBhO2Nhc2UgNTpyZXR1cm4gZ2goYSksbnVsbDtjYXNlIDEzOnJldHVybiBIKE0pLGI9YS5lZmZlY3RUYWcsYiY0MDk2PyhhLmVmZmVjdFRhZz1iJi00MDk3fDY0LGEpOm51bGw7Y2FzZSAxOTpyZXR1cm4gSChNKSxudWxsO2Nhc2UgNDpyZXR1cm4gZWgoKSxudWxsO2Nhc2UgMTA6cmV0dXJuIG9nKGEpLG51bGw7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gQWkoYSxiKXtyZXR1cm57dmFsdWU6YSxzb3VyY2U6YixzdGFjazpxYihiKX19XG52YXIgQmk9ImZ1bmN0aW9uIj09PXR5cGVvZiBXZWFrU2V0P1dlYWtTZXQ6U2V0O2Z1bmN0aW9uIENpKGEsYil7dmFyIGM9Yi5zb3VyY2UsZD1iLnN0YWNrO251bGw9PT1kJiZudWxsIT09YyYmKGQ9cWIoYykpO251bGwhPT1jJiZwYihjLnR5cGUpO2I9Yi52YWx1ZTtudWxsIT09YSYmMT09PWEudGFnJiZwYihhLnR5cGUpO3RyeXtjb25zb2xlLmVycm9yKGIpfWNhdGNoKGUpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXt0aHJvdyBlO30pfX1mdW5jdGlvbiBEaShhLGIpe3RyeXtiLnByb3BzPWEubWVtb2l6ZWRQcm9wcyxiLnN0YXRlPWEubWVtb2l6ZWRTdGF0ZSxiLmNvbXBvbmVudFdpbGxVbm1vdW50KCl9Y2F0Y2goYyl7RWkoYSxjKX19ZnVuY3Rpb24gRmkoYSl7dmFyIGI9YS5yZWY7aWYobnVsbCE9PWIpaWYoImZ1bmN0aW9uIj09PXR5cGVvZiBiKXRyeXtiKG51bGwpfWNhdGNoKGMpe0VpKGEsYyl9ZWxzZSBiLmN1cnJlbnQ9bnVsbH1cbmZ1bmN0aW9uIEdpKGEsYil7c3dpdGNoKGIudGFnKXtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OmNhc2UgMjI6cmV0dXJuO2Nhc2UgMTppZihiLmVmZmVjdFRhZyYyNTYmJm51bGwhPT1hKXt2YXIgYz1hLm1lbW9pemVkUHJvcHMsZD1hLm1lbW9pemVkU3RhdGU7YT1iLnN0YXRlTm9kZTtiPWEuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoYi5lbGVtZW50VHlwZT09PWIudHlwZT9jOmlnKGIudHlwZSxjKSxkKTthLl9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlPWJ9cmV0dXJuO2Nhc2UgMzpjYXNlIDU6Y2FzZSA2OmNhc2UgNDpjYXNlIDE3OnJldHVybn10aHJvdyBFcnJvcih1KDE2MykpO31cbmZ1bmN0aW9uIEhpKGEsYil7Yj1iLnVwZGF0ZVF1ZXVlO2I9bnVsbCE9PWI/Yi5sYXN0RWZmZWN0Om51bGw7aWYobnVsbCE9PWIpe3ZhciBjPWI9Yi5uZXh0O2Rve2lmKChjLnRhZyZhKT09PWEpe3ZhciBkPWMuZGVzdHJveTtjLmRlc3Ryb3k9dm9pZCAwO3ZvaWQgMCE9PWQmJmQoKX1jPWMubmV4dH13aGlsZShjIT09Yil9fWZ1bmN0aW9uIElpKGEsYil7Yj1iLnVwZGF0ZVF1ZXVlO2I9bnVsbCE9PWI/Yi5sYXN0RWZmZWN0Om51bGw7aWYobnVsbCE9PWIpe3ZhciBjPWI9Yi5uZXh0O2Rve2lmKChjLnRhZyZhKT09PWEpe3ZhciBkPWMuY3JlYXRlO2MuZGVzdHJveT1kKCl9Yz1jLm5leHR9d2hpbGUoYyE9PWIpfX1cbmZ1bmN0aW9uIEppKGEsYixjKXtzd2l0Y2goYy50YWcpe2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6Y2FzZSAyMjpJaSgzLGMpO3JldHVybjtjYXNlIDE6YT1jLnN0YXRlTm9kZTtpZihjLmVmZmVjdFRhZyY0KWlmKG51bGw9PT1iKWEuY29tcG9uZW50RGlkTW91bnQoKTtlbHNle3ZhciBkPWMuZWxlbWVudFR5cGU9PT1jLnR5cGU/Yi5tZW1vaXplZFByb3BzOmlnKGMudHlwZSxiLm1lbW9pemVkUHJvcHMpO2EuY29tcG9uZW50RGlkVXBkYXRlKGQsYi5tZW1vaXplZFN0YXRlLGEuX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUpfWI9Yy51cGRhdGVRdWV1ZTtudWxsIT09YiYmQ2coYyxiLGEpO3JldHVybjtjYXNlIDM6Yj1jLnVwZGF0ZVF1ZXVlO2lmKG51bGwhPT1iKXthPW51bGw7aWYobnVsbCE9PWMuY2hpbGQpc3dpdGNoKGMuY2hpbGQudGFnKXtjYXNlIDU6YT1jLmNoaWxkLnN0YXRlTm9kZTticmVhaztjYXNlIDE6YT1jLmNoaWxkLnN0YXRlTm9kZX1DZyhjLGIsYSl9cmV0dXJuO1xuY2FzZSA1OmE9Yy5zdGF0ZU5vZGU7bnVsbD09PWImJmMuZWZmZWN0VGFnJjQmJkZkKGMudHlwZSxjLm1lbW9pemVkUHJvcHMpJiZhLmZvY3VzKCk7cmV0dXJuO2Nhc2UgNjpyZXR1cm47Y2FzZSA0OnJldHVybjtjYXNlIDEyOnJldHVybjtjYXNlIDEzOm51bGw9PT1jLm1lbW9pemVkU3RhdGUmJihjPWMuYWx0ZXJuYXRlLG51bGwhPT1jJiYoYz1jLm1lbW9pemVkU3RhdGUsbnVsbCE9PWMmJihjPWMuZGVoeWRyYXRlZCxudWxsIT09YyYmVmMoYykpKSk7cmV0dXJuO2Nhc2UgMTk6Y2FzZSAxNzpjYXNlIDIwOmNhc2UgMjE6cmV0dXJufXRocm93IEVycm9yKHUoMTYzKSk7fVxuZnVuY3Rpb24gS2koYSxiLGMpeyJmdW5jdGlvbiI9PT10eXBlb2YgTGkmJkxpKGIpO3N3aXRjaChiLnRhZyl7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OmNhc2UgMjI6YT1iLnVwZGF0ZVF1ZXVlO2lmKG51bGwhPT1hJiYoYT1hLmxhc3RFZmZlY3QsbnVsbCE9PWEpKXt2YXIgZD1hLm5leHQ7Y2coOTc8Yz85NzpjLGZ1bmN0aW9uKCl7dmFyIGE9ZDtkb3t2YXIgYz1hLmRlc3Ryb3k7aWYodm9pZCAwIT09Yyl7dmFyIGc9Yjt0cnl7YygpfWNhdGNoKGgpe0VpKGcsaCl9fWE9YS5uZXh0fXdoaWxlKGEhPT1kKX0pfWJyZWFrO2Nhc2UgMTpGaShiKTtjPWIuc3RhdGVOb2RlOyJmdW5jdGlvbiI9PT10eXBlb2YgYy5jb21wb25lbnRXaWxsVW5tb3VudCYmRGkoYixjKTticmVhaztjYXNlIDU6RmkoYik7YnJlYWs7Y2FzZSA0Ok1pKGEsYixjKX19XG5mdW5jdGlvbiBOaShhKXt2YXIgYj1hLmFsdGVybmF0ZTthLnJldHVybj1udWxsO2EuY2hpbGQ9bnVsbDthLm1lbW9pemVkU3RhdGU9bnVsbDthLnVwZGF0ZVF1ZXVlPW51bGw7YS5kZXBlbmRlbmNpZXM9bnVsbDthLmFsdGVybmF0ZT1udWxsO2EuZmlyc3RFZmZlY3Q9bnVsbDthLmxhc3RFZmZlY3Q9bnVsbDthLnBlbmRpbmdQcm9wcz1udWxsO2EubWVtb2l6ZWRQcm9wcz1udWxsO2Euc3RhdGVOb2RlPW51bGw7bnVsbCE9PWImJk5pKGIpfWZ1bmN0aW9uIE9pKGEpe3JldHVybiA1PT09YS50YWd8fDM9PT1hLnRhZ3x8ND09PWEudGFnfVxuZnVuY3Rpb24gUGkoYSl7YTp7Zm9yKHZhciBiPWEucmV0dXJuO251bGwhPT1iOyl7aWYoT2koYikpe3ZhciBjPWI7YnJlYWsgYX1iPWIucmV0dXJufXRocm93IEVycm9yKHUoMTYwKSk7fWI9Yy5zdGF0ZU5vZGU7c3dpdGNoKGMudGFnKXtjYXNlIDU6dmFyIGQ9ITE7YnJlYWs7Y2FzZSAzOmI9Yi5jb250YWluZXJJbmZvO2Q9ITA7YnJlYWs7Y2FzZSA0OmI9Yi5jb250YWluZXJJbmZvO2Q9ITA7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcih1KDE2MSkpO31jLmVmZmVjdFRhZyYxNiYmKFJiKGIsIiIpLGMuZWZmZWN0VGFnJj0tMTcpO2E6Yjpmb3IoYz1hOzspe2Zvcig7bnVsbD09PWMuc2libGluZzspe2lmKG51bGw9PT1jLnJldHVybnx8T2koYy5yZXR1cm4pKXtjPW51bGw7YnJlYWsgYX1jPWMucmV0dXJufWMuc2libGluZy5yZXR1cm49Yy5yZXR1cm47Zm9yKGM9Yy5zaWJsaW5nOzUhPT1jLnRhZyYmNiE9PWMudGFnJiYxOCE9PWMudGFnOyl7aWYoYy5lZmZlY3RUYWcmMiljb250aW51ZSBiO1xuaWYobnVsbD09PWMuY2hpbGR8fDQ9PT1jLnRhZyljb250aW51ZSBiO2Vsc2UgYy5jaGlsZC5yZXR1cm49YyxjPWMuY2hpbGR9aWYoIShjLmVmZmVjdFRhZyYyKSl7Yz1jLnN0YXRlTm9kZTticmVhayBhfX1kP1FpKGEsYyxiKTpSaShhLGMsYil9XG5mdW5jdGlvbiBRaShhLGIsYyl7dmFyIGQ9YS50YWcsZT01PT09ZHx8Nj09PWQ7aWYoZSlhPWU/YS5zdGF0ZU5vZGU6YS5zdGF0ZU5vZGUuaW5zdGFuY2UsYj84PT09Yy5ub2RlVHlwZT9jLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsYik6Yy5pbnNlcnRCZWZvcmUoYSxiKTooOD09PWMubm9kZVR5cGU/KGI9Yy5wYXJlbnROb2RlLGIuaW5zZXJ0QmVmb3JlKGEsYykpOihiPWMsYi5hcHBlbmRDaGlsZChhKSksYz1jLl9yZWFjdFJvb3RDb250YWluZXIsbnVsbCE9PWMmJnZvaWQgMCE9PWN8fG51bGwhPT1iLm9uY2xpY2t8fChiLm9uY2xpY2s9c2QpKTtlbHNlIGlmKDQhPT1kJiYoYT1hLmNoaWxkLG51bGwhPT1hKSlmb3IoUWkoYSxiLGMpLGE9YS5zaWJsaW5nO251bGwhPT1hOylRaShhLGIsYyksYT1hLnNpYmxpbmd9XG5mdW5jdGlvbiBSaShhLGIsYyl7dmFyIGQ9YS50YWcsZT01PT09ZHx8Nj09PWQ7aWYoZSlhPWU/YS5zdGF0ZU5vZGU6YS5zdGF0ZU5vZGUuaW5zdGFuY2UsYj9jLmluc2VydEJlZm9yZShhLGIpOmMuYXBwZW5kQ2hpbGQoYSk7ZWxzZSBpZig0IT09ZCYmKGE9YS5jaGlsZCxudWxsIT09YSkpZm9yKFJpKGEsYixjKSxhPWEuc2libGluZztudWxsIT09YTspUmkoYSxiLGMpLGE9YS5zaWJsaW5nfVxuZnVuY3Rpb24gTWkoYSxiLGMpe2Zvcih2YXIgZD1iLGU9ITEsZixnOzspe2lmKCFlKXtlPWQucmV0dXJuO2E6Zm9yKDs7KXtpZihudWxsPT09ZSl0aHJvdyBFcnJvcih1KDE2MCkpO2Y9ZS5zdGF0ZU5vZGU7c3dpdGNoKGUudGFnKXtjYXNlIDU6Zz0hMTticmVhayBhO2Nhc2UgMzpmPWYuY29udGFpbmVySW5mbztnPSEwO2JyZWFrIGE7Y2FzZSA0OmY9Zi5jb250YWluZXJJbmZvO2c9ITA7YnJlYWsgYX1lPWUucmV0dXJufWU9ITB9aWYoNT09PWQudGFnfHw2PT09ZC50YWcpe2E6Zm9yKHZhciBoPWEsaz1kLGw9YyxtPWs7OylpZihLaShoLG0sbCksbnVsbCE9PW0uY2hpbGQmJjQhPT1tLnRhZyltLmNoaWxkLnJldHVybj1tLG09bS5jaGlsZDtlbHNle2lmKG09PT1rKWJyZWFrIGE7Zm9yKDtudWxsPT09bS5zaWJsaW5nOyl7aWYobnVsbD09PW0ucmV0dXJufHxtLnJldHVybj09PWspYnJlYWsgYTttPW0ucmV0dXJufW0uc2libGluZy5yZXR1cm49bS5yZXR1cm47bT1tLnNpYmxpbmd9Zz8oaD1cbmYsaz1kLnN0YXRlTm9kZSw4PT09aC5ub2RlVHlwZT9oLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoayk6aC5yZW1vdmVDaGlsZChrKSk6Zi5yZW1vdmVDaGlsZChkLnN0YXRlTm9kZSl9ZWxzZSBpZig0PT09ZC50YWcpe2lmKG51bGwhPT1kLmNoaWxkKXtmPWQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87Zz0hMDtkLmNoaWxkLnJldHVybj1kO2Q9ZC5jaGlsZDtjb250aW51ZX19ZWxzZSBpZihLaShhLGQsYyksbnVsbCE9PWQuY2hpbGQpe2QuY2hpbGQucmV0dXJuPWQ7ZD1kLmNoaWxkO2NvbnRpbnVlfWlmKGQ9PT1iKWJyZWFrO2Zvcig7bnVsbD09PWQuc2libGluZzspe2lmKG51bGw9PT1kLnJldHVybnx8ZC5yZXR1cm49PT1iKXJldHVybjtkPWQucmV0dXJuOzQ9PT1kLnRhZyYmKGU9ITEpfWQuc2libGluZy5yZXR1cm49ZC5yZXR1cm47ZD1kLnNpYmxpbmd9fVxuZnVuY3Rpb24gU2koYSxiKXtzd2l0Y2goYi50YWcpe2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpjYXNlIDIyOkhpKDMsYik7cmV0dXJuO2Nhc2UgMTpyZXR1cm47Y2FzZSA1OnZhciBjPWIuc3RhdGVOb2RlO2lmKG51bGwhPWMpe3ZhciBkPWIubWVtb2l6ZWRQcm9wcyxlPW51bGwhPT1hP2EubWVtb2l6ZWRQcm9wczpkO2E9Yi50eXBlO3ZhciBmPWIudXBkYXRlUXVldWU7Yi51cGRhdGVRdWV1ZT1udWxsO2lmKG51bGwhPT1mKXtjW05kXT1kOyJpbnB1dCI9PT1hJiYicmFkaW8iPT09ZC50eXBlJiZudWxsIT1kLm5hbWUmJkJiKGMsZCk7cGQoYSxlKTtiPXBkKGEsZCk7Zm9yKGU9MDtlPGYubGVuZ3RoO2UrPTIpe3ZhciBnPWZbZV0saD1mW2UrMV07InN0eWxlIj09PWc/bWQoYyxoKToiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiPT09Zz9RYihjLGgpOiJjaGlsZHJlbiI9PT1nP1JiKGMsaCk6WGEoYyxnLGgsYil9c3dpdGNoKGEpe2Nhc2UgImlucHV0IjpDYihjLGQpO2JyZWFrO1xuY2FzZSAidGV4dGFyZWEiOktiKGMsZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjpiPWMuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZSxjLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGU9ISFkLm11bHRpcGxlLGE9ZC52YWx1ZSxudWxsIT1hP0hiKGMsISFkLm11bHRpcGxlLGEsITEpOmIhPT0hIWQubXVsdGlwbGUmJihudWxsIT1kLmRlZmF1bHRWYWx1ZT9IYihjLCEhZC5tdWx0aXBsZSxkLmRlZmF1bHRWYWx1ZSwhMCk6SGIoYywhIWQubXVsdGlwbGUsZC5tdWx0aXBsZT9bXToiIiwhMSkpfX19cmV0dXJuO2Nhc2UgNjppZihudWxsPT09Yi5zdGF0ZU5vZGUpdGhyb3cgRXJyb3IodSgxNjIpKTtiLnN0YXRlTm9kZS5ub2RlVmFsdWU9Yi5tZW1vaXplZFByb3BzO3JldHVybjtjYXNlIDM6Yj1iLnN0YXRlTm9kZTtiLmh5ZHJhdGUmJihiLmh5ZHJhdGU9ITEsVmMoYi5jb250YWluZXJJbmZvKSk7cmV0dXJuO2Nhc2UgMTI6cmV0dXJuO2Nhc2UgMTM6Yz1iO251bGw9PT1iLm1lbW9pemVkU3RhdGU/XG5kPSExOihkPSEwLGM9Yi5jaGlsZCxUaT0kZigpKTtpZihudWxsIT09YylhOmZvcihhPWM7Oyl7aWYoNT09PWEudGFnKWY9YS5zdGF0ZU5vZGUsZD8oZj1mLnN0eWxlLCJmdW5jdGlvbiI9PT10eXBlb2YgZi5zZXRQcm9wZXJ0eT9mLnNldFByb3BlcnR5KCJkaXNwbGF5Iiwibm9uZSIsImltcG9ydGFudCIpOmYuZGlzcGxheT0ibm9uZSIpOihmPWEuc3RhdGVOb2RlLGU9YS5tZW1vaXplZFByb3BzLnN0eWxlLGU9dm9pZCAwIT09ZSYmbnVsbCE9PWUmJmUuaGFzT3duUHJvcGVydHkoImRpc3BsYXkiKT9lLmRpc3BsYXk6bnVsbCxmLnN0eWxlLmRpc3BsYXk9bGQoImRpc3BsYXkiLGUpKTtlbHNlIGlmKDY9PT1hLnRhZylhLnN0YXRlTm9kZS5ub2RlVmFsdWU9ZD8iIjphLm1lbW9pemVkUHJvcHM7ZWxzZSBpZigxMz09PWEudGFnJiZudWxsIT09YS5tZW1vaXplZFN0YXRlJiZudWxsPT09YS5tZW1vaXplZFN0YXRlLmRlaHlkcmF0ZWQpe2Y9YS5jaGlsZC5zaWJsaW5nO2YucmV0dXJuPWE7YT1cbmY7Y29udGludWV9ZWxzZSBpZihudWxsIT09YS5jaGlsZCl7YS5jaGlsZC5yZXR1cm49YTthPWEuY2hpbGQ7Y29udGludWV9aWYoYT09PWMpYnJlYWs7Zm9yKDtudWxsPT09YS5zaWJsaW5nOyl7aWYobnVsbD09PWEucmV0dXJufHxhLnJldHVybj09PWMpYnJlYWsgYTthPWEucmV0dXJufWEuc2libGluZy5yZXR1cm49YS5yZXR1cm47YT1hLnNpYmxpbmd9VWkoYik7cmV0dXJuO2Nhc2UgMTk6VWkoYik7cmV0dXJuO2Nhc2UgMTc6cmV0dXJufXRocm93IEVycm9yKHUoMTYzKSk7fWZ1bmN0aW9uIFVpKGEpe3ZhciBiPWEudXBkYXRlUXVldWU7aWYobnVsbCE9PWIpe2EudXBkYXRlUXVldWU9bnVsbDt2YXIgYz1hLnN0YXRlTm9kZTtudWxsPT09YyYmKGM9YS5zdGF0ZU5vZGU9bmV3IEJpKTtiLmZvckVhY2goZnVuY3Rpb24oYil7dmFyIGQ9VmkuYmluZChudWxsLGEsYik7Yy5oYXMoYil8fChjLmFkZChiKSxiLnRoZW4oZCxkKSl9KX19XG52YXIgV2k9ImZ1bmN0aW9uIj09PXR5cGVvZiBXZWFrTWFwP1dlYWtNYXA6TWFwO2Z1bmN0aW9uIFhpKGEsYixjKXtjPXdnKGMsbnVsbCk7Yy50YWc9MztjLnBheWxvYWQ9e2VsZW1lbnQ6bnVsbH07dmFyIGQ9Yi52YWx1ZTtjLmNhbGxiYWNrPWZ1bmN0aW9uKCl7WWl8fChZaT0hMCxaaT1kKTtDaShhLGIpfTtyZXR1cm4gY31cbmZ1bmN0aW9uICRpKGEsYixjKXtjPXdnKGMsbnVsbCk7Yy50YWc9Mzt2YXIgZD1hLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yO2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgZCl7dmFyIGU9Yi52YWx1ZTtjLnBheWxvYWQ9ZnVuY3Rpb24oKXtDaShhLGIpO3JldHVybiBkKGUpfX12YXIgZj1hLnN0YXRlTm9kZTtudWxsIT09ZiYmImZ1bmN0aW9uIj09PXR5cGVvZiBmLmNvbXBvbmVudERpZENhdGNoJiYoYy5jYWxsYmFjaz1mdW5jdGlvbigpeyJmdW5jdGlvbiIhPT10eXBlb2YgZCYmKG51bGw9PT1haj9haj1uZXcgU2V0KFt0aGlzXSk6YWouYWRkKHRoaXMpLENpKGEsYikpO3ZhciBjPWIuc3RhY2s7dGhpcy5jb21wb25lbnREaWRDYXRjaChiLnZhbHVlLHtjb21wb25lbnRTdGFjazpudWxsIT09Yz9jOiIifSl9KTtyZXR1cm4gY31cbnZhciBiaj1NYXRoLmNlaWwsY2o9V2EuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcixkaj1XYS5SZWFjdEN1cnJlbnRPd25lcixWPTAsZWo9OCxmaj0xNixnaj0zMix0aT0wLGhqPTEsaWo9Mix1aT0zLHZpPTQsamo9NSxXPVYsVD1udWxsLFg9bnVsbCxVPTAsUz10aSxraj1udWxsLGxqPTEwNzM3NDE4MjMsbWo9MTA3Mzc0MTgyMyxuaj1udWxsLHdpPTAsb2o9ITEsVGk9MCxwaj01MDAsWT1udWxsLFlpPSExLFppPW51bGwsYWo9bnVsbCxxaj0hMSxyaj1udWxsLHNqPTkwLHRqPW51bGwsdWo9MCx2aj1udWxsLHdqPTA7ZnVuY3Rpb24gR2coKXtyZXR1cm4oVyYoZmp8Z2opKSE9PVY/MTA3Mzc0MTgyMS0oJGYoKS8xMHwwKTowIT09d2o/d2o6d2o9MTA3Mzc0MTgyMS0oJGYoKS8xMHwwKX1cbmZ1bmN0aW9uIEhnKGEsYixjKXtiPWIubW9kZTtpZigwPT09KGImMikpcmV0dXJuIDEwNzM3NDE4MjM7dmFyIGQ9YWcoKTtpZigwPT09KGImNCkpcmV0dXJuIDk5PT09ZD8xMDczNzQxODIzOjEwNzM3NDE4MjI7aWYoKFcmZmopIT09VilyZXR1cm4gVTtpZihudWxsIT09YylhPWhnKGEsYy50aW1lb3V0TXN8MHx8NUUzLDI1MCk7ZWxzZSBzd2l0Y2goZCl7Y2FzZSA5OTphPTEwNzM3NDE4MjM7YnJlYWs7Y2FzZSA5ODphPWhnKGEsMTUwLDEwMCk7YnJlYWs7Y2FzZSA5NzpjYXNlIDk2OmE9aGcoYSw1RTMsMjUwKTticmVhaztjYXNlIDk1OmE9MjticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHUoMzI2KSk7fW51bGwhPT1UJiZhPT09VSYmLS1hO3JldHVybiBhfVxuZnVuY3Rpb24gSWcoYSxiKXtpZig1MDx1ail0aHJvdyB1aj0wLHZqPW51bGwsRXJyb3IodSgxODUpKTthPXhqKGEsYik7aWYobnVsbCE9PWEpe3ZhciBjPWFnKCk7MTA3Mzc0MTgyMz09PWI/KFcmZWopIT09ViYmKFcmKGZqfGdqKSk9PT1WP3lqKGEpOihaKGEpLFc9PT1WJiZnZygpKTpaKGEpOyhXJjQpPT09Vnx8OTghPT1jJiY5OSE9PWN8fChudWxsPT09dGo/dGo9bmV3IE1hcChbW2EsYl1dKTooYz10ai5nZXQoYSksKHZvaWQgMD09PWN8fGM+YikmJnRqLnNldChhLGIpKSl9fVxuZnVuY3Rpb24geGooYSxiKXthLmV4cGlyYXRpb25UaW1lPGImJihhLmV4cGlyYXRpb25UaW1lPWIpO3ZhciBjPWEuYWx0ZXJuYXRlO251bGwhPT1jJiZjLmV4cGlyYXRpb25UaW1lPGImJihjLmV4cGlyYXRpb25UaW1lPWIpO3ZhciBkPWEucmV0dXJuLGU9bnVsbDtpZihudWxsPT09ZCYmMz09PWEudGFnKWU9YS5zdGF0ZU5vZGU7ZWxzZSBmb3IoO251bGwhPT1kOyl7Yz1kLmFsdGVybmF0ZTtkLmNoaWxkRXhwaXJhdGlvblRpbWU8YiYmKGQuY2hpbGRFeHBpcmF0aW9uVGltZT1iKTtudWxsIT09YyYmYy5jaGlsZEV4cGlyYXRpb25UaW1lPGImJihjLmNoaWxkRXhwaXJhdGlvblRpbWU9Yik7aWYobnVsbD09PWQucmV0dXJuJiYzPT09ZC50YWcpe2U9ZC5zdGF0ZU5vZGU7YnJlYWt9ZD1kLnJldHVybn1udWxsIT09ZSYmKFQ9PT1lJiYoQmcoYiksUz09PXZpJiZ4aShlLFUpKSx5aShlLGIpKTtyZXR1cm4gZX1cbmZ1bmN0aW9uIHpqKGEpe3ZhciBiPWEubGFzdEV4cGlyZWRUaW1lO2lmKDAhPT1iKXJldHVybiBiO2I9YS5maXJzdFBlbmRpbmdUaW1lO2lmKCFBaihhLGIpKXJldHVybiBiO3ZhciBjPWEubGFzdFBpbmdlZFRpbWU7YT1hLm5leHRLbm93blBlbmRpbmdMZXZlbDthPWM+YT9jOmE7cmV0dXJuIDI+PWEmJmIhPT1hPzA6YX1cbmZ1bmN0aW9uIFooYSl7aWYoMCE9PWEubGFzdEV4cGlyZWRUaW1lKWEuY2FsbGJhY2tFeHBpcmF0aW9uVGltZT0xMDczNzQxODIzLGEuY2FsbGJhY2tQcmlvcml0eT05OSxhLmNhbGxiYWNrTm9kZT1lZyh5ai5iaW5kKG51bGwsYSkpO2Vsc2V7dmFyIGI9emooYSksYz1hLmNhbGxiYWNrTm9kZTtpZigwPT09YiludWxsIT09YyYmKGEuY2FsbGJhY2tOb2RlPW51bGwsYS5jYWxsYmFja0V4cGlyYXRpb25UaW1lPTAsYS5jYWxsYmFja1ByaW9yaXR5PTkwKTtlbHNle3ZhciBkPUdnKCk7MTA3Mzc0MTgyMz09PWI/ZD05OToxPT09Ynx8Mj09PWI/ZD05NTooZD0xMCooMTA3Mzc0MTgyMS1iKS0xMCooMTA3Mzc0MTgyMS1kKSxkPTA+PWQ/OTk6MjUwPj1kPzk4OjUyNTA+PWQ/OTc6OTUpO2lmKG51bGwhPT1jKXt2YXIgZT1hLmNhbGxiYWNrUHJpb3JpdHk7aWYoYS5jYWxsYmFja0V4cGlyYXRpb25UaW1lPT09YiYmZT49ZClyZXR1cm47YyE9PVRmJiZLZihjKX1hLmNhbGxiYWNrRXhwaXJhdGlvblRpbWU9XG5iO2EuY2FsbGJhY2tQcmlvcml0eT1kO2I9MTA3Mzc0MTgyMz09PWI/ZWcoeWouYmluZChudWxsLGEpKTpkZyhkLEJqLmJpbmQobnVsbCxhKSx7dGltZW91dDoxMCooMTA3Mzc0MTgyMS1iKS0kZigpfSk7YS5jYWxsYmFja05vZGU9Yn19fVxuZnVuY3Rpb24gQmooYSxiKXt3aj0wO2lmKGIpcmV0dXJuIGI9R2coKSxDaihhLGIpLFooYSksbnVsbDt2YXIgYz16aihhKTtpZigwIT09Yyl7Yj1hLmNhbGxiYWNrTm9kZTtpZigoVyYoZmp8Z2opKSE9PVYpdGhyb3cgRXJyb3IodSgzMjcpKTtEaigpO2E9PT1UJiZjPT09VXx8RWooYSxjKTtpZihudWxsIT09WCl7dmFyIGQ9VztXfD1majt2YXIgZT1GaigpO2RvIHRyeXtHaigpO2JyZWFrfWNhdGNoKGgpe0hqKGEsaCl9d2hpbGUoMSk7bmcoKTtXPWQ7Y2ouY3VycmVudD1lO2lmKFM9PT1oail0aHJvdyBiPWtqLEVqKGEsYykseGkoYSxjKSxaKGEpLGI7aWYobnVsbD09PVgpc3dpdGNoKGU9YS5maW5pc2hlZFdvcms9YS5jdXJyZW50LmFsdGVybmF0ZSxhLmZpbmlzaGVkRXhwaXJhdGlvblRpbWU9YyxkPVMsVD1udWxsLGQpe2Nhc2UgdGk6Y2FzZSBoajp0aHJvdyBFcnJvcih1KDM0NSkpO2Nhc2UgaWo6Q2ooYSwyPGM/MjpjKTticmVhaztjYXNlIHVpOnhpKGEsYyk7ZD1hLmxhc3RTdXNwZW5kZWRUaW1lO1xuYz09PWQmJihhLm5leHRLbm93blBlbmRpbmdMZXZlbD1JaihlKSk7aWYoMTA3Mzc0MTgyMz09PWxqJiYoZT1UaStwai0kZigpLDEwPGUpKXtpZihvail7dmFyIGY9YS5sYXN0UGluZ2VkVGltZTtpZigwPT09Znx8Zj49Yyl7YS5sYXN0UGluZ2VkVGltZT1jO0VqKGEsYyk7YnJlYWt9fWY9emooYSk7aWYoMCE9PWYmJmYhPT1jKWJyZWFrO2lmKDAhPT1kJiZkIT09Yyl7YS5sYXN0UGluZ2VkVGltZT1kO2JyZWFrfWEudGltZW91dEhhbmRsZT1IZChKai5iaW5kKG51bGwsYSksZSk7YnJlYWt9SmooYSk7YnJlYWs7Y2FzZSB2aTp4aShhLGMpO2Q9YS5sYXN0U3VzcGVuZGVkVGltZTtjPT09ZCYmKGEubmV4dEtub3duUGVuZGluZ0xldmVsPUlqKGUpKTtpZihvaiYmKGU9YS5sYXN0UGluZ2VkVGltZSwwPT09ZXx8ZT49Yykpe2EubGFzdFBpbmdlZFRpbWU9YztFaihhLGMpO2JyZWFrfWU9emooYSk7aWYoMCE9PWUmJmUhPT1jKWJyZWFrO2lmKDAhPT1kJiZkIT09Yyl7YS5sYXN0UGluZ2VkVGltZT1cbmQ7YnJlYWt9MTA3Mzc0MTgyMyE9PW1qP2Q9MTAqKDEwNzM3NDE4MjEtbWopLSRmKCk6MTA3Mzc0MTgyMz09PWxqP2Q9MDooZD0xMCooMTA3Mzc0MTgyMS1saiktNUUzLGU9JGYoKSxjPTEwKigxMDczNzQxODIxLWMpLWUsZD1lLWQsMD5kJiYoZD0wKSxkPSgxMjA+ZD8xMjA6NDgwPmQ/NDgwOjEwODA+ZD8xMDgwOjE5MjA+ZD8xOTIwOjNFMz5kPzNFMzo0MzIwPmQ/NDMyMDoxOTYwKmJqKGQvMTk2MCkpLWQsYzxkJiYoZD1jKSk7aWYoMTA8ZCl7YS50aW1lb3V0SGFuZGxlPUhkKEpqLmJpbmQobnVsbCxhKSxkKTticmVha31KaihhKTticmVhaztjYXNlIGpqOmlmKDEwNzM3NDE4MjMhPT1saiYmbnVsbCE9PW5qKXtmPWxqO3ZhciBnPW5qO2Q9Zy5idXN5TWluRHVyYXRpb25Nc3wwOzA+PWQ/ZD0wOihlPWcuYnVzeURlbGF5TXN8MCxmPSRmKCktKDEwKigxMDczNzQxODIxLWYpLShnLnRpbWVvdXRNc3wwfHw1RTMpKSxkPWY8PWU/MDplK2QtZik7aWYoMTA8ZCl7eGkoYSxjKTthLnRpbWVvdXRIYW5kbGU9XG5IZChKai5iaW5kKG51bGwsYSksZCk7YnJlYWt9fUpqKGEpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IodSgzMjkpKTt9WihhKTtpZihhLmNhbGxiYWNrTm9kZT09PWIpcmV0dXJuIEJqLmJpbmQobnVsbCxhKX19cmV0dXJuIG51bGx9XG5mdW5jdGlvbiB5aihhKXt2YXIgYj1hLmxhc3RFeHBpcmVkVGltZTtiPTAhPT1iP2I6MTA3Mzc0MTgyMztpZigoVyYoZmp8Z2opKSE9PVYpdGhyb3cgRXJyb3IodSgzMjcpKTtEaigpO2E9PT1UJiZiPT09VXx8RWooYSxiKTtpZihudWxsIT09WCl7dmFyIGM9VztXfD1majt2YXIgZD1GaigpO2RvIHRyeXtLaigpO2JyZWFrfWNhdGNoKGUpe0hqKGEsZSl9d2hpbGUoMSk7bmcoKTtXPWM7Y2ouY3VycmVudD1kO2lmKFM9PT1oail0aHJvdyBjPWtqLEVqKGEsYikseGkoYSxiKSxaKGEpLGM7aWYobnVsbCE9PVgpdGhyb3cgRXJyb3IodSgyNjEpKTthLmZpbmlzaGVkV29yaz1hLmN1cnJlbnQuYWx0ZXJuYXRlO2EuZmluaXNoZWRFeHBpcmF0aW9uVGltZT1iO1Q9bnVsbDtKaihhKTtaKGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIExqKCl7aWYobnVsbCE9PXRqKXt2YXIgYT10ajt0aj1udWxsO2EuZm9yRWFjaChmdW5jdGlvbihhLGMpe0NqKGMsYSk7WihjKX0pO2dnKCl9fVxuZnVuY3Rpb24gTWooYSxiKXt2YXIgYz1XO1d8PTE7dHJ5e3JldHVybiBhKGIpfWZpbmFsbHl7Vz1jLFc9PT1WJiZnZygpfX1mdW5jdGlvbiBOaihhLGIpe3ZhciBjPVc7VyY9LTI7V3w9ZWo7dHJ5e3JldHVybiBhKGIpfWZpbmFsbHl7Vz1jLFc9PT1WJiZnZygpfX1cbmZ1bmN0aW9uIEVqKGEsYil7YS5maW5pc2hlZFdvcms9bnVsbDthLmZpbmlzaGVkRXhwaXJhdGlvblRpbWU9MDt2YXIgYz1hLnRpbWVvdXRIYW5kbGU7LTEhPT1jJiYoYS50aW1lb3V0SGFuZGxlPS0xLElkKGMpKTtpZihudWxsIT09WClmb3IoYz1YLnJldHVybjtudWxsIT09Yzspe3ZhciBkPWM7c3dpdGNoKGQudGFnKXtjYXNlIDE6ZD1kLnR5cGUuY2hpbGRDb250ZXh0VHlwZXM7bnVsbCE9PWQmJnZvaWQgMCE9PWQmJkRmKCk7YnJlYWs7Y2FzZSAzOmVoKCk7SChLKTtIKEopO2JyZWFrO2Nhc2UgNTpnaChkKTticmVhaztjYXNlIDQ6ZWgoKTticmVhaztjYXNlIDEzOkgoTSk7YnJlYWs7Y2FzZSAxOTpIKE0pO2JyZWFrO2Nhc2UgMTA6b2coZCl9Yz1jLnJldHVybn1UPWE7WD1TZyhhLmN1cnJlbnQsbnVsbCk7VT1iO1M9dGk7a2o9bnVsbDttaj1saj0xMDczNzQxODIzO25qPW51bGw7d2k9MDtvaj0hMX1cbmZ1bmN0aW9uIEhqKGEsYil7ZG97dHJ5e25nKCk7amguY3VycmVudD1zaDtpZihtaClmb3IodmFyIGM9Ti5tZW1vaXplZFN0YXRlO251bGwhPT1jOyl7dmFyIGQ9Yy5xdWV1ZTtudWxsIT09ZCYmKGQucGVuZGluZz1udWxsKTtjPWMubmV4dH1saD0wO1A9Tz1OPW51bGw7bWg9ITE7aWYobnVsbD09PVh8fG51bGw9PT1YLnJldHVybilyZXR1cm4gUz1oaixraj1iLFg9bnVsbDthOnt2YXIgZT1hLGY9WC5yZXR1cm4sZz1YLGg9YjtiPVU7Zy5lZmZlY3RUYWd8PTIwNDg7Zy5maXJzdEVmZmVjdD1nLmxhc3RFZmZlY3Q9bnVsbDtpZihudWxsIT09aCYmIm9iamVjdCI9PT10eXBlb2YgaCYmImZ1bmN0aW9uIj09PXR5cGVvZiBoLnRoZW4pe3ZhciBrPWg7aWYoMD09PShnLm1vZGUmMikpe3ZhciBsPWcuYWx0ZXJuYXRlO2w/KGcudXBkYXRlUXVldWU9bC51cGRhdGVRdWV1ZSxnLm1lbW9pemVkU3RhdGU9bC5tZW1vaXplZFN0YXRlLGcuZXhwaXJhdGlvblRpbWU9bC5leHBpcmF0aW9uVGltZSk6KGcudXBkYXRlUXVldWU9XG5udWxsLGcubWVtb2l6ZWRTdGF0ZT1udWxsKX12YXIgbT0wIT09KE0uY3VycmVudCYxKSxwPWY7ZG97dmFyIHg7aWYoeD0xMz09PXAudGFnKXt2YXIgej1wLm1lbW9pemVkU3RhdGU7aWYobnVsbCE9PXopeD1udWxsIT09ei5kZWh5ZHJhdGVkPyEwOiExO2Vsc2V7dmFyIGNhPXAubWVtb2l6ZWRQcm9wczt4PXZvaWQgMD09PWNhLmZhbGxiYWNrPyExOiEwIT09Y2EudW5zdGFibGVfYXZvaWRUaGlzRmFsbGJhY2s/ITA6bT8hMTohMH19aWYoeCl7dmFyIEQ9cC51cGRhdGVRdWV1ZTtpZihudWxsPT09RCl7dmFyIHQ9bmV3IFNldDt0LmFkZChrKTtwLnVwZGF0ZVF1ZXVlPXR9ZWxzZSBELmFkZChrKTtpZigwPT09KHAubW9kZSYyKSl7cC5lZmZlY3RUYWd8PTY0O2cuZWZmZWN0VGFnJj0tMjk4MTtpZigxPT09Zy50YWcpaWYobnVsbD09PWcuYWx0ZXJuYXRlKWcudGFnPTE3O2Vsc2V7dmFyIHk9d2coMTA3Mzc0MTgyMyxudWxsKTt5LnRhZz0yO3hnKGcseSl9Zy5leHBpcmF0aW9uVGltZT0xMDczNzQxODIzO1xuYnJlYWsgYX1oPXZvaWQgMDtnPWI7dmFyIEE9ZS5waW5nQ2FjaGU7bnVsbD09PUE/KEE9ZS5waW5nQ2FjaGU9bmV3IFdpLGg9bmV3IFNldCxBLnNldChrLGgpKTooaD1BLmdldChrKSx2b2lkIDA9PT1oJiYoaD1uZXcgU2V0LEEuc2V0KGssaCkpKTtpZighaC5oYXMoZykpe2guYWRkKGcpO3ZhciBxPU9qLmJpbmQobnVsbCxlLGssZyk7ay50aGVuKHEscSl9cC5lZmZlY3RUYWd8PTQwOTY7cC5leHBpcmF0aW9uVGltZT1iO2JyZWFrIGF9cD1wLnJldHVybn13aGlsZShudWxsIT09cCk7aD1FcnJvcigocGIoZy50eXBlKXx8IkEgUmVhY3QgY29tcG9uZW50IikrIiBzdXNwZW5kZWQgd2hpbGUgcmVuZGVyaW5nLCBidXQgbm8gZmFsbGJhY2sgVUkgd2FzIHNwZWNpZmllZC5cXG5cXG5BZGQgYSA8U3VzcGVuc2UgZmFsbGJhY2s9Li4uPiBjb21wb25lbnQgaGlnaGVyIGluIHRoZSB0cmVlIHRvIHByb3ZpZGUgYSBsb2FkaW5nIGluZGljYXRvciBvciBwbGFjZWhvbGRlciB0byBkaXNwbGF5LiIrcWIoZykpfVMhPT1cbmpqJiYoUz1paik7aD1BaShoLGcpO3A9Zjtkb3tzd2l0Y2gocC50YWcpe2Nhc2UgMzprPWg7cC5lZmZlY3RUYWd8PTQwOTY7cC5leHBpcmF0aW9uVGltZT1iO3ZhciBCPVhpKHAsayxiKTt5ZyhwLEIpO2JyZWFrIGE7Y2FzZSAxOms9aDt2YXIgdz1wLnR5cGUsdWI9cC5zdGF0ZU5vZGU7aWYoMD09PShwLmVmZmVjdFRhZyY2NCkmJigiZnVuY3Rpb24iPT09dHlwZW9mIHcuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yfHxudWxsIT09dWImJiJmdW5jdGlvbiI9PT10eXBlb2YgdWIuY29tcG9uZW50RGlkQ2F0Y2gmJihudWxsPT09YWp8fCFhai5oYXModWIpKSkpe3AuZWZmZWN0VGFnfD00MDk2O3AuZXhwaXJhdGlvblRpbWU9Yjt2YXIgdmI9JGkocCxrLGIpO3lnKHAsdmIpO2JyZWFrIGF9fXA9cC5yZXR1cm59d2hpbGUobnVsbCE9PXApfVg9UGooWCl9Y2F0Y2goWGMpe2I9WGM7Y29udGludWV9YnJlYWt9d2hpbGUoMSl9XG5mdW5jdGlvbiBGaigpe3ZhciBhPWNqLmN1cnJlbnQ7Y2ouY3VycmVudD1zaDtyZXR1cm4gbnVsbD09PWE/c2g6YX1mdW5jdGlvbiBBZyhhLGIpe2E8bGomJjI8YSYmKGxqPWEpO251bGwhPT1iJiZhPG1qJiYyPGEmJihtaj1hLG5qPWIpfWZ1bmN0aW9uIEJnKGEpe2E+d2kmJih3aT1hKX1mdW5jdGlvbiBLaigpe2Zvcig7bnVsbCE9PVg7KVg9UWooWCl9ZnVuY3Rpb24gR2ooKXtmb3IoO251bGwhPT1YJiYhVWYoKTspWD1RaihYKX1mdW5jdGlvbiBRaihhKXt2YXIgYj1SaihhLmFsdGVybmF0ZSxhLFUpO2EubWVtb2l6ZWRQcm9wcz1hLnBlbmRpbmdQcm9wcztudWxsPT09YiYmKGI9UGooYSkpO2RqLmN1cnJlbnQ9bnVsbDtyZXR1cm4gYn1cbmZ1bmN0aW9uIFBqKGEpe1g9YTtkb3t2YXIgYj1YLmFsdGVybmF0ZTthPVgucmV0dXJuO2lmKDA9PT0oWC5lZmZlY3RUYWcmMjA0OCkpe2I9c2koYixYLFUpO2lmKDE9PT1VfHwxIT09WC5jaGlsZEV4cGlyYXRpb25UaW1lKXtmb3IodmFyIGM9MCxkPVguY2hpbGQ7bnVsbCE9PWQ7KXt2YXIgZT1kLmV4cGlyYXRpb25UaW1lLGY9ZC5jaGlsZEV4cGlyYXRpb25UaW1lO2U+YyYmKGM9ZSk7Zj5jJiYoYz1mKTtkPWQuc2libGluZ31YLmNoaWxkRXhwaXJhdGlvblRpbWU9Y31pZihudWxsIT09YilyZXR1cm4gYjtudWxsIT09YSYmMD09PShhLmVmZmVjdFRhZyYyMDQ4KSYmKG51bGw9PT1hLmZpcnN0RWZmZWN0JiYoYS5maXJzdEVmZmVjdD1YLmZpcnN0RWZmZWN0KSxudWxsIT09WC5sYXN0RWZmZWN0JiYobnVsbCE9PWEubGFzdEVmZmVjdCYmKGEubGFzdEVmZmVjdC5uZXh0RWZmZWN0PVguZmlyc3RFZmZlY3QpLGEubGFzdEVmZmVjdD1YLmxhc3RFZmZlY3QpLDE8WC5lZmZlY3RUYWcmJihudWxsIT09XG5hLmxhc3RFZmZlY3Q/YS5sYXN0RWZmZWN0Lm5leHRFZmZlY3Q9WDphLmZpcnN0RWZmZWN0PVgsYS5sYXN0RWZmZWN0PVgpKX1lbHNle2I9emkoWCk7aWYobnVsbCE9PWIpcmV0dXJuIGIuZWZmZWN0VGFnJj0yMDQ3LGI7bnVsbCE9PWEmJihhLmZpcnN0RWZmZWN0PWEubGFzdEVmZmVjdD1udWxsLGEuZWZmZWN0VGFnfD0yMDQ4KX1iPVguc2libGluZztpZihudWxsIT09YilyZXR1cm4gYjtYPWF9d2hpbGUobnVsbCE9PVgpO1M9PT10aSYmKFM9amopO3JldHVybiBudWxsfWZ1bmN0aW9uIElqKGEpe3ZhciBiPWEuZXhwaXJhdGlvblRpbWU7YT1hLmNoaWxkRXhwaXJhdGlvblRpbWU7cmV0dXJuIGI+YT9iOmF9ZnVuY3Rpb24gSmooYSl7dmFyIGI9YWcoKTtjZyg5OSxTai5iaW5kKG51bGwsYSxiKSk7cmV0dXJuIG51bGx9XG5mdW5jdGlvbiBTaihhLGIpe2RvIERqKCk7d2hpbGUobnVsbCE9PXJqKTtpZigoVyYoZmp8Z2opKSE9PVYpdGhyb3cgRXJyb3IodSgzMjcpKTt2YXIgYz1hLmZpbmlzaGVkV29yayxkPWEuZmluaXNoZWRFeHBpcmF0aW9uVGltZTtpZihudWxsPT09YylyZXR1cm4gbnVsbDthLmZpbmlzaGVkV29yaz1udWxsO2EuZmluaXNoZWRFeHBpcmF0aW9uVGltZT0wO2lmKGM9PT1hLmN1cnJlbnQpdGhyb3cgRXJyb3IodSgxNzcpKTthLmNhbGxiYWNrTm9kZT1udWxsO2EuY2FsbGJhY2tFeHBpcmF0aW9uVGltZT0wO2EuY2FsbGJhY2tQcmlvcml0eT05MDthLm5leHRLbm93blBlbmRpbmdMZXZlbD0wO3ZhciBlPUlqKGMpO2EuZmlyc3RQZW5kaW5nVGltZT1lO2Q8PWEubGFzdFN1c3BlbmRlZFRpbWU/YS5maXJzdFN1c3BlbmRlZFRpbWU9YS5sYXN0U3VzcGVuZGVkVGltZT1hLm5leHRLbm93blBlbmRpbmdMZXZlbD0wOmQ8PWEuZmlyc3RTdXNwZW5kZWRUaW1lJiYoYS5maXJzdFN1c3BlbmRlZFRpbWU9XG5kLTEpO2Q8PWEubGFzdFBpbmdlZFRpbWUmJihhLmxhc3RQaW5nZWRUaW1lPTApO2Q8PWEubGFzdEV4cGlyZWRUaW1lJiYoYS5sYXN0RXhwaXJlZFRpbWU9MCk7YT09PVQmJihYPVQ9bnVsbCxVPTApOzE8Yy5lZmZlY3RUYWc/bnVsbCE9PWMubGFzdEVmZmVjdD8oYy5sYXN0RWZmZWN0Lm5leHRFZmZlY3Q9YyxlPWMuZmlyc3RFZmZlY3QpOmU9YzplPWMuZmlyc3RFZmZlY3Q7aWYobnVsbCE9PWUpe3ZhciBmPVc7V3w9Z2o7ZGouY3VycmVudD1udWxsO0RkPWZkO3ZhciBnPXhkKCk7aWYoeWQoZykpe2lmKCJzZWxlY3Rpb25TdGFydCJpbiBnKXZhciBoPXtzdGFydDpnLnNlbGVjdGlvblN0YXJ0LGVuZDpnLnNlbGVjdGlvbkVuZH07ZWxzZSBhOntoPShoPWcub3duZXJEb2N1bWVudCkmJmguZGVmYXVsdFZpZXd8fHdpbmRvdzt2YXIgaz1oLmdldFNlbGVjdGlvbiYmaC5nZXRTZWxlY3Rpb24oKTtpZihrJiYwIT09ay5yYW5nZUNvdW50KXtoPWsuYW5jaG9yTm9kZTt2YXIgbD1rLmFuY2hvck9mZnNldCxcbm09ay5mb2N1c05vZGU7az1rLmZvY3VzT2Zmc2V0O3RyeXtoLm5vZGVUeXBlLG0ubm9kZVR5cGV9Y2F0Y2god2Ipe2g9bnVsbDticmVhayBhfXZhciBwPTAseD0tMSx6PS0xLGNhPTAsRD0wLHQ9Zyx5PW51bGw7Yjpmb3IoOzspe2Zvcih2YXIgQTs7KXt0IT09aHx8MCE9PWwmJjMhPT10Lm5vZGVUeXBlfHwoeD1wK2wpO3QhPT1tfHwwIT09ayYmMyE9PXQubm9kZVR5cGV8fCh6PXArayk7Mz09PXQubm9kZVR5cGUmJihwKz10Lm5vZGVWYWx1ZS5sZW5ndGgpO2lmKG51bGw9PT0oQT10LmZpcnN0Q2hpbGQpKWJyZWFrO3k9dDt0PUF9Zm9yKDs7KXtpZih0PT09ZylicmVhayBiO3k9PT1oJiYrK2NhPT09bCYmKHg9cCk7eT09PW0mJisrRD09PWsmJih6PXApO2lmKG51bGwhPT0oQT10Lm5leHRTaWJsaW5nKSlicmVhazt0PXk7eT10LnBhcmVudE5vZGV9dD1BfWg9LTE9PT14fHwtMT09PXo/bnVsbDp7c3RhcnQ6eCxlbmQ6en19ZWxzZSBoPW51bGx9aD1ofHx7c3RhcnQ6MCxlbmQ6MH19ZWxzZSBoPVxubnVsbDtFZD17YWN0aXZlRWxlbWVudERldGFjaGVkOm51bGwsZm9jdXNlZEVsZW06ZyxzZWxlY3Rpb25SYW5nZTpofTtmZD0hMTtZPWU7ZG8gdHJ5e1RqKCl9Y2F0Y2god2Ipe2lmKG51bGw9PT1ZKXRocm93IEVycm9yKHUoMzMwKSk7RWkoWSx3Yik7WT1ZLm5leHRFZmZlY3R9d2hpbGUobnVsbCE9PVkpO1k9ZTtkbyB0cnl7Zm9yKGc9YSxoPWI7bnVsbCE9PVk7KXt2YXIgcT1ZLmVmZmVjdFRhZztxJjE2JiZSYihZLnN0YXRlTm9kZSwiIik7aWYocSYxMjgpe3ZhciBCPVkuYWx0ZXJuYXRlO2lmKG51bGwhPT1CKXt2YXIgdz1CLnJlZjtudWxsIT09dyYmKCJmdW5jdGlvbiI9PT10eXBlb2Ygdz93KG51bGwpOncuY3VycmVudD1udWxsKX19c3dpdGNoKHEmMTAzOCl7Y2FzZSAyOlBpKFkpO1kuZWZmZWN0VGFnJj0tMzticmVhaztjYXNlIDY6UGkoWSk7WS5lZmZlY3RUYWcmPS0zO1NpKFkuYWx0ZXJuYXRlLFkpO2JyZWFrO2Nhc2UgMTAyNDpZLmVmZmVjdFRhZyY9LTEwMjU7YnJlYWs7Y2FzZSAxMDI4OlkuZWZmZWN0VGFnJj1cbi0xMDI1O1NpKFkuYWx0ZXJuYXRlLFkpO2JyZWFrO2Nhc2UgNDpTaShZLmFsdGVybmF0ZSxZKTticmVhaztjYXNlIDg6bD1ZLE1pKGcsbCxoKSxOaShsKX1ZPVkubmV4dEVmZmVjdH19Y2F0Y2god2Ipe2lmKG51bGw9PT1ZKXRocm93IEVycm9yKHUoMzMwKSk7RWkoWSx3Yik7WT1ZLm5leHRFZmZlY3R9d2hpbGUobnVsbCE9PVkpO3c9RWQ7Qj14ZCgpO3E9dy5mb2N1c2VkRWxlbTtoPXcuc2VsZWN0aW9uUmFuZ2U7aWYoQiE9PXEmJnEmJnEub3duZXJEb2N1bWVudCYmd2QocS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxxKSl7bnVsbCE9PWgmJnlkKHEpJiYoQj1oLnN0YXJ0LHc9aC5lbmQsdm9pZCAwPT09dyYmKHc9QiksInNlbGVjdGlvblN0YXJ0ImluIHE/KHEuc2VsZWN0aW9uU3RhcnQ9QixxLnNlbGVjdGlvbkVuZD1NYXRoLm1pbih3LHEudmFsdWUubGVuZ3RoKSk6KHc9KEI9cS5vd25lckRvY3VtZW50fHxkb2N1bWVudCkmJkIuZGVmYXVsdFZpZXd8fHdpbmRvdyx3LmdldFNlbGVjdGlvbiYmXG4odz13LmdldFNlbGVjdGlvbigpLGw9cS50ZXh0Q29udGVudC5sZW5ndGgsZz1NYXRoLm1pbihoLnN0YXJ0LGwpLGg9dm9pZCAwPT09aC5lbmQ/ZzpNYXRoLm1pbihoLmVuZCxsKSwhdy5leHRlbmQmJmc+aCYmKGw9aCxoPWcsZz1sKSxsPXZkKHEsZyksbT12ZChxLGgpLGwmJm0mJigxIT09dy5yYW5nZUNvdW50fHx3LmFuY2hvck5vZGUhPT1sLm5vZGV8fHcuYW5jaG9yT2Zmc2V0IT09bC5vZmZzZXR8fHcuZm9jdXNOb2RlIT09bS5ub2RlfHx3LmZvY3VzT2Zmc2V0IT09bS5vZmZzZXQpJiYoQj1CLmNyZWF0ZVJhbmdlKCksQi5zZXRTdGFydChsLm5vZGUsbC5vZmZzZXQpLHcucmVtb3ZlQWxsUmFuZ2VzKCksZz5oPyh3LmFkZFJhbmdlKEIpLHcuZXh0ZW5kKG0ubm9kZSxtLm9mZnNldCkpOihCLnNldEVuZChtLm5vZGUsbS5vZmZzZXQpLHcuYWRkUmFuZ2UoQikpKSkpKTtCPVtdO2Zvcih3PXE7dz13LnBhcmVudE5vZGU7KTE9PT13Lm5vZGVUeXBlJiZCLnB1c2goe2VsZW1lbnQ6dyxsZWZ0Oncuc2Nyb2xsTGVmdCxcbnRvcDp3LnNjcm9sbFRvcH0pOyJmdW5jdGlvbiI9PT10eXBlb2YgcS5mb2N1cyYmcS5mb2N1cygpO2ZvcihxPTA7cTxCLmxlbmd0aDtxKyspdz1CW3FdLHcuZWxlbWVudC5zY3JvbGxMZWZ0PXcubGVmdCx3LmVsZW1lbnQuc2Nyb2xsVG9wPXcudG9wfWZkPSEhRGQ7RWQ9RGQ9bnVsbDthLmN1cnJlbnQ9YztZPWU7ZG8gdHJ5e2ZvcihxPWE7bnVsbCE9PVk7KXt2YXIgdWI9WS5lZmZlY3RUYWc7dWImMzYmJkppKHEsWS5hbHRlcm5hdGUsWSk7aWYodWImMTI4KXtCPXZvaWQgMDt2YXIgdmI9WS5yZWY7aWYobnVsbCE9PXZiKXt2YXIgWGM9WS5zdGF0ZU5vZGU7c3dpdGNoKFkudGFnKXtjYXNlIDU6Qj1YYzticmVhaztkZWZhdWx0OkI9WGN9ImZ1bmN0aW9uIj09PXR5cGVvZiB2Yj92YihCKTp2Yi5jdXJyZW50PUJ9fVk9WS5uZXh0RWZmZWN0fX1jYXRjaCh3Yil7aWYobnVsbD09PVkpdGhyb3cgRXJyb3IodSgzMzApKTtFaShZLHdiKTtZPVkubmV4dEVmZmVjdH13aGlsZShudWxsIT09WSk7WT1cbm51bGw7VmYoKTtXPWZ9ZWxzZSBhLmN1cnJlbnQ9YztpZihxailxaj0hMSxyaj1hLHNqPWI7ZWxzZSBmb3IoWT1lO251bGwhPT1ZOyliPVkubmV4dEVmZmVjdCxZLm5leHRFZmZlY3Q9bnVsbCxZPWI7Yj1hLmZpcnN0UGVuZGluZ1RpbWU7MD09PWImJihhaj1udWxsKTsxMDczNzQxODIzPT09Yj9hPT09dmo/dWorKzoodWo9MCx2aj1hKTp1aj0wOyJmdW5jdGlvbiI9PT10eXBlb2YgVWomJlVqKGMuc3RhdGVOb2RlLGQpO1ooYSk7aWYoWWkpdGhyb3cgWWk9ITEsYT1aaSxaaT1udWxsLGE7aWYoKFcmZWopIT09VilyZXR1cm4gbnVsbDtnZygpO3JldHVybiBudWxsfWZ1bmN0aW9uIFRqKCl7Zm9yKDtudWxsIT09WTspe3ZhciBhPVkuZWZmZWN0VGFnOzAhPT0oYSYyNTYpJiZHaShZLmFsdGVybmF0ZSxZKTswPT09KGEmNTEyKXx8cWp8fChxaj0hMCxkZyg5NyxmdW5jdGlvbigpe0RqKCk7cmV0dXJuIG51bGx9KSk7WT1ZLm5leHRFZmZlY3R9fVxuZnVuY3Rpb24gRGooKXtpZig5MCE9PXNqKXt2YXIgYT05Nzxzaj85Nzpzajtzaj05MDtyZXR1cm4gY2coYSxWail9fWZ1bmN0aW9uIFZqKCl7aWYobnVsbD09PXJqKXJldHVybiExO3ZhciBhPXJqO3JqPW51bGw7aWYoKFcmKGZqfGdqKSkhPT1WKXRocm93IEVycm9yKHUoMzMxKSk7dmFyIGI9VztXfD1najtmb3IoYT1hLmN1cnJlbnQuZmlyc3RFZmZlY3Q7bnVsbCE9PWE7KXt0cnl7dmFyIGM9YTtpZigwIT09KGMuZWZmZWN0VGFnJjUxMikpc3dpdGNoKGMudGFnKXtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OmNhc2UgMjI6SGkoNSxjKSxJaSg1LGMpfX1jYXRjaChkKXtpZihudWxsPT09YSl0aHJvdyBFcnJvcih1KDMzMCkpO0VpKGEsZCl9Yz1hLm5leHRFZmZlY3Q7YS5uZXh0RWZmZWN0PW51bGw7YT1jfVc9YjtnZygpO3JldHVybiEwfVxuZnVuY3Rpb24gV2ooYSxiLGMpe2I9QWkoYyxiKTtiPVhpKGEsYiwxMDczNzQxODIzKTt4ZyhhLGIpO2E9eGooYSwxMDczNzQxODIzKTtudWxsIT09YSYmWihhKX1mdW5jdGlvbiBFaShhLGIpe2lmKDM9PT1hLnRhZylXaihhLGEsYik7ZWxzZSBmb3IodmFyIGM9YS5yZXR1cm47bnVsbCE9PWM7KXtpZigzPT09Yy50YWcpe1dqKGMsYSxiKTticmVha31lbHNlIGlmKDE9PT1jLnRhZyl7dmFyIGQ9Yy5zdGF0ZU5vZGU7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBjLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yfHwiZnVuY3Rpb24iPT09dHlwZW9mIGQuY29tcG9uZW50RGlkQ2F0Y2gmJihudWxsPT09YWp8fCFhai5oYXMoZCkpKXthPUFpKGIsYSk7YT0kaShjLGEsMTA3Mzc0MTgyMyk7eGcoYyxhKTtjPXhqKGMsMTA3Mzc0MTgyMyk7bnVsbCE9PWMmJlooYyk7YnJlYWt9fWM9Yy5yZXR1cm59fVxuZnVuY3Rpb24gT2ooYSxiLGMpe3ZhciBkPWEucGluZ0NhY2hlO251bGwhPT1kJiZkLmRlbGV0ZShiKTtUPT09YSYmVT09PWM/Uz09PXZpfHxTPT09dWkmJjEwNzM3NDE4MjM9PT1saiYmJGYoKS1UaTxwaj9FaihhLFUpOm9qPSEwOkFqKGEsYykmJihiPWEubGFzdFBpbmdlZFRpbWUsMCE9PWImJmI8Y3x8KGEubGFzdFBpbmdlZFRpbWU9YyxaKGEpKSl9ZnVuY3Rpb24gVmkoYSxiKXt2YXIgYz1hLnN0YXRlTm9kZTtudWxsIT09YyYmYy5kZWxldGUoYik7Yj0wOzA9PT1iJiYoYj1HZygpLGI9SGcoYixhLG51bGwpKTthPXhqKGEsYik7bnVsbCE9PWEmJlooYSl9dmFyIFJqO1xuUmo9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWIuZXhwaXJhdGlvblRpbWU7aWYobnVsbCE9PWEpe3ZhciBlPWIucGVuZGluZ1Byb3BzO2lmKGEubWVtb2l6ZWRQcm9wcyE9PWV8fEsuY3VycmVudClyZz0hMDtlbHNle2lmKGQ8Yyl7cmc9ITE7c3dpdGNoKGIudGFnKXtjYXNlIDM6aGkoYik7WGgoKTticmVhaztjYXNlIDU6ZmgoYik7aWYoYi5tb2RlJjQmJjEhPT1jJiZlLmhpZGRlbilyZXR1cm4gYi5leHBpcmF0aW9uVGltZT1iLmNoaWxkRXhwaXJhdGlvblRpbWU9MSxudWxsO2JyZWFrO2Nhc2UgMTpMKGIudHlwZSkmJkdmKGIpO2JyZWFrO2Nhc2UgNDpkaChiLGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pO2JyZWFrO2Nhc2UgMTA6ZD1iLm1lbW9pemVkUHJvcHMudmFsdWU7ZT1iLnR5cGUuX2NvbnRleHQ7SShqZyxlLl9jdXJyZW50VmFsdWUpO2UuX2N1cnJlbnRWYWx1ZT1kO2JyZWFrO2Nhc2UgMTM6aWYobnVsbCE9PWIubWVtb2l6ZWRTdGF0ZSl7ZD1iLmNoaWxkLmNoaWxkRXhwaXJhdGlvblRpbWU7XG5pZigwIT09ZCYmZD49YylyZXR1cm4gamkoYSxiLGMpO0koTSxNLmN1cnJlbnQmMSk7Yj0kaChhLGIsYyk7cmV0dXJuIG51bGwhPT1iP2Iuc2libGluZzpudWxsfUkoTSxNLmN1cnJlbnQmMSk7YnJlYWs7Y2FzZSAxOTpkPWIuY2hpbGRFeHBpcmF0aW9uVGltZT49YztpZigwIT09KGEuZWZmZWN0VGFnJjY0KSl7aWYoZClyZXR1cm4gbWkoYSxiLGMpO2IuZWZmZWN0VGFnfD02NH1lPWIubWVtb2l6ZWRTdGF0ZTtudWxsIT09ZSYmKGUucmVuZGVyaW5nPW51bGwsZS50YWlsPW51bGwpO0koTSxNLmN1cnJlbnQpO2lmKCFkKXJldHVybiBudWxsfXJldHVybiAkaChhLGIsYyl9cmc9ITF9fWVsc2Ugcmc9ITE7Yi5leHBpcmF0aW9uVGltZT0wO3N3aXRjaChiLnRhZyl7Y2FzZSAyOmQ9Yi50eXBlO251bGwhPT1hJiYoYS5hbHRlcm5hdGU9bnVsbCxiLmFsdGVybmF0ZT1udWxsLGIuZWZmZWN0VGFnfD0yKTthPWIucGVuZGluZ1Byb3BzO2U9Q2YoYixKLmN1cnJlbnQpO3FnKGIsYyk7ZT1vaChudWxsLFxuYixkLGEsZSxjKTtiLmVmZmVjdFRhZ3w9MTtpZigib2JqZWN0Ij09PXR5cGVvZiBlJiZudWxsIT09ZSYmImZ1bmN0aW9uIj09PXR5cGVvZiBlLnJlbmRlciYmdm9pZCAwPT09ZS4kJHR5cGVvZil7Yi50YWc9MTtiLm1lbW9pemVkU3RhdGU9bnVsbDtiLnVwZGF0ZVF1ZXVlPW51bGw7aWYoTChkKSl7dmFyIGY9ITA7R2YoYil9ZWxzZSBmPSExO2IubWVtb2l6ZWRTdGF0ZT1udWxsIT09ZS5zdGF0ZSYmdm9pZCAwIT09ZS5zdGF0ZT9lLnN0YXRlOm51bGw7dWcoYik7dmFyIGc9ZC5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7ImZ1bmN0aW9uIj09PXR5cGVvZiBnJiZGZyhiLGQsZyxhKTtlLnVwZGF0ZXI9Smc7Yi5zdGF0ZU5vZGU9ZTtlLl9yZWFjdEludGVybmFsRmliZXI9YjtOZyhiLGQsYSxjKTtiPWdpKG51bGwsYixkLCEwLGYsYyl9ZWxzZSBiLnRhZz0wLFIobnVsbCxiLGUsYyksYj1iLmNoaWxkO3JldHVybiBiO2Nhc2UgMTY6YTp7ZT1iLmVsZW1lbnRUeXBlO251bGwhPT1hJiYoYS5hbHRlcm5hdGU9XG5udWxsLGIuYWx0ZXJuYXRlPW51bGwsYi5lZmZlY3RUYWd8PTIpO2E9Yi5wZW5kaW5nUHJvcHM7b2IoZSk7aWYoMSE9PWUuX3N0YXR1cyl0aHJvdyBlLl9yZXN1bHQ7ZT1lLl9yZXN1bHQ7Yi50eXBlPWU7Zj1iLnRhZz1YaihlKTthPWlnKGUsYSk7c3dpdGNoKGYpe2Nhc2UgMDpiPWRpKG51bGwsYixlLGEsYyk7YnJlYWsgYTtjYXNlIDE6Yj1maShudWxsLGIsZSxhLGMpO2JyZWFrIGE7Y2FzZSAxMTpiPVpoKG51bGwsYixlLGEsYyk7YnJlYWsgYTtjYXNlIDE0OmI9YWkobnVsbCxiLGUsaWcoZS50eXBlLGEpLGQsYyk7YnJlYWsgYX10aHJvdyBFcnJvcih1KDMwNixlLCIiKSk7fXJldHVybiBiO2Nhc2UgMDpyZXR1cm4gZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxlPWIuZWxlbWVudFR5cGU9PT1kP2U6aWcoZCxlKSxkaShhLGIsZCxlLGMpO2Nhc2UgMTpyZXR1cm4gZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxlPWIuZWxlbWVudFR5cGU9PT1kP2U6aWcoZCxlKSxmaShhLGIsZCxlLGMpO1xuY2FzZSAzOmhpKGIpO2Q9Yi51cGRhdGVRdWV1ZTtpZihudWxsPT09YXx8bnVsbD09PWQpdGhyb3cgRXJyb3IodSgyODIpKTtkPWIucGVuZGluZ1Byb3BzO2U9Yi5tZW1vaXplZFN0YXRlO2U9bnVsbCE9PWU/ZS5lbGVtZW50Om51bGw7dmcoYSxiKTt6ZyhiLGQsbnVsbCxjKTtkPWIubWVtb2l6ZWRTdGF0ZS5lbGVtZW50O2lmKGQ9PT1lKVhoKCksYj0kaChhLGIsYyk7ZWxzZXtpZihlPWIuc3RhdGVOb2RlLmh5ZHJhdGUpUGg9SmQoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mby5maXJzdENoaWxkKSxPaD1iLGU9UWg9ITA7aWYoZSlmb3IoYz1ZZyhiLG51bGwsZCxjKSxiLmNoaWxkPWM7YzspYy5lZmZlY3RUYWc9Yy5lZmZlY3RUYWcmLTN8MTAyNCxjPWMuc2libGluZztlbHNlIFIoYSxiLGQsYyksWGgoKTtiPWIuY2hpbGR9cmV0dXJuIGI7Y2FzZSA1OnJldHVybiBmaChiKSxudWxsPT09YSYmVWgoYiksZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxmPW51bGwhPT1hP2EubWVtb2l6ZWRQcm9wczpcbm51bGwsZz1lLmNoaWxkcmVuLEdkKGQsZSk/Zz1udWxsOm51bGwhPT1mJiZHZChkLGYpJiYoYi5lZmZlY3RUYWd8PTE2KSxlaShhLGIpLGIubW9kZSY0JiYxIT09YyYmZS5oaWRkZW4/KGIuZXhwaXJhdGlvblRpbWU9Yi5jaGlsZEV4cGlyYXRpb25UaW1lPTEsYj1udWxsKTooUihhLGIsZyxjKSxiPWIuY2hpbGQpLGI7Y2FzZSA2OnJldHVybiBudWxsPT09YSYmVWgoYiksbnVsbDtjYXNlIDEzOnJldHVybiBqaShhLGIsYyk7Y2FzZSA0OnJldHVybiBkaChiLGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLGQ9Yi5wZW5kaW5nUHJvcHMsbnVsbD09PWE/Yi5jaGlsZD1YZyhiLG51bGwsZCxjKTpSKGEsYixkLGMpLGIuY2hpbGQ7Y2FzZSAxMTpyZXR1cm4gZD1iLnR5cGUsZT1iLnBlbmRpbmdQcm9wcyxlPWIuZWxlbWVudFR5cGU9PT1kP2U6aWcoZCxlKSxaaChhLGIsZCxlLGMpO2Nhc2UgNzpyZXR1cm4gUihhLGIsYi5wZW5kaW5nUHJvcHMsYyksYi5jaGlsZDtjYXNlIDg6cmV0dXJuIFIoYSxcbmIsYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sYyksYi5jaGlsZDtjYXNlIDEyOnJldHVybiBSKGEsYixiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbixjKSxiLmNoaWxkO2Nhc2UgMTA6YTp7ZD1iLnR5cGUuX2NvbnRleHQ7ZT1iLnBlbmRpbmdQcm9wcztnPWIubWVtb2l6ZWRQcm9wcztmPWUudmFsdWU7dmFyIGg9Yi50eXBlLl9jb250ZXh0O0koamcsaC5fY3VycmVudFZhbHVlKTtoLl9jdXJyZW50VmFsdWU9ZjtpZihudWxsIT09ZylpZihoPWcudmFsdWUsZj0kZShoLGYpPzA6KCJmdW5jdGlvbiI9PT10eXBlb2YgZC5fY2FsY3VsYXRlQ2hhbmdlZEJpdHM/ZC5fY2FsY3VsYXRlQ2hhbmdlZEJpdHMoaCxmKToxMDczNzQxODIzKXwwLDA9PT1mKXtpZihnLmNoaWxkcmVuPT09ZS5jaGlsZHJlbiYmIUsuY3VycmVudCl7Yj0kaChhLGIsYyk7YnJlYWsgYX19ZWxzZSBmb3IoaD1iLmNoaWxkLG51bGwhPT1oJiYoaC5yZXR1cm49Yik7bnVsbCE9PWg7KXt2YXIgaz1oLmRlcGVuZGVuY2llcztpZihudWxsIT09XG5rKXtnPWguY2hpbGQ7Zm9yKHZhciBsPWsuZmlyc3RDb250ZXh0O251bGwhPT1sOyl7aWYobC5jb250ZXh0PT09ZCYmMCE9PShsLm9ic2VydmVkQml0cyZmKSl7MT09PWgudGFnJiYobD13ZyhjLG51bGwpLGwudGFnPTIseGcoaCxsKSk7aC5leHBpcmF0aW9uVGltZTxjJiYoaC5leHBpcmF0aW9uVGltZT1jKTtsPWguYWx0ZXJuYXRlO251bGwhPT1sJiZsLmV4cGlyYXRpb25UaW1lPGMmJihsLmV4cGlyYXRpb25UaW1lPWMpO3BnKGgucmV0dXJuLGMpO2suZXhwaXJhdGlvblRpbWU8YyYmKGsuZXhwaXJhdGlvblRpbWU9Yyk7YnJlYWt9bD1sLm5leHR9fWVsc2UgZz0xMD09PWgudGFnP2gudHlwZT09PWIudHlwZT9udWxsOmguY2hpbGQ6aC5jaGlsZDtpZihudWxsIT09ZylnLnJldHVybj1oO2Vsc2UgZm9yKGc9aDtudWxsIT09Zzspe2lmKGc9PT1iKXtnPW51bGw7YnJlYWt9aD1nLnNpYmxpbmc7aWYobnVsbCE9PWgpe2gucmV0dXJuPWcucmV0dXJuO2c9aDticmVha31nPWcucmV0dXJufWg9XG5nfVIoYSxiLGUuY2hpbGRyZW4sYyk7Yj1iLmNoaWxkfXJldHVybiBiO2Nhc2UgOTpyZXR1cm4gZT1iLnR5cGUsZj1iLnBlbmRpbmdQcm9wcyxkPWYuY2hpbGRyZW4scWcoYixjKSxlPXNnKGUsZi51bnN0YWJsZV9vYnNlcnZlZEJpdHMpLGQ9ZChlKSxiLmVmZmVjdFRhZ3w9MSxSKGEsYixkLGMpLGIuY2hpbGQ7Y2FzZSAxNDpyZXR1cm4gZT1iLnR5cGUsZj1pZyhlLGIucGVuZGluZ1Byb3BzKSxmPWlnKGUudHlwZSxmKSxhaShhLGIsZSxmLGQsYyk7Y2FzZSAxNTpyZXR1cm4gY2koYSxiLGIudHlwZSxiLnBlbmRpbmdQcm9wcyxkLGMpO2Nhc2UgMTc6cmV0dXJuIGQ9Yi50eXBlLGU9Yi5wZW5kaW5nUHJvcHMsZT1iLmVsZW1lbnRUeXBlPT09ZD9lOmlnKGQsZSksbnVsbCE9PWEmJihhLmFsdGVybmF0ZT1udWxsLGIuYWx0ZXJuYXRlPW51bGwsYi5lZmZlY3RUYWd8PTIpLGIudGFnPTEsTChkKT8oYT0hMCxHZihiKSk6YT0hMSxxZyhiLGMpLExnKGIsZCxlKSxOZyhiLGQsZSxjKSxnaShudWxsLFxuYixkLCEwLGEsYyk7Y2FzZSAxOTpyZXR1cm4gbWkoYSxiLGMpfXRocm93IEVycm9yKHUoMTU2LGIudGFnKSk7fTt2YXIgVWo9bnVsbCxMaT1udWxsO2Z1bmN0aW9uIFlqKGEpe2lmKCJ1bmRlZmluZWQiPT09dHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXylyZXR1cm4hMTt2YXIgYj1fX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX187aWYoYi5pc0Rpc2FibGVkfHwhYi5zdXBwb3J0c0ZpYmVyKXJldHVybiEwO3RyeXt2YXIgYz1iLmluamVjdChhKTtVaj1mdW5jdGlvbihhKXt0cnl7Yi5vbkNvbW1pdEZpYmVyUm9vdChjLGEsdm9pZCAwLDY0PT09KGEuY3VycmVudC5lZmZlY3RUYWcmNjQpKX1jYXRjaChlKXt9fTtMaT1mdW5jdGlvbihhKXt0cnl7Yi5vbkNvbW1pdEZpYmVyVW5tb3VudChjLGEpfWNhdGNoKGUpe319fWNhdGNoKGQpe31yZXR1cm4hMH1cbmZ1bmN0aW9uIFpqKGEsYixjLGQpe3RoaXMudGFnPWE7dGhpcy5rZXk9Yzt0aGlzLnNpYmxpbmc9dGhpcy5jaGlsZD10aGlzLnJldHVybj10aGlzLnN0YXRlTm9kZT10aGlzLnR5cGU9dGhpcy5lbGVtZW50VHlwZT1udWxsO3RoaXMuaW5kZXg9MDt0aGlzLnJlZj1udWxsO3RoaXMucGVuZGluZ1Byb3BzPWI7dGhpcy5kZXBlbmRlbmNpZXM9dGhpcy5tZW1vaXplZFN0YXRlPXRoaXMudXBkYXRlUXVldWU9dGhpcy5tZW1vaXplZFByb3BzPW51bGw7dGhpcy5tb2RlPWQ7dGhpcy5lZmZlY3RUYWc9MDt0aGlzLmxhc3RFZmZlY3Q9dGhpcy5maXJzdEVmZmVjdD10aGlzLm5leHRFZmZlY3Q9bnVsbDt0aGlzLmNoaWxkRXhwaXJhdGlvblRpbWU9dGhpcy5leHBpcmF0aW9uVGltZT0wO3RoaXMuYWx0ZXJuYXRlPW51bGx9ZnVuY3Rpb24gU2goYSxiLGMsZCl7cmV0dXJuIG5ldyBaaihhLGIsYyxkKX1cbmZ1bmN0aW9uIGJpKGEpe2E9YS5wcm90b3R5cGU7cmV0dXJuISghYXx8IWEuaXNSZWFjdENvbXBvbmVudCl9ZnVuY3Rpb24gWGooYSl7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBhKXJldHVybiBiaShhKT8xOjA7aWYodm9pZCAwIT09YSYmbnVsbCE9PWEpe2E9YS4kJHR5cGVvZjtpZihhPT09Z2IpcmV0dXJuIDExO2lmKGE9PT1qYilyZXR1cm4gMTR9cmV0dXJuIDJ9XG5mdW5jdGlvbiBTZyhhLGIpe3ZhciBjPWEuYWx0ZXJuYXRlO251bGw9PT1jPyhjPVNoKGEudGFnLGIsYS5rZXksYS5tb2RlKSxjLmVsZW1lbnRUeXBlPWEuZWxlbWVudFR5cGUsYy50eXBlPWEudHlwZSxjLnN0YXRlTm9kZT1hLnN0YXRlTm9kZSxjLmFsdGVybmF0ZT1hLGEuYWx0ZXJuYXRlPWMpOihjLnBlbmRpbmdQcm9wcz1iLGMuZWZmZWN0VGFnPTAsYy5uZXh0RWZmZWN0PW51bGwsYy5maXJzdEVmZmVjdD1udWxsLGMubGFzdEVmZmVjdD1udWxsKTtjLmNoaWxkRXhwaXJhdGlvblRpbWU9YS5jaGlsZEV4cGlyYXRpb25UaW1lO2MuZXhwaXJhdGlvblRpbWU9YS5leHBpcmF0aW9uVGltZTtjLmNoaWxkPWEuY2hpbGQ7Yy5tZW1vaXplZFByb3BzPWEubWVtb2l6ZWRQcm9wcztjLm1lbW9pemVkU3RhdGU9YS5tZW1vaXplZFN0YXRlO2MudXBkYXRlUXVldWU9YS51cGRhdGVRdWV1ZTtiPWEuZGVwZW5kZW5jaWVzO2MuZGVwZW5kZW5jaWVzPW51bGw9PT1iP251bGw6e2V4cGlyYXRpb25UaW1lOmIuZXhwaXJhdGlvblRpbWUsXG5maXJzdENvbnRleHQ6Yi5maXJzdENvbnRleHQscmVzcG9uZGVyczpiLnJlc3BvbmRlcnN9O2Muc2libGluZz1hLnNpYmxpbmc7Yy5pbmRleD1hLmluZGV4O2MucmVmPWEucmVmO3JldHVybiBjfVxuZnVuY3Rpb24gVWcoYSxiLGMsZCxlLGYpe3ZhciBnPTI7ZD1hO2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgYSliaShhKSYmKGc9MSk7ZWxzZSBpZigic3RyaW5nIj09PXR5cGVvZiBhKWc9NTtlbHNlIGE6c3dpdGNoKGEpe2Nhc2UgYWI6cmV0dXJuIFdnKGMuY2hpbGRyZW4sZSxmLGIpO2Nhc2UgZmI6Zz04O2V8PTc7YnJlYWs7Y2FzZSBiYjpnPTg7ZXw9MTticmVhaztjYXNlIGNiOnJldHVybiBhPVNoKDEyLGMsYixlfDgpLGEuZWxlbWVudFR5cGU9Y2IsYS50eXBlPWNiLGEuZXhwaXJhdGlvblRpbWU9ZixhO2Nhc2UgaGI6cmV0dXJuIGE9U2goMTMsYyxiLGUpLGEudHlwZT1oYixhLmVsZW1lbnRUeXBlPWhiLGEuZXhwaXJhdGlvblRpbWU9ZixhO2Nhc2UgaWI6cmV0dXJuIGE9U2goMTksYyxiLGUpLGEuZWxlbWVudFR5cGU9aWIsYS5leHBpcmF0aW9uVGltZT1mLGE7ZGVmYXVsdDppZigib2JqZWN0Ij09PXR5cGVvZiBhJiZudWxsIT09YSlzd2l0Y2goYS4kJHR5cGVvZil7Y2FzZSBkYjpnPVxuMTA7YnJlYWsgYTtjYXNlIGViOmc9OTticmVhayBhO2Nhc2UgZ2I6Zz0xMTticmVhayBhO2Nhc2UgamI6Zz0xNDticmVhayBhO2Nhc2Uga2I6Zz0xNjtkPW51bGw7YnJlYWsgYTtjYXNlIGxiOmc9MjI7YnJlYWsgYX10aHJvdyBFcnJvcih1KDEzMCxudWxsPT1hP2E6dHlwZW9mIGEsIiIpKTt9Yj1TaChnLGMsYixlKTtiLmVsZW1lbnRUeXBlPWE7Yi50eXBlPWQ7Yi5leHBpcmF0aW9uVGltZT1mO3JldHVybiBifWZ1bmN0aW9uIFdnKGEsYixjLGQpe2E9U2goNyxhLGQsYik7YS5leHBpcmF0aW9uVGltZT1jO3JldHVybiBhfWZ1bmN0aW9uIFRnKGEsYixjKXthPVNoKDYsYSxudWxsLGIpO2EuZXhwaXJhdGlvblRpbWU9YztyZXR1cm4gYX1cbmZ1bmN0aW9uIFZnKGEsYixjKXtiPVNoKDQsbnVsbCE9PWEuY2hpbGRyZW4/YS5jaGlsZHJlbjpbXSxhLmtleSxiKTtiLmV4cGlyYXRpb25UaW1lPWM7Yi5zdGF0ZU5vZGU9e2NvbnRhaW5lckluZm86YS5jb250YWluZXJJbmZvLHBlbmRpbmdDaGlsZHJlbjpudWxsLGltcGxlbWVudGF0aW9uOmEuaW1wbGVtZW50YXRpb259O3JldHVybiBifVxuZnVuY3Rpb24gYWsoYSxiLGMpe3RoaXMudGFnPWI7dGhpcy5jdXJyZW50PW51bGw7dGhpcy5jb250YWluZXJJbmZvPWE7dGhpcy5waW5nQ2FjaGU9dGhpcy5wZW5kaW5nQ2hpbGRyZW49bnVsbDt0aGlzLmZpbmlzaGVkRXhwaXJhdGlvblRpbWU9MDt0aGlzLmZpbmlzaGVkV29yaz1udWxsO3RoaXMudGltZW91dEhhbmRsZT0tMTt0aGlzLnBlbmRpbmdDb250ZXh0PXRoaXMuY29udGV4dD1udWxsO3RoaXMuaHlkcmF0ZT1jO3RoaXMuY2FsbGJhY2tOb2RlPW51bGw7dGhpcy5jYWxsYmFja1ByaW9yaXR5PTkwO3RoaXMubGFzdEV4cGlyZWRUaW1lPXRoaXMubGFzdFBpbmdlZFRpbWU9dGhpcy5uZXh0S25vd25QZW5kaW5nTGV2ZWw9dGhpcy5sYXN0U3VzcGVuZGVkVGltZT10aGlzLmZpcnN0U3VzcGVuZGVkVGltZT10aGlzLmZpcnN0UGVuZGluZ1RpbWU9MH1cbmZ1bmN0aW9uIEFqKGEsYil7dmFyIGM9YS5maXJzdFN1c3BlbmRlZFRpbWU7YT1hLmxhc3RTdXNwZW5kZWRUaW1lO3JldHVybiAwIT09YyYmYz49YiYmYTw9Yn1mdW5jdGlvbiB4aShhLGIpe3ZhciBjPWEuZmlyc3RTdXNwZW5kZWRUaW1lLGQ9YS5sYXN0U3VzcGVuZGVkVGltZTtjPGImJihhLmZpcnN0U3VzcGVuZGVkVGltZT1iKTtpZihkPmJ8fDA9PT1jKWEubGFzdFN1c3BlbmRlZFRpbWU9YjtiPD1hLmxhc3RQaW5nZWRUaW1lJiYoYS5sYXN0UGluZ2VkVGltZT0wKTtiPD1hLmxhc3RFeHBpcmVkVGltZSYmKGEubGFzdEV4cGlyZWRUaW1lPTApfVxuZnVuY3Rpb24geWkoYSxiKXtiPmEuZmlyc3RQZW5kaW5nVGltZSYmKGEuZmlyc3RQZW5kaW5nVGltZT1iKTt2YXIgYz1hLmZpcnN0U3VzcGVuZGVkVGltZTswIT09YyYmKGI+PWM/YS5maXJzdFN1c3BlbmRlZFRpbWU9YS5sYXN0U3VzcGVuZGVkVGltZT1hLm5leHRLbm93blBlbmRpbmdMZXZlbD0wOmI+PWEubGFzdFN1c3BlbmRlZFRpbWUmJihhLmxhc3RTdXNwZW5kZWRUaW1lPWIrMSksYj5hLm5leHRLbm93blBlbmRpbmdMZXZlbCYmKGEubmV4dEtub3duUGVuZGluZ0xldmVsPWIpKX1mdW5jdGlvbiBDaihhLGIpe3ZhciBjPWEubGFzdEV4cGlyZWRUaW1lO2lmKDA9PT1jfHxjPmIpYS5sYXN0RXhwaXJlZFRpbWU9Yn1cbmZ1bmN0aW9uIGJrKGEsYixjLGQpe3ZhciBlPWIuY3VycmVudCxmPUdnKCksZz1EZy5zdXNwZW5zZTtmPUhnKGYsZSxnKTthOmlmKGMpe2M9Yy5fcmVhY3RJbnRlcm5hbEZpYmVyO2I6e2lmKGRjKGMpIT09Y3x8MSE9PWMudGFnKXRocm93IEVycm9yKHUoMTcwKSk7dmFyIGg9Yztkb3tzd2l0Y2goaC50YWcpe2Nhc2UgMzpoPWguc3RhdGVOb2RlLmNvbnRleHQ7YnJlYWsgYjtjYXNlIDE6aWYoTChoLnR5cGUpKXtoPWguc3RhdGVOb2RlLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0O2JyZWFrIGJ9fWg9aC5yZXR1cm59d2hpbGUobnVsbCE9PWgpO3Rocm93IEVycm9yKHUoMTcxKSk7fWlmKDE9PT1jLnRhZyl7dmFyIGs9Yy50eXBlO2lmKEwoaykpe2M9RmYoYyxrLGgpO2JyZWFrIGF9fWM9aH1lbHNlIGM9QWY7bnVsbD09PWIuY29udGV4dD9iLmNvbnRleHQ9YzpiLnBlbmRpbmdDb250ZXh0PWM7Yj13ZyhmLGcpO2IucGF5bG9hZD17ZWxlbWVudDphfTtkPXZvaWQgMD09PVxuZD9udWxsOmQ7bnVsbCE9PWQmJihiLmNhbGxiYWNrPWQpO3hnKGUsYik7SWcoZSxmKTtyZXR1cm4gZn1mdW5jdGlvbiBjayhhKXthPWEuY3VycmVudDtpZighYS5jaGlsZClyZXR1cm4gbnVsbDtzd2l0Y2goYS5jaGlsZC50YWcpe2Nhc2UgNTpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGU7ZGVmYXVsdDpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGV9fWZ1bmN0aW9uIGRrKGEsYil7YT1hLm1lbW9pemVkU3RhdGU7bnVsbCE9PWEmJm51bGwhPT1hLmRlaHlkcmF0ZWQmJmEucmV0cnlUaW1lPGImJihhLnJldHJ5VGltZT1iKX1mdW5jdGlvbiBlayhhLGIpe2RrKGEsYik7KGE9YS5hbHRlcm5hdGUpJiZkayhhLGIpfVxuZnVuY3Rpb24gZmsoYSxiLGMpe2M9bnVsbCE9YyYmITA9PT1jLmh5ZHJhdGU7dmFyIGQ9bmV3IGFrKGEsYixjKSxlPVNoKDMsbnVsbCxudWxsLDI9PT1iPzc6MT09PWI/MzowKTtkLmN1cnJlbnQ9ZTtlLnN0YXRlTm9kZT1kO3VnKGUpO2FbT2RdPWQuY3VycmVudDtjJiYwIT09YiYmSmMoYSw5PT09YS5ub2RlVHlwZT9hOmEub3duZXJEb2N1bWVudCk7dGhpcy5faW50ZXJuYWxSb290PWR9ZmsucHJvdG90eXBlLnJlbmRlcj1mdW5jdGlvbihhKXtiayhhLHRoaXMuX2ludGVybmFsUm9vdCxudWxsLG51bGwpfTtmay5wcm90b3R5cGUudW5tb3VudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuX2ludGVybmFsUm9vdCxiPWEuY29udGFpbmVySW5mbztiayhudWxsLGEsbnVsbCxmdW5jdGlvbigpe2JbT2RdPW51bGx9KX07XG5mdW5jdGlvbiBnayhhKXtyZXR1cm4hKCFhfHwxIT09YS5ub2RlVHlwZSYmOSE9PWEubm9kZVR5cGUmJjExIT09YS5ub2RlVHlwZSYmKDghPT1hLm5vZGVUeXBlfHwiIHJlYWN0LW1vdW50LXBvaW50LXVuc3RhYmxlICIhPT1hLm5vZGVWYWx1ZSkpfWZ1bmN0aW9uIGhrKGEsYil7Ynx8KGI9YT85PT09YS5ub2RlVHlwZT9hLmRvY3VtZW50RWxlbWVudDphLmZpcnN0Q2hpbGQ6bnVsbCxiPSEoIWJ8fDEhPT1iLm5vZGVUeXBlfHwhYi5oYXNBdHRyaWJ1dGUoImRhdGEtcmVhY3Ryb290IikpKTtpZighYilmb3IodmFyIGM7Yz1hLmxhc3RDaGlsZDspYS5yZW1vdmVDaGlsZChjKTtyZXR1cm4gbmV3IGZrKGEsMCxiP3toeWRyYXRlOiEwfTp2b2lkIDApfVxuZnVuY3Rpb24gaWsoYSxiLGMsZCxlKXt2YXIgZj1jLl9yZWFjdFJvb3RDb250YWluZXI7aWYoZil7dmFyIGc9Zi5faW50ZXJuYWxSb290O2lmKCJmdW5jdGlvbiI9PT10eXBlb2YgZSl7dmFyIGg9ZTtlPWZ1bmN0aW9uKCl7dmFyIGE9Y2soZyk7aC5jYWxsKGEpfX1iayhiLGcsYSxlKX1lbHNle2Y9Yy5fcmVhY3RSb290Q29udGFpbmVyPWhrKGMsZCk7Zz1mLl9pbnRlcm5hbFJvb3Q7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBlKXt2YXIgaz1lO2U9ZnVuY3Rpb24oKXt2YXIgYT1jayhnKTtrLmNhbGwoYSl9fU5qKGZ1bmN0aW9uKCl7YmsoYixnLGEsZSl9KX1yZXR1cm4gY2soZyl9ZnVuY3Rpb24gamsoYSxiLGMpe3ZhciBkPTM8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTpudWxsO3JldHVybnskJHR5cGVvZjokYSxrZXk6bnVsbD09ZD9udWxsOiIiK2QsY2hpbGRyZW46YSxjb250YWluZXJJbmZvOmIsaW1wbGVtZW50YXRpb246Y319XG53Yz1mdW5jdGlvbihhKXtpZigxMz09PWEudGFnKXt2YXIgYj1oZyhHZygpLDE1MCwxMDApO0lnKGEsYik7ZWsoYSxiKX19O3hjPWZ1bmN0aW9uKGEpezEzPT09YS50YWcmJihJZyhhLDMpLGVrKGEsMykpfTt5Yz1mdW5jdGlvbihhKXtpZigxMz09PWEudGFnKXt2YXIgYj1HZygpO2I9SGcoYixhLG51bGwpO0lnKGEsYik7ZWsoYSxiKX19O1xuemE9ZnVuY3Rpb24oYSxiLGMpe3N3aXRjaChiKXtjYXNlICJpbnB1dCI6Q2IoYSxjKTtiPWMubmFtZTtpZigicmFkaW8iPT09Yy50eXBlJiZudWxsIT1iKXtmb3IoYz1hO2MucGFyZW50Tm9kZTspYz1jLnBhcmVudE5vZGU7Yz1jLnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W25hbWU9IitKU09OLnN0cmluZ2lmeSgiIitiKStcJ11bdHlwZT0icmFkaW8iXVwnKTtmb3IoYj0wO2I8Yy5sZW5ndGg7YisrKXt2YXIgZD1jW2JdO2lmKGQhPT1hJiZkLmZvcm09PT1hLmZvcm0pe3ZhciBlPVFkKGQpO2lmKCFlKXRocm93IEVycm9yKHUoOTApKTt5YihkKTtDYihkLGUpfX19YnJlYWs7Y2FzZSAidGV4dGFyZWEiOktiKGEsYyk7YnJlYWs7Y2FzZSAic2VsZWN0IjpiPWMudmFsdWUsbnVsbCE9YiYmSGIoYSwhIWMubXVsdGlwbGUsYiwhMSl9fTtGYT1NajtcbkdhPWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9VztXfD00O3RyeXtyZXR1cm4gY2coOTgsYS5iaW5kKG51bGwsYixjLGQsZSkpfWZpbmFsbHl7Vz1mLFc9PT1WJiZnZygpfX07SGE9ZnVuY3Rpb24oKXsoVyYoMXxmanxnaikpPT09ViYmKExqKCksRGooKSl9O0lhPWZ1bmN0aW9uKGEsYil7dmFyIGM9VztXfD0yO3RyeXtyZXR1cm4gYShiKX1maW5hbGx5e1c9YyxXPT09ViYmZ2coKX19O2Z1bmN0aW9uIGtrKGEsYil7dmFyIGM9Mjxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOm51bGw7aWYoIWdrKGIpKXRocm93IEVycm9yKHUoMjAwKSk7cmV0dXJuIGprKGEsYixudWxsLGMpfXZhciBsaz17RXZlbnRzOltOYyxQZCxRZCx4YSx0YSxYZCxmdW5jdGlvbihhKXtqYyhhLFdkKX0sRGEsRWEsaWQsbWMsRGose2N1cnJlbnQ6ITF9XX07XG4oZnVuY3Rpb24oYSl7dmFyIGI9YS5maW5kRmliZXJCeUhvc3RJbnN0YW5jZTtyZXR1cm4gWWoobih7fSxhLHtvdmVycmlkZUhvb2tTdGF0ZTpudWxsLG92ZXJyaWRlUHJvcHM6bnVsbCxzZXRTdXNwZW5zZUhhbmRsZXI6bnVsbCxzY2hlZHVsZVVwZGF0ZTpudWxsLGN1cnJlbnREaXNwYXRjaGVyUmVmOldhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsZmluZEhvc3RJbnN0YW5jZUJ5RmliZXI6ZnVuY3Rpb24oYSl7YT1oYyhhKTtyZXR1cm4gbnVsbD09PWE/bnVsbDphLnN0YXRlTm9kZX0sZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGI/YihhKTpudWxsfSxmaW5kSG9zdEluc3RhbmNlc0ZvclJlZnJlc2g6bnVsbCxzY2hlZHVsZVJlZnJlc2g6bnVsbCxzY2hlZHVsZVJvb3Q6bnVsbCxzZXRSZWZyZXNoSGFuZGxlcjpudWxsLGdldEN1cnJlbnRGaWJlcjpudWxsfSkpfSkoe2ZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOnRjLGJ1bmRsZVR5cGU6MCx2ZXJzaW9uOiIxNi4xMy4xIixcbnJlbmRlcmVyUGFja2FnZU5hbWU6InJlYWN0LWRvbSJ9KTtleHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEPWxrO2V4cG9ydHMuY3JlYXRlUG9ydGFsPWtrO2V4cG9ydHMuZmluZERPTU5vZGU9ZnVuY3Rpb24oYSl7aWYobnVsbD09YSlyZXR1cm4gbnVsbDtpZigxPT09YS5ub2RlVHlwZSlyZXR1cm4gYTt2YXIgYj1hLl9yZWFjdEludGVybmFsRmliZXI7aWYodm9pZCAwPT09Yil7aWYoImZ1bmN0aW9uIj09PXR5cGVvZiBhLnJlbmRlcil0aHJvdyBFcnJvcih1KDE4OCkpO3Rocm93IEVycm9yKHUoMjY4LE9iamVjdC5rZXlzKGEpKSk7fWE9aGMoYik7YT1udWxsPT09YT9udWxsOmEuc3RhdGVOb2RlO3JldHVybiBhfTtcbmV4cG9ydHMuZmx1c2hTeW5jPWZ1bmN0aW9uKGEsYil7aWYoKFcmKGZqfGdqKSkhPT1WKXRocm93IEVycm9yKHUoMTg3KSk7dmFyIGM9VztXfD0xO3RyeXtyZXR1cm4gY2coOTksYS5iaW5kKG51bGwsYikpfWZpbmFsbHl7Vz1jLGdnKCl9fTtleHBvcnRzLmh5ZHJhdGU9ZnVuY3Rpb24oYSxiLGMpe2lmKCFnayhiKSl0aHJvdyBFcnJvcih1KDIwMCkpO3JldHVybiBpayhudWxsLGEsYiwhMCxjKX07ZXhwb3J0cy5yZW5kZXI9ZnVuY3Rpb24oYSxiLGMpe2lmKCFnayhiKSl0aHJvdyBFcnJvcih1KDIwMCkpO3JldHVybiBpayhudWxsLGEsYiwhMSxjKX07XG5leHBvcnRzLnVubW91bnRDb21wb25lbnRBdE5vZGU9ZnVuY3Rpb24oYSl7aWYoIWdrKGEpKXRocm93IEVycm9yKHUoNDApKTtyZXR1cm4gYS5fcmVhY3RSb290Q29udGFpbmVyPyhOaihmdW5jdGlvbigpe2lrKG51bGwsbnVsbCxhLCExLGZ1bmN0aW9uKCl7YS5fcmVhY3RSb290Q29udGFpbmVyPW51bGw7YVtPZF09bnVsbH0pfSksITApOiExfTtleHBvcnRzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzPU1qO2V4cG9ydHMudW5zdGFibGVfY3JlYXRlUG9ydGFsPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGtrKGEsYiwyPGFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06bnVsbCl9O1xuZXhwb3J0cy51bnN0YWJsZV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lcj1mdW5jdGlvbihhLGIsYyxkKXtpZighZ2soYykpdGhyb3cgRXJyb3IodSgyMDApKTtpZihudWxsPT1hfHx2b2lkIDA9PT1hLl9yZWFjdEludGVybmFsRmliZXIpdGhyb3cgRXJyb3IodSgzOCkpO3JldHVybiBpayhhLGIsYywhMSxkKX07ZXhwb3J0cy52ZXJzaW9uPSIxNi4xMy4xIjtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcmVhY3QtZG9tL2Nqcy9yZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18peyJ1c2Ugc3RyaWN0IjtldmFsKCJcblxuaWYgKHRydWUpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2Nqcy9zY2hlZHVsZXIucHJvZHVjdGlvbi5taW4uanMgKi8gNzQpO1xufSBlbHNlIHt9XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3NjaGVkdWxlci9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7InVzZSBzdHJpY3QiO2V2YWwoJy8qKiBAbGljZW5zZSBSZWFjdCB2MC4xOS4xXG4gKiBzY2hlZHVsZXIucHJvZHVjdGlvbi5taW4uanNcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG52YXIgZixnLGgsayxsO1xuaWYoInVuZGVmaW5lZCI9PT10eXBlb2Ygd2luZG93fHwiZnVuY3Rpb24iIT09dHlwZW9mIE1lc3NhZ2VDaGFubmVsKXt2YXIgcD1udWxsLHE9bnVsbCx0PWZ1bmN0aW9uKCl7aWYobnVsbCE9PXApdHJ5e3ZhciBhPWV4cG9ydHMudW5zdGFibGVfbm93KCk7cCghMCxhKTtwPW51bGx9Y2F0Y2goYil7dGhyb3cgc2V0VGltZW91dCh0LDApLGI7fX0sdT1EYXRlLm5vdygpO2V4cG9ydHMudW5zdGFibGVfbm93PWZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubm93KCktdX07Zj1mdW5jdGlvbihhKXtudWxsIT09cD9zZXRUaW1lb3V0KGYsMCxhKToocD1hLHNldFRpbWVvdXQodCwwKSl9O2c9ZnVuY3Rpb24oYSxiKXtxPXNldFRpbWVvdXQoYSxiKX07aD1mdW5jdGlvbigpe2NsZWFyVGltZW91dChxKX07az1mdW5jdGlvbigpe3JldHVybiExfTtsPWV4cG9ydHMudW5zdGFibGVfZm9yY2VGcmFtZVJhdGU9ZnVuY3Rpb24oKXt9fWVsc2V7dmFyIHc9d2luZG93LnBlcmZvcm1hbmNlLHg9d2luZG93LkRhdGUsXG55PXdpbmRvdy5zZXRUaW1lb3V0LHo9d2luZG93LmNsZWFyVGltZW91dDtpZigidW5kZWZpbmVkIiE9PXR5cGVvZiBjb25zb2xlKXt2YXIgQT13aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWU7ImZ1bmN0aW9uIiE9PXR5cGVvZiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lJiZjb25zb2xlLmVycm9yKCJUaGlzIGJyb3dzZXIgZG9lc25cJ3Qgc3VwcG9ydCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUuIE1ha2Ugc3VyZSB0aGF0IHlvdSBsb2FkIGEgcG9seWZpbGwgaW4gb2xkZXIgYnJvd3NlcnMuIGh0dHBzOi8vZmIubWUvcmVhY3QtcG9seWZpbGxzIik7ImZ1bmN0aW9uIiE9PXR5cGVvZiBBJiZjb25zb2xlLmVycm9yKCJUaGlzIGJyb3dzZXIgZG9lc25cJ3Qgc3VwcG9ydCBjYW5jZWxBbmltYXRpb25GcmFtZS4gTWFrZSBzdXJlIHRoYXQgeW91IGxvYWQgYSBwb2x5ZmlsbCBpbiBvbGRlciBicm93c2Vycy4gaHR0cHM6Ly9mYi5tZS9yZWFjdC1wb2x5ZmlsbHMiKX1pZigib2JqZWN0Ij09PVxudHlwZW9mIHcmJiJmdW5jdGlvbiI9PT10eXBlb2Ygdy5ub3cpZXhwb3J0cy51bnN0YWJsZV9ub3c9ZnVuY3Rpb24oKXtyZXR1cm4gdy5ub3coKX07ZWxzZXt2YXIgQj14Lm5vdygpO2V4cG9ydHMudW5zdGFibGVfbm93PWZ1bmN0aW9uKCl7cmV0dXJuIHgubm93KCktQn19dmFyIEM9ITEsRD1udWxsLEU9LTEsRj01LEc9MDtrPWZ1bmN0aW9uKCl7cmV0dXJuIGV4cG9ydHMudW5zdGFibGVfbm93KCk+PUd9O2w9ZnVuY3Rpb24oKXt9O2V4cG9ydHMudW5zdGFibGVfZm9yY2VGcmFtZVJhdGU9ZnVuY3Rpb24oYSl7MD5hfHwxMjU8YT9jb25zb2xlLmVycm9yKCJmb3JjZUZyYW1lUmF0ZSB0YWtlcyBhIHBvc2l0aXZlIGludCBiZXR3ZWVuIDAgYW5kIDEyNSwgZm9yY2luZyBmcmFtZXJhdGVzIGhpZ2hlciB0aGFuIDEyNSBmcHMgaXMgbm90IHVuc3VwcG9ydGVkIik6Rj0wPGE/TWF0aC5mbG9vcigxRTMvYSk6NX07dmFyIEg9bmV3IE1lc3NhZ2VDaGFubmVsLEk9SC5wb3J0MjtILnBvcnQxLm9ubWVzc2FnZT1cbmZ1bmN0aW9uKCl7aWYobnVsbCE9PUQpe3ZhciBhPWV4cG9ydHMudW5zdGFibGVfbm93KCk7Rz1hK0Y7dHJ5e0QoITAsYSk/SS5wb3N0TWVzc2FnZShudWxsKTooQz0hMSxEPW51bGwpfWNhdGNoKGIpe3Rocm93IEkucG9zdE1lc3NhZ2UobnVsbCksYjt9fWVsc2UgQz0hMX07Zj1mdW5jdGlvbihhKXtEPWE7Q3x8KEM9ITAsSS5wb3N0TWVzc2FnZShudWxsKSl9O2c9ZnVuY3Rpb24oYSxiKXtFPXkoZnVuY3Rpb24oKXthKGV4cG9ydHMudW5zdGFibGVfbm93KCkpfSxiKX07aD1mdW5jdGlvbigpe3ooRSk7RT0tMX19ZnVuY3Rpb24gSihhLGIpe3ZhciBjPWEubGVuZ3RoO2EucHVzaChiKTthOmZvcig7Oyl7dmFyIGQ9Yy0xPj4+MSxlPWFbZF07aWYodm9pZCAwIT09ZSYmMDxLKGUsYikpYVtkXT1iLGFbY109ZSxjPWQ7ZWxzZSBicmVhayBhfX1mdW5jdGlvbiBMKGEpe2E9YVswXTtyZXR1cm4gdm9pZCAwPT09YT9udWxsOmF9XG5mdW5jdGlvbiBNKGEpe3ZhciBiPWFbMF07aWYodm9pZCAwIT09Yil7dmFyIGM9YS5wb3AoKTtpZihjIT09Yil7YVswXT1jO2E6Zm9yKHZhciBkPTAsZT1hLmxlbmd0aDtkPGU7KXt2YXIgbT0yKihkKzEpLTEsbj1hW21dLHY9bSsxLHI9YVt2XTtpZih2b2lkIDAhPT1uJiYwPksobixjKSl2b2lkIDAhPT1yJiYwPksocixuKT8oYVtkXT1yLGFbdl09YyxkPXYpOihhW2RdPW4sYVttXT1jLGQ9bSk7ZWxzZSBpZih2b2lkIDAhPT1yJiYwPksocixjKSlhW2RdPXIsYVt2XT1jLGQ9djtlbHNlIGJyZWFrIGF9fXJldHVybiBifXJldHVybiBudWxsfWZ1bmN0aW9uIEsoYSxiKXt2YXIgYz1hLnNvcnRJbmRleC1iLnNvcnRJbmRleDtyZXR1cm4gMCE9PWM/YzphLmlkLWIuaWR9dmFyIE49W10sTz1bXSxQPTEsUT1udWxsLFI9MyxTPSExLFQ9ITEsVT0hMTtcbmZ1bmN0aW9uIFYoYSl7Zm9yKHZhciBiPUwoTyk7bnVsbCE9PWI7KXtpZihudWxsPT09Yi5jYWxsYmFjaylNKE8pO2Vsc2UgaWYoYi5zdGFydFRpbWU8PWEpTShPKSxiLnNvcnRJbmRleD1iLmV4cGlyYXRpb25UaW1lLEooTixiKTtlbHNlIGJyZWFrO2I9TChPKX19ZnVuY3Rpb24gVyhhKXtVPSExO1YoYSk7aWYoIVQpaWYobnVsbCE9PUwoTikpVD0hMCxmKFgpO2Vsc2V7dmFyIGI9TChPKTtudWxsIT09YiYmZyhXLGIuc3RhcnRUaW1lLWEpfX1cbmZ1bmN0aW9uIFgoYSxiKXtUPSExO1UmJihVPSExLGgoKSk7Uz0hMDt2YXIgYz1SO3RyeXtWKGIpO2ZvcihRPUwoTik7bnVsbCE9PVEmJighKFEuZXhwaXJhdGlvblRpbWU+Yil8fGEmJiFrKCkpOyl7dmFyIGQ9US5jYWxsYmFjaztpZihudWxsIT09ZCl7US5jYWxsYmFjaz1udWxsO1I9US5wcmlvcml0eUxldmVsO3ZhciBlPWQoUS5leHBpcmF0aW9uVGltZTw9Yik7Yj1leHBvcnRzLnVuc3RhYmxlX25vdygpOyJmdW5jdGlvbiI9PT10eXBlb2YgZT9RLmNhbGxiYWNrPWU6UT09PUwoTikmJk0oTik7VihiKX1lbHNlIE0oTik7UT1MKE4pfWlmKG51bGwhPT1RKXZhciBtPSEwO2Vsc2V7dmFyIG49TChPKTtudWxsIT09biYmZyhXLG4uc3RhcnRUaW1lLWIpO209ITF9cmV0dXJuIG19ZmluYWxseXtRPW51bGwsUj1jLFM9ITF9fVxuZnVuY3Rpb24gWShhKXtzd2l0Y2goYSl7Y2FzZSAxOnJldHVybi0xO2Nhc2UgMjpyZXR1cm4gMjUwO2Nhc2UgNTpyZXR1cm4gMTA3Mzc0MTgyMztjYXNlIDQ6cmV0dXJuIDFFNDtkZWZhdWx0OnJldHVybiA1RTN9fXZhciBaPWw7ZXhwb3J0cy51bnN0YWJsZV9JZGxlUHJpb3JpdHk9NTtleHBvcnRzLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5PTE7ZXhwb3J0cy51bnN0YWJsZV9Mb3dQcmlvcml0eT00O2V4cG9ydHMudW5zdGFibGVfTm9ybWFsUHJpb3JpdHk9MztleHBvcnRzLnVuc3RhYmxlX1Byb2ZpbGluZz1udWxsO2V4cG9ydHMudW5zdGFibGVfVXNlckJsb2NraW5nUHJpb3JpdHk9MjtleHBvcnRzLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrPWZ1bmN0aW9uKGEpe2EuY2FsbGJhY2s9bnVsbH07ZXhwb3J0cy51bnN0YWJsZV9jb250aW51ZUV4ZWN1dGlvbj1mdW5jdGlvbigpe1R8fFN8fChUPSEwLGYoWCkpfTtcbmV4cG9ydHMudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWw9ZnVuY3Rpb24oKXtyZXR1cm4gUn07ZXhwb3J0cy51bnN0YWJsZV9nZXRGaXJzdENhbGxiYWNrTm9kZT1mdW5jdGlvbigpe3JldHVybiBMKE4pfTtleHBvcnRzLnVuc3RhYmxlX25leHQ9ZnVuY3Rpb24oYSl7c3dpdGNoKFIpe2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOnZhciBiPTM7YnJlYWs7ZGVmYXVsdDpiPVJ9dmFyIGM9UjtSPWI7dHJ5e3JldHVybiBhKCl9ZmluYWxseXtSPWN9fTtleHBvcnRzLnVuc3RhYmxlX3BhdXNlRXhlY3V0aW9uPWZ1bmN0aW9uKCl7fTtleHBvcnRzLnVuc3RhYmxlX3JlcXVlc3RQYWludD1aO2V4cG9ydHMudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5PWZ1bmN0aW9uKGEsYil7c3dpdGNoKGEpe2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOmNhc2UgNDpjYXNlIDU6YnJlYWs7ZGVmYXVsdDphPTN9dmFyIGM9UjtSPWE7dHJ5e3JldHVybiBiKCl9ZmluYWxseXtSPWN9fTtcbmV4cG9ydHMudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjaz1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9ZXhwb3J0cy51bnN0YWJsZV9ub3coKTtpZigib2JqZWN0Ij09PXR5cGVvZiBjJiZudWxsIT09Yyl7dmFyIGU9Yy5kZWxheTtlPSJudW1iZXIiPT09dHlwZW9mIGUmJjA8ZT9kK2U6ZDtjPSJudW1iZXIiPT09dHlwZW9mIGMudGltZW91dD9jLnRpbWVvdXQ6WShhKX1lbHNlIGM9WShhKSxlPWQ7Yz1lK2M7YT17aWQ6UCsrLGNhbGxiYWNrOmIscHJpb3JpdHlMZXZlbDphLHN0YXJ0VGltZTplLGV4cGlyYXRpb25UaW1lOmMsc29ydEluZGV4Oi0xfTtlPmQ/KGEuc29ydEluZGV4PWUsSihPLGEpLG51bGw9PT1MKE4pJiZhPT09TChPKSYmKFU/aCgpOlU9ITAsZyhXLGUtZCkpKTooYS5zb3J0SW5kZXg9YyxKKE4sYSksVHx8U3x8KFQ9ITAsZihYKSkpO3JldHVybiBhfTtcbmV4cG9ydHMudW5zdGFibGVfc2hvdWxkWWllbGQ9ZnVuY3Rpb24oKXt2YXIgYT1leHBvcnRzLnVuc3RhYmxlX25vdygpO1YoYSk7dmFyIGI9TChOKTtyZXR1cm4gYiE9PVEmJm51bGwhPT1RJiZudWxsIT09YiYmbnVsbCE9PWIuY2FsbGJhY2smJmIuc3RhcnRUaW1lPD1hJiZiLmV4cGlyYXRpb25UaW1lPFEuZXhwaXJhdGlvblRpbWV8fGsoKX07ZXhwb3J0cy51bnN0YWJsZV93cmFwQ2FsbGJhY2s9ZnVuY3Rpb24oYSl7dmFyIGI9UjtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYz1SO1I9Yjt0cnl7cmV0dXJuIGEuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZpbmFsbHl7Uj1jfX19O1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zY2hlZHVsZXIvY2pzL3NjaGVkdWxlci5wcm9kdWN0aW9uLm1pbi5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoIm1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiAoYXJyKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJyKSA9PSAnW29iamVjdCBBcnJheV0nO1xufTtcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvaXNhcnJheS9pbmRleC5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoJ2Z1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfYXJyYXlXaXRoSG9sZXM7XG5tb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hcnJheVdpdGhIb2xlcy5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoJ2Z1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHtcbiAgdmFyIF9pID0gYXJyID09IG51bGwgPyBudWxsIDogdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07XG5cbiAgaWYgKF9pID09IG51bGwpIHJldHVybjtcbiAgdmFyIF9hcnIgPSBbXTtcbiAgdmFyIF9uID0gdHJ1ZTtcbiAgdmFyIF9kID0gZmFsc2U7XG5cbiAgdmFyIF9zLCBfZTtcblxuICB0cnkge1xuICAgIGZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHtcbiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7XG5cbiAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhaztcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIF9kID0gdHJ1ZTtcbiAgICBfZSA9IGVycjtcbiAgfSBmaW5hbGx5IHtcbiAgICB0cnkge1xuICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChfZCkgdGhyb3cgX2U7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIF9hcnI7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gX2l0ZXJhYmxlVG9BcnJheUxpbWl0O1xubW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvaXRlcmFibGVUb0FycmF5TGltaXQuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoJ3ZhciBhcnJheUxpa2VUb0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9hcnJheUxpa2VUb0FycmF5LmpzICovIDc5KTtcblxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge1xuICBpZiAoIW8pIHJldHVybjtcbiAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIGFycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTtcbiAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO1xuICBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtcbiAgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtcbiAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTtcbm1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmpzPycpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyl7ZXZhbCgnZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtcbiAgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7XG4gICAgYXJyMltpXSA9IGFycltpXTtcbiAgfVxuXG4gIHJldHVybiBhcnIyO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9hcnJheUxpa2VUb0FycmF5O1xubW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXJyYXlMaWtlVG9BcnJheS5qcz8nKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMpe2V2YWwoJ2Z1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IF9ub25JdGVyYWJsZVJlc3Q7XG5tb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9ub25JdGVyYWJsZVJlc3QuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoJ3ZhciBCaXRCeXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi84Qml0Qnl0ZSAqLyA4Mik7XG52YXIgUlNCbG9jayA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vUlNCbG9jayAqLyA4Myk7XG52YXIgQml0QnVmZmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9CaXRCdWZmZXIgKi8gODQpO1xudmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3V0aWwgKi8gODUpO1xudmFyIFBvbHlub21pYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL1BvbHlub21pYWwgKi8gMjYpO1xuXG5mdW5jdGlvbiBRUkNvZGUodHlwZU51bWJlciwgZXJyb3JDb3JyZWN0TGV2ZWwpIHtcblx0dGhpcy50eXBlTnVtYmVyID0gdHlwZU51bWJlcjtcblx0dGhpcy5lcnJvckNvcnJlY3RMZXZlbCA9IGVycm9yQ29ycmVjdExldmVsO1xuXHR0aGlzLm1vZHVsZXMgPSBudWxsO1xuXHR0aGlzLm1vZHVsZUNvdW50ID0gMDtcblx0dGhpcy5kYXRhQ2FjaGUgPSBudWxsO1xuXHR0aGlzLmRhdGFMaXN0ID0gW107XG59XG5cbi8vIGZvciBjbGllbnQgc2lkZSBtaW5pZmljYXRpb25cbnZhciBwcm90byA9IFFSQ29kZS5wcm90b3R5cGU7XG5cbnByb3RvLmFkZERhdGEgPSBmdW5jdGlvbihkYXRhKSB7XG5cdHZhciBuZXdEYXRhID0gbmV3IEJpdEJ5dGUoZGF0YSk7XG5cdHRoaXMuZGF0YUxpc3QucHVzaChuZXdEYXRhKTtcblx0dGhpcy5kYXRhQ2FjaGUgPSBudWxsO1xufTtcblxucHJvdG8uaXNEYXJrID0gZnVuY3Rpb24ocm93LCBjb2wpIHtcblx0aWYgKHJvdyA8IDAgfHwgdGhpcy5tb2R1bGVDb3VudCA8PSByb3cgfHwgY29sIDwgMCB8fCB0aGlzLm1vZHVsZUNvdW50IDw9IGNvbCkge1xuXHRcdHRocm93IG5ldyBFcnJvcihyb3cgKyAiLCIgKyBjb2wpO1xuXHR9XG5cdHJldHVybiB0aGlzLm1vZHVsZXNbcm93XVtjb2xdO1xufTtcblxucHJvdG8uZ2V0TW9kdWxlQ291bnQgPSBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXMubW9kdWxlQ291bnQ7XG59O1xuXG5wcm90by5tYWtlID0gZnVuY3Rpb24oKSB7XG5cdC8vIENhbGN1bGF0ZSBhdXRvbWF0aWNhbGx5IHR5cGVOdW1iZXIgaWYgcHJvdmlkZWQgaXMgPCAxXG5cdGlmICh0aGlzLnR5cGVOdW1iZXIgPCAxICl7XG5cdFx0dmFyIHR5cGVOdW1iZXIgPSAxO1xuXHRcdGZvciAodHlwZU51bWJlciA9IDE7IHR5cGVOdW1iZXIgPCA0MDsgdHlwZU51bWJlcisrKSB7XG5cdFx0XHR2YXIgcnNCbG9ja3MgPSBSU0Jsb2NrLmdldFJTQmxvY2tzKHR5cGVOdW1iZXIsIHRoaXMuZXJyb3JDb3JyZWN0TGV2ZWwpO1xuXG5cdFx0XHR2YXIgYnVmZmVyID0gbmV3IEJpdEJ1ZmZlcigpO1xuXHRcdFx0dmFyIHRvdGFsRGF0YUNvdW50ID0gMDtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcnNCbG9ja3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dG90YWxEYXRhQ291bnQgKz0gcnNCbG9ja3NbaV0uZGF0YUNvdW50O1xuXHRcdFx0fVxuXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGF0YUxpc3QubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dmFyIGRhdGEgPSB0aGlzLmRhdGFMaXN0W2ldO1xuXHRcdFx0XHRidWZmZXIucHV0KGRhdGEubW9kZSwgNCk7XG5cdFx0XHRcdGJ1ZmZlci5wdXQoZGF0YS5nZXRMZW5ndGgoKSwgdXRpbC5nZXRMZW5ndGhJbkJpdHMoZGF0YS5tb2RlLCB0eXBlTnVtYmVyKSApO1xuXHRcdFx0XHRkYXRhLndyaXRlKGJ1ZmZlcik7XG5cdFx0XHR9XG5cdFx0XHRpZiAoYnVmZmVyLmdldExlbmd0aEluQml0cygpIDw9IHRvdGFsRGF0YUNvdW50ICogOClcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdHRoaXMudHlwZU51bWJlciA9IHR5cGVOdW1iZXI7XG5cdH1cblx0dGhpcy5tYWtlSW1wbChmYWxzZSwgdGhpcy5nZXRCZXN0TWFza1BhdHRlcm4oKSApO1xufTtcblxucHJvdG8ubWFrZUltcGwgPSBmdW5jdGlvbih0ZXN0LCBtYXNrUGF0dGVybikge1xuXHRcblx0dGhpcy5tb2R1bGVDb3VudCA9IHRoaXMudHlwZU51bWJlciAqIDQgKyAxNztcblx0dGhpcy5tb2R1bGVzID0gbmV3IEFycmF5KHRoaXMubW9kdWxlQ291bnQpO1xuXHRcblx0Zm9yICh2YXIgcm93ID0gMDsgcm93IDwgdGhpcy5tb2R1bGVDb3VudDsgcm93KyspIHtcblx0XHRcblx0XHR0aGlzLm1vZHVsZXNbcm93XSA9IG5ldyBBcnJheSh0aGlzLm1vZHVsZUNvdW50KTtcblx0XHRcblx0XHRmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLm1vZHVsZUNvdW50OyBjb2wrKykge1xuXHRcdFx0dGhpcy5tb2R1bGVzW3Jvd11bY29sXSA9IG51bGw7Ly8oY29sICsgcm93KSAlIDM7XG5cdFx0fVxuXHR9XG5cblx0dGhpcy5zZXR1cFBvc2l0aW9uUHJvYmVQYXR0ZXJuKDAsIDApO1xuXHR0aGlzLnNldHVwUG9zaXRpb25Qcm9iZVBhdHRlcm4odGhpcy5tb2R1bGVDb3VudCAtIDcsIDApO1xuXHR0aGlzLnNldHVwUG9zaXRpb25Qcm9iZVBhdHRlcm4oMCwgdGhpcy5tb2R1bGVDb3VudCAtIDcpO1xuXHR0aGlzLnNldHVwUG9zaXRpb25BZGp1c3RQYXR0ZXJuKCk7XG5cdHRoaXMuc2V0dXBUaW1pbmdQYXR0ZXJuKCk7XG5cdHRoaXMuc2V0dXBUeXBlSW5mbyh0ZXN0LCBtYXNrUGF0dGVybik7XG5cdFxuXHRpZiAodGhpcy50eXBlTnVtYmVyID49IDcpIHtcblx0XHR0aGlzLnNldHVwVHlwZU51bWJlcih0ZXN0KTtcblx0fVxuXG5cdGlmICh0aGlzLmRhdGFDYWNoZSA9PSBudWxsKSB7XG5cdFx0dGhpcy5kYXRhQ2FjaGUgPSBRUkNvZGUuY3JlYXRlRGF0YSh0aGlzLnR5cGVOdW1iZXIsIHRoaXMuZXJyb3JDb3JyZWN0TGV2ZWwsIHRoaXMuZGF0YUxpc3QpO1xuXHR9XG5cblx0dGhpcy5tYXBEYXRhKHRoaXMuZGF0YUNhY2hlLCBtYXNrUGF0dGVybik7XG59O1xuXG5wcm90by5zZXR1cFBvc2l0aW9uUHJvYmVQYXR0ZXJuID0gZnVuY3Rpb24ocm93LCBjb2wpICB7XG5cdFxuXHRmb3IgKHZhciByID0gLTE7IHIgPD0gNzsgcisrKSB7XG5cdFx0XG5cdFx0aWYgKHJvdyArIHIgPD0gLTEgfHwgdGhpcy5tb2R1bGVDb3VudCA8PSByb3cgKyByKSBjb250aW51ZTtcblx0XHRcblx0XHRmb3IgKHZhciBjID0gLTE7IGMgPD0gNzsgYysrKSB7XG5cdFx0XHRcblx0XHRcdGlmIChjb2wgKyBjIDw9IC0xIHx8IHRoaXMubW9kdWxlQ291bnQgPD0gY29sICsgYykgY29udGludWU7XG5cdFx0XHRcblx0XHRcdGlmICggKDAgPD0gciAmJiByIDw9IDYgJiYgKGMgPT0gMCB8fCBjID09IDYpIClcblx0XHRcdFx0XHR8fCAoMCA8PSBjICYmIGMgPD0gNiAmJiAociA9PSAwIHx8IHIgPT0gNikgKVxuXHRcdFx0XHRcdHx8ICgyIDw9IHIgJiYgciA8PSA0ICYmIDIgPD0gYyAmJiBjIDw9IDQpICkge1xuXHRcdFx0XHR0aGlzLm1vZHVsZXNbcm93ICsgcl1bY29sICsgY10gPSB0cnVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5tb2R1bGVzW3JvdyArIHJdW2NvbCArIGNdID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fVx0XHRcblx0fVx0XHRcbn07XG5cbnByb3RvLmdldEJlc3RNYXNrUGF0dGVybiA9IGZ1bmN0aW9uKCkge1xuXG5cdHZhciBtaW5Mb3N0UG9pbnQgPSAwO1xuXHR2YXIgcGF0dGVybiA9IDA7XG5cblx0Zm9yICh2YXIgaSA9IDA7IGkgPCA4OyBpKyspIHtcblx0XHRcblx0XHR0aGlzLm1ha2VJbXBsKHRydWUsIGkpO1xuXG5cdFx0dmFyIGxvc3RQb2ludCA9IHV0aWwuZ2V0TG9zdFBvaW50KHRoaXMpO1xuXG5cdFx0aWYgKGkgPT0gMCB8fCBtaW5Mb3N0UG9pbnQgPiAgbG9zdFBvaW50KSB7XG5cdFx0XHRtaW5Mb3N0UG9pbnQgPSBsb3N0UG9pbnQ7XG5cdFx0XHRwYXR0ZXJuID0gaTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gcGF0dGVybjtcbn07XG5cbnByb3RvLmNyZWF0ZU1vdmllQ2xpcCA9IGZ1bmN0aW9uKHRhcmdldF9tYywgaW5zdGFuY2VfbmFtZSwgZGVwdGgpIHtcblxuXHR2YXIgcXJfbWMgPSB0YXJnZXRfbWMuY3JlYXRlRW1wdHlNb3ZpZUNsaXAoaW5zdGFuY2VfbmFtZSwgZGVwdGgpO1xuXHR2YXIgY3MgPSAxO1xuXG5cdHRoaXMubWFrZSgpO1xuXG5cdGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IHRoaXMubW9kdWxlcy5sZW5ndGg7IHJvdysrKSB7XG5cdFx0XG5cdFx0dmFyIHkgPSByb3cgKiBjcztcblx0XHRcblx0XHRmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLm1vZHVsZXNbcm93XS5sZW5ndGg7IGNvbCsrKSB7XG5cblx0XHRcdHZhciB4ID0gY29sICogY3M7XG5cdFx0XHR2YXIgZGFyayA9IHRoaXMubW9kdWxlc1tyb3ddW2NvbF07XG5cdFx0XG5cdFx0XHRpZiAoZGFyaykge1xuXHRcdFx0XHRxcl9tYy5iZWdpbkZpbGwoMCwgMTAwKTtcblx0XHRcdFx0cXJfbWMubW92ZVRvKHgsIHkpO1xuXHRcdFx0XHRxcl9tYy5saW5lVG8oeCArIGNzLCB5KTtcblx0XHRcdFx0cXJfbWMubGluZVRvKHggKyBjcywgeSArIGNzKTtcblx0XHRcdFx0cXJfbWMubGluZVRvKHgsIHkgKyBjcyk7XG5cdFx0XHRcdHFyX21jLmVuZEZpbGwoKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0XG5cdHJldHVybiBxcl9tYztcbn07XG5cbnByb3RvLnNldHVwVGltaW5nUGF0dGVybiA9IGZ1bmN0aW9uKCkge1xuXHRcblx0Zm9yICh2YXIgciA9IDg7IHIgPCB0aGlzLm1vZHVsZUNvdW50IC0gODsgcisrKSB7XG5cdFx0aWYgKHRoaXMubW9kdWxlc1tyXVs2XSAhPSBudWxsKSB7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cdFx0dGhpcy5tb2R1bGVzW3JdWzZdID0gKHIgJSAyID09IDApO1xuXHR9XG5cblx0Zm9yICh2YXIgYyA9IDg7IGMgPCB0aGlzLm1vZHVsZUNvdW50IC0gODsgYysrKSB7XG5cdFx0aWYgKHRoaXMubW9kdWxlc1s2XVtjXSAhPSBudWxsKSB7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cdFx0dGhpcy5tb2R1bGVzWzZdW2NdID0gKGMgJSAyID09IDApO1xuXHR9XG59O1xuXG5wcm90by5zZXR1cFBvc2l0aW9uQWRqdXN0UGF0dGVybiA9IGZ1bmN0aW9uKCkge1xuXG5cdHZhciBwb3MgPSB1dGlsLmdldFBhdHRlcm5Qb3NpdGlvbih0aGlzLnR5cGVOdW1iZXIpO1xuXHRcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBwb3MubGVuZ3RoOyBpKyspIHtcblx0XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBwb3MubGVuZ3RoOyBqKyspIHtcblx0XHRcblx0XHRcdHZhciByb3cgPSBwb3NbaV07XG5cdFx0XHR2YXIgY29sID0gcG9zW2pdO1xuXHRcdFx0XG5cdFx0XHRpZiAodGhpcy5tb2R1bGVzW3Jvd11bY29sXSAhPSBudWxsKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRmb3IgKHZhciByID0gLTI7IHIgPD0gMjsgcisrKSB7XG5cdFx0XHRcblx0XHRcdFx0Zm9yICh2YXIgYyA9IC0yOyBjIDw9IDI7IGMrKykge1xuXHRcdFx0XHRcblx0XHRcdFx0XHRpZiAociA9PSAtMiB8fCByID09IDIgfHwgYyA9PSAtMiB8fCBjID09IDJcblx0XHRcdFx0XHRcdFx0fHwgKHIgPT0gMCAmJiBjID09IDApICkge1xuXHRcdFx0XHRcdFx0dGhpcy5tb2R1bGVzW3JvdyArIHJdW2NvbCArIGNdID0gdHJ1ZTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dGhpcy5tb2R1bGVzW3JvdyArIHJdW2NvbCArIGNdID0gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG59O1xuXG5wcm90by5zZXR1cFR5cGVOdW1iZXIgPSBmdW5jdGlvbih0ZXN0KSB7XG5cblx0dmFyIGJpdHMgPSB1dGlsLmdldEJDSFR5cGVOdW1iZXIodGhpcy50eXBlTnVtYmVyKTtcblxuXHRmb3IgKHZhciBpID0gMDsgaSA8IDE4OyBpKyspIHtcblx0XHR2YXIgbW9kID0gKCF0ZXN0ICYmICggKGJpdHMgPj4gaSkgJiAxKSA9PSAxKTtcblx0XHR0aGlzLm1vZHVsZXNbTWF0aC5mbG9vcihpIC8gMyldW2kgJSAzICsgdGhpcy5tb2R1bGVDb3VudCAtIDggLSAzXSA9IG1vZDtcblx0fVxuXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgMTg7IGkrKykge1xuXHRcdHZhciBtb2QgPSAoIXRlc3QgJiYgKCAoYml0cyA+PiBpKSAmIDEpID09IDEpO1xuXHRcdHRoaXMubW9kdWxlc1tpICUgMyArIHRoaXMubW9kdWxlQ291bnQgLSA4IC0gM11bTWF0aC5mbG9vcihpIC8gMyldID0gbW9kO1xuXHR9XG59O1xuXG5wcm90by5zZXR1cFR5cGVJbmZvID0gZnVuY3Rpb24odGVzdCwgbWFza1BhdHRlcm4pIHtcblxuXHR2YXIgZGF0YSA9ICh0aGlzLmVycm9yQ29ycmVjdExldmVsIDw8IDMpIHwgbWFza1BhdHRlcm47XG5cdHZhciBiaXRzID0gdXRpbC5nZXRCQ0hUeXBlSW5mbyhkYXRhKTtcblxuXHQvLyB2ZXJ0aWNhbFx0XHRcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCAxNTsgaSsrKSB7XG5cblx0XHR2YXIgbW9kID0gKCF0ZXN0ICYmICggKGJpdHMgPj4gaSkgJiAxKSA9PSAxKTtcblxuXHRcdGlmIChpIDwgNikge1xuXHRcdFx0dGhpcy5tb2R1bGVzW2ldWzhdID0gbW9kO1xuXHRcdH0gZWxzZSBpZiAoaSA8IDgpIHtcblx0XHRcdHRoaXMubW9kdWxlc1tpICsgMV1bOF0gPSBtb2Q7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubW9kdWxlc1t0aGlzLm1vZHVsZUNvdW50IC0gMTUgKyBpXVs4XSA9IG1vZDtcblx0XHR9XG5cdH1cblxuXHQvLyBob3Jpem9udGFsXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgMTU7IGkrKykge1xuXG5cdFx0dmFyIG1vZCA9ICghdGVzdCAmJiAoIChiaXRzID4+IGkpICYgMSkgPT0gMSk7XG5cdFx0XG5cdFx0aWYgKGkgPCA4KSB7XG5cdFx0XHR0aGlzLm1vZHVsZXNbOF1bdGhpcy5tb2R1bGVDb3VudCAtIGkgLSAxXSA9IG1vZDtcblx0XHR9IGVsc2UgaWYgKGkgPCA5KSB7XG5cdFx0XHR0aGlzLm1vZHVsZXNbOF1bMTUgLSBpIC0gMSArIDFdID0gbW9kO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLm1vZHVsZXNbOF1bMTUgLSBpIC0gMV0gPSBtb2Q7XG5cdFx0fVxuXHR9XG5cblx0Ly8gZml4ZWQgbW9kdWxlXG5cdHRoaXMubW9kdWxlc1t0aGlzLm1vZHVsZUNvdW50IC0gOF1bOF0gPSAoIXRlc3QpO1xufTtcblxucHJvdG8ubWFwRGF0YSA9IGZ1bmN0aW9uKGRhdGEsIG1hc2tQYXR0ZXJuKSB7XG5cdFxuXHR2YXIgaW5jID0gLTE7XG5cdHZhciByb3cgPSB0aGlzLm1vZHVsZUNvdW50IC0gMTtcblx0dmFyIGJpdEluZGV4ID0gNztcblx0dmFyIGJ5dGVJbmRleCA9IDA7XG5cdFxuXHRmb3IgKHZhciBjb2wgPSB0aGlzLm1vZHVsZUNvdW50IC0gMTsgY29sID4gMDsgY29sIC09IDIpIHtcblxuXHRcdGlmIChjb2wgPT0gNikgY29sLS07XG5cblx0XHR3aGlsZSAodHJ1ZSkge1xuXG5cdFx0XHRmb3IgKHZhciBjID0gMDsgYyA8IDI7IGMrKykge1xuXHRcdFx0XHRcblx0XHRcdFx0aWYgKHRoaXMubW9kdWxlc1tyb3ddW2NvbCAtIGNdID09IG51bGwpIHtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHR2YXIgZGFyayA9IGZhbHNlO1xuXG5cdFx0XHRcdFx0aWYgKGJ5dGVJbmRleCA8IGRhdGEubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRkYXJrID0gKCAoIChkYXRhW2J5dGVJbmRleF0gPj4+IGJpdEluZGV4KSAmIDEpID09IDEpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHZhciBtYXNrID0gdXRpbC5nZXRNYXNrKG1hc2tQYXR0ZXJuLCByb3csIGNvbCAtIGMpO1xuXG5cdFx0XHRcdFx0aWYgKG1hc2spIHtcblx0XHRcdFx0XHRcdGRhcmsgPSAhZGFyaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0dGhpcy5tb2R1bGVzW3Jvd11bY29sIC0gY10gPSBkYXJrO1xuXHRcdFx0XHRcdGJpdEluZGV4LS07XG5cblx0XHRcdFx0XHRpZiAoYml0SW5kZXggPT0gLTEpIHtcblx0XHRcdFx0XHRcdGJ5dGVJbmRleCsrO1xuXHRcdFx0XHRcdFx0Yml0SW5kZXggPSA3O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XHRcdFx0XHRcblx0XHRcdHJvdyArPSBpbmM7XG5cblx0XHRcdGlmIChyb3cgPCAwIHx8IHRoaXMubW9kdWxlQ291bnQgPD0gcm93KSB7XG5cdFx0XHRcdHJvdyAtPSBpbmM7XG5cdFx0XHRcdGluYyA9IC1pbmM7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufTtcblxuUVJDb2RlLlBBRDAgPSAweEVDO1xuUVJDb2RlLlBBRDEgPSAweDExO1xuXG5RUkNvZGUuY3JlYXRlRGF0YSA9IGZ1bmN0aW9uKHR5cGVOdW1iZXIsIGVycm9yQ29ycmVjdExldmVsLCBkYXRhTGlzdCkge1xuXHRcblx0dmFyIHJzQmxvY2tzID0gUlNCbG9jay5nZXRSU0Jsb2Nrcyh0eXBlTnVtYmVyLCBlcnJvckNvcnJlY3RMZXZlbCk7XG5cdFxuXHR2YXIgYnVmZmVyID0gbmV3IEJpdEJ1ZmZlcigpO1xuXHRcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhTGlzdC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBkYXRhID0gZGF0YUxpc3RbaV07XG5cdFx0YnVmZmVyLnB1dChkYXRhLm1vZGUsIDQpO1xuXHRcdGJ1ZmZlci5wdXQoZGF0YS5nZXRMZW5ndGgoKSwgdXRpbC5nZXRMZW5ndGhJbkJpdHMoZGF0YS5tb2RlLCB0eXBlTnVtYmVyKSApO1xuXHRcdGRhdGEud3JpdGUoYnVmZmVyKTtcblx0fVxuXG5cdC8vIGNhbGMgbnVtIG1heCBkYXRhLlxuXHR2YXIgdG90YWxEYXRhQ291bnQgPSAwO1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IHJzQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0dG90YWxEYXRhQ291bnQgKz0gcnNCbG9ja3NbaV0uZGF0YUNvdW50O1xuXHR9XG5cblx0aWYgKGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKSA+IHRvdGFsRGF0YUNvdW50ICogOCkge1xuXHRcdHRocm93IG5ldyBFcnJvcigiY29kZSBsZW5ndGggb3ZlcmZsb3cuICgiXG5cdFx0XHQrIGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKVxuXHRcdFx0KyAiPiJcblx0XHRcdCsgIHRvdGFsRGF0YUNvdW50ICogOFxuXHRcdFx0KyAiKSIpO1xuXHR9XG5cblx0Ly8gZW5kIGNvZGVcblx0aWYgKGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKSArIDQgPD0gdG90YWxEYXRhQ291bnQgKiA4KSB7XG5cdFx0YnVmZmVyLnB1dCgwLCA0KTtcblx0fVxuXG5cdC8vIHBhZGRpbmdcblx0d2hpbGUgKGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKSAlIDggIT0gMCkge1xuXHRcdGJ1ZmZlci5wdXRCaXQoZmFsc2UpO1xuXHR9XG5cblx0Ly8gcGFkZGluZ1xuXHR3aGlsZSAodHJ1ZSkge1xuXHRcdFxuXHRcdGlmIChidWZmZXIuZ2V0TGVuZ3RoSW5CaXRzKCkgPj0gdG90YWxEYXRhQ291bnQgKiA4KSB7XG5cdFx0XHRicmVhaztcblx0XHR9XG5cdFx0YnVmZmVyLnB1dChRUkNvZGUuUEFEMCwgOCk7XG5cdFx0XG5cdFx0aWYgKGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKSA+PSB0b3RhbERhdGFDb3VudCAqIDgpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRidWZmZXIucHV0KFFSQ29kZS5QQUQxLCA4KTtcblx0fVxuXG5cdHJldHVybiBRUkNvZGUuY3JlYXRlQnl0ZXMoYnVmZmVyLCByc0Jsb2Nrcyk7XG59O1xuXG5RUkNvZGUuY3JlYXRlQnl0ZXMgPSBmdW5jdGlvbihidWZmZXIsIHJzQmxvY2tzKSB7XG5cblx0dmFyIG9mZnNldCA9IDA7XG5cdFxuXHR2YXIgbWF4RGNDb3VudCA9IDA7XG5cdHZhciBtYXhFY0NvdW50ID0gMDtcblx0XG5cdHZhciBkY2RhdGEgPSBuZXcgQXJyYXkocnNCbG9ja3MubGVuZ3RoKTtcblx0dmFyIGVjZGF0YSA9IG5ldyBBcnJheShyc0Jsb2Nrcy5sZW5ndGgpO1xuXHRcblx0Zm9yICh2YXIgciA9IDA7IHIgPCByc0Jsb2Nrcy5sZW5ndGg7IHIrKykge1xuXG5cdFx0dmFyIGRjQ291bnQgPSByc0Jsb2Nrc1tyXS5kYXRhQ291bnQ7XG5cdFx0dmFyIGVjQ291bnQgPSByc0Jsb2Nrc1tyXS50b3RhbENvdW50IC0gZGNDb3VudDtcblxuXHRcdG1heERjQ291bnQgPSBNYXRoLm1heChtYXhEY0NvdW50LCBkY0NvdW50KTtcblx0XHRtYXhFY0NvdW50ID0gTWF0aC5tYXgobWF4RWNDb3VudCwgZWNDb3VudCk7XG5cdFx0XG5cdFx0ZGNkYXRhW3JdID0gbmV3IEFycmF5KGRjQ291bnQpO1xuXHRcdFxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZGNkYXRhW3JdLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRkY2RhdGFbcl1baV0gPSAweGZmICYgYnVmZmVyLmJ1ZmZlcltpICsgb2Zmc2V0XTtcblx0XHR9XG5cdFx0b2Zmc2V0ICs9IGRjQ291bnQ7XG5cdFx0XG5cdFx0dmFyIHJzUG9seSA9IHV0aWwuZ2V0RXJyb3JDb3JyZWN0UG9seW5vbWlhbChlY0NvdW50KTtcblx0XHR2YXIgcmF3UG9seSA9IG5ldyBQb2x5bm9taWFsKGRjZGF0YVtyXSwgcnNQb2x5LmdldExlbmd0aCgpIC0gMSk7XG5cblx0XHR2YXIgbW9kUG9seSA9IHJhd1BvbHkubW9kKHJzUG9seSk7XG5cdFx0ZWNkYXRhW3JdID0gbmV3IEFycmF5KHJzUG9seS5nZXRMZW5ndGgoKSAtIDEpO1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgZWNkYXRhW3JdLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbW9kSW5kZXggPSBpICsgbW9kUG9seS5nZXRMZW5ndGgoKSAtIGVjZGF0YVtyXS5sZW5ndGg7XG5cdFx0XHRlY2RhdGFbcl1baV0gPSAobW9kSW5kZXggPj0gMCk/IG1vZFBvbHkuZ2V0KG1vZEluZGV4KSA6IDA7XG5cdFx0fVxuXG5cdH1cblx0XG5cdHZhciB0b3RhbENvZGVDb3VudCA9IDA7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgcnNCbG9ja3MubGVuZ3RoOyBpKyspIHtcblx0XHR0b3RhbENvZGVDb3VudCArPSByc0Jsb2Nrc1tpXS50b3RhbENvdW50O1xuXHR9XG5cblx0dmFyIGRhdGEgPSBuZXcgQXJyYXkodG90YWxDb2RlQ291bnQpO1xuXHR2YXIgaW5kZXggPSAwO1xuXG5cdGZvciAodmFyIGkgPSAwOyBpIDwgbWF4RGNDb3VudDsgaSsrKSB7XG5cdFx0Zm9yICh2YXIgciA9IDA7IHIgPCByc0Jsb2Nrcy5sZW5ndGg7IHIrKykge1xuXHRcdFx0aWYgKGkgPCBkY2RhdGFbcl0ubGVuZ3RoKSB7XG5cdFx0XHRcdGRhdGFbaW5kZXgrK10gPSBkY2RhdGFbcl1baV07XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBtYXhFY0NvdW50OyBpKyspIHtcblx0XHRmb3IgKHZhciByID0gMDsgciA8IHJzQmxvY2tzLmxlbmd0aDsgcisrKSB7XG5cdFx0XHRpZiAoaSA8IGVjZGF0YVtyXS5sZW5ndGgpIHtcblx0XHRcdFx0ZGF0YVtpbmRleCsrXSA9IGVjZGF0YVtyXVtpXTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gZGF0YTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUVJDb2RlO1xuXG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3FyLmpzL2xpYi9RUkNvZGUuanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzLF9fd2VicGFja19yZXF1aXJlX18pe2V2YWwoInZhciBtb2RlID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9tb2RlICovIDI0KTtcblxuZnVuY3Rpb24gUVI4Yml0Qnl0ZShkYXRhKSB7XG5cdHRoaXMubW9kZSA9IG1vZGUuTU9ERV84QklUX0JZVEU7XG5cdHRoaXMuZGF0YSA9IGRhdGE7XG59XG5cblFSOGJpdEJ5dGUucHJvdG90eXBlID0ge1xuXG5cdGdldExlbmd0aCA6IGZ1bmN0aW9uKGJ1ZmZlcikge1xuXHRcdHJldHVybiB0aGlzLmRhdGEubGVuZ3RoO1xuXHR9LFxuXHRcblx0d3JpdGUgOiBmdW5jdGlvbihidWZmZXIpIHtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZGF0YS5sZW5ndGg7IGkrKykge1xuXHRcdFx0Ly8gbm90IEpJUyAuLi5cblx0XHRcdGJ1ZmZlci5wdXQodGhpcy5kYXRhLmNoYXJDb2RlQXQoaSksIDgpO1xuXHRcdH1cblx0fVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBRUjhiaXRCeXRlO1xuXG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3FyLmpzL2xpYi84Qml0Qnl0ZS5qcz8iKX0sZnVuY3Rpb24obW9kdWxlLGV4cG9ydHMsX193ZWJwYWNrX3JlcXVpcmVfXyl7ZXZhbCgnLy8gRXJyb3JDb3JyZWN0TGV2ZWxcbnZhciBFQ0wgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL0Vycm9yQ29ycmVjdExldmVsICovIDI1KTtcblxuZnVuY3Rpb24gUVJSU0Jsb2NrKHRvdGFsQ291bnQsIGRhdGFDb3VudCkge1xuXHR0aGlzLnRvdGFsQ291bnQgPSB0b3RhbENvdW50O1xuXHR0aGlzLmRhdGFDb3VudCAgPSBkYXRhQ291bnQ7XG59XG5cblFSUlNCbG9jay5SU19CTE9DS19UQUJMRSA9IFtcblxuXHQvLyBMXG5cdC8vIE1cblx0Ly8gUVxuXHQvLyBIXG5cblx0Ly8gMVxuXHRbMSwgMjYsIDE5XSxcblx0WzEsIDI2LCAxNl0sXG5cdFsxLCAyNiwgMTNdLFxuXHRbMSwgMjYsIDldLFxuXHRcblx0Ly8gMlxuXHRbMSwgNDQsIDM0XSxcblx0WzEsIDQ0LCAyOF0sXG5cdFsxLCA0NCwgMjJdLFxuXHRbMSwgNDQsIDE2XSxcblxuXHQvLyAzXG5cdFsxLCA3MCwgNTVdLFxuXHRbMSwgNzAsIDQ0XSxcblx0WzIsIDM1LCAxN10sXG5cdFsyLCAzNSwgMTNdLFxuXG5cdC8vIDRcdFx0XG5cdFsxLCAxMDAsIDgwXSxcblx0WzIsIDUwLCAzMl0sXG5cdFsyLCA1MCwgMjRdLFxuXHRbNCwgMjUsIDldLFxuXHRcblx0Ly8gNVxuXHRbMSwgMTM0LCAxMDhdLFxuXHRbMiwgNjcsIDQzXSxcblx0WzIsIDMzLCAxNSwgMiwgMzQsIDE2XSxcblx0WzIsIDMzLCAxMSwgMiwgMzQsIDEyXSxcblx0XG5cdC8vIDZcblx0WzIsIDg2LCA2OF0sXG5cdFs0LCA0MywgMjddLFxuXHRbNCwgNDMsIDE5XSxcblx0WzQsIDQzLCAxNV0sXG5cdFxuXHQvLyA3XHRcdFxuXHRbMiwgOTgsIDc4XSxcblx0WzQsIDQ5LCAzMV0sXG5cdFsyLCAzMiwgMTQsIDQsIDMzLCAxNV0sXG5cdFs0LCAzOSwgMTMsIDEsIDQwLCAxNF0sXG5cdFxuXHQvLyA4XG5cdFsyLCAxMjEsIDk3XSxcblx0WzIsIDYwLCAzOCwgMiwgNjEsIDM5XSxcblx0WzQsIDQwLCAxOCwgMiwgNDEsIDE5XSxcblx0WzQsIDQwLCAxNCwgMiwgNDEsIDE1XSxcblx0XG5cdC8vIDlcblx0WzIsIDE0NiwgMTE2XSxcblx0WzMsIDU4LCAzNiwgMiwgNTksIDM3XSxcblx0WzQsIDM2LCAxNiwgNCwgMzcsIDE3XSxcblx0WzQsIDM2LCAxMiwgNCwgMzcsIDEzXSxcblx0XG5cdC8vIDEwXHRcdFxuXHRbMiwgODYsIDY4LCAyLCA4NywgNjldLFxuXHRbNCwgNjksIDQzLCAxLCA3MCwgNDRdLFxuXHRbNiwgNDMsIDE5LCAyLCA0NCwgMjBdLFxuXHRbNiwgNDMsIDE1LCAyLCA0NCwgMTZdLFxuXG5cdC8vIDExXG5cdFs0LCAxMDEsIDgxXSxcblx0WzEsIDgwLCA1MCwgNCwgODEsIDUxXSxcblx0WzQsIDUwLCAyMiwgNCwgNTEsIDIzXSxcblx0WzMsIDM2LCAxMiwgOCwgMzcsIDEzXSxcblxuXHQvLyAxMlxuXHRbMiwgMTE2LCA5MiwgMiwgMTE3LCA5M10sXG5cdFs2LCA1OCwgMzYsIDIsIDU5LCAzN10sXG5cdFs0LCA0NiwgMjAsIDYsIDQ3LCAyMV0sXG5cdFs3LCA0MiwgMTQsIDQsIDQzLCAxNV0sXG5cblx0Ly8gMTNcblx0WzQsIDEzMywgMTA3XSxcblx0WzgsIDU5LCAzNywgMSwgNjAsIDM4XSxcblx0WzgsIDQ0LCAyMCwgNCwgNDUsIDIxXSxcblx0WzEyLCAzMywgMTEsIDQsIDM0LCAxMl0sXG5cblx0Ly8gMTRcblx0WzMsIDE0NSwgMTE1LCAxLCAxNDYsIDExNl0sXG5cdFs0LCA2NCwgNDAsIDUsIDY1LCA0MV0sXG5cdFsxMSwgMzYsIDE2LCA1LCAzNywgMTddLFxuXHRbMTEsIDM2LCAxMiwgNSwgMzcsIDEzXSxcblxuXHQvLyAxNVxuXHRbNSwgMTA5LCA4NywgMSwgMTEwLCA4OF0sXG5cdFs1LCA2NSwgNDEsIDUsIDY2LCA0Ml0sXG5cdFs1LCA1NCwgMjQsIDcsIDU1LCAyNV0sXG5cdFsxMSwgMzYsIDEyXSxcblxuXHQvLyAxNlxuXHRbNSwgMTIyLCA5OCwgMSwgMTIzLCA5OV0sXG5cdFs3LCA3MywgNDUsIDMsIDc0LCA0Nl0sXG5cdFsxNSwgNDMsIDE5LCAyLCA0NCwgMjBdLFxuXHRbMywgNDUsIDE1LCAxMywgNDYsIDE2XSxcblxuXHQvLyAxN1xuXHRbMSwgMTM1LCAxMDcsIDUsIDEzNiwgMTA4XSxcblx0WzEwLCA3NCwgNDYsIDEsIDc1LCA0N10sXG5cdFsxLCA1MCwgMjIsIDE1LCA1MSwgMjNdLFxuXHRbMiwgNDIsIDE0LCAxNywgNDMsIDE1XSxcblxuXHQvLyAxOFxuXHRbNSwgMTUwLCAxMjAsIDEsIDE1MSwgMTIxXSxcblx0WzksIDY5LCA0MywgNCwgNzAsIDQ0XSxcblx0WzE3LCA1MCwgMjIsIDEsIDUxLCAyM10sXG5cdFsyLCA0MiwgMTQsIDE5LCA0MywgMTVdLFxuXG5cdC8vIDE5XG5cdFszLCAxNDEsIDExMywgNCwgMTQyLCAxMTRdLFxuXHRbMywgNzAsIDQ0LCAxMSwgNzEsIDQ1XSxcblx0WzE3LCA0NywgMjEsIDQsIDQ4LCAyMl0sXG5cdFs5LCAzOSwgMTMsIDE2LCA0MCwgMTRdLFxuXG5cdC8vIDIwXG5cdFszLCAxMzUsIDEwNywgNSwgMTM2LCAxMDhdLFxuXHRbMywgNjcsIDQxLCAxMywgNjgsIDQyXSxcblx0WzE1LCA1NCwgMjQsIDUsIDU1LCAyNV0sXG5cdFsxNSwgNDMsIDE1LCAxMCwgNDQsIDE2XSxcblxuXHQvLyAyMVxuXHRbNCwgMTQ0LCAxMTYsIDQsIDE0NSwgMTE3XSxcblx0WzE3LCA2OCwgNDJdLFxuXHRbMTcsIDUwLCAyMiwgNiwgNTEsIDIzXSxcblx0WzE5LCA0NiwgMTYsIDYsIDQ3LCAxN10sXG5cblx0Ly8gMjJcblx0WzIsIDEzOSwgMTExLCA3LCAxNDAsIDExMl0sXG5cdFsxNywgNzQsIDQ2XSxcblx0WzcsIDU0LCAyNCwgMTYsIDU1LCAyNV0sXG5cdFszNCwgMzcsIDEzXSxcblxuXHQvLyAyM1xuXHRbNCwgMTUxLCAxMjEsIDUsIDE1MiwgMTIyXSxcblx0WzQsIDc1LCA0NywgMTQsIDc2LCA0OF0sXG5cdFsxMSwgNTQsIDI0LCAxNCwgNTUsIDI1XSxcblx0WzE2LCA0NSwgMTUsIDE0LCA0NiwgMTZdLFxuXG5cdC8vIDI0XG5cdFs2LCAxNDcsIDExNywgNCwgMTQ4LCAxMThdLFxuXHRbNiwgNzMsIDQ1LCAxNCwgNzQsIDQ2XSxcblx0WzExLCA1NCwgMjQsIDE2LCA1NSwgMjVdLFxuXHRbMzAsIDQ2LCAxNiwgMiwgNDcsIDE3XSxcblxuXHQvLyAyNVxuXHRbOCwgMTMyLCAxMDYsIDQsIDEzMywgMTA3XSxcblx0WzgsIDc1LCA0NywgMTMsIDc2LCA0OF0sXG5cdFs3LCA1NCwgMjQsIDIyLCA1NSwgMjVdLFxuXHRbMjIsIDQ1LCAxNSwgMTMsIDQ2LCAxNl0sXG5cblx0Ly8gMjZcblx0WzEwLCAxNDIsIDExNCwgMiwgMTQzLCAxMTVdLFxuXHRbMTksIDc0LCA0NiwgNCwgNzUsIDQ3XSxcblx0WzI4LCA1MCwgMjIsIDYsIDUxLCAyM10sXG5cdFszMywgNDYsIDE2LCA0LCA0NywgMTddLFxuXG5cdC8vIDI3XG5cdFs4LCAxNTIsIDEyMiwgNCwgMTUzLCAxMjNdLFxuXHRbMjIsIDczLCA0NSwgMywgNzQsIDQ2XSxcblx0WzgsIDUzLCAyMywgMjYsIDU0LCAyNF0sXG5cdFsxMiwgNDUsIDE1LCAyOCwgNDYsIDE2XSxcblxuXHQvLyAyOFxuXHRbMywgMTQ3LCAxMTcsIDEwLCAxNDgsIDExOF0sXG5cdFszLCA3MywgNDUsIDIzLCA3NCwgNDZdLFxuXHRbNCwgNTQsIDI0LCAzMSwgNTUsIDI1XSxcblx0WzExLCA0NSwgMTUsIDMxLCA0NiwgMTZdLFxuXG5cdC8vIDI5XG5cdFs3LCAxNDYsIDExNiwgNywgMTQ3LCAxMTddLFxuXHRbMjEsIDczLCA0NSwgNywgNzQsIDQ2XSxcblx0WzEsIDUzLCAyMywgMzcsIDU0LCAyNF0sXG5cdFsxOSwgNDUsIDE1LCAyNiwgNDYsIDE2XSxcblxuXHQvLyAzMFxuXHRbNSwgMTQ1LCAxMTUsIDEwLCAxNDYsIDExNl0sXG5cdFsxOSwgNzUsIDQ3LCAxMCwgNzYsIDQ4XSxcblx0WzE1LCA1NCwgMjQsIDI1LCA1NSwgMjVdLFxuXHRbMjMsIDQ1LCAxNSwgMjUsIDQ2LCAxNl0sXG5cblx0Ly8gMzFcblx0WzEzLCAxNDUsIDExNSwgMywgMTQ2LCAxMTZdLFxuXHRbMiwgNzQsIDQ2LCAyOSwgNzUsIDQ3XSxcblx0WzQyLCA1NCwgMjQsIDEsIDU1LCAyNV0sXG5cdFsyMywgNDUsIDE1LCAyOCwgNDYsIDE2XSxcblxuXHQvLyAzMlxuXHRbMTcsIDE0NSwgMTE1XSxcblx0WzEwLCA3NCwgNDYsIDIzLCA3NSwgNDddLFxuXHRbMTAsIDU0LCAyNCwgMzUsIDU1LCAyNV0sXG5cdFsxOSwgNDUsIDE1LCAzNSwgNDYsIDE2XSxcblxuXHQvLyAzM1xuXHRbMTcsIDE0NSwgMTE1LCAxLCAxNDYsIDExNl0sXG5cdFsxNCwgNzQsIDQ2LCAyMSwgNzUsIDQ3XSxcblx0WzI5LCA1NCwgMjQsIDE5LCA1NSwgMjVdLFxuXHRbMTEsIDQ1LCAxNSwgNDYsIDQ2LCAxNl0sXG5cblx0Ly8gMzRcblx0WzEzLCAxNDUsIDExNSwgNiwgMTQ2LCAxMTZdLFxuXHRbMTQsIDc0LCA0NiwgMjMsIDc1LCA0N10sXG5cdFs0NCwgNTQsIDI0LCA3LCA1NSwgMjVdLFxuXHRbNTksIDQ2LCAxNiwgMSwgNDcsIDE3XSxcblxuXHQvLyAzNVxuXHRbMTIsIDE1MSwgMTIxLCA3LCAxNTIsIDEyMl0sXG5cdFsxMiwgNzUsIDQ3LCAyNiwgNzYsIDQ4XSxcblx0WzM5LCA1NCwgMjQsIDE0LCA1NSwgMjVdLFxuXHRbMjIsIDQ1LCAxNSwgNDEsIDQ2LCAxNl0sXG5cblx0Ly8gMzZcblx0WzYsIDE1MSwgMTIxLCAxNCwgMTUyLCAxMjJdLFxuXHRbNiwgNzUsIDQ3LCAzNCwgNzYsIDQ4XSxcblx0WzQ2LCA1NCwgMjQsIDEwLCA1NSwgMjVdLFxuXHRbMiwgNDUsIDE1LCA2NCwgNDYsIDE2XSxcblxuXHQvLyAzN1xuXHRbMTcsIDE1MiwgMTIyLCA0LCAxNTMsIDEyM10sXG5cdFsyOSwgNzQsIDQ2LCAxNCwgNzUsIDQ3XSxcblx0WzQ5LCA1NCwgMjQsIDEwLCA1NSwgMjVdLFxuXHRbMjQsIDQ1LCAxNSwgNDYsIDQ2LCAxNl0sXG5cblx0Ly8gMzhcblx0WzQsIDE1MiwgMTIyLCAxOCwgMTUzLCAxMjNdLFxuXHRbMTMsIDc0LCA0NiwgMzIsIDc1LCA0N10sXG5cdFs0OCwgNTQsIDI0LCAxNCwgNTUsIDI1XSxcblx0WzQyLCA0NSwgMTUsIDMyLCA0NiwgMTZdLFxuXG5cdC8vIDM5XG5cdFsyMCwgMTQ3LCAxMTcsIDQsIDE0OCwgMTE4XSxcblx0WzQwLCA3NSwgNDcsIDcsIDc2LCA0OF0sXG5cdFs0MywgNTQsIDI0LCAyMiwgNTUsIDI1XSxcblx0WzEwLCA0NSwgMTUsIDY3LCA0NiwgMTZdLFxuXG5cdC8vIDQwXG5cdFsxOSwgMTQ4LCAxMTgsIDYsIDE0OSwgMTE5XSxcblx0WzE4LCA3NSwgNDcsIDMxLCA3NiwgNDhdLFxuXHRbMzQsIDU0LCAyNCwgMzQsIDU1LCAyNV0sXG5cdFsyMCwgNDUsIDE1LCA2MSwgNDYsIDE2XVxuXTtcblxuUVJSU0Jsb2NrLmdldFJTQmxvY2tzID0gZnVuY3Rpb24odHlwZU51bWJlciwgZXJyb3JDb3JyZWN0TGV2ZWwpIHtcblx0XG5cdHZhciByc0Jsb2NrID0gUVJSU0Jsb2NrLmdldFJzQmxvY2tUYWJsZSh0eXBlTnVtYmVyLCBlcnJvckNvcnJlY3RMZXZlbCk7XG5cdFxuXHRpZiAocnNCbG9jayA9PSB1bmRlZmluZWQpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoImJhZCBycyBibG9jayBAIHR5cGVOdW1iZXI6IiArIHR5cGVOdW1iZXIgKyAiL2Vycm9yQ29ycmVjdExldmVsOiIgKyBlcnJvckNvcnJlY3RMZXZlbCk7XG5cdH1cblxuXHR2YXIgbGVuZ3RoID0gcnNCbG9jay5sZW5ndGggLyAzO1xuXHRcblx0dmFyIGxpc3QgPSBuZXcgQXJyYXkoKTtcblx0XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblxuXHRcdHZhciBjb3VudCA9IHJzQmxvY2tbaSAqIDMgKyAwXTtcblx0XHR2YXIgdG90YWxDb3VudCA9IHJzQmxvY2tbaSAqIDMgKyAxXTtcblx0XHR2YXIgZGF0YUNvdW50ICA9IHJzQmxvY2tbaSAqIDMgKyAyXTtcblxuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY291bnQ7IGorKykge1xuXHRcdFx0bGlzdC5wdXNoKG5ldyBRUlJTQmxvY2sodG90YWxDb3VudCwgZGF0YUNvdW50KSApO1x0XG5cdFx0fVxuXHR9XG5cdFxuXHRyZXR1cm4gbGlzdDtcbn1cblxuUVJSU0Jsb2NrLmdldFJzQmxvY2tUYWJsZSA9IGZ1bmN0aW9uKHR5cGVOdW1iZXIsIGVycm9yQ29ycmVjdExldmVsKSB7XG5cblx0c3dpdGNoKGVycm9yQ29ycmVjdExldmVsKSB7XG5cdGNhc2UgRUNMLkwgOlxuXHRcdHJldHVybiBRUlJTQmxvY2suUlNfQkxPQ0tfVEFCTEVbKHR5cGVOdW1iZXIgLSAxKSAqIDQgKyAwXTtcblx0Y2FzZSBFQ0wuTSA6XG5cdFx0cmV0dXJuIFFSUlNCbG9jay5SU19CTE9DS19UQUJMRVsodHlwZU51bWJlciAtIDEpICogNCArIDFdO1xuXHRjYXNlIEVDTC5RIDpcblx0XHRyZXR1cm4gUVJSU0Jsb2NrLlJTX0JMT0NLX1RBQkxFWyh0eXBlTnVtYmVyIC0gMSkgKiA0ICsgMl07XG5cdGNhc2UgRUNMLkggOlxuXHRcdHJldHVybiBRUlJTQmxvY2suUlNfQkxPQ0tfVEFCTEVbKHR5cGVOdW1iZXIgLSAxKSAqIDQgKyAzXTtcblx0ZGVmYXVsdCA6XG5cdFx0cmV0dXJuIHVuZGVmaW5lZDtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFFSUlNCbG9jaztcblxuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcXIuanMvbGliL1JTQmxvY2suanM/Jyl9LGZ1bmN0aW9uKG1vZHVsZSxleHBvcnRzKXtldmFsKCJmdW5jdGlvbiBRUkJpdEJ1ZmZlcigpIHtcblx0dGhpcy5idWZmZXIgPSBuZXcgQXJyYXkoKTtcblx0dGhpcy5sZW5ndGggPSAwO1xufVxuXG5RUkJpdEJ1ZmZlci5wcm90b3R5cGUgPSB7XG5cblx0Z2V0IDogZnVuY3Rpb24oaW5kZXgpIHtcblx0XHR2YXIgYnVmSW5kZXggPSBNYXRoLmZsb29yKGluZGV4IC8gOCk7XG5cdFx0cmV0dXJuICggKHRoaXMuYnVmZmVyW2J1ZkluZGV4XSA+Pj4gKDcgLSBpbmRleCAlIDgpICkgJiAxKSA9PSAxO1xuXHR9LFxuXHRcblx0cHV0IDogZnVuY3Rpb24obnVtLCBsZW5ndGgpIHtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHR0aGlzLnB1dEJpdCggKCAobnVtID4+PiAobGVuZ3RoIC0gaSAtIDEpICkgJiAxKSA9PSAxKTtcblx0XHR9XG5cdH0sXG5cdFxuXHRnZXRMZW5ndGhJbkJpdHMgOiBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy5sZW5ndGg7XG5cdH0sXG5cdFxuXHRwdXRCaXQgOiBmdW5jdGlvbihiaXQpIHtcblx0XG5cdFx0dmFyIGJ1ZkluZGV4ID0gTWF0aC5mbG9vcih0aGlzLmxlbmd0aCAvIDgpO1xuXHRcdGlmICh0aGlzLmJ1ZmZlci5sZW5ndGggPD0gYnVmSW5kZXgpIHtcblx0XHRcdHRoaXMuYnVmZmVyLnB1c2goMCk7XG5cdFx0fVxuXHRcblx0XHRpZiAoYml0KSB7XG5cdFx0XHR0aGlzLmJ1ZmZlcltidWZJbmRleF0gfD0gKDB4ODAgPj4+ICh0aGlzLmxlbmd0aCAlIDgpICk7XG5cdFx0fVxuXHRcblx0XHR0aGlzLmxlbmd0aCsrO1xuXHR9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFFSQml0QnVmZmVyO1xuXG5cbi8vIyBzb3VyY2VVUkw9d2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9xci5qcy9saWIvQml0QnVmZmVyLmpzPyIpfSxmdW5jdGlvbihtb2R1bGUsZXhwb3J0cyxfX3dlYnBhY2tfcmVxdWlyZV9fKXtldmFsKCd2YXIgTW9kZSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbW9kZSAqLyAyNCk7XG52YXIgUG9seW5vbWlhbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vUG9seW5vbWlhbCAqLyAyNik7XG52YXIgbWF0aCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbWF0aCAqLyAyNyk7XG5cbnZhciBRUk1hc2tQYXR0ZXJuID0ge1xuXHRQQVRURVJOMDAwIDogMCxcblx0UEFUVEVSTjAwMSA6IDEsXG5cdFBBVFRFUk4wMTAgOiAyLFxuXHRQQVRURVJOMDExIDogMyxcblx0UEFUVEVSTjEwMCA6IDQsXG5cdFBBVFRFUk4xMDEgOiA1LFxuXHRQQVRURVJOMTEwIDogNixcblx0UEFUVEVSTjExMSA6IDdcbn07XG5cbnZhciBRUlV0aWwgPSB7XG5cbiAgICBQQVRURVJOX1BPU0lUSU9OX1RBQkxFIDogW1xuXHQgICAgW10sXG5cdCAgICBbNiwgMThdLFxuXHQgICAgWzYsIDIyXSxcblx0ICAgIFs2LCAyNl0sXG5cdCAgICBbNiwgMzBdLFxuXHQgICAgWzYsIDM0XSxcblx0ICAgIFs2LCAyMiwgMzhdLFxuXHQgICAgWzYsIDI0LCA0Ml0sXG5cdCAgICBbNiwgMjYsIDQ2XSxcblx0ICAgIFs2LCAyOCwgNTBdLFxuXHQgICAgWzYsIDMwLCA1NF0sXHRcdFxuXHQgICAgWzYsIDMyLCA1OF0sXG5cdCAgICBbNiwgMzQsIDYyXSxcblx0ICAgIFs2LCAyNiwgNDYsIDY2XSxcblx0ICAgIFs2LCAyNiwgNDgsIDcwXSxcblx0ICAgIFs2LCAyNiwgNTAsIDc0XSxcblx0ICAgIFs2LCAzMCwgNTQsIDc4XSxcblx0ICAgIFs2LCAzMCwgNTYsIDgyXSxcblx0ICAgIFs2LCAzMCwgNTgsIDg2XSxcblx0ICAgIFs2LCAzNCwgNjIsIDkwXSxcblx0ICAgIFs2LCAyOCwgNTAsIDcyLCA5NF0sXG5cdCAgICBbNiwgMjYsIDUwLCA3NCwgOThdLFxuXHQgICAgWzYsIDMwLCA1NCwgNzgsIDEwMl0sXG5cdCAgICBbNiwgMjgsIDU0LCA4MCwgMTA2XSxcblx0ICAgIFs2LCAzMiwgNTgsIDg0LCAxMTBdLFxuXHQgICAgWzYsIDMwLCA1OCwgODYsIDExNF0sXG5cdCAgICBbNiwgMzQsIDYyLCA5MCwgMTE4XSxcblx0ICAgIFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSxcblx0ICAgIFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0sXG5cdCAgICBbNiwgMjYsIDUyLCA3OCwgMTA0LCAxMzBdLFxuXHQgICAgWzYsIDMwLCA1NiwgODIsIDEwOCwgMTM0XSxcblx0ICAgIFs2LCAzNCwgNjAsIDg2LCAxMTIsIDEzOF0sXG5cdCAgICBbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdLFxuXHQgICAgWzYsIDM0LCA2MiwgOTAsIDExOCwgMTQ2XSxcblx0ICAgIFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNiwgMTUwXSxcblx0ICAgIFs2LCAyNCwgNTAsIDc2LCAxMDIsIDEyOCwgMTU0XSxcblx0ICAgIFs2LCAyOCwgNTQsIDgwLCAxMDYsIDEzMiwgMTU4XSxcblx0ICAgIFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSxcblx0ICAgIFs2LCAyNiwgNTQsIDgyLCAxMTAsIDEzOCwgMTY2XSxcblx0ICAgIFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXVxuICAgIF0sXG5cbiAgICBHMTUgOiAoMSA8PCAxMCkgfCAoMSA8PCA4KSB8ICgxIDw8IDUpIHwgKDEgPDwgNCkgfCAoMSA8PCAyKSB8ICgxIDw8IDEpIHwgKDEgPDwgMCksXG4gICAgRzE4IDogKDEgPDwgMTIpIHwgKDEgPDwgMTEpIHwgKDEgPDwgMTApIHwgKDEgPDwgOSkgfCAoMSA8PCA4KSB8ICgxIDw8IDUpIHwgKDEgPDwgMikgfCAoMSA8PCAwKSxcbiAgICBHMTVfTUFTSyA6ICgxIDw8IDE0KSB8ICgxIDw8IDEyKSB8ICgxIDw8IDEwKVx0fCAoMSA8PCA0KSB8ICgxIDw8IDEpLFxuXG4gICAgZ2V0QkNIVHlwZUluZm8gOiBmdW5jdGlvbihkYXRhKSB7XG5cdCAgICB2YXIgZCA9IGRhdGEgPDwgMTA7XG5cdCAgICB3aGlsZSAoUVJVdGlsLmdldEJDSERpZ2l0KGQpIC0gUVJVdGlsLmdldEJDSERpZ2l0KFFSVXRpbC5HMTUpID49IDApIHtcblx0XHQgICAgZCBePSAoUVJVdGlsLkcxNSA8PCAoUVJVdGlsLmdldEJDSERpZ2l0KGQpIC0gUVJVdGlsLmdldEJDSERpZ2l0KFFSVXRpbC5HMTUpICkgKTsgXHRcblx0ICAgIH1cblx0ICAgIHJldHVybiAoIChkYXRhIDw8IDEwKSB8IGQpIF4gUVJVdGlsLkcxNV9NQVNLO1xuICAgIH0sXG5cbiAgICBnZXRCQ0hUeXBlTnVtYmVyIDogZnVuY3Rpb24oZGF0YSkge1xuXHQgICAgdmFyIGQgPSBkYXRhIDw8IDEyO1xuXHQgICAgd2hpbGUgKFFSVXRpbC5nZXRCQ0hEaWdpdChkKSAtIFFSVXRpbC5nZXRCQ0hEaWdpdChRUlV0aWwuRzE4KSA+PSAwKSB7XG5cdFx0ICAgIGQgXj0gKFFSVXRpbC5HMTggPDwgKFFSVXRpbC5nZXRCQ0hEaWdpdChkKSAtIFFSVXRpbC5nZXRCQ0hEaWdpdChRUlV0aWwuRzE4KSApICk7IFx0XG5cdCAgICB9XG5cdCAgICByZXR1cm4gKGRhdGEgPDwgMTIpIHwgZDtcbiAgICB9LFxuXG4gICAgZ2V0QkNIRGlnaXQgOiBmdW5jdGlvbihkYXRhKSB7XG5cblx0ICAgIHZhciBkaWdpdCA9IDA7XG5cblx0ICAgIHdoaWxlIChkYXRhICE9IDApIHtcblx0XHQgICAgZGlnaXQrKztcblx0XHQgICAgZGF0YSA+Pj49IDE7XG5cdCAgICB9XG5cblx0ICAgIHJldHVybiBkaWdpdDtcbiAgICB9LFxuXG4gICAgZ2V0UGF0dGVyblBvc2l0aW9uIDogZnVuY3Rpb24odHlwZU51bWJlcikge1xuXHQgICAgcmV0dXJuIFFSVXRpbC5QQVRURVJOX1BPU0lUSU9OX1RBQkxFW3R5cGVOdW1iZXIgLSAxXTtcbiAgICB9LFxuXG4gICAgZ2V0TWFzayA6IGZ1bmN0aW9uKG1hc2tQYXR0ZXJuLCBpLCBqKSB7XG5cdCAgICBcblx0ICAgIHN3aXRjaCAobWFza1BhdHRlcm4pIHtcblx0XHQgICAgXG5cdCAgICBjYXNlIFFSTWFza1BhdHRlcm4uUEFUVEVSTjAwMCA6IHJldHVybiAoaSArIGopICUgMiA9PSAwO1xuXHQgICAgY2FzZSBRUk1hc2tQYXR0ZXJuLlBBVFRFUk4wMDEgOiByZXR1cm4gaSAlIDIgPT0gMDtcblx0ICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMDEwIDogcmV0dXJuIGogJSAzID09IDA7XG5cdCAgICBjYXNlIFFSTWFza1BhdHRlcm4uUEFUVEVSTjAxMSA6IHJldHVybiAoaSArIGopICUgMyA9PSAwO1xuXHQgICAgY2FzZSBRUk1hc2tQYXR0ZXJuLlBBVFRFUk4xMDAgOiByZXR1cm4gKE1hdGguZmxvb3IoaSAvIDIpICsgTWF0aC5mbG9vcihqIC8gMykgKSAlIDIgPT0gMDtcblx0ICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTAxIDogcmV0dXJuIChpICogaikgJSAyICsgKGkgKiBqKSAlIDMgPT0gMDtcblx0ICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTEwIDogcmV0dXJuICggKGkgKiBqKSAlIDIgKyAoaSAqIGopICUgMykgJSAyID09IDA7XG5cdCAgICBjYXNlIFFSTWFza1BhdHRlcm4uUEFUVEVSTjExMSA6IHJldHVybiAoIChpICogaikgJSAzICsgKGkgKyBqKSAlIDIpICUgMiA9PSAwO1xuXG5cdCAgICBkZWZhdWx0IDpcblx0XHQgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQgbWFza1BhdHRlcm46IiArIG1hc2tQYXR0ZXJuKTtcblx0ICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0RXJyb3JDb3JyZWN0UG9seW5vbWlhbCA6IGZ1bmN0aW9uKGVycm9yQ29ycmVjdExlbmd0aCkge1xuXG5cdCAgICB2YXIgYSA9IG5ldyBQb2x5bm9taWFsKFsxXSwgMCk7XG5cblx0ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JDb3JyZWN0TGVuZ3RoOyBpKyspIHtcblx0XHQgICAgYSA9IGEubXVsdGlwbHkobmV3IFBvbHlub21pYWwoWzEsIG1hdGguZ2V4cChpKV0sIDApICk7XG5cdCAgICB9XG5cblx0ICAgIHJldHVybiBhO1xuICAgIH0sXG5cbiAgICBnZXRMZW5ndGhJbkJpdHMgOiBmdW5jdGlvbihtb2RlLCB0eXBlKSB7XG5cblx0ICAgIGlmICgxIDw9IHR5cGUgJiYgdHlwZSA8IDEwKSB7XG5cblx0XHQgICAgLy8gMSAtIDlcblxuXHRcdCAgICBzd2l0Y2gobW9kZSkge1xuXHRcdCAgICBjYXNlIE1vZGUuTU9ERV9OVU1CRVIgXHQ6IHJldHVybiAxMDtcblx0XHQgICAgY2FzZSBNb2RlLk1PREVfQUxQSEFfTlVNIFx0OiByZXR1cm4gOTtcblx0XHQgICAgY2FzZSBNb2RlLk1PREVfOEJJVF9CWVRFXHQ6IHJldHVybiA4O1xuXHRcdCAgICBjYXNlIE1vZGUuTU9ERV9LQU5KSSAgXHQ6IHJldHVybiA4O1xuXHRcdCAgICBkZWZhdWx0IDpcblx0XHRcdCAgICB0aHJvdyBuZXcgRXJyb3IoIm1vZGU6IiArIG1vZGUpO1xuXHRcdCAgICB9XG5cblx0ICAgIH0gZWxzZSBpZiAodHlwZSA8IDI3KSB7XG5cblx0XHQgICAgLy8gMTAgLSAyNlxuXG5cdFx0ICAgIHN3aXRjaChtb2RlKSB7XG5cdFx0ICAgIGNhc2UgTW9kZS5NT0RFX05VTUJFUiBcdDogcmV0dXJuIDEyO1xuXHRcdCAgICBjYXNlIE1vZGUuTU9ERV9BTFBIQV9OVU0gXHQ6IHJldHVybiAxMTtcblx0XHQgICAgY2FzZSBNb2RlLk1PREVfOEJJVF9CWVRFXHQ6IHJldHVybiAxNjtcblx0XHQgICAgY2FzZSBNb2RlLk1PREVfS0FOSkkgIFx0OiByZXR1cm4gMTA7XG5cdFx0ICAgIGRlZmF1bHQgOlxuXHRcdFx0ICAgIHRocm93IG5ldyBFcnJvcigibW9kZToiICsgbW9kZSk7XG5cdFx0ICAgIH1cblxuXHQgICAgfSBlbHNlIGlmICh0eXBlIDwgNDEpIHtcblxuXHRcdCAgICAvLyAyNyAtIDQwXG5cblx0XHQgICAgc3dpdGNoKG1vZGUpIHtcblx0XHQgICAgY2FzZSBNb2RlLk1PREVfTlVNQkVSIFx0OiByZXR1cm4gMTQ7XG5cdFx0ICAgIGNhc2UgTW9kZS5NT0RFX0FMUEhBX05VTVx0OiByZXR1cm4gMTM7XG5cdFx0ICAgIGNhc2UgTW9kZS5NT0RFXzhCSVRfQllURVx0OiByZXR1cm4gMTY7XG5cdFx0ICAgIGNhc2UgTW9kZS5NT0RFX0tBTkpJICBcdDogcmV0dXJuIDEyO1xuXHRcdCAgICBkZWZhdWx0IDpcblx0XHRcdCAgICB0aHJvdyBuZXcgRXJyb3IoIm1vZGU6IiArIG1vZGUpO1xuXHRcdCAgICB9XG5cblx0ICAgIH0gZWxzZSB7XG5cdFx0ICAgIHRocm93IG5ldyBFcnJvcigidHlwZToiICsgdHlwZSk7XG5cdCAgICB9XG4gICAgfSxcblxuICAgIGdldExvc3RQb2ludCA6IGZ1bmN0aW9uKHFyQ29kZSkge1xuXHQgICAgXG5cdCAgICB2YXIgbW9kdWxlQ291bnQgPSBxckNvZGUuZ2V0TW9kdWxlQ291bnQoKTtcblx0ICAgIFxuXHQgICAgdmFyIGxvc3RQb2ludCA9IDA7XG5cdCAgICBcblx0ICAgIC8vIExFVkVMMVxuXHQgICAgXG5cdCAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudDsgcm93KyspIHtcblxuXHRcdCAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBtb2R1bGVDb3VudDsgY29sKyspIHtcblxuXHRcdFx0ICAgIHZhciBzYW1lQ291bnQgPSAwO1xuXHRcdFx0ICAgIHZhciBkYXJrID0gcXJDb2RlLmlzRGFyayhyb3csIGNvbCk7XG5cblx0XHRcdFx0Zm9yICh2YXIgciA9IC0xOyByIDw9IDE7IHIrKykge1xuXG5cdFx0XHRcdCAgICBpZiAocm93ICsgciA8IDAgfHwgbW9kdWxlQ291bnQgPD0gcm93ICsgcikge1xuXHRcdFx0XHRcdCAgICBjb250aW51ZTtcblx0XHRcdFx0ICAgIH1cblxuXHRcdFx0XHQgICAgZm9yICh2YXIgYyA9IC0xOyBjIDw9IDE7IGMrKykge1xuXG5cdFx0XHRcdFx0ICAgIGlmIChjb2wgKyBjIDwgMCB8fCBtb2R1bGVDb3VudCA8PSBjb2wgKyBjKSB7XG5cdFx0XHRcdFx0XHQgICAgY29udGludWU7XG5cdFx0XHRcdFx0ICAgIH1cblxuXHRcdFx0XHRcdCAgICBpZiAociA9PSAwICYmIGMgPT0gMCkge1xuXHRcdFx0XHRcdFx0ICAgIGNvbnRpbnVlO1xuXHRcdFx0XHRcdCAgICB9XG5cblx0XHRcdFx0XHQgICAgaWYgKGRhcmsgPT0gcXJDb2RlLmlzRGFyayhyb3cgKyByLCBjb2wgKyBjKSApIHtcblx0XHRcdFx0XHRcdCAgICBzYW1lQ291bnQrKztcblx0XHRcdFx0XHQgICAgfVxuXHRcdFx0XHQgICAgfVxuXHRcdFx0ICAgIH1cblxuXHRcdFx0ICAgIGlmIChzYW1lQ291bnQgPiA1KSB7XG5cdFx0XHRcdCAgICBsb3N0UG9pbnQgKz0gKDMgKyBzYW1lQ291bnQgLSA1KTtcblx0XHRcdCAgICB9XG5cdFx0ICAgIH1cblx0ICAgIH1cblxuXHQgICAgLy8gTEVWRUwyXG5cblx0ICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IG1vZHVsZUNvdW50IC0gMTsgcm93KyspIHtcblx0XHQgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbW9kdWxlQ291bnQgLSAxOyBjb2wrKykge1xuXHRcdFx0ICAgIHZhciBjb3VudCA9IDA7XG5cdFx0XHQgICAgaWYgKHFyQ29kZS5pc0Rhcmsocm93LCAgICAgY29sICAgICkgKSBjb3VudCsrO1xuXHRcdFx0ICAgIGlmIChxckNvZGUuaXNEYXJrKHJvdyArIDEsIGNvbCAgICApICkgY291bnQrKztcblx0XHRcdCAgICBpZiAocXJDb2RlLmlzRGFyayhyb3csICAgICBjb2wgKyAxKSApIGNvdW50Kys7XG5cdFx0XHQgICAgaWYgKHFyQ29kZS5pc0Rhcmsocm93ICsgMSwgY29sICsgMSkgKSBjb3VudCsrO1xuXHRcdFx0ICAgIGlmIChjb3VudCA9PSAwIHx8IGNvdW50ID09IDQpIHtcblx0XHRcdFx0ICAgIGxvc3RQb2ludCArPSAzO1xuXHRcdFx0ICAgIH1cblx0XHQgICAgfVxuXHQgICAgfVxuXG5cdCAgICAvLyBMRVZFTDNcblxuXHQgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbW9kdWxlQ291bnQ7IHJvdysrKSB7XG5cdFx0ICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG1vZHVsZUNvdW50IC0gNjsgY29sKyspIHtcblx0XHRcdCAgICBpZiAocXJDb2RlLmlzRGFyayhyb3csIGNvbClcblx0XHRcdFx0XHQgICAgJiYgIXFyQ29kZS5pc0Rhcmsocm93LCBjb2wgKyAxKVxuXHRcdFx0XHRcdCAgICAmJiAgcXJDb2RlLmlzRGFyayhyb3csIGNvbCArIDIpXG5cdFx0XHRcdFx0ICAgICYmICBxckNvZGUuaXNEYXJrKHJvdywgY29sICsgMylcblx0XHRcdFx0XHQgICAgJiYgIHFyQ29kZS5pc0Rhcmsocm93LCBjb2wgKyA0KVxuXHRcdFx0XHRcdCAgICAmJiAhcXJDb2RlLmlzRGFyayhyb3csIGNvbCArIDUpXG5cdFx0XHRcdFx0ICAgICYmICBxckNvZGUuaXNEYXJrKHJvdywgY29sICsgNikgKSB7XG5cdFx0XHRcdCAgICBsb3N0UG9pbnQgKz0gNDA7XG5cdFx0XHQgICAgfVxuXHRcdCAgICB9XG5cdCAgICB9XG5cblx0ICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG1vZHVsZUNvdW50OyBjb2wrKykge1xuXHRcdCAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudCAtIDY7IHJvdysrKSB7XG5cdFx0XHQgICAgaWYgKHFyQ29kZS5pc0Rhcmsocm93LCBjb2wpXG5cdFx0XHRcdFx0ICAgICYmICFxckNvZGUuaXNEYXJrKHJvdyArIDEsIGNvbClcblx0XHRcdFx0XHQgICAgJiYgIHFyQ29kZS5pc0Rhcmsocm93ICsgMiwgY29sKVxuXHRcdFx0XHRcdCAgICAmJiAgcXJDb2RlLmlzRGFyayhyb3cgKyAzLCBjb2wpXG5cdFx0XHRcdFx0ICAgICYmICBxckNvZGUuaXNEYXJrKHJvdyArIDQsIGNvbClcblx0XHRcdFx0XHQgICAgJiYgIXFyQ29kZS5pc0Rhcmsocm93ICsgNSwgY29sKVxuXHRcdFx0XHRcdCAgICAmJiAgcXJDb2RlLmlzRGFyayhyb3cgKyA2LCBjb2wpICkge1xuXHRcdFx0XHQgICAgbG9zdFBvaW50ICs9IDQwO1xuXHRcdFx0ICAgIH1cblx0XHQgICAgfVxuXHQgICAgfVxuXG5cdCAgICAvLyBMRVZFTDRcblx0ICAgIFxuXHQgICAgdmFyIGRhcmtDb3VudCA9IDA7XG5cblx0ICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG1vZHVsZUNvdW50OyBjb2wrKykge1xuXHRcdCAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudDsgcm93KyspIHtcblx0XHRcdCAgICBpZiAocXJDb2RlLmlzRGFyayhyb3csIGNvbCkgKSB7XG5cdFx0XHRcdCAgICBkYXJrQ291bnQrKztcblx0XHRcdCAgICB9XG5cdFx0ICAgIH1cblx0ICAgIH1cblx0ICAgIFxuXHQgICAgdmFyIHJhdGlvID0gTWF0aC5hYnMoMTAwICogZGFya0NvdW50IC8gbW9kdWxlQ291bnQgLyBtb2R1bGVDb3VudCAtIDUwKSAvIDU7XG5cdCAgICBsb3N0UG9pbnQgKz0gcmF0aW8gKiAxMDtcblxuXHQgICAgcmV0dXJuIGxvc3RQb2ludDtcdFx0XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBRUlV0aWw7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3FyLmpzL2xpYi91dGlsLmpzPycpfSxmdW5jdGlvbihtb2R1bGUpe2V2YWwoJ21vZHVsZS5leHBvcnRzID0gSlNPTi5wYXJzZSgie1xcImdsb2JhbHNcXCI6e1xcImNvbG9yXFwiOlxcIiM5MDkwOTBcXCIsXFwiYmFja2dyb3VuZFxcIjpcXCIjZmZmZmZmXFwiLFxcImJvcmRlclxcIjpcXCJyZ2JhKDE0NCwxNDQsMTQ0LDAuMTUpXFwiLFxcInNoYWRvd1xcIjpcXCJyZ2JhKDAsMCwwLDAuMzIpXFwifSxcXCJidXR0b25fZ2xvd19ib3JkZXJcXCI6e1xcImJvcmRlclxcIjpcXCIjZGNkY2RjXFwiLFxcImJhY2tncm91bmRcXCI6XFwiI2Y1ZjVmNVxcIixcXCJjb2xvclxcIjpcXCIjNDQ0O1xcIixcXCJob3Zlcl9ib3JkZXJcXCI6XFwiI2M2YzZjNlxcIixcXCJob3Zlcl9iYWNrZ3JvdW5kXFwiOlxcIiNmOGY4ZjhcXCIsXFwiaG92ZXJfYm94X3NoYWRvd1xcIjpcXCIwcHggMXB4IDFweCByZ2JhKDAsMCwwLDAuMSlcXCIsXFwiaG92ZXJfY29sb3JcXCI6XFwiIzIyMlxcIixcXCJhY3RpdmVfYm9yZGVyXFwiOlxcIiNjNmM2YzZcXCIsXFwiYWN0aXZlX2JhY2tncm91bmRcXCI6XFwiI2Y2ZjZmNlxcIixcXCJhY3RpdmVfYm94X3NoYWRvd1xcIjpcXCIwcHggMHB4IDFweCAycHggcmdiYSgwLDAsMCwwLjEpXFwiLFxcImFjdGl2ZV9jb2xvclxcIjpcXCIjMzMzXFwifSxcXCJidXR0b25fc29saWRcXCI6e1xcImJhY2tncm91bmRcXCI6XFwiIzc0OTJlN1xcIixcXCJjb2xvclxcIjpcXCIjZmZmZmZmXFwiLFxcImhvdmVyX2JhY2tncm91bmRcXCI6XFwiIzRmNzBkMFxcIixcXCJob3Zlcl9jb2xvclxcIjpcXCIjZmZmZmZmXFwifSxcXCJpY29uX2J1dHRvblxcIjp7XFwiY29sb3JcXCI6XFwiIzkwOTA5MFxcIixcXCJob3ZlclxcIjpcXCIjZmNiNjNiXFwifSxcXCJyYWRpb19idXR0b25cXCI6e1xcImNvbG9yXFwiOlxcIiM5MDkwOTBcXCIsXFwiYmFja2dyb3VuZFxcIjpcXCJyZ2JhKDAsMCwwLDApXFwiLFxcImJvcmRlclxcIjpcXCIjNzk3ODc4XFwiLFxcImNoZWNrbWFya1xcIjpcXCIjNzk3ODc4XFwifSxcXCJjaGVja2JveFxcIjp7XFwiY29sb3JcXCI6XFwiIzkwOTA5MFxcIixcXCJiYWNrZ3JvdW5kXFwiOlxcInJnYmEoMCwwLDAsMClcXCIsXFwiYm9yZGVyXFwiOlxcIiM3OTc4NzhcXCIsXFwiY2hlY2ttYXJrXFwiOlxcIiM3OTc4NzhcXCJ9LFxcInNwaW5uZXJcXCI6XFwiIzUzN2RmYlxcIixcXCJub3RpZmljYXRpb25cXCI6e1xcImJhY2tncm91bmRcXCI6XFwiI2ZmZmZmZlxcIixcXCJib3JkZXJcXCI6XFwiIzRmNGQ0ZFxcIixcXCJib3JkZXJfdG9wXFwiOlxcIiNkM2QyZDJcXCIsXFwiY2xvc2VfYnV0dG9uXFwiOlxcIiM2ZjZlNmVcXCIsXFwiaWNvblxcIjpcXCIjZmZiYTdkXFwiLFxcIm1lc3NhZ2VcXCI6XFwiIzFmMWYxZlxcIixcXCJkZXNjcmlwdGlvblxcIjpcXCIjMDAwMDAwXFwiLFxcImJ1dHRvbl91bmRlcmxpbmVcXCI6e1xcImNvbG9yXFwiOlxcIiM0ZjRkNGRcXCIsXFwiaG92ZXJcXCI6XFwiIzFmMWYxZlxcIn19LFxcInRvb2x0aXBcXCI6e1xcImNvbG9yXFwiOlxcIiM3ZjdmN2ZcXCIsXFwiYmFja2dyb3VuZFxcIjpcXCJyZ2JhKDI1NSwyNTUsMjU1LDAuOSlcXCIsXFwiYm9yZGVyXFwiOlxcInJnYmEoMTQ0LDE0NCwxNDQsMC45KVxcIn0sXFwic2Nyb2xsYmFyXFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiNmZmZmZmZcXCIsXFwiYmFja2dyb3VuZF9maXJlZm94XFwiOlxcIiNlNmVjZmNcXCIsXFwiYm9yZGVyXFwiOlxcIiNjNWM1YzVcXCIsXFwidGh1bWJcXCI6XFwiI2E4YThhOFxcIn0sXFwicHJvZ3Jlc3NfYmFyXFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiM4MDgwODBcXCIsXFwicHJvZ3Jlc3NcXCI6XFwiIzg0YjA4MlxcIixcXCJjYW5jZWxcXCI6XFwiI2ZkNzE3MVxcIn0sXFwiYWNjb3JkaW9uXFwiOntcXCJoZWFkZXJcXCI6e1xcImJhY2tncm91bmRcXCI6XFwiI2U2ZWNmY1xcIixcXCJjb2xvclxcIjpcXCIjNmY5MWYwXFwifSxcXCJjb250ZW50XFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiNmOWZhZmVcXCIsXFwiY29sb3JcXCI6XFwiIzkwOTA5MFxcIixcXCJoeXBlcmxpbmtcXCI6e1xcImNvbG9yXFwiOlxcIiM5MDkwOTBcXCIsXFwiaG92ZXJcXCI6XFwiIzZmOTFmMFxcIn19fSxcXCJoZWFkZXJcXCI6XFwiIzU4NTY1NlxcIixcXCJmb290ZXJfYm9yZGVyX3RvcFxcIjpcXCIjY2RjZGNkXFwiLFxcImZvcm1hdHNfdGFibGVcXCI6e1xcImNvbG9yXFwiOlxcIiM3OTc4NzhcXCIsXFwicm93X2JvcmRlclxcIjpcXCIjY2RjZGNkXFwiLFxcInJvd19ob3Zlcl9iYWNrZ3JvdW5kXFwiOlxcInJnYmEoMjU1LDE2MiwwLDAuMSlcXCIsXFwibWVkaWFfdHlwZV9pY29uXFwiOlxcIiNmZmEyMDBcXCIsXFwidmlkZW9faWNvblxcIjpcXCIjYThhOGE4XFwiLFxcInNlcnZpY2VfaWNvblxcIjp7XFwiY29sb3JcXCI6XFwiIzg3YTVmY1xcIixcXCJob3ZlclxcIjpcXCIjNTM3ZGZiXFwifX0sXFwicXJfY29kZVxcIjp7XFwiY29sb3JcXCI6XFwiIzU4NTY1NlxcIixcXCJlcnJvclxcIjpcXCIjZmY2Njc1XFwifSxcXCJhZHZlcnRcXCI6e1xcInRpdGxlX2NvbG9yXFwiOlxcIiM3NDkyZTdcXCIsXFwiY29sb3JcXCI6XFwiIzAwMDAwMFxcIixcXCJudW1fY29sb3JcXCI6XFwiIzc0OTJlN1xcIixcXCJmaWd1cmVcXCI6XFwiI2Q0ZTJmY1xcIixcXCJmaWd1cmVfYm9yZGVyXFwiOlxcIiNkZmU5ZmRcXCIsXFwiZmlndXJlX251bV9jb2xvclxcIjpcXCIjNzQ5MmU3XFwiLFxcImJ1dHRvbl9jYW5jZWxcXCI6e1xcImNvbG9yXFwiOlxcIiNhOGE4YThcXCIsXFwiaG92ZXJcXCI6XFwiIzc5Nzg3OFxcIn19fSIpO1xuXG4vLyMgc291cmNlVVJMPXdlYnBhY2s6Ly8vLi9zcmMvd2lkZ2V0L3RoZW1lcy9saWdodC5qc29uPycpfSxmdW5jdGlvbihtb2R1bGUpe2V2YWwoJ21vZHVsZS5leHBvcnRzID0gSlNPTi5wYXJzZSgie1xcImdsb2JhbHNcXCI6e1xcImNvbG9yXFwiOlxcIiM5MDkwOTBcXCIsXFwiYmFja2dyb3VuZFxcIjpcXCIjMTgxODE4XFwiLFxcImJvcmRlclxcIjpcXCIjNzM3MzczXFwiLFxcInNoYWRvd1xcIjpcXCJyZ2JhKDE1MiwxNTAsMTUwLDAuMjApXFwifSxcXCJidXR0b25fZ2xvd19ib3JkZXJcXCI6e1xcImJvcmRlclxcIjpcXCIjOTA5MDkwXFwiLFxcImJhY2tncm91bmRcXCI6XFwiI2Y1ZjVmNVxcIixcXCJjb2xvclxcIjpcXCIjNDQ0NDQ0XFwiLFxcImhvdmVyX2JvcmRlclxcIjpcXCIjNjA1ZjVmXFwiLFxcImhvdmVyX2JhY2tncm91bmRcXCI6XFwiI2Y4ZjhmOFxcIixcXCJob3Zlcl9ib3hfc2hhZG93XFwiOlxcIjBweCAxcHggMXB4IHJnYmEoMjU1LDI1NSwyNTUsMC4xKVxcIixcXCJob3Zlcl9jb2xvclxcIjpcXCIjMjIyMjIyXFwiLFxcImFjdGl2ZV9ib3JkZXJcXCI6XFwiI2M2YzZjNlxcIixcXCJhY3RpdmVfYmFja2dyb3VuZFxcIjpcXCIjZjZmNmY2XFwiLFxcImFjdGl2ZV9ib3hfc2hhZG93XFwiOlxcIjBweCAwcHggMXB4IDJweCByZ2JhKDI1NSwyNTUsMjU1LDAuMSlcXCIsXFwiYWN0aXZlX2NvbG9yXFwiOlxcIiMzMzMzMzNcXCJ9LFxcImJ1dHRvbl9zb2xpZFxcIjp7XFwiYmFja2dyb3VuZFxcIjpcXCIjZjVmNWY1XFwiLFxcImNvbG9yXFwiOlxcIiM0NDQ0NDRcXCIsXFwiaG92ZXJfYmFja2dyb3VuZFxcIjpcXCIjZjhmOGY4XFwiLFxcImhvdmVyX2NvbG9yXFwiOlxcIiMyMjIyMjJcXCJ9LFxcImljb25fYnV0dG9uXFwiOntcXCJjb2xvclxcIjpcXCIjYWVhZWFlXFwiLFxcImhvdmVyXFwiOlxcIiM1MzdkZmJcXCJ9LFxcInJhZGlvX2J1dHRvblxcIjp7XFwiY29sb3JcXCI6XFwiIzkwOTA5MFxcIixcXCJiYWNrZ3JvdW5kXFwiOlxcInJnYmEoMCwwLDAsMClcXCIsXFwiYm9yZGVyXFwiOlxcIiNlOGU2ZTZcXCIsXFwiY2hlY2ttYXJrXFwiOlxcIiNlOGU2ZTZcXCJ9LFxcImNoZWNrYm94XFwiOntcXCJjb2xvclxcIjpcXCIjOTA5MDkwXFwiLFxcImJhY2tncm91bmRcXCI6XFwicmdiYSgwLDAsMCwwKVxcIixcXCJib3JkZXJcXCI6XFwiI2U4ZTZlNlxcIixcXCJjaGVja21hcmtcXCI6XFwiI2U4ZTZlNlxcIn0sXFwic3Bpbm5lclxcIjpcXCIjNTM3ZGZiXFwiLFxcIm5vdGlmaWNhdGlvblxcIjp7XFwiYmFja2dyb3VuZFxcIjpcXCIjMWYxZjFmXFwiLFxcImJvcmRlclxcIjpcXCIjNGY0ZDRkXFwiLFxcImJvcmRlcl90b3BcXCI6XFwiIzU3NTc1N1xcIixcXCJjbG9zZV9idXR0b25cXCI6XFwiI2Q2ZDZkNlxcIixcXCJpY29uXFwiOlxcIiM5MTkxOTFcXCIsXFwibWVzc2FnZVxcIjpcXCIjZmZmZmZmXFwiLFxcImRlc2NyaXB0aW9uXFwiOlxcIiNmZmZmZmZcXCIsXFwiYnV0dG9uX3VuZGVybGluZVxcIjp7XFwiY29sb3JcXCI6XFwiIzkxOTE5MVxcIixcXCJob3ZlclxcIjpcXCIjZDZkNmQ2XFwifX0sXFwidG9vbHRpcFxcIjp7XFwiY29sb3JcXCI6XFwiI2ZmZmZmZlxcIixcXCJiYWNrZ3JvdW5kXFwiOlxcInJnYmEoMjQsMjQsMjQsMC45KVxcIixcXCJib3JkZXJcXCI6XFwiIzczNzM3M1xcIn0sXFwic2Nyb2xsYmFyXFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiMxODE4MThcXCIsXFwiYmFja2dyb3VuZF9maXJlZm94XFwiOlxcIiMyYzJjMmNcXCIsXFwiYm9yZGVyXFwiOlxcIiM3MzczNzNcXCIsXFwidGh1bWJcXCI6XFwiI2E4YThhOFxcIn0sXFwicHJvZ3Jlc3NfYmFyXFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiM4MDgwODBcXCIsXFwicHJvZ3Jlc3NcXCI6XFwiIzg0YjA4MlxcIixcXCJjYW5jZWxcXCI6XFwiI2ZkNzE3MVxcIn0sXFwiYWNjb3JkaW9uXFwiOntcXCJoZWFkZXJcXCI6e1xcImJhY2tncm91bmRcXCI6XFwiIzYzNjc3NVxcIixcXCJjb2xvclxcIjpcXCIjZmZmZmZmXFwifSxcXCJjb250ZW50XFwiOntcXCJiYWNrZ3JvdW5kXFwiOlxcIiM0YzRkNTFcXCIsXFwiY29sb3JcXCI6XFwiI2ZmZmZmZlxcIixcXCJoeXBlcmxpbmtcXCI6e1xcImNvbG9yXFwiOlxcIiNmZmZmZmZcXCIsXFwiaG92ZXJcXCI6XFwicmdiYSgyNTUsMjU1LDI1NSwwLjUpXFwifX19LFxcImhlYWRlclxcIjpcXCIjZjFmMWYxXFwiLFxcImZvb3Rlcl9ib3JkZXJfdG9wXFwiOlxcIiMzZTNlM2VcXCIsXFwiZm9ybWF0c190YWJsZVxcIjp7XFwiY29sb3JcXCI6XFwiI2I4YjViNVxcIixcXCJyb3dfYm9yZGVyXFwiOlxcIiMzZTNlM2VcXCIsXFwicm93X2hvdmVyX2JhY2tncm91bmRcXCI6XFwicmdiYSgyNTUsMjU1LDI1NSwwLjEpXFwiLFxcIm1lZGlhX3R5cGVfaWNvblxcIjpcXCIjZmZhMjAwXFwiLFxcInZpZGVvX2ljb25cXCI6XFwiI2E4YThhOFxcIixcXCJzZXJ2aWNlX2ljb25cXCI6e1xcImNvbG9yXFwiOlxcIiM1YTgwZWVcXCIsXFwiaG92ZXJcXCI6XFwiIzUzN2RmYlxcIn19LFxcInFyX2NvZGVcXCI6e1xcImNvbG9yXFwiOlxcIiNmMWYxZjFcXCIsXFwiZXJyb3JcXCI6XFwiI2ZmNjY3NVxcIn0sXFwiYWR2ZXJ0XFwiOntcXCJ0aXRsZV9jb2xvclxcIjpcXCIjZjFmMWYxXFwiLFxcImNvbG9yXFwiOlxcIiNhZWFlYWVcXCIsXFwibnVtX2NvbG9yXFwiOlxcIiNmZmZmZmZcXCIsXFwiZmlndXJlXFwiOlxcIiM2OTY5NjlcXCIsXFwiZmlndXJlX2JvcmRlclxcIjpcXCIjM2IzYjNiXFwiLFxcImZpZ3VyZV9udW1fY29sb3JcXCI6XFwiI2ZmZmZmZlxcIixcXCJidXR0b25fY2FuY2VsXFwiOntcXCJjb2xvclxcIjpcXCIjYWVhZWFlXFwiLFxcImhvdmVyXFwiOlxcIiNmMWYxZjFcXCJ9fX0iKTtcblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vc3JjL3dpZGdldC90aGVtZXMvZGFyay5qc29uPycpfSxmdW5jdGlvbihtb2R1bGUsX193ZWJwYWNrX2V4cG9ydHNfXyxfX3dlYnBhY2tfcmVxdWlyZV9fKXsidXNlIHN0cmljdCI7ZXZhbCgnLy8gRVNNIENPTVBBVCBGTEFHXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIoX193ZWJwYWNrX2V4cG9ydHNfXyk7XG5cbi8vIE5BTUVTUEFDRSBPQkpFQ1Q6IC4vc3JjL3NlcnZpY2VzL3lvdXR1YmUvaW5kZXguanNcbnZhciB5b3V0dWJlX25hbWVzcGFjZU9iamVjdCA9IHt9O1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0KTtcbl9fd2VicGFja19yZXF1aXJlX18uZCh5b3V0dWJlX25hbWVzcGFjZU9iamVjdCwgImRvd25sb2FkU3RyZWFtIiwgZnVuY3Rpb24oKSB7IHJldHVybiBkb3dubG9hZF9zdHJlYW07IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0LCAiWW91dHViZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4geW91dHViZV9Zb3V0dWJlOyB9KTtcbl9fd2VicGFja19yZXF1aXJlX18uZCh5b3V0dWJlX25hbWVzcGFjZU9iamVjdCwgImdldFZpZGVvSW5mbyIsIGZ1bmN0aW9uKCkgeyByZXR1cm4geW91dHViZV9nZXRfdmlkZW9faW5mbzsgfSk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQoeW91dHViZV9uYW1lc3BhY2VPYmplY3QsICJzbmFwIiwgZnVuY3Rpb24oKSB7IHJldHVybiB5b3V0dWJlX3NuYXA7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0LCAiZ2V0TGFuZyIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gbGFuZ19kZXRlY3RfZ2V0TGFuZzsgfSk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQoeW91dHViZV9uYW1lc3BhY2VPYmplY3QsICJzdGFydExhbmdPYnNlcnZlciIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gc3RhcnRMYW5nT2JzZXJ2ZXI7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0LCAiZ2V0RGlyIiwgZnVuY3Rpb24oKSB7IHJldHVybiBnZXREaXI7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0LCAic3RhcnREaXJPYnNlcnZlciIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gc3RhcnREaXJPYnNlcnZlcjsgfSk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQoeW91dHViZV9uYW1lc3BhY2VPYmplY3QsICJnZXRUaGVtZSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gZ2V0VGhlbWU7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKHlvdXR1YmVfbmFtZXNwYWNlT2JqZWN0LCAic3RhcnRUaGVtZU9ic2VydmVyIiwgZnVuY3Rpb24oKSB7IHJldHVybiBzdGFydFRoZW1lT2JzZXJ2ZXI7IH0pO1xuXG4vLyBOQU1FU1BBQ0UgT0JKRUNUOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2VtYmVkL2luZGV4LmpzXG52YXIgZW1iZWRfbmFtZXNwYWNlT2JqZWN0ID0ge307XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIoZW1iZWRfbmFtZXNwYWNlT2JqZWN0KTtcbl9fd2VicGFja19yZXF1aXJlX18uZChlbWJlZF9uYW1lc3BhY2VPYmplY3QsICJkb3dubG9hZFN0cmVhbSIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gZG93bmxvYWRfc3RyZWFtOyB9KTtcbl9fd2VicGFja19yZXF1aXJlX18uZChlbWJlZF9uYW1lc3BhY2VPYmplY3QsICJnZXRWaWRlb0luZm8iLCBmdW5jdGlvbigpIHsgcmV0dXJuIGVtYmVkX2dldF92aWRlb19pbmZvOyB9KTtcbl9fd2VicGFja19yZXF1aXJlX18uZChlbWJlZF9uYW1lc3BhY2VPYmplY3QsICJzbmFwIiwgZnVuY3Rpb24oKSB7IHJldHVybiB5b3V0dWJlX3NuYXA7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKGVtYmVkX25hbWVzcGFjZU9iamVjdCwgImdldExhbmciLCBmdW5jdGlvbigpIHsgcmV0dXJuIGxhbmdfZGV0ZWN0X2dldExhbmc7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKGVtYmVkX25hbWVzcGFjZU9iamVjdCwgInN0YXJ0TGFuZ09ic2VydmVyIiwgZnVuY3Rpb24oKSB7IHJldHVybiBzdGFydExhbmdPYnNlcnZlcjsgfSk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQoZW1iZWRfbmFtZXNwYWNlT2JqZWN0LCAiZ2V0RGlyIiwgZnVuY3Rpb24oKSB7IHJldHVybiBnZXREaXI7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKGVtYmVkX25hbWVzcGFjZU9iamVjdCwgInN0YXJ0RGlyT2JzZXJ2ZXIiLCBmdW5jdGlvbigpIHsgcmV0dXJuIHN0YXJ0RGlyT2JzZXJ2ZXI7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKGVtYmVkX25hbWVzcGFjZU9iamVjdCwgImdldFRoZW1lIiwgZnVuY3Rpb24oKSB7IHJldHVybiBlbWJlZF9nZXRUaGVtZTsgfSk7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQoZW1iZWRfbmFtZXNwYWNlT2JqZWN0LCAiWW91dHViZUVtYmVkIiwgZnVuY3Rpb24oKSB7IHJldHVybiBlbWJlZF9Zb3V0dWJlRW1iZWQ7IH0pO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kKGVtYmVkX25hbWVzcGFjZU9iamVjdCwgImRlZmF1bHQiLCBmdW5jdGlvbigpIHsgcmV0dXJuIHlvdXR1YmVfZW1iZWQ7IH0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy91dGlscy9pbi1pZnJhbWUuanNcbmNvbnN0IGluSWZyYW1lID0gKCkgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBpbl9pZnJhbWUgPSAoaW5JZnJhbWUpO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vc3JjL2NvbmZpZy5qc1xudmFyIGNvbmZpZyA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9zcmMvdXRpbHMvY3R4LmpzXG52YXIgdXRpbHNfY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdXRpbHMvaW5qZWN0LXNjcmlwdC9zcHJpbnRmLmpzXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBzcHJpbnRmID0gKGZ1bmN0aW9uIChwYXR0ZXJuLCBlbnRyaWVzLCBtb2RlKSB7XG4gIGNvbnN0IHJlcGxhY2VyID0gZnVuY3Rpb24gKG1hdGNoLCBrZXkpIHtcbiAgICBsZXQgcmVzO1xuICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvdHlwZS1idWlsdGlucyAqL1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgIGNhc2UgIW1vZGUgfHwgbW9kZSA9PT0gInNsb3BweSI6XG4gICAgICByZXMgPSBlbnRyaWVzW2tleV07XG4gICAgICBicmVhaztcbiAgICBjYXNlIG1vZGUgPT09ICJuZWF0IjpcbiAgICAgIHJlcyA9IGVudHJpZXMuaGFzT3duUHJvcGVydHkoa2V5KSA/IGVudHJpZXNba2V5XSA6IG1hdGNoO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBtb2RlID09PSAic3RyaWN0IjpcbiAgICAgIGlmIChlbnRyaWVzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgcmVzID0gZW50cmllc1trZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBnb256YXpvaWQuc3ByaW50Zi5qczogbWlzc2VkICR7a2V5fSBlbnRyeSBpbiBwYXNzZWQgcmVwbGFjZW1lbnRzYCk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgIH1cbiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXByb3RvdHlwZS1idWlsdGlucyAqL1xuICAgIHJldHVybiByZXM7XG4gIH07XG4gIHJldHVybiBwYXR0ZXJuLnJlcGxhY2UoLyg/OlxcLyUoLis/KSVcXC8pL2csIHJlcGxhY2VyKTtcbn0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy91dGlscy9pbmplY3Qtc2NyaXB0L3NlcmlhbGl6ZS1lcnJvci5qc1xuLyogcmV3cml0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL3NlcmlhbGl6ZS1lcnJvci9ibG9iL21hc3Rlci9pbmRleC5qcyAqL1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBzZXJpYWxpemVfZXJyb3IgPSAoZnVuY3Rpb24gKHZhbHVlKSB7XG4gIC8vIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2Rlc3Ryb3ktY2lyY3VsYXJcbiAgY29uc3QgZGVzdHJveUNpcmN1bGFyID0gZnVuY3Rpb24gKGZyb20sIHNlZW4pIHtcbiAgICBsZXQgdG87XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZnJvbSkpIHtcbiAgICAgIHRvID0gW107XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvID0ge307XG4gICAgfVxuXG4gICAgc2Vlbi5wdXNoKGZyb20pO1xuXG4gICAgT2JqZWN0LmtleXMoZnJvbSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB2YWwgPSBmcm9tW2tleV07XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsID09PSAiZnVuY3Rpb24iKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCF2YWwgfHwgdHlwZW9mIHZhbCAhPT0gIm9iamVjdCIpIHtcbiAgICAgICAgdG9ba2V5XSA9IHZhbDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2Vlbi5pbmRleE9mKGZyb21ba2V5XSkgPT09IC0xKSB7XG4gICAgICAgIHRvW2tleV0gPSBkZXN0cm95Q2lyY3VsYXIoZnJvbVtrZXldLCBzZWVuLnNsaWNlKDApKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0b1trZXldID0gIltDaXJjdWxhcl0iO1xuICAgIH0pO1xuXG4gICAgaWYgKHR5cGVvZiBmcm9tLm5hbWUgPT09ICJzdHJpbmciKSB7XG4gICAgICB0by5uYW1lID0gZnJvbS5uYW1lO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZnJvbS5tZXNzYWdlID09PSAic3RyaW5nIikge1xuICAgICAgdG8ubWVzc2FnZSA9IGZyb20ubWVzc2FnZTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGZyb20uc3RhY2sgPT09ICJzdHJpbmciKSB7XG4gICAgICB0by5zdGFjayA9IGZyb20uc3RhY2s7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRvO1xuICB9O1xuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSB7XG4gICAgcmV0dXJuIGRlc3Ryb3lDaXJjdWxhcih2YWx1ZSwgW10pO1xuICB9XG5cbiAgLy8gUGVvcGxlIHNvbWV0aW1lcyB0aHJvdyB0aGluZ3MgYmVzaWRlcyBFcnJvciBvYmplY3RzLCBzby4uLlxuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHtcbiAgICAvLyBKU09OLnN0cmluZ2lmeSBkaXNjYXJkcyBmdW5jdGlvbnMuIFdlIGRvIHRvLCB1bmxlc3MgYSBmdW5jdGlvbiBpcyB0aHJvd24gZGlyZWN0bHkuXG4gICAgcmV0dXJuIGBbRnVuY3Rpb246ICAke3ZhbHVlLm5hbWUgfHwgImFub255bW91cyJ9XWA7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdXRpbHMvaW5qZWN0LXNjcmlwdC9pbmRleC5qc1xuXG5cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgaW5qZWN0X3NjcmlwdCA9IChmdW5jdGlvbiAoZG9jdW1lbnQsIGZ1bmMsIC4uLnBhcmFtcykge1xuICBjb25zdCB7IE11dGF0aW9uT2JzZXJ2ZXIgfSA9IGRvY3VtZW50LmRlZmF1bHRWaWV3O1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7XG4gICAgc2NyaXB0LnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjtcbiAgICBzY3JpcHQuY2hhcnNldCA9ICJ1dGYtOCI7XG4gICAgc2NyaXB0LmRlZmVyID0gdHJ1ZTtcbiAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xuXG4gICAgY29uc3QgZXhlY3V0b3IgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjU2NyaXB0ID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdDtcbiAgICAgIGNvbnN0IGZ1bmNUb0V4ZWMgPSAvJWZ1bmNTb3VyY2UlLztcbiAgICAgIGNvbnN0IHNlcmlhbGl6ZUVycm9yID0gLyVzZXJpYWxpemVFcnJvclNvdXJjZSUvO1xuICAgICAgLy8g0YLRg9GCINCx0YPQtNGD0YIg0L/RgNC+0LHQu9C10LzRiyDQtdGB0LvQuCDQvdC1INC30LDRjdGB0LrQtdC/0LjQvCDQtNCy0L7QudC90YvQtSDQutCw0LLRi9GH0LrQuCDQuCDRgdC/0LXRhtGB0LjQvNCy0L7Qu9GLXG4gICAgICBjb25zdCBhcmd2ID0gSlNPTi5wYXJzZSgiLyVhcmd2U291cmNlJS8iKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNTY3JpcHQuX19yZXNwb25zZSA9IGFyZ3YubGVuZ3RoID8gZnVuY1RvRXhlYyguLi5hcmd2KSA6IGZ1bmNUb0V4ZWMoKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjU2NyaXB0Ll9fcmVzcG9uc2UgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHtcbiAgICAgICAgICByZWooZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChbY1NjcmlwdC5fX3Jlc3BvbnNlXSk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCJwcm9taXNlIGNhbGxiYWNrIiwgY1NjcmlwdCwgdmFsdWVzKTtcbiAgICAgICAgY1NjcmlwdC5zZXRBdHRyaWJ1dGUoImRhdGEtcmVzcG9uc2UiLCBKU09OLnN0cmluZ2lmeSh2YWx1ZXNbMF0pKTtcbiAgICAgICAgY1NjcmlwdC5zZXRBdHRyaWJ1dGUoImRhdGEtc3RhdHVzIiwgImZ1bGZpbGxlZCIpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZXJyID09PSAib2JqZWN0IiAmJiBlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICAgIGNTY3JpcHQuc2V0QXR0cmlidXRlKCJkYXRhLXR5cGUiLCAiZXJyb3IiKTtcbiAgICAgICAgICBjU2NyaXB0LnNldEF0dHJpYnV0ZSgiZGF0YS1yZXNwb25zZSIsIEpTT04uc3RyaW5naWZ5KHNlcmlhbGl6ZUVycm9yKGVycikpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjU2NyaXB0LnNldEF0dHJpYnV0ZSgiZGF0YS1yZXNwb25zZSIsIEpTT04uc3RyaW5naWZ5KGVycikpO1xuICAgICAgICB9XG4gICAgICAgIGNTY3JpcHQuc2V0QXR0cmlidXRlKCJkYXRhLXN0YXR1cyIsICJyZWplY3RlZCIpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBzcmMgPSBzcHJpbnRmKGV4ZWN1dG9yLnRvU3RyaW5nKCksIHtcbiAgICAgIGZ1bmNTb3VyY2U6ICh0eXBlb2YgZnVuYyA9PT0gImZ1bmN0aW9uIiA/IGZ1bmMudG9TdHJpbmcoKSA6IGZ1bmMpLFxuICAgICAgc2VyaWFsaXplRXJyb3JTb3VyY2U6IHNlcmlhbGl6ZV9lcnJvci50b1N0cmluZygpLFxuICAgICAgYXJndlNvdXJjZTogSlNPTi5zdHJpbmdpZnkocGFyYW1zKVxuICAgICAgICAucmVwbGFjZSgvXFxcXCpcJy9nLCBtYXRjaCA9PiBgJHttYXRjaC5sZW5ndGggJSAyID8gIlxcXFwiIDogIiJ9JHttYXRjaH1gKVxuICAgICAgICAucmVwbGFjZSgvIi9nLCAiXFxcXFxcIiIpLFxuICAgIH0pO1xuICAgIC8vIGNvbnNvbGUubG9nKHNyYyk7XG4gICAgc2NyaXB0LnRleHQgPSBgKCR7c3JjfSkoKTtgO1xuXG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7XG4gICAgICBtdXRhdGlvbnMuZm9yRWFjaCgobXV0YXRpb24pID0+IHtcbiAgICAgICAgLy8gVE9ETyBhdHRyaWJ1dGVOYW1lU3BhY2UgLSDQvdCw0LTQviDQsdGLINGA0LDQt9C+0LHRgNCw0YLRjNGB0Y9cbiAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICJhdHRyaWJ1dGVzIiAmJiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lICYmIG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICJkYXRhLXN0YXR1cyIpIHtcbiAgICAgICAgICBjb25zdCBzdGF0dXMgPSBtdXRhdGlvbi50YXJnZXQuZ2V0QXR0cmlidXRlKCJkYXRhLXN0YXR1cyIpO1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbXV0YXRpb24udGFyZ2V0LmdldEF0dHJpYnV0ZSgiZGF0YS1yZXNwb25zZSIpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc3BvbnNlID09PSAidW5kZWZpbmVkIiA/IHVuZGVmaW5lZCA6IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgIGNvbnN0IHR5cGUgPSBtdXRhdGlvbi50YXJnZXQuZ2V0QXR0cmlidXRlKCJkYXRhLXR5cGUiKTtcblxuICAgICAgICAgIHNjcmlwdC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHNjcmlwdCk7XG4gICAgICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgICBjYXNlICJmdWxmaWxsZWQiOlxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAicmVqZWN0ZWQiOlxuICAgICAgICAgICAgaWYgKCF0eXBlIHx8IHR5cGUgIT09ICJlcnJvciIpIHtcbiAgICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgICAgICAgcmVqZWN0KE9iamVjdC5hc3NpZ24oZXJyLCByZXN1bHQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJpbmplY3RTY3JpcHQ6IHVua25vd24gcmVzcG9uc2UiKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIG9ic2VydmVyLm9ic2VydmUoc2NyaXB0LCB7IGF0dHJpYnV0ZXM6IHRydWUgfSk7XG4gICAgKGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50KS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICB9KTtcbn0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy91dGlscy91bnNhZmUtd2luZG93LmpzXG5cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgdW5zYWZlX3dpbmRvdyA9ICh7XG4gIGdldChwYXRoKSB7XG4gICAgY29uc3QgZ2V0dGVyID0gZnVuY3Rpb24gKF9wYXRoKSB7XG4gICAgICByZXR1cm4gX3BhdGguc3BsaXQoIi4iKS5yZWR1Y2UoKGFjYywgdG9rZW4pID0+IChhY2MgPyBhY2NbdG9rZW5dIDogdW5kZWZpbmVkKSwgd2luZG93KTtcbiAgICB9O1xuICAgIHJldHVybiBpbmplY3Rfc2NyaXB0KGRvY3VtZW50LCBnZXR0ZXIsIHBhdGgpO1xuICB9LFxuICBzZXQocGF0aCwgdmFsdWUpIHtcbiAgICBjb25zdCBzZXR0ZXIgPSBmdW5jdGlvbiAoX3BhdGgsIF92YWx1ZSkge1xuICAgICAgY29uc3QgdG9rZW5zID0gX3BhdGguc3BsaXQoIi4iKTtcbiAgICAgIGxldCByZWNpZXZlciA9IHdpbmRvdztcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgKHRva2Vucy5sZW5ndGggLSAxKTsgaSsrKSB7XG4gICAgICAgIHJlY2lldmVyID0gcmVjaWV2ZXJbdG9rZW5zW2ldXTtcbiAgICAgIH1cbiAgICAgIHJlY2lldmVyW3Rva2Vucy5wb3AoKV0gPSBfdmFsdWU7XG4gICAgfTtcbiAgICByZXR1cm4gaW5qZWN0X3NjcmlwdChkb2N1bWVudCwgc2V0dGVyLCBwYXRoLCB2YWx1ZSk7XG4gIH0sXG59KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdXRpbHMvbWluaWZ5LmpzXG5jb25zdCBtaW5pZnkgPSBjc3MgPT4gKFxuICBjc3MucmVwbGFjZSgvXFxzXFxzKy9nLCAiIilcbiAgICAucmVwbGFjZSgvIHsvZywgInsiKVxuICAgIC5yZXBsYWNlKC87fS9nLCAifSIpXG4gICAgLnJlcGxhY2UoLzogL2csICI6Iilcbik7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHV0aWxzX21pbmlmeSA9IChtaW5pZnkpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy91dGlscy9kZWJvdW5jZS5qc1xuY29uc3QgZGVib3VuY2UgPSBmdW5jdGlvbiAoZnVuYywgdGltZW91dCkge1xuICBsZXQgbG9jayA9IGZhbHNlO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmIChsb2NrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNhbGxiYWNrID0gKCkgPT4ge1xuICAgICAgbG9jayA9IGZhbHNlO1xuICAgICAgZnVuYygpO1xuICAgIH07XG4gICAgbG9jayA9IHRydWU7XG4gICAgc2V0VGltZW91dChjYWxsYmFjaywgdGltZW91dCk7XG4gIH07XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB1dGlsc19kZWJvdW5jZSA9IChkZWJvdW5jZSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3NlcnZpY2VzL2NvbW1vbi5qc1xuXG5cblxuXG5jbGFzcyBjb21tb25fQ29tbW9uIHtcbiAgY29uc3RydWN0b3Iod2lkZ2V0LCBoYW5kbGVycykge1xuICAgIHRoaXMud2lkZ2V0ID0gd2lkZ2V0O1xuICAgIHRoaXMuaGFuZGxlcnMgPSBoYW5kbGVycztcbiAgICBpZiAoaGFuZGxlcnMgJiYgIm9uTG9jYXRpb25DaGFuZ2VkIiBpbiBoYW5kbGVycykge1xuICAgICAgdGhpcy5jaGVja0xvY2F0aW9uID0gKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5sb2NhdGlvbiAhPT0gd2luZG93LmxvY2F0aW9uLmhyZWYpIHtcbiAgICAgICAgICB0aGlzLmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgICAgdGhpcy5oYW5kbGVycy5vbkxvY2F0aW9uQ2hhbmdlZC5iaW5kKHRoaXMpKCk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dCh0aGlzLmNoZWNrTG9jYXRpb24sIDEwMDApO1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBnb3RvU2VydmljZShldnQpIHtcbiAgICBpZiAodGhpcy5oYW5kbGVycyAmJiB0aGlzLmhhbmRsZXJzLm9uQ2xpY2spIHtcbiAgICAgIHRoaXMuaGFuZGxlcnMub25DbGljay5iaW5kKHRoaXMpKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbGFuZGluZ1VybCA9IHRoaXMuY3R4LmdldFNlcnZpY2VVcmwodGhpcy5jdHgud2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgd2luZG93Lm9wZW4obGFuZGluZ1VybCwgIl9ibGFuayIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCJnb3RvU2VydmljZTogIiwgZSk7XG4gICAgfVxuICB9XG5cbiAgYWRkQnV0dG9uKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCJBREQgQlVUVE9OISEhIik7XG4gICAgY29uc3QgYnV0dG9uSW5zZXJ0ZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidW5pZG93bmxvYWRlciIpO1xuICAgIGlmIChidXR0b25JbnNlcnRlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvID0gdGhpcy5jdHgud2luZG93LmRvY3VtZW50O1xuICAgIHRyeSB7XG4gICAgICBpZiAobyAhPT0gbnVsbCAmJiBvLmJvZHkgIT09IG51bGwgJiYgby5sb2NhdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBidXR0b24gPSB0aGlzLmdldERvd25sb2FkQnV0dG9uKCk7XG4gICAgICAgIGlmIChidXR0b24pIHtcbiAgICAgICAgICBjb25zdCBpbnNlcnRlZCA9IHRoaXMuaW5zZXJ0RG93bmxvYWRCdXR0b24obywgYnV0dG9uLCB0aGlzLmdldERvd25sb2FkQnV0dG9uLmJpbmQodGhpcykpO1xuICAgICAgICAgIGlmIChpbnNlcnRlZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaGFuZGxlcnMgJiYgdGhpcy5oYW5kbGVycy5vbkluc2VydCkge1xuICAgICAgICAgICAgICB0aGlzLmhhbmRsZXJzLm9uSW5zZXJ0LmJpbmQodGhpcykoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY2hlY2tMb2NhdGlvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCJlcnJvciBpbiBhZGRCdXR0b246ICIsIGUpO1xuICAgIH1cbiAgfVxuXG4gIG9uTG9hZChjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLmV4YWN0TWF0Y2goKSkge1xuICAgICAgdGhpcy5jaGVja0xheW91dChjYWxsYmFjayk7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tMYXlvdXQoY2FsbGJhY2spIHtcbiAgICAvLyBjb25zb2xlLmxvZygiQ0hFQ0sgTEFZT1VUISEhIik7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuc2VydmljZSBpbiBjb25maWdbImEiIC8qIGRlZmF1bHQgKi9dID8gY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXVt0aGlzLnNlcnZpY2VdIDogY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXS5kZWZhdWx0O1xuICAgIGlmICghdGhpcy5jb3VudGVyKSB7XG4gICAgICB0aGlzLmNvdW50ZXIgPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5sYXlvdXRJc1JlYWR5KCkpIHtcbiAgICAgIHRoaXMuY291bnRlciA9IDA7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb3VudGVyID4gb3B0aW9ucy5hdHRlbXB0cykge1xuICAgICAgdGhpcy5jdHgubG9nKHRoaXMuc2VydmljZSwgImxheW91dCIpO1xuICAgICAgdGhpcy5jb3VudGVyID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb3VudGVyICs9IDE7XG4gICAgfVxuICB9XG5cbiAgc3RhcnQoY3R4LCBnZXREb3dubG9hZEJ1dHRvbikge1xuICAgIHRoaXMuZ2V0RG93bmxvYWRCdXR0b24gPSBnZXREb3dubG9hZEJ1dHRvbjtcbiAgICBjb25zdCBvYnNlcnZlckNvbmZpZyA9IHtcbiAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgfTtcbiAgICBjb25zdCBhZGRCdXR0b24gPSB0aGlzLmFkZEJ1dHRvbi5iaW5kKHRoaXMpO1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdXRpbHNfZGVib3VuY2UodGhpcy5vbkxvYWQuYmluZCh0aGlzLCBhZGRCdXR0b24pLCAxZTMpO1xuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spO1xuICAgIG9ic2VydmVyLm9ic2VydmUod2luZG93LmRvY3VtZW50LmJvZHksIG9ic2VydmVyQ29uZmlnKTtcbiAgICBpZiAoY3R4KSB7XG4gICAgICB0aGlzLmN0eCA9IGN0eDtcbiAgICB9XG4gIH1cbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgY29tbW9uID0gKGNvbW1vbl9Db21tb24pO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3AtcXVldWUvZGlzdC9pbmRleC5qc1xudmFyIGRpc3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4KTtcbnZhciBkaXN0X2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGRpc3QpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2h0dHAtcm91dGluZXMtdG0uanNcbmNvbnN0IGdldENodW5rID0gZnVuY3Rpb24gKHVybCwgc3RhcnQsIGVuZCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICByZXNwb25zZVR5cGU6ICJhcnJheWJ1ZmZlciIsXG4gICAgICBtZXRob2Q6ICJHRVQiLFxuICAgICAgdXJsOiBgJHt1cmx9JnJhbmdlPSR7c3RhcnR9LSR7ZW5kfWAsXG4gICAgICBvbmxvYWQ6ICh7IHJlc3BvbnNlIH0pID0+IHtcbiAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9LFxuICAgICAgb25lcnJvcjogKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH0sXG4gICAgfTtcbiAgICB0cnkge1xuICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cbiAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KG9wdGlvbnMpO1xuICAgICAgLyogZXNsaW50LWVuYWJsZSBuby11bmRlZiAqL1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgcmVqZWN0KGUpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBnZXRDb250ZW50TGVuZ3RoID0gZnVuY3Rpb24gKHVybCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBtZXRob2Q6ICJIRUFEIixcbiAgICAgIHVybCxcbiAgICAgIG9ubG9hZDogKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSByZXNwb25zZS5yZXNwb25zZUhlYWRlcnMuc3BsaXQoIlxcbiIpO1xuICAgICAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gaGVhZGVycy5maWx0ZXIoaGVhZGVyID0+IGhlYWRlci5zcGxpdCgiOiIpWzBdLnRyaW0oKSA9PT0gImNvbnRlbnQtbGVuZ3RoIik7XG4gICAgICAgIGlmICghY29udGVudExlbmd0aC5sZW5ndGgpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJ1bmtub3duIikpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbGVuZ3RoID0gcGFyc2VJbnQoY29udGVudExlbmd0aFswXS5zcGxpdCgiOiIpWzFdLnRyaW0oKSwgMTApO1xuICAgICAgICAgIGlmIChsZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc29sdmUobGVuZ3RoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigiemVybyBsZW5ndGgiKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9uZXJyb3I6IChlcnIpID0+IHtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9LFxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovXG4gICAgICBHTV94bWxodHRwUmVxdWVzdChvcHRpb25zKTtcbiAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tdW5kZWYgKi9cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJlamVjdChlcnIpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBjaGVja0RpcmVjdERvd25sb2FkID0gZnVuY3Rpb24gKHVybCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgbWV0aG9kOiAiSEVBRCIsXG4gICAgICB1cmwsXG4gICAgICBvbmxvYWQ6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICBjb25zdCBoZWFkZXJzID0gcmVzcG9uc2UucmVzcG9uc2VIZWFkZXJzLnNwbGl0KCJcXG4iKTtcbiAgICAgICAgY29uc3QgY29udGVudERpc3Bvc2l0aW9uID0gaGVhZGVycy5maWx0ZXIoaGVhZGVyID0+IGhlYWRlci5zcGxpdCgiOiIpWzBdLnRyaW0oKSA9PT0gImNvbnRlbnQtZGlzcG9zaXRpb24iKTtcbiAgICAgICAgcmVzb2x2ZShjb250ZW50RGlzcG9zaXRpb24ubGVuZ3RoID4gMCk7XG4gICAgICB9LFxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmICovXG4gICAgICBHTV94bWxodHRwUmVxdWVzdChvcHRpb25zKTtcbiAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tdW5kZWYgKi9cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvc2VydmljZXMveW91dHViZS9kb3dubG9hZC1zdHJlYW0uanNcblxuXG5cbi8vIDE2MTI0ODIwNzMgLSBva1xuLy8gMTg4NjYwNjUzMCBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVA5WjZva0xKRHYwIDEwODAgLSBva1xuLy8gMjAwMTM5NTUyNiBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWxUdllqRVJWQW5ZIDEwODAgLSBvayB2ZXJ5IHNsb3dcbi8vIDIyNDMyNzk3NDcgaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1ENnRDMXB5cnNUTSAtIFVuY2F1Z2h0IChpbiBwcm9taXNlKSBFcnJvcjogRmlsZSBjb3VsZCBub3QgYmUgcmVhZCEgQ29kZT0wIGF0IEZpbGVSZWFkZXIuYS5vbmVycm9yXG4vLyB2aWRlbyBkb3dubG9hZGVyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiwgbm8tdW51c2VkLXZhcnMgKi9cblxuY29uc3QgY2h1bmtTaXplID0gMTAyNCAqIDEwMjQgKiAxNjtcbmNvbnN0IGdldFN0b3JhZ2UgPSBhc3luYyBmdW5jdGlvbiAoZGJOYW1lKSB7XG4gIC8vIHJldHVybiBuZXcgVWludDhBcnJheShzaXplKTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSB3aW5kb3cuaW5kZXhlZERCLm9wZW4oZGJOYW1lLCAyKTtcbiAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZWoobmV3IEVycm9yKCLQn9C+0YfQtdC80YMg0JLRiyDQvdC1INC/0L7Qt9Cy0L7Qu9GP0LXRgtC1INC80L7QtdC80YMg0LLQtdCxLdC/0YDQuNC70L7QttC10L3QuNGOINC40YHQv9C+0LvRjNC30L7QstCw0YLRjCBJbmRleGVkREI/ISIpKTtcbiAgICB9O1xuICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygiT04gVVBHUkFERSEhISIpO1xuICAgICAgY29uc3QgZGIgPSBldmVudC50YXJnZXQucmVzdWx0O1xuICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZSgiY2h1bmtzIiwgeyBrZXlQYXRoOiAib2ZmcyIgfSk7XG4gICAgICBvYmplY3RTdG9yZS50cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXMoZGIpO1xuICAgICAgfTtcbiAgICB9O1xuICB9KTtcbn07XG5cbmNvbnN0IGFkZENodW5rID0gZnVuY3Rpb24gKHN0b3JhZ2UsIGNodW5rLCBvZmZzKSB7XG4gIGNvbnN0IG9iamVjdFN0b3JlID0gc3RvcmFnZS50cmFuc2FjdGlvbigiY2h1bmtzIiwgInJlYWR3cml0ZSIpLm9iamVjdFN0b3JlKCJjaHVua3MiKTtcbiAgb2JqZWN0U3RvcmUuYWRkKHsgb2ZmcywgY2h1bmsgfSk7XG59O1xuXG5jb25zdCBkb3dubG9hZF9zdHJlYW1fZG93bmxvYWRTdHJlYW0gPSBhc3luYyBmdW5jdGlvbiAoeyB1cmwsIGNvbnRlbnRMZW5ndGg6IF9jb250ZW50TGVuZ3RoIH0sIHByb2dyZXNzQ2IpIHtcbiAgbGV0IGNvbnRlbnRMZW5ndGg7XG4gIGxldCB4aHI7XG4gIGNvbnN0IGRiTmFtZSA9IGAke3VybH1fJHtjb250ZW50TGVuZ3RofWA7XG5cbiAgaWYgKF9jb250ZW50TGVuZ3RoKSB7XG4gICAgY29udGVudExlbmd0aCA9IHR5cGVvZiBfY29udGVudExlbmd0aCA9PT0gInN0cmluZyIgPyBwYXJzZUludChfY29udGVudExlbmd0aCwgMTApIDogX2NvbnRlbnRMZW5ndGg7XG4gICAgY29uc29sZS5sb2coYENvbnRlbnQgbGVuZ3RoICR7KGNvbnRlbnRMZW5ndGggLyAoMTAyNCAqIDEwMjQgKiAxMDI0KSkudG9GaXhlZCg0KX0gR2JgKTtcbiAgfSBlbHNlIHtcbiAgICB0cnkge1xuICAgICAgY29udGVudExlbmd0aCA9IGF3YWl0IGdldENvbnRlbnRMZW5ndGgodXJsKTtcbiAgICAgIGNvbnNvbGUubG9nKGBDb250ZW50IGxlbmd0aCAkeyhjb250ZW50TGVuZ3RoIC8gKDEwMjQgKiAxMDI0ICogMTAyNCkpLnRvRml4ZWQoNCl9IEdiYCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5sb2coIkVSUk9SISEhIiwgZSk7XG4gICAgICAvLyBUT0RPIGNhbmNlbCBkb3dubG9hZGluZyBhbmQgd2FybmluZyB1c2VyXG4gICAgfVxuICB9XG4gIHByb2dyZXNzQ2Ioe1xuICAgIGxvYWRlZDogMCxcbiAgICB0b3RhbDogY29udGVudExlbmd0aCxcbiAgICBzcGVlZDogMCxcbiAgfSk7XG5cbiAgY29uc3QgZGF0YSA9IGF3YWl0IGdldFN0b3JhZ2UoZGJOYW1lKTtcbiAgbGV0IGRvd25sb2FkZWQgPSAwO1xuICBjb25zdCBxdWV1ZSA9IG5ldyBkaXN0X2RlZmF1bHQuYSh7IGNvbmN1cnJlbmN5OiAzIH0pO1xuICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICBjb25zdCBwcyA9IFtdO1xuICBmb3IgKGxldCBzdGFydCA9IDA7IHN0YXJ0IDw9IGNvbnRlbnRMZW5ndGg7IHN0YXJ0ICs9IGNodW5rU2l6ZSkge1xuICAgIGNvbnN0IGV4Y2VlZGVkID0gc3RhcnQgKyBjaHVua1NpemUgPj0gY29udGVudExlbmd0aDtcbiAgICBjb25zdCBjdXJDaHVua1NpemUgPSBleGNlZWRlZCA/IGNvbnRlbnRMZW5ndGggLSBzdGFydCA6IGNodW5rU2l6ZTtcbiAgICBjb25zdCBlbmQgPSBzdGFydCArIGN1ckNodW5rU2l6ZSAtIDE7XG4gICAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWxvb3AtZnVuYyAqL1xuICAgIGNvbnN0IHAgPSBxdWV1ZS5hZGQoYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmID0gYXdhaXQgZ2V0Q2h1bmsodXJsLCBzdGFydCwgZW5kKTtcbiAgICAgIGRvd25sb2FkZWQgKz0gY3VyQ2h1bmtTaXplO1xuICAgICAgYWRkQ2h1bmsoZGF0YSwgYnVmLCBzdGFydCk7XG4gICAgICBjb25zdCBkcyA9IChEYXRlLm5vdygpIC0gc3RhcnRUaW1lICsgMSkgLyAxMDAwO1xuICAgICAgcHJvZ3Jlc3NDYih7XG4gICAgICAgIGxvYWRlZDogZG93bmxvYWRlZCxcbiAgICAgICAgdG90YWw6IGNvbnRlbnRMZW5ndGgsXG4gICAgICAgIHNwZWVkOiBkb3dubG9hZGVkIC8gZHMsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBwcy5wdXNoKHApO1xuICB9XG5cbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWFzeW5jLXByb21pc2UtZXhlY3V0b3IgKi9cbiAgY29uc3QgcmVzdWx0ID0gbmV3IFByb21pc2UoYXN5bmMgKHJlcywgcmVqKSA9PiB7XG4gICAgYXdhaXQgUHJvbWlzZS5hbGwocHMpO1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgY29uc3Qgc2VsZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYXRhLnRyYW5zYWN0aW9uKCJjaHVua3MiKTtcbiAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoImNodW5rcyIpO1xuICAgICAgY29uc3QgYWxsID0gb2JqZWN0U3RvcmUuZ2V0QWxsKCk7XG4gICAgICBhbGwub25zdWNjZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCJHb3QgYWxsIGNodW5rczogIik7XG4gICAgICAgIGNvbnN0IGFyckJ1ZmYgPSBldmVudC50YXJnZXQucmVzdWx0Lm1hcChyZWMgPT4gcmVjLmNodW5rKTtcbiAgICAgICAgZGF0YS5jbG9zZSgpO1xuICAgICAgICB3aW5kb3cuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGRiTmFtZSk7XG4gICAgICAgIHJlcyhuZXcgQmxvYihhcnJCdWZmLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9vY3RldC1iaW5hcnkiIH0pKTtcbiAgICAgIH07XG4gICAgICB0cmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChjb3VudCA8IDMpIHtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgIHNlbGVjdCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvdW50ID0gMDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgdHJ5IHRvIGRlbGV0ZSAke2RiTmFtZX1gKTtcbiAgICAgICAgICBkYXRhLmNsb3NlKCk7XG4gICAgICAgICAgd2luZG93LmluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xuICAgICAgICAgIHJlaihldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfTtcblxuICAgIHNlbGVjdChyZXMsIHJlaik7XG4gIH0pO1xuXG4gIGNvbnN0IGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICBxdWV1ZS5wYXVzZSgpO1xuICAgIHF1ZXVlLmNsZWFyKCk7XG4gICAgZGF0YS5jbG9zZSgpO1xuICAgIGNvbnN0IERCRGVsZXRlUmVxdWVzdCA9IHdpbmRvdy5pbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoZGJOYW1lKTtcbiAgICBEQkRlbGV0ZVJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgY29uc29sZS5sb2coIkVycm9yIGRlbGV0aW5nIGRhdGFiYXNlLiIsIGRiTmFtZSwgZXZlbnQpO1xuICAgIH07XG4gICAgREJEZWxldGVSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgY29uc29sZS5sb2coIkRhdGFiYXNlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IiwgZGJOYW1lLCBldmVudCk7XG4gICAgfTtcbiAgICBEQkRlbGV0ZVJlcXVlc3Qub25ibG9ja2VkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCJibG9ja2VkOiAiLCBlKTtcbiAgICB9O1xuICB9O1xuXG4gIHJldHVybiB7IGNhbmNlbCwgcmVzdWx0IH07XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBkb3dubG9hZF9zdHJlYW0gPSAoZG93bmxvYWRfc3RyZWFtX2Rvd25sb2FkU3RyZWFtKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvc2VydmljZXMveW91dHViZS91dGlscy9tYWtlLWxvZ2dlci5qc1xuY29uc3QgbWFrZUxvZ2dlciA9IGZ1bmN0aW9uIChjb25zb2xlLCB0YWcsIG1vZGUpIHtcbiAgY29uc3QgYWNjID0ge307XG4gIGNvbnN0IGdldEZuID0gZnVuY3Rpb24gKGspIHtcbiAgICBpZiAobW9kZSkge1xuICAgICAgcmV0dXJuICguLi5hcmdzKSA9PiBjb25zb2xlW2tdKGAke3RhZ306ICR7YXJnc1swXX1gLCAuLi5hcmdzLnNsaWNlKDEpKTtcbiAgICB9XG4gICAgcmV0dXJuICgpID0+IHVuZGVmaW5lZDtcbiAgfTtcblxuICBPYmplY3Qua2V5cyhjb25zb2xlKVxuICAgIC5mb3JFYWNoKChrKSA9PiB7XG4gICAgICBhY2Nba10gPSBnZXRGbihrKTtcbiAgICB9KTtcbiAgcmV0dXJuIGFjYztcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG1ha2VfbG9nZ2VyID0gKG1ha2VMb2dnZXIpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2dldC12aWRlby1pbmZvLWVuZHBvaW50cy9nZXQtdmlkZW8taW5mby5qc1xuXG5cbmNvbnN0IGdldF92aWRlb19pbmZvX2dldFZpZGVvSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIChpZCkge1xuICBjb25zdCBnZXRITCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gYCR7d2luZG93Lnl0Y2ZnLmRhdGFfLkhMfV8ke3dpbmRvdy55dGNmZy5kYXRhXy5HTH1gO1xuICB9O1xuXG4gIGxldCBobDtcbiAgdHJ5IHtcbiAgICBobCA9IGF3YWl0IGluamVjdF9zY3JpcHQoZG9jdW1lbnQsIGdldEhMKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9XG5cbiAgY29uc3QgdXJsID0gYGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2dldF92aWRlb19pbmZvP3ZpZGVvX2lkPSR7aWR9JnBzPWRlZmF1bHQmaGw9JHtobH0maHRtbDU9MWA7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgbW9kZTogIm5vLWNvcnMiLFxuICAgIG1ldGhvZDogIkdFVCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIixcbiAgICB9LFxuICB9O1xuICB0cnkge1xuICAgIGNvbnN0IG5ld0VuZHBvaW50UmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpO1xuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gbmV3RW5kcG9pbnRSZXNwb25zZS5oZWFkZXJzLmdldCgiY29udGVudC10eXBlIik7XG4gICAgaWYgKGNvbnRlbnRUeXBlID09PSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIikge1xuICAgICAgY29uc3QgdmlkZW9JbmZvID0gYXdhaXQgbmV3RW5kcG9pbnRSZXNwb25zZS50ZXh0KCk7XG4gICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHZpZGVvSW5mbyk7XG5cbiAgICAgIGNvbnN0IHBsYXllclJlc3BvbnNlID0gSlNPTi5wYXJzZShzZWFyY2hQYXJhbXMuZ2V0KCJwbGF5ZXJfcmVzcG9uc2UiKSk7XG4gICAgICByZXR1cm4gcGxheWVyUmVzcG9uc2U7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBnZXRfdmlkZW9faW5mbyA9IChnZXRfdmlkZW9faW5mb19nZXRWaWRlb0luZm8pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2dldC12aWRlby1pbmZvLWVuZHBvaW50cy9wbGF5ZXIuanNcblxuXG5cbmNvbnN0IHBsYXllcl9nZXRWaWRlb0luZm8gPSBhc3luYyBmdW5jdGlvbiAoaWQpIHtcbiAgY29uc3QgZ2V0QXBpS2V5ID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh3aW5kb3cueXRwbGF5ZXIgJiYgd2luZG93LndlYl9wbGF5ZXJfY29udGV4dF9jb25maWcgJiYgd2luZG93LndlYl9wbGF5ZXJfY29udGV4dF9jb25maWcuaW5uZXJ0dWJlQXBpS2V5KSB7XG4gICAgICByZXR1cm4gd2luZG93LndlYl9wbGF5ZXJfY29udGV4dF9jb25maWcuaW5uZXJ0dWJlQXBpS2V5O1xuICAgIH1cbiAgICBpZiAod2luZG93Lnl0ICYmIHdpbmRvdy55dC5jb25maWdfICYmIHdpbmRvdy55dC5jb25maWdfLklOTkVSVFVCRV9BUElfS0VZKSB7XG4gICAgICByZXR1cm4gd2luZG93Lnl0LmNvbmZpZ18uSU5ORVJUVUJFX0FQSV9LRVk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCJBUEkga2V5IG5vdCBmb3VuZCEhISIpO1xuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIGxldCBjb250ZXh0O1xuICBsZXQgYXBpS2V5O1xuICB0cnkge1xuICAgIGNvbnRleHQgPSBhd2FpdCB1bnNhZmVfd2luZG93LmdldCgid2luZG93Lnl0LmNvbmZpZ18uSU5ORVJUVUJFX0NPTlRFWFQiKTtcbiAgICBhcGlLZXkgPSBhd2FpdCBpbmplY3Rfc2NyaXB0KGRvY3VtZW50LCBnZXRBcGlLZXkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cblxuICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiwgbm8tcmVzdHJpY3RlZC1nbG9iYWxzLCBtYXgtbGVuICovXG4gIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgY29udGV4dDoge1xuICAgICAgY2xpZW50OiBjb250ZXh0LmNsaWVudCxcbiAgICAgIHVzZXI6IGNvbnRleHQudXNlcixcbiAgICAgIHJlcXVlc3Q6IGNvbnRleHQucmVxdWVzdCxcbiAgICAgIGNsaWNrVHJhY2tpbmc6IGNvbnRleHQuY2xpY2tUcmFja2luZyxcbiAgICB9LFxuICAgIHZpZGVvSWQ6IGlkLFxuICB9O1xuXG4gIGNvbnN0IHVybCA9IGBodHRwczovLyR7d2luZG93LmxvY2F0aW9uLmhvc3RuYW1lfS95b3V0dWJlaS92MS9wbGF5ZXI/a2V5PSR7YXBpS2V5fWA7XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgbW9kZTogIm5vLWNvcnMiLFxuICAgIG1ldGhvZDogIlBPU1QiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSxcbiAgfTtcbiAgY29uc3QgbmV3RW5kcG9pbnRSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgb3B0aW9ucyk7XG4gIGNvbnN0IHZpZGVvSW5mbyA9IGF3YWl0IG5ld0VuZHBvaW50UmVzcG9uc2UuanNvbigpO1xuICByZXR1cm4gdmlkZW9JbmZvO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcGxheWVyID0gKHBsYXllcl9nZXRWaWRlb0luZm8pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2dldC12aWRlby1pbmZvLWVuZHBvaW50cy9nbG9iYWxzLmpzXG5cblxuY29uc3QgZ2xvYmFsc19nZXRWaWRlb0luZm8gPSBhc3luYyBmdW5jdGlvbiAoaWQpIHtcbiAgLyogZXNsaW50LWRpc2FibGUgbm8tc2hhZG93ICovXG4gIGNvbnN0IGNoZWNrZXIgPSBhc3luYyBmdW5jdGlvbiAoaWQpIHtcbiAgICBpZiAod2luZG93Lnl0SW5pdGlhbFBsYXllclJlc3BvbnNlICYmXG4gICAgICAgIHdpbmRvdy55dEluaXRpYWxQbGF5ZXJSZXNwb25zZS52aWRlb0RldGFpbHMgJiZcbiAgICAgICAgd2luZG93Lnl0SW5pdGlhbFBsYXllclJlc3BvbnNlLnZpZGVvRGV0YWlscy52aWRlb0lkID09PSBpZFxuICAgICkge1xuICAgICAgcmV0dXJuIHdpbmRvdy55dEluaXRpYWxQbGF5ZXJSZXNwb25zZTtcbiAgICB9XG4gICAgaWYgKHdpbmRvdy5sYXN0UmVzcG9uc2UpIHtcbiAgICAgIGF3YWl0IHdpbmRvdy5sYXN0UmVzcG9uc2UucmVxdWVzdDtcbiAgICAgIGNvbnNvbGUubG9nKHdpbmRvdy5sYXN0UmVzcG9uc2UpO1xuICAgICAgY29uc3QgdmlkZW9JbmZvID0gYXdhaXQgd2luZG93Lmxhc3RSZXNwb25zZS5ib2R5Lmpzb24oKTtcbiAgICAgIGRlbGV0ZSB3aW5kb3cubGFzdFJlc3BvbnNlO1xuICAgICAgaWYgKHZpZGVvSW5mby52aWRlb0RldGFpbHMgJiYgdmlkZW9JbmZvLnZpZGVvRGV0YWlscy52aWRlb0lkID09PSBpZCkge1xuICAgICAgICByZXR1cm4gdmlkZW9JbmZvO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBpbmplY3Rfc2NyaXB0KGRvY3VtZW50LCBjaGVja2VyLCBpZCk7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGdldF92aWRlb19pbmZvX2VuZHBvaW50c19nbG9iYWxzID0gKGdsb2JhbHNfZ2V0VmlkZW9JbmZvKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvc2VydmljZXMveW91dHViZS91dGlscy9wYXJzZS1kZWNzaWcuanNcblxuXG5jb25zdCAkID0gKHMsIHggPSBkb2N1bWVudCkgPT4geC5xdWVyeVNlbGVjdG9yKHMpO1xuY29uc3QgbG9nZ2VyID0gbWFrZV9sb2dnZXIoY29uc29sZSwgIllUREwiLCB0cnVlKTtcblxubGV0IG11dGV4O1xubGV0IHRyYW5zZm9ybWF0b3I7XG5jb25zdCBtYXBwZXIgPSB7fTtcblxuY29uc3QgZ2V0SW5pdGlhbEZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uIChiYXNlanMpIHtcbiAgY29uc3QgcGF0dGVybnMgPSBbXG4gICAgL1xcYltjc11cXHMqJiZcXHMqW2FkZl1cXC5zZXRcXChbXixdK1xccyplbmNvZGVVUklDb21wb25lbnRcXHMqXFwoXFxzKihbYS16QS1aMC05JF0rKVxcKC8sXG4gICAgL1xcYlthLXpBLVowLTldK1xccyomJlxccypbYS16QS1aMC05XStcXC5zZXRcXChbXixdK1xccyosXFxzKmVuY29kZVVSSUNvbXBvbmVudFxccypcXChcXHMqKFthLXpBLVowLTkkXSspXFwoLyxcbiAgICAvKD86XFxifFteYS16QS1aMC05JF0pKFthLXpBLVowLTkkXXsyfSlcXHMqPVxccypmdW5jdGlvblxcKFxccyphXFxzKlxcKVxccypcXHtcXHMqYVxccyo9XFxzKmFcXC5zcGxpdFxcKFxccyoiIlxcc1xcKS8sXG4gICAgLyhbYS16QS1aMC05JF0rKVxccyo9XFxzKmZ1bmN0aW9uXFwoXFxzKmFcXHMqXFwpXFxzKntcXHMqYVxccyo9XFxzKmFcXC5zcGxpdFxcKFxccyoiIlxccypcXCkvLFxuICAgIC8oPzpbIlwnXSlzaWduYXR1cmVcXDFcXHMqLFxccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC9cXC5zaWdcXHxcXHwoW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC95dFxcLmFrYW1haXplZFxcLm5ldFxcL1xcKVxccypcXHxcXHxcXHMqLio/XFxzKltjc11cXHMqJiZcXHMqW2FkZl1cXC5zZXRcXChbXixdK1xccyosXFxzKig/OmVuY29kZVVSSUNvbXBvbmVudFxccypcXCgpP1xccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC9cXGJbY3NdXFxzKiYmXFxzKlthZGZdXFwuc2V0XFwoW14sXStcXHMqLFxccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC8vIC9cXGJbYS16QS1aMC05XStcXHMqJiZcXHMqW2EtekEtWjAtOV0rXFwuc2V0XFwoW14sXStcXHMqLFxccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC9cXGJjXFxzKiYmXFxzKmFcXC5zZXRcXChbXixdK1xccyosXFxzKlxcKFteKV0qXFwpXFxzKlxcKFxccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICAgIC9cXGJjXFxzKiYmXFxzKlthLXpBLVowLTldK1xcLnNldFxcKFteLF0rXFxzKixcXHMqXFwoW14pXSpcXClcXHMqXFwoXFxzKihbYS16QS1aMC05JF0rKVxcKC8sXG4gICAgL1xcYmNcXHMqJiZcXHMqW2EtekEtWjAtOV0rXFwuc2V0XFwoW14sXStcXHMqLFxccypcXChbXildKlxcKVxcc1xcKFxccyooW2EtekEtWjAtOSRdKylcXCgvLFxuICBdO1xuICAvKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLXN5bnRheCwgZ3VhcmQtZm9yLWluICovXG4gIGZvciAoY29uc3QgcGF0dGVybiBpbiBwYXR0ZXJucykge1xuICAgIGNvbnN0IG1hdGNoID0gYmFzZWpzLm1hdGNoKHBhdHRlcm5zW3BhdHRlcm5dKTtcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIGNvbnNvbGUubG9nKCJNQVRDSEVEISEhIiwgcGF0dGVybnNbcGF0dGVybl0sIG1hdGNoKTtcbiAgICAgIHJldHVybiBtYXRjaFsxXTtcbiAgICB9XG4gICAgY29uc29sZS5sb2coIk1JU1NFRCEhISIsIHBhdHRlcm4pO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuY29uc3QgZ2V0VHJhbnNmb3JtUGxhbiA9IGZ1bmN0aW9uIChiYXNlanMpIHtcbiAgY29uc3QgbmFtZSA9IGdldEluaXRpYWxGdW5jdGlvbk5hbWUoYmFzZWpzKTtcbiAgY29uc3QgcmVnZXhwID0gYCR7bmFtZX09ZnVuY3Rpb25cXFxcKFxcXFx3XFxcXClcXFxce1thLXo9XFxcXC5cXFxcKFxcXFwiXFxcXCldKjsoLiopOyg/Oi4rKVxcXFx9YDtcbiAgY29uc3QgcGxhbiA9IGJhc2Vqcy5tYXRjaChuZXcgUmVnRXhwKHJlZ2V4cCkpO1xuICBjb25zdCB2YXJOYW1lID0gcGxhblsxXS5zcGxpdCgiOyIpWzBdLm1hdGNoKC9eKFxcdyspXFxXLyk7XG4gIHJldHVybiBwbGFuID8geyBwbGFuOiBwbGFuWzBdLCB2YXJOYW1lOiB2YXJOYW1lWzFdIH0gOiBudWxsO1xufTtcblxuY29uc3QgZGVjaXBoZXJTaWcgPSBhc3luYyAoc2lnKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKCFtdXRleCkge1xuICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tYXN5bmMtcHJvbWlzZS1leGVjdXRvciAqL1xuICAgICAgbXV0ZXggPSBuZXcgUHJvbWlzZShhc3luYyAocmVzKSA9PiB7XG4gICAgICAgIGNvbnN0IGJhc2Vqc1VybCA9ICQoInNjcmlwdFtzcmMkPVxcImJhc2UuanNcXCJdIikuc3JjO1xuICAgICAgICBjb25zdCBiYXNlanMgPSBhd2FpdCAoYXdhaXQgZmV0Y2goYmFzZWpzVXJsKSkudGV4dCgpO1xuICAgICAgICBjb25zdCB7IHBsYW4sIHZhck5hbWUgfSA9IGdldFRyYW5zZm9ybVBsYW4oYmFzZWpzKTtcblxuICAgICAgICBpZiAoIXBsYW4pIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNhblwndCBmaWd1cmUgb3V0IHRyYW5mcm9tYXRpb24gcGxhbiIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBsYW5Cb2R5ID0gcGxhbi5tYXRjaCgveyhbXl0qPyl9LylbMV07XG4gICAgICAgIGNvbnN0IGZpcnN0QXJnTmFtZSA9IHBsYW4ubWF0Y2goL2Z1bmN0aW9uXFwoKFteKV0qKVxcKXsvKVsxXTtcbiAgICAgICAgaWYgKCF2YXJOYW1lKSB7XG4gICAgICAgICAgLy8gdG9kbyBFUlJPUlxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybU9iamVjdFBhdHRlcm4gPSBuZXcgUmVnRXhwKGB2YXJcXFxccyske3Zhck5hbWV9PXsoW15dKj8pfTtgKTtcbiAgICAgICAgY29uc3QgdHJhbnNmb3JtT2JqZWN0U3JjID0gYmFzZWpzLm1hdGNoKHRyYW5zZm9ybU9iamVjdFBhdHRlcm4pO1xuICAgICAgICBjb25zdCB0cmFuc2Zvcm1PYmplY3QgPSB0cmFuc2Zvcm1PYmplY3RTcmNbMV07XG4gICAgICAgIHRyYW5zZm9ybU9iamVjdC5zcGxpdCgiXFxuIikuZm9yRWFjaCgocmVjKSA9PiB7XG4gICAgICAgICAgY29uc3QgW25hbWUsIGZ1bmNdID0gcmVjLnNwbGl0KCI6Iik7XG4gICAgICAgICAgY29uc3QgYXJncyA9IGZ1bmMubWF0Y2goL2Z1bmN0aW9uXFwoKC4qPylcXCl7KC4qPyl9Lyk7XG4gICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tbmV3LWZ1bmMgKi9cbiAgICAgICAgICBtYXBwZXJbbmFtZV0gPSBuZXcgRnVuY3Rpb24oLi4uYXJnc1sxXS5zcGxpdCgiLCIpLCBhcmdzWzJdKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRyYW5zZm9ybWF0b3IgPSBuZXcgRnVuY3Rpb24oZmlyc3RBcmdOYW1lLCB2YXJOYW1lLCBwbGFuQm9keSk7XG4gICAgICAgIHJlcygpO1xuICAgICAgfSk7XG4gICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWFzeW5jLXByb21pc2UtZXhlY3V0b3IgKi9cbiAgICB9XG4gICAgYXdhaXQgbXV0ZXg7XG4gICAgcmV0dXJuIHRyYW5zZm9ybWF0b3Ioc2lnLCBtYXBwZXIpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nZ2VyLmVycm9yKCJwYXJzZWRlY3NpZyBlcnJvcjogJW8iLCBlKTtcbiAgICB0aHJvdyBlO1xuICB9XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBwYXJzZV9kZWNzaWcgPSAoZGVjaXBoZXJTaWcpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2dldC12aWRlby1pbmZvLWVuZHBvaW50cy9pbmRleC5qc1xuXG5cblxuXG5cbmNvbnN0IGlzQWNjZXB0YWJsZSA9IGZ1bmN0aW9uIChyZXNwb25zZSwgaWQpIHtcbiAgaWYgKCFyZXNwb25zZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAoIXJlc3BvbnNlLnZpZGVvRGV0YWlscyB8fCByZXNwb25zZS52aWRlb0RldGFpbHMudmlkZW9JZCAhPT0gaWQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKCFyZXNwb25zZS5zdHJlYW1pbmdEYXRhKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZ2V0X3ZpZGVvX2luZm9fZW5kcG9pbnRzID0gKGFzeW5jIGZ1bmN0aW9uIChpZCkge1xuICBsZXQgcGxheWVyUmVzcG9uc2UgPSBhd2FpdCBnZXRfdmlkZW9faW5mb19lbmRwb2ludHNfZ2xvYmFscyhpZCk7XG4gIGlmIChpc0FjY2VwdGFibGUocGxheWVyUmVzcG9uc2UsIGlkKSkge1xuICAgIGNvbnNvbGUubG9nKCJuaWNlIHNob3QsIHZpZGVvSW5mbyBhbHJlYWR5IGZldGNoZWQuIiwgcGxheWVyUmVzcG9uc2UpO1xuICB9IGVsc2Uge1xuICAgIHBsYXllclJlc3BvbnNlID0gYXdhaXQgZ2V0X3ZpZGVvX2luZm8oaWQpO1xuICAgIC8vIGNvbnNvbGUubG9nKCJmaXJzdCBhdHRlbXB0IHJlc3BvbnNlOiIsIHBsYXllclJlc3BvbnNlKTtcbiAgICBpZiAoIWlzQWNjZXB0YWJsZShwbGF5ZXJSZXNwb25zZSwgaWQpKSB7XG4gICAgICBwbGF5ZXJSZXNwb25zZSA9IGF3YWl0IHBsYXllcihpZCk7XG4gICAgICAvLyBjb25zb2xlLmxvZygic2Vjb25kIGF0dGVtcHQgcmVzcG9uc2UiLCBwbGF5ZXJSZXNwb25zZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFpc0FjY2VwdGFibGUocGxheWVyUmVzcG9uc2UsIGlkKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKHBsYXllclJlc3BvbnNlLnN0cmVhbWluZ0RhdGEuYWRhcHRpdmVGb3JtYXRzKSB7XG4gICAgLyogZXNsaW50LWRpc2FibGUgbm8tcmVzdHJpY3RlZC1zeW50YXgsIG5vLWF3YWl0LWluLWxvb3AgKi9cbiAgICBmb3IgKGNvbnN0IHJlYyBvZiBwbGF5ZXJSZXNwb25zZS5zdHJlYW1pbmdEYXRhLmFkYXB0aXZlRm9ybWF0cykge1xuICAgICAgaWYgKHJlYy5zaWduYXR1cmVDaXBoZXIpIHtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhyZWMuc2lnbmF0dXJlQ2lwaGVyKTtcbiAgICAgICAgY29uc3Qgc2lnID0gYXdhaXQgcGFyc2VfZGVjc2lnKHBhcmFtcy5nZXQoInMiKSk7XG4gICAgICAgIHJlYy51cmwgPSBgJHtwYXJhbXMuZ2V0KCJ1cmwiKX0mc2lnPSR7c2lnfWA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHBsYXllclJlc3BvbnNlLnN0cmVhbWluZ0RhdGEuZm9ybWF0cykge1xuICAgIGZvciAoY29uc3QgcmVjIG9mIHBsYXllclJlc3BvbnNlLnN0cmVhbWluZ0RhdGEuZm9ybWF0cykge1xuICAgICAgaWYgKHJlYy5zaWduYXR1cmVDaXBoZXIpIHtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhyZWMuc2lnbmF0dXJlQ2lwaGVyKTtcbiAgICAgICAgY29uc3Qgc2lnID0gYXdhaXQgcGFyc2VfZGVjc2lnKHBhcmFtcy5nZXQoInMiKSk7XG4gICAgICAgIHJlYy51cmwgPSBgJHtwYXJhbXMuZ2V0KCJ1cmwiKX0mc2lnPSR7c2lnfWA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8qIGVzbGludC1lbmFibGUgbm8tcmVzdHJpY3RlZC1zeW50YXgsIG5vLWF3YWl0LWluLWxvb3AgKi9cbiAgcmV0dXJuIHBsYXllclJlc3BvbnNlO1xufSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3NlcnZpY2VzL3lvdXR1YmUvdXRpbHMvdHJhbnNmb3JtLXZpZGVvLWluZm8uanNcblxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB0cmFuc2Zvcm1fdmlkZW9faW5mbyA9IChhc3luYyBmdW5jdGlvbiAoZGF0YSwgaWQpIHtcbiAgY29uc3QgeyB0aXRsZSB9ID0gZGF0YS52aWRlb0RldGFpbHM7XG4gIGNvbnN0IGluamVjdFRpdGxlID0gaXRlbXMgPT4gaXRlbXMubWFwKGl0ZW0gPT4gKHsgLi4uaXRlbSwgdGl0bGUgfSkpO1xuXG4gIGNvbnN0IHZpZGVvID0gIWRhdGEuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHMgPyBbXSA6IGRhdGEuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHNcbiAgICAuZmlsdGVyKHggPT4geC5taW1lVHlwZS5pbmNsdWRlcygidmlkZW8vIikpXG4gICAgLm1hcCgob2JqLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgeyBmcHMgfSA9IG9iajtcbiAgICAgIGNvbnN0IFssIHR5cGVdID0gL3ZpZGVvXFwvKFteO10rKTsvLmV4ZWMob2JqLm1pbWVUeXBlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG9iaixcbiAgICAgICAgcXVhbGl0eU51bTogcGFyc2VJbnQob2JqLnF1YWxpdHlMYWJlbCwgMTApLFxuICAgICAgICBxdWFsaXR5TGFiZWw6IG9iai5xdWFsaXR5TGFiZWwsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIG1pbWVUeXBlOiBvYmoubWltZVR5cGUsXG4gICAgICAgIGNvbnRlbnRMZW5ndGg6IHBhcnNlSW50KG9iai5jb250ZW50TGVuZ3RoLCAxMCksXG4gICAgICAgIGZwczogZnBzIHx8IDMwLFxuICAgICAgICBoZWlnaHQ6IG9iai5oZWlnaHQsXG4gICAgICAgIHdpZHRoOiBvYmoud2lkdGgsXG4gICAgICAgIG11eGFibGU6IHRydWUsXG4gICAgICAgIGlkOiBpbmRleCxcbiAgICAgIH07XG4gICAgfSlcbiAgICAuc29ydCgoYSwgYikgPT4ge1xuICAgICAgaWYgKGEucXVhbGl0eU51bSA9PT0gYi5xdWFsaXR5TnVtKSB7XG4gICAgICAgIHJldHVybiBiLmZwcyAtIGEuZnBzOyAvLyBleDogMzAtNjA9LTMwLCB0aGVuIGEgd2lsbCBiZSBwdXQgYmVmb3JlIGJcbiAgICAgIH1cbiAgICAgIHJldHVybiBiLnF1YWxpdHlOdW0gLSBhLnF1YWxpdHlOdW07XG4gICAgfSk7XG4gIGNvbnN0IGF1ZGlvID0gIWRhdGEuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHMgPyBbXSA6IGRhdGEuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHNcbiAgICAuZmlsdGVyKHggPT4geC5taW1lVHlwZS5pbmNsdWRlcygiYXVkaW8vIikpXG4gICAgLm1hcChvYmogPT4gKHtcbiAgICAgIG1pbWVUeXBlOiBvYmoubWltZVR5cGUsXG4gICAgICBiaXRyYXRlOiBvYmouYml0cmF0ZSxcbiAgICAgIG9iaixcbiAgICB9KSk7XG4gIGNvbnN0IGlzTGl2ZVN0cmVhbSA9IGRhdGEucGxheWFiaWxpdHlTdGF0dXMubGl2ZVN0cmVhbWFiaWxpdHk7XG5cbiAgY29uc3Qgc3RyZWFtcyA9ICFkYXRhLnN0cmVhbWluZ0RhdGEuZm9ybWF0cyA/IFtdIDogKGF3YWl0IFByb21pc2UuYWxsKGRhdGEuc3RyZWFtaW5nRGF0YS5mb3JtYXRzLm1hcChhc3luYyAoc3RyZWFtKSA9PiB7XG4gICAgY29uc3QgcXVhbGl0eU51bSA9IHBhcnNlSW50KHN0cmVhbS5xdWFsaXR5TGFiZWwsIDEwKTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMgKi9cbiAgICBjb25zdCBbXywgdHlwZV0gPSAvdmlkZW9cXC8oW147XSspOy8uZXhlYyhzdHJlYW0ubWltZVR5cGUpO1xuICAgIGNvbnN0IGFkZEluZm8gPSB7fTtcbiAgICB0cnkge1xuICAgICAgYWRkSW5mby5jb250ZW50TGVuZ3RoID0gc3RyZWFtLmNvbnRlbnRMZW5ndGggPyBwYXJzZUludChzdHJlYW0uY29udGVudExlbmd0aCwgMTApIDogYXdhaXQgZ2V0Q29udGVudExlbmd0aChzdHJlYW0udXJsKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBub3RoaW5nXG4gICAgfVxuICAgIGlmIChhd2FpdCBjaGVja0RpcmVjdERvd25sb2FkKGAke3N0cmVhbS51cmx9JnRpdGxlPSR7dGl0bGV9YCkpIHtcbiAgICAgIGFkZEluZm8uZGlyZWN0VXJsID0gYCR7c3RyZWFtLnVybH0mdGl0bGU9JHt0aXRsZX1gO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgb2JqOiBzdHJlYW0sXG4gICAgICAuLi5zdHJlYW0sXG4gICAgICBxdWFsaXR5TnVtLFxuICAgICAgcXVhbGl0eUxhYmVsOiBzdHJlYW0ucXVhbGl0eUxhYmVsLFxuICAgICAgdHlwZSxcbiAgICAgIC4uLmFkZEluZm8sXG4gICAgfTtcbiAgfSkpKS5maWx0ZXIoc3RyZWFtID0+IHN0cmVhbS5kaXJlY3RVcmwgfHwgc3RyZWFtLmNvbnRlbnRMZW5ndGgpO1xuICBjb25zdCBleHBpcmVzID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyBwYXJzZUludChkYXRhLnN0cmVhbWluZ0RhdGEuZXhwaXJlc0luU2Vjb25kcywgMTApO1xuICBjb25zdCByZXN1bHQgPSB7XG4gICAgaWQsXG4gICAgaXNMaXZlU3RyZWFtLFxuICAgIGV4cGlyZXMsXG4gICAgc3RyZWFtczogaW5qZWN0VGl0bGUoc3RyZWFtcyksXG4gICAgdmlkZW86IGluamVjdFRpdGxlKHZpZGVvKSxcbiAgICBhdWRpbzogaW5qZWN0VGl0bGUoYXVkaW8pLFxuICB9O1xuICByZXR1cm4gcmVzdWx0O1xufSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3V0aWxzL2dsb2JhbC1zdG9yYWdlLXRtLmpzXG5jb25zdCBnZXQgPSBmdW5jdGlvbiAoa2V5KSB7XG4gIGNvbnN0IHZhbHVlID0gd2luZG93LkdNX2dldFZhbHVlKGtleSk7XG4gIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlc29sdmUodmFsdWUgPyBKU09OLnBhcnNlKHZhbHVlKSA6IHZhbHVlKSk7XG59O1xuXG5jb25zdCBzZXQgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICB3aW5kb3cuR01fc2V0VmFsdWUoa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xufTtcblxuY29uc3QgdmFsaWRhdGVLZXkgPSBmdW5jdGlvbiAoa2V5KSB7XG4gIGNvbnN0IHZhbHVlID0gd2luZG93LkdNX2dldFZhbHVlKGtleSk7XG4gIGlmICh2YWx1ZSkge1xuICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmV4cGlyZXMgJiYgRGF0ZS5ub3coKSAvIDEwMDAgPiBkYXRhLmV4cGlyZXMpIHtcbiAgICAgIHdpbmRvdy5HTV9kZWxldGVWYWx1ZShrZXkpO1xuICAgIH1cbiAgfVxufTtcblxuY29uc3QgdmFsaWRhdGVZb3V0dWJlQ2FjaGUgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGtleXMgPSB3aW5kb3cuR01fbGlzdFZhbHVlcygpLmZpbHRlcihrZXkgPT4ga2V5LnN0YXJ0c1dpdGgoInlvdXR1YmVfIikpO1xuICBrZXlzLmZvckVhY2goa2V5ID0+IHNldFRpbWVvdXQoKCkgPT4gdmFsaWRhdGVLZXkoa2V5KSwgMCkpO1xufTtcblxuY29uc3QgcnVuVmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIHZhbGlkYXRlWW91dHViZUNhY2hlKCk7XG59O1xuXG5jb25zdCBvYnNlcnZlID0gZnVuY3Rpb24gKGtleSwgbGlzdGVuZXIpIHtcbiAgd2luZG93LkdNX2FkZFZhbHVlQ2hhbmdlTGlzdGVuZXIoa2V5LCBsaXN0ZW5lcik7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBnbG9iYWxfc3RvcmFnZV90bSA9ICh7XG4gIGdldCxcbiAgc2V0LFxuICBvYnNlcnZlLFxuICBydW5WYWxpZGF0ZSxcbn0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL3V0aWxzL2NhY2hlLmpzXG5cblxuY29uc3QgdXBkYXRlQ2FjaGUgPSBmdW5jdGlvbiAoaWQsIGRhdGEpIHtcbiAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KGB5b3V0dWJlXyR7aWR9YCwgZGF0YSk7XG4gIGdsb2JhbF9zdG9yYWdlX3RtLnJ1blZhbGlkYXRlKCk7XG59O1xuXG5jb25zdCBjaGVja0NhY2hlID0gYXN5bmMgZnVuY3Rpb24gKGlkKSB7XG4gIGNvbnN0IGluZm8gPSBhd2FpdCBnbG9iYWxfc3RvcmFnZV90bS5nZXQoYHlvdXR1YmVfJHtpZH1gKTtcbiAgY29uc29sZS5sb2coIkNBQ0hFISEhIiwgaW5mbyk7XG4gIHJldHVybiBpbmZvICYmIERhdGUubm93KCkgLyAxMDAwIDwgaW5mby5leHBpcmVzID8gaW5mbyA6IG51bGw7XG59O1xuXG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvc2VydmljZXMveW91dHViZS9nZXQtdmlkZW8taW5mby5qc1xuXG5cblxuXG5cblxuY29uc3QgZ2V0X3ZpZGVvX2luZm9fbG9nZ2VyID0gbWFrZV9sb2dnZXIoY29uc29sZSwgIllUREwiLCB0cnVlKTtcblxuY29uc3QgeW91dHViZV9nZXRfdmlkZW9faW5mb19nZXRWaWRlb0luZm8gPSBhc3luYyAodXJsKSA9PiB7XG4gIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsKTtcbiAgLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuICBjb25zdCBpZCA9IG5ldyBVUkxTZWFyY2hQYXJhbXModXJsT2JqLnNlYXJjaCB8fCBsb2NhdGlvbi5zZWFyY2gpLmdldCgidiIpO1xuICBjb25zb2xlLmxvZygidXJsOiAiLCB1cmwsICJJRCEhISIsIGlkKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCBjaGVja0NhY2hlKGlkKTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0X3ZpZGVvX2luZm9fZW5kcG9pbnRzKGlkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0cmFuc2Zvcm1fdmlkZW9faW5mbyhkYXRhLCBpZCk7XG5cbiAgICBjb25zb2xlLmxvZygiY2FjaGUgbWlzc2VkIik7XG4gICAgdXBkYXRlQ2FjaGUoaWQsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyciA9PT0gIkFkYmxvY2sgY29uZmxpY3QiKSB7XG4gICAgICAvLyBUT0RPIGJlaGF2aW9yXG4gICAgICAvLyBjb25zdCBzdHIgPSBhcHAuc3RyaW5ncy5nZXRfdmlkZW9fZmFpbGVkLnJlcGxhY2UoIiVzIiwgYGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2dldF92aWRlb19pbmZvP3ZpZGVvX2lkPSR7aWR9JmVsPWRldGFpbHBhZ2VgKTtcbiAgICAgIC8vIHByb21wdChzdHIsICJAQHx8d3d3LnlvdXR1YmUuY29tL2dldF92aWRlb19pbmZvPyo9ZGV0YWlscGFnZSR4aHIsZG9tYWluPXlvdXR1YmUuY29tIik7XG4gICAgfVxuICAgIGdldF92aWRlb19pbmZvX2xvZ2dlci5lcnJvcigibG9hZCIsIGVycik7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB5b3V0dWJlX2dldF92aWRlb19pbmZvID0gKHlvdXR1YmVfZ2V0X3ZpZGVvX2luZm9fZ2V0VmlkZW9JbmZvKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvc2VydmljZXMveW91dHViZS9zbmFwLmpzXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB5b3V0dWJlX3NuYXAgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7XG4gIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpO1xuICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7XG4gIC8vIGNvbnN0IHJhdGlvID0gdmlkZW8udmlkZW9XaWR0aCAvIHZpZGVvLnZpZGVvSGVpZ2h0O1xuICBjb25zdCB3ID0gdmlkZW8udmlkZW9XaWR0aDtcbiAgY29uc3QgaCA9IHZpZGVvLnZpZGVvSGVpZ2h0O1xuICBjYW52YXMud2lkdGggPSB2aWRlby52aWRlb1dpZHRoO1xuICBjYW52YXMuaGVpZ2h0ID0gdmlkZW8udmlkZW9IZWlnaHQ7XG4gIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgdywgaCk7XG4gIGNvbnRleHQuZHJhd0ltYWdlKHZpZGVvLCAwLCAwLCB3LCBoKTtcbiAgY29uc3QgZnVsbFF1YWxpdHkgPSBjYW52YXMudG9EYXRhVVJMKCJpbWFnZS9qcGVnIiwgMS4wKTtcbiAgcmV0dXJuIGZ1bGxRdWFsaXR5O1xufSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3NlcnZpY2VzL3lvdXR1YmUvbGFuZy1kZXRlY3QuanNcbmNvbnN0IGxhbmdfZGV0ZWN0X2h0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJodG1sIik7XG5cbmNvbnN0IGxhbmdfZGV0ZWN0X2dldExhbmcgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGh0bWxBdHRyTGFuZyA9IGxhbmdfZGV0ZWN0X2h0bWwuZ2V0QXR0cmlidXRlKCJsYW5nIik7XG4gIGNvbnN0IGNpc0xhbmdzID0gWyJydS1SVSIsICJ1ay1VQSIsICJiZS1CWSIsICJray1LWiIsICJreS1LRyIsICJoeS1BTSIsICJrYS1HRSIsICJhei1MYXRuLUFaIl07XG4gIGNvbnN0IGxuZyA9IGNpc0xhbmdzLmluZGV4T2YoaHRtbEF0dHJMYW5nKSAhPT0gLTEgPyAicnUiIDogImVuIjtcbiAgcmV0dXJuIGxuZztcbn07XG5cbmNvbnN0IHN0YXJ0TGFuZ09ic2VydmVyID0gZnVuY3Rpb24gKGdldExhbmdGcm9tU2V0dGluZ3MsIHNldExhbmcpIHtcbiAgY29uc3QgbG9jYWxlT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7XG4gICAgbXV0YXRpb25zLnNvbWUoKG11dGF0aW9uKSA9PiB7XG4gICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gImF0dHJpYnV0ZXMiICYmIG11dGF0aW9uLmF0dHJpYnV0ZU5hbWUgPT09ICJsYW5nIikge1xuICAgICAgICBpZiAoZ2V0TGFuZ0Zyb21TZXR0aW5ncygpID09PSAiYXV0b0RldGVjdCIpIHtcbiAgICAgICAgICBzZXRMYW5nKGxhbmdfZGV0ZWN0X2dldExhbmcoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xuICBsb2NhbGVPYnNlcnZlci5vYnNlcnZlKGxhbmdfZGV0ZWN0X2h0bWwsIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbn07XG5cblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2Rpci1kZXRlY3QuanNcbmNvbnN0IGdldERpciA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImJvZHkiKTtcbiAgY29uc3QgZGlyID0gYm9keS5nZXRBdHRyaWJ1dGUoImRpciIpID09PSAicnRsIiA/ICJydGwiIDogImx0ciI7XG4gIHJldHVybiBkaXI7XG59O1xuXG5jb25zdCBzdGFydERpck9ic2VydmVyID0gZnVuY3Rpb24gKHNldERpcikge1xuICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpO1xuICBjb25zdCBkaXJPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICBtdXRhdGlvbnMuc29tZSgobXV0YXRpb24pID0+IHtcbiAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAiYXR0cmlidXRlcyIgJiYgbXV0YXRpb24uYXR0cmlidXRlTmFtZSA9PT0gImRpciIpIHtcbiAgICAgICAgc2V0RGlyKGdldERpcigpKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH0pO1xuICBkaXJPYnNlcnZlci5vYnNlcnZlKGJvZHksIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbn07XG5cblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL3RoZW1lLWRldGVjdC5qc1xuY29uc3QgdGhlbWVfZGV0ZWN0X2h0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJodG1sIik7XG5cbmNvbnN0IGdldFRoZW1lID0gZnVuY3Rpb24gKCkge1xuICBjb25zdCB0aGVtZSA9IHRoZW1lX2RldGVjdF9odG1sLmdldEF0dHJpYnV0ZSgiZGFyayIpID09PSAidHJ1ZSIgPyAiZGFyayIgOiAiZGVmYXVsdCI7XG4gIHJldHVybiB0aGVtZTtcbn07XG5cbmNvbnN0IHN0YXJ0VGhlbWVPYnNlcnZlciA9IGZ1bmN0aW9uIChzZXRUaGVtZSkge1xuICBjb25zdCB0aGVtZU9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4ge1xuICAgIG11dGF0aW9ucy5zb21lKChtdXRhdGlvbikgPT4ge1xuICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICJhdHRyaWJ1dGVzIiAmJiBtdXRhdGlvbi5hdHRyaWJ1dGVOYW1lID09PSAiZGFyayIpIHtcbiAgICAgICAgc2V0VGhlbWUoZ2V0VGhlbWUoKSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9KTtcblxuICB0aGVtZU9ic2VydmVyLm9ic2VydmUodGhlbWVfZGV0ZWN0X2h0bWwsIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbn07XG5cblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2luamVjdC5qc1xuY29uc3QgcGF0Y2hGZXRjaCA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgeCA9IHdpbmRvdy5mZXRjaDtcbiAgaWYgKCF4LnBhdGNoZWQpIHtcbiAgICB3aW5kb3cuZmV0Y2ggPSBmdW5jdGlvbiAoLi4ucmVzdCkge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IHguYXBwbHkodGhpcywgcmVzdCk7XG4gICAgICBpZiAoL3BsYXllclxcP2tleS8udGVzdChyZXN0WzBdLnVybCkpIHtcbiAgICAgICAgLy8gY29uc3QgaWQgPSAvcGxheWVyXFw/a2V5PShbXiZdKykvLmV4ZWMocmVzdFswXS51cmwpWzFdO1xuICAgICAgICB3aW5kb3cubGFzdFJlc3BvbnNlID0ge1xuICAgICAgICAgIHJlcXVlc3QsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHdhaXRGb3JSZXNwb25zZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHdpbmRvdy5sYXN0UmVzcG9uc2UucmVxdWVzdDtcbiAgICAgICAgICB3aW5kb3cubGFzdFJlc3BvbnNlLmJvZHkgPSByZXNwb25zZS5jbG9uZSgpO1xuICAgICAgICB9O1xuICAgICAgICB3YWl0Rm9yUmVzcG9uc2UoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXF1ZXN0O1xuICAgIH07XG4gICAgd2luZG93LmZldGNoLnBhdGNoZWQgPSB0cnVlO1xuICB9XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBpbmplY3QgPSAocGF0Y2hGZXRjaCk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3NlcnZpY2VzL3lvdXR1YmUvaW5kZXguanNcblxuXG5cblxuXG5cblxuXG5cblxuXG5cbmNsYXNzIHlvdXR1YmVfWW91dHViZSBleHRlbmRzIGNvbW1vbiB7XG4gIGNvbnN0cnVjdG9yKHdpZGdldCwgaGFuZGxlcnMpIHtcbiAgICBzdXBlcih3aWRnZXQsIGhhbmRsZXJzKTtcbiAgICB0aGlzLnNlcnZpY2UgPSAieW91dHViZSI7XG4gIH1cblxuICBjaGVja1NlcnZpY2UobG9jYXRpb24pIHtcbiAgICAvLyBjb25zb2xlLmxvZygiQ0hFQ0sgU0VSVklDRSEhISIsIGxvY2F0aW9uLmhyZWYpO1xuICAgIGNvbnN0IHVybCA9IGxvY2F0aW9uLmhyZWY7XG4gICAgaWYgKC9eaHR0cHM/OlxcL1xcLyg/Ond3d1xcLik/KD86eW91dHViZVxcLmNvbXx5b3V0dVxcLmJlKS8udGVzdCh1cmwpKSB7XG4gICAgICBjb25zdCBpc0VtYmVkID0gL15odHRwcz86XFwvXFwvKD86d3d3XFwuKT8oPzp5b3V0dWJlXFwuY29tfHlvdXR1XFwuYmUpXFwvZW1iZWQvLnRlc3QodXJsKTtcbiAgICAgIGlmICghaXNFbWJlZCkge1xuICAgICAgICBpbmplY3Rfc2NyaXB0KHdpbmRvdy5kb2N1bWVudCwgaW5qZWN0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAhaXNFbWJlZDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZXhhY3RNYXRjaCgpIHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLmN0eC53aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBjb25zdCBleGFjdCA9IC9eaHR0cHM/OlxcL1xcLyg/Ond3d1xcLik/KD86eW91dHViZVxcLmNvbXx5b3V0dVxcLmJlKVxcL3dhdGNoXFw/Ly50ZXN0KHVybCk7XG4gICAgaWYgKGV4YWN0KSB7XG4gICAgICBpbmplY3Rfc2NyaXB0KHdpbmRvdy5kb2N1bWVudCwgaW5qZWN0KTtcbiAgICB9XG4gICAgcmV0dXJuIGV4YWN0O1xuICB9XG5cbiAgaW5zZXJ0RG93bmxvYWRCdXR0b24oaG9sZGVyLCBidXR0b24pIHtcbiAgICBjb25zdCB0ID0gaG9sZGVyLnF1ZXJ5U2VsZWN0b3IoIiNtZXRhICNtZXRhLWNvbnRlbnRzICN0b3Atcm93ICNzdWJzY3JpYmUtYnV0dG9uIik7XG4gICAgY29uc3QgZSA9IGhvbGRlci5xdWVyeVNlbGVjdG9yKCIjdW5pZG93bmxvYWRlciIpO1xuICAgIGlmICh0ID09PSBudWxsIHx8IGUgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgdG9wUm93T2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7XG4gICAgICBpZiAodC5wYXJlbnROb2RlLmNvbnRhaW5zKGJ1dHRvbikpIHtcbiAgICAgICAgY29uc3Qgc3Vic2NyaWJlQnV0dG9uID0gdC5jaGlsZHJlbiAmJiB0LmNoaWxkcmVuWzBdICYmIHQuY2hpbGRyZW5bMF0uY2hpbGRyZW4gJiYgdC5jaGlsZHJlblswXS5jaGlsZHJlblswXTtcbiAgICAgICAgaWYgKHN1YnNjcmliZUJ1dHRvbikge1xuICAgICAgICAgIHRvcFJvd09ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICBjb25zdCBmb250ID0gKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN1YnNjcmliZUJ1dHRvblRleHQgPSBzdWJzY3JpYmVCdXR0b24uY2hpbGRyZW4gJiYgc3Vic2NyaWJlQnV0dG9uLmNoaWxkcmVuWzBdO1xuICAgICAgICAgICAgY29uc3Qgc3Vic2NyaWJlQnV0dG9uVGV4dFN0eWxlID0gc3Vic2NyaWJlQnV0dG9uVGV4dCAmJiBnZXRDb21wdXRlZFN0eWxlKHN1YnNjcmliZUJ1dHRvblRleHQpO1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9ICIiO1xuICAgICAgICAgICAgaWYgKHN1YnNjcmliZUJ1dHRvblRleHRTdHlsZSkge1xuICAgICAgICAgICAgICBjb25zdCBlbGVtZW50Rm9udCA9IHN1YnNjcmliZUJ1dHRvblRleHRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCJmb250Iik7XG4gICAgICAgICAgICAgIGlmIChlbGVtZW50Rm9udCkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGBmb250OiAke2VsZW1lbnRGb250fTtgO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZvbnRTdHlsZSA9IHN1YnNjcmliZUJ1dHRvblRleHRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCJmb250LXN0eWxlIik7XG4gICAgICAgICAgICAgICAgaWYgKGZvbnRTdHlsZSkgcmVzdWx0ICs9IGBmb250LXN0eWxlOiAke2ZvbnRTdHlsZX07YDtcbiAgICAgICAgICAgICAgICBjb25zdCBmb250VmFyaWFudCA9IHN1YnNjcmliZUJ1dHRvblRleHRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCJmb250LXZhcmlhbnQiKTtcbiAgICAgICAgICAgICAgICBpZiAoZm9udFZhcmlhbnQpIHJlc3VsdCArPSBgZm9udC12YXJpYW50OiAke2ZvbnRWYXJpYW50fTtgO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZvbnRXZWlnaHQgPSBzdWJzY3JpYmVCdXR0b25UZXh0U3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgiZm9udC13ZWlnaHQiKTtcbiAgICAgICAgICAgICAgICBpZiAoZm9udFdlaWdodCkgcmVzdWx0ICs9IGBmb250LXdlaWdodDogJHtmb250V2VpZ2h0fTtgO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gc3Vic2NyaWJlQnV0dG9uVGV4dFN0eWxlLmdldFByb3BlcnR5VmFsdWUoImZvbnQtc2l6ZSIpO1xuICAgICAgICAgICAgICAgIGlmIChmb250U2l6ZSkgcmVzdWx0ICs9IGBmb250LXNpemU6ICR7Zm9udFNpemV9O2A7XG4gICAgICAgICAgICAgICAgY29uc3QgZm9udEZhbWlseSA9IHN1YnNjcmliZUJ1dHRvblRleHRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCJmb250LWZhbWlseSIpO1xuICAgICAgICAgICAgICAgIGlmIChmb250RmFtaWx5KSByZXN1bHQgKz0gYGZvbnQtZmFtaWx5OiAke2ZvbnRGYW1pbHl9O2A7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfSkoKTtcbiAgICAgICAgICBjb25zdCBjc3MgPSB1dGlsc19taW5pZnkoYFxuICAgICAgICAgICAgI3VuaWRvd25sb2FkZXIge1xuICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICBtYXJnaW46IGF1dG8gNHB4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgI3VuaWRvd25sb2FkZXIuZ2FwOjpiZWZvcmUge1xuICAgICAgICAgICAgICBjb250ZW50OiAiIjtcbiAgICAgICAgICAgICAgd2lkdGg6IDZweDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICN1bmlkb3dubG9hZGVyLXNuYXBzaG90IHtcbiAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgICAgIHdpZHRoOiA0MHB4O1xuICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAjdW5pZG93bmxvYWRlci1kcm9wZG93bixcbiAgICAgICAgICAgICN1bmlkb3dubG9hZGVyLXRvb2x0aXAge1xuICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgICAgICAgIHRvcDogMDtcbiAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgIHotaW5kZXg6IDk5OTk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAjdW5pZG93bmxvYWRlci1ub3RpZmljYXRpb25zIHtcbiAgICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkO1xuICAgICAgICAgICAgICB6LWluZGV4OiA5OTk5O1xuICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uLXJldmVyc2U7XG4gICAgICAgICAgICAgIGJvdHRvbTogMDtcbiAgICAgICAgICAgICAgaGVpZ2h0OiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgI3VuaWRvd25sb2FkZXItYnRuLXRleHQge1xuICAgICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICAgICAgICAgICAgICAke2ZvbnR9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgYCk7XG4gICAgICAgICAgY29uc3QgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXTtcbiAgICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7XG4gICAgICAgICAgY29uc3QgaGVhZE9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGhlYWQuY29udGFpbnMoc3R5bGUpKSB7XG4gICAgICAgICAgICAgIGhlYWRPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvblByZWZlcmVuY2VCdXR0b24gPSB0LnF1ZXJ5U2VsZWN0b3IoIiNub3RpZmljYXRpb24tcHJlZmVyZW5jZS1idXR0b24iKTtcbiAgICAgICAgICAgICAgY29uc3Qgc2V0R2FwID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghbm90aWZpY2F0aW9uUHJlZmVyZW5jZUJ1dHRvbiB8fCBub3RpZmljYXRpb25QcmVmZXJlbmNlQnV0dG9uLmhhc0F0dHJpYnV0ZSgiaGlkZGVuIikpIHtcbiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJnYXAiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImdhcCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgc2V0R2FwKCk7XG4gICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb25QcmVmZXJlbmNlQnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgbmV3IE11dGF0aW9uT2JzZXJ2ZXIoc2V0R2FwKS5vYnNlcnZlKG5vdGlmaWNhdGlvblByZWZlcmVuY2VCdXR0b24sIHsgYXR0cmlidXRlczogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zdCBzZXRCdXR0b25IZWlnaHQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgic3R5bGUiLCBgaGVpZ2h0OiR7c3Vic2NyaWJlQnV0dG9uLm9mZnNldEhlaWdodH1weGApO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBzZXRCdXR0b25IZWlnaHQoKTtcbiAgICAgICAgICAgICAgbmV3IFJlc2l6ZU9ic2VydmVyKHNldEJ1dHRvbkhlaWdodCkub2JzZXJ2ZShzdWJzY3JpYmVCdXR0b24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGhlYWRPYnNlcnZlci5vYnNlcnZlKFxuICAgICAgICAgICAgaGVhZCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2UsXG4gICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogZmFsc2UsXG4gICAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICk7XG4gICAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0b3BSb3dPYnNlcnZlci5vYnNlcnZlKFxuICAgICAgdC5wYXJlbnROb2RlLFxuICAgICAge1xuICAgICAgICBhdHRyaWJ1dGVzOiBmYWxzZSxcbiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICBjaGFyYWN0ZXJEYXRhOiBmYWxzZSxcbiAgICAgICAgc3VidHJlZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBidXR0b24uc2V0QXR0cmlidXRlKCJzdHlsZSIsICJkaXNwbGF5Om5vbmUiKTtcbiAgICB0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGJ1dHRvbiwgdC5uZXh0U2libGluZyk7XG4gICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidW5pZG93bmxvYWRlci1zbmFwc2hvdCIpKSB7XG4gICAgICBjb25zdCBzbmFwc2hvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO1xuICAgICAgc25hcHNob3Quc2V0QXR0cmlidXRlKCJpZCIsICJ1bmlkb3dubG9hZGVyLXNuYXBzaG90Iik7XG4gICAgICAvLyBzbmFwc2hvdC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6bm9uZSIpO1xuICAgICAgY29uc3QgcmlnaHRDb250cm9scyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtcmlnaHQtY29udHJvbHMiKTtcbiAgICAgIGNvbnN0IHNldHRpbmdzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdG9vbHRpcC10YXJnZXQtaWQ9eXRwLXNldHRpbmdzLWJ1dHRvbl0iKTtcbiAgICAgIHJpZ2h0Q29udHJvbHMuaW5zZXJ0QmVmb3JlKHNuYXBzaG90LCBzZXR0aW5nc0J1dHRvbik7XG4gICAgfVxuICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVuaWRvd25sb2FkZXItbm90aWZpY2F0aW9ucyIpKSB7XG4gICAgICBjb25zdCBub3RpZmljYXRpb25zSG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7XG4gICAgICBub3RpZmljYXRpb25zSG9sZGVyLnNldEF0dHJpYnV0ZSgiaWQiLCAidW5pZG93bmxvYWRlci1ub3RpZmljYXRpb25zIik7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vdGlmaWNhdGlvbnNIb2xkZXIpO1xuICAgIH1cbiAgICBjb25zdCBhZGRDb250YWluZXIgPSAoaWQpID0+IHtcbiAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO1xuICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCJpZCIsIGlkKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgfVxuICAgIH07XG4gICAgYWRkQ29udGFpbmVyKCJ1bmlkb3dubG9hZGVyLWRyb3Bkb3duIik7XG4gICAgYWRkQ29udGFpbmVyKCJ1bmlkb3dubG9hZGVyLXRvb2x0aXAiKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGxheW91dElzUmVhZHkoKSB7XG4gICAgY29uc3QgbyA9IHRoaXMuY3R4LndpbmRvdy5kb2N1bWVudDtcbiAgICByZXR1cm4gby5xdWVyeVNlbGVjdG9yKCIjbWV0YSAjbWV0YS1jb250ZW50cyAjdG9wLXJvdyAjc3Vic2NyaWJlLWJ1dHRvbiIpICE9PSBudWxsO1xuICB9XG59XG5cblxuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BmZm1wZWcvZmZtcGVnL3NyYy9pbmRleC5qc1xudmFyIGZmbXBlZ19zcmMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdXRpbHMvbWVyZ2UtdmlkZW8uanNcblxuXG5sZXQgZmZXb3JrZXI7XG5sZXQgZmZXb3JrZXJMb2FkZWQ7XG5sZXQgbWVyZ2VfdmlkZW9fZHVyYXRpb24gPSAwO1xuXG5jb25zdCBnZXRTZWNvbmRzID0gZnVuY3Rpb24gKHRpbWUpIHtcbiAgY29uc3QgW2hvdXJzLCBtaW51dGVzLCBzZWNvbmRzXSA9IHRpbWUuc3BsaXQoIjoiKTtcbiAgcmV0dXJuIChwYXJzZUludChob3VycywgMTApICogNjAgKyBwYXJzZUludChtaW51dGVzLCAxMCkpICogNjAgKyBwYXJzZUludChzZWNvbmRzLnNwbGl0KCIuIilbMF0sIDEwKTtcbn07XG5cbmNvbnN0IG1lcmdlX3ZpZGVvX21ha2VMb2dnZXIgPSBmdW5jdGlvbiAocHJvZ3Jlc3NDYikge1xuICByZXR1cm4gKG0pID0+IHtcbiAgICAvLyBsb2dnZXIubG9nKG0ubWVzc2FnZSlcbiAgICBpZiAoIW0ubWVzc2FnZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAobS5hY3Rpb24gPT09ICJydW4iKSB7XG4gICAgICBpZiAoIW1lcmdlX3ZpZGVvX2R1cmF0aW9uKSB7XG4gICAgICAgIGlmIChtLm1lc3NhZ2UgJiYgbS5tZXNzYWdlLm1hdGNoKSB7XG4gICAgICAgICAgY29uc3QgZHVyYXRpb25NYXRjaCA9IG0ubWVzc2FnZS5tYXRjaCgvXlxccypEdXJhdGlvbjpcXHMrKFxcZFxcZDpcXGRcXGQ6XFxkXFxkKD86XFwuXFxkXFxkKT8pLyk7XG4gICAgICAgICAgaWYgKGR1cmF0aW9uTWF0Y2gpIHtcbiAgICAgICAgICAgIG1lcmdlX3ZpZGVvX2R1cmF0aW9uID0gZ2V0U2Vjb25kcyhkdXJhdGlvbk1hdGNoWzFdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHRpbWVNYXRjaCA9IG0ubWVzc2FnZS5tYXRjaCgvdGltZT0oXFxkXFxkOlxcZFxcZDpcXGRcXGQoPzpcXC5cXGRcXGQpKS8pO1xuICAgICAgICBpZiAodGltZU1hdGNoKSB7XG4gICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSAoKGdldFNlY29uZHModGltZU1hdGNoWzFdKSAvIG1lcmdlX3ZpZGVvX2R1cmF0aW9uKSAqIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICBwcm9ncmVzc0NiKHsgZmxvdzogIm11eGluZyIsIHByb2dyZXNzIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGVuZCA9IC92aWRlby4qYXVkaW8uKm90aGVyIHN0cmVhbXMuKmdsb2JhbCBoZWFkZXJzLiptdXhpbmcgb3ZlcmhlYWQvLnRlc3QobS5tZXNzYWdlKTtcbiAgICAgICAgICBpZiAoZW5kKSB7XG4gICAgICAgICAgICBtZXJnZV92aWRlb19kdXJhdGlvbiA9IDA7XG4gICAgICAgICAgICBwcm9ncmVzc0NiKHsgZmxvdzogIm11eGluZyIsIGVuZCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG59O1xuXG5jb25zdCBzdGFydFdvcmtlciA9IGZ1bmN0aW9uIChwcm9ncmVzc0NiKSB7XG4gIGlmICghZmZXb3JrZXJMb2FkZWQpIHtcbiAgICBmZldvcmtlciA9IE9iamVjdChmZm1wZWdfc3JjWyJjcmVhdGVXb3JrZXIiXSkoe1xuICAgICAgbG9nZ2VyOiBtZXJnZV92aWRlb19tYWtlTG9nZ2VyKHByb2dyZXNzQ2IpLFxuICAgIH0pO1xuICAgIGZmV29ya2VyTG9hZGVkID0gZmZXb3JrZXIubG9hZCgpO1xuICB9XG59O1xuXG5jb25zdCBtZXJnZVZpZGVvID0gYXN5bmMgZnVuY3Rpb24gKHZpZGVvLCBhdWRpbywgc2V0U3RvcFdvcmtlcikge1xuICAvLyBjb25zb2xlLmxvZygiTUVSR0UhISEiLCB2aWRlbywgYXVkaW8pO1xuICBhd2FpdCBmZldvcmtlckxvYWRlZDtcbiAgY29uc3Qgc3RvcCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAvLyBjb25zb2xlLmxvZygiU1RPUCBXT1JLRVIhISEiKTtcbiAgICBhd2FpdCBmZldvcmtlci50ZXJtaW5hdGUoKTtcbiAgICBhd2FpdCBmZldvcmtlci5yZW1vdmUoInZpZGVvLm1wNCIpO1xuICAgIGF3YWl0IGZmV29ya2VyLnJlbW92ZSgiYXVkaW8ubTRhIik7XG4gICAgYXdhaXQgZmZXb3JrZXIucmVtb3ZlKCJvdXRwdXQubXA0Iik7XG4gIH07XG4gIHNldFN0b3BXb3JrZXIoc3RvcCk7XG4gIGF3YWl0IGZmV29ya2VyLndyaXRlKCJhdWRpby5tNGEiLCBhdWRpbyk7XG4gIGF3YWl0IGZmV29ya2VyLndyaXRlKCJ2aWRlby5tcDQiLCB2aWRlbyk7XG4gIGF3YWl0IGZmV29ya2VyLnJ1bigiLWkgdmlkZW8ubXA0IC1pIGF1ZGlvLm00YSAtYyBjb3B5IG91dHB1dC5tcDQiLCB7XG4gICAgaW5wdXQ6IFsidmlkZW8ubXA0IiwgImF1ZGlvLm00YSJdLFxuICAgIG91dHB1dDogIm91dHB1dC5tcDQiLFxuICB9KTtcbiAgYXdhaXQgZmZXb3JrZXIucmVtb3ZlKCJ2aWRlby5tcDQiKTtcbiAgYXdhaXQgZmZXb3JrZXIucmVtb3ZlKCJhdWRpby5tNGEiKTtcbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBmZldvcmtlci5yZWFkKCJvdXRwdXQubXA0Iik7XG4gIGF3YWl0IGZmV29ya2VyLnJlbW92ZSgib3V0cHV0Lm1wNCIpO1xuICByZXR1cm4gZGF0YTtcbn07XG5cblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL3V0aWxzL3BhcnNlLXF1ZXJ5LmpzXG5jb25zdCBwYXJzZV9xdWVyeV9yZWR1Y2VyID0gZnVuY3Rpb24gKGFjYywgW2ssIHZdKSB7XG4gIGFjY1trXSA9IHY7XG4gIHJldHVybiBhY2M7XG59O1xuXG5jb25zdCBwYXJzZVF1ZXJ5ID0gcyA9PiBbLi4ubmV3IFVSTFNlYXJjaFBhcmFtcyhzKS5lbnRyaWVzKCldLnJlZHVjZShwYXJzZV9xdWVyeV9yZWR1Y2VyLCB7fSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHBhcnNlX3F1ZXJ5ID0gKHBhcnNlUXVlcnkpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2VtYmVkL2dldC12aWRlby1pbmZvLmpzXG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBlbWJlZF9nZXRfdmlkZW9faW5mb19sb2dnZXIgPSBtYWtlX2xvZ2dlcihjb25zb2xlLCAiWVRETCIsIHRydWUpO1xuXG5jb25zdCBlbWJlZF9nZXRfdmlkZW9faW5mb19nZXRWaWRlb0luZm8gPSBhc3luYyAodXJsKSA9PiB7XG4gIGxldCBpZDtcblxuICB0cnkge1xuICAgIGNvbnN0IHl0Y2ZnID0gYXdhaXQgdW5zYWZlX3dpbmRvdy5nZXQoInl0Y2ZnIik7XG5cbiAgICBjb25zb2xlLmxvZygieXRjZmcgLT4iLCB5dGNmZyk7XG5cbiAgICBpZCA9IHl0Y2ZnICYmIHl0Y2ZnLmRhdGFfICYmIHl0Y2ZnLmRhdGFfLlZJREVPX0lEO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cblxuICBpZiAoIWlkKSB7XG4gICAgaWYgKC8uKlxcLih5b3V0dWJlXFwuY29tfHlvdXR1YmUtbm9jb29raWVcXC5jb20pXFwvZW1iZWQvLnRlc3QodXJsKSkge1xuICAgICAgW2lkXSA9IHVybC5zcGxpdCgiLyIpLnBvcCgpLnNwbGl0KCI/Iik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsKTtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbiAgICAgIGlkID0gcGFyc2VfcXVlcnkodXJsT2JqLnNlYXJjaCB8fCBsb2NhdGlvbi5zZWFyY2gpLnY7XG4gICAgfVxuICB9XG5cbiAgY29uc29sZS5sb2coInVybDogIiwgdXJsLCAiSUQhISEiLCBpZCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCBjaGVja0NhY2hlKGlkKTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgZ2V0X3ZpZGVvX2luZm9fZW5kcG9pbnRzKGlkKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0cmFuc2Zvcm1fdmlkZW9faW5mbyhkYXRhLCBpZCk7XG5cbiAgICBjb25zb2xlLmxvZygiY2FjaGUgbWlzc2VkIik7XG4gICAgdXBkYXRlQ2FjaGUoaWQsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyciA9PT0gIkFkYmxvY2sgY29uZmxpY3QiKSB7XG4gICAgICAvLyBUT0RPIGJlaGF2aW9yXG4gICAgICAvLyBjb25zdCBzdHIgPSBhcHAuc3RyaW5ncy5nZXRfdmlkZW9fZmFpbGVkLnJlcGxhY2UoIiVzIiwgYGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2dldF92aWRlb19pbmZvP3ZpZGVvX2lkPSR7aWR9JmVsPWRldGFpbHBhZ2VgKTtcbiAgICAgIC8vIHByb21wdChzdHIsICJAQHx8d3d3LnlvdXR1YmUuY29tL2dldF92aWRlb19pbmZvPyo9ZGV0YWlscGFnZSR4aHIsZG9tYWluPXlvdXR1YmUuY29tIik7XG4gICAgfVxuICAgIGVtYmVkX2dldF92aWRlb19pbmZvX2xvZ2dlci5lcnJvcigibG9hZCIsIGVycik7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBlbWJlZF9nZXRfdmlkZW9faW5mbyA9IChlbWJlZF9nZXRfdmlkZW9faW5mb19nZXRWaWRlb0luZm8pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9zZXJ2aWNlcy95b3V0dWJlL2VtYmVkL2luZGV4LmpzXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBlbWJlZF9nZXRUaGVtZSA9ICgpID0+ICJkYXJrIjtcblxuY2xhc3MgZW1iZWRfWW91dHViZUVtYmVkIGV4dGVuZHMgY29tbW9uIHtcbiAgY29uc3RydWN0b3Iod2lkZ2V0LCBoYW5kbGVycykge1xuICAgIHN1cGVyKHdpZGdldCwgaGFuZGxlcnMpO1xuICAgIHRoaXMuc2VydmljZSA9ICJ5b3V0dWJlRW1iZWQiO1xuICAgIGlmICgvXmh0dHBzOlxcL1xcL3d3d1xcLnlvdXR1YmVcXC5jb21cXC9lbWJlZC8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikgfHxcbiAgICAgICAgL15odHRwcz86XFwvXFwvd3d3XFwueW91dHViZS1ub2Nvb2tpZVxcLmNvbVxcL2VtYmVkLy50ZXN0KHdpbmRvdy5sb2NhdGlvbi5ocmVmKSkge1xuICAgICAgY29uc3QgcmVjZWl2ZU1lc3NhZ2UgPSBhc3luYyBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgIGlmIChldnQuZGF0YS5tZXNzYWdlID09PSAiZ2V0VmlkZW9JbmZvIikge1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJWSURFTyBJTkZPISEhIiwgdmlkZW9JbmZvKTtcbiAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY2FzZS1kZWNsYXJhdGlvbnMgKi9cbiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBlbWJlZF9nZXRfdmlkZW9faW5mbyhldnQuZGF0YS51cmwpO1xuICAgICAgICAgIC8vIGNvbnN0IHBhcnNlZCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocmVzKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgIGV2dC5zb3VyY2UucG9zdE1lc3NhZ2UoeyBtZXNzYWdlOiAidmlkZW9JbmZvIiwgdmlkZW9JbmZvOiByZXMgfSwgIioiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZ0LmRhdGEubWVzc2FnZSA9PT0gImRvd25sb2FkIikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCJET1dOTE9BRCEhISIsIGV2dC5kYXRhKTtcbiAgICAgICAgICBjb25zdCB7IHJlc3VsdCB9ID0gYXdhaXQgZG93bmxvYWRfc3RyZWFtKHsgdXJsOiBldnQuZGF0YS51cmwsIGNvbnRlbnRMZW5ndGg6IGV2dC5kYXRhLmNvbnRlbnRMZW5ndGggfSwgY29uc29sZS5sb2cpO1xuICAgICAgICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IHJlc3VsdDtcbiAgICAgICAgICBjb25zb2xlLmxvZygiRE9XTkxPQURFRCEhISIsIHN0cmVhbSk7XG4gICAgICAgICAgZXZ0LnNvdXJjZS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICBtZXNzYWdlOiAic3RyZWFtIixcbiAgICAgICAgICAgIGNvbnRlbnQ6IHN0cmVhbSxcbiAgICAgICAgICAgIHVybDogZXZ0LmRhdGEudXJsLFxuICAgICAgICAgIH0sICIqIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2dC5kYXRhLm1lc3NhZ2UgPT09ICJkb3dubG9hZEFuZE11eCIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygiRE9XTkxPQUQhISEiLCBldnQuZGF0YSk7XG4gICAgICAgICAgc3RhcnRXb3JrZXIoY29uc29sZS5sb2cpO1xuICAgICAgICAgIGNvbnN0IHsgYXVkaW8sIHZpZGVvIH0gPSBldnQuZGF0YTtcbiAgICAgICAgICBjb25zdCB7IHJlc3VsdDogdlByb21pc2UgfSA9IGF3YWl0IGRvd25sb2FkX3N0cmVhbSh2aWRlbywgY29uc29sZS5sb2cpO1xuICAgICAgICAgIGNvbnN0IHsgcmVzdWx0OiBhUHJvbWlzZSB9ID0gYXdhaXQgZG93bmxvYWRfc3RyZWFtKGF1ZGlvLCBjb25zb2xlLmxvZyk7XG4gICAgICAgICAgY29uc3QgW3ZhcnIsIGFhcnJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3ZQcm9taXNlLCBhUHJvbWlzZV0pO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lcmdlVmlkZW8odmFyciwgYWFyciwgY29uc29sZS5sb2cpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCJNVVhFRCEhISIsIHJlc3VsdCk7XG4gICAgICAgICAgZXZ0LnNvdXJjZS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICBtZXNzYWdlOiAibXV4ZWQiLFxuICAgICAgICAgICAgY29udGVudDogcmVzdWx0LFxuICAgICAgICAgICAgdXJsOiB2aWRlby51cmwsXG4gICAgICAgICAgfSwgIioiKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgcmVjZWl2ZU1lc3NhZ2UsIGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBjaGVja1NlcnZpY2UobG9jYXRpb24pIHtcbiAgICBjb25zb2xlLmxvZygiQ0hFQ0sgU0VSVklDRSEhISIsIGxvY2F0aW9uLmhyZWYpO1xuICAgIGNvbnN0IHVybCA9IGxvY2F0aW9uLmhyZWY7XG4gICAgLy8gY29uc29sZS5sb2coIklTIElUPyIsIHVybCwgL15odHRwcz86XFwvXFwvKD86d3d3XFwuKT8oPzp5b3V0dWJlXFwuY29tfHlvdXR1XFwuYmUpXFwvZW1iZWQvLnRlc3QodXJsKSk7XG4gICAgcmV0dXJuIC9eaHR0cHM/OlxcL1xcLyg/Ond3d1xcLik/KD86eW91dHViZVxcLmNvbXx5b3V0dVxcLmJlfHlvdXR1YmUtbm9jb29raWVcXC5jb20pXFwvZW1iZWQvLnRlc3QodXJsKTtcbiAgfVxuXG4gIGV4YWN0TWF0Y2goKSB7XG4gICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgY29uc29sZS5sb2coIkVYQUNUPyIsIC9eaHR0cHM/OlxcL1xcLyg/Ond3d1xcLik/KD86eW91dHViZVxcLmNvbXx5b3V0dVxcLmJlfHlvdXR1YmUtY29jb29raWVcXC5jb20pXFwvZW1iZWQvLnRlc3QodXJsKSwgdXJsKTtcbiAgICByZXR1cm4gL15odHRwcz86XFwvXFwvKD86d3d3XFwuKT8oPzp5b3V0dWJlXFwuY29tfHlvdXR1XFwuYmV8eW91dHViZS1ub2Nvb2tpZVxcLmNvbSlcXC9lbWJlZC8udGVzdCh1cmwpO1xuICB9XG5cbiAgaW5zZXJ0RG93bmxvYWRCdXR0b24oaG9sZGVyLCBidXR0b24pIHtcbiAgICBjb25zb2xlLmxvZygiSU5TRVJUIEJVVFRPTiEhISIpO1xuICAgIGNvbnN0IHQgPSBob2xkZXIucXVlcnlTZWxlY3RvcigiI3BsYXllciAjbW92aWVfcGxheWVyIC55dHAtY2hyb21lLXRvcC55dHAtc2hvdy1jYXJkcy10aXRsZSAueXRwLWNocm9tZS10b3AtYnV0dG9ucyIpO1xuICAgIGNvbnN0IGUgPSBob2xkZXIucXVlcnlTZWxlY3RvcigiI3VuaWRvd25sb2FkZXIiKTtcbiAgICBpZiAodCA9PT0gbnVsbCB8fCBlICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHRvcE9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xuICAgICAgaWYgKHQucGFyZW50Tm9kZS5jb250YWlucyhidXR0b24pKSB7XG4gICAgICAgIHRvcE9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgY29uc3QgY3NzID0gdXRpbHNfbWluaWZ5KGBcbiAgICAgICAgICAjdW5pZG93bmxvYWRlciB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgbWluLWhlaWdodDogNDBweDtcbiAgICAgICAgICAgIG1hcmdpbjogMCAxMHB4O1xuICAgICAgICAgICAgcGFkZGluZy10b3A6IDZweDtcbiAgICAgICAgICB9XG4gICAgICAgICAgI3VuaWRvd25sb2FkZXItZHJvcGRvd24sXG4gICAgICAgICAgI3VuaWRvd25sb2FkZXItdG9vbHRpcCAge1xuICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICB6LWluZGV4OiA5OTk5O1xuICAgICAgICAgIH1cbiAgICAgICAgICAjdW5pZG93bmxvYWRlci1kcm9wZG93biB7XG4gICAgICAgICAgICB0b3A6IC0xMnB4O1xuICAgICAgICAgIH1cbiAgICAgICAgICAjdW5pZG93bmxvYWRlci10b29sdGlwIHtcbiAgICAgICAgICAgIHRvcDogOHB4O1xuICAgICAgICAgIH1cbiAgICAgICAgICAueXRwLXNtYWxsLW1vZGUgI3VuaWRvd25sb2FkZXIge1xuICAgICAgICAgICAgcGFkZGluZy10b3A6IDE0cHg7XG4gICAgICAgICAgfVxuICAgICAgICAgIC55dHAtc21hbGwtbW9kZSAjdW5pZG93bmxvYWRlci1kcm9wZG93biB7XG4gICAgICAgICAgICB0b3A6IC00cHg7XG4gICAgICAgICAgfVxuICAgICAgICAgIC55dHAtYXV0b2hpZGUgI3VuaWRvd25sb2FkZXIsXG4gICAgICAgICAgLnl0cC1hdXRvaGlkZSAjdW5pZG93bmxvYWRlci1kcm9wZG93biB7XG4gICAgICAgICAgICBvcGFjaXR5OiAwO1xuICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAuMXMgY3ViaWMtYmV6aWVyKDAuNCwwLjAsMSwxKTtcbiAgICAgICAgICB9XG4gICAgICAgIGApO1xuICAgICAgICBjb25zdCBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdO1xuICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7XG4gICAgICAgIGNvbnN0IGhlYWRPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgICAgICBpZiAoaGVhZC5jb250YWlucyhzdHlsZSkpIHtcbiAgICAgICAgICAgIGhlYWRPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGhlYWRPYnNlcnZlci5vYnNlcnZlKFxuICAgICAgICAgIGhlYWQsXG4gICAgICAgICAge1xuICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2UsXG4gICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgICAgICBjaGFyYWN0ZXJEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICAgICAgaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRvcE9ic2VydmVyLm9ic2VydmUoXG4gICAgICB0LnBhcmVudE5vZGUsXG4gICAgICB7XG4gICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlLFxuICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgIGNoYXJhY3RlckRhdGE6IGZhbHNlLFxuICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgfSxcbiAgICApO1xuICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6bm9uZSIpO1xuICAgIHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYnV0dG9uLCB0KTtcbiAgICBjb25zdCBhZGRDb250YWluZXIgPSAoaWQpID0+IHtcbiAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgICAgIGNvbnN0IG1vdmllUGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpO1xuICAgICAgICBpZiAobW92aWVQbGF5ZXIpIHtcbiAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtcbiAgICAgICAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCJpZCIsIGlkKTtcbiAgICAgICAgICBtb3ZpZVBsYXllci5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBhZGRDb250YWluZXIoInVuaWRvd25sb2FkZXItZHJvcGRvd24iKTtcbiAgICBhZGRDb250YWluZXIoInVuaWRvd25sb2FkZXItdG9vbHRpcCIpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgc3RhcnQoY3R4LCBnZXREb3dubG9hZEJ1dHRvbikge1xuICAgIGNvbnNvbGUubG9nKCJTVEFSVCEhISIpO1xuICAgIHRoaXMuZ2V0RG93bmxvYWRCdXR0b24gPSBnZXREb3dubG9hZEJ1dHRvbjtcbiAgICBjb25zdCBhZGRCdXR0b24gPSB0aGlzLmFkZEJ1dHRvbi5iaW5kKHRoaXMpO1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5vbkxvYWQuYmluZCh0aGlzLCBhZGRCdXR0b24pO1xuICAgIGNhbGxiYWNrKCk7XG4gICAgaWYgKGN0eCkge1xuICAgICAgdGhpcy5jdHggPSBjdHg7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tMYXlvdXQoY2FsbGJhY2spIHtcbiAgICBjb25zb2xlLmxvZygiQ0hFQ0sgTEFZT1VUISEhIik7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuc2VydmljZSBpbiBjb25maWdbImEiIC8qIGRlZmF1bHQgKi9dID8gY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXVt0aGlzLnNlcnZpY2VdIDogY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXS5kZWZhdWx0O1xuICAgIGlmICghdGhpcy5jb3VudGVyKSB7XG4gICAgICB0aGlzLmNvdW50ZXIgPSAwO1xuICAgIH1cbiAgICBpZiAodGhpcy5sYXlvdXRJc1JlYWR5KCkpIHtcbiAgICAgIHRoaXMuY291bnRlciA9IDA7XG4gICAgICBjYWxsYmFjaygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb3VudGVyID4gb3B0aW9ucy5hdHRlbXB0cykge1xuICAgICAgdGhpcy5jdHgubG9nKHRoaXMuc2VydmljZSwgImxheW91dCIpO1xuICAgICAgdGhpcy5jb3VudGVyID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb3VudGVyICs9IDE7XG4gICAgfVxuICAgIHNldFRpbWVvdXQodGhpcy5jaGVja0xheW91dC5iaW5kKHRoaXMsIGNhbGxiYWNrKSwgMTAwMCk7XG4gIH1cblxuICBsYXlvdXRJc1JlYWR5KCkge1xuICAgIGNvbnN0IHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjcGxheWVyICNtb3ZpZV9wbGF5ZXIgLnl0cC1jaHJvbWUtdG9wLnl0cC1zaG93LWNhcmRzLXRpdGxlIC55dHAtY2hyb21lLXRvcC1idXR0b25zIik7XG4gICAgY29uc29sZS5sb2coIkxBWU9VVCBSRUFEWT8iLCB0ICE9PSBudWxsKTtcbiAgICByZXR1cm4gdCAhPT0gbnVsbDtcbiAgfVxufVxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB5b3V0dWJlX2VtYmVkID0gKG5ldyBlbWJlZF9Zb3V0dWJlRW1iZWQoKSk7XG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvc3ltYm9sLW9ic2VydmFibGUvZXMvaW5kZXguanNcbnZhciBlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWR1eC9lcy9yZWR1eC5qc1xuXG5cbi8qKlxuICogVGhlc2UgYXJlIHByaXZhdGUgYWN0aW9uIHR5cGVzIHJlc2VydmVkIGJ5IFJlZHV4LlxuICogRm9yIGFueSB1bmtub3duIGFjdGlvbnMsIHlvdSBtdXN0IHJldHVybiB0aGUgY3VycmVudCBzdGF0ZS5cbiAqIElmIHRoZSBjdXJyZW50IHN0YXRlIGlzIHVuZGVmaW5lZCwgeW91IG11c3QgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLlxuICogRG8gbm90IHJlZmVyZW5jZSB0aGVzZSBhY3Rpb24gdHlwZXMgZGlyZWN0bHkgaW4geW91ciBjb2RlLlxuICovXG52YXIgcmFuZG9tU3RyaW5nID0gZnVuY3Rpb24gcmFuZG9tU3RyaW5nKCkge1xuICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpLnNwbGl0KFwnXCcpLmpvaW4oXCcuXCcpO1xufTtcblxudmFyIEFjdGlvblR5cGVzID0ge1xuICBJTklUOiAiQEByZWR1eC9JTklUIiArIHJhbmRvbVN0cmluZygpLFxuICBSRVBMQUNFOiAiQEByZWR1eC9SRVBMQUNFIiArIHJhbmRvbVN0cmluZygpLFxuICBQUk9CRV9VTktOT1dOX0FDVElPTjogZnVuY3Rpb24gUFJPQkVfVU5LTk9XTl9BQ1RJT04oKSB7XG4gICAgcmV0dXJuICJAQHJlZHV4L1BST0JFX1VOS05PV05fQUNUSU9OIiArIHJhbmRvbVN0cmluZygpO1xuICB9XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7YW55fSBvYmogVGhlIG9iamVjdCB0byBpbnNwZWN0LlxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGFyZ3VtZW50IGFwcGVhcnMgdG8gYmUgYSBwbGFpbiBvYmplY3QuXG4gKi9cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3Qob2JqKSB7XG4gIGlmICh0eXBlb2Ygb2JqICE9PSBcJ29iamVjdFwnIHx8IG9iaiA9PT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICB2YXIgcHJvdG8gPSBvYmo7XG5cbiAgd2hpbGUgKE9iamVjdC5nZXRQcm90b3R5cGVPZihwcm90bykgIT09IG51bGwpIHtcbiAgICBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihwcm90byk7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikgPT09IHByb3RvO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBSZWR1eCBzdG9yZSB0aGF0IGhvbGRzIHRoZSBzdGF0ZSB0cmVlLlxuICogVGhlIG9ubHkgd2F5IHRvIGNoYW5nZSB0aGUgZGF0YSBpbiB0aGUgc3RvcmUgaXMgdG8gY2FsbCBgZGlzcGF0Y2goKWAgb24gaXQuXG4gKlxuICogVGhlcmUgc2hvdWxkIG9ubHkgYmUgYSBzaW5nbGUgc3RvcmUgaW4geW91ciBhcHAuIFRvIHNwZWNpZnkgaG93IGRpZmZlcmVudFxuICogcGFydHMgb2YgdGhlIHN0YXRlIHRyZWUgcmVzcG9uZCB0byBhY3Rpb25zLCB5b3UgbWF5IGNvbWJpbmUgc2V2ZXJhbCByZWR1Y2Vyc1xuICogaW50byBhIHNpbmdsZSByZWR1Y2VyIGZ1bmN0aW9uIGJ5IHVzaW5nIGBjb21iaW5lUmVkdWNlcnNgLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IHJlZHVjZXIgQSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlIG5leHQgc3RhdGUgdHJlZSwgZ2l2ZW5cbiAqIHRoZSBjdXJyZW50IHN0YXRlIHRyZWUgYW5kIHRoZSBhY3Rpb24gdG8gaGFuZGxlLlxuICpcbiAqIEBwYXJhbSB7YW55fSBbcHJlbG9hZGVkU3RhdGVdIFRoZSBpbml0aWFsIHN0YXRlLiBZb3UgbWF5IG9wdGlvbmFsbHkgc3BlY2lmeSBpdFxuICogdG8gaHlkcmF0ZSB0aGUgc3RhdGUgZnJvbSB0aGUgc2VydmVyIGluIHVuaXZlcnNhbCBhcHBzLCBvciB0byByZXN0b3JlIGFcbiAqIHByZXZpb3VzbHkgc2VyaWFsaXplZCB1c2VyIHNlc3Npb24uXG4gKiBJZiB5b3UgdXNlIGBjb21iaW5lUmVkdWNlcnNgIHRvIHByb2R1Y2UgdGhlIHJvb3QgcmVkdWNlciBmdW5jdGlvbiwgdGhpcyBtdXN0IGJlXG4gKiBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZSBhcyBgY29tYmluZVJlZHVjZXJzYCBrZXlzLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtlbmhhbmNlcl0gVGhlIHN0b3JlIGVuaGFuY2VyLiBZb3UgbWF5IG9wdGlvbmFsbHkgc3BlY2lmeSBpdFxuICogdG8gZW5oYW5jZSB0aGUgc3RvcmUgd2l0aCB0aGlyZC1wYXJ0eSBjYXBhYmlsaXRpZXMgc3VjaCBhcyBtaWRkbGV3YXJlLFxuICogdGltZSB0cmF2ZWwsIHBlcnNpc3RlbmNlLCBldGMuIFRoZSBvbmx5IHN0b3JlIGVuaGFuY2VyIHRoYXQgc2hpcHMgd2l0aCBSZWR1eFxuICogaXMgYGFwcGx5TWlkZGxld2FyZSgpYC5cbiAqXG4gKiBAcmV0dXJucyB7U3RvcmV9IEEgUmVkdXggc3RvcmUgdGhhdCBsZXRzIHlvdSByZWFkIHRoZSBzdGF0ZSwgZGlzcGF0Y2ggYWN0aW9uc1xuICogYW5kIHN1YnNjcmliZSB0byBjaGFuZ2VzLlxuICovXG5cbmZ1bmN0aW9uIGNyZWF0ZVN0b3JlKHJlZHVjZXIsIHByZWxvYWRlZFN0YXRlLCBlbmhhbmNlcikge1xuICB2YXIgX3JlZjI7XG5cbiAgaWYgKHR5cGVvZiBwcmVsb2FkZWRTdGF0ZSA9PT0gXCdmdW5jdGlvblwnICYmIHR5cGVvZiBlbmhhbmNlciA9PT0gXCdmdW5jdGlvblwnIHx8IHR5cGVvZiBlbmhhbmNlciA9PT0gXCdmdW5jdGlvblwnICYmIHR5cGVvZiBhcmd1bWVudHNbM10gPT09IFwnZnVuY3Rpb25cJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcJ0l0IGxvb2tzIGxpa2UgeW91IGFyZSBwYXNzaW5nIHNldmVyYWwgc3RvcmUgZW5oYW5jZXJzIHRvIFwnICsgXCdjcmVhdGVTdG9yZSgpLiBUaGlzIGlzIG5vdCBzdXBwb3J0ZWQuIEluc3RlYWQsIGNvbXBvc2UgdGhlbSBcJyArIFwndG9nZXRoZXIgdG8gYSBzaW5nbGUgZnVuY3Rpb24uXCcpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBwcmVsb2FkZWRTdGF0ZSA9PT0gXCdmdW5jdGlvblwnICYmIHR5cGVvZiBlbmhhbmNlciA9PT0gXCd1bmRlZmluZWRcJykge1xuICAgIGVuaGFuY2VyID0gcHJlbG9hZGVkU3RhdGU7XG4gICAgcHJlbG9hZGVkU3RhdGUgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBpZiAodHlwZW9mIGVuaGFuY2VyICE9PSBcJ3VuZGVmaW5lZFwnKSB7XG4gICAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCdFeHBlY3RlZCB0aGUgZW5oYW5jZXIgdG8gYmUgYSBmdW5jdGlvbi5cJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuaGFuY2VyKGNyZWF0ZVN0b3JlKShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSk7XG4gIH1cblxuICBpZiAodHlwZW9mIHJlZHVjZXIgIT09IFwnZnVuY3Rpb25cJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcJ0V4cGVjdGVkIHRoZSByZWR1Y2VyIHRvIGJlIGEgZnVuY3Rpb24uXCcpO1xuICB9XG5cbiAgdmFyIGN1cnJlbnRSZWR1Y2VyID0gcmVkdWNlcjtcbiAgdmFyIGN1cnJlbnRTdGF0ZSA9IHByZWxvYWRlZFN0YXRlO1xuICB2YXIgY3VycmVudExpc3RlbmVycyA9IFtdO1xuICB2YXIgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnM7XG4gIHZhciBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7XG4gIC8qKlxuICAgKiBUaGlzIG1ha2VzIGEgc2hhbGxvdyBjb3B5IG9mIGN1cnJlbnRMaXN0ZW5lcnMgc28gd2UgY2FuIHVzZVxuICAgKiBuZXh0TGlzdGVuZXJzIGFzIGEgdGVtcG9yYXJ5IGxpc3Qgd2hpbGUgZGlzcGF0Y2hpbmcuXG4gICAqXG4gICAqIFRoaXMgcHJldmVudHMgYW55IGJ1Z3MgYXJvdW5kIGNvbnN1bWVycyBjYWxsaW5nXG4gICAqIHN1YnNjcmliZS91bnN1YnNjcmliZSBpbiB0aGUgbWlkZGxlIG9mIGEgZGlzcGF0Y2guXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKSB7XG4gICAgaWYgKG5leHRMaXN0ZW5lcnMgPT09IGN1cnJlbnRMaXN0ZW5lcnMpIHtcbiAgICAgIG5leHRMaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzLnNsaWNlKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZWFkcyB0aGUgc3RhdGUgdHJlZSBtYW5hZ2VkIGJ5IHRoZSBzdG9yZS5cbiAgICpcbiAgICogQHJldHVybnMge2FueX0gVGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBvZiB5b3VyIGFwcGxpY2F0aW9uLlxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGdldFN0YXRlKCkge1xuICAgIGlmIChpc0Rpc3BhdGNoaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCdZb3UgbWF5IG5vdCBjYWxsIHN0b3JlLmdldFN0YXRlKCkgd2hpbGUgdGhlIHJlZHVjZXIgaXMgZXhlY3V0aW5nLiBcJyArIFwnVGhlIHJlZHVjZXIgaGFzIGFscmVhZHkgcmVjZWl2ZWQgdGhlIHN0YXRlIGFzIGFuIGFyZ3VtZW50LiBcJyArIFwnUGFzcyBpdCBkb3duIGZyb20gdGhlIHRvcCByZWR1Y2VyIGluc3RlYWQgb2YgcmVhZGluZyBpdCBmcm9tIHRoZSBzdG9yZS5cJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTtcbiAgfVxuICAvKipcbiAgICogQWRkcyBhIGNoYW5nZSBsaXN0ZW5lci4gSXQgd2lsbCBiZSBjYWxsZWQgYW55IHRpbWUgYW4gYWN0aW9uIGlzIGRpc3BhdGNoZWQsXG4gICAqIGFuZCBzb21lIHBhcnQgb2YgdGhlIHN0YXRlIHRyZWUgbWF5IHBvdGVudGlhbGx5IGhhdmUgY2hhbmdlZC4gWW91IG1heSB0aGVuXG4gICAqIGNhbGwgYGdldFN0YXRlKClgIHRvIHJlYWQgdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBpbnNpZGUgdGhlIGNhbGxiYWNrLlxuICAgKlxuICAgKiBZb3UgbWF5IGNhbGwgYGRpc3BhdGNoKClgIGZyb20gYSBjaGFuZ2UgbGlzdGVuZXIsIHdpdGggdGhlIGZvbGxvd2luZ1xuICAgKiBjYXZlYXRzOlxuICAgKlxuICAgKiAxLiBUaGUgc3Vic2NyaXB0aW9ucyBhcmUgc25hcHNob3R0ZWQganVzdCBiZWZvcmUgZXZlcnkgYGRpc3BhdGNoKClgIGNhbGwuXG4gICAqIElmIHlvdSBzdWJzY3JpYmUgb3IgdW5zdWJzY3JpYmUgd2hpbGUgdGhlIGxpc3RlbmVycyBhcmUgYmVpbmcgaW52b2tlZCwgdGhpc1xuICAgKiB3aWxsIG5vdCBoYXZlIGFueSBlZmZlY3Qgb24gdGhlIGBkaXNwYXRjaCgpYCB0aGF0IGlzIGN1cnJlbnRseSBpbiBwcm9ncmVzcy5cbiAgICogSG93ZXZlciwgdGhlIG5leHQgYGRpc3BhdGNoKClgIGNhbGwsIHdoZXRoZXIgbmVzdGVkIG9yIG5vdCwgd2lsbCB1c2UgYSBtb3JlXG4gICAqIHJlY2VudCBzbmFwc2hvdCBvZiB0aGUgc3Vic2NyaXB0aW9uIGxpc3QuXG4gICAqXG4gICAqIDIuIFRoZSBsaXN0ZW5lciBzaG91bGQgbm90IGV4cGVjdCB0byBzZWUgYWxsIHN0YXRlIGNoYW5nZXMsIGFzIHRoZSBzdGF0ZVxuICAgKiBtaWdodCBoYXZlIGJlZW4gdXBkYXRlZCBtdWx0aXBsZSB0aW1lcyBkdXJpbmcgYSBuZXN0ZWQgYGRpc3BhdGNoKClgIGJlZm9yZVxuICAgKiB0aGUgbGlzdGVuZXIgaXMgY2FsbGVkLiBJdCBpcywgaG93ZXZlciwgZ3VhcmFudGVlZCB0aGF0IGFsbCBzdWJzY3JpYmVyc1xuICAgKiByZWdpc3RlcmVkIGJlZm9yZSB0aGUgYGRpc3BhdGNoKClgIHN0YXJ0ZWQgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgbGF0ZXN0XG4gICAqIHN0YXRlIGJ5IHRoZSB0aW1lIGl0IGV4aXRzLlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBBIGNhbGxiYWNrIHRvIGJlIGludm9rZWQgb24gZXZlcnkgZGlzcGF0Y2guXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byByZW1vdmUgdGhpcyBjaGFuZ2UgbGlzdGVuZXIuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gc3Vic2NyaWJlKGxpc3RlbmVyKSB7XG4gICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCdFeHBlY3RlZCB0aGUgbGlzdGVuZXIgdG8gYmUgYSBmdW5jdGlvbi5cJyk7XG4gICAgfVxuXG4gICAgaWYgKGlzRGlzcGF0Y2hpbmcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcJ1lvdSBtYXkgbm90IGNhbGwgc3RvcmUuc3Vic2NyaWJlKCkgd2hpbGUgdGhlIHJlZHVjZXIgaXMgZXhlY3V0aW5nLiBcJyArIFwnSWYgeW91IHdvdWxkIGxpa2UgdG8gYmUgbm90aWZpZWQgYWZ0ZXIgdGhlIHN0b3JlIGhhcyBiZWVuIHVwZGF0ZWQsIHN1YnNjcmliZSBmcm9tIGEgXCcgKyBcJ2NvbXBvbmVudCBhbmQgaW52b2tlIHN0b3JlLmdldFN0YXRlKCkgaW4gdGhlIGNhbGxiYWNrIHRvIGFjY2VzcyB0aGUgbGF0ZXN0IHN0YXRlLiBcJyArIFwnU2VlIGh0dHBzOi8vcmVkdXguanMub3JnL2FwaS1yZWZlcmVuY2Uvc3RvcmUjc3Vic2NyaWJlbGlzdGVuZXIgZm9yIG1vcmUgZGV0YWlscy5cJyk7XG4gICAgfVxuXG4gICAgdmFyIGlzU3Vic2NyaWJlZCA9IHRydWU7XG4gICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpO1xuICAgIG5leHRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHVuc3Vic2NyaWJlKCkge1xuICAgICAgaWYgKCFpc1N1YnNjcmliZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNEaXNwYXRjaGluZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCdZb3UgbWF5IG5vdCB1bnN1YnNjcmliZSBmcm9tIGEgc3RvcmUgbGlzdGVuZXIgd2hpbGUgdGhlIHJlZHVjZXIgaXMgZXhlY3V0aW5nLiBcJyArIFwnU2VlIGh0dHBzOi8vcmVkdXguanMub3JnL2FwaS1yZWZlcmVuY2Uvc3RvcmUjc3Vic2NyaWJlbGlzdGVuZXIgZm9yIG1vcmUgZGV0YWlscy5cJyk7XG4gICAgICB9XG5cbiAgICAgIGlzU3Vic2NyaWJlZCA9IGZhbHNlO1xuICAgICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpO1xuICAgICAgdmFyIGluZGV4ID0gbmV4dExpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTtcbiAgICAgIG5leHRMaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIGN1cnJlbnRMaXN0ZW5lcnMgPSBudWxsO1xuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIERpc3BhdGNoZXMgYW4gYWN0aW9uLiBJdCBpcyB0aGUgb25seSB3YXkgdG8gdHJpZ2dlciBhIHN0YXRlIGNoYW5nZS5cbiAgICpcbiAgICogVGhlIGByZWR1Y2VyYCBmdW5jdGlvbiwgdXNlZCB0byBjcmVhdGUgdGhlIHN0b3JlLCB3aWxsIGJlIGNhbGxlZCB3aXRoIHRoZVxuICAgKiBjdXJyZW50IHN0YXRlIHRyZWUgYW5kIHRoZSBnaXZlbiBgYWN0aW9uYC4gSXRzIHJldHVybiB2YWx1ZSB3aWxsXG4gICAqIGJlIGNvbnNpZGVyZWQgdGhlICoqbmV4dCoqIHN0YXRlIG9mIHRoZSB0cmVlLCBhbmQgdGhlIGNoYW5nZSBsaXN0ZW5lcnNcbiAgICogd2lsbCBiZSBub3RpZmllZC5cbiAgICpcbiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb25seSBzdXBwb3J0cyBwbGFpbiBvYmplY3QgYWN0aW9ucy4gSWYgeW91IHdhbnQgdG9cbiAgICogZGlzcGF0Y2ggYSBQcm9taXNlLCBhbiBPYnNlcnZhYmxlLCBhIHRodW5rLCBvciBzb21ldGhpbmcgZWxzZSwgeW91IG5lZWQgdG9cbiAgICogd3JhcCB5b3VyIHN0b3JlIGNyZWF0aW5nIGZ1bmN0aW9uIGludG8gdGhlIGNvcnJlc3BvbmRpbmcgbWlkZGxld2FyZS4gRm9yXG4gICAqIGV4YW1wbGUsIHNlZSB0aGUgZG9jdW1lbnRhdGlvbiBmb3IgdGhlIGByZWR1eC10aHVua2AgcGFja2FnZS4gRXZlbiB0aGVcbiAgICogbWlkZGxld2FyZSB3aWxsIGV2ZW50dWFsbHkgZGlzcGF0Y2ggcGxhaW4gb2JqZWN0IGFjdGlvbnMgdXNpbmcgdGhpcyBtZXRob2QuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBhY3Rpb24gQSBwbGFpbiBvYmplY3QgcmVwcmVzZW50aW5nIOKAnHdoYXQgY2hhbmdlZOKAnS4gSXQgaXNcbiAgICogYSBnb29kIGlkZWEgdG8ga2VlcCBhY3Rpb25zIHNlcmlhbGl6YWJsZSBzbyB5b3UgY2FuIHJlY29yZCBhbmQgcmVwbGF5IHVzZXJcbiAgICogc2Vzc2lvbnMsIG9yIHVzZSB0aGUgdGltZSB0cmF2ZWxsaW5nIGByZWR1eC1kZXZ0b29sc2AuIEFuIGFjdGlvbiBtdXN0IGhhdmVcbiAgICogYSBgdHlwZWAgcHJvcGVydHkgd2hpY2ggbWF5IG5vdCBiZSBgdW5kZWZpbmVkYC4gSXQgaXMgYSBnb29kIGlkZWEgdG8gdXNlXG4gICAqIHN0cmluZyBjb25zdGFudHMgZm9yIGFjdGlvbiB0eXBlcy5cbiAgICpcbiAgICogQHJldHVybnMge09iamVjdH0gRm9yIGNvbnZlbmllbmNlLCB0aGUgc2FtZSBhY3Rpb24gb2JqZWN0IHlvdSBkaXNwYXRjaGVkLlxuICAgKlxuICAgKiBOb3RlIHRoYXQsIGlmIHlvdSB1c2UgYSBjdXN0b20gbWlkZGxld2FyZSwgaXQgbWF5IHdyYXAgYGRpc3BhdGNoKClgIHRvXG4gICAqIHJldHVybiBzb21ldGhpbmcgZWxzZSAoZm9yIGV4YW1wbGUsIGEgUHJvbWlzZSB5b3UgY2FuIGF3YWl0KS5cbiAgICovXG5cblxuICBmdW5jdGlvbiBkaXNwYXRjaChhY3Rpb24pIHtcbiAgICBpZiAoIWlzUGxhaW5PYmplY3QoYWN0aW9uKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwnQWN0aW9ucyBtdXN0IGJlIHBsYWluIG9iamVjdHMuIFwnICsgXCdVc2UgY3VzdG9tIG1pZGRsZXdhcmUgZm9yIGFzeW5jIGFjdGlvbnMuXCcpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgYWN0aW9uLnR5cGUgPT09IFwndW5kZWZpbmVkXCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcJ0FjdGlvbnMgbWF5IG5vdCBoYXZlIGFuIHVuZGVmaW5lZCAidHlwZSIgcHJvcGVydHkuIFwnICsgXCdIYXZlIHlvdSBtaXNzcGVsbGVkIGEgY29uc3RhbnQ/XCcpO1xuICAgIH1cblxuICAgIGlmIChpc0Rpc3BhdGNoaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCdSZWR1Y2VycyBtYXkgbm90IGRpc3BhdGNoIGFjdGlvbnMuXCcpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBpc0Rpc3BhdGNoaW5nID0gdHJ1ZTtcbiAgICAgIGN1cnJlbnRTdGF0ZSA9IGN1cnJlbnRSZWR1Y2VyKGN1cnJlbnRTdGF0ZSwgYWN0aW9uKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaXNEaXNwYXRjaGluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBsaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzID0gbmV4dExpc3RlbmVycztcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07XG4gICAgICBsaXN0ZW5lcigpO1xuICAgIH1cblxuICAgIHJldHVybiBhY3Rpb247XG4gIH1cbiAgLyoqXG4gICAqIFJlcGxhY2VzIHRoZSByZWR1Y2VyIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBzdG9yZSB0byBjYWxjdWxhdGUgdGhlIHN0YXRlLlxuICAgKlxuICAgKiBZb3UgbWlnaHQgbmVlZCB0aGlzIGlmIHlvdXIgYXBwIGltcGxlbWVudHMgY29kZSBzcGxpdHRpbmcgYW5kIHlvdSB3YW50IHRvXG4gICAqIGxvYWQgc29tZSBvZiB0aGUgcmVkdWNlcnMgZHluYW1pY2FsbHkuIFlvdSBtaWdodCBhbHNvIG5lZWQgdGhpcyBpZiB5b3VcbiAgICogaW1wbGVtZW50IGEgaG90IHJlbG9hZGluZyBtZWNoYW5pc20gZm9yIFJlZHV4LlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBuZXh0UmVkdWNlciBUaGUgcmVkdWNlciBmb3IgdGhlIHN0b3JlIHRvIHVzZSBpbnN0ZWFkLlxuICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICovXG5cblxuICBmdW5jdGlvbiByZXBsYWNlUmVkdWNlcihuZXh0UmVkdWNlcikge1xuICAgIGlmICh0eXBlb2YgbmV4dFJlZHVjZXIgIT09IFwnZnVuY3Rpb25cJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwnRXhwZWN0ZWQgdGhlIG5leHRSZWR1Y2VyIHRvIGJlIGEgZnVuY3Rpb24uXCcpO1xuICAgIH1cblxuICAgIGN1cnJlbnRSZWR1Y2VyID0gbmV4dFJlZHVjZXI7IC8vIFRoaXMgYWN0aW9uIGhhcyBhIHNpbWlsaWFyIGVmZmVjdCB0byBBY3Rpb25UeXBlcy5JTklULlxuICAgIC8vIEFueSByZWR1Y2VycyB0aGF0IGV4aXN0ZWQgaW4gYm90aCB0aGUgbmV3IGFuZCBvbGQgcm9vdFJlZHVjZXJcbiAgICAvLyB3aWxsIHJlY2VpdmUgdGhlIHByZXZpb3VzIHN0YXRlLiBUaGlzIGVmZmVjdGl2ZWx5IHBvcHVsYXRlc1xuICAgIC8vIHRoZSBuZXcgc3RhdGUgdHJlZSB3aXRoIGFueSByZWxldmFudCBkYXRhIGZyb20gdGhlIG9sZCBvbmUuXG5cbiAgICBkaXNwYXRjaCh7XG4gICAgICB0eXBlOiBBY3Rpb25UeXBlcy5SRVBMQUNFXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIEludGVyb3BlcmFiaWxpdHkgcG9pbnQgZm9yIG9ic2VydmFibGUvcmVhY3RpdmUgbGlicmFyaWVzLlxuICAgKiBAcmV0dXJucyB7b2JzZXJ2YWJsZX0gQSBtaW5pbWFsIG9ic2VydmFibGUgb2Ygc3RhdGUgY2hhbmdlcy5cbiAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSB0aGUgb2JzZXJ2YWJsZSBwcm9wb3NhbDpcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtb2JzZXJ2YWJsZVxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIG9ic2VydmFibGUoKSB7XG4gICAgdmFyIF9yZWY7XG5cbiAgICB2YXIgb3V0ZXJTdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG4gICAgcmV0dXJuIF9yZWYgPSB7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBtaW5pbWFsIG9ic2VydmFibGUgc3Vic2NyaXB0aW9uIG1ldGhvZC5cbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYnNlcnZlciBBbnkgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gb2JzZXJ2ZXIuXG4gICAgICAgKiBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHNob3VsZCBoYXZlIGEgYG5leHRgIG1ldGhvZC5cbiAgICAgICAqIEByZXR1cm5zIHtzdWJzY3JpcHRpb259IEFuIG9iamVjdCB3aXRoIGFuIGB1bnN1YnNjcmliZWAgbWV0aG9kIHRoYXQgY2FuXG4gICAgICAgKiBiZSB1c2VkIHRvIHVuc3Vic2NyaWJlIHRoZSBvYnNlcnZhYmxlIGZyb20gdGhlIHN0b3JlLCBhbmQgcHJldmVudCBmdXJ0aGVyXG4gICAgICAgKiBlbWlzc2lvbiBvZiB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZS5cbiAgICAgICAqL1xuICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUob2JzZXJ2ZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYnNlcnZlciAhPT0gXCdvYmplY3RcJyB8fCBvYnNlcnZlciA9PT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCdFeHBlY3RlZCB0aGUgb2JzZXJ2ZXIgdG8gYmUgYW4gb2JqZWN0LlwnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9ic2VydmVTdGF0ZSgpIHtcbiAgICAgICAgICBpZiAob2JzZXJ2ZXIubmV4dCkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChnZXRTdGF0ZSgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBvYnNlcnZlU3RhdGUoKTtcbiAgICAgICAgdmFyIHVuc3Vic2NyaWJlID0gb3V0ZXJTdWJzY3JpYmUob2JzZXJ2ZVN0YXRlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB1bnN1YnNjcmliZTogdW5zdWJzY3JpYmVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LCBfcmVmW2VzWyJhIiAvKiBkZWZhdWx0ICovXV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LCBfcmVmO1xuICB9IC8vIFdoZW4gYSBzdG9yZSBpcyBjcmVhdGVkLCBhbiAiSU5JVCIgYWN0aW9uIGlzIGRpc3BhdGNoZWQgc28gdGhhdCBldmVyeVxuICAvLyByZWR1Y2VyIHJldHVybnMgdGhlaXIgaW5pdGlhbCBzdGF0ZS4gVGhpcyBlZmZlY3RpdmVseSBwb3B1bGF0ZXNcbiAgLy8gdGhlIGluaXRpYWwgc3RhdGUgdHJlZS5cblxuXG4gIGRpc3BhdGNoKHtcbiAgICB0eXBlOiBBY3Rpb25UeXBlcy5JTklUXG4gIH0pO1xuICByZXR1cm4gX3JlZjIgPSB7XG4gICAgZGlzcGF0Y2g6IGRpc3BhdGNoLFxuICAgIHN1YnNjcmliZTogc3Vic2NyaWJlLFxuICAgIGdldFN0YXRlOiBnZXRTdGF0ZSxcbiAgICByZXBsYWNlUmVkdWNlcjogcmVwbGFjZVJlZHVjZXJcbiAgfSwgX3JlZjJbZXNbImEiIC8qIGRlZmF1bHQgKi9dXSA9IG9ic2VydmFibGUsIF9yZWYyO1xufVxuXG4vKipcbiAqIFByaW50cyBhIHdhcm5pbmcgaW4gdGhlIGNvbnNvbGUgaWYgaXQgZXhpc3RzLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlIFRoZSB3YXJuaW5nIG1lc3NhZ2UuXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuZnVuY3Rpb24gd2FybmluZyhtZXNzYWdlKSB7XG4gIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbiAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSBcJ3VuZGVmaW5lZFwnICYmIHR5cGVvZiBjb25zb2xlLmVycm9yID09PSBcJ2Z1bmN0aW9uXCcpIHtcbiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpO1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqL1xuXG5cbiAgdHJ5IHtcbiAgICAvLyBUaGlzIGVycm9yIHdhcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB0aGF0IGlmIHlvdSBlbmFibGVcbiAgICAvLyAiYnJlYWsgb24gYWxsIGV4Y2VwdGlvbnMiIGluIHlvdXIgY29uc29sZSxcbiAgICAvLyBpdCB3b3VsZCBwYXVzZSB0aGUgZXhlY3V0aW9uIGF0IHRoaXMgbGluZS5cbiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIH0gY2F0Y2ggKGUpIHt9IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZW1wdHlcblxufVxuXG5mdW5jdGlvbiBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShrZXksIGFjdGlvbikge1xuICB2YXIgYWN0aW9uVHlwZSA9IGFjdGlvbiAmJiBhY3Rpb24udHlwZTtcbiAgdmFyIGFjdGlvbkRlc2NyaXB0aW9uID0gYWN0aW9uVHlwZSAmJiAiYWN0aW9uIFxcIiIgKyBTdHJpbmcoYWN0aW9uVHlwZSkgKyAiXFwiIiB8fCBcJ2FuIGFjdGlvblwnO1xuICByZXR1cm4gIkdpdmVuICIgKyBhY3Rpb25EZXNjcmlwdGlvbiArICIsIHJlZHVjZXIgXFwiIiArIGtleSArICJcXCIgcmV0dXJuZWQgdW5kZWZpbmVkLiAiICsgIlRvIGlnbm9yZSBhbiBhY3Rpb24sIHlvdSBtdXN0IGV4cGxpY2l0bHkgcmV0dXJuIHRoZSBwcmV2aW91cyBzdGF0ZS4gIiArICJJZiB5b3Ugd2FudCB0aGlzIHJlZHVjZXIgdG8gaG9sZCBubyB2YWx1ZSwgeW91IGNhbiByZXR1cm4gbnVsbCBpbnN0ZWFkIG9mIHVuZGVmaW5lZC4iO1xufVxuXG5mdW5jdGlvbiBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKGlucHV0U3RhdGUsIHJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSkge1xuICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7XG4gIHZhciBhcmd1bWVudE5hbWUgPSBhY3Rpb24gJiYgYWN0aW9uLnR5cGUgPT09IEFjdGlvblR5cGVzLklOSVQgPyBcJ3ByZWxvYWRlZFN0YXRlIGFyZ3VtZW50IHBhc3NlZCB0byBjcmVhdGVTdG9yZVwnIDogXCdwcmV2aW91cyBzdGF0ZSByZWNlaXZlZCBieSB0aGUgcmVkdWNlclwnO1xuXG4gIGlmIChyZWR1Y2VyS2V5cy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gXCdTdG9yZSBkb2VzIG5vdCBoYXZlIGEgdmFsaWQgcmVkdWNlci4gTWFrZSBzdXJlIHRoZSBhcmd1bWVudCBwYXNzZWQgXCcgKyBcJ3RvIGNvbWJpbmVSZWR1Y2VycyBpcyBhbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSByZWR1Y2Vycy5cJztcbiAgfVxuXG4gIGlmICghaXNQbGFpbk9iamVjdChpbnB1dFN0YXRlKSkge1xuICAgIHJldHVybiAiVGhlICIgKyBhcmd1bWVudE5hbWUgKyAiIGhhcyB1bmV4cGVjdGVkIHR5cGUgb2YgXFwiIiArIHt9LnRvU3RyaW5nLmNhbGwoaW5wdXRTdGF0ZSkubWF0Y2goL1xccyhbYS16fEEtWl0rKS8pWzFdICsgIlxcIi4gRXhwZWN0ZWQgYXJndW1lbnQgdG8gYmUgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyAiICsgKCJrZXlzOiBcXCIiICsgcmVkdWNlcktleXMuam9pbihcJyIsICJcJykgKyAiXFwiIik7XG4gIH1cblxuICB2YXIgdW5leHBlY3RlZEtleXMgPSBPYmplY3Qua2V5cyhpbnB1dFN0YXRlKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiAhcmVkdWNlcnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAhdW5leHBlY3RlZEtleUNhY2hlW2tleV07XG4gIH0pO1xuICB1bmV4cGVjdGVkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICB1bmV4cGVjdGVkS2V5Q2FjaGVba2V5XSA9IHRydWU7XG4gIH0pO1xuICBpZiAoYWN0aW9uICYmIGFjdGlvbi50eXBlID09PSBBY3Rpb25UeXBlcy5SRVBMQUNFKSByZXR1cm47XG5cbiAgaWYgKHVuZXhwZWN0ZWRLZXlzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gIlVuZXhwZWN0ZWQgIiArICh1bmV4cGVjdGVkS2V5cy5sZW5ndGggPiAxID8gXCdrZXlzXCcgOiBcJ2tleVwnKSArICIgIiArICgiXFwiIiArIHVuZXhwZWN0ZWRLZXlzLmpvaW4oXCciLCAiXCcpICsgIlxcIiBmb3VuZCBpbiAiICsgYXJndW1lbnROYW1lICsgIi4gIikgKyAiRXhwZWN0ZWQgdG8gZmluZCBvbmUgb2YgdGhlIGtub3duIHJlZHVjZXIga2V5cyBpbnN0ZWFkOiAiICsgKCJcXCIiICsgcmVkdWNlcktleXMuam9pbihcJyIsICJcJykgKyAiXFwiLiBVbmV4cGVjdGVkIGtleXMgd2lsbCBiZSBpZ25vcmVkLiIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGFzc2VydFJlZHVjZXJTaGFwZShyZWR1Y2Vycykge1xuICBPYmplY3Qua2V5cyhyZWR1Y2VycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgdmFyIHJlZHVjZXIgPSByZWR1Y2Vyc1trZXldO1xuICAgIHZhciBpbml0aWFsU3RhdGUgPSByZWR1Y2VyKHVuZGVmaW5lZCwge1xuICAgICAgdHlwZTogQWN0aW9uVHlwZXMuSU5JVFxuICAgIH0pO1xuXG4gICAgaWYgKHR5cGVvZiBpbml0aWFsU3RhdGUgPT09IFwndW5kZWZpbmVkXCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigiUmVkdWNlciBcXCIiICsga2V5ICsgIlxcIiByZXR1cm5lZCB1bmRlZmluZWQgZHVyaW5nIGluaXRpYWxpemF0aW9uLiAiICsgIklmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlIHJlZHVjZXIgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCAiICsgImV4cGxpY2l0bHkgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLiBUaGUgaW5pdGlhbCBzdGF0ZSBtYXkgIiArICJub3QgYmUgdW5kZWZpbmVkLiBJZiB5b3UgZG9uXCd0IHdhbnQgdG8gc2V0IGEgdmFsdWUgZm9yIHRoaXMgcmVkdWNlciwgIiArICJ5b3UgY2FuIHVzZSBudWxsIGluc3RlYWQgb2YgdW5kZWZpbmVkLiIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgIHR5cGU6IEFjdGlvblR5cGVzLlBST0JFX1VOS05PV05fQUNUSU9OKClcbiAgICB9KSA9PT0gXCd1bmRlZmluZWRcJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCJSZWR1Y2VyIFxcIiIgKyBrZXkgKyAiXFwiIHJldHVybmVkIHVuZGVmaW5lZCB3aGVuIHByb2JlZCB3aXRoIGEgcmFuZG9tIHR5cGUuICIgKyAoIkRvblwndCB0cnkgdG8gaGFuZGxlICIgKyBBY3Rpb25UeXBlcy5JTklUICsgIiBvciBvdGhlciBhY3Rpb25zIGluIFxcInJlZHV4LypcXCIgIikgKyAibmFtZXNwYWNlLiBUaGV5IGFyZSBjb25zaWRlcmVkIHByaXZhdGUuIEluc3RlYWQsIHlvdSBtdXN0IHJldHVybiB0aGUgIiArICJjdXJyZW50IHN0YXRlIGZvciBhbnkgdW5rbm93biBhY3Rpb25zLCB1bmxlc3MgaXQgaXMgdW5kZWZpbmVkLCAiICsgImluIHdoaWNoIGNhc2UgeW91IG11c3QgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlLCByZWdhcmRsZXNzIG9mIHRoZSAiICsgImFjdGlvbiB0eXBlLiBUaGUgaW5pdGlhbCBzdGF0ZSBtYXkgbm90IGJlIHVuZGVmaW5lZCwgYnV0IGNhbiBiZSBudWxsLiIpO1xuICAgIH1cbiAgfSk7XG59XG4vKipcbiAqIFR1cm5zIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIGRpZmZlcmVudCByZWR1Y2VyIGZ1bmN0aW9ucywgaW50byBhIHNpbmdsZVxuICogcmVkdWNlciBmdW5jdGlvbi4gSXQgd2lsbCBjYWxsIGV2ZXJ5IGNoaWxkIHJlZHVjZXIsIGFuZCBnYXRoZXIgdGhlaXIgcmVzdWx0c1xuICogaW50byBhIHNpbmdsZSBzdGF0ZSBvYmplY3QsIHdob3NlIGtleXMgY29ycmVzcG9uZCB0byB0aGUga2V5cyBvZiB0aGUgcGFzc2VkXG4gKiByZWR1Y2VyIGZ1bmN0aW9ucy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gcmVkdWNlcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBjb3JyZXNwb25kIHRvIGRpZmZlcmVudFxuICogcmVkdWNlciBmdW5jdGlvbnMgdGhhdCBuZWVkIHRvIGJlIGNvbWJpbmVkIGludG8gb25lLiBPbmUgaGFuZHkgd2F5IHRvIG9idGFpblxuICogaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXMgcmVkdWNlcnNgIHN5bnRheC4gVGhlIHJlZHVjZXJzIG1heSBuZXZlciByZXR1cm5cbiAqIHVuZGVmaW5lZCBmb3IgYW55IGFjdGlvbi4gSW5zdGVhZCwgdGhleSBzaG91bGQgcmV0dXJuIHRoZWlyIGluaXRpYWwgc3RhdGVcbiAqIGlmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlbSB3YXMgdW5kZWZpbmVkLCBhbmQgdGhlIGN1cnJlbnQgc3RhdGUgZm9yIGFueVxuICogdW5yZWNvZ25pemVkIGFjdGlvbi5cbiAqXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgcmVkdWNlciBmdW5jdGlvbiB0aGF0IGludm9rZXMgZXZlcnkgcmVkdWNlciBpbnNpZGUgdGhlXG4gKiBwYXNzZWQgb2JqZWN0LCBhbmQgYnVpbGRzIGEgc3RhdGUgb2JqZWN0IHdpdGggdGhlIHNhbWUgc2hhcGUuXG4gKi9cblxuXG5mdW5jdGlvbiBjb21iaW5lUmVkdWNlcnMocmVkdWNlcnMpIHtcbiAgdmFyIHJlZHVjZXJLZXlzID0gT2JqZWN0LmtleXMocmVkdWNlcnMpO1xuICB2YXIgZmluYWxSZWR1Y2VycyA9IHt9O1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcmVkdWNlcktleXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIga2V5ID0gcmVkdWNlcktleXNbaV07XG5cbiAgICBpZiAoZmFsc2UpIHt9XG5cbiAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09IFwnZnVuY3Rpb25cJykge1xuICAgICAgZmluYWxSZWR1Y2Vyc1trZXldID0gcmVkdWNlcnNba2V5XTtcbiAgICB9XG4gIH1cblxuICB2YXIgZmluYWxSZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKGZpbmFsUmVkdWNlcnMpOyAvLyBUaGlzIGlzIHVzZWQgdG8gbWFrZSBzdXJlIHdlIGRvblwndCB3YXJuIGFib3V0IHRoZSBzYW1lXG4gIC8vIGtleXMgbXVsdGlwbGUgdGltZXMuXG5cbiAgdmFyIHVuZXhwZWN0ZWRLZXlDYWNoZTtcblxuICBpZiAoZmFsc2UpIHt9XG5cbiAgdmFyIHNoYXBlQXNzZXJ0aW9uRXJyb3I7XG5cbiAgdHJ5IHtcbiAgICBhc3NlcnRSZWR1Y2VyU2hhcGUoZmluYWxSZWR1Y2Vycyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBzaGFwZUFzc2VydGlvbkVycm9yID0gZTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiBjb21iaW5hdGlvbihzdGF0ZSwgYWN0aW9uKSB7XG4gICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHtcbiAgICAgIHN0YXRlID0ge307XG4gICAgfVxuXG4gICAgaWYgKHNoYXBlQXNzZXJ0aW9uRXJyb3IpIHtcbiAgICAgIHRocm93IHNoYXBlQXNzZXJ0aW9uRXJyb3I7XG4gICAgfVxuXG4gICAgaWYgKGZhbHNlKSB7IHZhciB3YXJuaW5nTWVzc2FnZTsgfVxuXG4gICAgdmFyIGhhc0NoYW5nZWQgPSBmYWxzZTtcbiAgICB2YXIgbmV4dFN0YXRlID0ge307XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZmluYWxSZWR1Y2VyS2V5cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBfa2V5ID0gZmluYWxSZWR1Y2VyS2V5c1tfaV07XG4gICAgICB2YXIgcmVkdWNlciA9IGZpbmFsUmVkdWNlcnNbX2tleV07XG4gICAgICB2YXIgcHJldmlvdXNTdGF0ZUZvcktleSA9IHN0YXRlW19rZXldO1xuICAgICAgdmFyIG5leHRTdGF0ZUZvcktleSA9IHJlZHVjZXIocHJldmlvdXNTdGF0ZUZvcktleSwgYWN0aW9uKTtcblxuICAgICAgaWYgKHR5cGVvZiBuZXh0U3RhdGVGb3JLZXkgPT09IFwndW5kZWZpbmVkXCcpIHtcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IGdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlKF9rZXksIGFjdGlvbik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuXG4gICAgICBuZXh0U3RhdGVbX2tleV0gPSBuZXh0U3RhdGVGb3JLZXk7XG4gICAgICBoYXNDaGFuZ2VkID0gaGFzQ2hhbmdlZCB8fCBuZXh0U3RhdGVGb3JLZXkgIT09IHByZXZpb3VzU3RhdGVGb3JLZXk7XG4gICAgfVxuXG4gICAgaGFzQ2hhbmdlZCA9IGhhc0NoYW5nZWQgfHwgZmluYWxSZWR1Y2VyS2V5cy5sZW5ndGggIT09IE9iamVjdC5rZXlzKHN0YXRlKS5sZW5ndGg7XG4gICAgcmV0dXJuIGhhc0NoYW5nZWQgPyBuZXh0U3RhdGUgOiBzdGF0ZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGlzcGF0Y2goYWN0aW9uQ3JlYXRvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTtcbiAgfTtcbn1cbi8qKlxuICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uIGNyZWF0b3JzLCBpbnRvIGFuIG9iamVjdCB3aXRoIHRoZVxuICogc2FtZSBrZXlzLCBidXQgd2l0aCBldmVyeSBmdW5jdGlvbiB3cmFwcGVkIGludG8gYSBgZGlzcGF0Y2hgIGNhbGwgc28gdGhleVxuICogbWF5IGJlIGludm9rZWQgZGlyZWN0bHkuIFRoaXMgaXMganVzdCBhIGNvbnZlbmllbmNlIG1ldGhvZCwgYXMgeW91IGNhbiBjYWxsXG4gKiBgc3RvcmUuZGlzcGF0Y2goTXlBY3Rpb25DcmVhdG9ycy5kb1NvbWV0aGluZygpKWAgeW91cnNlbGYganVzdCBmaW5lLlxuICpcbiAqIEZvciBjb252ZW5pZW5jZSwgeW91IGNhbiBhbHNvIHBhc3MgYW4gYWN0aW9uIGNyZWF0b3IgYXMgdGhlIGZpcnN0IGFyZ3VtZW50LFxuICogYW5kIGdldCBhIGRpc3BhdGNoIHdyYXBwZWQgZnVuY3Rpb24gaW4gcmV0dXJuLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb258T2JqZWN0fSBhY3Rpb25DcmVhdG9ycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGFyZSBhY3Rpb25cbiAqIGNyZWF0b3IgZnVuY3Rpb25zLiBPbmUgaGFuZHkgd2F5IHRvIG9idGFpbiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhc2BcbiAqIHN5bnRheC4gWW91IG1heSBhbHNvIHBhc3MgYSBzaW5nbGUgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZGlzcGF0Y2ggVGhlIGBkaXNwYXRjaGAgZnVuY3Rpb24gYXZhaWxhYmxlIG9uIHlvdXIgUmVkdXhcbiAqIHN0b3JlLlxuICpcbiAqIEByZXR1cm5zIHtGdW5jdGlvbnxPYmplY3R9IFRoZSBvYmplY3QgbWltaWNraW5nIHRoZSBvcmlnaW5hbCBvYmplY3QsIGJ1dCB3aXRoXG4gKiBldmVyeSBhY3Rpb24gY3JlYXRvciB3cmFwcGVkIGludG8gdGhlIGBkaXNwYXRjaGAgY2FsbC4gSWYgeW91IHBhc3NlZCBhXG4gKiBmdW5jdGlvbiBhcyBgYWN0aW9uQ3JlYXRvcnNgLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgYWxzbyBiZSBhIHNpbmdsZVxuICogZnVuY3Rpb24uXG4gKi9cblxuXG5mdW5jdGlvbiBiaW5kQWN0aW9uQ3JlYXRvcnMoYWN0aW9uQ3JlYXRvcnMsIGRpc3BhdGNoKSB7XG4gIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvcnMgPT09IFwnZnVuY3Rpb25cJykge1xuICAgIHJldHVybiBiaW5kQWN0aW9uQ3JlYXRvcihhY3Rpb25DcmVhdG9ycywgZGlzcGF0Y2gpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBhY3Rpb25DcmVhdG9ycyAhPT0gXCdvYmplY3RcJyB8fCBhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcigiYmluZEFjdGlvbkNyZWF0b3JzIGV4cGVjdGVkIGFuIG9iamVjdCBvciBhIGZ1bmN0aW9uLCBpbnN0ZWFkIHJlY2VpdmVkICIgKyAoYWN0aW9uQ3JlYXRvcnMgPT09IG51bGwgPyBcJ251bGxcJyA6IHR5cGVvZiBhY3Rpb25DcmVhdG9ycykgKyAiLiAiICsgIkRpZCB5b3Ugd3JpdGUgXFwiaW1wb3J0IEFjdGlvbkNyZWF0b3JzIGZyb21cXCIgaW5zdGVhZCBvZiBcXCJpbXBvcnQgKiBhcyBBY3Rpb25DcmVhdG9ycyBmcm9tXFwiPyIpO1xuICB9XG5cbiAgdmFyIGJvdW5kQWN0aW9uQ3JlYXRvcnMgPSB7fTtcblxuICBmb3IgKHZhciBrZXkgaW4gYWN0aW9uQ3JlYXRvcnMpIHtcbiAgICB2YXIgYWN0aW9uQ3JlYXRvciA9IGFjdGlvbkNyZWF0b3JzW2tleV07XG5cbiAgICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3IgPT09IFwnZnVuY3Rpb25cJykge1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9yc1trZXldID0gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBib3VuZEFjdGlvbkNyZWF0b3JzO1xufVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWVcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIG9iajtcbn1cblxuZnVuY3Rpb24gcmVkdXhfb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTtcblxuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCkpO1xuICB9XG5cbiAgaWYgKGVudW1lcmFibGVPbmx5KSBrZXlzID0ga2V5cy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkge1xuICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlO1xuICB9KTtcbiAgcmV0dXJuIGtleXM7XG59XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQyKHRhcmdldCkge1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9O1xuXG4gICAgaWYgKGkgJSAyKSB7XG4gICAgICByZWR1eF9vd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVkdXhfb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbi8qKlxuICogQ29tcG9zZXMgc2luZ2xlLWFyZ3VtZW50IGZ1bmN0aW9ucyBmcm9tIHJpZ2h0IHRvIGxlZnQuIFRoZSByaWdodG1vc3RcbiAqIGZ1bmN0aW9uIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cyBhcyBpdCBwcm92aWRlcyB0aGUgc2lnbmF0dXJlIGZvclxuICogdGhlIHJlc3VsdGluZyBjb21wb3NpdGUgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gZnVuY3MgVGhlIGZ1bmN0aW9ucyB0byBjb21wb3NlLlxuICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGZ1bmN0aW9uIG9idGFpbmVkIGJ5IGNvbXBvc2luZyB0aGUgYXJndW1lbnQgZnVuY3Rpb25zXG4gKiBmcm9tIHJpZ2h0IHRvIGxlZnQuIEZvciBleGFtcGxlLCBjb21wb3NlKGYsIGcsIGgpIGlzIGlkZW50aWNhbCB0byBkb2luZ1xuICogKC4uLmFyZ3MpID0+IGYoZyhoKC4uLmFyZ3MpKSkuXG4gKi9cbmZ1bmN0aW9uIGNvbXBvc2UoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBmdW5jcyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBmdW5jc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGFyZykge1xuICAgICAgcmV0dXJuIGFyZztcbiAgICB9O1xuICB9XG5cbiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBmdW5jc1swXTtcbiAgfVxuXG4gIHJldHVybiBmdW5jcy5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGEoYi5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cykpO1xuICAgIH07XG4gIH0pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzdG9yZSBlbmhhbmNlciB0aGF0IGFwcGxpZXMgbWlkZGxld2FyZSB0byB0aGUgZGlzcGF0Y2ggbWV0aG9kXG4gKiBvZiB0aGUgUmVkdXggc3RvcmUuIFRoaXMgaXMgaGFuZHkgZm9yIGEgdmFyaWV0eSBvZiB0YXNrcywgc3VjaCBhcyBleHByZXNzaW5nXG4gKiBhc3luY2hyb25vdXMgYWN0aW9ucyBpbiBhIGNvbmNpc2UgbWFubmVyLCBvciBsb2dnaW5nIGV2ZXJ5IGFjdGlvbiBwYXlsb2FkLlxuICpcbiAqIFNlZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UgYXMgYW4gZXhhbXBsZSBvZiB0aGUgUmVkdXggbWlkZGxld2FyZS5cbiAqXG4gKiBCZWNhdXNlIG1pZGRsZXdhcmUgaXMgcG90ZW50aWFsbHkgYXN5bmNocm9ub3VzLCB0aGlzIHNob3VsZCBiZSB0aGUgZmlyc3RcbiAqIHN0b3JlIGVuaGFuY2VyIGluIHRoZSBjb21wb3NpdGlvbiBjaGFpbi5cbiAqXG4gKiBOb3RlIHRoYXQgZWFjaCBtaWRkbGV3YXJlIHdpbGwgYmUgZ2l2ZW4gdGhlIGBkaXNwYXRjaGAgYW5kIGBnZXRTdGF0ZWAgZnVuY3Rpb25zXG4gKiBhcyBuYW1lZCBhcmd1bWVudHMuXG4gKlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gbWlkZGxld2FyZXMgVGhlIG1pZGRsZXdhcmUgY2hhaW4gdG8gYmUgYXBwbGllZC5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBzdG9yZSBlbmhhbmNlciBhcHBseWluZyB0aGUgbWlkZGxld2FyZS5cbiAqL1xuXG5mdW5jdGlvbiBhcHBseU1pZGRsZXdhcmUoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtaWRkbGV3YXJlcyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBtaWRkbGV3YXJlc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoY3JlYXRlU3RvcmUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0b3JlID0gY3JlYXRlU3RvcmUuYXBwbHkodm9pZCAwLCBhcmd1bWVudHMpO1xuXG4gICAgICB2YXIgX2Rpc3BhdGNoID0gZnVuY3Rpb24gZGlzcGF0Y2goKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcJ0Rpc3BhdGNoaW5nIHdoaWxlIGNvbnN0cnVjdGluZyB5b3VyIG1pZGRsZXdhcmUgaXMgbm90IGFsbG93ZWQuIFwnICsgXCdPdGhlciBtaWRkbGV3YXJlIHdvdWxkIG5vdCBiZSBhcHBsaWVkIHRvIHRoaXMgZGlzcGF0Y2guXCcpO1xuICAgICAgfTtcblxuICAgICAgdmFyIG1pZGRsZXdhcmVBUEkgPSB7XG4gICAgICAgIGdldFN0YXRlOiBzdG9yZS5nZXRTdGF0ZSxcbiAgICAgICAgZGlzcGF0Y2g6IGZ1bmN0aW9uIGRpc3BhdGNoKCkge1xuICAgICAgICAgIHJldHVybiBfZGlzcGF0Y2guYXBwbHkodm9pZCAwLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdmFyIGNoYWluID0gbWlkZGxld2FyZXMubWFwKGZ1bmN0aW9uIChtaWRkbGV3YXJlKSB7XG4gICAgICAgIHJldHVybiBtaWRkbGV3YXJlKG1pZGRsZXdhcmVBUEkpO1xuICAgICAgfSk7XG4gICAgICBfZGlzcGF0Y2ggPSBjb21wb3NlLmFwcGx5KHZvaWQgMCwgY2hhaW4pKHN0b3JlLmRpc3BhdGNoKTtcbiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkMih7fSwgc3RvcmUsIHtcbiAgICAgICAgZGlzcGF0Y2g6IF9kaXNwYXRjaFxuICAgICAgfSk7XG4gICAgfTtcbiAgfTtcbn1cblxuLypcbiAqIFRoaXMgaXMgYSBkdW1teSBmdW5jdGlvbiB0byBjaGVjayBpZiB0aGUgZnVuY3Rpb24gbmFtZSBoYXMgYmVlbiBhbHRlcmVkIGJ5IG1pbmlmaWNhdGlvbi5cbiAqIElmIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBtaW5pZmllZCBhbmQgTk9ERV9FTlYgIT09IFwncHJvZHVjdGlvblwnLCB3YXJuIHRoZSB1c2VyLlxuICovXG5cbmZ1bmN0aW9uIGlzQ3J1c2hlZCgpIHt9XG5cbmlmIChmYWxzZSkge31cblxuXG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QvaW5kZXguanNcbnZhciByZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMCk7XG52YXIgcmVhY3RfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4ocmVhY3QpO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3Byb3AtdHlwZXMvaW5kZXguanNcbnZhciBwcm9wX3R5cGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL2NvbXBvbmVudHMvQ29udGV4dC5qc1xuXG52YXIgUmVhY3RSZWR1eENvbnRleHQgPVxuLyojX19QVVJFX18qL1xucmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUNvbnRleHQobnVsbCk7XG5cbmlmIChmYWxzZSkge31cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgY29tcG9uZW50c19Db250ZXh0ID0gKFJlYWN0UmVkdXhDb250ZXh0KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL3V0aWxzL2JhdGNoLmpzXG4vLyBEZWZhdWx0IHRvIGEgZHVtbXkgImJhdGNoIiBpbXBsZW1lbnRhdGlvbiB0aGF0IGp1c3QgcnVucyB0aGUgY2FsbGJhY2tcbmZ1bmN0aW9uIGRlZmF1bHROb29wQmF0Y2goY2FsbGJhY2spIHtcbiAgY2FsbGJhY2soKTtcbn1cblxudmFyIGJhdGNoX2JhdGNoID0gZGVmYXVsdE5vb3BCYXRjaDsgLy8gQWxsb3cgaW5qZWN0aW5nIGFub3RoZXIgYmF0Y2hpbmcgZnVuY3Rpb24gbGF0ZXJcblxudmFyIHNldEJhdGNoID0gZnVuY3Rpb24gc2V0QmF0Y2gobmV3QmF0Y2gpIHtcbiAgcmV0dXJuIGJhdGNoX2JhdGNoID0gbmV3QmF0Y2g7XG59OyAvLyBTdXBwbHkgYSBnZXR0ZXIganVzdCB0byBza2lwIGRlYWxpbmcgd2l0aCBFU00gYmluZGluZ3NcblxudmFyIGdldEJhdGNoID0gZnVuY3Rpb24gZ2V0QmF0Y2goKSB7XG4gIHJldHVybiBiYXRjaF9iYXRjaDtcbn07XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy91dGlscy9TdWJzY3JpcHRpb24uanNcbiAvLyBlbmNhcHN1bGF0ZXMgdGhlIHN1YnNjcmlwdGlvbiBsb2dpYyBmb3IgY29ubmVjdGluZyBhIGNvbXBvbmVudCB0byB0aGUgcmVkdXggc3RvcmUsIGFzXG4vLyB3ZWxsIGFzIG5lc3Rpbmcgc3Vic2NyaXB0aW9ucyBvZiBkZXNjZW5kYW50IGNvbXBvbmVudHMsIHNvIHRoYXQgd2UgY2FuIGVuc3VyZSB0aGVcbi8vIGFuY2VzdG9yIGNvbXBvbmVudHMgcmUtcmVuZGVyIGJlZm9yZSBkZXNjZW5kYW50c1xuXG52YXIgbnVsbExpc3RlbmVycyA9IHtcbiAgbm90aWZ5OiBmdW5jdGlvbiBub3RpZnkoKSB7fVxufTtcblxuZnVuY3Rpb24gY3JlYXRlTGlzdGVuZXJDb2xsZWN0aW9uKCkge1xuICB2YXIgYmF0Y2ggPSBnZXRCYXRjaCgpO1xuICB2YXIgZmlyc3QgPSBudWxsO1xuICB2YXIgbGFzdCA9IG51bGw7XG4gIHJldHVybiB7XG4gICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgICAgZmlyc3QgPSBudWxsO1xuICAgICAgbGFzdCA9IG51bGw7XG4gICAgfSxcbiAgICBub3RpZnk6IGZ1bmN0aW9uIG5vdGlmeSgpIHtcbiAgICAgIGJhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxpc3RlbmVyID0gZmlyc3Q7XG5cbiAgICAgICAgd2hpbGUgKGxpc3RlbmVyKSB7XG4gICAgICAgICAgbGlzdGVuZXIuY2FsbGJhY2soKTtcbiAgICAgICAgICBsaXN0ZW5lciA9IGxpc3RlbmVyLm5leHQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICB2YXIgbGlzdGVuZXJzID0gW107XG4gICAgICB2YXIgbGlzdGVuZXIgPSBmaXJzdDtcblxuICAgICAgd2hpbGUgKGxpc3RlbmVyKSB7XG4gICAgICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgICAgbGlzdGVuZXIgPSBsaXN0ZW5lci5uZXh0O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbGlzdGVuZXJzO1xuICAgIH0sXG4gICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUoY2FsbGJhY2spIHtcbiAgICAgIHZhciBpc1N1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgdmFyIGxpc3RlbmVyID0gbGFzdCA9IHtcbiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrLFxuICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICBwcmV2OiBsYXN0XG4gICAgICB9O1xuXG4gICAgICBpZiAobGlzdGVuZXIucHJldikge1xuICAgICAgICBsaXN0ZW5lci5wcmV2Lm5leHQgPSBsaXN0ZW5lcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpcnN0ID0gbGlzdGVuZXI7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiB1bnN1YnNjcmliZSgpIHtcbiAgICAgICAgaWYgKCFpc1N1YnNjcmliZWQgfHwgZmlyc3QgPT09IG51bGwpIHJldHVybjtcbiAgICAgICAgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGxpc3RlbmVyLm5leHQpIHtcbiAgICAgICAgICBsaXN0ZW5lci5uZXh0LnByZXYgPSBsaXN0ZW5lci5wcmV2O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxhc3QgPSBsaXN0ZW5lci5wcmV2O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpc3RlbmVyLnByZXYpIHtcbiAgICAgICAgICBsaXN0ZW5lci5wcmV2Lm5leHQgPSBsaXN0ZW5lci5uZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZpcnN0ID0gbGlzdGVuZXIubmV4dDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH07XG59XG5cbnZhciBTdWJzY3JpcHRpb24gPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTdWJzY3JpcHRpb24oc3RvcmUsIHBhcmVudFN1Yikge1xuICAgIHRoaXMuc3RvcmUgPSBzdG9yZTtcbiAgICB0aGlzLnBhcmVudFN1YiA9IHBhcmVudFN1YjtcbiAgICB0aGlzLnVuc3Vic2NyaWJlID0gbnVsbDtcbiAgICB0aGlzLmxpc3RlbmVycyA9IG51bGxMaXN0ZW5lcnM7XG4gICAgdGhpcy5oYW5kbGVDaGFuZ2VXcmFwcGVyID0gdGhpcy5oYW5kbGVDaGFuZ2VXcmFwcGVyLmJpbmQodGhpcyk7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gU3Vic2NyaXB0aW9uLnByb3RvdHlwZTtcblxuICBfcHJvdG8uYWRkTmVzdGVkU3ViID0gZnVuY3Rpb24gYWRkTmVzdGVkU3ViKGxpc3RlbmVyKSB7XG4gICAgdGhpcy50cnlTdWJzY3JpYmUoKTtcbiAgICByZXR1cm4gdGhpcy5saXN0ZW5lcnMuc3Vic2NyaWJlKGxpc3RlbmVyKTtcbiAgfTtcblxuICBfcHJvdG8ubm90aWZ5TmVzdGVkU3VicyA9IGZ1bmN0aW9uIG5vdGlmeU5lc3RlZFN1YnMoKSB7XG4gICAgdGhpcy5saXN0ZW5lcnMubm90aWZ5KCk7XG4gIH07XG5cbiAgX3Byb3RvLmhhbmRsZUNoYW5nZVdyYXBwZXIgPSBmdW5jdGlvbiBoYW5kbGVDaGFuZ2VXcmFwcGVyKCkge1xuICAgIGlmICh0aGlzLm9uU3RhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMub25TdGF0ZUNoYW5nZSgpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8uaXNTdWJzY3JpYmVkID0gZnVuY3Rpb24gaXNTdWJzY3JpYmVkKCkge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMudW5zdWJzY3JpYmUpO1xuICB9O1xuXG4gIF9wcm90by50cnlTdWJzY3JpYmUgPSBmdW5jdGlvbiB0cnlTdWJzY3JpYmUoKSB7XG4gICAgaWYgKCF0aGlzLnVuc3Vic2NyaWJlKSB7XG4gICAgICB0aGlzLnVuc3Vic2NyaWJlID0gdGhpcy5wYXJlbnRTdWIgPyB0aGlzLnBhcmVudFN1Yi5hZGROZXN0ZWRTdWIodGhpcy5oYW5kbGVDaGFuZ2VXcmFwcGVyKSA6IHRoaXMuc3RvcmUuc3Vic2NyaWJlKHRoaXMuaGFuZGxlQ2hhbmdlV3JhcHBlcik7XG4gICAgICB0aGlzLmxpc3RlbmVycyA9IGNyZWF0ZUxpc3RlbmVyQ29sbGVjdGlvbigpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8udHJ5VW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB0cnlVbnN1YnNjcmliZSgpIHtcbiAgICBpZiAodGhpcy51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy51bnN1YnNjcmliZSA9IG51bGw7XG4gICAgICB0aGlzLmxpc3RlbmVycy5jbGVhcigpO1xuICAgICAgdGhpcy5saXN0ZW5lcnMgPSBudWxsTGlzdGVuZXJzO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gU3Vic2NyaXB0aW9uO1xufSgpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL2NvbXBvbmVudHMvUHJvdmlkZXIuanNcblxuXG5cblxuXG5mdW5jdGlvbiBQcm92aWRlcihfcmVmKSB7XG4gIHZhciBzdG9yZSA9IF9yZWYuc3RvcmUsXG4gICAgICBjb250ZXh0ID0gX3JlZi5jb250ZXh0LFxuICAgICAgY2hpbGRyZW4gPSBfcmVmLmNoaWxkcmVuO1xuICB2YXIgY29udGV4dFZhbHVlID0gT2JqZWN0KHJlYWN0WyJ1c2VNZW1vIl0pKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbihzdG9yZSk7XG4gICAgc3Vic2NyaXB0aW9uLm9uU3RhdGVDaGFuZ2UgPSBzdWJzY3JpcHRpb24ubm90aWZ5TmVzdGVkU3VicztcbiAgICByZXR1cm4ge1xuICAgICAgc3RvcmU6IHN0b3JlLFxuICAgICAgc3Vic2NyaXB0aW9uOiBzdWJzY3JpcHRpb25cbiAgICB9O1xuICB9LCBbc3RvcmVdKTtcbiAgdmFyIHByZXZpb3VzU3RhdGUgPSBPYmplY3QocmVhY3RbInVzZU1lbW8iXSkoZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpO1xuICB9LCBbc3RvcmVdKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdWJzY3JpcHRpb24gPSBjb250ZXh0VmFsdWUuc3Vic2NyaXB0aW9uO1xuICAgIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTtcblxuICAgIGlmIChwcmV2aW91c1N0YXRlICE9PSBzdG9yZS5nZXRTdGF0ZSgpKSB7XG4gICAgICBzdWJzY3JpcHRpb24ubm90aWZ5TmVzdGVkU3VicygpO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICAgIHN1YnNjcmlwdGlvbi5vblN0YXRlQ2hhbmdlID0gbnVsbDtcbiAgICB9O1xuICB9LCBbY29udGV4dFZhbHVlLCBwcmV2aW91c1N0YXRlXSk7XG4gIHZhciBDb250ZXh0ID0gY29udGV4dCB8fCBSZWFjdFJlZHV4Q29udGV4dDtcbiAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KENvbnRleHQuUHJvdmlkZXIsIHtcbiAgICB2YWx1ZTogY29udGV4dFZhbHVlXG4gIH0sIGNoaWxkcmVuKTtcbn1cblxuaWYgKGZhbHNlKSB7fVxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBjb21wb25lbnRzX1Byb3ZpZGVyID0gKFByb3ZpZGVyKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2V4dGVuZHMuanNcbmZ1bmN0aW9uIF9leHRlbmRzKCkge1xuICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7XG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0YXJnZXQ7XG4gIH07XG5cbiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG59XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlLmpzXG5mdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7XG4gIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9O1xuICB2YXIgdGFyZ2V0ID0ge307XG4gIHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTtcbiAgdmFyIGtleSwgaTtcblxuICBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykge1xuICAgIGtleSA9IHNvdXJjZUtleXNbaV07XG4gICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTtcbiAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvaG9pc3Qtbm9uLXJlYWN0LXN0YXRpY3MvZGlzdC9ob2lzdC1ub24tcmVhY3Qtc3RhdGljcy5janMuanNcbnZhciBob2lzdF9ub25fcmVhY3Rfc3RhdGljc19janMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgpO1xudmFyIGhvaXN0X25vbl9yZWFjdF9zdGF0aWNzX2Nqc19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihob2lzdF9ub25fcmVhY3Rfc3RhdGljc19janMpO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LWlzL2luZGV4LmpzXG52YXIgcmVhY3RfaXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy91dGlscy91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0LmpzXG4gLy8gUmVhY3QgY3VycmVudGx5IHRocm93cyBhIHdhcm5pbmcgd2hlbiB1c2luZyB1c2VMYXlvdXRFZmZlY3Qgb24gdGhlIHNlcnZlci5cbi8vIFRvIGdldCBhcm91bmQgaXQsIHdlIGNhbiBjb25kaXRpb25hbGx5IHVzZUVmZmVjdCBvbiB0aGUgc2VydmVyIChuby1vcCkgYW5kXG4vLyB1c2VMYXlvdXRFZmZlY3QgaW4gdGhlIGJyb3dzZXIuIFdlIG5lZWQgdXNlTGF5b3V0RWZmZWN0IHRvIGVuc3VyZSB0aGUgc3RvcmVcbi8vIHN1YnNjcmlwdGlvbiBjYWxsYmFjayBhbHdheXMgaGFzIHRoZSBzZWxlY3RvciBmcm9tIHRoZSBsYXRlc3QgcmVuZGVyIGNvbW1pdFxuLy8gYXZhaWxhYmxlLCBvdGhlcndpc2UgYSBzdG9yZSB1cGRhdGUgbWF5IGhhcHBlbiBiZXR3ZWVuIHJlbmRlciBhbmQgdGhlIGVmZmVjdCxcbi8vIHdoaWNoIG1heSBjYXVzZSBtaXNzZWQgdXBkYXRlczsgd2UgYWxzbyBtdXN0IGVuc3VyZSB0aGUgc3RvcmUgc3Vic2NyaXB0aW9uXG4vLyBpcyBjcmVhdGVkIHN5bmNocm9ub3VzbHksIG90aGVyd2lzZSBhIHN0b3JlIHVwZGF0ZSBtYXkgb2NjdXIgYmVmb3JlIHRoZVxuLy8gc3Vic2NyaXB0aW9uIGlzIGNyZWF0ZWQgYW5kIGFuIGluY29uc2lzdGVudCBzdGF0ZSBtYXkgYmUgb2JzZXJ2ZWRcblxudmFyIHVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QgPSB0eXBlb2Ygd2luZG93ICE9PSBcJ3VuZGVmaW5lZFwnICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09IFwndW5kZWZpbmVkXCcgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSBcJ3VuZGVmaW5lZFwnID8gcmVhY3RbInVzZUxheW91dEVmZmVjdCJdIDogcmVhY3RbInVzZUVmZmVjdCJdO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvY29tcG9uZW50cy9jb25uZWN0QWR2YW5jZWQuanNcblxuXG5cblxuXG5cblxuIC8vIERlZmluZSBzb21lIGNvbnN0YW50IGFycmF5cyBqdXN0IHRvIGF2b2lkIHJlLWNyZWF0aW5nIHRoZXNlXG5cbnZhciBFTVBUWV9BUlJBWSA9IFtdO1xudmFyIE5PX1NVQlNDUklQVElPTl9BUlJBWSA9IFtudWxsLCBudWxsXTtcblxudmFyIHN0cmluZ2lmeUNvbXBvbmVudCA9IGZ1bmN0aW9uIHN0cmluZ2lmeUNvbXBvbmVudChDb21wKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KENvbXApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICByZXR1cm4gU3RyaW5nKENvbXApO1xuICB9XG59O1xuXG5mdW5jdGlvbiBzdG9yZVN0YXRlVXBkYXRlc1JlZHVjZXIoc3RhdGUsIGFjdGlvbikge1xuICB2YXIgdXBkYXRlQ291bnQgPSBzdGF0ZVsxXTtcbiAgcmV0dXJuIFthY3Rpb24ucGF5bG9hZCwgdXBkYXRlQ291bnQgKyAxXTtcbn1cblxuZnVuY3Rpb24gdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdFdpdGhBcmdzKGVmZmVjdEZ1bmMsIGVmZmVjdEFyZ3MsIGRlcGVuZGVuY2llcykge1xuICB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZWZmZWN0RnVuYy5hcHBseSh2b2lkIDAsIGVmZmVjdEFyZ3MpO1xuICB9LCBkZXBlbmRlbmNpZXMpO1xufVxuXG5mdW5jdGlvbiBjYXB0dXJlV3JhcHBlclByb3BzKGxhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgd3JhcHBlclByb3BzLCBhY3R1YWxDaGlsZFByb3BzLCBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLCBub3RpZnlOZXN0ZWRTdWJzKSB7XG4gIC8vIFdlIHdhbnQgdG8gY2FwdHVyZSB0aGUgd3JhcHBlciBwcm9wcyBhbmQgY2hpbGQgcHJvcHMgd2UgdXNlZCBmb3IgbGF0ZXIgY29tcGFyaXNvbnNcbiAgbGFzdFdyYXBwZXJQcm9wcy5jdXJyZW50ID0gd3JhcHBlclByb3BzO1xuICBsYXN0Q2hpbGRQcm9wcy5jdXJyZW50ID0gYWN0dWFsQ2hpbGRQcm9wcztcbiAgcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCA9IGZhbHNlOyAvLyBJZiB0aGUgcmVuZGVyIHdhcyBmcm9tIGEgc3RvcmUgdXBkYXRlLCBjbGVhciBvdXQgdGhhdCByZWZlcmVuY2UgYW5kIGNhc2NhZGUgdGhlIHN1YnNjcmliZXIgdXBkYXRlXG5cbiAgaWYgKGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCkge1xuICAgIGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCA9IG51bGw7XG4gICAgbm90aWZ5TmVzdGVkU3VicygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHN1YnNjcmliZVVwZGF0ZXMoc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzLCBzdG9yZSwgc3Vic2NyaXB0aW9uLCBjaGlsZFByb3BzU2VsZWN0b3IsIGxhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZSwgbm90aWZ5TmVzdGVkU3VicywgZm9yY2VDb21wb25lbnRVcGRhdGVEaXNwYXRjaCkge1xuICAvLyBJZiB3ZVwncmUgbm90IHN1YnNjcmliZWQgdG8gdGhlIHN0b3JlLCBub3RoaW5nIHRvIGRvIGhlcmVcbiAgaWYgKCFzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMpIHJldHVybjsgLy8gQ2FwdHVyZSB2YWx1ZXMgZm9yIGNoZWNraW5nIGlmIGFuZCB3aGVuIHRoaXMgY29tcG9uZW50IHVubW91bnRzXG5cbiAgdmFyIGRpZFVuc3Vic2NyaWJlID0gZmFsc2U7XG4gIHZhciBsYXN0VGhyb3duRXJyb3IgPSBudWxsOyAvLyBXZVwnbGwgcnVuIHRoaXMgY2FsbGJhY2sgZXZlcnkgdGltZSBhIHN0b3JlIHN1YnNjcmlwdGlvbiB1cGRhdGUgcHJvcGFnYXRlcyB0byB0aGlzIGNvbXBvbmVudFxuXG4gIHZhciBjaGVja0ZvclVwZGF0ZXMgPSBmdW5jdGlvbiBjaGVja0ZvclVwZGF0ZXMoKSB7XG4gICAgaWYgKGRpZFVuc3Vic2NyaWJlKSB7XG4gICAgICAvLyBEb25cJ3QgcnVuIHN0YWxlIGxpc3RlbmVycy5cbiAgICAgIC8vIFJlZHV4IGRvZXNuXCd0IGd1YXJhbnRlZSB1bnN1YnNjcmlwdGlvbnMgaGFwcGVuIHVudGlsIG5leHQgZGlzcGF0Y2guXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGxhdGVzdFN0b3JlU3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuICAgIHZhciBuZXdDaGlsZFByb3BzLCBlcnJvcjtcblxuICAgIHRyeSB7XG4gICAgICAvLyBBY3R1YWxseSBydW4gdGhlIHNlbGVjdG9yIHdpdGggdGhlIG1vc3QgcmVjZW50IHN0b3JlIHN0YXRlIGFuZCB3cmFwcGVyIHByb3BzXG4gICAgICAvLyB0byBkZXRlcm1pbmUgd2hhdCB0aGUgY2hpbGQgcHJvcHMgc2hvdWxkIGJlXG4gICAgICBuZXdDaGlsZFByb3BzID0gY2hpbGRQcm9wc1NlbGVjdG9yKGxhdGVzdFN0b3JlU3RhdGUsIGxhc3RXcmFwcGVyUHJvcHMuY3VycmVudCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyb3IgPSBlO1xuICAgICAgbGFzdFRocm93bkVycm9yID0gZTtcbiAgICB9XG5cbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICBsYXN0VGhyb3duRXJyb3IgPSBudWxsO1xuICAgIH0gLy8gSWYgdGhlIGNoaWxkIHByb3BzIGhhdmVuXCd0IGNoYW5nZWQsIG5vdGhpbmcgdG8gZG8gaGVyZSAtIGNhc2NhZGUgdGhlIHN1YnNjcmlwdGlvbiB1cGRhdGVcblxuXG4gICAgaWYgKG5ld0NoaWxkUHJvcHMgPT09IGxhc3RDaGlsZFByb3BzLmN1cnJlbnQpIHtcbiAgICAgIGlmICghcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCkge1xuICAgICAgICBub3RpZnlOZXN0ZWRTdWJzKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNhdmUgcmVmZXJlbmNlcyB0byB0aGUgbmV3IGNoaWxkIHByb3BzLiAgTm90ZSB0aGF0IHdlIHRyYWNrIHRoZSAiY2hpbGQgcHJvcHMgZnJvbSBzdG9yZSB1cGRhdGUiXG4gICAgICAvLyBhcyBhIHJlZiBpbnN0ZWFkIG9mIGEgdXNlU3RhdGUvdXNlUmVkdWNlciBiZWNhdXNlIHdlIG5lZWQgYSB3YXkgdG8gZGV0ZXJtaW5lIGlmIHRoYXQgdmFsdWUgaGFzXG4gICAgICAvLyBiZWVuIHByb2Nlc3NlZC4gIElmIHRoaXMgd2VudCBpbnRvIHVzZVN0YXRlL3VzZVJlZHVjZXIsIHdlIGNvdWxkblwndCBjbGVhciBvdXQgdGhlIHZhbHVlIHdpdGhvdXRcbiAgICAgIC8vIGZvcmNpbmcgYW5vdGhlciByZS1yZW5kZXIsIHdoaWNoIHdlIGRvblwndCB3YW50LlxuICAgICAgbGFzdENoaWxkUHJvcHMuY3VycmVudCA9IG5ld0NoaWxkUHJvcHM7XG4gICAgICBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQgPSBuZXdDaGlsZFByb3BzO1xuICAgICAgcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCA9IHRydWU7IC8vIElmIHRoZSBjaGlsZCBwcm9wcyBfZGlkXyBjaGFuZ2UgKG9yIHdlIGNhdWdodCBhbiBlcnJvciksIHRoaXMgd3JhcHBlciBjb21wb25lbnQgbmVlZHMgdG8gcmUtcmVuZGVyXG5cbiAgICAgIGZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2goe1xuICAgICAgICB0eXBlOiBcJ1NUT1JFX1VQREFURURcJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGVycm9yOiBlcnJvclxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07IC8vIEFjdHVhbGx5IHN1YnNjcmliZSB0byB0aGUgbmVhcmVzdCBjb25uZWN0ZWQgYW5jZXN0b3IgKG9yIHN0b3JlKVxuXG5cbiAgc3Vic2NyaXB0aW9uLm9uU3RhdGVDaGFuZ2UgPSBjaGVja0ZvclVwZGF0ZXM7XG4gIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTsgLy8gUHVsbCBkYXRhIGZyb20gdGhlIHN0b3JlIGFmdGVyIGZpcnN0IHJlbmRlciBpbiBjYXNlIHRoZSBzdG9yZSBoYXNcbiAgLy8gY2hhbmdlZCBzaW5jZSB3ZSBiZWdhbi5cblxuICBjaGVja0ZvclVwZGF0ZXMoKTtcblxuICB2YXIgdW5zdWJzY3JpYmVXcmFwcGVyID0gZnVuY3Rpb24gdW5zdWJzY3JpYmVXcmFwcGVyKCkge1xuICAgIGRpZFVuc3Vic2NyaWJlID0gdHJ1ZTtcbiAgICBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICBzdWJzY3JpcHRpb24ub25TdGF0ZUNoYW5nZSA9IG51bGw7XG5cbiAgICBpZiAobGFzdFRocm93bkVycm9yKSB7XG4gICAgICAvLyBJdFwncyBwb3NzaWJsZSB0aGF0IHdlIGNhdWdodCBhbiBlcnJvciBkdWUgdG8gYSBiYWQgbWFwU3RhdGUgZnVuY3Rpb24sIGJ1dCB0aGVcbiAgICAgIC8vIHBhcmVudCByZS1yZW5kZXJlZCB3aXRob3V0IHRoaXMgY29tcG9uZW50IGFuZCB3ZVwncmUgYWJvdXQgdG8gdW5tb3VudC5cbiAgICAgIC8vIFRoaXMgc2hvdWxkblwndCBoYXBwZW4gYXMgbG9uZyBhcyB3ZSBkbyB0b3AtZG93biBzdWJzY3JpcHRpb25zIGNvcnJlY3RseSwgYnV0XG4gICAgICAvLyBpZiB3ZSBldmVyIGRvIHRob3NlIHdyb25nLCB0aGlzIHRocm93IHdpbGwgc3VyZmFjZSB0aGUgZXJyb3IgaW4gb3VyIHRlc3RzLlxuICAgICAgLy8gSW4gdGhhdCBjYXNlLCB0aHJvdyB0aGUgZXJyb3IgZnJvbSBoZXJlIHNvIGl0IGRvZXNuXCd0IGdldCBsb3N0LlxuICAgICAgdGhyb3cgbGFzdFRocm93bkVycm9yO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gdW5zdWJzY3JpYmVXcmFwcGVyO1xufVxuXG52YXIgaW5pdFN0YXRlVXBkYXRlcyA9IGZ1bmN0aW9uIGluaXRTdGF0ZVVwZGF0ZXMoKSB7XG4gIHJldHVybiBbbnVsbCwgMF07XG59O1xuXG5mdW5jdGlvbiBjb25uZWN0QWR2YW5jZWQoXG4vKlxyXG4gIHNlbGVjdG9yRmFjdG9yeSBpcyBhIGZ1bmMgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgcmV0dXJuaW5nIHRoZSBzZWxlY3RvciBmdW5jdGlvbiB1c2VkIHRvXHJcbiAgY29tcHV0ZSBuZXcgcHJvcHMgZnJvbSBzdGF0ZSwgcHJvcHMsIGFuZCBkaXNwYXRjaC4gRm9yIGV4YW1wbGU6XHJcbiAgICAgIGV4cG9ydCBkZWZhdWx0IGNvbm5lY3RBZHZhbmNlZCgoZGlzcGF0Y2gsIG9wdGlvbnMpID0+IChzdGF0ZSwgcHJvcHMpID0+ICh7XHJcbiAgICAgIHRoaW5nOiBzdGF0ZS50aGluZ3NbcHJvcHMudGhpbmdJZF0sXHJcbiAgICAgIHNhdmVUaGluZzogZmllbGRzID0+IGRpc3BhdGNoKGFjdGlvbkNyZWF0b3JzLnNhdmVUaGluZyhwcm9wcy50aGluZ0lkLCBmaWVsZHMpKSxcclxuICAgIH0pKShZb3VyQ29tcG9uZW50KVxyXG4gICAgQWNjZXNzIHRvIGRpc3BhdGNoIGlzIHByb3ZpZGVkIHRvIHRoZSBmYWN0b3J5IHNvIHNlbGVjdG9yRmFjdG9yaWVzIGNhbiBiaW5kIGFjdGlvbkNyZWF0b3JzXHJcbiAgb3V0c2lkZSBvZiB0aGVpciBzZWxlY3RvciBhcyBhbiBvcHRpbWl6YXRpb24uIE9wdGlvbnMgcGFzc2VkIHRvIGNvbm5lY3RBZHZhbmNlZCBhcmUgcGFzc2VkIHRvXHJcbiAgdGhlIHNlbGVjdG9yRmFjdG9yeSwgYWxvbmcgd2l0aCBkaXNwbGF5TmFtZSBhbmQgV3JhcHBlZENvbXBvbmVudCwgYXMgdGhlIHNlY29uZCBhcmd1bWVudC5cclxuICAgIE5vdGUgdGhhdCBzZWxlY3RvckZhY3RvcnkgaXMgcmVzcG9uc2libGUgZm9yIGFsbCBjYWNoaW5nL21lbW9pemF0aW9uIG9mIGluYm91bmQgYW5kIG91dGJvdW5kXHJcbiAgcHJvcHMuIERvIG5vdCB1c2UgY29ubmVjdEFkdmFuY2VkIGRpcmVjdGx5IHdpdGhvdXQgbWVtb2l6aW5nIHJlc3VsdHMgYmV0d2VlbiBjYWxscyB0byB5b3VyXHJcbiAgc2VsZWN0b3IsIG90aGVyd2lzZSB0aGUgQ29ubmVjdCBjb21wb25lbnQgd2lsbCByZS1yZW5kZXIgb24gZXZlcnkgc3RhdGUgb3IgcHJvcHMgY2hhbmdlLlxyXG4qL1xuc2VsZWN0b3JGYWN0b3J5LCAvLyBvcHRpb25zIG9iamVjdDpcbl9yZWYpIHtcbiAgaWYgKF9yZWYgPT09IHZvaWQgMCkge1xuICAgIF9yZWYgPSB7fTtcbiAgfVxuXG4gIHZhciBfcmVmMiA9IF9yZWYsXG4gICAgICBfcmVmMiRnZXREaXNwbGF5TmFtZSA9IF9yZWYyLmdldERpc3BsYXlOYW1lLFxuICAgICAgZ2V0RGlzcGxheU5hbWUgPSBfcmVmMiRnZXREaXNwbGF5TmFtZSA9PT0gdm9pZCAwID8gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICByZXR1cm4gIkNvbm5lY3RBZHZhbmNlZCgiICsgbmFtZSArICIpIjtcbiAgfSA6IF9yZWYyJGdldERpc3BsYXlOYW1lLFxuICAgICAgX3JlZjIkbWV0aG9kTmFtZSA9IF9yZWYyLm1ldGhvZE5hbWUsXG4gICAgICBtZXRob2ROYW1lID0gX3JlZjIkbWV0aG9kTmFtZSA9PT0gdm9pZCAwID8gXCdjb25uZWN0QWR2YW5jZWRcJyA6IF9yZWYyJG1ldGhvZE5hbWUsXG4gICAgICBfcmVmMiRyZW5kZXJDb3VudFByb3AgPSBfcmVmMi5yZW5kZXJDb3VudFByb3AsXG4gICAgICByZW5kZXJDb3VudFByb3AgPSBfcmVmMiRyZW5kZXJDb3VudFByb3AgPT09IHZvaWQgMCA/IHVuZGVmaW5lZCA6IF9yZWYyJHJlbmRlckNvdW50UHJvcCxcbiAgICAgIF9yZWYyJHNob3VsZEhhbmRsZVN0YSA9IF9yZWYyLnNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcyxcbiAgICAgIHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcyA9IF9yZWYyJHNob3VsZEhhbmRsZVN0YSA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWYyJHNob3VsZEhhbmRsZVN0YSxcbiAgICAgIF9yZWYyJHN0b3JlS2V5ID0gX3JlZjIuc3RvcmVLZXksXG4gICAgICBzdG9yZUtleSA9IF9yZWYyJHN0b3JlS2V5ID09PSB2b2lkIDAgPyBcJ3N0b3JlXCcgOiBfcmVmMiRzdG9yZUtleSxcbiAgICAgIF9yZWYyJHdpdGhSZWYgPSBfcmVmMi53aXRoUmVmLFxuICAgICAgd2l0aFJlZiA9IF9yZWYyJHdpdGhSZWYgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIkd2l0aFJlZixcbiAgICAgIF9yZWYyJGZvcndhcmRSZWYgPSBfcmVmMi5mb3J3YXJkUmVmLFxuICAgICAgZm9yd2FyZFJlZiA9IF9yZWYyJGZvcndhcmRSZWYgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIkZm9yd2FyZFJlZixcbiAgICAgIF9yZWYyJGNvbnRleHQgPSBfcmVmMi5jb250ZXh0LFxuICAgICAgY29udGV4dCA9IF9yZWYyJGNvbnRleHQgPT09IHZvaWQgMCA/IFJlYWN0UmVkdXhDb250ZXh0IDogX3JlZjIkY29udGV4dCxcbiAgICAgIGNvbm5lY3RPcHRpb25zID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjIsIFsiZ2V0RGlzcGxheU5hbWUiLCAibWV0aG9kTmFtZSIsICJyZW5kZXJDb3VudFByb3AiLCAic2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzIiwgInN0b3JlS2V5IiwgIndpdGhSZWYiLCAiZm9yd2FyZFJlZiIsICJjb250ZXh0Il0pO1xuXG4gIGlmIChmYWxzZSkgeyB2YXIgY3VzdG9tU3RvcmVXYXJuaW5nTWVzc2FnZTsgfVxuXG4gIHZhciBDb250ZXh0ID0gY29udGV4dDtcbiAgcmV0dXJuIGZ1bmN0aW9uIHdyYXBXaXRoQ29ubmVjdChXcmFwcGVkQ29tcG9uZW50KSB7XG4gICAgaWYgKGZhbHNlKSB7fVxuXG4gICAgdmFyIHdyYXBwZWRDb21wb25lbnROYW1lID0gV3JhcHBlZENvbXBvbmVudC5kaXNwbGF5TmFtZSB8fCBXcmFwcGVkQ29tcG9uZW50Lm5hbWUgfHwgXCdDb21wb25lbnRcJztcbiAgICB2YXIgZGlzcGxheU5hbWUgPSBnZXREaXNwbGF5TmFtZSh3cmFwcGVkQ29tcG9uZW50TmFtZSk7XG5cbiAgICB2YXIgc2VsZWN0b3JGYWN0b3J5T3B0aW9ucyA9IF9leHRlbmRzKHt9LCBjb25uZWN0T3B0aW9ucywge1xuICAgICAgZ2V0RGlzcGxheU5hbWU6IGdldERpc3BsYXlOYW1lLFxuICAgICAgbWV0aG9kTmFtZTogbWV0aG9kTmFtZSxcbiAgICAgIHJlbmRlckNvdW50UHJvcDogcmVuZGVyQ291bnRQcm9wLFxuICAgICAgc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzOiBzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMsXG4gICAgICBzdG9yZUtleTogc3RvcmVLZXksXG4gICAgICBkaXNwbGF5TmFtZTogZGlzcGxheU5hbWUsXG4gICAgICB3cmFwcGVkQ29tcG9uZW50TmFtZTogd3JhcHBlZENvbXBvbmVudE5hbWUsXG4gICAgICBXcmFwcGVkQ29tcG9uZW50OiBXcmFwcGVkQ29tcG9uZW50XG4gICAgfSk7XG5cbiAgICB2YXIgcHVyZSA9IGNvbm5lY3RPcHRpb25zLnB1cmU7XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVDaGlsZFNlbGVjdG9yKHN0b3JlKSB7XG4gICAgICByZXR1cm4gc2VsZWN0b3JGYWN0b3J5KHN0b3JlLmRpc3BhdGNoLCBzZWxlY3RvckZhY3RvcnlPcHRpb25zKTtcbiAgICB9IC8vIElmIHdlIGFyZW5cJ3QgcnVubmluZyBpbiAicHVyZSIgbW9kZSwgd2UgZG9uXCd0IHdhbnQgdG8gbWVtb2l6ZSB2YWx1ZXMuXG4gICAgLy8gVG8gYXZvaWQgY29uZGl0aW9uYWxseSBjYWxsaW5nIGhvb2tzLCB3ZSBmYWxsIGJhY2sgdG8gYSB0aW55IHdyYXBwZXJcbiAgICAvLyB0aGF0IGp1c3QgZXhlY3V0ZXMgdGhlIGdpdmVuIGNhbGxiYWNrIGltbWVkaWF0ZWx5LlxuXG5cbiAgICB2YXIgdXNlUHVyZU9ubHlNZW1vID0gcHVyZSA/IHJlYWN0WyJ1c2VNZW1vIl0gOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBDb25uZWN0RnVuY3Rpb24ocHJvcHMpIHtcbiAgICAgIHZhciBfdXNlTWVtbyA9IE9iamVjdChyZWFjdFsidXNlTWVtbyJdKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIERpc3Rpbmd1aXNoIGJldHdlZW4gYWN0dWFsICJkYXRhIiBwcm9wcyB0aGF0IHdlcmUgcGFzc2VkIHRvIHRoZSB3cmFwcGVyIGNvbXBvbmVudCxcbiAgICAgICAgLy8gYW5kIHZhbHVlcyBuZWVkZWQgdG8gY29udHJvbCBiZWhhdmlvciAoZm9yd2FyZGVkIHJlZnMsIGFsdGVybmF0ZSBjb250ZXh0IGluc3RhbmNlcykuXG4gICAgICAgIC8vIFRvIG1haW50YWluIHRoZSB3cmFwcGVyUHJvcHMgb2JqZWN0IHJlZmVyZW5jZSwgbWVtb2l6ZSB0aGlzIGRlc3RydWN0dXJpbmcuXG4gICAgICAgIHZhciByZWFjdFJlZHV4Rm9yd2FyZGVkUmVmID0gcHJvcHMucmVhY3RSZWR1eEZvcndhcmRlZFJlZixcbiAgICAgICAgICAgIHdyYXBwZXJQcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHByb3BzLCBbInJlYWN0UmVkdXhGb3J3YXJkZWRSZWYiXSk7XG5cbiAgICAgICAgcmV0dXJuIFtwcm9wcy5jb250ZXh0LCByZWFjdFJlZHV4Rm9yd2FyZGVkUmVmLCB3cmFwcGVyUHJvcHNdO1xuICAgICAgfSwgW3Byb3BzXSksXG4gICAgICAgICAgcHJvcHNDb250ZXh0ID0gX3VzZU1lbW9bMF0sXG4gICAgICAgICAgcmVhY3RSZWR1eEZvcndhcmRlZFJlZiA9IF91c2VNZW1vWzFdLFxuICAgICAgICAgIHdyYXBwZXJQcm9wcyA9IF91c2VNZW1vWzJdO1xuXG4gICAgICB2YXIgQ29udGV4dFRvVXNlID0gT2JqZWN0KHJlYWN0WyJ1c2VNZW1vIl0pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVXNlcnMgbWF5IG9wdGlvbmFsbHkgcGFzcyBpbiBhIGN1c3RvbSBjb250ZXh0IGluc3RhbmNlIHRvIHVzZSBpbnN0ZWFkIG9mIG91ciBSZWFjdFJlZHV4Q29udGV4dC5cbiAgICAgICAgLy8gTWVtb2l6ZSB0aGUgY2hlY2sgdGhhdCBkZXRlcm1pbmVzIHdoaWNoIGNvbnRleHQgaW5zdGFuY2Ugd2Ugc2hvdWxkIHVzZS5cbiAgICAgICAgcmV0dXJuIHByb3BzQ29udGV4dCAmJiBwcm9wc0NvbnRleHQuQ29uc3VtZXIgJiYgT2JqZWN0KHJlYWN0X2lzWyJpc0NvbnRleHRDb25zdW1lciJdKShyZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChwcm9wc0NvbnRleHQuQ29uc3VtZXIsIG51bGwpKSA/IHByb3BzQ29udGV4dCA6IENvbnRleHQ7XG4gICAgICB9LCBbcHJvcHNDb250ZXh0LCBDb250ZXh0XSk7IC8vIFJldHJpZXZlIHRoZSBzdG9yZSBhbmQgYW5jZXN0b3Igc3Vic2NyaXB0aW9uIHZpYSBjb250ZXh0LCBpZiBhdmFpbGFibGVcblxuICAgICAgdmFyIGNvbnRleHRWYWx1ZSA9IE9iamVjdChyZWFjdFsidXNlQ29udGV4dCJdKShDb250ZXh0VG9Vc2UpOyAvLyBUaGUgc3RvcmUgX211c3RfIGV4aXN0IGFzIGVpdGhlciBhIHByb3Agb3IgaW4gY29udGV4dC5cbiAgICAgIC8vIFdlXCdsbCBjaGVjayB0byBzZWUgaWYgaXQgX2xvb2tzXyBsaWtlIGEgUmVkdXggc3RvcmUgZmlyc3QuXG4gICAgICAvLyBUaGlzIGFsbG93cyB1cyB0byBwYXNzIHRocm91Z2ggYSBgc3RvcmVgIHByb3AgdGhhdCBpcyBqdXN0IGEgcGxhaW4gdmFsdWUuXG5cbiAgICAgIHZhciBkaWRTdG9yZUNvbWVGcm9tUHJvcHMgPSBCb29sZWFuKHByb3BzLnN0b3JlKSAmJiBCb29sZWFuKHByb3BzLnN0b3JlLmdldFN0YXRlKSAmJiBCb29sZWFuKHByb3BzLnN0b3JlLmRpc3BhdGNoKTtcbiAgICAgIHZhciBkaWRTdG9yZUNvbWVGcm9tQ29udGV4dCA9IEJvb2xlYW4oY29udGV4dFZhbHVlKSAmJiBCb29sZWFuKGNvbnRleHRWYWx1ZS5zdG9yZSk7XG5cbiAgICAgIGlmIChmYWxzZSkge30gLy8gQmFzZWQgb24gdGhlIHByZXZpb3VzIGNoZWNrLCBvbmUgb2YgdGhlc2UgbXVzdCBiZSB0cnVlXG5cblxuICAgICAgdmFyIHN0b3JlID0gZGlkU3RvcmVDb21lRnJvbVByb3BzID8gcHJvcHMuc3RvcmUgOiBjb250ZXh0VmFsdWUuc3RvcmU7XG4gICAgICB2YXIgY2hpbGRQcm9wc1NlbGVjdG9yID0gT2JqZWN0KHJlYWN0WyJ1c2VNZW1vIl0pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVGhlIGNoaWxkIHByb3BzIHNlbGVjdG9yIG5lZWRzIHRoZSBzdG9yZSByZWZlcmVuY2UgYXMgYW4gaW5wdXQuXG4gICAgICAgIC8vIFJlLWNyZWF0ZSB0aGlzIHNlbGVjdG9yIHdoZW5ldmVyIHRoZSBzdG9yZSBjaGFuZ2VzLlxuICAgICAgICByZXR1cm4gY3JlYXRlQ2hpbGRTZWxlY3RvcihzdG9yZSk7XG4gICAgICB9LCBbc3RvcmVdKTtcblxuICAgICAgdmFyIF91c2VNZW1vMiA9IE9iamVjdChyZWFjdFsidXNlTWVtbyJdKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzKSByZXR1cm4gTk9fU1VCU0NSSVBUSU9OX0FSUkFZOyAvLyBUaGlzIFN1YnNjcmlwdGlvblwncyBzb3VyY2Ugc2hvdWxkIG1hdGNoIHdoZXJlIHN0b3JlIGNhbWUgZnJvbTogcHJvcHMgdnMuIGNvbnRleHQuIEEgY29tcG9uZW50XG4gICAgICAgIC8vIGNvbm5lY3RlZCB0byB0aGUgc3RvcmUgdmlhIHByb3BzIHNob3VsZG5cJ3QgdXNlIHN1YnNjcmlwdGlvbiBmcm9tIGNvbnRleHQsIG9yIHZpY2UgdmVyc2EuXG5cbiAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oc3RvcmUsIGRpZFN0b3JlQ29tZUZyb21Qcm9wcyA/IG51bGwgOiBjb250ZXh0VmFsdWUuc3Vic2NyaXB0aW9uKTsgLy8gYG5vdGlmeU5lc3RlZFN1YnNgIGlzIGR1cGxpY2F0ZWQgdG8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBjb21wb25lbnQgaXMgdW5tb3VudGVkIGluXG4gICAgICAgIC8vIHRoZSBtaWRkbGUgb2YgdGhlIG5vdGlmaWNhdGlvbiBsb29wLCB3aGVyZSBgc3Vic2NyaXB0aW9uYCB3aWxsIHRoZW4gYmUgbnVsbC4gVGhpcyBjYW5cbiAgICAgICAgLy8gcHJvYmFibHkgYmUgYXZvaWRlZCBpZiBTdWJzY3JpcHRpb25cJ3MgbGlzdGVuZXJzIGxvZ2ljIGlzIGNoYW5nZWQgdG8gbm90IGNhbGwgbGlzdGVuZXJzXG4gICAgICAgIC8vIHRoYXQgaGF2ZSBiZWVuIHVuc3Vic2NyaWJlZCBpbiB0aGUgIG1pZGRsZSBvZiB0aGUgbm90aWZpY2F0aW9uIGxvb3AuXG5cbiAgICAgICAgdmFyIG5vdGlmeU5lc3RlZFN1YnMgPSBzdWJzY3JpcHRpb24ubm90aWZ5TmVzdGVkU3Vicy5iaW5kKHN1YnNjcmlwdGlvbik7XG4gICAgICAgIHJldHVybiBbc3Vic2NyaXB0aW9uLCBub3RpZnlOZXN0ZWRTdWJzXTtcbiAgICAgIH0sIFtzdG9yZSwgZGlkU3RvcmVDb21lRnJvbVByb3BzLCBjb250ZXh0VmFsdWVdKSxcbiAgICAgICAgICBzdWJzY3JpcHRpb24gPSBfdXNlTWVtbzJbMF0sXG4gICAgICAgICAgbm90aWZ5TmVzdGVkU3VicyA9IF91c2VNZW1vMlsxXTsgLy8gRGV0ZXJtaW5lIHdoYXQge3N0b3JlLCBzdWJzY3JpcHRpb259IHZhbHVlIHNob3VsZCBiZSBwdXQgaW50byBuZXN0ZWQgY29udGV4dCwgaWYgbmVjZXNzYXJ5LFxuICAgICAgLy8gYW5kIG1lbW9pemUgdGhhdCB2YWx1ZSB0byBhdm9pZCB1bm5lY2Vzc2FyeSBjb250ZXh0IHVwZGF0ZXMuXG5cblxuICAgICAgdmFyIG92ZXJyaWRkZW5Db250ZXh0VmFsdWUgPSBPYmplY3QocmVhY3RbInVzZU1lbW8iXSkoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZGlkU3RvcmVDb21lRnJvbVByb3BzKSB7XG4gICAgICAgICAgLy8gVGhpcyBjb21wb25lbnQgaXMgZGlyZWN0bHkgc3Vic2NyaWJlZCB0byBhIHN0b3JlIGZyb20gcHJvcHMuXG4gICAgICAgICAgLy8gV2UgZG9uXCd0IHdhbnQgZGVzY2VuZGFudHMgcmVhZGluZyBmcm9tIHRoaXMgc3RvcmUgLSBwYXNzIGRvd24gd2hhdGV2ZXJcbiAgICAgICAgICAvLyB0aGUgZXhpc3RpbmcgY29udGV4dCB2YWx1ZSBpcyBmcm9tIHRoZSBuZWFyZXN0IGNvbm5lY3RlZCBhbmNlc3Rvci5cbiAgICAgICAgICByZXR1cm4gY29udGV4dFZhbHVlO1xuICAgICAgICB9IC8vIE90aGVyd2lzZSwgcHV0IHRoaXMgY29tcG9uZW50XCdzIHN1YnNjcmlwdGlvbiBpbnN0YW5jZSBpbnRvIGNvbnRleHQsIHNvIHRoYXRcbiAgICAgICAgLy8gY29ubmVjdGVkIGRlc2NlbmRhbnRzIHdvblwndCB1cGRhdGUgdW50aWwgYWZ0ZXIgdGhpcyBjb21wb25lbnQgaXMgZG9uZVxuXG5cbiAgICAgICAgcmV0dXJuIF9leHRlbmRzKHt9LCBjb250ZXh0VmFsdWUsIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb246IHN1YnNjcmlwdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0sIFtkaWRTdG9yZUNvbWVGcm9tUHJvcHMsIGNvbnRleHRWYWx1ZSwgc3Vic2NyaXB0aW9uXSk7IC8vIFdlIG5lZWQgdG8gZm9yY2UgdGhpcyB3cmFwcGVyIGNvbXBvbmVudCB0byByZS1yZW5kZXIgd2hlbmV2ZXIgYSBSZWR1eCBzdG9yZSB1cGRhdGVcbiAgICAgIC8vIGNhdXNlcyBhIGNoYW5nZSB0byB0aGUgY2FsY3VsYXRlZCBjaGlsZCBjb21wb25lbnQgcHJvcHMgKG9yIHdlIGNhdWdodCBhbiBlcnJvciBpbiBtYXBTdGF0ZSlcblxuICAgICAgdmFyIF91c2VSZWR1Y2VyID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWR1Y2VyIl0pKHN0b3JlU3RhdGVVcGRhdGVzUmVkdWNlciwgRU1QVFlfQVJSQVksIGluaXRTdGF0ZVVwZGF0ZXMpLFxuICAgICAgICAgIF91c2VSZWR1Y2VyJCA9IF91c2VSZWR1Y2VyWzBdLFxuICAgICAgICAgIHByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQgPSBfdXNlUmVkdWNlciRbMF0sXG4gICAgICAgICAgZm9yY2VDb21wb25lbnRVcGRhdGVEaXNwYXRjaCA9IF91c2VSZWR1Y2VyWzFdOyAvLyBQcm9wYWdhdGUgYW55IG1hcFN0YXRlL21hcERpc3BhdGNoIGVycm9ycyB1cHdhcmRzXG5cblxuICAgICAgaWYgKHByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQgJiYgcHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdC5lcnJvcikge1xuICAgICAgICB0aHJvdyBwcmV2aW91c1N0YXRlVXBkYXRlUmVzdWx0LmVycm9yO1xuICAgICAgfSAvLyBTZXQgdXAgcmVmcyB0byBjb29yZGluYXRlIHZhbHVlcyBiZXR3ZWVuIHRoZSBzdWJzY3JpcHRpb24gZWZmZWN0IGFuZCB0aGUgcmVuZGVyIGxvZ2ljXG5cblxuICAgICAgdmFyIGxhc3RDaGlsZFByb3BzID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkoKTtcbiAgICAgIHZhciBsYXN0V3JhcHBlclByb3BzID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkod3JhcHBlclByb3BzKTtcbiAgICAgIHZhciBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkoKTtcbiAgICAgIHZhciByZW5kZXJJc1NjaGVkdWxlZCA9IE9iamVjdChyZWFjdFsidXNlUmVmIl0pKGZhbHNlKTtcbiAgICAgIHZhciBhY3R1YWxDaGlsZFByb3BzID0gdXNlUHVyZU9ubHlNZW1vKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVHJpY2t5IGxvZ2ljIGhlcmU6XG4gICAgICAgIC8vIC0gVGhpcyByZW5kZXIgbWF5IGhhdmUgYmVlbiB0cmlnZ2VyZWQgYnkgYSBSZWR1eCBzdG9yZSB1cGRhdGUgdGhhdCBwcm9kdWNlZCBuZXcgY2hpbGQgcHJvcHNcbiAgICAgICAgLy8gLSBIb3dldmVyLCB3ZSBtYXkgaGF2ZSBnb3R0ZW4gbmV3IHdyYXBwZXIgcHJvcHMgYWZ0ZXIgdGhhdFxuICAgICAgICAvLyBJZiB3ZSBoYXZlIG5ldyBjaGlsZCBwcm9wcywgYW5kIHRoZSBzYW1lIHdyYXBwZXIgcHJvcHMsIHdlIGtub3cgd2Ugc2hvdWxkIHVzZSB0aGUgbmV3IGNoaWxkIHByb3BzIGFzLWlzLlxuICAgICAgICAvLyBCdXQsIGlmIHdlIGhhdmUgbmV3IHdyYXBwZXIgcHJvcHMsIHRob3NlIG1pZ2h0IGNoYW5nZSB0aGUgY2hpbGQgcHJvcHMsIHNvIHdlIGhhdmUgdG8gcmVjYWxjdWxhdGUgdGhpbmdzLlxuICAgICAgICAvLyBTbywgd2VcJ2xsIHVzZSB0aGUgY2hpbGQgcHJvcHMgZnJvbSBzdG9yZSB1cGRhdGUgb25seSBpZiB0aGUgd3JhcHBlciBwcm9wcyBhcmUgdGhlIHNhbWUgYXMgbGFzdCB0aW1lLlxuICAgICAgICBpZiAoY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZS5jdXJyZW50ICYmIHdyYXBwZXJQcm9wcyA9PT0gbGFzdFdyYXBwZXJQcm9wcy5jdXJyZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudDtcbiAgICAgICAgfSAvLyBUT0RPIFdlXCdyZSByZWFkaW5nIHRoZSBzdG9yZSBkaXJlY3RseSBpbiByZW5kZXIoKSBoZXJlLiBCYWQgaWRlYT9cbiAgICAgICAgLy8gVGhpcyB3aWxsIGxpa2VseSBjYXVzZSBCYWQgVGhpbmdzIChUTSkgdG8gaGFwcGVuIGluIENvbmN1cnJlbnQgTW9kZS5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGRvIHRoaXMgYmVjYXVzZSBvbiByZW5kZXJzIF9ub3RfIGNhdXNlZCBieSBzdG9yZSB1cGRhdGVzLCB3ZSBuZWVkIHRoZSBsYXRlc3Qgc3RvcmUgc3RhdGVcbiAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHdoYXQgdGhlIGNoaWxkIHByb3BzIHNob3VsZCBiZS5cblxuXG4gICAgICAgIHJldHVybiBjaGlsZFByb3BzU2VsZWN0b3Ioc3RvcmUuZ2V0U3RhdGUoKSwgd3JhcHBlclByb3BzKTtcbiAgICAgIH0sIFtzdG9yZSwgcHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdCwgd3JhcHBlclByb3BzXSk7IC8vIFdlIG5lZWQgdGhpcyB0byBleGVjdXRlIHN5bmNocm9ub3VzbHkgZXZlcnkgdGltZSB3ZSByZS1yZW5kZXIuIEhvd2V2ZXIsIFJlYWN0IHdhcm5zXG4gICAgICAvLyBhYm91dCB1c2VMYXlvdXRFZmZlY3QgaW4gU1NSLCBzbyB3ZSB0cnkgdG8gZGV0ZWN0IGVudmlyb25tZW50IGFuZCBmYWxsIGJhY2sgdG9cbiAgICAgIC8vIGp1c3QgdXNlRWZmZWN0IGluc3RlYWQgdG8gYXZvaWQgdGhlIHdhcm5pbmcsIHNpbmNlIG5laXRoZXIgd2lsbCBydW4gYW55d2F5LlxuXG4gICAgICB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0V2l0aEFyZ3MoY2FwdHVyZVdyYXBwZXJQcm9wcywgW2xhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgd3JhcHBlclByb3BzLCBhY3R1YWxDaGlsZFByb3BzLCBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLCBub3RpZnlOZXN0ZWRTdWJzXSk7IC8vIE91ciByZS1zdWJzY3JpYmUgbG9naWMgb25seSBydW5zIHdoZW4gdGhlIHN0b3JlL3N1YnNjcmlwdGlvbiBzZXR1cCBjaGFuZ2VzXG5cbiAgICAgIHVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3RXaXRoQXJncyhzdWJzY3JpYmVVcGRhdGVzLCBbc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzLCBzdG9yZSwgc3Vic2NyaXB0aW9uLCBjaGlsZFByb3BzU2VsZWN0b3IsIGxhc3RXcmFwcGVyUHJvcHMsIGxhc3RDaGlsZFByb3BzLCByZW5kZXJJc1NjaGVkdWxlZCwgY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZSwgbm90aWZ5TmVzdGVkU3VicywgZm9yY2VDb21wb25lbnRVcGRhdGVEaXNwYXRjaF0sIFtzdG9yZSwgc3Vic2NyaXB0aW9uLCBjaGlsZFByb3BzU2VsZWN0b3JdKTsgLy8gTm93IHRoYXQgYWxsIHRoYXRcJ3MgZG9uZSwgd2UgY2FuIGZpbmFsbHkgdHJ5IHRvIGFjdHVhbGx5IHJlbmRlciB0aGUgY2hpbGQgY29tcG9uZW50LlxuICAgICAgLy8gV2UgbWVtb2l6ZSB0aGUgZWxlbWVudHMgZm9yIHRoZSByZW5kZXJlZCBjaGlsZCBjb21wb25lbnQgYXMgYW4gb3B0aW1pemF0aW9uLlxuXG4gICAgICB2YXIgcmVuZGVyZWRXcmFwcGVkQ29tcG9uZW50ID0gT2JqZWN0KHJlYWN0WyJ1c2VNZW1vIl0pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFdyYXBwZWRDb21wb25lbnQsIF9leHRlbmRzKHt9LCBhY3R1YWxDaGlsZFByb3BzLCB7XG4gICAgICAgICAgcmVmOiByZWFjdFJlZHV4Rm9yd2FyZGVkUmVmXG4gICAgICAgIH0pKTtcbiAgICAgIH0sIFtyZWFjdFJlZHV4Rm9yd2FyZGVkUmVmLCBXcmFwcGVkQ29tcG9uZW50LCBhY3R1YWxDaGlsZFByb3BzXSk7IC8vIElmIFJlYWN0IHNlZXMgdGhlIGV4YWN0IHNhbWUgZWxlbWVudCByZWZlcmVuY2UgYXMgbGFzdCB0aW1lLCBpdCBiYWlscyBvdXQgb2YgcmUtcmVuZGVyaW5nXG4gICAgICAvLyB0aGF0IGNoaWxkLCBzYW1lIGFzIGlmIGl0IHdhcyB3cmFwcGVkIGluIFJlYWN0Lm1lbW8oKSBvciByZXR1cm5lZCBmYWxzZSBmcm9tIHNob3VsZENvbXBvbmVudFVwZGF0ZS5cblxuICAgICAgdmFyIHJlbmRlcmVkQ2hpbGQgPSBPYmplY3QocmVhY3RbInVzZU1lbW8iXSkoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzKSB7XG4gICAgICAgICAgLy8gSWYgdGhpcyBjb21wb25lbnQgaXMgc3Vic2NyaWJlZCB0byBzdG9yZSB1cGRhdGVzLCB3ZSBuZWVkIHRvIHBhc3MgaXRzIG93blxuICAgICAgICAgIC8vIHN1YnNjcmlwdGlvbiBpbnN0YW5jZSBkb3duIHRvIG91ciBkZXNjZW5kYW50cy4gVGhhdCBtZWFucyByZW5kZXJpbmcgdGhlIHNhbWVcbiAgICAgICAgICAvLyBDb250ZXh0IGluc3RhbmNlLCBhbmQgcHV0dGluZyBhIGRpZmZlcmVudCB2YWx1ZSBpbnRvIHRoZSBjb250ZXh0LlxuICAgICAgICAgIHJldHVybiByZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChDb250ZXh0VG9Vc2UuUHJvdmlkZXIsIHtcbiAgICAgICAgICAgIHZhbHVlOiBvdmVycmlkZGVuQ29udGV4dFZhbHVlXG4gICAgICAgICAgfSwgcmVuZGVyZWRXcmFwcGVkQ29tcG9uZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQ7XG4gICAgICB9LCBbQ29udGV4dFRvVXNlLCByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQsIG92ZXJyaWRkZW5Db250ZXh0VmFsdWVdKTtcbiAgICAgIHJldHVybiByZW5kZXJlZENoaWxkO1xuICAgIH0gLy8gSWYgd2VcJ3JlIGluICJwdXJlIiBtb2RlLCBlbnN1cmUgb3VyIHdyYXBwZXIgY29tcG9uZW50IG9ubHkgcmUtcmVuZGVycyB3aGVuIGluY29taW5nIHByb3BzIGhhdmUgY2hhbmdlZC5cblxuXG4gICAgdmFyIENvbm5lY3QgPSBwdXJlID8gcmVhY3RfZGVmYXVsdC5hLm1lbW8oQ29ubmVjdEZ1bmN0aW9uKSA6IENvbm5lY3RGdW5jdGlvbjtcbiAgICBDb25uZWN0LldyYXBwZWRDb21wb25lbnQgPSBXcmFwcGVkQ29tcG9uZW50O1xuICAgIENvbm5lY3QuZGlzcGxheU5hbWUgPSBkaXNwbGF5TmFtZTtcblxuICAgIGlmIChmb3J3YXJkUmVmKSB7XG4gICAgICB2YXIgZm9yd2FyZGVkID0gcmVhY3RfZGVmYXVsdC5hLmZvcndhcmRSZWYoZnVuY3Rpb24gZm9yd2FyZENvbm5lY3RSZWYocHJvcHMsIHJlZikge1xuICAgICAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQ29ubmVjdCwgX2V4dGVuZHMoe30sIHByb3BzLCB7XG4gICAgICAgICAgcmVhY3RSZWR1eEZvcndhcmRlZFJlZjogcmVmXG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuICAgICAgZm9yd2FyZGVkLmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWU7XG4gICAgICBmb3J3YXJkZWQuV3JhcHBlZENvbXBvbmVudCA9IFdyYXBwZWRDb21wb25lbnQ7XG4gICAgICByZXR1cm4gaG9pc3Rfbm9uX3JlYWN0X3N0YXRpY3NfY2pzX2RlZmF1bHQoKShmb3J3YXJkZWQsIFdyYXBwZWRDb21wb25lbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBob2lzdF9ub25fcmVhY3Rfc3RhdGljc19janNfZGVmYXVsdCgpKENvbm5lY3QsIFdyYXBwZWRDb21wb25lbnQpO1xuICB9O1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvdXRpbHMvc2hhbGxvd0VxdWFsLmpzXG5mdW5jdGlvbiBpcyh4LCB5KSB7XG4gIGlmICh4ID09PSB5KSB7XG4gICAgcmV0dXJuIHggIT09IDAgfHwgeSAhPT0gMCB8fCAxIC8geCA9PT0gMSAvIHk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHggIT09IHggJiYgeSAhPT0geTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzaGFsbG93RXF1YWwob2JqQSwgb2JqQikge1xuICBpZiAoaXMob2JqQSwgb2JqQikpIHJldHVybiB0cnVlO1xuXG4gIGlmICh0eXBlb2Ygb2JqQSAhPT0gXCdvYmplY3RcJyB8fCBvYmpBID09PSBudWxsIHx8IHR5cGVvZiBvYmpCICE9PSBcJ29iamVjdFwnIHx8IG9iakIgPT09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIga2V5c0EgPSBPYmplY3Qua2V5cyhvYmpBKTtcbiAgdmFyIGtleXNCID0gT2JqZWN0LmtleXMob2JqQik7XG4gIGlmIChrZXlzQS5sZW5ndGggIT09IGtleXNCLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwga2V5c0EubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmpCLCBrZXlzQVtpXSkgfHwgIWlzKG9iakFba2V5c0FbaV1dLCBvYmpCW2tleXNBW2ldXSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL3V0aWxzL2lzUGxhaW5PYmplY3QuanNcbi8qKlxyXG4gKiBAcGFyYW0ge2FueX0gb2JqIFRoZSBvYmplY3QgdG8gaW5zcGVjdC5cclxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGFyZ3VtZW50IGFwcGVhcnMgdG8gYmUgYSBwbGFpbiBvYmplY3QuXHJcbiAqL1xuZnVuY3Rpb24gaXNQbGFpbk9iamVjdF9pc1BsYWluT2JqZWN0KG9iaikge1xuICBpZiAodHlwZW9mIG9iaiAhPT0gXCdvYmplY3RcJyB8fCBvYmogPT09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgdmFyIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaik7XG4gIGlmIChwcm90byA9PT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gIHZhciBiYXNlUHJvdG8gPSBwcm90bztcblxuICB3aGlsZSAoT2JqZWN0LmdldFByb3RvdHlwZU9mKGJhc2VQcm90bykgIT09IG51bGwpIHtcbiAgICBiYXNlUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYmFzZVByb3RvKTtcbiAgfVxuXG4gIHJldHVybiBwcm90byA9PT0gYmFzZVByb3RvO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvdXRpbHMvd2FybmluZy5qc1xuLyoqXHJcbiAqIFByaW50cyBhIHdhcm5pbmcgaW4gdGhlIGNvbnNvbGUgaWYgaXQgZXhpc3RzLlxyXG4gKlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgd2FybmluZyBtZXNzYWdlLlxyXG4gKiBAcmV0dXJucyB7dm9pZH1cclxuICovXG5mdW5jdGlvbiB3YXJuaW5nX3dhcm5pbmcobWVzc2FnZSkge1xuICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gIGlmICh0eXBlb2YgY29uc29sZSAhPT0gXCd1bmRlZmluZWRcJyAmJiB0eXBlb2YgY29uc29sZS5lcnJvciA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTtcbiAgfVxuICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbnNvbGUgKi9cblxuXG4gIHRyeSB7XG4gICAgLy8gVGhpcyBlcnJvciB3YXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28gdGhhdCBpZiB5b3UgZW5hYmxlXG4gICAgLy8gImJyZWFrIG9uIGFsbCBleGNlcHRpb25zIiBpbiB5b3VyIGNvbnNvbGUsXG4gICAgLy8gaXQgd291bGQgcGF1c2UgdGhlIGV4ZWN1dGlvbiBhdCB0aGlzIGxpbmUuXG4gICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWVtcHR5ICovXG4gIH0gY2F0Y2ggKGUpIHt9XG4gIC8qIGVzbGludC1lbmFibGUgbm8tZW1wdHkgKi9cblxufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvdXRpbHMvdmVyaWZ5UGxhaW5PYmplY3QuanNcblxuXG5mdW5jdGlvbiB2ZXJpZnlQbGFpbk9iamVjdCh2YWx1ZSwgZGlzcGxheU5hbWUsIG1ldGhvZE5hbWUpIHtcbiAgaWYgKCFpc1BsYWluT2JqZWN0X2lzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgd2FybmluZ193YXJuaW5nKG1ldGhvZE5hbWUgKyAiKCkgaW4gIiArIGRpc3BsYXlOYW1lICsgIiBtdXN0IHJldHVybiBhIHBsYWluIG9iamVjdC4gSW5zdGVhZCByZWNlaXZlZCAiICsgdmFsdWUgKyAiLiIpO1xuICB9XG59XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9jb25uZWN0L3dyYXBNYXBUb1Byb3BzLmpzXG5cbmZ1bmN0aW9uIHdyYXBNYXBUb1Byb3BzQ29uc3RhbnQoZ2V0Q29uc3RhbnQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGluaXRDb25zdGFudFNlbGVjdG9yKGRpc3BhdGNoLCBvcHRpb25zKSB7XG4gICAgdmFyIGNvbnN0YW50ID0gZ2V0Q29uc3RhbnQoZGlzcGF0Y2gsIG9wdGlvbnMpO1xuXG4gICAgZnVuY3Rpb24gY29uc3RhbnRTZWxlY3RvcigpIHtcbiAgICAgIHJldHVybiBjb25zdGFudDtcbiAgICB9XG5cbiAgICBjb25zdGFudFNlbGVjdG9yLmRlcGVuZHNPbk93blByb3BzID0gZmFsc2U7XG4gICAgcmV0dXJuIGNvbnN0YW50U2VsZWN0b3I7XG4gIH07XG59IC8vIGRlcGVuZHNPbk93blByb3BzIGlzIHVzZWQgYnkgY3JlYXRlTWFwVG9Qcm9wc1Byb3h5IHRvIGRldGVybWluZSB3aGV0aGVyIHRvIHBhc3MgcHJvcHMgYXMgYXJnc1xuLy8gdG8gdGhlIG1hcFRvUHJvcHMgZnVuY3Rpb24gYmVpbmcgd3JhcHBlZC4gSXQgaXMgYWxzbyB1c2VkIGJ5IG1ha2VQdXJlUHJvcHNTZWxlY3RvciB0byBkZXRlcm1pbmVcbi8vIHdoZXRoZXIgbWFwVG9Qcm9wcyBuZWVkcyB0byBiZSBpbnZva2VkIHdoZW4gcHJvcHMgaGF2ZSBjaGFuZ2VkLlxuLy9cbi8vIEEgbGVuZ3RoIG9mIG9uZSBzaWduYWxzIHRoYXQgbWFwVG9Qcm9wcyBkb2VzIG5vdCBkZXBlbmQgb24gcHJvcHMgZnJvbSB0aGUgcGFyZW50IGNvbXBvbmVudC5cbi8vIEEgbGVuZ3RoIG9mIHplcm8gaXMgYXNzdW1lZCB0byBtZWFuIG1hcFRvUHJvcHMgaXMgZ2V0dGluZyBhcmdzIHZpYSBhcmd1bWVudHMgb3IgLi4uYXJncyBhbmRcbi8vIHRoZXJlZm9yZSBub3QgcmVwb3J0aW5nIGl0cyBsZW5ndGggYWNjdXJhdGVseS4uXG5cbmZ1bmN0aW9uIGdldERlcGVuZHNPbk93blByb3BzKG1hcFRvUHJvcHMpIHtcbiAgcmV0dXJuIG1hcFRvUHJvcHMuZGVwZW5kc09uT3duUHJvcHMgIT09IG51bGwgJiYgbWFwVG9Qcm9wcy5kZXBlbmRzT25Pd25Qcm9wcyAhPT0gdW5kZWZpbmVkID8gQm9vbGVhbihtYXBUb1Byb3BzLmRlcGVuZHNPbk93blByb3BzKSA6IG1hcFRvUHJvcHMubGVuZ3RoICE9PSAxO1xufSAvLyBVc2VkIGJ5IHdoZW5NYXBTdGF0ZVRvUHJvcHNJc0Z1bmN0aW9uIGFuZCB3aGVuTWFwRGlzcGF0Y2hUb1Byb3BzSXNGdW5jdGlvbixcbi8vIHRoaXMgZnVuY3Rpb24gd3JhcHMgbWFwVG9Qcm9wcyBpbiBhIHByb3h5IGZ1bmN0aW9uIHdoaWNoIGRvZXMgc2V2ZXJhbCB0aGluZ3M6XG4vL1xuLy8gICogRGV0ZWN0cyB3aGV0aGVyIHRoZSBtYXBUb1Byb3BzIGZ1bmN0aW9uIGJlaW5nIGNhbGxlZCBkZXBlbmRzIG9uIHByb3BzLCB3aGljaFxuLy8gICAgaXMgdXNlZCBieSBzZWxlY3RvckZhY3RvcnkgdG8gZGVjaWRlIGlmIGl0IHNob3VsZCByZWludm9rZSBvbiBwcm9wcyBjaGFuZ2VzLlxuLy9cbi8vICAqIE9uIGZpcnN0IGNhbGwsIGhhbmRsZXMgbWFwVG9Qcm9wcyBpZiByZXR1cm5zIGFub3RoZXIgZnVuY3Rpb24sIGFuZCB0cmVhdHMgdGhhdFxuLy8gICAgbmV3IGZ1bmN0aW9uIGFzIHRoZSB0cnVlIG1hcFRvUHJvcHMgZm9yIHN1YnNlcXVlbnQgY2FsbHMuXG4vL1xuLy8gICogT24gZmlyc3QgY2FsbCwgdmVyaWZpZXMgdGhlIGZpcnN0IHJlc3VsdCBpcyBhIHBsYWluIG9iamVjdCwgaW4gb3JkZXIgdG8gd2FyblxuLy8gICAgdGhlIGRldmVsb3BlciB0aGF0IHRoZWlyIG1hcFRvUHJvcHMgZnVuY3Rpb24gaXMgbm90IHJldHVybmluZyBhIHZhbGlkIHJlc3VsdC5cbi8vXG5cbmZ1bmN0aW9uIHdyYXBNYXBUb1Byb3BzRnVuYyhtYXBUb1Byb3BzLCBtZXRob2ROYW1lKSB7XG4gIHJldHVybiBmdW5jdGlvbiBpbml0UHJveHlTZWxlY3RvcihkaXNwYXRjaCwgX3JlZikge1xuICAgIHZhciBkaXNwbGF5TmFtZSA9IF9yZWYuZGlzcGxheU5hbWU7XG5cbiAgICB2YXIgcHJveHkgPSBmdW5jdGlvbiBtYXBUb1Byb3BzUHJveHkoc3RhdGVPckRpc3BhdGNoLCBvd25Qcm9wcykge1xuICAgICAgcmV0dXJuIHByb3h5LmRlcGVuZHNPbk93blByb3BzID8gcHJveHkubWFwVG9Qcm9wcyhzdGF0ZU9yRGlzcGF0Y2gsIG93blByb3BzKSA6IHByb3h5Lm1hcFRvUHJvcHMoc3RhdGVPckRpc3BhdGNoKTtcbiAgICB9OyAvLyBhbGxvdyBkZXRlY3RGYWN0b3J5QW5kVmVyaWZ5IHRvIGdldCBvd25Qcm9wc1xuXG5cbiAgICBwcm94eS5kZXBlbmRzT25Pd25Qcm9wcyA9IHRydWU7XG5cbiAgICBwcm94eS5tYXBUb1Byb3BzID0gZnVuY3Rpb24gZGV0ZWN0RmFjdG9yeUFuZFZlcmlmeShzdGF0ZU9yRGlzcGF0Y2gsIG93blByb3BzKSB7XG4gICAgICBwcm94eS5tYXBUb1Byb3BzID0gbWFwVG9Qcm9wcztcbiAgICAgIHByb3h5LmRlcGVuZHNPbk93blByb3BzID0gZ2V0RGVwZW5kc09uT3duUHJvcHMobWFwVG9Qcm9wcyk7XG4gICAgICB2YXIgcHJvcHMgPSBwcm94eShzdGF0ZU9yRGlzcGF0Y2gsIG93blByb3BzKTtcblxuICAgICAgaWYgKHR5cGVvZiBwcm9wcyA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICAgIHByb3h5Lm1hcFRvUHJvcHMgPSBwcm9wcztcbiAgICAgICAgcHJveHkuZGVwZW5kc09uT3duUHJvcHMgPSBnZXREZXBlbmRzT25Pd25Qcm9wcyhwcm9wcyk7XG4gICAgICAgIHByb3BzID0gcHJveHkoc3RhdGVPckRpc3BhdGNoLCBvd25Qcm9wcyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChmYWxzZSkge31cbiAgICAgIHJldHVybiBwcm9wcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIHByb3h5O1xuICB9O1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvY29ubmVjdC9tYXBEaXNwYXRjaFRvUHJvcHMuanNcblxuXG5mdW5jdGlvbiB3aGVuTWFwRGlzcGF0Y2hUb1Byb3BzSXNGdW5jdGlvbihtYXBEaXNwYXRjaFRvUHJvcHMpIHtcbiAgcmV0dXJuIHR5cGVvZiBtYXBEaXNwYXRjaFRvUHJvcHMgPT09IFwnZnVuY3Rpb25cJyA/IHdyYXBNYXBUb1Byb3BzRnVuYyhtYXBEaXNwYXRjaFRvUHJvcHMsIFwnbWFwRGlzcGF0Y2hUb1Byb3BzXCcpIDogdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gd2hlbk1hcERpc3BhdGNoVG9Qcm9wc0lzTWlzc2luZyhtYXBEaXNwYXRjaFRvUHJvcHMpIHtcbiAgcmV0dXJuICFtYXBEaXNwYXRjaFRvUHJvcHMgPyB3cmFwTWFwVG9Qcm9wc0NvbnN0YW50KGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgIHJldHVybiB7XG4gICAgICBkaXNwYXRjaDogZGlzcGF0Y2hcbiAgICB9O1xuICB9KSA6IHVuZGVmaW5lZDtcbn1cbmZ1bmN0aW9uIHdoZW5NYXBEaXNwYXRjaFRvUHJvcHNJc09iamVjdChtYXBEaXNwYXRjaFRvUHJvcHMpIHtcbiAgcmV0dXJuIG1hcERpc3BhdGNoVG9Qcm9wcyAmJiB0eXBlb2YgbWFwRGlzcGF0Y2hUb1Byb3BzID09PSBcJ29iamVjdFwnID8gd3JhcE1hcFRvUHJvcHNDb25zdGFudChmdW5jdGlvbiAoZGlzcGF0Y2gpIHtcbiAgICByZXR1cm4gYmluZEFjdGlvbkNyZWF0b3JzKG1hcERpc3BhdGNoVG9Qcm9wcywgZGlzcGF0Y2gpO1xuICB9KSA6IHVuZGVmaW5lZDtcbn1cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGNvbm5lY3RfbWFwRGlzcGF0Y2hUb1Byb3BzID0gKFt3aGVuTWFwRGlzcGF0Y2hUb1Byb3BzSXNGdW5jdGlvbiwgd2hlbk1hcERpc3BhdGNoVG9Qcm9wc0lzTWlzc2luZywgd2hlbk1hcERpc3BhdGNoVG9Qcm9wc0lzT2JqZWN0XSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9jb25uZWN0L21hcFN0YXRlVG9Qcm9wcy5qc1xuXG5mdW5jdGlvbiB3aGVuTWFwU3RhdGVUb1Byb3BzSXNGdW5jdGlvbihtYXBTdGF0ZVRvUHJvcHMpIHtcbiAgcmV0dXJuIHR5cGVvZiBtYXBTdGF0ZVRvUHJvcHMgPT09IFwnZnVuY3Rpb25cJyA/IHdyYXBNYXBUb1Byb3BzRnVuYyhtYXBTdGF0ZVRvUHJvcHMsIFwnbWFwU3RhdGVUb1Byb3BzXCcpIDogdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gd2hlbk1hcFN0YXRlVG9Qcm9wc0lzTWlzc2luZyhtYXBTdGF0ZVRvUHJvcHMpIHtcbiAgcmV0dXJuICFtYXBTdGF0ZVRvUHJvcHMgPyB3cmFwTWFwVG9Qcm9wc0NvbnN0YW50KGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge307XG4gIH0pIDogdW5kZWZpbmVkO1xufVxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgY29ubmVjdF9tYXBTdGF0ZVRvUHJvcHMgPSAoW3doZW5NYXBTdGF0ZVRvUHJvcHNJc0Z1bmN0aW9uLCB3aGVuTWFwU3RhdGVUb1Byb3BzSXNNaXNzaW5nXSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9jb25uZWN0L21lcmdlUHJvcHMuanNcblxuXG5mdW5jdGlvbiBkZWZhdWx0TWVyZ2VQcm9wcyhzdGF0ZVByb3BzLCBkaXNwYXRjaFByb3BzLCBvd25Qcm9wcykge1xuICByZXR1cm4gX2V4dGVuZHMoe30sIG93blByb3BzLCB7fSwgc3RhdGVQcm9wcywge30sIGRpc3BhdGNoUHJvcHMpO1xufVxuZnVuY3Rpb24gd3JhcE1lcmdlUHJvcHNGdW5jKG1lcmdlUHJvcHMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGluaXRNZXJnZVByb3BzUHJveHkoZGlzcGF0Y2gsIF9yZWYpIHtcbiAgICB2YXIgZGlzcGxheU5hbWUgPSBfcmVmLmRpc3BsYXlOYW1lLFxuICAgICAgICBwdXJlID0gX3JlZi5wdXJlLFxuICAgICAgICBhcmVNZXJnZWRQcm9wc0VxdWFsID0gX3JlZi5hcmVNZXJnZWRQcm9wc0VxdWFsO1xuICAgIHZhciBoYXNSdW5PbmNlID0gZmFsc2U7XG4gICAgdmFyIG1lcmdlZFByb3BzO1xuICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZVByb3BzUHJveHkoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgb3duUHJvcHMpIHtcbiAgICAgIHZhciBuZXh0TWVyZ2VkUHJvcHMgPSBtZXJnZVByb3BzKHN0YXRlUHJvcHMsIGRpc3BhdGNoUHJvcHMsIG93blByb3BzKTtcblxuICAgICAgaWYgKGhhc1J1bk9uY2UpIHtcbiAgICAgICAgaWYgKCFwdXJlIHx8ICFhcmVNZXJnZWRQcm9wc0VxdWFsKG5leHRNZXJnZWRQcm9wcywgbWVyZ2VkUHJvcHMpKSBtZXJnZWRQcm9wcyA9IG5leHRNZXJnZWRQcm9wcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhhc1J1bk9uY2UgPSB0cnVlO1xuICAgICAgICBtZXJnZWRQcm9wcyA9IG5leHRNZXJnZWRQcm9wcztcbiAgICAgICAgaWYgKGZhbHNlKSB7fVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWVyZ2VkUHJvcHM7XG4gICAgfTtcbiAgfTtcbn1cbmZ1bmN0aW9uIHdoZW5NZXJnZVByb3BzSXNGdW5jdGlvbihtZXJnZVByb3BzKSB7XG4gIHJldHVybiB0eXBlb2YgbWVyZ2VQcm9wcyA9PT0gXCdmdW5jdGlvblwnID8gd3JhcE1lcmdlUHJvcHNGdW5jKG1lcmdlUHJvcHMpIDogdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gd2hlbk1lcmdlUHJvcHNJc09taXR0ZWQobWVyZ2VQcm9wcykge1xuICByZXR1cm4gIW1lcmdlUHJvcHMgPyBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRNZXJnZVByb3BzO1xuICB9IDogdW5kZWZpbmVkO1xufVxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgY29ubmVjdF9tZXJnZVByb3BzID0gKFt3aGVuTWVyZ2VQcm9wc0lzRnVuY3Rpb24sIHdoZW5NZXJnZVByb3BzSXNPbWl0dGVkXSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9jb25uZWN0L3ZlcmlmeVN1YnNlbGVjdG9ycy5qc1xuXG5cbmZ1bmN0aW9uIHZlcmlmeShzZWxlY3RvciwgbWV0aG9kTmFtZSwgZGlzcGxheU5hbWUpIHtcbiAgaWYgKCFzZWxlY3Rvcikge1xuICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCB2YWx1ZSBmb3IgIiArIG1ldGhvZE5hbWUgKyAiIGluICIgKyBkaXNwbGF5TmFtZSArICIuIik7XG4gIH0gZWxzZSBpZiAobWV0aG9kTmFtZSA9PT0gXCdtYXBTdGF0ZVRvUHJvcHNcJyB8fCBtZXRob2ROYW1lID09PSBcJ21hcERpc3BhdGNoVG9Qcm9wc1wnKSB7XG4gICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc2VsZWN0b3IsIFwnZGVwZW5kc09uT3duUHJvcHNcJykpIHtcbiAgICAgIHdhcm5pbmdfd2FybmluZygiVGhlIHNlbGVjdG9yIGZvciAiICsgbWV0aG9kTmFtZSArICIgb2YgIiArIGRpc3BsYXlOYW1lICsgIiBkaWQgbm90IHNwZWNpZnkgYSB2YWx1ZSBmb3IgZGVwZW5kc09uT3duUHJvcHMuIik7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHZlcmlmeVN1YnNlbGVjdG9ycyhtYXBTdGF0ZVRvUHJvcHMsIG1hcERpc3BhdGNoVG9Qcm9wcywgbWVyZ2VQcm9wcywgZGlzcGxheU5hbWUpIHtcbiAgdmVyaWZ5KG1hcFN0YXRlVG9Qcm9wcywgXCdtYXBTdGF0ZVRvUHJvcHNcJywgZGlzcGxheU5hbWUpO1xuICB2ZXJpZnkobWFwRGlzcGF0Y2hUb1Byb3BzLCBcJ21hcERpc3BhdGNoVG9Qcm9wc1wnLCBkaXNwbGF5TmFtZSk7XG4gIHZlcmlmeShtZXJnZVByb3BzLCBcJ21lcmdlUHJvcHNcJywgZGlzcGxheU5hbWUpO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvY29ubmVjdC9zZWxlY3RvckZhY3RvcnkuanNcblxuXG5mdW5jdGlvbiBpbXB1cmVGaW5hbFByb3BzU2VsZWN0b3JGYWN0b3J5KG1hcFN0YXRlVG9Qcm9wcywgbWFwRGlzcGF0Y2hUb1Byb3BzLCBtZXJnZVByb3BzLCBkaXNwYXRjaCkge1xuICByZXR1cm4gZnVuY3Rpb24gaW1wdXJlRmluYWxQcm9wc1NlbGVjdG9yKHN0YXRlLCBvd25Qcm9wcykge1xuICAgIHJldHVybiBtZXJnZVByb3BzKG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSwgb3duUHJvcHMpLCBtYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gsIG93blByb3BzKSwgb3duUHJvcHMpO1xuICB9O1xufVxuZnVuY3Rpb24gcHVyZUZpbmFsUHJvcHNTZWxlY3RvckZhY3RvcnkobWFwU3RhdGVUb1Byb3BzLCBtYXBEaXNwYXRjaFRvUHJvcHMsIG1lcmdlUHJvcHMsIGRpc3BhdGNoLCBfcmVmKSB7XG4gIHZhciBhcmVTdGF0ZXNFcXVhbCA9IF9yZWYuYXJlU3RhdGVzRXF1YWwsXG4gICAgICBhcmVPd25Qcm9wc0VxdWFsID0gX3JlZi5hcmVPd25Qcm9wc0VxdWFsLFxuICAgICAgYXJlU3RhdGVQcm9wc0VxdWFsID0gX3JlZi5hcmVTdGF0ZVByb3BzRXF1YWw7XG4gIHZhciBoYXNSdW5BdExlYXN0T25jZSA9IGZhbHNlO1xuICB2YXIgc3RhdGU7XG4gIHZhciBvd25Qcm9wcztcbiAgdmFyIHN0YXRlUHJvcHM7XG4gIHZhciBkaXNwYXRjaFByb3BzO1xuICB2YXIgbWVyZ2VkUHJvcHM7XG5cbiAgZnVuY3Rpb24gaGFuZGxlRmlyc3RDYWxsKGZpcnN0U3RhdGUsIGZpcnN0T3duUHJvcHMpIHtcbiAgICBzdGF0ZSA9IGZpcnN0U3RhdGU7XG4gICAgb3duUHJvcHMgPSBmaXJzdE93blByb3BzO1xuICAgIHN0YXRlUHJvcHMgPSBtYXBTdGF0ZVRvUHJvcHMoc3RhdGUsIG93blByb3BzKTtcbiAgICBkaXNwYXRjaFByb3BzID0gbWFwRGlzcGF0Y2hUb1Byb3BzKGRpc3BhdGNoLCBvd25Qcm9wcyk7XG4gICAgbWVyZ2VkUHJvcHMgPSBtZXJnZVByb3BzKHN0YXRlUHJvcHMsIGRpc3BhdGNoUHJvcHMsIG93blByb3BzKTtcbiAgICBoYXNSdW5BdExlYXN0T25jZSA9IHRydWU7XG4gICAgcmV0dXJuIG1lcmdlZFByb3BzO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlTmV3UHJvcHNBbmROZXdTdGF0ZSgpIHtcbiAgICBzdGF0ZVByb3BzID0gbWFwU3RhdGVUb1Byb3BzKHN0YXRlLCBvd25Qcm9wcyk7XG4gICAgaWYgKG1hcERpc3BhdGNoVG9Qcm9wcy5kZXBlbmRzT25Pd25Qcm9wcykgZGlzcGF0Y2hQcm9wcyA9IG1hcERpc3BhdGNoVG9Qcm9wcyhkaXNwYXRjaCwgb3duUHJvcHMpO1xuICAgIG1lcmdlZFByb3BzID0gbWVyZ2VQcm9wcyhzdGF0ZVByb3BzLCBkaXNwYXRjaFByb3BzLCBvd25Qcm9wcyk7XG4gICAgcmV0dXJuIG1lcmdlZFByb3BzO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlTmV3UHJvcHMoKSB7XG4gICAgaWYgKG1hcFN0YXRlVG9Qcm9wcy5kZXBlbmRzT25Pd25Qcm9wcykgc3RhdGVQcm9wcyA9IG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSwgb3duUHJvcHMpO1xuICAgIGlmIChtYXBEaXNwYXRjaFRvUHJvcHMuZGVwZW5kc09uT3duUHJvcHMpIGRpc3BhdGNoUHJvcHMgPSBtYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gsIG93blByb3BzKTtcbiAgICBtZXJnZWRQcm9wcyA9IG1lcmdlUHJvcHMoc3RhdGVQcm9wcywgZGlzcGF0Y2hQcm9wcywgb3duUHJvcHMpO1xuICAgIHJldHVybiBtZXJnZWRQcm9wcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZU5ld1N0YXRlKCkge1xuICAgIHZhciBuZXh0U3RhdGVQcm9wcyA9IG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSwgb3duUHJvcHMpO1xuICAgIHZhciBzdGF0ZVByb3BzQ2hhbmdlZCA9ICFhcmVTdGF0ZVByb3BzRXF1YWwobmV4dFN0YXRlUHJvcHMsIHN0YXRlUHJvcHMpO1xuICAgIHN0YXRlUHJvcHMgPSBuZXh0U3RhdGVQcm9wcztcbiAgICBpZiAoc3RhdGVQcm9wc0NoYW5nZWQpIG1lcmdlZFByb3BzID0gbWVyZ2VQcm9wcyhzdGF0ZVByb3BzLCBkaXNwYXRjaFByb3BzLCBvd25Qcm9wcyk7XG4gICAgcmV0dXJuIG1lcmdlZFByb3BzO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlU3Vic2VxdWVudENhbGxzKG5leHRTdGF0ZSwgbmV4dE93blByb3BzKSB7XG4gICAgdmFyIHByb3BzQ2hhbmdlZCA9ICFhcmVPd25Qcm9wc0VxdWFsKG5leHRPd25Qcm9wcywgb3duUHJvcHMpO1xuICAgIHZhciBzdGF0ZUNoYW5nZWQgPSAhYXJlU3RhdGVzRXF1YWwobmV4dFN0YXRlLCBzdGF0ZSk7XG4gICAgc3RhdGUgPSBuZXh0U3RhdGU7XG4gICAgb3duUHJvcHMgPSBuZXh0T3duUHJvcHM7XG4gICAgaWYgKHByb3BzQ2hhbmdlZCAmJiBzdGF0ZUNoYW5nZWQpIHJldHVybiBoYW5kbGVOZXdQcm9wc0FuZE5ld1N0YXRlKCk7XG4gICAgaWYgKHByb3BzQ2hhbmdlZCkgcmV0dXJuIGhhbmRsZU5ld1Byb3BzKCk7XG4gICAgaWYgKHN0YXRlQ2hhbmdlZCkgcmV0dXJuIGhhbmRsZU5ld1N0YXRlKCk7XG4gICAgcmV0dXJuIG1lcmdlZFByb3BzO1xuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIHB1cmVGaW5hbFByb3BzU2VsZWN0b3IobmV4dFN0YXRlLCBuZXh0T3duUHJvcHMpIHtcbiAgICByZXR1cm4gaGFzUnVuQXRMZWFzdE9uY2UgPyBoYW5kbGVTdWJzZXF1ZW50Q2FsbHMobmV4dFN0YXRlLCBuZXh0T3duUHJvcHMpIDogaGFuZGxlRmlyc3RDYWxsKG5leHRTdGF0ZSwgbmV4dE93blByb3BzKTtcbiAgfTtcbn0gLy8gVE9ETzogQWRkIG1vcmUgY29tbWVudHNcbi8vIElmIHB1cmUgaXMgdHJ1ZSwgdGhlIHNlbGVjdG9yIHJldHVybmVkIGJ5IHNlbGVjdG9yRmFjdG9yeSB3aWxsIG1lbW9pemUgaXRzIHJlc3VsdHMsXG4vLyBhbGxvd2luZyBjb25uZWN0QWR2YW5jZWRcJ3Mgc2hvdWxkQ29tcG9uZW50VXBkYXRlIHRvIHJldHVybiBmYWxzZSBpZiBmaW5hbFxuLy8gcHJvcHMgaGF2ZSBub3QgY2hhbmdlZC4gSWYgZmFsc2UsIHRoZSBzZWxlY3RvciB3aWxsIGFsd2F5cyByZXR1cm4gYSBuZXdcbi8vIG9iamVjdCBhbmQgc2hvdWxkQ29tcG9uZW50VXBkYXRlIHdpbGwgYWx3YXlzIHJldHVybiB0cnVlLlxuXG5mdW5jdGlvbiBmaW5hbFByb3BzU2VsZWN0b3JGYWN0b3J5KGRpc3BhdGNoLCBfcmVmMikge1xuICB2YXIgaW5pdE1hcFN0YXRlVG9Qcm9wcyA9IF9yZWYyLmluaXRNYXBTdGF0ZVRvUHJvcHMsXG4gICAgICBpbml0TWFwRGlzcGF0Y2hUb1Byb3BzID0gX3JlZjIuaW5pdE1hcERpc3BhdGNoVG9Qcm9wcyxcbiAgICAgIGluaXRNZXJnZVByb3BzID0gX3JlZjIuaW5pdE1lcmdlUHJvcHMsXG4gICAgICBvcHRpb25zID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjIsIFsiaW5pdE1hcFN0YXRlVG9Qcm9wcyIsICJpbml0TWFwRGlzcGF0Y2hUb1Byb3BzIiwgImluaXRNZXJnZVByb3BzIl0pO1xuXG4gIHZhciBtYXBTdGF0ZVRvUHJvcHMgPSBpbml0TWFwU3RhdGVUb1Byb3BzKGRpc3BhdGNoLCBvcHRpb25zKTtcbiAgdmFyIG1hcERpc3BhdGNoVG9Qcm9wcyA9IGluaXRNYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gsIG9wdGlvbnMpO1xuICB2YXIgbWVyZ2VQcm9wcyA9IGluaXRNZXJnZVByb3BzKGRpc3BhdGNoLCBvcHRpb25zKTtcblxuICBpZiAoZmFsc2UpIHt9XG5cbiAgdmFyIHNlbGVjdG9yRmFjdG9yeSA9IG9wdGlvbnMucHVyZSA/IHB1cmVGaW5hbFByb3BzU2VsZWN0b3JGYWN0b3J5IDogaW1wdXJlRmluYWxQcm9wc1NlbGVjdG9yRmFjdG9yeTtcbiAgcmV0dXJuIHNlbGVjdG9yRmFjdG9yeShtYXBTdGF0ZVRvUHJvcHMsIG1hcERpc3BhdGNoVG9Qcm9wcywgbWVyZ2VQcm9wcywgZGlzcGF0Y2gsIG9wdGlvbnMpO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvY29ubmVjdC9jb25uZWN0LmpzXG5cblxuXG5cblxuXG5cblxuLypcclxuICBjb25uZWN0IGlzIGEgZmFjYWRlIG92ZXIgY29ubmVjdEFkdmFuY2VkLiBJdCB0dXJucyBpdHMgYXJncyBpbnRvIGEgY29tcGF0aWJsZVxyXG4gIHNlbGVjdG9yRmFjdG9yeSwgd2hpY2ggaGFzIHRoZSBzaWduYXR1cmU6XHJcblxyXG4gICAgKGRpc3BhdGNoLCBvcHRpb25zKSA9PiAobmV4dFN0YXRlLCBuZXh0T3duUHJvcHMpID0+IG5leHRGaW5hbFByb3BzXHJcbiAgXHJcbiAgY29ubmVjdCBwYXNzZXMgaXRzIGFyZ3MgdG8gY29ubmVjdEFkdmFuY2VkIGFzIG9wdGlvbnMsIHdoaWNoIHdpbGwgaW4gdHVybiBwYXNzIHRoZW0gdG9cclxuICBzZWxlY3RvckZhY3RvcnkgZWFjaCB0aW1lIGEgQ29ubmVjdCBjb21wb25lbnQgaW5zdGFuY2UgaXMgaW5zdGFudGlhdGVkIG9yIGhvdCByZWxvYWRlZC5cclxuXHJcbiAgc2VsZWN0b3JGYWN0b3J5IHJldHVybnMgYSBmaW5hbCBwcm9wcyBzZWxlY3RvciBmcm9tIGl0cyBtYXBTdGF0ZVRvUHJvcHMsXHJcbiAgbWFwU3RhdGVUb1Byb3BzRmFjdG9yaWVzLCBtYXBEaXNwYXRjaFRvUHJvcHMsIG1hcERpc3BhdGNoVG9Qcm9wc0ZhY3RvcmllcywgbWVyZ2VQcm9wcyxcclxuICBtZXJnZVByb3BzRmFjdG9yaWVzLCBhbmQgcHVyZSBhcmdzLlxyXG5cclxuICBUaGUgcmVzdWx0aW5nIGZpbmFsIHByb3BzIHNlbGVjdG9yIGlzIGNhbGxlZCBieSB0aGUgQ29ubmVjdCBjb21wb25lbnQgaW5zdGFuY2Ugd2hlbmV2ZXJcclxuICBpdCByZWNlaXZlcyBuZXcgcHJvcHMgb3Igc3RvcmUgc3RhdGUuXHJcbiAqL1xuXG5mdW5jdGlvbiBjb25uZWN0X21hdGNoKGFyZywgZmFjdG9yaWVzLCBuYW1lKSB7XG4gIGZvciAodmFyIGkgPSBmYWN0b3JpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgcmVzdWx0ID0gZmFjdG9yaWVzW2ldKGFyZyk7XG4gICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIG9wdGlvbnMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdmFsdWUgb2YgdHlwZSAiICsgdHlwZW9mIGFyZyArICIgZm9yICIgKyBuYW1lICsgIiBhcmd1bWVudCB3aGVuIGNvbm5lY3RpbmcgY29tcG9uZW50ICIgKyBvcHRpb25zLndyYXBwZWRDb21wb25lbnROYW1lICsgIi4iKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gc3RyaWN0RXF1YWwoYSwgYikge1xuICByZXR1cm4gYSA9PT0gYjtcbn0gLy8gY3JlYXRlQ29ubmVjdCB3aXRoIGRlZmF1bHQgYXJncyBidWlsZHMgdGhlIFwnb2ZmaWNpYWxcJyBjb25uZWN0IGJlaGF2aW9yLiBDYWxsaW5nIGl0IHdpdGhcbi8vIGRpZmZlcmVudCBvcHRpb25zIG9wZW5zIHVwIHNvbWUgdGVzdGluZyBhbmQgZXh0ZW5zaWJpbGl0eSBzY2VuYXJpb3NcblxuXG5mdW5jdGlvbiBjcmVhdGVDb25uZWN0KF90ZW1wKSB7XG4gIHZhciBfcmVmID0gX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAsXG4gICAgICBfcmVmJGNvbm5lY3RIT0MgPSBfcmVmLmNvbm5lY3RIT0MsXG4gICAgICBjb25uZWN0SE9DID0gX3JlZiRjb25uZWN0SE9DID09PSB2b2lkIDAgPyBjb25uZWN0QWR2YW5jZWQgOiBfcmVmJGNvbm5lY3RIT0MsXG4gICAgICBfcmVmJG1hcFN0YXRlVG9Qcm9wc0YgPSBfcmVmLm1hcFN0YXRlVG9Qcm9wc0ZhY3RvcmllcyxcbiAgICAgIG1hcFN0YXRlVG9Qcm9wc0ZhY3RvcmllcyA9IF9yZWYkbWFwU3RhdGVUb1Byb3BzRiA9PT0gdm9pZCAwID8gY29ubmVjdF9tYXBTdGF0ZVRvUHJvcHMgOiBfcmVmJG1hcFN0YXRlVG9Qcm9wc0YsXG4gICAgICBfcmVmJG1hcERpc3BhdGNoVG9Qcm8gPSBfcmVmLm1hcERpc3BhdGNoVG9Qcm9wc0ZhY3RvcmllcyxcbiAgICAgIG1hcERpc3BhdGNoVG9Qcm9wc0ZhY3RvcmllcyA9IF9yZWYkbWFwRGlzcGF0Y2hUb1BybyA9PT0gdm9pZCAwID8gY29ubmVjdF9tYXBEaXNwYXRjaFRvUHJvcHMgOiBfcmVmJG1hcERpc3BhdGNoVG9Qcm8sXG4gICAgICBfcmVmJG1lcmdlUHJvcHNGYWN0b3IgPSBfcmVmLm1lcmdlUHJvcHNGYWN0b3JpZXMsXG4gICAgICBtZXJnZVByb3BzRmFjdG9yaWVzID0gX3JlZiRtZXJnZVByb3BzRmFjdG9yID09PSB2b2lkIDAgPyBjb25uZWN0X21lcmdlUHJvcHMgOiBfcmVmJG1lcmdlUHJvcHNGYWN0b3IsXG4gICAgICBfcmVmJHNlbGVjdG9yRmFjdG9yeSA9IF9yZWYuc2VsZWN0b3JGYWN0b3J5LFxuICAgICAgc2VsZWN0b3JGYWN0b3J5ID0gX3JlZiRzZWxlY3RvckZhY3RvcnkgPT09IHZvaWQgMCA/IGZpbmFsUHJvcHNTZWxlY3RvckZhY3RvcnkgOiBfcmVmJHNlbGVjdG9yRmFjdG9yeTtcblxuICByZXR1cm4gZnVuY3Rpb24gY29ubmVjdChtYXBTdGF0ZVRvUHJvcHMsIG1hcERpc3BhdGNoVG9Qcm9wcywgbWVyZ2VQcm9wcywgX3JlZjIpIHtcbiAgICBpZiAoX3JlZjIgPT09IHZvaWQgMCkge1xuICAgICAgX3JlZjIgPSB7fTtcbiAgICB9XG5cbiAgICB2YXIgX3JlZjMgPSBfcmVmMixcbiAgICAgICAgX3JlZjMkcHVyZSA9IF9yZWYzLnB1cmUsXG4gICAgICAgIHB1cmUgPSBfcmVmMyRwdXJlID09PSB2b2lkIDAgPyB0cnVlIDogX3JlZjMkcHVyZSxcbiAgICAgICAgX3JlZjMkYXJlU3RhdGVzRXF1YWwgPSBfcmVmMy5hcmVTdGF0ZXNFcXVhbCxcbiAgICAgICAgYXJlU3RhdGVzRXF1YWwgPSBfcmVmMyRhcmVTdGF0ZXNFcXVhbCA9PT0gdm9pZCAwID8gc3RyaWN0RXF1YWwgOiBfcmVmMyRhcmVTdGF0ZXNFcXVhbCxcbiAgICAgICAgX3JlZjMkYXJlT3duUHJvcHNFcXVhID0gX3JlZjMuYXJlT3duUHJvcHNFcXVhbCxcbiAgICAgICAgYXJlT3duUHJvcHNFcXVhbCA9IF9yZWYzJGFyZU93blByb3BzRXF1YSA9PT0gdm9pZCAwID8gc2hhbGxvd0VxdWFsIDogX3JlZjMkYXJlT3duUHJvcHNFcXVhLFxuICAgICAgICBfcmVmMyRhcmVTdGF0ZVByb3BzRXEgPSBfcmVmMy5hcmVTdGF0ZVByb3BzRXF1YWwsXG4gICAgICAgIGFyZVN0YXRlUHJvcHNFcXVhbCA9IF9yZWYzJGFyZVN0YXRlUHJvcHNFcSA9PT0gdm9pZCAwID8gc2hhbGxvd0VxdWFsIDogX3JlZjMkYXJlU3RhdGVQcm9wc0VxLFxuICAgICAgICBfcmVmMyRhcmVNZXJnZWRQcm9wc0UgPSBfcmVmMy5hcmVNZXJnZWRQcm9wc0VxdWFsLFxuICAgICAgICBhcmVNZXJnZWRQcm9wc0VxdWFsID0gX3JlZjMkYXJlTWVyZ2VkUHJvcHNFID09PSB2b2lkIDAgPyBzaGFsbG93RXF1YWwgOiBfcmVmMyRhcmVNZXJnZWRQcm9wc0UsXG4gICAgICAgIGV4dHJhT3B0aW9ucyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWYzLCBbInB1cmUiLCAiYXJlU3RhdGVzRXF1YWwiLCAiYXJlT3duUHJvcHNFcXVhbCIsICJhcmVTdGF0ZVByb3BzRXF1YWwiLCAiYXJlTWVyZ2VkUHJvcHNFcXVhbCJdKTtcblxuICAgIHZhciBpbml0TWFwU3RhdGVUb1Byb3BzID0gY29ubmVjdF9tYXRjaChtYXBTdGF0ZVRvUHJvcHMsIG1hcFN0YXRlVG9Qcm9wc0ZhY3RvcmllcywgXCdtYXBTdGF0ZVRvUHJvcHNcJyk7XG4gICAgdmFyIGluaXRNYXBEaXNwYXRjaFRvUHJvcHMgPSBjb25uZWN0X21hdGNoKG1hcERpc3BhdGNoVG9Qcm9wcywgbWFwRGlzcGF0Y2hUb1Byb3BzRmFjdG9yaWVzLCBcJ21hcERpc3BhdGNoVG9Qcm9wc1wnKTtcbiAgICB2YXIgaW5pdE1lcmdlUHJvcHMgPSBjb25uZWN0X21hdGNoKG1lcmdlUHJvcHMsIG1lcmdlUHJvcHNGYWN0b3JpZXMsIFwnbWVyZ2VQcm9wc1wnKTtcbiAgICByZXR1cm4gY29ubmVjdEhPQyhzZWxlY3RvckZhY3RvcnksIF9leHRlbmRzKHtcbiAgICAgIC8vIHVzZWQgaW4gZXJyb3IgbWVzc2FnZXNcbiAgICAgIG1ldGhvZE5hbWU6IFwnY29ubmVjdFwnLFxuICAgICAgLy8gdXNlZCB0byBjb21wdXRlIENvbm5lY3RcJ3MgZGlzcGxheU5hbWUgZnJvbSB0aGUgd3JhcHBlZCBjb21wb25lbnRcJ3MgZGlzcGxheU5hbWUuXG4gICAgICBnZXREaXNwbGF5TmFtZTogZnVuY3Rpb24gZ2V0RGlzcGxheU5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gIkNvbm5lY3QoIiArIG5hbWUgKyAiKSI7XG4gICAgICB9LFxuICAgICAgLy8gaWYgbWFwU3RhdGVUb1Byb3BzIGlzIGZhbHN5LCB0aGUgQ29ubmVjdCBjb21wb25lbnQgZG9lc25cJ3Qgc3Vic2NyaWJlIHRvIHN0b3JlIHN0YXRlIGNoYW5nZXNcbiAgICAgIHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlczogQm9vbGVhbihtYXBTdGF0ZVRvUHJvcHMpLFxuICAgICAgLy8gcGFzc2VkIHRocm91Z2ggdG8gc2VsZWN0b3JGYWN0b3J5XG4gICAgICBpbml0TWFwU3RhdGVUb1Byb3BzOiBpbml0TWFwU3RhdGVUb1Byb3BzLFxuICAgICAgaW5pdE1hcERpc3BhdGNoVG9Qcm9wczogaW5pdE1hcERpc3BhdGNoVG9Qcm9wcyxcbiAgICAgIGluaXRNZXJnZVByb3BzOiBpbml0TWVyZ2VQcm9wcyxcbiAgICAgIHB1cmU6IHB1cmUsXG4gICAgICBhcmVTdGF0ZXNFcXVhbDogYXJlU3RhdGVzRXF1YWwsXG4gICAgICBhcmVPd25Qcm9wc0VxdWFsOiBhcmVPd25Qcm9wc0VxdWFsLFxuICAgICAgYXJlU3RhdGVQcm9wc0VxdWFsOiBhcmVTdGF0ZVByb3BzRXF1YWwsXG4gICAgICBhcmVNZXJnZWRQcm9wc0VxdWFsOiBhcmVNZXJnZWRQcm9wc0VxdWFsXG4gICAgfSwgZXh0cmFPcHRpb25zKSk7XG4gIH07XG59XG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBjb25uZWN0X2Nvbm5lY3QgPSAoLyojX19QVVJFX18qL2NyZWF0ZUNvbm5lY3QoKSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9ob29rcy91c2VSZWR1eENvbnRleHQuanNcblxuXG4vKipcclxuICogQSBob29rIHRvIGFjY2VzcyB0aGUgdmFsdWUgb2YgdGhlIGBSZWFjdFJlZHV4Q29udGV4dGAuIFRoaXMgaXMgYSBsb3ctbGV2ZWxcclxuICogaG9vayB0aGF0IHlvdSBzaG91bGQgdXN1YWxseSBub3QgbmVlZCB0byBjYWxsIGRpcmVjdGx5LlxyXG4gKlxyXG4gKiBAcmV0dXJucyB7YW55fSB0aGUgdmFsdWUgb2YgdGhlIGBSZWFjdFJlZHV4Q29udGV4dGBcclxuICpcclxuICogQGV4YW1wbGVcclxuICpcclxuICogaW1wb3J0IFJlYWN0IGZyb20gXCdyZWFjdFwnXHJcbiAqIGltcG9ydCB7IHVzZVJlZHV4Q29udGV4dCB9IGZyb20gXCdyZWFjdC1yZWR1eFwnXHJcbiAqXHJcbiAqIGV4cG9ydCBjb25zdCBDb3VudGVyQ29tcG9uZW50ID0gKHsgdmFsdWUgfSkgPT4ge1xyXG4gKiAgIGNvbnN0IHsgc3RvcmUgfSA9IHVzZVJlZHV4Q29udGV4dCgpXHJcbiAqICAgcmV0dXJuIDxkaXY+e3N0b3JlLmdldFN0YXRlKCl9PC9kaXY+XHJcbiAqIH1cclxuICovXG5cbmZ1bmN0aW9uIHVzZVJlZHV4Q29udGV4dF91c2VSZWR1eENvbnRleHQoKSB7XG4gIHZhciBjb250ZXh0VmFsdWUgPSBPYmplY3QocmVhY3RbInVzZUNvbnRleHQiXSkoUmVhY3RSZWR1eENvbnRleHQpO1xuXG4gIGlmIChmYWxzZSkge31cblxuICByZXR1cm4gY29udGV4dFZhbHVlO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtcmVkdXgvZXMvaG9va3MvdXNlU3RvcmUuanNcblxuXG5cbi8qKlxyXG4gKiBIb29rIGZhY3RvcnksIHdoaWNoIGNyZWF0ZXMgYSBgdXNlU3RvcmVgIGhvb2sgYm91bmQgdG8gYSBnaXZlbiBjb250ZXh0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge1JlYWN0LkNvbnRleHR9IFtjb250ZXh0PVJlYWN0UmVkdXhDb250ZXh0XSBDb250ZXh0IHBhc3NlZCB0byB5b3VyIGA8UHJvdmlkZXI+YC5cclxuICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGB1c2VTdG9yZWAgaG9vayBib3VuZCB0byB0aGUgc3BlY2lmaWVkIGNvbnRleHQuXHJcbiAqL1xuXG5mdW5jdGlvbiBjcmVhdGVTdG9yZUhvb2soY29udGV4dCkge1xuICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSB7XG4gICAgY29udGV4dCA9IFJlYWN0UmVkdXhDb250ZXh0O1xuICB9XG5cbiAgdmFyIHVzZVJlZHV4Q29udGV4dCA9IGNvbnRleHQgPT09IFJlYWN0UmVkdXhDb250ZXh0ID8gdXNlUmVkdXhDb250ZXh0X3VzZVJlZHV4Q29udGV4dCA6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gT2JqZWN0KHJlYWN0WyJ1c2VDb250ZXh0Il0pKGNvbnRleHQpO1xuICB9O1xuICByZXR1cm4gZnVuY3Rpb24gdXNlU3RvcmUoKSB7XG4gICAgdmFyIF91c2VSZWR1eENvbnRleHQgPSB1c2VSZWR1eENvbnRleHQoKSxcbiAgICAgICAgc3RvcmUgPSBfdXNlUmVkdXhDb250ZXh0LnN0b3JlO1xuXG4gICAgcmV0dXJuIHN0b3JlO1xuICB9O1xufVxuLyoqXHJcbiAqIEEgaG9vayB0byBhY2Nlc3MgdGhlIHJlZHV4IHN0b3JlLlxyXG4gKlxyXG4gKiBAcmV0dXJucyB7YW55fSB0aGUgcmVkdXggc3RvcmVcclxuICpcclxuICogQGV4YW1wbGVcclxuICpcclxuICogaW1wb3J0IFJlYWN0IGZyb20gXCdyZWFjdFwnXHJcbiAqIGltcG9ydCB7IHVzZVN0b3JlIH0gZnJvbSBcJ3JlYWN0LXJlZHV4XCdcclxuICpcclxuICogZXhwb3J0IGNvbnN0IEV4YW1wbGVDb21wb25lbnQgPSAoKSA9PiB7XHJcbiAqICAgY29uc3Qgc3RvcmUgPSB1c2VTdG9yZSgpXHJcbiAqICAgcmV0dXJuIDxkaXY+e3N0b3JlLmdldFN0YXRlKCl9PC9kaXY+XHJcbiAqIH1cclxuICovXG5cbnZhciB1c2VTdG9yZV91c2VTdG9yZSA9XG4vKiNfX1BVUkVfXyovXG5jcmVhdGVTdG9yZUhvb2soKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL2hvb2tzL3VzZURpc3BhdGNoLmpzXG5cblxuLyoqXHJcbiAqIEhvb2sgZmFjdG9yeSwgd2hpY2ggY3JlYXRlcyBhIGB1c2VEaXNwYXRjaGAgaG9vayBib3VuZCB0byBhIGdpdmVuIGNvbnRleHQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7UmVhY3QuQ29udGV4dH0gW2NvbnRleHQ9UmVhY3RSZWR1eENvbnRleHRdIENvbnRleHQgcGFzc2VkIHRvIHlvdXIgYDxQcm92aWRlcj5gLlxyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgYHVzZURpc3BhdGNoYCBob29rIGJvdW5kIHRvIHRoZSBzcGVjaWZpZWQgY29udGV4dC5cclxuICovXG5cbmZ1bmN0aW9uIGNyZWF0ZURpc3BhdGNoSG9vayhjb250ZXh0KSB7XG4gIGlmIChjb250ZXh0ID09PSB2b2lkIDApIHtcbiAgICBjb250ZXh0ID0gUmVhY3RSZWR1eENvbnRleHQ7XG4gIH1cblxuICB2YXIgdXNlU3RvcmUgPSBjb250ZXh0ID09PSBSZWFjdFJlZHV4Q29udGV4dCA/IHVzZVN0b3JlX3VzZVN0b3JlIDogY3JlYXRlU3RvcmVIb29rKGNvbnRleHQpO1xuICByZXR1cm4gZnVuY3Rpb24gdXNlRGlzcGF0Y2goKSB7XG4gICAgdmFyIHN0b3JlID0gdXNlU3RvcmUoKTtcbiAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2g7XG4gIH07XG59XG4vKipcclxuICogQSBob29rIHRvIGFjY2VzcyB0aGUgcmVkdXggYGRpc3BhdGNoYCBmdW5jdGlvbi5cclxuICpcclxuICogQHJldHVybnMge2FueXxmdW5jdGlvbn0gcmVkdXggc3RvcmVcJ3MgYGRpc3BhdGNoYCBmdW5jdGlvblxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKlxyXG4gKiBpbXBvcnQgUmVhY3QsIHsgdXNlQ2FsbGJhY2sgfSBmcm9tIFwncmVhY3RcJ1xyXG4gKiBpbXBvcnQgeyB1c2VEaXNwYXRjaCB9IGZyb20gXCdyZWFjdC1yZWR1eFwnXHJcbiAqXHJcbiAqIGV4cG9ydCBjb25zdCBDb3VudGVyQ29tcG9uZW50ID0gKHsgdmFsdWUgfSkgPT4ge1xyXG4gKiAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKVxyXG4gKiAgIGNvbnN0IGluY3JlYXNlQ291bnRlciA9IHVzZUNhbGxiYWNrKCgpID0+IGRpc3BhdGNoKHsgdHlwZTogXCdpbmNyZWFzZS1jb3VudGVyXCcgfSksIFtdKVxyXG4gKiAgIHJldHVybiAoXHJcbiAqICAgICA8ZGl2PlxyXG4gKiAgICAgICA8c3Bhbj57dmFsdWV9PC9zcGFuPlxyXG4gKiAgICAgICA8YnV0dG9uIG9uQ2xpY2s9e2luY3JlYXNlQ291bnRlcn0+SW5jcmVhc2UgY291bnRlcjwvYnV0dG9uPlxyXG4gKiAgICAgPC9kaXY+XHJcbiAqICAgKVxyXG4gKiB9XHJcbiAqL1xuXG52YXIgdXNlRGlzcGF0Y2ggPVxuLyojX19QVVJFX18qL1xuY3JlYXRlRGlzcGF0Y2hIb29rKCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yZWR1eC9lcy9ob29rcy91c2VTZWxlY3Rvci5qc1xuXG5cblxuXG5cblxudmFyIHJlZkVxdWFsaXR5ID0gZnVuY3Rpb24gcmVmRXF1YWxpdHkoYSwgYikge1xuICByZXR1cm4gYSA9PT0gYjtcbn07XG5cbmZ1bmN0aW9uIHVzZVNlbGVjdG9yV2l0aFN0b3JlQW5kU3Vic2NyaXB0aW9uKHNlbGVjdG9yLCBlcXVhbGl0eUZuLCBzdG9yZSwgY29udGV4dFN1Yikge1xuICB2YXIgX3VzZVJlZHVjZXIgPSBPYmplY3QocmVhY3RbInVzZVJlZHVjZXIiXSkoZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gcyArIDE7XG4gIH0sIDApLFxuICAgICAgZm9yY2VSZW5kZXIgPSBfdXNlUmVkdWNlclsxXTtcblxuICB2YXIgc3Vic2NyaXB0aW9uID0gT2JqZWN0KHJlYWN0WyJ1c2VNZW1vIl0pKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFN1YnNjcmlwdGlvbihzdG9yZSwgY29udGV4dFN1Yik7XG4gIH0sIFtzdG9yZSwgY29udGV4dFN1Yl0pO1xuICB2YXIgbGF0ZXN0U3Vic2NyaXB0aW9uQ2FsbGJhY2tFcnJvciA9IE9iamVjdChyZWFjdFsidXNlUmVmIl0pKCk7XG4gIHZhciBsYXRlc3RTZWxlY3RvciA9IE9iamVjdChyZWFjdFsidXNlUmVmIl0pKCk7XG4gIHZhciBsYXRlc3RTdG9yZVN0YXRlID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkoKTtcbiAgdmFyIGxhdGVzdFNlbGVjdGVkU3RhdGUgPSBPYmplY3QocmVhY3RbInVzZVJlZiJdKSgpO1xuICB2YXIgc3RvcmVTdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gIHZhciBzZWxlY3RlZFN0YXRlO1xuXG4gIHRyeSB7XG4gICAgaWYgKHNlbGVjdG9yICE9PSBsYXRlc3RTZWxlY3Rvci5jdXJyZW50IHx8IHN0b3JlU3RhdGUgIT09IGxhdGVzdFN0b3JlU3RhdGUuY3VycmVudCB8fCBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQpIHtcbiAgICAgIHNlbGVjdGVkU3RhdGUgPSBzZWxlY3RvcihzdG9yZVN0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZWN0ZWRTdGF0ZSA9IGxhdGVzdFNlbGVjdGVkU3RhdGUuY3VycmVudDtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmIChsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQpIHtcbiAgICAgIGVyci5tZXNzYWdlICs9ICJcXG5UaGUgZXJyb3IgbWF5IGJlIGNvcnJlbGF0ZWQgd2l0aCB0aGlzIHByZXZpb3VzIGVycm9yOlxcbiIgKyBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQuc3RhY2sgKyAiXFxuXFxuIjtcbiAgICB9XG5cbiAgICB0aHJvdyBlcnI7XG4gIH1cblxuICB1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICBsYXRlc3RTZWxlY3Rvci5jdXJyZW50ID0gc2VsZWN0b3I7XG4gICAgbGF0ZXN0U3RvcmVTdGF0ZS5jdXJyZW50ID0gc3RvcmVTdGF0ZTtcbiAgICBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQgPSBzZWxlY3RlZFN0YXRlO1xuICAgIGxhdGVzdFN1YnNjcmlwdGlvbkNhbGxiYWNrRXJyb3IuY3VycmVudCA9IHVuZGVmaW5lZDtcbiAgfSk7XG4gIHVzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGNoZWNrRm9yVXBkYXRlcygpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBuZXdTZWxlY3RlZFN0YXRlID0gbGF0ZXN0U2VsZWN0b3IuY3VycmVudChzdG9yZS5nZXRTdGF0ZSgpKTtcblxuICAgICAgICBpZiAoZXF1YWxpdHlGbihuZXdTZWxlY3RlZFN0YXRlLCBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQpKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGF0ZXN0U2VsZWN0ZWRTdGF0ZS5jdXJyZW50ID0gbmV3U2VsZWN0ZWRTdGF0ZTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSBpZ25vcmUgYWxsIGVycm9ycyBoZXJlLCBzaW5jZSB3aGVuIHRoZSBjb21wb25lbnRcbiAgICAgICAgLy8gaXMgcmUtcmVuZGVyZWQsIHRoZSBzZWxlY3RvcnMgYXJlIGNhbGxlZCBhZ2FpbiwgYW5kXG4gICAgICAgIC8vIHdpbGwgdGhyb3cgYWdhaW4sIGlmIG5laXRoZXIgcHJvcHMgbm9yIHN0b3JlIHN0YXRlXG4gICAgICAgIC8vIGNoYW5nZWRcbiAgICAgICAgbGF0ZXN0U3Vic2NyaXB0aW9uQ2FsbGJhY2tFcnJvci5jdXJyZW50ID0gZXJyO1xuICAgICAgfVxuXG4gICAgICBmb3JjZVJlbmRlcigpO1xuICAgIH1cblxuICAgIHN1YnNjcmlwdGlvbi5vblN0YXRlQ2hhbmdlID0gY2hlY2tGb3JVcGRhdGVzO1xuICAgIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTtcbiAgICBjaGVja0ZvclVwZGF0ZXMoKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi50cnlVbnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0sIFtzdG9yZSwgc3Vic2NyaXB0aW9uXSk7XG4gIHJldHVybiBzZWxlY3RlZFN0YXRlO1xufVxuLyoqXHJcbiAqIEhvb2sgZmFjdG9yeSwgd2hpY2ggY3JlYXRlcyBhIGB1c2VTZWxlY3RvcmAgaG9vayBib3VuZCB0byBhIGdpdmVuIGNvbnRleHQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7UmVhY3QuQ29udGV4dH0gW2NvbnRleHQ9UmVhY3RSZWR1eENvbnRleHRdIENvbnRleHQgcGFzc2VkIHRvIHlvdXIgYDxQcm92aWRlcj5gLlxyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgYHVzZVNlbGVjdG9yYCBob29rIGJvdW5kIHRvIHRoZSBzcGVjaWZpZWQgY29udGV4dC5cclxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlU2VsZWN0b3JIb29rKGNvbnRleHQpIHtcbiAgaWYgKGNvbnRleHQgPT09IHZvaWQgMCkge1xuICAgIGNvbnRleHQgPSBSZWFjdFJlZHV4Q29udGV4dDtcbiAgfVxuXG4gIHZhciB1c2VSZWR1eENvbnRleHQgPSBjb250ZXh0ID09PSBSZWFjdFJlZHV4Q29udGV4dCA/IHVzZVJlZHV4Q29udGV4dF91c2VSZWR1eENvbnRleHQgOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIE9iamVjdChyZWFjdFsidXNlQ29udGV4dCJdKShjb250ZXh0KTtcbiAgfTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVzZVNlbGVjdG9yKHNlbGVjdG9yLCBlcXVhbGl0eUZuKSB7XG4gICAgaWYgKGVxdWFsaXR5Rm4gPT09IHZvaWQgMCkge1xuICAgICAgZXF1YWxpdHlGbiA9IHJlZkVxdWFsaXR5O1xuICAgIH1cblxuICAgIGlmIChmYWxzZSkge31cblxuICAgIHZhciBfdXNlUmVkdXhDb250ZXh0ID0gdXNlUmVkdXhDb250ZXh0KCksXG4gICAgICAgIHN0b3JlID0gX3VzZVJlZHV4Q29udGV4dC5zdG9yZSxcbiAgICAgICAgY29udGV4dFN1YiA9IF91c2VSZWR1eENvbnRleHQuc3Vic2NyaXB0aW9uO1xuXG4gICAgdmFyIHNlbGVjdGVkU3RhdGUgPSB1c2VTZWxlY3RvcldpdGhTdG9yZUFuZFN1YnNjcmlwdGlvbihzZWxlY3RvciwgZXF1YWxpdHlGbiwgc3RvcmUsIGNvbnRleHRTdWIpO1xuICAgIE9iamVjdChyZWFjdFsidXNlRGVidWdWYWx1ZSJdKShzZWxlY3RlZFN0YXRlKTtcbiAgICByZXR1cm4gc2VsZWN0ZWRTdGF0ZTtcbiAgfTtcbn1cbi8qKlxyXG4gKiBBIGhvb2sgdG8gYWNjZXNzIHRoZSByZWR1eCBzdG9yZVwncyBzdGF0ZS4gVGhpcyBob29rIHRha2VzIGEgc2VsZWN0b3IgZnVuY3Rpb25cclxuICogYXMgYW4gYXJndW1lbnQuIFRoZSBzZWxlY3RvciBpcyBjYWxsZWQgd2l0aCB0aGUgc3RvcmUgc3RhdGUuXHJcbiAqXHJcbiAqIFRoaXMgaG9vayB0YWtlcyBhbiBvcHRpb25hbCBlcXVhbGl0eSBjb21wYXJpc29uIGZ1bmN0aW9uIGFzIHRoZSBzZWNvbmQgcGFyYW1ldGVyXHJcbiAqIHRoYXQgYWxsb3dzIHlvdSB0byBjdXN0b21pemUgdGhlIHdheSB0aGUgc2VsZWN0ZWQgc3RhdGUgaXMgY29tcGFyZWQgdG8gZGV0ZXJtaW5lXHJcbiAqIHdoZXRoZXIgdGhlIGNvbXBvbmVudCBuZWVkcyB0byBiZSByZS1yZW5kZXJlZC5cclxuICpcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb249fSBlcXVhbGl0eUZuIHRoZSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZXRlcm1pbmUgZXF1YWxpdHlcclxuICpcclxuICogQHJldHVybnMge2FueX0gdGhlIHNlbGVjdGVkIHN0YXRlXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqXHJcbiAqIGltcG9ydCBSZWFjdCBmcm9tIFwncmVhY3RcJ1xyXG4gKiBpbXBvcnQgeyB1c2VTZWxlY3RvciB9IGZyb20gXCdyZWFjdC1yZWR1eFwnXHJcbiAqXHJcbiAqIGV4cG9ydCBjb25zdCBDb3VudGVyQ29tcG9uZW50ID0gKCkgPT4ge1xyXG4gKiAgIGNvbnN0IGNvdW50ZXIgPSB1c2VTZWxlY3RvcihzdGF0ZSA9PiBzdGF0ZS5jb3VudGVyKVxyXG4gKiAgIHJldHVybiA8ZGl2Pntjb3VudGVyfTwvZGl2PlxyXG4gKiB9XHJcbiAqL1xuXG52YXIgdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IgPVxuLyojX19QVVJFX18qL1xuY3JlYXRlU2VsZWN0b3JIb29rKCk7XG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LWRvbS9pbmRleC5qc1xudmFyIHJlYWN0X2RvbSA9IF9fd2VicGFja19yZXF1aXJlX18oNSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL3V0aWxzL3JlYWN0QmF0Y2hlZFVwZGF0ZXMuanNcbi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby11bnJlc29sdmVkICovXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJlZHV4L2VzL2luZGV4LmpzXG5cblxuXG5cblxuXG5cblxuXG5cbnNldEJhdGNoKHJlYWN0X2RvbVsidW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMiXSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlZHV4LXRodW5rL2VzL2luZGV4LmpzXG5mdW5jdGlvbiBjcmVhdGVUaHVua01pZGRsZXdhcmUoZXh0cmFBcmd1bWVudCkge1xuICByZXR1cm4gZnVuY3Rpb24gKF9yZWYpIHtcbiAgICB2YXIgZGlzcGF0Y2ggPSBfcmVmLmRpc3BhdGNoLFxuICAgICAgICBnZXRTdGF0ZSA9IF9yZWYuZ2V0U3RhdGU7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChuZXh0KSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGFjdGlvbikge1xuICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICAgICAgcmV0dXJuIGFjdGlvbihkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhQXJndW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5leHQoYWN0aW9uKTtcbiAgICAgIH07XG4gICAgfTtcbiAgfTtcbn1cblxudmFyIHRodW5rID0gY3JlYXRlVGh1bmtNaWRkbGV3YXJlKCk7XG50aHVuay53aXRoRXh0cmFBcmd1bWVudCA9IGNyZWF0ZVRodW5rTWlkZGxld2FyZTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmVkdXhfdGh1bmtfZXMgPSAodGh1bmspO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L3N0b3JlL2FjdGlvbnMuanNcblxuXG5jb25zdCBhY3Rpb25zVHlwZXMgPSB7XG4gIFNFVF9TVEFUVVM6ICJTRVRfU1RBVFVTIixcbiAgU0VUX1BST0dSRVNTOiAiU0VUX1BST0dSRVNTIixcbiAgUkVTRVRfUFJPR1JFU1M6ICJSRVNFVF9QUk9HUkVTUyIsXG4gIFNFVF9TRVJWSUNFOiAiU0VUX1NFUlZJQ0UiLFxuICBTRVRfVklERU9fSU5GTzogIlNFVF9WSURFT19JTkZPIixcbiAgU0VUX0FVRElPX0lORk86ICJTRVRfQVVESU9fSU5GTyIsXG4gIFNFVF9TVFJFQU1fSU5GTzogIlNFVF9TVFJFQU1fSU5GTyIsXG4gIFNFVF9ERUZBVUxUX0lURU06ICJTRVRfREVGQVVMVF9JVEVNIixcbiAgU0VUX0NPTlRFTlRfTElNSVQ6ICJTRVRfQ09OVEVOVF9MSU1JVCIsXG4gIFNFVF9NT0RVTEU6ICJTRVRfTU9EVUxFIixcbiAgU0VUX0NBTkNFTDogIlNFVF9DQU5DRUwiLFxuICBTRVRfVEhFTUU6ICJTRVRfVEhFTUUiLFxuICBTRVRfTEFORzogIlNFVF9MQU5HIixcbiAgU0VUX0kxOE46ICJTRVRfSTE4TiIsXG4gIFNFVF9ESVI6ICJTRVRfRElSIixcbiAgQUREX05PVElGSUNBVElPTjogIkFERF9OT1RJRklDQVRJT04iLFxuICBSRU1PVkVfTk9USUZJQ0FUSU9OOiAiUkVNT1ZFX05PVElGSUNBVElPTiIsXG4gIFNFVF9IRUxQX1NUQVRFOiAiU0VUX0hFTFBfU1RBVEUiLFxuICBTRVRfU0VORF9FVkVOVDogIlNFVF9TRU5EX0VWRU5UIixcbiAgU0VUX0RPV05MT0FEU19DT1VOVDogIlNFVF9ET1dOTE9BRFNfQ09VTlQiLFxuICBTRVRfRElTUExBWV9RUl9DT0RFUzogIlNFVF9ESVNQTEFZX1FSX0NPREVTIixcbiAgU0VUX1NIT1dfRk9STUFUU19BVkFJTEFCTEVfVklBX1VETDogIlNFVF9TSE9XX0ZPUk1BVFNfQVZBSUxBQkxFX1ZJQV9VREwiLFxuICBTRVRfU0hPV19GT1JNQVRTX1JFUVVJUkVEX09OTElORV9DT05WRVJTSU9OOiAiU0VUX1NIT1dfRk9STUFUU19SRVFVSVJFRF9PTkxJTkVfQ09OVkVSU0lPTiIsXG4gIFNFVF9XQVJOX0JFRk9SRV9DT05WRVJUSU5HOiAiU0VUX1dBUk5fQkVGT1JFX0NPTlZFUlRJTkciLFxuICBTRVRfV0FSTl9BQk9VVF9DT01QRVRJVE9SU19ERVRFQ1RJT046ICJTRVRfV0FSTl9BQk9VVF9DT01QRVRJVE9SU19ERVRFQ1RJT04iLFxuICBTRVRfU0hPV19TTkFQU0hPVF9CVVRUT046ICJTRVRfU0hPV19TTkFQU0hPVF9CVVRUT04iLFxuICBTRVRfQVBQX0JVVFRPTl9TVFlMRTogIlNFVF9BUFBfQlVUVE9OX1NUWUxFIixcbn07XG5cbmNvbnN0IGdldFN5bmNBY3Rpb24gPSBmdW5jdGlvbiAobmFtZSwgZGVmYXVsdFZhbHVlLCBzZXR0ZXIpIHtcbiAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgIGxldCBzdG9yZWRWYWx1ZSA9IGF3YWl0IGdsb2JhbF9zdG9yYWdlX3RtLmdldChuYW1lKTtcbiAgICBpZiAoc3RvcmVkVmFsdWUgPT09IG51bGwgfHwgc3RvcmVkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgc3RvcmVkVmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQobmFtZSwgZGVmYXVsdFZhbHVlKTtcbiAgICB9XG4gICAgZGlzcGF0Y2goc2V0dGVyKHN0b3JlZFZhbHVlKSk7XG4gIH07XG59O1xuXG5jb25zdCBhY3Rpb25zX2FjdGlvbnMgPSB7XG4gIHNldFN0YXR1cyhzdGF0dXMpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX1NUQVRVUywgdmFsdWU6IHN0YXR1cyB9O1xuICB9LFxuICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfUFJPR1JFU1MsIHZhbHVlOiBwcm9ncmVzcyB9O1xuICB9LFxuICByZXNldFByb2dyZXNzKCkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5SRVNFVF9QUk9HUkVTUywgdmFsdWU6IG51bGwgfTtcbiAgfSxcbiAgc2V0U2VydmljZShzZXJ2aWNlTmFtZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfU0VSVklDRSwgdmFsdWU6IHNlcnZpY2VOYW1lIH07XG4gIH0sXG4gIHNldFZpZGVvSW5mbyhpbmZvKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9WSURFT19JTkZPLCB2YWx1ZTogaW5mbyB9O1xuICB9LFxuICBzZXRBdWRpb0luZm8oaW5mbykge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfQVVESU9fSU5GTywgdmFsdWU6IGluZm8gfTtcbiAgfSxcbiAgc2V0U3RyZWFtSW5mbyhpbmZvKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9TVFJFQU1fSU5GTywgdmFsdWU6IGluZm8gfTtcbiAgfSxcbiAgc2V0Q29udGVudExpbWl0KGNvbnRlbnRMaW1pdCkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfQ09OVEVOVF9MSU1JVCwgdmFsdWU6IGNvbnRlbnRMaW1pdCB9O1xuICB9LFxuICBzZXREZWZhdWx0SXRlbShpbmZvKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9ERUZBVUxUX0lURU0sIHZhbHVlOiBpbmZvIH07XG4gIH0sXG4gIHNldE1vZHVsZShtb2R1bGUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX01PRFVMRSwgdmFsdWU6IG1vZHVsZSB9O1xuICB9LFxuICBzZXRDYW5jZWwoY2FuY2VsKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9DQU5DRUwsIHZhbHVlOiBjYW5jZWwgfTtcbiAgfSxcbiAgc2V0VGhlbWUodGhlbWUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX1RIRU1FLCB2YWx1ZTogdGhlbWUgfTtcbiAgfSxcbiAgX3NldExhbmcodmFsdWUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX0xBTkcsIHZhbHVlIH07XG4gIH0sXG4gIHN5bmNMYW5nOlxuICAgICgpID0+IGdldFN5bmNBY3Rpb24oImxhbmciLCAiYXV0b0RldGVjdCIsIGFjdGlvbnNfYWN0aW9ucy5zZXRMYW5nKSxcbiAgc2V0TGFuZyhsYW5nKSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHtcbiAgICAgIGNvbnN0IHsgbW9kdWxlLCBpMThuIH0gPSBnZXRTdGF0ZSgpO1xuICAgICAgY29uc3Qgc3RvcmVkTGFuZyA9IGF3YWl0IGdsb2JhbF9zdG9yYWdlX3RtLmdldCgibGFuZyIpO1xuICAgICAgaWYgKHN0b3JlZExhbmcgIT09IGxhbmcpIHtcbiAgICAgICAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KCJsYW5nIiwgbGFuZyk7XG4gICAgICB9XG4gICAgICBpZiAoaTE4bikge1xuICAgICAgICBpZiAobGFuZyA9PT0gImF1dG9EZXRlY3QiKSB7XG4gICAgICAgICAgaWYgKG1vZHVsZS5nZXRMYW5nKSB7XG4gICAgICAgICAgICBjb25zdCBwYWdlTGFuZyA9IG1vZHVsZS5nZXRMYW5nKCk7XG4gICAgICAgICAgICBpMThuLmNoYW5nZUxhbmd1YWdlKHBhZ2VMYW5nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaTE4bi5jaGFuZ2VMYW5ndWFnZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpMThuLmNoYW5nZUxhbmd1YWdlKGxhbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuX3NldExhbmcobGFuZykpO1xuICAgIH07XG4gIH0sXG4gIHNldEkxOE4oaTE4bikge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfSTE4TiwgdmFsdWU6IGkxOG4gfTtcbiAgfSxcbiAgc2V0RGlyKGRpcikge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfRElSLCB2YWx1ZTogZGlyIH07XG4gIH0sXG4gIGFkZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogYWN0aW9uc1R5cGVzLkFERF9OT1RJRklDQVRJT04sXG4gICAgICB2YWx1ZToge1xuICAgICAgICAuLi5ub3RpZmljYXRpb24sXG4gICAgICAgIGlkOiBNYXRoLnJhbmRvbSgpLFxuICAgICAgfSxcbiAgICB9O1xuICB9LFxuICByZW1vdmVOb3RpZmljYXRpb24oaW5kZXgpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuUkVNT1ZFX05PVElGSUNBVElPTiwgdmFsdWU6IGluZGV4IH07XG4gIH0sXG4gIHNldEhlbHBTdGF0ZShzdGF0ZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfSEVMUF9TVEFURSwgdmFsdWU6IHN0YXRlIH07XG4gIH0sXG4gIHNldFNlbmRFdmVudChzZW5kRXZlbnQpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX1NFTkRfRVZFTlQsIHZhbHVlOiBzZW5kRXZlbnQgfTtcbiAgfSxcbiAgX3NldERvd25sb2Fkc0NvdW50KGNvdW50KSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9ET1dOTE9BRFNfQ09VTlQsIHZhbHVlOiBjb3VudCB9O1xuICB9LFxuICBzeW5jRG93bmxvYWRzOiAoKSA9PiBnZXRTeW5jQWN0aW9uKCJkb3dubG9hZHNDb3VudCIsIDAsIGFjdGlvbnNfYWN0aW9ucy5fc2V0RG93bmxvYWRzQ291bnQpLFxuICBpbmNyZW1lbnREb3dubG9hZHMoKSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHtcbiAgICAgIGxldCB7IGRvd25sb2Fkc0NvdW50IH0gPSBnZXRTdGF0ZSgpO1xuICAgICAgZG93bmxvYWRzQ291bnQrKztcbiAgICAgIGdsb2JhbF9zdG9yYWdlX3RtLnNldCgiZG93bmxvYWRzQ291bnQiLCBkb3dubG9hZHNDb3VudCk7XG4gICAgICBkaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuX3NldERvd25sb2Fkc0NvdW50KGRvd25sb2Fkc0NvdW50KSk7XG4gICAgfTtcbiAgfSxcbiAgX3NldERpc3BsYXlRckNvZGVzKHZhbHVlKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9ESVNQTEFZX1FSX0NPREVTLCB2YWx1ZSB9O1xuICB9LFxuICBzeW5jRGlzcGxheVFyQ29kZXM6XG4gICAgKCkgPT4gZ2V0U3luY0FjdGlvbigiZGlzcGxheVFyQ29kZXMiLCB0cnVlLCBhY3Rpb25zX2FjdGlvbnMuX3NldERpc3BsYXlRckNvZGVzKSxcbiAgc2V0RGlzcGxheVFyQ29kZXModmFsdWUpIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKGRpc3BhdGNoKSB7XG4gICAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQoImRpc3BsYXlRckNvZGVzIiwgdmFsdWUpO1xuICAgICAgZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLl9zZXREaXNwbGF5UXJDb2Rlcyh2YWx1ZSkpO1xuICAgIH07XG4gIH0sXG4gIF9zZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCh2YWx1ZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfU0hPV19GT1JNQVRTX0FWQUlMQUJMRV9WSUFfVURMLCB2YWx1ZSB9O1xuICB9LFxuICBzeW5jU2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREw6XG4gICAgKCkgPT4gZ2V0U3luY0FjdGlvbigic2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwiLCB0cnVlLCBhY3Rpb25zX2FjdGlvbnMuX3NldFNob3dGb3JtYXRzQXZhaWxhYmxlVmlhVURMKSxcbiAgc2V0U2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwodmFsdWUpIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKGRpc3BhdGNoKSB7XG4gICAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQoInNob3dGb3JtYXRzQXZhaWxhYmxlVmlhVURMIiwgdmFsdWUpO1xuICAgICAgZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLl9zZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCh2YWx1ZSkpO1xuICAgIH07XG4gIH0sXG4gIF9zZXRTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbih2YWx1ZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfU0hPV19GT1JNQVRTX1JFUVVJUkVEX09OTElORV9DT05WRVJTSU9OLCB2YWx1ZSB9O1xuICB9LFxuICBzeW5jU2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb246XG4gICAgKCkgPT4gZ2V0U3luY0FjdGlvbigic2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24iLCB0cnVlLCBhY3Rpb25zX2FjdGlvbnMuX3NldFNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uKSxcbiAgc2V0U2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24odmFsdWUpIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKGRpc3BhdGNoKSB7XG4gICAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQoInNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uIiwgdmFsdWUpO1xuICAgICAgZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLl9zZXRTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbih2YWx1ZSkpO1xuICAgIH07XG4gIH0sXG4gIF9zZXRXYXJuQmVmb3JlQ29udmVydGluZyh2YWx1ZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfV0FSTl9CRUZPUkVfQ09OVkVSVElORywgdmFsdWUgfTtcbiAgfSxcbiAgc3luY1dhcm5CZWZvcmVDb252ZXJ0aW5nOlxuICAgICgpID0+IGdldFN5bmNBY3Rpb24oIndhcm5CZWZvcmVDb252ZXJ0aW5nIiwgdHJ1ZSwgYWN0aW9uc19hY3Rpb25zLl9zZXRXYXJuQmVmb3JlQ29udmVydGluZyksXG4gIHNldFdhcm5CZWZvcmVDb252ZXJ0aW5nKHZhbHVlKSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgICAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KCJ3YXJuQmVmb3JlQ29udmVydGluZyIsIHZhbHVlKTtcbiAgICAgIGRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5fc2V0V2FybkJlZm9yZUNvbnZlcnRpbmcodmFsdWUpKTtcbiAgICB9O1xuICB9LFxuICBfc2V0V2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX1dBUk5fQUJPVVRfQ09NUEVUSVRPUlNfREVURUNUSU9OLCB2YWx1ZSB9O1xuICB9LFxuICBzeW5jV2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb246XG4gICAgKCkgPT4gZ2V0U3luY0FjdGlvbigid2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24iLCB0cnVlLCBhY3Rpb25zX2FjdGlvbnMuX3NldFdhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uKSxcbiAgc2V0V2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKGRpc3BhdGNoKSB7XG4gICAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQoIndhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uIiwgdmFsdWUpO1xuICAgICAgZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLl9zZXRXYXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbih2YWx1ZSkpO1xuICAgIH07XG4gIH0sXG4gIF9zZXRTaG93U25hcHNob3RCdXR0b24odmFsdWUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBhY3Rpb25zVHlwZXMuU0VUX1NIT1dfU05BUFNIT1RfQlVUVE9OLCB2YWx1ZSB9O1xuICB9LFxuICBzeW5jU2hvd1NuYXBzaG90QnV0dG9uOlxuICAgICgpID0+IGdldFN5bmNBY3Rpb24oInNob3dTbmFwc2hvdEJ1dHRvbiIsIHRydWUsIGFjdGlvbnNfYWN0aW9ucy5fc2V0U2hvd1NuYXBzaG90QnV0dG9uKSxcbiAgc2V0U2hvd1NuYXBzaG90QnV0dG9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgICAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KCJzaG93U25hcHNob3RCdXR0b24iLCB2YWx1ZSk7XG4gICAgICBkaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuX3NldFNob3dTbmFwc2hvdEJ1dHRvbih2YWx1ZSkpO1xuICAgIH07XG4gIH0sXG4gIF9zZXRBcHBCdXR0b25TdHlsZSh2YWx1ZSkge1xuICAgIHJldHVybiB7IHR5cGU6IGFjdGlvbnNUeXBlcy5TRVRfQVBQX0JVVFRPTl9TVFlMRSwgdmFsdWUgfTtcbiAgfSxcbiAgc3luY0FwcEJ1dHRvblN0eWxlOlxuICAgICgpID0+IGdldFN5bmNBY3Rpb24oImFwcEJ1dHRvblN0eWxlIiwgIlNvbGlkIiwgYWN0aW9uc19hY3Rpb25zLl9zZXRBcHBCdXR0b25TdHlsZSksXG4gIHNldEFwcEJ1dHRvblN0eWxlKHZhbHVlKSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChkaXNwYXRjaCkge1xuICAgICAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KCJhcHBCdXR0b25TdHlsZSIsIHZhbHVlKTtcbiAgICAgIGRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5fc2V0QXBwQnV0dG9uU3R5bGUodmFsdWUpKTtcbiAgICB9O1xuICB9LFxufTtcblxuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9zdG9yZS9hY3Rpb25zLXRtLmpzXG5cblxuXG5hY3Rpb25zVHlwZXMuU0VUX0xPQURfWUFOREVYX01BUktFVF9BRFZJU0VSID0gIlNFVF9MT0FEX1lBTkRFWF9NQVJLRVRfQURWSVNFUiI7XG5cbmFjdGlvbnNfYWN0aW9ucy5fc2V0TG9hZFlhbmRleE1hcmtldEFkdmlzZXIgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgcmV0dXJuIHsgdHlwZTogYWN0aW9uc1R5cGVzLlNFVF9MT0FEX1lBTkRFWF9NQVJLRVRfQURWSVNFUiwgdmFsdWUgfTtcbn07XG5hY3Rpb25zX2FjdGlvbnMuc3luY0xvYWRZYW5kZXhNYXJrZXRBZHZpc2VyID1cbiAgICAoKSA9PiBnZXRTeW5jQWN0aW9uKCJsb2FkWWFuZGV4TWFya2V0QWR2aXNlciIsIHRydWUsIGFjdGlvbnNfYWN0aW9ucy5fc2V0TG9hZFlhbmRleE1hcmtldEFkdmlzZXIpO1xuYWN0aW9uc19hY3Rpb25zLnNldExvYWRZYW5kZXhNYXJrZXRBZHZpc2VyID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiAoZGlzcGF0Y2gpIHtcbiAgICBnbG9iYWxfc3RvcmFnZV90bS5zZXQoImxvYWRZYW5kZXhNYXJrZXRBZHZpc2VyIiwgdmFsdWUpO1xuICAgIGRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5fc2V0TG9hZFlhbmRleE1hcmtldEFkdmlzZXIodmFsdWUpKTtcbiAgfTtcbn07XG5cblxuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvc3RvcmUvcmVkdWNlcnMuanNcblxuXG5jb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gIHN0YXR1czogImdldHRpbmdJbmZvIixcbiAgdmlkZW86IDAsXG4gIGF1ZGlvOiAwLFxuICBtdXhpbmc6IDAsXG4gIGRvd25sb2Fkc0NvdW50OiAwLFxuICBub3RpZmljYXRpb25zOiBbXSxcbn07XG5cbmNvbnN0IHJlZHVjZXJzX2hhbmRsZXJzID0ge1xuICBbYWN0aW9uc1R5cGVzLlNFVF9TVEFUVVNdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHN0YXR1czogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9USVRMRV06IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgdGl0bGU6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfUFJPR1JFU1NdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHByb2dyZXNzOiB7IC4uLnN0YXRlLnByb2dyZXNzLCAuLi5hY3Rpb24udmFsdWUgfSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5SRVNFVF9QUk9HUkVTU106IHN0YXRlID0+ICh7IC4uLnN0YXRlLCBwcm9ncmVzczoge30gfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX1NFUlZJQ0VdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHNlcnZpY2VOYW1lOiBhY3Rpb24udmFsdWUgfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX1ZJREVPX0lORk9dOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHZpZGVvSW5mbzogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9BVURJT19JTkZPXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBhdWRpb0luZm86IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfU1RSRUFNX0lORk9dOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHN0cmVhbUluZm86IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfREVGQVVMVF9JVEVNXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBkZWZhdWx0SXRlbTogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9NT0RVTEVdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIG1vZHVsZTogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9DT05URU5UX0xJTUlUXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBjb250ZW50TGltaXQ6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfQ0FOQ0VMXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBjYW5jZWw6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfVEhFTUVdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHRoZW1lOiBhY3Rpb24udmFsdWUgfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX0xBTkddOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIGxhbmc6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfSTE4Tl06IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgaTE4bjogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9ESVJdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIGRpcjogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLkFERF9OT1RJRklDQVRJT05dOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIG5vdGlmaWNhdGlvbnM6IFthY3Rpb24udmFsdWUsIC4uLnN0YXRlLm5vdGlmaWNhdGlvbnNdIH0pLFxuICBbYWN0aW9uc1R5cGVzLlJFTU9WRV9OT1RJRklDQVRJT05dOlxuICAgIChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgbm90aWZpY2F0aW9uczogc3RhdGUubm90aWZpY2F0aW9ucy5maWx0ZXIoKG5vdGlmLCBpbmRleCkgPT4gaW5kZXggIT09IGFjdGlvbi52YWx1ZSkgfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX0hFTFBfU1RBVEVdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIGhlbHBTdGF0ZTogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9TRU5EX0VWRU5UXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBzZW5kRXZlbnQ6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfRE9XTkxPQURTX0NPVU5UXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBkb3dubG9hZHNDb3VudDogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9ESVNQTEFZX1FSX0NPREVTXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBkaXNwbGF5UXJDb2RlczogYWN0aW9uLnZhbHVlIH0pLFxuICBbYWN0aW9uc1R5cGVzLlNFVF9TSE9XX0ZPUk1BVFNfQVZBSUxBQkxFX1ZJQV9VRExdOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHNob3dGb3JtYXRzQXZhaWxhYmxlVmlhVURMOiBhY3Rpb24udmFsdWUgfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX1NIT1dfRk9STUFUU19SRVFVSVJFRF9PTkxJTkVfQ09OVkVSU0lPTl06IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb246IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfV0FSTl9CRUZPUkVfQ09OVkVSVElOR106IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgd2FybkJlZm9yZUNvbnZlcnRpbmc6IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfV0FSTl9BQk9VVF9DT01QRVRJVE9SU19ERVRFQ1RJT05dOiAoc3RhdGUsIGFjdGlvbikgPT4gKHsgLi4uc3RhdGUsIHdhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uOiBhY3Rpb24udmFsdWUgfSksXG4gIFthY3Rpb25zVHlwZXMuU0VUX1NIT1dfU05BUFNIT1RfQlVUVE9OXTogKHN0YXRlLCBhY3Rpb24pID0+ICh7IC4uLnN0YXRlLCBzaG93U25hcHNob3RCdXR0b246IGFjdGlvbi52YWx1ZSB9KSxcbiAgW2FjdGlvbnNUeXBlcy5TRVRfQVBQX0JVVFRPTl9TVFlMRV06IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgYXBwQnV0dG9uU3R5bGU6IGFjdGlvbi52YWx1ZSB9KSxcbn07XG5cbmNvbnN0IGdldFJlZHVjZXIgPSBmdW5jdGlvbiAocmVkdWNlcnMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChzdGF0ZSwgYWN0aW9uKSB7XG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gInVuZGVmaW5lZCIpIHtcbiAgICAgIHJldHVybiBpbml0aWFsU3RhdGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjdGlvbi50eXBlIGluIHJlZHVjZXJzID8gcmVkdWNlcnNbYWN0aW9uLnR5cGVdKHN0YXRlLCBhY3Rpb24pIDogc3RhdGU7XG4gIH07XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciByZWR1Y2VycyA9IChnZXRSZWR1Y2VyKHJlZHVjZXJzX2hhbmRsZXJzKSk7XG5cblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L3N0b3JlL3JlZHVjZXJzLXRtLmpzXG5cblxuXG5yZWR1Y2Vyc19oYW5kbGVyc1thY3Rpb25zVHlwZXMuU0VUX0xPQURfWUFOREVYX01BUktFVF9BRFZJU0VSXSA9IChzdGF0ZSwgYWN0aW9uKSA9PiAoeyAuLi5zdGF0ZSwgbG9hZFlhbmRleE1hcmtldEFkdmlzZXI6IGFjdGlvbi52YWx1ZSB9KTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmVkdWNlcnNfdG0gPSAoZ2V0UmVkdWNlcihyZWR1Y2Vyc19oYW5kbGVycykpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9zdG9yZS9nZXQtb2JzZXJ2ZXJzLmpzXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBnZXRfb2JzZXJ2ZXJzID0gKChzdG9yZSwgYWN0aW9ucykgPT4gKHtcbiAgZG93bmxvYWRzQ291bnQ6ICgpID0+IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc3luY0Rvd25sb2FkcygpKSxcbiAgZGlzcGxheVFyQ29kZXM6ICgpID0+IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc3luY0Rpc3BsYXlRckNvZGVzKCkpLFxuICBzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETDogKCkgPT4gc3RvcmUuZGlzcGF0Y2goYWN0aW9ucy5zeW5jU2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwoKSksXG4gIHNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uOiAoKSA9PiBzdG9yZS5kaXNwYXRjaChhY3Rpb25zLnN5bmNTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbigpKSxcbiAgd2FybkJlZm9yZUNvbnZlcnRpbmc6ICgpID0+IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc3luY1dhcm5CZWZvcmVDb252ZXJ0aW5nKCkpLFxuICB3YXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbjogKCkgPT4gc3RvcmUuZGlzcGF0Y2goYWN0aW9ucy5zeW5jV2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24oKSksXG4gIHNob3dTbmFwc2hvdEJ1dHRvbjogKCkgPT4gc3RvcmUuZGlzcGF0Y2goYWN0aW9ucy5zeW5jU2hvd1NuYXBzaG90QnV0dG9uKCkpLFxuICBhcHBCdXR0b25TdHlsZTogKCkgPT4gc3RvcmUuZGlzcGF0Y2goYWN0aW9ucy5zeW5jQXBwQnV0dG9uU3R5bGUoKSksXG4gIGxhbmc6ICgpID0+IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc3luY0xhbmcoKSksXG59KSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9zdG9yZS9nZXQtb2JzZXJ2ZXJzLXRtLmpzXG5cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZ2V0X29ic2VydmVyc190bSA9ICgoc3RvcmUsIGFjdGlvbnMpID0+IHtcbiAgY29uc3Qgb2JzZXJ2ZXJzID0gZ2V0X29ic2VydmVycyhzdG9yZSwgYWN0aW9ucyk7XG4gIG9ic2VydmVycy5sb2FkWWFuZGV4TWFya2V0QWR2aXNlciA9ICgpID0+IHN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc3luY0xvYWRZYW5kZXhNYXJrZXRBZHZpc2VyKCkpO1xuICByZXR1cm4gb2JzZXJ2ZXJzO1xufSk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL3BsYXktdmlkZW8uanN4XG5cblxuY29uc3QgSWNvblBsYXlWaWRlbyA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMTVweCIsXG4gIGhlaWdodDogIjE1cHgiLFxuICB2aWV3Qm94OiAiMCAwIDE1IDE1IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0wLjksMGgxMy4xYzAuMiwwLDAuNCwwLjEsMC42LDAuMkMxNC44LDAuNCwxNSwwLjcsMTUsMC45djEzLjFjMCwgMC4yLTAuMSwwLjUtMC4zLDAuN1MxNC4zLDE1LDE0LjEsMTVIMC45Yy0wLjMsIDAtMC43LTAuMi0wLjgtMC41YzAtMC4xLTAuMS0wLjMtMC4xLTAuNVYwLjljMC0wLjMsMC4xLTAuNSwwLjMtMC43UzAuNywgMCwwLjksMCBNMC45LDFjMCwwLjgsMCwxLjUsMCwyLjNjMC43LDAsMS4yLDAsMS45LDBjMC0wLjgsMC0xLjYsIDAtMi4zQzIuMywwLjksMS42LDAuOSwwLjksMUMwLjksMC45LDAuOSwxLDAuOSwxTTMuOCwwLjljMCwgNC40LDAsOC43LDAsMTMuMWMyLjUsMCw1LDAsNy41LDBjMC00LjQsMC04LjcsMC0xMy4xQzguNywwLjksNi4zLDAuOSwgMy44LDAuOSBNMTIuMiwwLjljMCwwLjgsMCwxLjYsMCwyLjNjMC43LDAsMS4yLDAsMS45LDBjMC0wLjgsMC0xLjUsIDAtMi4zYzAtMC4xLDAtMC4xLTAuMS0wLjFDMTMuNCwwLjksMTIuOCwwLjksMTIuMiwwLjkgTTAuOSw0LjJjMCwwLjksIDAsMS45LDAsMi44YzAuNywwLDEuMiwwLDEuOSwwYzAtMC45LDAtMS45LDAtMi44QzIuMiw0LjIsMS42LDQuMiwwLjksIDQuMiBNMTIuMiw0LjJjMCwwLjksMCwxLjksMCwyLjhjMC43LDAsMS4yLDAsMS45LDBjMC0wLjksMC0xLjksIDAtMi44QzEzLjQsNC4yLDEyLjgsNC4yLDEyLjIsNC4yIE0wLjksOGMwLDAuOSwwLDEuOSwwLDIuOGMwLjcsMCwxLjIsIDAsMS45LDBjMC0wLjksMC0xLjksMC0yLjhDMi4yLDgsMS42LDgsMC45LDggTTEyLjIsOGMwLDAuOSwwLDEuOSwwLCAyLjhjMC43LDAsMS4yLDAsMS45LDBjMC0wLjksMC0xLjksMC0yLjhDMTMuNCw4LDEyLjgsOCwxMi4yLDhNMC45LCAxMS43YzAsMC44LDAsMS41LDAsMi4zYzAsMCwwLDAuMSwwLjEsMC4xYzAuNiwwLDEuMiwwLDEuOCwwYzAtMC44LDAtMS42LCAwLTIuM0MyLjIsMTEuNywxLjYsMTEuNywwLjksMTEuNyBNMTIuMiwxMS43YzAsMC44LDAsMS42LDAsMi4zYzAuNiwgMCwxLjIsMCwxLjgsMGMwLjEsMCwwLjEtMC4xLDAuMS0wLjFjMC0wLjgsMC0xLjUsMC0yLjNDMTMuNCwxMS43LCAxMi44LDExLjcsMTIuMiwxMS43eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTYuMiw0LjNjMC4zLDAsMC42LDAuMSwwLjgsMC4yQzgsNS4yLDguOSw1LjksOS44LDYuNmMwLjMsMC4yLDAuNSwgMC41LDAuNSwwLjhjMC4xLDAuMywwLDAuNy0wLjIsMC44QzEwLDguMyw5LjgsOC40LDkuOCw4LjRjLTAuOCwwLjctMS43LCAxLjItMi41LDEuOWMtMC4yLDAuMS0wLjQsMC4zLTAuNiwwLjRjLTAuNCwwLjEtMC44LCAwLjEtMS0wLjFjLTAuMy0wLjItMC41LTAuNC0wLjUtMC43YzAtMC4yLDAtMC4zLDAtMC41YzAtMS4zLDAtMi42LCAwLTMuOWMwLTAuMiwwLjEtMC40LDAuMi0wLjZDNS41LDQuNSw1LjgsNC4zLDYuMiw0LjMgTTYuMiw1LjNjLTAuMSwwLTAuMSwgMC4xLTAuMSwwLjJjMCwxLjQsMCwyLjgsMCw0LjFjMCwwLjIsMC4yLDAuMywwLjQsMC4yYzAuOS0wLjcsMS45LTEuMywgMi43LTJjMC4xLTAuMSwwLjItMC4yLDAuMi0wLjNjMC0wLjEsMC0wLjItMC4xLTAuMkM4LjMsNi43LDcuNSw2LDYuNiwgNS4zQzYuNSw1LjMsNi40LDUuMiw2LjIsNS4zeiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcGxheV92aWRlbyA9IChJY29uUGxheVZpZGVvKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL3NvdW5kLW9uLmpzeFxuXG5cbmNvbnN0IEljb25Tb3VuZE9uID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNXB4IixcbiAgaGVpZ2h0OiAiMTQuOHB4IixcbiAgdmlld0JveDogIjAgMCAxNSAxNC44IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0wLjQsMTAuNWgzLjRMOSwxNC45QzkuMSwxNSw5LjMsMTUsOS41LDE0LjljMC4yLTAuMSwwLjMtMC4yLCAwLjMtMC40VjAuNGMwLTAuMi0wLjEtMC4zLTAuMy0wLjRDOS4zLTAuMSw5LjEtMC4xLDksMC4xTDMuOCwgNC40SDAuNEMwLjIsNC40LDAsNC42LDAsNC44djUuM0MwLDEwLjMsMC4yLDEwLjUsMC40LDEwLjVMMC40LCAxMC41eiBNOC44LDEzLjZMNC40LDkuOVY1bDQuNS0zLjdWMTMuNnogTTAuOSw1LjNoMi42djQuNEgwLjlWNS4zeiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTEyLjcsMTEuNWMwLjIsMC4yLDAuNSwwLjIsMC42LDBjMi4yLTIuMiwyLjItNS45LCAwLTguMWMtMC4yLTAuMi0wLjUtMC4yLTAuNiwwYy0wLjIsMC4yLTAuMiwwLjUsMCwwLjZjMS45LDEuOSwxLjksIDUsMCw2LjhDMTIuNSwxMSwxMi41LDExLjMsMTIuNywxMS41eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTEwLjgsOS42YzAuMiwwLjIsMC41LDAuMiwwLjYsMGMxLjItMS4yLDEuMi0zLjIsIDAtNC40Yy0wLjItMC4yLTAuNS0wLjItMC42LDBjLTAuMiwwLjItMC4yLDAuNSwwLDAuNmMwLjksMC45LDAuOSwgMi4zLDAsMy4xQzEwLjcsOS4yLDEwLjcsOS41LDEwLjgsOS42eiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgc291bmRfb24gPSAoSWNvblNvdW5kT24pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcmVzb2x1dGlvbi04ay5qc3hcblxuXG5jb25zdCBJY29uUmVzb2x1dGlvbjhrID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMTNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjEgMTMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTSAyMC43NSAxMi43NSBRIDIxIDEyLjUgMjEgMTIuMDUgTCAyMSAwLjk1IFEgMjEgMC41IDIwLjc1IDAuMjUgMjAuNSAwIDIwLjE1IDAgTCAwLjg1IDAgUSAwLjUgMCAwLjI1IDAuMjUgMCAwLjUgMCAwLjk1IEwgMCAxMi4wNSBRIDAgMTIuNSAwLjI1IDEyLjc1IDAuNSAxMyAwLjg1IDEzIEwgMjAuMTUgMTMgUSAyMC41IDEzIDIwLjc1IDEyLjc1IE0gMjAuMTUgMC44NSBMIDIwLjE1IDEyLjE1IDAuODUgMTIuMTUgMC44NSAwLjg1IDIwLjE1IDAuODUgTSA5IDQuNCBRIDguOTUgMi4zIDYgMi4zIDMuMDUgMi4zIDIuOTUgNC41IDIuOTUgNS42NSA0LjUgNi4zIDMuNSA2LjcgMy4xNSA3LjI1IDIuNzUgNy44IDIuOCA4LjcgMi44NSA5LjQ1IDMuNzUgMTAuMSA0LjcgMTAuNyA2IDEwLjcgOS4wNSAxMC43IDkuMiA4LjE1IDkuMjUgNy4zNSA4LjYgNi43NSA4LjI1IDYuNDUgNy41IDYuMDUgOSA1LjYgOSA0LjQgTSA3LjIgNC4xNSBRIDcuMzUgNC43IDYuNzUgNS42NSA1Ljc1IDUuNCA1LjM1IDUuMSA0LjY1IDQuNiA0Ljg1IDQuMSA1LjA1IDMuNiA2IDMuNTUgNy4wNSAzLjUgNy4yIDQuMTUgTSA3LjI1IDguMTUgUSA3LjQgOS4yNSA1Ljc1IDkuMyA0LjggOS4zNSA0LjU1IDguNDUgNC4yNSA3LjUgNS4yNSA2LjU1IDcuMDUgNy4xIDcuMjUgOC4xNSBNIDE4LjEgMi41NSBMIDE1Ljk1IDIuNTUgMTMgNi4xNSAxMyAyLjU1IDExLjE1IDIuNTUgMTEuMTUgMTAuMjUgMTMgMTAuMjUgMTMgNy45IDEzLjYgNy4yIDE2LjEgMTAuMjUgMTguMjUgMTAuMjUgMTUgNi4zIDE4LjEgMi41NSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciByZXNvbHV0aW9uXzhrID0gKEljb25SZXNvbHV0aW9uOGspO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcmVzb2x1dGlvbi00ay5qc3hcblxuXG5jb25zdCBJY29uUmVzb2x1dGlvbjRrID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMTNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjEgMTMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTSAyMC43NSAxMi43NSBRIDIxIDEyLjUgMjEgMTIuMDUgTCAyMSAwLjk1IFEgMjEgMC41IDIwLjc1IDAuMjUgMjAuNSAwIDIwLjE1IDAgTCAwLjg1IDAgUSAwLjUgMCAwLjI1IDAuMjUgMCAwLjUgMCAwLjk1IEwgMCAxMi4wNSBRIDAgMTIuNSAwLjI1IDEyLjc1IDAuNSAxMyAwLjg1IDEzIEwgMjAuMTUgMTMgUSAyMC41IDEzIDIwLjc1IDEyLjc1IE0gMjAuMTUgMC44NSBMIDIwLjE1IDEyLjE1IDAuODUgMTIuMTUgMC44NSAwLjg1IDIwLjE1IDAuODUgTSA4LjQgMi41NSBMIDYuNTUgMi41NSAyLjcgNy4yNSAyLjcgOC40NSA2LjU1IDguNDUgNi41NSAxMC4yNSA4LjQgMTAuMjUgOC40IDguNDUgOS4zNSA4LjQ1IDkuMzUgNy4yNSA4LjQgNy4yNSA4LjQgMi41NSBNIDQuMDUgNy4yNSBMIDYuNTUgNC4xIDYuNTUgNy4yNSA0LjA1IDcuMjUgTSAxOC4xIDIuNTUgTCAxNS45NSAyLjU1IDEzIDYuMTUgMTMgMi41NSAxMS4xNSAyLjU1IDExLjE1IDEwLjI1IDEzIDEwLjI1IDEzIDcuOSAxMy42IDcuMiAxNi4xIDEwLjI1IDE4LjI1IDEwLjI1IDE1IDYuMyAxOC4xIDIuNTUgWiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmVzb2x1dGlvbl80ayA9IChJY29uUmVzb2x1dGlvbjRrKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL3Jlc29sdXRpb24tMmsuanN4XG5cblxuY29uc3QgSWNvblJlc29sdXRpb24yayA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjFweCIsXG4gIGhlaWdodDogIjEzcHgiLFxuICB2aWV3Qm94OiAiMCAwIDIxIDEzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0gMjAuNzUgMTIuNzUgUSAyMSAxMi41IDIxIDEyLjA1IEwgMjEgMC45NSBRIDIxIDAuNSAyMC43NSAwLjI1IDIwLjUgMCAyMC4xNSAwIEwgMC44NSAwIFEgMC41IDAgMC4yNSAwLjI1IDAgMC41IDAgMC45NSBMIDAgMTIuMDUgUSAwIDEyLjUgMC4yNSAxMi43NSAwLjUgMTMgMC44NSAxMyBMIDIwLjE1IDEzIFEgMjAuNSAxMyAyMC43NSAxMi43NSBNIDIwLjE1IDAuODUgTCAyMC4xNSAxMi4xNSAwLjg1IDEyLjE1IDAuODUgMC44NSAyMC4xNSAwLjg1IE0gNS41NSAzLjcgUSA2LjM1IDMuNjUgNi44NSA0LjQgNy4yIDQuOTUgNy4wNSA1LjQ1IDYuODUgNi4wNSA1Ljg1IDcgTCAzLjI1IDkuMSAzLjI1IDEwLjI1IDkuMjUgMTAuMjUgOS4yNSA4Ljk1IDUuNzUgOC45IFEgNy4yNSA3LjcgNy43NSA3LjE1IDguNDUgNi40NSA4LjcgNS43NSA5LjE1MTU2MjUgNC4zOTgyNDIxODc1IDguNiAzLjQgOC4wNDQ5MjE4NzUgMi40NTQ2ODc1IDYuMyAyLjM1IDQuOCAyLjMgMy40NSAyLjg1IEwgMy40NSA0LjQ1IFEgNC44IDMuNyA1LjU1IDMuNyBNIDE4LjEgMi41NSBMIDE1Ljk1IDIuNTUgMTMgNi4xNSAxMyAyLjU1IDExLjE1IDIuNTUgMTEuMTUgMTAuMjUgMTMgMTAuMjUgMTMgNy45IDEzLjYgNy4yIDE2LjEgMTAuMjUgMTguMjUgMTAuMjUgMTUgNi4zIDE4LjEgMi41NSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciByZXNvbHV0aW9uXzJrID0gKEljb25SZXNvbHV0aW9uMmspO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcmVzb2x1dGlvbi1maGQuanN4XG5cblxuY29uc3QgSWNvblJlc29sdXRpb25GaGQgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjI5cHgiLFxuICBoZWlnaHQ6ICIxM3B4IixcbiAgdmlld0JveDogIjAgMCAyOSAxMyIsXG4gIHN0eWxlOiBzdHlsZSxcbiAgY2xhc3NOYW1lOiBjbGFzc05hbWVcbn0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNIDI4Ljc1IDAuMjUgUSAyOC41IDAgMjguMTUgMCBMIDAuODUgMCBRIDAuNSAwIDAuMjUgMC4yNSAwIDAuNSAwIDAuOTUgTCAwIDEyLjA1IFEgMCAxMi41IDAuMjUgMTIuNzUgMC41IDEzIDAuODUgMTMgTCAyOC4xNSAxMyBRIDI4LjUgMTMgMjguNzUgMTIuNzUgMjkgMTIuNSAyOSAxMi4wNSBMIDI5IDAuOTUgUSAyOSAwLjUgMjguNzUgMC4yNSBNIDI4LjE1IDAuODUgTCAyOC4xNSAxMi4xNSAwLjg1IDEyLjE1IDAuODUgMC44NSAyOC4xNSAwLjg1IE0gNy45NSA0IEwgNy45NSAyLjcgMi42NSAyLjcgMi42NSAxMC4zNSA0LjUgMTAuMzUgNC41IDYuODUgNy43IDYuODUgNy43IDUuNTUgNC41IDUuNTUgNC41IDQgNy45NSA0IE0gMTQuOTUgNS41NSBMIDExLjc1IDUuNTUgMTEuNzUgMi43IDkuOSAyLjcgOS45IDEwLjM1IDExLjc1IDEwLjM1IDExLjc1IDYuODUgMTQuOTUgNi44NSAxNC45NSAxMC4zNSAxNi44IDEwLjM1IDE2LjggMi43IDE0Ljk1IDIuNyAxNC45NSA1LjU1IE0gMjUuMjUgMy42IFEgMjQuMjUgMi43NSAyMi45NSAyLjcgTCAxOS4yNSAyLjcgMTkuMjUgMTAuMyAyMi45NSAxMC4zIFEgMjQuMjUgMTAuMjUgMjUuMjUgOS40IDI2LjM1IDguNCAyNi40IDYuNSAyNi4zNSA0LjYgMjUuMjUgMy42IE0gMjEuMSA0IFEgMjMuMSAzLjk1IDIzLjkgNC41NSAyNC42IDUuMSAyNC41NSA2LjUgMjQuNiA3LjkgMjMuOSA4LjQ1IDIzLjEgOS4wNSAyMS4xIDkgTCAyMS4xIDQgWiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmVzb2x1dGlvbl9maGQgPSAoSWNvblJlc29sdXRpb25GaGQpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcmVzb2x1dGlvbi1oZC5qc3hcblxuXG5jb25zdCBJY29uUmVzb2x1dGlvbkhkID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMTNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjEgMTMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTSAyMC43NSAxMi43NSBRIDIxIDEyLjUgMjEgMTIuMDUgTCAyMSAwLjk1IFEgMjEgMC41IDIwLjc1IDAuMjUgMjAuNSAwIDIwLjE1IDAgTCAwLjg1IDAgUSAwLjUgMCAwLjI1IDAuMjUgMCAwLjUgMCAwLjk1IEwgMCAxMi4wNSBRIDAgMTIuNSAwLjI1IDEyLjc1IDAuNSAxMyAwLjg1IDEzIEwgMjAuMTUgMTMgUSAyMC41IDEzIDIwLjc1IDEyLjc1IE0gMjAuMTUgMC44NSBMIDIwLjE1IDEyLjE1IDAuODUgMTIuMTUgMC44NSAwLjg1IDIwLjE1IDAuODUgTSA3LjMgMi43IEwgNy4zIDUuNTUgNC4xIDUuNTUgNC4xIDIuNyAyLjI1IDIuNyAyLjI1IDEwLjM1IDQuMSAxMC4zNSA0LjEgNi44NSA3LjMgNi44NSA3LjMgMTAuMzUgOS4xNSAxMC4zNSA5LjE1IDIuNyA3LjMgMi43IE0gMTcuNiAzLjYgUSAxNi42IDIuNzUgMTUuMyAyLjcgTCAxMS42IDIuNyAxMS42IDEwLjMgMTUuMyAxMC4zIFEgMTYuNiAxMC4yNSAxNy42IDkuNCAxOC43IDguNCAxOC43NSA2LjUgMTguNyA0LjYgMTcuNiAzLjYgTSAxNi45IDYuNSBRIDE2Ljk1IDcuOSAxNi4yNSA4LjQ1IDE1LjQ1IDkuMDUgMTMuNDUgOSBMIDEzLjQ1IDQgUSAxNS40NSAzLjk1IDE2LjI1IDQuNTUgMTYuOTUgNS4xIDE2LjkgNi41IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHJlc29sdXRpb25faGQgPSAoSWNvblJlc29sdXRpb25IZCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9mcHMtNjAuanN4XG5cblxuY29uc3QgSWNvbkZwczYwID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMTNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjEgMTMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTSAyMC43NSAxMi43NSBRIDIxIDEyLjUgMjEgMTIuMDUgTCAyMSAwLjk1IFEgMjEgMC41IDIwLjc1IDAuMjUgMjAuNSAwIDIwLjE1IDAgTCAwLjg1IDAgUSAwLjUgMCAwLjI1IDAuMjUgMCAwLjUgMCAwLjk1IEwgMCAxMi4wNSBRIDAgMTIuNSAwLjI1IDEyLjc1IDAuNSAxMyAwLjg1IDEzIEwgMjAuMTUgMTMgUSAyMC41IDEzIDIwLjc1IDEyLjc1IE0gMjAuMTUgMC44NSBMIDIwLjE1IDEyLjE1IDAuODUgMTIuMTUgMC44NSAwLjg1IDIwLjE1IDAuODUgTSA4LjQ1IDUuNSBRIDcuMiA0Ljk1IDUuMyA1Ljc1IDUuNzY1ODIwMzEyNSAzLjEzNTc0MjE4NzUgOS4wNSA0IEwgOS4wNSAyLjYgUSA2LjE1IDIuMyA0Ljg1IDMuNCAzLjcgNC4zNSAzLjU1IDYuNSAzLjM1IDEwLjQ1IDYuNjUgMTAuNSA4IDEwLjU1IDguODUgOS44NSA5Ljc1IDkuMSA5LjcgNy43IDkuNjUgNi4wNSA4LjQ1IDUuNSBNIDUuMjUgNi42NSBMIDUuMjUgNi42IFEgNi4zIDYuMiA3LjEgNi40NSA3Ljg1IDYuNzUgNy45IDcuNSA3Ljk1IDkuMyA2LjU1IDkuMyA1LjI1IDkuMyA1LjI1IDYuNjUgTSAxNC40IDIuNSBRIDEyLjggMi41NSAxMi4xIDMuNSAxMS4zNSA0LjQ1IDExLjQgNi41IDExLjM1IDguNTUgMTIuMSA5LjUgMTIuOCAxMC40NSAxNC40IDEwLjUgMTYgMTAuNDUgMTYuNyA5LjUgMTcuNDUgOC41NSAxNy40IDYuNSAxNy40NSA0LjQ1IDE2LjcgMy41IDE2IDIuNTUgMTQuNCAyLjUgTSAxNC40IDkuMzUgUSAxMy4xNSA5LjQgMTMuMTUgNi40NSAxMy4xNSAzLjY1IDE0LjQgMy42NSAxNS4xNSAzLjY1IDE1LjQ1IDQuNCAxNS42NSA0Ljk1IDE1LjY1IDYuNDUgMTUuNjUgOS4zIDE0LjQgOS4zNSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBmcHNfNjAgPSAoSWNvbkZwczYwKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9oZWxwZXJzL2Zvcm1hdHMtdGFibGUuanN4XG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBnZXRNZWRpYVR5cGUgPSBkYXRhID0+IHtcbiAgY29uc3Qge1xuICAgIG1pbWVUeXBlXG4gIH0gPSBkYXRhO1xuXG4gIGlmIChtaW1lVHlwZSkge1xuICAgIGlmIChtaW1lVHlwZS5pbmNsdWRlcygidmlkZW8iKSkgcmV0dXJuICJ2aWRlbyI7XG4gICAgaWYgKG1pbWVUeXBlLmluY2x1ZGVzKCJhdWRpbyIpKSByZXR1cm4gImF1ZGlvIjtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcbmNvbnN0IGdldEljb25NZWRpYVR5cGUgPSBkYXRhID0+IHtcbiAgY29uc3QgbWVkaWFUeXBlID0gZ2V0TWVkaWFUeXBlKGRhdGEpO1xuICBpZiAobWVkaWFUeXBlID09PSAidmlkZW8iKSByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBsYXlfdmlkZW8sIG51bGwpO1xuICBpZiAobWVkaWFUeXBlID09PSAiYXVkaW8iKSByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHNvdW5kX29uLCBudWxsKTtcbiAgcmV0dXJuIG51bGw7XG59O1xuY29uc3QgZ2V0SWNvblJlc29sdXRpb24gPSBkYXRhID0+IHtcbiAgY29uc3Qge1xuICAgIGhlaWdodFxuICB9ID0gZGF0YTtcbiAgaWYgKGhlaWdodCA+PSA0MzIwKSByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlc29sdXRpb25fOGssIG51bGwpOyAvLyA4a1xuXG4gIGlmIChoZWlnaHQgPj0gMjE2MCkgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZXNvbHV0aW9uXzRrLCBudWxsKTsgLy8gNGtcblxuICBpZiAoaGVpZ2h0ID49IDE0NDApIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVzb2x1dGlvbl8yaywgbnVsbCk7IC8vIDJrXG5cbiAgaWYgKGhlaWdodCA+PSAxMDgwKSByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlc29sdXRpb25fZmhkLCB7XG4gICAgY2xhc3NOYW1lOiAiZmhkIlxuICB9KTsgLy8gZnVsbEhEXG5cbiAgaWYgKGhlaWdodCA+PSA3MjApIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVzb2x1dGlvbl9oZCwgbnVsbCk7IC8vIEhEXG5cbiAgcmV0dXJuIG51bGw7XG59O1xuY29uc3QgZ2V0SWNvbkZyYW1lcmF0ZSA9IGRhdGEgPT4ge1xuICBjb25zdCB7XG4gICAgZnBzXG4gIH0gPSBkYXRhO1xuICBpZiAoZnBzID09PSA2MCkgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChmcHNfNjAsIG51bGwpO1xuICByZXR1cm4gbnVsbDtcbn07XG5jb25zdCBnZXRTaXplID0gZGF0YSA9PiB7XG4gIGNvbnN0IHtcbiAgICBjb250ZW50TGVuZ3RoXG4gIH0gPSBkYXRhO1xuXG4gIGlmIChjb250ZW50TGVuZ3RoKSB7XG4gICAgY29uc3QgYnl0ZXMgPSBjb250ZW50TGVuZ3RoO1xuICAgIGNvbnN0IGsgPSAxMDI0O1xuICAgIGNvbnN0IGRlY2ltYWxzID0gMTtcbiAgICBjb25zdCBzaXplcyA9IFsiYnl0ZXMiLCAiS2IiLCAiTWIiLCAiR2IiLCAiVGIiLCAiUGIiLCAiRWIiLCAiWmIiLCAiWWIiXTtcbiAgICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSk7XG4gICAgcmV0dXJuIGB+ICR7cGFyc2VGbG9hdCgoYnl0ZXMgLyBrICoqIGkpLnRvRml4ZWQoZGVjaW1hbHMpKX0gJHtzaXplc1tpXX1gO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb25zdCBnZXRBdWRpb0V4dCA9IGRhdGEgPT4ge1xuICBjb25zdCB7XG4gICAgbWltZVR5cGVcbiAgfSA9IGRhdGE7XG5cbiAgaWYgKG1pbWVUeXBlKSB7XG4gICAgaWYgKG1pbWVUeXBlLmluY2x1ZGVzKCJhdWRpby9tcDQiKSkgcmV0dXJuICJNUDQiO1xuICAgIGlmIChtaW1lVHlwZS5pbmNsdWRlcygiYXVkaW8vd2VibSIpKSByZXR1cm4gIldFQk0iO1xuICAgIGlmIChtaW1lVHlwZS5pbmNsdWRlcygiYXVkaW8vbXAzIikpIHJldHVybiAiTVAzIjtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxuY29uc3QgZ2V0QXVkaW9CaXRyYXRlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgY29uc3Qge1xuICAgIGJpdHJhdGVcbiAgfSA9IGRhdGE7XG5cbiAgaWYgKGJpdHJhdGUpIHtcbiAgICBjb25zdCByYXRlcyA9IFsxLCA2NCwgMTI4LCAxNjAsIDE5MiwgMjU2LCAzMjBdO1xuICAgIGNvbnN0IGZpbmFsUmF0ZSA9IHJhdGVzLmZpbmQoKHJhdGUsIGkpID0+IHtcbiAgICAgIGlmIChpID09PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoaSA9PT0gcmF0ZXMubGVuZ3RoIC0gMSkgcmV0dXJuIHRydWU7XG4gICAgICBpZiAoYml0cmF0ZSAvIDEwMDAgPD0gcmF0ZXNbaV0pIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICAgIHJldHVybiBmaW5hbFJhdGU7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5jb25zdCBnZXRFeHRUaXRsZSA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gIGlmIChpdGVtLm1pbWVUeXBlLmluY2x1ZGVzKCJhdWRpbyIpKSB7XG4gICAgY29uc3QgYml0cmF0ZSA9IGdldEF1ZGlvQml0cmF0ZShpdGVtKTtcbiAgICByZXR1cm4gYml0cmF0ZSA/IGAke2JpdHJhdGV9a2Jwc2AgOiAiIjtcbiAgfVxuXG4gIGNvbnN0IHRpdGxlID0gL14oWzAtOV0rW2Etel0pLy5leGVjKGl0ZW0ucXVhbGl0eUxhYmVsKVswXTtcbiAgcmV0dXJuIHRpdGxlO1xufTtcbmNvbnN0IGdldFRpdGxlID0gZGF0YSA9PiB7XG4gIGNvbnN0IG1lZGlhVHlwZSA9IGdldE1lZGlhVHlwZShkYXRhKTtcbiAgY29uc3QgdGl0bGUgPSBnZXRFeHRUaXRsZShkYXRhKTtcbiAgaWYgKG1lZGlhVHlwZSA9PT0gInZpZGVvIikgcmV0dXJuIGAke2RhdGEudHlwZSAmJiBkYXRhLnR5cGUudG9VcHBlckNhc2UoKX0gJHt0aXRsZX1gO1xuICBpZiAobWVkaWFUeXBlID09PSAiYXVkaW8iKSByZXR1cm4gYCR7Z2V0QXVkaW9FeHQoZGF0YSl9ICR7dGl0bGV9YDtcbiAgcmV0dXJuIG51bGw7XG59O1xuY29uc3QgZ2V0VGl0bGVFbWJlZCA9IGRhdGEgPT4ge1xuICBjb25zdCBtZWRpYVR5cGUgPSBnZXRNZWRpYVR5cGUoZGF0YSk7XG4gIGNvbnN0IHRpdGxlID0gZ2V0RXh0VGl0bGUoZGF0YSk7XG4gIGlmIChtZWRpYVR5cGUgPT09ICJ2aWRlbyIpIHJldHVybiBgJHtkYXRhLnR5cGUgJiYgZGF0YS50eXBlLnRvTG93ZXJDYXNlKCl9IC0gJHt0aXRsZX1gO1xuICBpZiAobWVkaWFUeXBlID09PSAiYXVkaW8iKSByZXR1cm4gYCR7Z2V0QXVkaW9FeHQoZGF0YSkudG9Mb3dlckNhc2UoKX0gLSAke3RpdGxlfWA7XG4gIHJldHVybiBudWxsO1xufTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9zdG9yZS9nZXQtc2V0dGVycy5qc1xuXG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGdldF9zZXR0ZXJzID0gKChzdGF0ZSwgZGlzcGF0Y2gsIGFjdGlvbnMpID0+ICh7XG4gIGRvd25sb2FkOiBzdGF0ZS5tb2R1bGUuZG93bmxvYWQsXG4gIHNuYXA6IHN0YXRlLm1vZHVsZS5zbmFwLFxuICBzZW5kRXZlbnQ6IHN0YXRlLnNlbmRFdmVudCxcbiAgYnV0dG9uVGl0bGU6IHN0YXRlLmRlZmF1bHRJdGVtID8gZ2V0RXh0VGl0bGUoc3RhdGUuZGVmYXVsdEl0ZW0pIDogIiIsXG4gIHNldERlZmF1bHRJdGVtOiBpdGVtID0+IGRpc3BhdGNoKGFjdGlvbnMuc2V0RGVmYXVsdEl0ZW0oaXRlbSkpLFxuICBzZXREaXNwbGF5UXJDb2RlczogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5zZXREaXNwbGF5UXJDb2Rlcyh2YWx1ZSkpLFxuICBzZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETDogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5zZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCh2YWx1ZSkpLFxuICBzZXRTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbjogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5zZXRTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbih2YWx1ZSkpLFxuICBzZXRXYXJuQmVmb3JlQ29udmVydGluZzogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5zZXRXYXJuQmVmb3JlQ29udmVydGluZyh2YWx1ZSkpLFxuICBzZXRXYXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbjogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5zZXRXYXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbih2YWx1ZSkpLFxuICBzZXRTaG93U25hcHNob3RCdXR0b246IHZhbHVlID0+IGRpc3BhdGNoKGFjdGlvbnMuc2V0U2hvd1NuYXBzaG90QnV0dG9uKHZhbHVlKSksXG4gIHNldEFwcEJ1dHRvblN0eWxlOiB2YWx1ZSA9PiBkaXNwYXRjaChhY3Rpb25zLnNldEFwcEJ1dHRvblN0eWxlKHZhbHVlKSksXG4gIHNldExhbmc6IHZhbHVlID0+IGRpc3BhdGNoKGFjdGlvbnMuc2V0TGFuZyh2YWx1ZSkpLFxuICBhZGROb3RpZmljYXRpb246IHZhbHVlID0+IGRpc3BhdGNoKGFjdGlvbnMuYWRkTm90aWZpY2F0aW9uKHZhbHVlKSksXG4gIHJlbW92ZU5vdGlmaWNhdGlvbjogdmFsdWUgPT4gZGlzcGF0Y2goYWN0aW9ucy5yZW1vdmVOb3RpZmljYXRpb24odmFsdWUpKSxcbn0pKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L3N0b3JlL2dldC1zZXR0ZXJzLXRtLmpzXG5cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZ2V0X3NldHRlcnNfdG0gPSAoKHN0YXRlLCBkaXNwYXRjaCwgYWN0aW9ucykgPT4ge1xuICBjb25zdCBzZXR0ZXJzID0gZ2V0X3NldHRlcnMoc3RhdGUsIGRpc3BhdGNoLCBhY3Rpb25zKTtcbiAgc2V0dGVycy5zZXRMb2FkWWFuZGV4TWFya2V0QWR2aXNlciA9IHZhbHVlID0+IGRpc3BhdGNoKGFjdGlvbnMuc2V0TG9hZFlhbmRleE1hcmtldEFkdmlzZXIodmFsdWUpKTtcbiAgcmV0dXJuIHNldHRlcnM7XG59KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3JuZy5qc1xuLy8gVW5pcXVlIElEIGNyZWF0aW9uIHJlcXVpcmVzIGEgaGlnaCBxdWFsaXR5IHJhbmRvbSAjIGdlbmVyYXRvci4gSW4gdGhlIGJyb3dzZXIgd2UgdGhlcmVmb3JlXG4vLyByZXF1aXJlIHRoZSBjcnlwdG8gQVBJIGFuZCBkbyBub3Qgc3VwcG9ydCBidWlsdC1pbiBmYWxsYmFjayB0byBsb3dlciBxdWFsaXR5IHJhbmRvbSBudW1iZXJcbi8vIGdlbmVyYXRvcnMgKGxpa2UgTWF0aC5yYW5kb20oKSkuXG52YXIgZ2V0UmFuZG9tVmFsdWVzO1xudmFyIHJuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpO1xuZnVuY3Rpb24gcm5nKCkge1xuICAvLyBsYXp5IGxvYWQgc28gdGhhdCBlbnZpcm9ubWVudHMgdGhhdCBuZWVkIHRvIHBvbHlmaWxsIGhhdmUgYSBjaGFuY2UgdG8gZG8gc29cbiAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAvLyBnZXRSYW5kb21WYWx1ZXMgbmVlZHMgdG8gYmUgaW52b2tlZCBpbiBhIGNvbnRleHQgd2hlcmUgInRoaXMiIGlzIGEgQ3J5cHRvIGltcGxlbWVudGF0aW9uLiBBbHNvLFxuICAgIC8vIGZpbmQgdGhlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uIG9mIGNyeXB0byAobXNDcnlwdG8pIG9uIElFMTEuXG4gICAgZ2V0UmFuZG9tVmFsdWVzID0gdHlwZW9mIGNyeXB0byAhPT0gXCd1bmRlZmluZWRcJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pIHx8IHR5cGVvZiBtc0NyeXB0byAhPT0gXCd1bmRlZmluZWRcJyAmJiB0eXBlb2YgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09PSBcJ2Z1bmN0aW9uXCcgJiYgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQobXNDcnlwdG8pO1xuXG4gICAgaWYgKCFnZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkXCcpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBnZXRSYW5kb21WYWx1ZXMocm5kczgpO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3JlZ2V4LmpzXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciByZWdleCA9ICgvXig/OlswLTlhLWZdezh9LVswLTlhLWZdezR9LVsxLTVdWzAtOWEtZl17M30tWzg5YWJdWzAtOWEtZl17M30tWzAtOWEtZl17MTJ9fDAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCkkL2kpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3ZhbGlkYXRlLmpzXG5cblxuZnVuY3Rpb24gdmFsaWRhdGUodXVpZCkge1xuICByZXR1cm4gdHlwZW9mIHV1aWQgPT09IFwnc3RyaW5nXCcgJiYgcmVnZXgudGVzdCh1dWlkKTtcbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZXNtX2Jyb3dzZXJfdmFsaWRhdGUgPSAodmFsaWRhdGUpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3N0cmluZ2lmeS5qc1xuXG4vKipcbiAqIENvbnZlcnQgYXJyYXkgb2YgMTYgYnl0ZSB2YWx1ZXMgdG8gVVVJRCBzdHJpbmcgZm9ybWF0IG9mIHRoZSBmb3JtOlxuICogWFhYWFhYWFgtWFhYWC1YWFhYLVhYWFgtWFhYWFhYWFhYWFhYXG4gKi9cblxudmFyIGJ5dGVUb0hleCA9IFtdO1xuXG5mb3IgKHZhciBzdHJpbmdpZnlfaSA9IDA7IHN0cmluZ2lmeV9pIDwgMjU2OyArK3N0cmluZ2lmeV9pKSB7XG4gIGJ5dGVUb0hleC5wdXNoKChzdHJpbmdpZnlfaSArIDB4MTAwKS50b1N0cmluZygxNikuc3Vic3RyKDEpKTtcbn1cblxuZnVuY3Rpb24gc3RyaW5naWZ5KGFycikge1xuICB2YXIgb2Zmc2V0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwO1xuICAvLyBOb3RlOiBCZSBjYXJlZnVsIGVkaXRpbmcgdGhpcyBjb2RlISAgSXRcJ3MgYmVlbiB0dW5lZCBmb3IgcGVyZm9ybWFuY2VcbiAgLy8gYW5kIHdvcmtzIGluIHdheXMgeW91IG1heSBub3QgZXhwZWN0LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkL3B1bGwvNDM0XG4gIHZhciB1dWlkID0gKGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICsgXCctXCcgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDRdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNV1dICsgXCctXCcgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDZdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgN11dICsgXCctXCcgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICsgXCctXCcgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEwXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDExXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEyXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDEzXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDE0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDE1XV0pLnRvTG93ZXJDYXNlKCk7IC8vIENvbnNpc3RlbmN5IGNoZWNrIGZvciB2YWxpZCBVVUlELiAgSWYgdGhpcyB0aHJvd3MsIGl0XCdzIGxpa2VseSBkdWUgdG8gb25lXG4gIC8vIG9mIHRoZSBmb2xsb3dpbmc6XG4gIC8vIC0gT25lIG9yIG1vcmUgaW5wdXQgYXJyYXkgdmFsdWVzIGRvblwndCBtYXAgdG8gYSBoZXggb2N0ZXQgKGxlYWRpbmcgdG9cbiAgLy8gInVuZGVmaW5lZCIgaW4gdGhlIHV1aWQpXG4gIC8vIC0gSW52YWxpZCBpbnB1dCB2YWx1ZXMgZm9yIHRoZSBSRkMgYHZlcnNpb25gIG9yIGB2YXJpYW50YCBmaWVsZHNcblxuICBpZiAoIWVzbV9icm93c2VyX3ZhbGlkYXRlKHV1aWQpKSB7XG4gICAgdGhyb3cgVHlwZUVycm9yKFwnU3RyaW5naWZpZWQgVVVJRCBpcyBpbnZhbGlkXCcpO1xuICB9XG5cbiAgcmV0dXJuIHV1aWQ7XG59XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGVzbV9icm93c2VyX3N0cmluZ2lmeSA9IChzdHJpbmdpZnkpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdXVpZC9kaXN0L2VzbS1icm93c2VyL3Y0LmpzXG5cblxuXG5mdW5jdGlvbiB2NChvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIHJuZHMgPSBvcHRpb25zLnJhbmRvbSB8fCAob3B0aW9ucy5ybmcgfHwgcm5nKSgpOyAvLyBQZXIgNC40LCBzZXQgYml0cyBmb3IgdmVyc2lvbiBhbmQgYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgXG5cbiAgcm5kc1s2XSA9IHJuZHNbNl0gJiAweDBmIHwgMHg0MDtcbiAgcm5kc1s4XSA9IHJuZHNbOF0gJiAweDNmIHwgMHg4MDsgLy8gQ29weSBieXRlcyB0byBidWZmZXIsIGlmIHByb3ZpZGVkXG5cbiAgaWYgKGJ1Zikge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxNjsgKytpKSB7XG4gICAgICBidWZbb2Zmc2V0ICsgaV0gPSBybmRzW2ldO1xuICAgIH1cblxuICAgIHJldHVybiBidWY7XG4gIH1cblxuICByZXR1cm4gZXNtX2Jyb3dzZXJfc3RyaW5naWZ5KHJuZHMpO1xufVxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBlc21fYnJvd3Nlcl92NCA9ICh2NCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvYW5hbHl0aWNzL2luZGV4LmpzXG5cblxuXG5jb25zdCBnZXRIaWQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGhpZCA9IGF3YWl0IGdsb2JhbF9zdG9yYWdlX3RtLmdldCgiaGlkIik7XG4gIGlmIChoaWQpIHtcbiAgICByZXR1cm4gaGlkO1xuICB9XG4gIGNvbnN0IG5ld0hpZCA9IGVzbV9icm93c2VyX3Y0KCk7XG4gIGdsb2JhbF9zdG9yYWdlX3RtLnNldCgiaGlkIiwgbmV3SGlkKTtcbiAgcmV0dXJuIG5ld0hpZDtcbn07XG5cbmNvbnN0IGZldGNoVXRtID0gYXN5bmMgZnVuY3Rpb24gKGdldFV0bVVybCkge1xuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChnZXRVdG1VcmwsIHsgY3JlZGVudGlhbHM6ICJpbmNsdWRlIiwgbW9kZTogImNvcnMiIH0pO1xuICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKCJmZXRjaGluZyB1dG0gZmFpbGVkIik7XG59O1xuXG5jb25zdCBnZXRVdG0gPSBhc3luYyBmdW5jdGlvbiAoZ2V0VXRtVXJsKSB7XG4gIGxldCB1dG07XG4gIHRyeSB7XG4gICAgY29uc3QgcmF3ID0gYXdhaXQgZ2xvYmFsX3N0b3JhZ2VfdG0uZ2V0KCJ1dG0iKTtcbiAgICBpZiAocmF3KSB7XG4gICAgICB1dG0gPSBKU09OLnBhcnNlKHJhdyk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gIH1cblxuICBpZiAoIXV0bSkge1xuICAgIHRyeSB7XG4gICAgICB1dG0gPSBhd2FpdCBmZXRjaFV0bShnZXRVdG1VcmwpO1xuICAgICAgZ2xvYmFsX3N0b3JhZ2VfdG0uc2V0KCJ1dG0iLCBKU09OLnN0cmluZ2lmeSh1dG0pKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UgKi9cbiAgICAgIHV0bSA9IHtcbiAgICAgICAgdXRtX3NvdXJjZTogIiIsXG4gICAgICAgIHV0bV9tZWRpdW06ICIiLFxuICAgICAgICB1dG1fY2FtcGFpZ246ICIiLFxuICAgICAgICB1dG1fdGVybTogIiIsXG4gICAgICAgIHV0bV9jb250ZW50OiAiIixcbiAgICAgIH07XG4gICAgICAvKiBlc2xpbnQtZW5hYmxlIGNhbWVsY2FzZSAqL1xuICAgIH1cbiAgfVxuICByZXR1cm4gdXRtO1xufTtcblxuY29uc3QgZ2V0U2VuZEV2ZW50ID0gZnVuY3Rpb24gKG9wdGlvbnMsIHN0b3JlKSB7XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGNvbnN0IHsgc2VydmljZU5hbWUsIGRlZmF1bHRJdGVtIH0gPSBzdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgLyogZXNsaW50LWRpc2FibGUgY2FtZWxjYXNlICovXG4gICAgY29uc3Qge1xuICAgICAgdXRtX3NvdXJjZSxcbiAgICAgIHV0bV9tZWRpdW0sXG4gICAgICB1dG1fY2FtcGFpZ24sXG4gICAgICB1dG1fdGVybSxcbiAgICAgIHV0bV9jb250ZW50LFxuICAgIH0gPSBhd2FpdCBnZXRVdG0ob3B0aW9ucy5nZXRVdG1VcmwpO1xuXG4gICAgY29uc3QgZGVmRGF0YSA9IHtcbiAgICAgIHZlcnNpb246IG9wdGlvbnMudmVyc2lvbixcbiAgICAgIHR5cGU6ICJ1ZGwtaGVscGVyIixcbiAgICAgIHByb2plY3Q6IG9wdGlvbnMudHlwZSxcbiAgICAgIGJyYW5jaDogb3B0aW9ucy5icmFuY2gsXG4gICAgICBoaWQ6IGF3YWl0IGdldEhpZCgpLFxuICAgICAgaGFzaDogb3B0aW9ucy5oYXNoLFxuICAgICAgdXRtX3NvdXJjZTogdXRtX3NvdXJjZSB8fCAiIixcbiAgICAgIHV0bV9tZWRpdW06IHV0bV9tZWRpdW0gfHwgIiIsXG4gICAgICB1dG1fY2FtcGFpZ246IHV0bV9jYW1wYWlnbiB8fCAiIixcbiAgICAgIHV0bV90ZXJtOiB1dG1fdGVybSB8fCAiIixcbiAgICAgIHV0bV9jb250ZW50OiB1dG1fY29udGVudCB8fCAiIixcbiAgICAgIHNlcnZpY2U6IHNlcnZpY2VOYW1lLFxuICAgICAgbWVkaWFfc291cmNlOiB3aW5kb3cubG9jYXRpb24uaHJlZixcbiAgICAgIGZvcm1hdDogZGVmYXVsdEl0ZW0gPyBkZWZhdWx0SXRlbS5xdWFsaXR5IDogIiIsXG4gICAgICAvLyBmb3JtYXRfaGlnaDogIk1BWF9RVUFMSVRZIlxuICAgIH07XG4gICAgLyogZXNsaW50LWVuYWJsZSBjYW1lbGNhc2UgKi9cbiAgICB0cnkge1xuICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICB4aHIub3BlbigiUE9TVCIsIG9wdGlvbnMuYW5hbHl0aWNzVXJsLCB0cnVlKTtcbiAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpO1xuICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoeyAuLi5kZWZEYXRhLCAuLi5kYXRhIH0pKTtcbiAgICB9IGNhdGNoIChlKSB7fVxuICB9O1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgYW5hbHl0aWNzID0gKGdldFNlbmRFdmVudCk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9zdG9yZS9pbmRleC5qc1xuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBzdG9yZV9zdG9yZSA9IGNyZWF0ZVN0b3JlKHJlZHVjZXJzX3RtLCBhcHBseU1pZGRsZXdhcmUocmVkdXhfdGh1bmtfZXMpKTtcblxuY29uc3Qgc3RvcmVfc2VuZEV2ZW50ID0gYW5hbHl0aWNzKGNvbmZpZ1siYSIgLyogZGVmYXVsdCAqL10sIHN0b3JlX3N0b3JlKTtcbnN0b3JlX3N0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTZW5kRXZlbnQoc3RvcmVfc2VuZEV2ZW50KSk7XG5cbmNvbnN0IHN0b3JlX29ic2VydmVycyA9IGdldF9vYnNlcnZlcnNfdG0oc3RvcmVfc3RvcmUsIGFjdGlvbnNfYWN0aW9ucyk7XG5cbk9iamVjdC5rZXlzKHN0b3JlX29ic2VydmVycykuZm9yRWFjaChrZXkgPT4gZ2xvYmFsX3N0b3JhZ2VfdG0ub2JzZXJ2ZShrZXksIHN0b3JlX29ic2VydmVyc1trZXldKSk7XG5PYmplY3Qua2V5cyhzdG9yZV9vYnNlcnZlcnMpLmZvckVhY2goa2V5ID0+IHN0b3JlX29ic2VydmVyc1trZXldKCkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB3aWRnZXRfc3RvcmUgPSAoc3RvcmVfc3RvcmUpO1xuXG5jb25zdCB1c2VBcHBTdGF0ZSA9IGZ1bmN0aW9uIChrZXlzKSB7XG4gIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgY29uc3QgZ2V0U3RhdGVQcm9wcyA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgIGNvbnN0IHNldHRlcnMgPSBnZXRfc2V0dGVyc190bShzdGF0ZSwgZGlzcGF0Y2gsIGFjdGlvbnNfYWN0aW9ucyk7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmIChrZXkgaW4gc3RhdGUpIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSBzdGF0ZVtrZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSBzZXR0ZXJzW2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgcmV0dXJuIHVzZVNlbGVjdG9yX3VzZVNlbGVjdG9yKGdldFN0YXRlUHJvcHMpO1xufTtcblxuXG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9zbGljZWRUb0FycmF5LmpzXG52YXIgc2xpY2VkVG9BcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oMzQpO1xudmFyIHNsaWNlZFRvQXJyYXlfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oc2xpY2VkVG9BcnJheSk7XG5cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9kZWZpbmVQcm9wZXJ0eS5qc1xudmFyIGRlZmluZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7XG52YXIgZGVmaW5lUHJvcGVydHlfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZGVmaW5lUHJvcGVydHkpO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2suanNcbnZhciBjbGFzc0NhbGxDaGVjayA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpO1xudmFyIGNsYXNzQ2FsbENoZWNrX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGNsYXNzQ2FsbENoZWNrKTtcblxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzLmpzXG52YXIgY3JlYXRlQ2xhc3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTtcbnZhciBjcmVhdGVDbGFzc19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihjcmVhdGVDbGFzcyk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LWkxOG5leHQvZGlzdC9lcy9jb250ZXh0LmpzXG5cblxuXG5cbmZ1bmN0aW9uIGNvbnRleHRfb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH1cblxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBjb250ZXh0X293bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBkZWZpbmVQcm9wZXJ0eV9kZWZhdWx0KCkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgY29udGV4dF9vd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfVxuXG5cbnZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgYmluZEkxOG46IFwnbGFuZ3VhZ2VDaGFuZ2VkXCcsXG4gIGJpbmRJMThuU3RvcmU6IFwnXCcsXG4gIHRyYW5zRW1wdHlOb2RlVmFsdWU6IFwnXCcsXG4gIHRyYW5zU3VwcG9ydEJhc2ljSHRtbE5vZGVzOiB0cnVlLFxuICB0cmFuc0tlZXBCYXNpY0h0bWxOb2Rlc0ZvcjogW1wnYnJcJywgXCdzdHJvbmdcJywgXCdpXCcsIFwncFwnXSxcbiAgdXNlU3VzcGVuc2U6IHRydWVcbn07XG52YXIgaTE4bkluc3RhbmNlO1xudmFyIEkxOG5Db250ZXh0ID0gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUNvbnRleHQoKTtcbmZ1bmN0aW9uIHNldERlZmF1bHRzKCkge1xuICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gIGRlZmF1bHRPcHRpb25zID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBkZWZhdWx0T3B0aW9ucyksIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdHMoKSB7XG4gIHJldHVybiBkZWZhdWx0T3B0aW9ucztcbn1cbnZhciBjb250ZXh0X1JlcG9ydE5hbWVzcGFjZXMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJlcG9ydE5hbWVzcGFjZXMoKSB7XG4gICAgY2xhc3NDYWxsQ2hlY2tfZGVmYXVsdCgpKHRoaXMsIFJlcG9ydE5hbWVzcGFjZXMpO1xuXG4gICAgdGhpcy51c2VkTmFtZXNwYWNlcyA9IHt9O1xuICB9XG5cbiAgY3JlYXRlQ2xhc3NfZGVmYXVsdCgpKFJlcG9ydE5hbWVzcGFjZXMsIFt7XG4gICAga2V5OiAiYWRkVXNlZE5hbWVzcGFjZXMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRVc2VkTmFtZXNwYWNlcyhuYW1lc3BhY2VzKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICBuYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24gKG5zKSB7XG4gICAgICAgIGlmICghX3RoaXMudXNlZE5hbWVzcGFjZXNbbnNdKSBfdGhpcy51c2VkTmFtZXNwYWNlc1tuc10gPSB0cnVlO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0VXNlZE5hbWVzcGFjZXMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVc2VkTmFtZXNwYWNlcygpIHtcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLnVzZWROYW1lc3BhY2VzKTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gUmVwb3J0TmFtZXNwYWNlcztcbn0oKTtcbmZ1bmN0aW9uIHNldEkxOG4oaW5zdGFuY2UpIHtcbiAgaTE4bkluc3RhbmNlID0gaW5zdGFuY2U7XG59XG5mdW5jdGlvbiBnZXRJMThuKCkge1xuICByZXR1cm4gaTE4bkluc3RhbmNlO1xufVxudmFyIGluaXRSZWFjdEkxOG5leHQgPSB7XG4gIHR5cGU6IFwnM3JkUGFydHlcJyxcbiAgaW5pdDogZnVuY3Rpb24gaW5pdChpbnN0YW5jZSkge1xuICAgIHNldERlZmF1bHRzKGluc3RhbmNlLm9wdGlvbnMucmVhY3QpO1xuICAgIHNldEkxOG4oaW5zdGFuY2UpO1xuICB9XG59O1xuZnVuY3Rpb24gY29tcG9zZUluaXRpYWxQcm9wcyhGb3JDb21wb25lbnQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChjdHgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgIHZhciBpMThuSW5pdGlhbFByb3BzID0gZ2V0SW5pdGlhbFByb3BzKCk7XG5cbiAgICAgIGlmIChGb3JDb21wb25lbnQuZ2V0SW5pdGlhbFByb3BzKSB7XG4gICAgICAgIEZvckNvbXBvbmVudC5nZXRJbml0aWFsUHJvcHMoY3R4KS50aGVuKGZ1bmN0aW9uIChjb21wb25lbnRzSW5pdGlhbFByb3BzKSB7XG4gICAgICAgICAgcmVzb2x2ZShfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGNvbXBvbmVudHNJbml0aWFsUHJvcHMpLCBpMThuSW5pdGlhbFByb3BzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzb2x2ZShpMThuSW5pdGlhbFByb3BzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbn1cbmZ1bmN0aW9uIGdldEluaXRpYWxQcm9wcygpIHtcbiAgdmFyIGkxOG4gPSBnZXRJMThuKCk7XG4gIHZhciBuYW1lc3BhY2VzID0gaTE4bi5yZXBvcnROYW1lc3BhY2VzID8gaTE4bi5yZXBvcnROYW1lc3BhY2VzLmdldFVzZWROYW1lc3BhY2VzKCkgOiBbXTtcbiAgdmFyIHJldCA9IHt9O1xuICB2YXIgaW5pdGlhbEkxOG5TdG9yZSA9IHt9O1xuICBpMThuLmxhbmd1YWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgaW5pdGlhbEkxOG5TdG9yZVtsXSA9IHt9O1xuICAgIG5hbWVzcGFjZXMuZm9yRWFjaChmdW5jdGlvbiAobnMpIHtcbiAgICAgIGluaXRpYWxJMThuU3RvcmVbbF1bbnNdID0gaTE4bi5nZXRSZXNvdXJjZUJ1bmRsZShsLCBucykgfHwge307XG4gICAgfSk7XG4gIH0pO1xuICByZXQuaW5pdGlhbEkxOG5TdG9yZSA9IGluaXRpYWxJMThuU3RvcmU7XG4gIHJldC5pbml0aWFsTGFuZ3VhZ2UgPSBpMThuLmxhbmd1YWdlO1xuICByZXR1cm4gcmV0O1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtaTE4bmV4dC9kaXN0L2VzL3V0aWxzLmpzXG5mdW5jdGlvbiB3YXJuKCkge1xuICBpZiAoY29uc29sZSAmJiBjb25zb2xlLndhcm4pIHtcbiAgICB2YXIgX2NvbnNvbGU7XG5cbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSBcJ3N0cmluZ1wnKSBhcmdzWzBdID0gInJlYWN0LWkxOG5leHQ6OiAiLmNvbmNhdChhcmdzWzBdKTtcblxuICAgIChfY29uc29sZSA9IGNvbnNvbGUpLndhcm4uYXBwbHkoX2NvbnNvbGUsIGFyZ3MpO1xuICB9XG59XG52YXIgYWxyZWFkeVdhcm5lZCA9IHt9O1xuZnVuY3Rpb24gd2Fybk9uY2UoKSB7XG4gIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xuICAgIGFyZ3NbX2tleTJdID0gYXJndW1lbnRzW19rZXkyXTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gXCdzdHJpbmdcJyAmJiBhbHJlYWR5V2FybmVkW2FyZ3NbMF1dKSByZXR1cm47XG4gIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gXCdzdHJpbmdcJykgYWxyZWFkeVdhcm5lZFthcmdzWzBdXSA9IG5ldyBEYXRlKCk7XG4gIHdhcm4uYXBwbHkodm9pZCAwLCBhcmdzKTtcbn1cbmZ1bmN0aW9uIGxvYWROYW1lc3BhY2VzKGkxOG4sIG5zLCBjYikge1xuICBpMThuLmxvYWROYW1lc3BhY2VzKG5zLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGkxOG4uaXNJbml0aWFsaXplZCkge1xuICAgICAgY2IoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGluaXRpYWxpemVkID0gZnVuY3Rpb24gaW5pdGlhbGl6ZWQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGkxOG4ub2ZmKFwnaW5pdGlhbGl6ZWRcJywgaW5pdGlhbGl6ZWQpO1xuICAgICAgICB9LCAwKTtcbiAgICAgICAgY2IoKTtcbiAgICAgIH07XG5cbiAgICAgIGkxOG4ub24oXCdpbml0aWFsaXplZFwnLCBpbml0aWFsaXplZCk7XG4gICAgfVxuICB9KTtcbn1cbmZ1bmN0aW9uIGhhc0xvYWRlZE5hbWVzcGFjZShucywgaTE4bikge1xuICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307XG5cbiAgaWYgKCFpMThuLmxhbmd1YWdlcyB8fCAhaTE4bi5sYW5ndWFnZXMubGVuZ3RoKSB7XG4gICAgd2Fybk9uY2UoXCdpMThuLmxhbmd1YWdlcyB3ZXJlIHVuZGVmaW5lZCBvciBlbXB0eVwnLCBpMThuLmxhbmd1YWdlcyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB2YXIgbG5nID0gaTE4bi5sYW5ndWFnZXNbMF07XG4gIHZhciBmYWxsYmFja0xuZyA9IGkxOG4ub3B0aW9ucyA/IGkxOG4ub3B0aW9ucy5mYWxsYmFja0xuZyA6IGZhbHNlO1xuICB2YXIgbGFzdExuZyA9IGkxOG4ubGFuZ3VhZ2VzW2kxOG4ubGFuZ3VhZ2VzLmxlbmd0aCAtIDFdO1xuICBpZiAobG5nLnRvTG93ZXJDYXNlKCkgPT09IFwnY2ltb2RlXCcpIHJldHVybiB0cnVlO1xuXG4gIHZhciBsb2FkTm90UGVuZGluZyA9IGZ1bmN0aW9uIGxvYWROb3RQZW5kaW5nKGwsIG4pIHtcbiAgICB2YXIgbG9hZFN0YXRlID0gaTE4bi5zZXJ2aWNlcy5iYWNrZW5kQ29ubmVjdG9yLnN0YXRlWyIiLmNvbmNhdChsLCAifCIpLmNvbmNhdChuKV07XG4gICAgcmV0dXJuIGxvYWRTdGF0ZSA9PT0gLTEgfHwgbG9hZFN0YXRlID09PSAyO1xuICB9O1xuXG4gIGlmIChvcHRpb25zLmJpbmRJMThuICYmIG9wdGlvbnMuYmluZEkxOG4uaW5kZXhPZihcJ2xhbmd1YWdlQ2hhbmdpbmdcJykgPiAtMSAmJiBpMThuLnNlcnZpY2VzLmJhY2tlbmRDb25uZWN0b3IuYmFja2VuZCAmJiBpMThuLmlzTGFuZ3VhZ2VDaGFuZ2luZ1RvICYmICFsb2FkTm90UGVuZGluZyhpMThuLmlzTGFuZ3VhZ2VDaGFuZ2luZ1RvLCBucykpIHJldHVybiBmYWxzZTtcbiAgaWYgKGkxOG4uaGFzUmVzb3VyY2VCdW5kbGUobG5nLCBucykpIHJldHVybiB0cnVlO1xuICBpZiAoIWkxOG4uc2VydmljZXMuYmFja2VuZENvbm5lY3Rvci5iYWNrZW5kKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKGxvYWROb3RQZW5kaW5nKGxuZywgbnMpICYmICghZmFsbGJhY2tMbmcgfHwgbG9hZE5vdFBlbmRpbmcobGFzdExuZywgbnMpKSkgcmV0dXJuIHRydWU7XG4gIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIHV0aWxzX2dldERpc3BsYXlOYW1lKENvbXBvbmVudCkge1xuICByZXR1cm4gQ29tcG9uZW50LmRpc3BsYXlOYW1lIHx8IENvbXBvbmVudC5uYW1lIHx8ICh0eXBlb2YgQ29tcG9uZW50ID09PSBcJ3N0cmluZ1wnICYmIENvbXBvbmVudC5sZW5ndGggPiAwID8gQ29tcG9uZW50IDogXCdVbmtub3duXCcpO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QtaTE4bmV4dC9kaXN0L2VzL3VzZVRyYW5zbGF0aW9uLmpzXG5cblxuXG5mdW5jdGlvbiB1c2VUcmFuc2xhdGlvbl9vd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfVxuXG5mdW5jdGlvbiB1c2VUcmFuc2xhdGlvbl9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgdXNlVHJhbnNsYXRpb25fb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IGRlZmluZVByb3BlcnR5X2RlZmF1bHQoKSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyB1c2VUcmFuc2xhdGlvbl9vd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfVxuXG5cblxuXG5mdW5jdGlvbiB1c2VUcmFuc2xhdGlvbihucykge1xuICB2YXIgcHJvcHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuICB2YXIgaTE4bkZyb21Qcm9wcyA9IHByb3BzLmkxOG47XG5cbiAgdmFyIF9yZWYgPSBPYmplY3QocmVhY3RbInVzZUNvbnRleHQiXSkoSTE4bkNvbnRleHQpIHx8IHt9LFxuICAgICAgaTE4bkZyb21Db250ZXh0ID0gX3JlZi5pMThuLFxuICAgICAgZGVmYXVsdE5TRnJvbUNvbnRleHQgPSBfcmVmLmRlZmF1bHROUztcblxuICB2YXIgaTE4biA9IGkxOG5Gcm9tUHJvcHMgfHwgaTE4bkZyb21Db250ZXh0IHx8IGdldEkxOG4oKTtcbiAgaWYgKGkxOG4gJiYgIWkxOG4ucmVwb3J0TmFtZXNwYWNlcykgaTE4bi5yZXBvcnROYW1lc3BhY2VzID0gbmV3IGNvbnRleHRfUmVwb3J0TmFtZXNwYWNlcygpO1xuXG4gIGlmICghaTE4bikge1xuICAgIHdhcm5PbmNlKFwnWW91IHdpbGwgbmVlZCB0byBwYXNzIGluIGFuIGkxOG5leHQgaW5zdGFuY2UgYnkgdXNpbmcgaW5pdFJlYWN0STE4bmV4dFwnKTtcblxuICAgIHZhciBub3RSZWFkeVQgPSBmdW5jdGlvbiBub3RSZWFkeVQoaykge1xuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaykgPyBrW2subGVuZ3RoIC0gMV0gOiBrO1xuICAgIH07XG5cbiAgICB2YXIgcmV0Tm90UmVhZHkgPSBbbm90UmVhZHlULCB7fSwgZmFsc2VdO1xuICAgIHJldE5vdFJlYWR5LnQgPSBub3RSZWFkeVQ7XG4gICAgcmV0Tm90UmVhZHkuaTE4biA9IHt9O1xuICAgIHJldE5vdFJlYWR5LnJlYWR5ID0gZmFsc2U7XG4gICAgcmV0dXJuIHJldE5vdFJlYWR5O1xuICB9XG5cbiAgaWYgKGkxOG4ub3B0aW9ucy5yZWFjdCAmJiBpMThuLm9wdGlvbnMucmVhY3Qud2FpdCAhPT0gdW5kZWZpbmVkKSB3YXJuT25jZShcJ0l0IHNlZW1zIHlvdSBhcmUgc3RpbGwgdXNpbmcgdGhlIG9sZCB3YWl0IG9wdGlvbiwgeW91IG1heSBtaWdyYXRlIHRvIHRoZSBuZXcgdXNlU3VzcGVuc2UgYmVoYXZpb3VyLlwnKTtcblxuICB2YXIgaTE4bk9wdGlvbnMgPSB1c2VUcmFuc2xhdGlvbl9vYmplY3RTcHJlYWQodXNlVHJhbnNsYXRpb25fb2JqZWN0U3ByZWFkKHVzZVRyYW5zbGF0aW9uX29iamVjdFNwcmVhZCh7fSwgZ2V0RGVmYXVsdHMoKSksIGkxOG4ub3B0aW9ucy5yZWFjdCksIHByb3BzKTtcblxuICB2YXIgdXNlU3VzcGVuc2UgPSBpMThuT3B0aW9ucy51c2VTdXNwZW5zZTtcbiAgdmFyIG5hbWVzcGFjZXMgPSBucyB8fCBkZWZhdWx0TlNGcm9tQ29udGV4dCB8fCBpMThuLm9wdGlvbnMgJiYgaTE4bi5vcHRpb25zLmRlZmF1bHROUztcbiAgbmFtZXNwYWNlcyA9IHR5cGVvZiBuYW1lc3BhY2VzID09PSBcJ3N0cmluZ1wnID8gW25hbWVzcGFjZXNdIDogbmFtZXNwYWNlcyB8fCBbXCd0cmFuc2xhdGlvblwnXTtcbiAgaWYgKGkxOG4ucmVwb3J0TmFtZXNwYWNlcy5hZGRVc2VkTmFtZXNwYWNlcykgaTE4bi5yZXBvcnROYW1lc3BhY2VzLmFkZFVzZWROYW1lc3BhY2VzKG5hbWVzcGFjZXMpO1xuICB2YXIgcmVhZHkgPSAoaTE4bi5pc0luaXRpYWxpemVkIHx8IGkxOG4uaW5pdGlhbGl6ZWRTdG9yZU9uY2UpICYmIG5hbWVzcGFjZXMuZXZlcnkoZnVuY3Rpb24gKG4pIHtcbiAgICByZXR1cm4gaGFzTG9hZGVkTmFtZXNwYWNlKG4sIGkxOG4sIGkxOG5PcHRpb25zKTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gZ2V0VCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdDogaTE4bi5nZXRGaXhlZFQobnVsbCwgaTE4bk9wdGlvbnMubnNNb2RlID09PSBcJ2ZhbGxiYWNrXCcgPyBuYW1lc3BhY2VzIDogbmFtZXNwYWNlc1swXSlcbiAgICB9O1xuICB9XG5cbiAgdmFyIF91c2VTdGF0ZSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZ2V0VCgpKSxcbiAgICAgIF91c2VTdGF0ZTIgPSBzbGljZWRUb0FycmF5X2RlZmF1bHQoKShfdXNlU3RhdGUsIDIpLFxuICAgICAgdCA9IF91c2VTdGF0ZTJbMF0sXG4gICAgICBzZXRUID0gX3VzZVN0YXRlMlsxXTtcblxuICB2YXIgaXNNb3VudGVkID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkodHJ1ZSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgYmluZEkxOG4gPSBpMThuT3B0aW9ucy5iaW5kSTE4bixcbiAgICAgICAgYmluZEkxOG5TdG9yZSA9IGkxOG5PcHRpb25zLmJpbmRJMThuU3RvcmU7XG4gICAgaXNNb3VudGVkLmN1cnJlbnQgPSB0cnVlO1xuXG4gICAgaWYgKCFyZWFkeSAmJiAhdXNlU3VzcGVuc2UpIHtcbiAgICAgIGxvYWROYW1lc3BhY2VzKGkxOG4sIG5hbWVzcGFjZXMsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGlzTW91bnRlZC5jdXJyZW50KSBzZXRUKGdldFQoKSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBib3VuZFJlc2V0KCkge1xuICAgICAgaWYgKGlzTW91bnRlZC5jdXJyZW50KSBzZXRUKGdldFQoKSk7XG4gICAgfVxuXG4gICAgaWYgKGJpbmRJMThuICYmIGkxOG4pIGkxOG4ub24oYmluZEkxOG4sIGJvdW5kUmVzZXQpO1xuICAgIGlmIChiaW5kSTE4blN0b3JlICYmIGkxOG4pIGkxOG4uc3RvcmUub24oYmluZEkxOG5TdG9yZSwgYm91bmRSZXNldCk7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlzTW91bnRlZC5jdXJyZW50ID0gZmFsc2U7XG4gICAgICBpZiAoYmluZEkxOG4gJiYgaTE4bikgYmluZEkxOG4uc3BsaXQoXCcgXCcpLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIGkxOG4ub2ZmKGUsIGJvdW5kUmVzZXQpO1xuICAgICAgfSk7XG4gICAgICBpZiAoYmluZEkxOG5TdG9yZSAmJiBpMThuKSBiaW5kSTE4blN0b3JlLnNwbGl0KFwnIFwnKS5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBpMThuLnN0b3JlLm9mZihlLCBib3VuZFJlc2V0KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0sIFtpMThuLCBuYW1lc3BhY2VzLmpvaW4oKV0pO1xuICB2YXIgaXNJbml0aWFsID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkodHJ1ZSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoaXNNb3VudGVkLmN1cnJlbnQgJiYgIWlzSW5pdGlhbC5jdXJyZW50KSB7XG4gICAgICBzZXRUKGdldFQoKSk7XG4gICAgfVxuXG4gICAgaXNJbml0aWFsLmN1cnJlbnQgPSBmYWxzZTtcbiAgfSwgW2kxOG5dKTtcbiAgdmFyIHJldCA9IFt0LnQsIGkxOG4sIHJlYWR5XTtcbiAgcmV0LnQgPSB0LnQ7XG4gIHJldC5pMThuID0gaTE4bjtcbiAgcmV0LnJlYWR5ID0gcmVhZHk7XG4gIGlmIChyZWFkeSkgcmV0dXJuIHJldDtcbiAgaWYgKCFyZWFkeSAmJiAhdXNlU3VzcGVuc2UpIHJldHVybiByZXQ7XG4gIHRocm93IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgbG9hZE5hbWVzcGFjZXMoaTE4biwgbmFtZXNwYWNlcywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvc3R5bGVkLWNvbXBvbmVudHMvZGlzdC9zdHlsZWQtY29tcG9uZW50cy5icm93c2VyLmVzbS5qc1xudmFyIHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBldGl0b3JzLWRldGVjdGlvbi5qc3hcbmNvbnN0IGNvbXBldGl0b3JzRGV0ZWN0aW9uID0gKCkgPT4ge1xuICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NhdmVmcm9tX195dF9idG4iKSB8fCAvLyB5b3V0dWJlLmNvbVxuICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuc2F2ZWZyb21fb2tfZG93bmxvYWQiKSB8fCAvLyBvay5ydVxuICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuc2YtZmVlZC1kbC1idG4iKSB8fCAvLyBvay5ydVxuICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuc2YtdmlkZW8tZmVlZC1iaW5kLW9uLWluc2VydCIpIHx8IC8vIG9rLnJ1XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltjbGFzcyo9c2Ytbm90aWZ5LW9uLXJlbW92ZS1dIikpIHtcbiAgICByZXR1cm4gIlNhdmVGcm9tLm5ldCBIZWxwZXIiO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBjb21wZXRpdG9yc19kZXRlY3Rpb24gPSAoY29tcGV0aXRvcnNEZXRlY3Rpb24pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvdWkvdG9vbHRpcC5qc3hcblxuXG5cblxuY29uc3QgU3RIaW50ID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgJHtwcm9wcyA9PiBwcm9wcy50aGVtZSAmJiBgXG4gICAgY29sb3I6ICR7cHJvcHMudGhlbWUuY29sb3J9O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMudGhlbWUuYmFja2dyb3VuZH07XG4gICAgYm9yZGVyOiAxcHggc29saWQgJHtwcm9wcy50aGVtZS5ib3JkZXJ9O1xuICBgfVxuICBib3JkZXItcmFkaXVzOiAycHg7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdG9wOiAke3Byb3BzID0+IHByb3BzLnBvc1l9cHg7XG4gIGxlZnQ6ICR7cHJvcHMgPT4gcHJvcHMucG9zWH1weDtcbiAgbWF4LXdpZHRoOiAyNTBweDtcbiAgcGFkZGluZzogNnB4IDhweDtcbiAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7XG4gIGZvbnQtc2l6ZTogMTJweDtcbiAgbGluZS1oZWlnaHQ6IDE4cHg7XG4gIHVzZXItc2VsZWN0OiBub25lO1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBvcGFjaXR5OiAke3Byb3BzID0+IHByb3BzLm9wYWNpdHl9O1xuICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMnMgZWFzZS1pbi1vdXQ7XG4gICY6OmJlZm9yZSB7XG4gICAgY29udGVudDogIiAiO1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6IC0zcHg7XG4gICAgcmlnaHQ6IC0xcHg7XG4gICAgYm90dG9tOiAtM3B4O1xuICAgIGxlZnQ6IC0xcHg7XG4gIH1cbmA7XG5cbmNvbnN0IG1hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lLFxuICBtb2R1bGU6IHN0YXRlLm1vZHVsZVxufSk7XG5cbmNvbnN0IEhpbnQgPSAoe1xuICB0aXRsZSxcbiAgZWxlbWVudCxcbiAgaXNFbGVtZW50TW91c2VPdmVyXG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0aGVtZSxcbiAgICBtb2R1bGVcbiAgfSA9IHVzZVNlbGVjdG9yX3VzZVNlbGVjdG9yKG1hcFN0YXRlKTtcbiAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1bmlkb3dubG9hZGVyLXRvb2x0aXAiKTtcbiAgY29uc3QgW2lzVG9vbHRpcCwgc2V0SXNUb29sdGlwXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBbaXNUb29sdGlwTW91c2VPdmVyLCBzZXRJc1Rvb2x0aXBNb3VzZU92ZXJdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IFtwb3NYLCBzZXRQb3NYXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG4gIGNvbnN0IFtwb3NZLCBzZXRQb3NZXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG4gIGNvbnN0IFtvcGFjaXR5LCBzZXRPcGFjaXR5XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG5cbiAgaWYgKCFpc1Rvb2x0aXAgJiYgdG9vbHRpcCAmJiBlbGVtZW50ICYmIGlzRWxlbWVudE1vdXNlT3ZlciAmJiAhb3BhY2l0eSkge1xuICAgIHNldElzVG9vbHRpcCh0cnVlKTtcbiAgfVxuXG4gIGNvbnN0IGNvbXB1dGVkT3BhY2l0eSA9IGlzVG9vbHRpcCAmJiAoaXNFbGVtZW50TW91c2VPdmVyIHx8IGlzVG9vbHRpcE1vdXNlT3ZlcikgPyAxIDogMDtcblxuICBpZiAoY29tcHV0ZWRPcGFjaXR5ICE9PSBvcGFjaXR5KSB7XG4gICAgc2V0T3BhY2l0eShjb21wdXRlZE9wYWNpdHkpO1xuICB9XG5cbiAgaWYgKGlzVG9vbHRpcCkge1xuICAgIHJldHVybiBPYmplY3QocmVhY3RfZG9tWyJjcmVhdGVQb3J0YWwiXSkoIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChTdEhpbnQsIHtcbiAgICAgIHRoZW1lOiB0aGVtZSAmJiB0aGVtZS50b29sdGlwLFxuICAgICAgcmVmOiBub2RlID0+IHtcbiAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICBjb25zdCBlbGVtZW50UmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgICBpZiAoZWxlbWVudFJlY3QpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGVSZWN0ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgaWYgKG5vZGVSZWN0KSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1hcmdpbiA9IDI7XG4gICAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgICBnZXRTY3JvbGxDb250YWluZXJcbiAgICAgICAgICAgICAgfSA9IG1vZHVsZTtcbiAgICAgICAgICAgICAgY29uc3Qgc2Nyb2xsVG9wID0gZ2V0U2Nyb2xsQ29udGFpbmVyID8gZ2V0U2Nyb2xsQ29udGFpbmVyKCkuc2Nyb2xsVG9wIDogd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgICAgICAgICAgICBjb25zdCBlbGVtZW50VG9wID0gZWxlbWVudFJlY3QudG9wO1xuICAgICAgICAgICAgICBjb25zdCBub2RlSGVpZ2h0ID0gbm9kZVJlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgICBjb25zdCBuZXdOb2RlVG9wID0gZWxlbWVudFRvcCAtIG5vZGVIZWlnaHQgLSBtYXJnaW47XG5cbiAgICAgICAgICAgICAgaWYgKG5ld05vZGVUb3AgLSBtYXJnaW4gPiAwKSB7XG4gICAgICAgICAgICAgICAgc2V0UG9zWShzY3JvbGxUb3AgKyBuZXdOb2RlVG9wKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXRQb3NZKHNjcm9sbFRvcCArIGVsZW1lbnRSZWN0LmJvdHRvbSArIG1hcmdpbik7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjb25zdCBlbGVtZW50Q2VudGVyID0gZWxlbWVudFJlY3QubGVmdCArIGVsZW1lbnRSZWN0LndpZHRoIC8gMjtcbiAgICAgICAgICAgICAgY29uc3Qgbm9kZVdpZHRoID0gbm9kZVJlY3Qud2lkdGg7XG4gICAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgICBjbGllbnRXaWR0aFxuICAgICAgICAgICAgICB9ID0gZG9jdW1lbnQuYm9keTtcblxuICAgICAgICAgICAgICBpZiAoZWxlbWVudENlbnRlciAtIG5vZGVXaWR0aCAvIDIgPCBtYXJnaW4pIHtcbiAgICAgICAgICAgICAgICBzZXRQb3NYKG1hcmdpbik7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudENlbnRlciArIG5vZGVXaWR0aCAvIDIgPiBjbGllbnRXaWR0aCAtIG1hcmdpbikge1xuICAgICAgICAgICAgICAgIHNldFBvc1goY2xpZW50V2lkdGggLSBtYXJnaW4gLSBub2RlV2lkdGgpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldFBvc1goZWxlbWVudENlbnRlciAtIG5vZGVXaWR0aCAvIDIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcG9zWDogcG9zWCxcbiAgICAgIHBvc1k6IHBvc1ksXG4gICAgICBvcGFjaXR5OiBvcGFjaXR5LFxuICAgICAgb25UcmFuc2l0aW9uRW5kOiAoKSA9PiB7XG4gICAgICAgIGlmICghaXNFbGVtZW50TW91c2VPdmVyICYmICFpc1Rvb2x0aXBNb3VzZU92ZXIpIHtcbiAgICAgICAgICBzZXRJc1Rvb2x0aXAoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25Nb3VzZUVudGVyOiAoKSA9PiB7XG4gICAgICAgIHNldElzVG9vbHRpcE1vdXNlT3Zlcih0cnVlKTtcbiAgICAgIH0sXG4gICAgICBvbk1vdXNlTGVhdmU6ICgpID0+IHtcbiAgICAgICAgc2V0SXNUb29sdGlwTW91c2VPdmVyKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCB0aXRsZSksIHRvb2x0aXApO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb25zdCBUb29sdGlwID0gKHtcbiAgY2hpbGRyZW4sXG4gIHRpdGxlXG59KSA9PiB7XG4gIGNvbnN0IFtlbGVtZW50LCBzZXRFbGVtZW50XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoKTtcbiAgY29uc3QgW2lzTW91c2VPdmVyLCBzZXRJc01vdXNlT3Zlcl0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGZhbHNlKTtcbiAgY29uc3QgW2lzRWxlbWVudE1vdXNlT3Zlciwgc2V0SXNFbGVtZW50TW91c2VPdmVyXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBbaXNUaW1lb3V0LCBzZXRJc1RpbWVvdXRdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IGNvbXB1dGVkRWxlbWVudElzTW91c2VPdmVyID0gIWlzVGltZW91dCAmJiBpc01vdXNlT3ZlcjtcblxuICBpZiAoaXNFbGVtZW50TW91c2VPdmVyICE9PSBjb21wdXRlZEVsZW1lbnRJc01vdXNlT3Zlcikge1xuICAgIHNldElzRWxlbWVudE1vdXNlT3Zlcihjb21wdXRlZEVsZW1lbnRJc01vdXNlT3Zlcik7XG4gIH1cblxuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X2RlZmF1bHQuYS5GcmFnbWVudCwgbnVsbCwgT2JqZWN0KHJlYWN0WyJjbG9uZUVsZW1lbnQiXSkoY2hpbGRyZW4sIHtcbiAgICBvbk1vdXNlRW50ZXI6ICgpID0+IHtcbiAgICAgIHNldElzTW91c2VPdmVyKHRydWUpO1xuICAgICAgc2V0SXNUaW1lb3V0KHRydWUpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHNldElzVGltZW91dChmYWxzZSk7XG4gICAgICB9LCAyMDApO1xuICAgIH0sXG4gICAgb25Nb3VzZUxlYXZlOiAoKSA9PiB7XG4gICAgICBzZXRJc0VsZW1lbnRNb3VzZU92ZXIoZmFsc2UpO1xuICAgICAgc2V0SXNNb3VzZU92ZXIoZmFsc2UpO1xuICAgIH0sXG4gICAgcmVmOiBub2RlID0+IHtcbiAgICAgIGlmIChub2RlKSBzZXRFbGVtZW50KG5vZGUpO1xuICAgIH1cbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChIaW50LCB7XG4gICAgdGl0bGU6IHRpdGxlLFxuICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgaXNFbGVtZW50TW91c2VPdmVyOiBpc0VsZW1lbnRNb3VzZU92ZXJcbiAgfSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgdWlfdG9vbHRpcCA9IChUb29sdGlwKTtcbi8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vaW5oZXJpdHNMb29zZS5qc1xudmFyIGluaGVyaXRzTG9vc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZXNvbHZlLXBhdGhuYW1lL2VzbS9yZXNvbHZlLXBhdGhuYW1lLmpzXG5mdW5jdGlvbiBpc0Fic29sdXRlKHBhdGhuYW1lKSB7XG4gIHJldHVybiBwYXRobmFtZS5jaGFyQXQoMCkgPT09IFwnL1wnO1xufVxuXG4vLyBBYm91dCAxLjV4IGZhc3RlciB0aGFuIHRoZSB0d28tYXJnIHZlcnNpb24gb2YgQXJyYXkjc3BsaWNlKClcbmZ1bmN0aW9uIHNwbGljZU9uZShsaXN0LCBpbmRleCkge1xuICBmb3IgKHZhciBpID0gaW5kZXgsIGsgPSBpICsgMSwgbiA9IGxpc3QubGVuZ3RoOyBrIDwgbjsgaSArPSAxLCBrICs9IDEpIHtcbiAgICBsaXN0W2ldID0gbGlzdFtrXTtcbiAgfVxuXG4gIGxpc3QucG9wKCk7XG59XG5cbi8vIFRoaXMgaW1wbGVtZW50YXRpb24gaXMgYmFzZWQgaGVhdmlseSBvbiBub2RlXCdzIHVybC5wYXJzZVxuZnVuY3Rpb24gcmVzb2x2ZVBhdGhuYW1lKHRvLCBmcm9tKSB7XG4gIGlmIChmcm9tID09PSB1bmRlZmluZWQpIGZyb20gPSBcJ1wnO1xuXG4gIHZhciB0b1BhcnRzID0gKHRvICYmIHRvLnNwbGl0KFwnL1wnKSkgfHwgW107XG4gIHZhciBmcm9tUGFydHMgPSAoZnJvbSAmJiBmcm9tLnNwbGl0KFwnL1wnKSkgfHwgW107XG5cbiAgdmFyIGlzVG9BYnMgPSB0byAmJiBpc0Fic29sdXRlKHRvKTtcbiAgdmFyIGlzRnJvbUFicyA9IGZyb20gJiYgaXNBYnNvbHV0ZShmcm9tKTtcbiAgdmFyIG11c3RFbmRBYnMgPSBpc1RvQWJzIHx8IGlzRnJvbUFicztcblxuICBpZiAodG8gJiYgaXNBYnNvbHV0ZSh0bykpIHtcbiAgICAvLyB0byBpcyBhYnNvbHV0ZVxuICAgIGZyb21QYXJ0cyA9IHRvUGFydHM7XG4gIH0gZWxzZSBpZiAodG9QYXJ0cy5sZW5ndGgpIHtcbiAgICAvLyB0byBpcyByZWxhdGl2ZSwgZHJvcCB0aGUgZmlsZW5hbWVcbiAgICBmcm9tUGFydHMucG9wKCk7XG4gICAgZnJvbVBhcnRzID0gZnJvbVBhcnRzLmNvbmNhdCh0b1BhcnRzKTtcbiAgfVxuXG4gIGlmICghZnJvbVBhcnRzLmxlbmd0aCkgcmV0dXJuIFwnL1wnO1xuXG4gIHZhciBoYXNUcmFpbGluZ1NsYXNoO1xuICBpZiAoZnJvbVBhcnRzLmxlbmd0aCkge1xuICAgIHZhciBsYXN0ID0gZnJvbVBhcnRzW2Zyb21QYXJ0cy5sZW5ndGggLSAxXTtcbiAgICBoYXNUcmFpbGluZ1NsYXNoID0gbGFzdCA9PT0gXCcuXCcgfHwgbGFzdCA9PT0gXCcuLlwnIHx8IGxhc3QgPT09IFwnXCc7XG4gIH0gZWxzZSB7XG4gICAgaGFzVHJhaWxpbmdTbGFzaCA9IGZhbHNlO1xuICB9XG5cbiAgdmFyIHVwID0gMDtcbiAgZm9yICh2YXIgaSA9IGZyb21QYXJ0cy5sZW5ndGg7IGkgPj0gMDsgaS0tKSB7XG4gICAgdmFyIHBhcnQgPSBmcm9tUGFydHNbaV07XG5cbiAgICBpZiAocGFydCA9PT0gXCcuXCcpIHtcbiAgICAgIHNwbGljZU9uZShmcm9tUGFydHMsIGkpO1xuICAgIH0gZWxzZSBpZiAocGFydCA9PT0gXCcuLlwnKSB7XG4gICAgICBzcGxpY2VPbmUoZnJvbVBhcnRzLCBpKTtcbiAgICAgIHVwKys7XG4gICAgfSBlbHNlIGlmICh1cCkge1xuICAgICAgc3BsaWNlT25lKGZyb21QYXJ0cywgaSk7XG4gICAgICB1cC0tO1xuICAgIH1cbiAgfVxuXG4gIGlmICghbXVzdEVuZEFicykgZm9yICg7IHVwLS07IHVwKSBmcm9tUGFydHMudW5zaGlmdChcJy4uXCcpO1xuXG4gIGlmIChcbiAgICBtdXN0RW5kQWJzICYmXG4gICAgZnJvbVBhcnRzWzBdICE9PSBcJ1wnICYmXG4gICAgKCFmcm9tUGFydHNbMF0gfHwgIWlzQWJzb2x1dGUoZnJvbVBhcnRzWzBdKSlcbiAgKVxuICAgIGZyb21QYXJ0cy51bnNoaWZ0KFwnXCcpO1xuXG4gIHZhciByZXN1bHQgPSBmcm9tUGFydHMuam9pbihcJy9cJyk7XG5cbiAgaWYgKGhhc1RyYWlsaW5nU2xhc2ggJiYgcmVzdWx0LnN1YnN0cigtMSkgIT09IFwnL1wnKSByZXN1bHQgKz0gXCcvXCc7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmVzb2x2ZV9wYXRobmFtZSA9IChyZXNvbHZlUGF0aG5hbWUpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy92YWx1ZS1lcXVhbC9lc20vdmFsdWUtZXF1YWwuanNcbmZ1bmN0aW9uIHZhbHVlX2VxdWFsX3ZhbHVlT2Yob2JqKSB7XG4gIHJldHVybiBvYmoudmFsdWVPZiA/IG9iai52YWx1ZU9mKCkgOiBPYmplY3QucHJvdG90eXBlLnZhbHVlT2YuY2FsbChvYmopO1xufVxuXG5mdW5jdGlvbiB2YWx1ZUVxdWFsKGEsIGIpIHtcbiAgLy8gVGVzdCBmb3Igc3RyaWN0IGVxdWFsaXR5IGZpcnN0LlxuICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWU7XG5cbiAgLy8gT3RoZXJ3aXNlLCBpZiBlaXRoZXIgb2YgdGhlbSA9PSBudWxsIHRoZXkgYXJlIG5vdCBlcXVhbC5cbiAgaWYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwpIHJldHVybiBmYWxzZTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShhKSkge1xuICAgIHJldHVybiAoXG4gICAgICBBcnJheS5pc0FycmF5KGIpICYmXG4gICAgICBhLmxlbmd0aCA9PT0gYi5sZW5ndGggJiZcbiAgICAgIGEuZXZlcnkoZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlRXF1YWwoaXRlbSwgYltpbmRleF0pO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBhID09PSBcJ29iamVjdFwnIHx8IHR5cGVvZiBiID09PSBcJ29iamVjdFwnKSB7XG4gICAgdmFyIGFWYWx1ZSA9IHZhbHVlX2VxdWFsX3ZhbHVlT2YoYSk7XG4gICAgdmFyIGJWYWx1ZSA9IHZhbHVlX2VxdWFsX3ZhbHVlT2YoYik7XG5cbiAgICBpZiAoYVZhbHVlICE9PSBhIHx8IGJWYWx1ZSAhPT0gYikgcmV0dXJuIHZhbHVlRXF1YWwoYVZhbHVlLCBiVmFsdWUpO1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKE9iamVjdC5hc3NpZ24oe30sIGEsIGIpKS5ldmVyeShmdW5jdGlvbihrZXkpIHtcbiAgICAgIHJldHVybiB2YWx1ZUVxdWFsKGFba2V5XSwgYltrZXldKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgdmFsdWVfZXF1YWwgPSAodmFsdWVFcXVhbCk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3RpbnktaW52YXJpYW50L2Rpc3QvdGlueS1pbnZhcmlhbnQuZXNtLmpzXG52YXIgaXNQcm9kdWN0aW9uID0gInByb2R1Y3Rpb24iID09PSBcJ3Byb2R1Y3Rpb25cJztcbnZhciBwcmVmaXggPSBcJ0ludmFyaWFudCBmYWlsZWRcJztcbmZ1bmN0aW9uIGludmFyaWFudChjb25kaXRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoY29uZGl0aW9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGlzUHJvZHVjdGlvbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocHJlZml4KTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKHByZWZpeCArICI6ICIgKyAobWVzc2FnZSB8fCBcJ1wnKSk7XG59XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHRpbnlfaW52YXJpYW50X2VzbSA9IChpbnZhcmlhbnQpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9oaXN0b3J5L2VzbS9oaXN0b3J5LmpzXG5cblxuXG5cblxuXG5mdW5jdGlvbiBhZGRMZWFkaW5nU2xhc2gocGF0aCkge1xuICByZXR1cm4gcGF0aC5jaGFyQXQoMCkgPT09IFwnL1wnID8gcGF0aCA6IFwnL1wnICsgcGF0aDtcbn1cbmZ1bmN0aW9uIHN0cmlwTGVhZGluZ1NsYXNoKHBhdGgpIHtcbiAgcmV0dXJuIHBhdGguY2hhckF0KDApID09PSBcJy9cJyA/IHBhdGguc3Vic3RyKDEpIDogcGF0aDtcbn1cbmZ1bmN0aW9uIGhhc0Jhc2VuYW1lKHBhdGgsIHByZWZpeCkge1xuICByZXR1cm4gcGF0aC50b0xvd2VyQ2FzZSgpLmluZGV4T2YocHJlZml4LnRvTG93ZXJDYXNlKCkpID09PSAwICYmIFwnLz8jXCcuaW5kZXhPZihwYXRoLmNoYXJBdChwcmVmaXgubGVuZ3RoKSkgIT09IC0xO1xufVxuZnVuY3Rpb24gc3RyaXBCYXNlbmFtZShwYXRoLCBwcmVmaXgpIHtcbiAgcmV0dXJuIGhhc0Jhc2VuYW1lKHBhdGgsIHByZWZpeCkgPyBwYXRoLnN1YnN0cihwcmVmaXgubGVuZ3RoKSA6IHBhdGg7XG59XG5mdW5jdGlvbiBzdHJpcFRyYWlsaW5nU2xhc2gocGF0aCkge1xuICByZXR1cm4gcGF0aC5jaGFyQXQocGF0aC5sZW5ndGggLSAxKSA9PT0gXCcvXCcgPyBwYXRoLnNsaWNlKDAsIC0xKSA6IHBhdGg7XG59XG5mdW5jdGlvbiBwYXJzZVBhdGgocGF0aCkge1xuICB2YXIgcGF0aG5hbWUgPSBwYXRoIHx8IFwnL1wnO1xuICB2YXIgc2VhcmNoID0gXCdcJztcbiAgdmFyIGhhc2ggPSBcJ1wnO1xuICB2YXIgaGFzaEluZGV4ID0gcGF0aG5hbWUuaW5kZXhPZihcJyNcJyk7XG5cbiAgaWYgKGhhc2hJbmRleCAhPT0gLTEpIHtcbiAgICBoYXNoID0gcGF0aG5hbWUuc3Vic3RyKGhhc2hJbmRleCk7XG4gICAgcGF0aG5hbWUgPSBwYXRobmFtZS5zdWJzdHIoMCwgaGFzaEluZGV4KTtcbiAgfVxuXG4gIHZhciBzZWFyY2hJbmRleCA9IHBhdGhuYW1lLmluZGV4T2YoXCc/XCcpO1xuXG4gIGlmIChzZWFyY2hJbmRleCAhPT0gLTEpIHtcbiAgICBzZWFyY2ggPSBwYXRobmFtZS5zdWJzdHIoc2VhcmNoSW5kZXgpO1xuICAgIHBhdGhuYW1lID0gcGF0aG5hbWUuc3Vic3RyKDAsIHNlYXJjaEluZGV4KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcGF0aG5hbWU6IHBhdGhuYW1lLFxuICAgIHNlYXJjaDogc2VhcmNoID09PSBcJz9cJyA/IFwnXCcgOiBzZWFyY2gsXG4gICAgaGFzaDogaGFzaCA9PT0gXCcjXCcgPyBcJ1wnIDogaGFzaFxuICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlUGF0aChsb2NhdGlvbikge1xuICB2YXIgcGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZSxcbiAgICAgIHNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaCxcbiAgICAgIGhhc2ggPSBsb2NhdGlvbi5oYXNoO1xuICB2YXIgcGF0aCA9IHBhdGhuYW1lIHx8IFwnL1wnO1xuICBpZiAoc2VhcmNoICYmIHNlYXJjaCAhPT0gXCc/XCcpIHBhdGggKz0gc2VhcmNoLmNoYXJBdCgwKSA9PT0gXCc/XCcgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7XG4gIGlmIChoYXNoICYmIGhhc2ggIT09IFwnI1wnKSBwYXRoICs9IGhhc2guY2hhckF0KDApID09PSBcJyNcJyA/IGhhc2ggOiAiIyIgKyBoYXNoO1xuICByZXR1cm4gcGF0aDtcbn1cblxuZnVuY3Rpb24gY3JlYXRlTG9jYXRpb24ocGF0aCwgc3RhdGUsIGtleSwgY3VycmVudExvY2F0aW9uKSB7XG4gIHZhciBsb2NhdGlvbjtcblxuICBpZiAodHlwZW9mIHBhdGggPT09IFwnc3RyaW5nXCcpIHtcbiAgICAvLyBUd28tYXJnIGZvcm06IHB1c2gocGF0aCwgc3RhdGUpXG4gICAgbG9jYXRpb24gPSBwYXJzZVBhdGgocGF0aCk7XG4gICAgbG9jYXRpb24uc3RhdGUgPSBzdGF0ZTtcbiAgfSBlbHNlIHtcbiAgICAvLyBPbmUtYXJnIGZvcm06IHB1c2gobG9jYXRpb24pXG4gICAgbG9jYXRpb24gPSBfZXh0ZW5kcyh7fSwgcGF0aCk7XG4gICAgaWYgKGxvY2F0aW9uLnBhdGhuYW1lID09PSB1bmRlZmluZWQpIGxvY2F0aW9uLnBhdGhuYW1lID0gXCdcJztcblxuICAgIGlmIChsb2NhdGlvbi5zZWFyY2gpIHtcbiAgICAgIGlmIChsb2NhdGlvbi5zZWFyY2guY2hhckF0KDApICE9PSBcJz9cJykgbG9jYXRpb24uc2VhcmNoID0gXCc/XCcgKyBsb2NhdGlvbi5zZWFyY2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2F0aW9uLnNlYXJjaCA9IFwnXCc7XG4gICAgfVxuXG4gICAgaWYgKGxvY2F0aW9uLmhhc2gpIHtcbiAgICAgIGlmIChsb2NhdGlvbi5oYXNoLmNoYXJBdCgwKSAhPT0gXCcjXCcpIGxvY2F0aW9uLmhhc2ggPSBcJyNcJyArIGxvY2F0aW9uLmhhc2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2F0aW9uLmhhc2ggPSBcJ1wnO1xuICAgIH1cblxuICAgIGlmIChzdGF0ZSAhPT0gdW5kZWZpbmVkICYmIGxvY2F0aW9uLnN0YXRlID09PSB1bmRlZmluZWQpIGxvY2F0aW9uLnN0YXRlID0gc3RhdGU7XG4gIH1cblxuICB0cnkge1xuICAgIGxvY2F0aW9uLnBhdGhuYW1lID0gZGVjb2RlVVJJKGxvY2F0aW9uLnBhdGhuYW1lKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgVVJJRXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBVUklFcnJvcihcJ1BhdGhuYW1lICJcJyArIGxvY2F0aW9uLnBhdGhuYW1lICsgXCciIGNvdWxkIG5vdCBiZSBkZWNvZGVkLiBcJyArIFwnVGhpcyBpcyBsaWtlbHkgY2F1c2VkIGJ5IGFuIGludmFsaWQgcGVyY2VudC1lbmNvZGluZy5cJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGtleSkgbG9jYXRpb24ua2V5ID0ga2V5O1xuXG4gIGlmIChjdXJyZW50TG9jYXRpb24pIHtcbiAgICAvLyBSZXNvbHZlIGluY29tcGxldGUvcmVsYXRpdmUgcGF0aG5hbWUgcmVsYXRpdmUgdG8gY3VycmVudCBsb2NhdGlvbi5cbiAgICBpZiAoIWxvY2F0aW9uLnBhdGhuYW1lKSB7XG4gICAgICBsb2NhdGlvbi5wYXRobmFtZSA9IGN1cnJlbnRMb2NhdGlvbi5wYXRobmFtZTtcbiAgICB9IGVsc2UgaWYgKGxvY2F0aW9uLnBhdGhuYW1lLmNoYXJBdCgwKSAhPT0gXCcvXCcpIHtcbiAgICAgIGxvY2F0aW9uLnBhdGhuYW1lID0gcmVzb2x2ZV9wYXRobmFtZShsb2NhdGlvbi5wYXRobmFtZSwgY3VycmVudExvY2F0aW9uLnBhdGhuYW1lKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gV2hlbiB0aGVyZSBpcyBubyBwcmlvciBsb2NhdGlvbiBhbmQgcGF0aG5hbWUgaXMgZW1wdHksIHNldCBpdCB0byAvXG4gICAgaWYgKCFsb2NhdGlvbi5wYXRobmFtZSkge1xuICAgICAgbG9jYXRpb24ucGF0aG5hbWUgPSBcJy9cJztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbG9jYXRpb247XG59XG5mdW5jdGlvbiBsb2NhdGlvbnNBcmVFcXVhbChhLCBiKSB7XG4gIHJldHVybiBhLnBhdGhuYW1lID09PSBiLnBhdGhuYW1lICYmIGEuc2VhcmNoID09PSBiLnNlYXJjaCAmJiBhLmhhc2ggPT09IGIuaGFzaCAmJiBhLmtleSA9PT0gYi5rZXkgJiYgdmFsdWVfZXF1YWwoYS5zdGF0ZSwgYi5zdGF0ZSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRyYW5zaXRpb25NYW5hZ2VyKCkge1xuICB2YXIgcHJvbXB0ID0gbnVsbDtcblxuICBmdW5jdGlvbiBzZXRQcm9tcHQobmV4dFByb21wdCkge1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICBwcm9tcHQgPSBuZXh0UHJvbXB0O1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAocHJvbXB0ID09PSBuZXh0UHJvbXB0KSBwcm9tcHQgPSBudWxsO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBjb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGNhbGxiYWNrKSB7XG4gICAgLy8gVE9ETzogSWYgYW5vdGhlciB0cmFuc2l0aW9uIHN0YXJ0cyB3aGlsZSB3ZVwncmUgc3RpbGwgY29uZmlybWluZ1xuICAgIC8vIHRoZSBwcmV2aW91cyBvbmUsIHdlIG1heSBlbmQgdXAgaW4gYSB3ZWlyZCBzdGF0ZS4gRmlndXJlIG91dCB0aGVcbiAgICAvLyBiZXN0IHdheSB0byBoYW5kbGUgdGhpcy5cbiAgICBpZiAocHJvbXB0ICE9IG51bGwpIHtcbiAgICAgIHZhciByZXN1bHQgPSB0eXBlb2YgcHJvbXB0ID09PSBcJ2Z1bmN0aW9uXCcgPyBwcm9tcHQobG9jYXRpb24sIGFjdGlvbikgOiBwcm9tcHQ7XG5cbiAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSBcJ3N0cmluZ1wnKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZ2V0VXNlckNvbmZpcm1hdGlvbiA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICAgICAgZ2V0VXNlckNvbmZpcm1hdGlvbihyZXN1bHQsIGNhbGxiYWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB2b2lkIDA7XG4gICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJldHVybiBmYWxzZSBmcm9tIGEgdHJhbnNpdGlvbiBob29rIHRvIGNhbmNlbCB0aGUgdHJhbnNpdGlvbi5cbiAgICAgICAgY2FsbGJhY2socmVzdWx0ICE9PSBmYWxzZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBsaXN0ZW5lcnMgPSBbXTtcblxuICBmdW5jdGlvbiBhcHBlbmRMaXN0ZW5lcihmbikge1xuICAgIHZhciBpc0FjdGl2ZSA9IHRydWU7XG5cbiAgICBmdW5jdGlvbiBsaXN0ZW5lcigpIHtcbiAgICAgIGlmIChpc0FjdGl2ZSkgZm4uYXBwbHkodm9pZCAwLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgIGxpc3RlbmVycyA9IGxpc3RlbmVycy5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0gIT09IGxpc3RlbmVyO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG5vdGlmeUxpc3RlbmVycygpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgbGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7XG4gICAgICByZXR1cm4gbGlzdGVuZXIuYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgc2V0UHJvbXB0OiBzZXRQcm9tcHQsXG4gICAgY29uZmlybVRyYW5zaXRpb25UbzogY29uZmlybVRyYW5zaXRpb25UbyxcbiAgICBhcHBlbmRMaXN0ZW5lcjogYXBwZW5kTGlzdGVuZXIsXG4gICAgbm90aWZ5TGlzdGVuZXJzOiBub3RpZnlMaXN0ZW5lcnNcbiAgfTtcbn1cblxudmFyIGNhblVzZURPTSA9ICEhKHR5cGVvZiB3aW5kb3cgIT09IFwndW5kZWZpbmVkXCcgJiYgd2luZG93LmRvY3VtZW50ICYmIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KTtcbmZ1bmN0aW9uIGdldENvbmZpcm1hdGlvbihtZXNzYWdlLCBjYWxsYmFjaykge1xuICBjYWxsYmFjayh3aW5kb3cuY29uZmlybShtZXNzYWdlKSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tYWxlcnRcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBIVE1MNSBoaXN0b3J5IEFQSSBpcyBzdXBwb3J0ZWQuIFRha2VuIGZyb20gTW9kZXJuaXpyLlxuICpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9Nb2Rlcm5penIvTW9kZXJuaXpyL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9Nb2Rlcm5penIvTW9kZXJuaXpyL2Jsb2IvbWFzdGVyL2ZlYXR1cmUtZGV0ZWN0cy9oaXN0b3J5LmpzXG4gKiBjaGFuZ2VkIHRvIGF2b2lkIGZhbHNlIG5lZ2F0aXZlcyBmb3IgV2luZG93cyBQaG9uZXM6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdGpzL3JlYWN0LXJvdXRlci9pc3N1ZXMvNTg2XG4gKi9cblxuZnVuY3Rpb24gc3VwcG9ydHNIaXN0b3J5KCkge1xuICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgaWYgKCh1YS5pbmRleE9mKFwnQW5kcm9pZCAyLlwnKSAhPT0gLTEgfHwgdWEuaW5kZXhPZihcJ0FuZHJvaWQgNC4wXCcpICE9PSAtMSkgJiYgdWEuaW5kZXhPZihcJ01vYmlsZSBTYWZhcmlcJykgIT09IC0xICYmIHVhLmluZGV4T2YoXCdDaHJvbWVcJykgPT09IC0xICYmIHVhLmluZGV4T2YoXCdXaW5kb3dzIFBob25lXCcpID09PSAtMSkgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gd2luZG93Lmhpc3RvcnkgJiYgXCdwdXNoU3RhdGVcJyBpbiB3aW5kb3cuaGlzdG9yeTtcbn1cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGJyb3dzZXIgZmlyZXMgcG9wc3RhdGUgb24gaGFzaCBjaGFuZ2UuXG4gKiBJRTEwIGFuZCBJRTExIGRvIG5vdC5cbiAqL1xuXG5mdW5jdGlvbiBzdXBwb3J0c1BvcFN0YXRlT25IYXNoQ2hhbmdlKCkge1xuICByZXR1cm4gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcJ1RyaWRlbnRcJykgPT09IC0xO1xufVxuLyoqXG4gKiBSZXR1cm5zIGZhbHNlIGlmIHVzaW5nIGdvKG4pIHdpdGggaGFzaCBoaXN0b3J5IGNhdXNlcyBhIGZ1bGwgcGFnZSByZWxvYWQuXG4gKi9cblxuZnVuY3Rpb24gc3VwcG9ydHNHb1dpdGhvdXRSZWxvYWRVc2luZ0hhc2goKSB7XG4gIHJldHVybiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwnRmlyZWZveFwnKSA9PT0gLTE7XG59XG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBhIGdpdmVuIHBvcHN0YXRlIGV2ZW50IGlzIGFuIGV4dHJhbmVvdXMgV2ViS2l0IGV2ZW50LlxuICogQWNjb3VudHMgZm9yIHRoZSBmYWN0IHRoYXQgQ2hyb21lIG9uIGlPUyBmaXJlcyByZWFsIHBvcHN0YXRlIGV2ZW50c1xuICogY29udGFpbmluZyB1bmRlZmluZWQgc3RhdGUgd2hlbiBwcmVzc2luZyB0aGUgYmFjayBidXR0b24uXG4gKi9cblxuZnVuY3Rpb24gaXNFeHRyYW5lb3VzUG9wc3RhdGVFdmVudChldmVudCkge1xuICByZXR1cm4gZXZlbnQuc3RhdGUgPT09IHVuZGVmaW5lZCAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCdDcmlPU1wnKSA9PT0gLTE7XG59XG5cbnZhciBQb3BTdGF0ZUV2ZW50ID0gXCdwb3BzdGF0ZVwnO1xudmFyIEhhc2hDaGFuZ2VFdmVudCA9IFwnaGFzaGNoYW5nZVwnO1xuXG5mdW5jdGlvbiBnZXRIaXN0b3J5U3RhdGUoKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHdpbmRvdy5oaXN0b3J5LnN0YXRlIHx8IHt9O1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gSUUgMTEgc29tZXRpbWVzIHRocm93cyB3aGVuIGFjY2Vzc2luZyB3aW5kb3cuaGlzdG9yeS5zdGF0ZVxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vUmVhY3RUcmFpbmluZy9oaXN0b3J5L3B1bGwvMjg5XG4gICAgcmV0dXJuIHt9O1xuICB9XG59XG4vKipcbiAqIENyZWF0ZXMgYSBoaXN0b3J5IG9iamVjdCB0aGF0IHVzZXMgdGhlIEhUTUw1IGhpc3RvcnkgQVBJIGluY2x1ZGluZ1xuICogcHVzaFN0YXRlLCByZXBsYWNlU3RhdGUsIGFuZCB0aGUgcG9wc3RhdGUgZXZlbnQuXG4gKi9cblxuXG5mdW5jdGlvbiBjcmVhdGVCcm93c2VySGlzdG9yeShwcm9wcykge1xuICBpZiAocHJvcHMgPT09IHZvaWQgMCkge1xuICAgIHByb3BzID0ge307XG4gIH1cblxuICAhY2FuVXNlRE9NID8gIGZhbHNlID8gdW5kZWZpbmVkIDogdGlueV9pbnZhcmlhbnRfZXNtKGZhbHNlKSA6IHZvaWQgMDtcbiAgdmFyIGdsb2JhbEhpc3RvcnkgPSB3aW5kb3cuaGlzdG9yeTtcbiAgdmFyIGNhblVzZUhpc3RvcnkgPSBzdXBwb3J0c0hpc3RvcnkoKTtcbiAgdmFyIG5lZWRzSGFzaENoYW5nZUxpc3RlbmVyID0gIXN1cHBvcnRzUG9wU3RhdGVPbkhhc2hDaGFuZ2UoKTtcbiAgdmFyIF9wcm9wcyA9IHByb3BzLFxuICAgICAgX3Byb3BzJGZvcmNlUmVmcmVzaCA9IF9wcm9wcy5mb3JjZVJlZnJlc2gsXG4gICAgICBmb3JjZVJlZnJlc2ggPSBfcHJvcHMkZm9yY2VSZWZyZXNoID09PSB2b2lkIDAgPyBmYWxzZSA6IF9wcm9wcyRmb3JjZVJlZnJlc2gsXG4gICAgICBfcHJvcHMkZ2V0VXNlckNvbmZpcm0gPSBfcHJvcHMuZ2V0VXNlckNvbmZpcm1hdGlvbixcbiAgICAgIGdldFVzZXJDb25maXJtYXRpb24gPSBfcHJvcHMkZ2V0VXNlckNvbmZpcm0gPT09IHZvaWQgMCA/IGdldENvbmZpcm1hdGlvbiA6IF9wcm9wcyRnZXRVc2VyQ29uZmlybSxcbiAgICAgIF9wcm9wcyRrZXlMZW5ndGggPSBfcHJvcHMua2V5TGVuZ3RoLFxuICAgICAga2V5TGVuZ3RoID0gX3Byb3BzJGtleUxlbmd0aCA9PT0gdm9pZCAwID8gNiA6IF9wcm9wcyRrZXlMZW5ndGg7XG4gIHZhciBiYXNlbmFtZSA9IHByb3BzLmJhc2VuYW1lID8gc3RyaXBUcmFpbGluZ1NsYXNoKGFkZExlYWRpbmdTbGFzaChwcm9wcy5iYXNlbmFtZSkpIDogXCdcJztcblxuICBmdW5jdGlvbiBnZXRET01Mb2NhdGlvbihoaXN0b3J5U3RhdGUpIHtcbiAgICB2YXIgX3JlZiA9IGhpc3RvcnlTdGF0ZSB8fCB7fSxcbiAgICAgICAga2V5ID0gX3JlZi5rZXksXG4gICAgICAgIHN0YXRlID0gX3JlZi5zdGF0ZTtcblxuICAgIHZhciBfd2luZG93JGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLFxuICAgICAgICBwYXRobmFtZSA9IF93aW5kb3ckbG9jYXRpb24ucGF0aG5hbWUsXG4gICAgICAgIHNlYXJjaCA9IF93aW5kb3ckbG9jYXRpb24uc2VhcmNoLFxuICAgICAgICBoYXNoID0gX3dpbmRvdyRsb2NhdGlvbi5oYXNoO1xuICAgIHZhciBwYXRoID0gcGF0aG5hbWUgKyBzZWFyY2ggKyBoYXNoO1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICBpZiAoYmFzZW5hbWUpIHBhdGggPSBzdHJpcEJhc2VuYW1lKHBhdGgsIGJhc2VuYW1lKTtcbiAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24ocGF0aCwgc3RhdGUsIGtleSk7XG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVLZXkoKSB7XG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCBrZXlMZW5ndGgpO1xuICB9XG5cbiAgdmFyIHRyYW5zaXRpb25NYW5hZ2VyID0gY3JlYXRlVHJhbnNpdGlvbk1hbmFnZXIoKTtcblxuICBmdW5jdGlvbiBzZXRTdGF0ZShuZXh0U3RhdGUpIHtcbiAgICBfZXh0ZW5kcyhoaXN0b3J5LCBuZXh0U3RhdGUpO1xuXG4gICAgaGlzdG9yeS5sZW5ndGggPSBnbG9iYWxIaXN0b3J5Lmxlbmd0aDtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5ub3RpZnlMaXN0ZW5lcnMoaGlzdG9yeS5sb2NhdGlvbiwgaGlzdG9yeS5hY3Rpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlUG9wU3RhdGUoZXZlbnQpIHtcbiAgICAvLyBJZ25vcmUgZXh0cmFuZW91cyBwb3BzdGF0ZSBldmVudHMgaW4gV2ViS2l0LlxuICAgIGlmIChpc0V4dHJhbmVvdXNQb3BzdGF0ZUV2ZW50KGV2ZW50KSkgcmV0dXJuO1xuICAgIGhhbmRsZVBvcChnZXRET01Mb2NhdGlvbihldmVudC5zdGF0ZSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlSGFzaENoYW5nZSgpIHtcbiAgICBoYW5kbGVQb3AoZ2V0RE9NTG9jYXRpb24oZ2V0SGlzdG9yeVN0YXRlKCkpKTtcbiAgfVxuXG4gIHZhciBmb3JjZU5leHRQb3AgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBoYW5kbGVQb3AobG9jYXRpb24pIHtcbiAgICBpZiAoZm9yY2VOZXh0UG9wKSB7XG4gICAgICBmb3JjZU5leHRQb3AgPSBmYWxzZTtcbiAgICAgIHNldFN0YXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBhY3Rpb24gPSBcJ1BPUFwnO1xuICAgICAgdHJhbnNpdGlvbk1hbmFnZXIuY29uZmlybVRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgYWN0aW9uLCBnZXRVc2VyQ29uZmlybWF0aW9uLCBmdW5jdGlvbiAob2spIHtcbiAgICAgICAgaWYgKG9rKSB7XG4gICAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sXG4gICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXZlcnRQb3AobG9jYXRpb24pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZXZlcnRQb3AoZnJvbUxvY2F0aW9uKSB7XG4gICAgdmFyIHRvTG9jYXRpb24gPSBoaXN0b3J5LmxvY2F0aW9uOyAvLyBUT0RPOiBXZSBjb3VsZCBwcm9iYWJseSBtYWtlIHRoaXMgbW9yZSByZWxpYWJsZSBieVxuICAgIC8vIGtlZXBpbmcgYSBsaXN0IG9mIGtleXMgd2VcJ3ZlIHNlZW4gaW4gc2Vzc2lvblN0b3JhZ2UuXG4gICAgLy8gSW5zdGVhZCwgd2UganVzdCBkZWZhdWx0IHRvIDAgZm9yIGtleXMgd2UgZG9uXCd0IGtub3cuXG5cbiAgICB2YXIgdG9JbmRleCA9IGFsbEtleXMuaW5kZXhPZih0b0xvY2F0aW9uLmtleSk7XG4gICAgaWYgKHRvSW5kZXggPT09IC0xKSB0b0luZGV4ID0gMDtcbiAgICB2YXIgZnJvbUluZGV4ID0gYWxsS2V5cy5pbmRleE9mKGZyb21Mb2NhdGlvbi5rZXkpO1xuICAgIGlmIChmcm9tSW5kZXggPT09IC0xKSBmcm9tSW5kZXggPSAwO1xuICAgIHZhciBkZWx0YSA9IHRvSW5kZXggLSBmcm9tSW5kZXg7XG5cbiAgICBpZiAoZGVsdGEpIHtcbiAgICAgIGZvcmNlTmV4dFBvcCA9IHRydWU7XG4gICAgICBnbyhkZWx0YSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGluaXRpYWxMb2NhdGlvbiA9IGdldERPTUxvY2F0aW9uKGdldEhpc3RvcnlTdGF0ZSgpKTtcbiAgdmFyIGFsbEtleXMgPSBbaW5pdGlhbExvY2F0aW9uLmtleV07IC8vIFB1YmxpYyBpbnRlcmZhY2VcblxuICBmdW5jdGlvbiBjcmVhdGVIcmVmKGxvY2F0aW9uKSB7XG4gICAgcmV0dXJuIGJhc2VuYW1lICsgY3JlYXRlUGF0aChsb2NhdGlvbik7XG4gIH1cblxuICBmdW5jdGlvbiBwdXNoKHBhdGgsIHN0YXRlKSB7XG4gICAgIGZhbHNlID8gdW5kZWZpbmVkIDogdm9pZCAwO1xuICAgIHZhciBhY3Rpb24gPSBcJ1BVU0hcJztcbiAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihwYXRoLCBzdGF0ZSwgY3JlYXRlS2V5KCksIGhpc3RvcnkubG9jYXRpb24pO1xuICAgIHRyYW5zaXRpb25NYW5hZ2VyLmNvbmZpcm1UcmFuc2l0aW9uVG8obG9jYXRpb24sIGFjdGlvbiwgZ2V0VXNlckNvbmZpcm1hdGlvbiwgZnVuY3Rpb24gKG9rKSB7XG4gICAgICBpZiAoIW9rKSByZXR1cm47XG4gICAgICB2YXIgaHJlZiA9IGNyZWF0ZUhyZWYobG9jYXRpb24pO1xuICAgICAgdmFyIGtleSA9IGxvY2F0aW9uLmtleSxcbiAgICAgICAgICBzdGF0ZSA9IGxvY2F0aW9uLnN0YXRlO1xuXG4gICAgICBpZiAoY2FuVXNlSGlzdG9yeSkge1xuICAgICAgICBnbG9iYWxIaXN0b3J5LnB1c2hTdGF0ZSh7XG4gICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgc3RhdGU6IHN0YXRlXG4gICAgICAgIH0sIG51bGwsIGhyZWYpO1xuXG4gICAgICAgIGlmIChmb3JjZVJlZnJlc2gpIHtcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGhyZWY7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHByZXZJbmRleCA9IGFsbEtleXMuaW5kZXhPZihoaXN0b3J5LmxvY2F0aW9uLmtleSk7XG4gICAgICAgICAgdmFyIG5leHRLZXlzID0gYWxsS2V5cy5zbGljZSgwLCBwcmV2SW5kZXggKyAxKTtcbiAgICAgICAgICBuZXh0S2V5cy5wdXNoKGxvY2F0aW9uLmtleSk7XG4gICAgICAgICAgYWxsS2V5cyA9IG5leHRLZXlzO1xuICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBocmVmO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVwbGFjZShwYXRoLCBzdGF0ZSkge1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICB2YXIgYWN0aW9uID0gXCdSRVBMQUNFXCc7XG4gICAgdmFyIGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24ocGF0aCwgc3RhdGUsIGNyZWF0ZUtleSgpLCBoaXN0b3J5LmxvY2F0aW9uKTtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5jb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGZ1bmN0aW9uIChvaykge1xuICAgICAgaWYgKCFvaykgcmV0dXJuO1xuICAgICAgdmFyIGhyZWYgPSBjcmVhdGVIcmVmKGxvY2F0aW9uKTtcbiAgICAgIHZhciBrZXkgPSBsb2NhdGlvbi5rZXksXG4gICAgICAgICAgc3RhdGUgPSBsb2NhdGlvbi5zdGF0ZTtcblxuICAgICAgaWYgKGNhblVzZUhpc3RvcnkpIHtcbiAgICAgICAgZ2xvYmFsSGlzdG9yeS5yZXBsYWNlU3RhdGUoe1xuICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgIHN0YXRlOiBzdGF0ZVxuICAgICAgICB9LCBudWxsLCBocmVmKTtcblxuICAgICAgICBpZiAoZm9yY2VSZWZyZXNoKSB7XG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoaHJlZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHByZXZJbmRleCA9IGFsbEtleXMuaW5kZXhPZihoaXN0b3J5LmxvY2F0aW9uLmtleSk7XG4gICAgICAgICAgaWYgKHByZXZJbmRleCAhPT0gLTEpIGFsbEtleXNbcHJldkluZGV4XSA9IGxvY2F0aW9uLmtleTtcbiAgICAgICAgICBzZXRTdGF0ZSh7XG4gICAgICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB2b2lkIDA7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGhyZWYpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ28obikge1xuICAgIGdsb2JhbEhpc3RvcnkuZ28obik7XG4gIH1cblxuICBmdW5jdGlvbiBnb0JhY2soKSB7XG4gICAgZ28oLTEpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ29Gb3J3YXJkKCkge1xuICAgIGdvKDEpO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyQ291bnQgPSAwO1xuXG4gIGZ1bmN0aW9uIGNoZWNrRE9NTGlzdGVuZXJzKGRlbHRhKSB7XG4gICAgbGlzdGVuZXJDb3VudCArPSBkZWx0YTtcblxuICAgIGlmIChsaXN0ZW5lckNvdW50ID09PSAxICYmIGRlbHRhID09PSAxKSB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50LCBoYW5kbGVQb3BTdGF0ZSk7XG4gICAgICBpZiAobmVlZHNIYXNoQ2hhbmdlTGlzdGVuZXIpIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKEhhc2hDaGFuZ2VFdmVudCwgaGFuZGxlSGFzaENoYW5nZSk7XG4gICAgfSBlbHNlIGlmIChsaXN0ZW5lckNvdW50ID09PSAwKSB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50LCBoYW5kbGVQb3BTdGF0ZSk7XG4gICAgICBpZiAobmVlZHNIYXNoQ2hhbmdlTGlzdGVuZXIpIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKEhhc2hDaGFuZ2VFdmVudCwgaGFuZGxlSGFzaENoYW5nZSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGlzQmxvY2tlZCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIGJsb2NrKHByb21wdCkge1xuICAgIGlmIChwcm9tcHQgPT09IHZvaWQgMCkge1xuICAgICAgcHJvbXB0ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIHVuYmxvY2sgPSB0cmFuc2l0aW9uTWFuYWdlci5zZXRQcm9tcHQocHJvbXB0KTtcblxuICAgIGlmICghaXNCbG9ja2VkKSB7XG4gICAgICBjaGVja0RPTUxpc3RlbmVycygxKTtcbiAgICAgIGlzQmxvY2tlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpc0Jsb2NrZWQpIHtcbiAgICAgICAgaXNCbG9ja2VkID0gZmFsc2U7XG4gICAgICAgIGNoZWNrRE9NTGlzdGVuZXJzKC0xKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVuYmxvY2soKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gbGlzdGVuKGxpc3RlbmVyKSB7XG4gICAgdmFyIHVubGlzdGVuID0gdHJhbnNpdGlvbk1hbmFnZXIuYXBwZW5kTGlzdGVuZXIobGlzdGVuZXIpO1xuICAgIGNoZWNrRE9NTGlzdGVuZXJzKDEpO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0RPTUxpc3RlbmVycygtMSk7XG4gICAgICB1bmxpc3RlbigpO1xuICAgIH07XG4gIH1cblxuICB2YXIgaGlzdG9yeSA9IHtcbiAgICBsZW5ndGg6IGdsb2JhbEhpc3RvcnkubGVuZ3RoLFxuICAgIGFjdGlvbjogXCdQT1BcJyxcbiAgICBsb2NhdGlvbjogaW5pdGlhbExvY2F0aW9uLFxuICAgIGNyZWF0ZUhyZWY6IGNyZWF0ZUhyZWYsXG4gICAgcHVzaDogcHVzaCxcbiAgICByZXBsYWNlOiByZXBsYWNlLFxuICAgIGdvOiBnbyxcbiAgICBnb0JhY2s6IGdvQmFjayxcbiAgICBnb0ZvcndhcmQ6IGdvRm9yd2FyZCxcbiAgICBibG9jazogYmxvY2ssXG4gICAgbGlzdGVuOiBsaXN0ZW5cbiAgfTtcbiAgcmV0dXJuIGhpc3Rvcnk7XG59XG5cbnZhciBIYXNoQ2hhbmdlRXZlbnQkMSA9IFwnaGFzaGNoYW5nZVwnO1xudmFyIEhhc2hQYXRoQ29kZXJzID0ge1xuICBoYXNoYmFuZzoge1xuICAgIGVuY29kZVBhdGg6IGZ1bmN0aW9uIGVuY29kZVBhdGgocGF0aCkge1xuICAgICAgcmV0dXJuIHBhdGguY2hhckF0KDApID09PSBcJyFcJyA/IHBhdGggOiBcJyEvXCcgKyBzdHJpcExlYWRpbmdTbGFzaChwYXRoKTtcbiAgICB9LFxuICAgIGRlY29kZVBhdGg6IGZ1bmN0aW9uIGRlY29kZVBhdGgocGF0aCkge1xuICAgICAgcmV0dXJuIHBhdGguY2hhckF0KDApID09PSBcJyFcJyA/IHBhdGguc3Vic3RyKDEpIDogcGF0aDtcbiAgICB9XG4gIH0sXG4gIG5vc2xhc2g6IHtcbiAgICBlbmNvZGVQYXRoOiBzdHJpcExlYWRpbmdTbGFzaCxcbiAgICBkZWNvZGVQYXRoOiBhZGRMZWFkaW5nU2xhc2hcbiAgfSxcbiAgc2xhc2g6IHtcbiAgICBlbmNvZGVQYXRoOiBhZGRMZWFkaW5nU2xhc2gsXG4gICAgZGVjb2RlUGF0aDogYWRkTGVhZGluZ1NsYXNoXG4gIH1cbn07XG5cbmZ1bmN0aW9uIHN0cmlwSGFzaCh1cmwpIHtcbiAgdmFyIGhhc2hJbmRleCA9IHVybC5pbmRleE9mKFwnI1wnKTtcbiAgcmV0dXJuIGhhc2hJbmRleCA9PT0gLTEgPyB1cmwgOiB1cmwuc2xpY2UoMCwgaGFzaEluZGV4KTtcbn1cblxuZnVuY3Rpb24gZ2V0SGFzaFBhdGgoKSB7XG4gIC8vIFdlIGNhblwndCB1c2Ugd2luZG93LmxvY2F0aW9uLmhhc2ggaGVyZSBiZWNhdXNlIGl0XCdzIG5vdFxuICAvLyBjb25zaXN0ZW50IGFjcm9zcyBicm93c2VycyAtIEZpcmVmb3ggd2lsbCBwcmUtZGVjb2RlIGl0IVxuICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICB2YXIgaGFzaEluZGV4ID0gaHJlZi5pbmRleE9mKFwnI1wnKTtcbiAgcmV0dXJuIGhhc2hJbmRleCA9PT0gLTEgPyBcJ1wnIDogaHJlZi5zdWJzdHJpbmcoaGFzaEluZGV4ICsgMSk7XG59XG5cbmZ1bmN0aW9uIHB1c2hIYXNoUGF0aChwYXRoKSB7XG4gIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gcGF0aDtcbn1cblxuZnVuY3Rpb24gcmVwbGFjZUhhc2hQYXRoKHBhdGgpIHtcbiAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2Uoc3RyaXBIYXNoKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSArIFwnI1wnICsgcGF0aCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUhhc2hIaXN0b3J5KHByb3BzKSB7XG4gIGlmIChwcm9wcyA9PT0gdm9pZCAwKSB7XG4gICAgcHJvcHMgPSB7fTtcbiAgfVxuXG4gICFjYW5Vc2VET00gPyAgZmFsc2UgPyB1bmRlZmluZWQgOiB0aW55X2ludmFyaWFudF9lc20oZmFsc2UpIDogdm9pZCAwO1xuICB2YXIgZ2xvYmFsSGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5O1xuICB2YXIgY2FuR29XaXRob3V0UmVsb2FkID0gc3VwcG9ydHNHb1dpdGhvdXRSZWxvYWRVc2luZ0hhc2goKTtcbiAgdmFyIF9wcm9wcyA9IHByb3BzLFxuICAgICAgX3Byb3BzJGdldFVzZXJDb25maXJtID0gX3Byb3BzLmdldFVzZXJDb25maXJtYXRpb24sXG4gICAgICBnZXRVc2VyQ29uZmlybWF0aW9uID0gX3Byb3BzJGdldFVzZXJDb25maXJtID09PSB2b2lkIDAgPyBnZXRDb25maXJtYXRpb24gOiBfcHJvcHMkZ2V0VXNlckNvbmZpcm0sXG4gICAgICBfcHJvcHMkaGFzaFR5cGUgPSBfcHJvcHMuaGFzaFR5cGUsXG4gICAgICBoYXNoVHlwZSA9IF9wcm9wcyRoYXNoVHlwZSA9PT0gdm9pZCAwID8gXCdzbGFzaFwnIDogX3Byb3BzJGhhc2hUeXBlO1xuICB2YXIgYmFzZW5hbWUgPSBwcm9wcy5iYXNlbmFtZSA/IHN0cmlwVHJhaWxpbmdTbGFzaChhZGRMZWFkaW5nU2xhc2gocHJvcHMuYmFzZW5hbWUpKSA6IFwnXCc7XG4gIHZhciBfSGFzaFBhdGhDb2RlcnMkaGFzaFQgPSBIYXNoUGF0aENvZGVyc1toYXNoVHlwZV0sXG4gICAgICBlbmNvZGVQYXRoID0gX0hhc2hQYXRoQ29kZXJzJGhhc2hULmVuY29kZVBhdGgsXG4gICAgICBkZWNvZGVQYXRoID0gX0hhc2hQYXRoQ29kZXJzJGhhc2hULmRlY29kZVBhdGg7XG5cbiAgZnVuY3Rpb24gZ2V0RE9NTG9jYXRpb24oKSB7XG4gICAgdmFyIHBhdGggPSBkZWNvZGVQYXRoKGdldEhhc2hQYXRoKCkpO1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICBpZiAoYmFzZW5hbWUpIHBhdGggPSBzdHJpcEJhc2VuYW1lKHBhdGgsIGJhc2VuYW1lKTtcbiAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24ocGF0aCk7XG4gIH1cblxuICB2YXIgdHJhbnNpdGlvbk1hbmFnZXIgPSBjcmVhdGVUcmFuc2l0aW9uTWFuYWdlcigpO1xuXG4gIGZ1bmN0aW9uIHNldFN0YXRlKG5leHRTdGF0ZSkge1xuICAgIF9leHRlbmRzKGhpc3RvcnksIG5leHRTdGF0ZSk7XG5cbiAgICBoaXN0b3J5Lmxlbmd0aCA9IGdsb2JhbEhpc3RvcnkubGVuZ3RoO1xuICAgIHRyYW5zaXRpb25NYW5hZ2VyLm5vdGlmeUxpc3RlbmVycyhoaXN0b3J5LmxvY2F0aW9uLCBoaXN0b3J5LmFjdGlvbik7XG4gIH1cblxuICB2YXIgZm9yY2VOZXh0UG9wID0gZmFsc2U7XG4gIHZhciBpZ25vcmVQYXRoID0gbnVsbDtcblxuICBmdW5jdGlvbiBsb2NhdGlvbnNBcmVFcXVhbCQkMShhLCBiKSB7XG4gICAgcmV0dXJuIGEucGF0aG5hbWUgPT09IGIucGF0aG5hbWUgJiYgYS5zZWFyY2ggPT09IGIuc2VhcmNoICYmIGEuaGFzaCA9PT0gYi5oYXNoO1xuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlSGFzaENoYW5nZSgpIHtcbiAgICB2YXIgcGF0aCA9IGdldEhhc2hQYXRoKCk7XG4gICAgdmFyIGVuY29kZWRQYXRoID0gZW5jb2RlUGF0aChwYXRoKTtcblxuICAgIGlmIChwYXRoICE9PSBlbmNvZGVkUGF0aCkge1xuICAgICAgLy8gRW5zdXJlIHdlIGFsd2F5cyBoYXZlIGEgcHJvcGVybHktZW5jb2RlZCBoYXNoLlxuICAgICAgcmVwbGFjZUhhc2hQYXRoKGVuY29kZWRQYXRoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGxvY2F0aW9uID0gZ2V0RE9NTG9jYXRpb24oKTtcbiAgICAgIHZhciBwcmV2TG9jYXRpb24gPSBoaXN0b3J5LmxvY2F0aW9uO1xuICAgICAgaWYgKCFmb3JjZU5leHRQb3AgJiYgbG9jYXRpb25zQXJlRXF1YWwkJDEocHJldkxvY2F0aW9uLCBsb2NhdGlvbikpIHJldHVybjsgLy8gQSBoYXNoY2hhbmdlIGRvZXNuXCd0IGFsd2F5cyA9PSBsb2NhdGlvbiBjaGFuZ2UuXG5cbiAgICAgIGlmIChpZ25vcmVQYXRoID09PSBjcmVhdGVQYXRoKGxvY2F0aW9uKSkgcmV0dXJuOyAvLyBJZ25vcmUgdGhpcyBjaGFuZ2U7IHdlIGFscmVhZHkgc2V0U3RhdGUgaW4gcHVzaC9yZXBsYWNlLlxuXG4gICAgICBpZ25vcmVQYXRoID0gbnVsbDtcbiAgICAgIGhhbmRsZVBvcChsb2NhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlUG9wKGxvY2F0aW9uKSB7XG4gICAgaWYgKGZvcmNlTmV4dFBvcCkge1xuICAgICAgZm9yY2VOZXh0UG9wID0gZmFsc2U7XG4gICAgICBzZXRTdGF0ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgYWN0aW9uID0gXCdQT1BcJztcbiAgICAgIHRyYW5zaXRpb25NYW5hZ2VyLmNvbmZpcm1UcmFuc2l0aW9uVG8obG9jYXRpb24sIGFjdGlvbiwgZ2V0VXNlckNvbmZpcm1hdGlvbiwgZnVuY3Rpb24gKG9rKSB7XG4gICAgICAgIGlmIChvaykge1xuICAgICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV2ZXJ0UG9wKGxvY2F0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmV2ZXJ0UG9wKGZyb21Mb2NhdGlvbikge1xuICAgIHZhciB0b0xvY2F0aW9uID0gaGlzdG9yeS5sb2NhdGlvbjsgLy8gVE9ETzogV2UgY291bGQgcHJvYmFibHkgbWFrZSB0aGlzIG1vcmUgcmVsaWFibGUgYnlcbiAgICAvLyBrZWVwaW5nIGEgbGlzdCBvZiBwYXRocyB3ZVwndmUgc2VlbiBpbiBzZXNzaW9uU3RvcmFnZS5cbiAgICAvLyBJbnN0ZWFkLCB3ZSBqdXN0IGRlZmF1bHQgdG8gMCBmb3IgcGF0aHMgd2UgZG9uXCd0IGtub3cuXG5cbiAgICB2YXIgdG9JbmRleCA9IGFsbFBhdGhzLmxhc3RJbmRleE9mKGNyZWF0ZVBhdGgodG9Mb2NhdGlvbikpO1xuICAgIGlmICh0b0luZGV4ID09PSAtMSkgdG9JbmRleCA9IDA7XG4gICAgdmFyIGZyb21JbmRleCA9IGFsbFBhdGhzLmxhc3RJbmRleE9mKGNyZWF0ZVBhdGgoZnJvbUxvY2F0aW9uKSk7XG4gICAgaWYgKGZyb21JbmRleCA9PT0gLTEpIGZyb21JbmRleCA9IDA7XG4gICAgdmFyIGRlbHRhID0gdG9JbmRleCAtIGZyb21JbmRleDtcblxuICAgIGlmIChkZWx0YSkge1xuICAgICAgZm9yY2VOZXh0UG9wID0gdHJ1ZTtcbiAgICAgIGdvKGRlbHRhKTtcbiAgICB9XG4gIH0gLy8gRW5zdXJlIHRoZSBoYXNoIGlzIGVuY29kZWQgcHJvcGVybHkgYmVmb3JlIGRvaW5nIGFueXRoaW5nIGVsc2UuXG5cblxuICB2YXIgcGF0aCA9IGdldEhhc2hQYXRoKCk7XG4gIHZhciBlbmNvZGVkUGF0aCA9IGVuY29kZVBhdGgocGF0aCk7XG4gIGlmIChwYXRoICE9PSBlbmNvZGVkUGF0aCkgcmVwbGFjZUhhc2hQYXRoKGVuY29kZWRQYXRoKTtcbiAgdmFyIGluaXRpYWxMb2NhdGlvbiA9IGdldERPTUxvY2F0aW9uKCk7XG4gIHZhciBhbGxQYXRocyA9IFtjcmVhdGVQYXRoKGluaXRpYWxMb2NhdGlvbildOyAvLyBQdWJsaWMgaW50ZXJmYWNlXG5cbiAgZnVuY3Rpb24gY3JlYXRlSHJlZihsb2NhdGlvbikge1xuICAgIHZhciBiYXNlVGFnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcJ2Jhc2VcJyk7XG4gICAgdmFyIGhyZWYgPSBcJ1wnO1xuXG4gICAgaWYgKGJhc2VUYWcgJiYgYmFzZVRhZy5nZXRBdHRyaWJ1dGUoXCdocmVmXCcpKSB7XG4gICAgICBocmVmID0gc3RyaXBIYXNoKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaHJlZiArIFwnI1wnICsgZW5jb2RlUGF0aChiYXNlbmFtZSArIGNyZWF0ZVBhdGgobG9jYXRpb24pKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1c2gocGF0aCwgc3RhdGUpIHtcbiAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB2b2lkIDA7XG4gICAgdmFyIGFjdGlvbiA9IFwnUFVTSFwnO1xuICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHBhdGgsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBoaXN0b3J5LmxvY2F0aW9uKTtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5jb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGZ1bmN0aW9uIChvaykge1xuICAgICAgaWYgKCFvaykgcmV0dXJuO1xuICAgICAgdmFyIHBhdGggPSBjcmVhdGVQYXRoKGxvY2F0aW9uKTtcbiAgICAgIHZhciBlbmNvZGVkUGF0aCA9IGVuY29kZVBhdGgoYmFzZW5hbWUgKyBwYXRoKTtcbiAgICAgIHZhciBoYXNoQ2hhbmdlZCA9IGdldEhhc2hQYXRoKCkgIT09IGVuY29kZWRQYXRoO1xuXG4gICAgICBpZiAoaGFzaENoYW5nZWQpIHtcbiAgICAgICAgLy8gV2UgY2Fubm90IHRlbGwgaWYgYSBoYXNoY2hhbmdlIHdhcyBjYXVzZWQgYnkgYSBQVVNILCBzbyB3ZVwnZFxuICAgICAgICAvLyByYXRoZXIgc2V0U3RhdGUgaGVyZSBhbmQgaWdub3JlIHRoZSBoYXNoY2hhbmdlLiBUaGUgY2F2ZWF0IGhlcmVcbiAgICAgICAgLy8gaXMgdGhhdCBvdGhlciBoYXNoIGhpc3RvcmllcyBpbiB0aGUgcGFnZSB3aWxsIGNvbnNpZGVyIGl0IGEgUE9QLlxuICAgICAgICBpZ25vcmVQYXRoID0gcGF0aDtcbiAgICAgICAgcHVzaEhhc2hQYXRoKGVuY29kZWRQYXRoKTtcbiAgICAgICAgdmFyIHByZXZJbmRleCA9IGFsbFBhdGhzLmxhc3RJbmRleE9mKGNyZWF0ZVBhdGgoaGlzdG9yeS5sb2NhdGlvbikpO1xuICAgICAgICB2YXIgbmV4dFBhdGhzID0gYWxsUGF0aHMuc2xpY2UoMCwgcHJldkluZGV4ICsgMSk7XG4gICAgICAgIG5leHRQYXRocy5wdXNoKHBhdGgpO1xuICAgICAgICBhbGxQYXRocyA9IG5leHRQYXRocztcbiAgICAgICAgc2V0U3RhdGUoe1xuICAgICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvblxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICAgICAgc2V0U3RhdGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlcGxhY2UocGF0aCwgc3RhdGUpIHtcbiAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB2b2lkIDA7XG4gICAgdmFyIGFjdGlvbiA9IFwnUkVQTEFDRVwnO1xuICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHBhdGgsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBoaXN0b3J5LmxvY2F0aW9uKTtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5jb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGZ1bmN0aW9uIChvaykge1xuICAgICAgaWYgKCFvaykgcmV0dXJuO1xuICAgICAgdmFyIHBhdGggPSBjcmVhdGVQYXRoKGxvY2F0aW9uKTtcbiAgICAgIHZhciBlbmNvZGVkUGF0aCA9IGVuY29kZVBhdGgoYmFzZW5hbWUgKyBwYXRoKTtcbiAgICAgIHZhciBoYXNoQ2hhbmdlZCA9IGdldEhhc2hQYXRoKCkgIT09IGVuY29kZWRQYXRoO1xuXG4gICAgICBpZiAoaGFzaENoYW5nZWQpIHtcbiAgICAgICAgLy8gV2UgY2Fubm90IHRlbGwgaWYgYSBoYXNoY2hhbmdlIHdhcyBjYXVzZWQgYnkgYSBSRVBMQUNFLCBzbyB3ZVwnZFxuICAgICAgICAvLyByYXRoZXIgc2V0U3RhdGUgaGVyZSBhbmQgaWdub3JlIHRoZSBoYXNoY2hhbmdlLiBUaGUgY2F2ZWF0IGhlcmVcbiAgICAgICAgLy8gaXMgdGhhdCBvdGhlciBoYXNoIGhpc3RvcmllcyBpbiB0aGUgcGFnZSB3aWxsIGNvbnNpZGVyIGl0IGEgUE9QLlxuICAgICAgICBpZ25vcmVQYXRoID0gcGF0aDtcbiAgICAgICAgcmVwbGFjZUhhc2hQYXRoKGVuY29kZWRQYXRoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHByZXZJbmRleCA9IGFsbFBhdGhzLmluZGV4T2YoY3JlYXRlUGF0aChoaXN0b3J5LmxvY2F0aW9uKSk7XG4gICAgICBpZiAocHJldkluZGV4ICE9PSAtMSkgYWxsUGF0aHNbcHJldkluZGV4XSA9IHBhdGg7XG4gICAgICBzZXRTdGF0ZSh7XG4gICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICBsb2NhdGlvbjogbG9jYXRpb25cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ28obikge1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICBnbG9iYWxIaXN0b3J5LmdvKG4pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ29CYWNrKCkge1xuICAgIGdvKC0xKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdvRm9yd2FyZCgpIHtcbiAgICBnbygxKTtcbiAgfVxuXG4gIHZhciBsaXN0ZW5lckNvdW50ID0gMDtcblxuICBmdW5jdGlvbiBjaGVja0RPTUxpc3RlbmVycyhkZWx0YSkge1xuICAgIGxpc3RlbmVyQ291bnQgKz0gZGVsdGE7XG5cbiAgICBpZiAobGlzdGVuZXJDb3VudCA9PT0gMSAmJiBkZWx0YSA9PT0gMSkge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoSGFzaENoYW5nZUV2ZW50JDEsIGhhbmRsZUhhc2hDaGFuZ2UpO1xuICAgIH0gZWxzZSBpZiAobGlzdGVuZXJDb3VudCA9PT0gMCkge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoSGFzaENoYW5nZUV2ZW50JDEsIGhhbmRsZUhhc2hDaGFuZ2UpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBpc0Jsb2NrZWQgPSBmYWxzZTtcblxuICBmdW5jdGlvbiBibG9jayhwcm9tcHQpIHtcbiAgICBpZiAocHJvbXB0ID09PSB2b2lkIDApIHtcbiAgICAgIHByb21wdCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHZhciB1bmJsb2NrID0gdHJhbnNpdGlvbk1hbmFnZXIuc2V0UHJvbXB0KHByb21wdCk7XG5cbiAgICBpZiAoIWlzQmxvY2tlZCkge1xuICAgICAgY2hlY2tET01MaXN0ZW5lcnMoMSk7XG4gICAgICBpc0Jsb2NrZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaXNCbG9ja2VkKSB7XG4gICAgICAgIGlzQmxvY2tlZCA9IGZhbHNlO1xuICAgICAgICBjaGVja0RPTUxpc3RlbmVycygtMSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1bmJsb2NrKCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpc3RlbihsaXN0ZW5lcikge1xuICAgIHZhciB1bmxpc3RlbiA9IHRyYW5zaXRpb25NYW5hZ2VyLmFwcGVuZExpc3RlbmVyKGxpc3RlbmVyKTtcbiAgICBjaGVja0RPTUxpc3RlbmVycygxKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tET01MaXN0ZW5lcnMoLTEpO1xuICAgICAgdW5saXN0ZW4oKTtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGhpc3RvcnkgPSB7XG4gICAgbGVuZ3RoOiBnbG9iYWxIaXN0b3J5Lmxlbmd0aCxcbiAgICBhY3Rpb246IFwnUE9QXCcsXG4gICAgbG9jYXRpb246IGluaXRpYWxMb2NhdGlvbixcbiAgICBjcmVhdGVIcmVmOiBjcmVhdGVIcmVmLFxuICAgIHB1c2g6IHB1c2gsXG4gICAgcmVwbGFjZTogcmVwbGFjZSxcbiAgICBnbzogZ28sXG4gICAgZ29CYWNrOiBnb0JhY2ssXG4gICAgZ29Gb3J3YXJkOiBnb0ZvcndhcmQsXG4gICAgYmxvY2s6IGJsb2NrLFxuICAgIGxpc3RlbjogbGlzdGVuXG4gIH07XG4gIHJldHVybiBoaXN0b3J5O1xufVxuXG5mdW5jdGlvbiBjbGFtcChuLCBsb3dlckJvdW5kLCB1cHBlckJvdW5kKSB7XG4gIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChuLCBsb3dlckJvdW5kKSwgdXBwZXJCb3VuZCk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBoaXN0b3J5IG9iamVjdCB0aGF0IHN0b3JlcyBsb2NhdGlvbnMgaW4gbWVtb3J5LlxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlTWVtb3J5SGlzdG9yeShwcm9wcykge1xuICBpZiAocHJvcHMgPT09IHZvaWQgMCkge1xuICAgIHByb3BzID0ge307XG4gIH1cblxuICB2YXIgX3Byb3BzID0gcHJvcHMsXG4gICAgICBnZXRVc2VyQ29uZmlybWF0aW9uID0gX3Byb3BzLmdldFVzZXJDb25maXJtYXRpb24sXG4gICAgICBfcHJvcHMkaW5pdGlhbEVudHJpZXMgPSBfcHJvcHMuaW5pdGlhbEVudHJpZXMsXG4gICAgICBpbml0aWFsRW50cmllcyA9IF9wcm9wcyRpbml0aWFsRW50cmllcyA9PT0gdm9pZCAwID8gW1wnL1wnXSA6IF9wcm9wcyRpbml0aWFsRW50cmllcyxcbiAgICAgIF9wcm9wcyRpbml0aWFsSW5kZXggPSBfcHJvcHMuaW5pdGlhbEluZGV4LFxuICAgICAgaW5pdGlhbEluZGV4ID0gX3Byb3BzJGluaXRpYWxJbmRleCA9PT0gdm9pZCAwID8gMCA6IF9wcm9wcyRpbml0aWFsSW5kZXgsXG4gICAgICBfcHJvcHMka2V5TGVuZ3RoID0gX3Byb3BzLmtleUxlbmd0aCxcbiAgICAgIGtleUxlbmd0aCA9IF9wcm9wcyRrZXlMZW5ndGggPT09IHZvaWQgMCA/IDYgOiBfcHJvcHMka2V5TGVuZ3RoO1xuICB2YXIgdHJhbnNpdGlvbk1hbmFnZXIgPSBjcmVhdGVUcmFuc2l0aW9uTWFuYWdlcigpO1xuXG4gIGZ1bmN0aW9uIHNldFN0YXRlKG5leHRTdGF0ZSkge1xuICAgIF9leHRlbmRzKGhpc3RvcnksIG5leHRTdGF0ZSk7XG5cbiAgICBoaXN0b3J5Lmxlbmd0aCA9IGhpc3RvcnkuZW50cmllcy5sZW5ndGg7XG4gICAgdHJhbnNpdGlvbk1hbmFnZXIubm90aWZ5TGlzdGVuZXJzKGhpc3RvcnkubG9jYXRpb24sIGhpc3RvcnkuYWN0aW9uKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUtleSgpIHtcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIGtleUxlbmd0aCk7XG4gIH1cblxuICB2YXIgaW5kZXggPSBjbGFtcChpbml0aWFsSW5kZXgsIDAsIGluaXRpYWxFbnRyaWVzLmxlbmd0aCAtIDEpO1xuICB2YXIgZW50cmllcyA9IGluaXRpYWxFbnRyaWVzLm1hcChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICByZXR1cm4gdHlwZW9mIGVudHJ5ID09PSBcJ3N0cmluZ1wnID8gY3JlYXRlTG9jYXRpb24oZW50cnksIHVuZGVmaW5lZCwgY3JlYXRlS2V5KCkpIDogY3JlYXRlTG9jYXRpb24oZW50cnksIHVuZGVmaW5lZCwgZW50cnkua2V5IHx8IGNyZWF0ZUtleSgpKTtcbiAgfSk7IC8vIFB1YmxpYyBpbnRlcmZhY2VcblxuICB2YXIgY3JlYXRlSHJlZiA9IGNyZWF0ZVBhdGg7XG5cbiAgZnVuY3Rpb24gcHVzaChwYXRoLCBzdGF0ZSkge1xuICAgICBmYWxzZSA/IHVuZGVmaW5lZCA6IHZvaWQgMDtcbiAgICB2YXIgYWN0aW9uID0gXCdQVVNIXCc7XG4gICAgdmFyIGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24ocGF0aCwgc3RhdGUsIGNyZWF0ZUtleSgpLCBoaXN0b3J5LmxvY2F0aW9uKTtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5jb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGZ1bmN0aW9uIChvaykge1xuICAgICAgaWYgKCFvaykgcmV0dXJuO1xuICAgICAgdmFyIHByZXZJbmRleCA9IGhpc3RvcnkuaW5kZXg7XG4gICAgICB2YXIgbmV4dEluZGV4ID0gcHJldkluZGV4ICsgMTtcbiAgICAgIHZhciBuZXh0RW50cmllcyA9IGhpc3RvcnkuZW50cmllcy5zbGljZSgwKTtcblxuICAgICAgaWYgKG5leHRFbnRyaWVzLmxlbmd0aCA+IG5leHRJbmRleCkge1xuICAgICAgICBuZXh0RW50cmllcy5zcGxpY2UobmV4dEluZGV4LCBuZXh0RW50cmllcy5sZW5ndGggLSBuZXh0SW5kZXgsIGxvY2F0aW9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHRFbnRyaWVzLnB1c2gobG9jYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBzZXRTdGF0ZSh7XG4gICAgICAgIGFjdGlvbjogYWN0aW9uLFxuICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sXG4gICAgICAgIGluZGV4OiBuZXh0SW5kZXgsXG4gICAgICAgIGVudHJpZXM6IG5leHRFbnRyaWVzXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlcGxhY2UocGF0aCwgc3RhdGUpIHtcbiAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB2b2lkIDA7XG4gICAgdmFyIGFjdGlvbiA9IFwnUkVQTEFDRVwnO1xuICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHBhdGgsIHN0YXRlLCBjcmVhdGVLZXkoKSwgaGlzdG9yeS5sb2NhdGlvbik7XG4gICAgdHJhbnNpdGlvbk1hbmFnZXIuY29uZmlybVRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgYWN0aW9uLCBnZXRVc2VyQ29uZmlybWF0aW9uLCBmdW5jdGlvbiAob2spIHtcbiAgICAgIGlmICghb2spIHJldHVybjtcbiAgICAgIGhpc3RvcnkuZW50cmllc1toaXN0b3J5LmluZGV4XSA9IGxvY2F0aW9uO1xuICAgICAgc2V0U3RhdGUoe1xuICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdvKG4pIHtcbiAgICB2YXIgbmV4dEluZGV4ID0gY2xhbXAoaGlzdG9yeS5pbmRleCArIG4sIDAsIGhpc3RvcnkuZW50cmllcy5sZW5ndGggLSAxKTtcbiAgICB2YXIgYWN0aW9uID0gXCdQT1BcJztcbiAgICB2YXIgbG9jYXRpb24gPSBoaXN0b3J5LmVudHJpZXNbbmV4dEluZGV4XTtcbiAgICB0cmFuc2l0aW9uTWFuYWdlci5jb25maXJtVHJhbnNpdGlvblRvKGxvY2F0aW9uLCBhY3Rpb24sIGdldFVzZXJDb25maXJtYXRpb24sIGZ1bmN0aW9uIChvaykge1xuICAgICAgaWYgKG9rKSB7XG4gICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sXG4gICAgICAgICAgaW5kZXg6IG5leHRJbmRleFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1pbWljIHRoZSBiZWhhdmlvciBvZiBET00gaGlzdG9yaWVzIGJ5XG4gICAgICAgIC8vIGNhdXNpbmcgYSByZW5kZXIgYWZ0ZXIgYSBjYW5jZWxsZWQgUE9QLlxuICAgICAgICBzZXRTdGF0ZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ29CYWNrKCkge1xuICAgIGdvKC0xKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdvRm9yd2FyZCgpIHtcbiAgICBnbygxKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbkdvKG4pIHtcbiAgICB2YXIgbmV4dEluZGV4ID0gaGlzdG9yeS5pbmRleCArIG47XG4gICAgcmV0dXJuIG5leHRJbmRleCA+PSAwICYmIG5leHRJbmRleCA8IGhpc3RvcnkuZW50cmllcy5sZW5ndGg7XG4gIH1cblxuICBmdW5jdGlvbiBibG9jayhwcm9tcHQpIHtcbiAgICBpZiAocHJvbXB0ID09PSB2b2lkIDApIHtcbiAgICAgIHByb21wdCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cmFuc2l0aW9uTWFuYWdlci5zZXRQcm9tcHQocHJvbXB0KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpc3RlbihsaXN0ZW5lcikge1xuICAgIHJldHVybiB0cmFuc2l0aW9uTWFuYWdlci5hcHBlbmRMaXN0ZW5lcihsaXN0ZW5lcik7XG4gIH1cblxuICB2YXIgaGlzdG9yeSA9IHtcbiAgICBsZW5ndGg6IGVudHJpZXMubGVuZ3RoLFxuICAgIGFjdGlvbjogXCdQT1BcJyxcbiAgICBsb2NhdGlvbjogZW50cmllc1tpbmRleF0sXG4gICAgaW5kZXg6IGluZGV4LFxuICAgIGVudHJpZXM6IGVudHJpZXMsXG4gICAgY3JlYXRlSHJlZjogY3JlYXRlSHJlZixcbiAgICBwdXNoOiBwdXNoLFxuICAgIHJlcGxhY2U6IHJlcGxhY2UsXG4gICAgZ286IGdvLFxuICAgIGdvQmFjazogZ29CYWNrLFxuICAgIGdvRm9yd2FyZDogZ29Gb3J3YXJkLFxuICAgIGNhbkdvOiBjYW5HbyxcbiAgICBibG9jazogYmxvY2ssXG4gICAgbGlzdGVuOiBsaXN0ZW5cbiAgfTtcbiAgcmV0dXJuIGhpc3Rvcnk7XG59XG5cblxuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL21pbmktY3JlYXRlLXJlYWN0LWNvbnRleHQvZGlzdC9lc20vaW5kZXguanNcbnZhciBlc20gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTtcblxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9wYXRoLXRvLXJlZ2V4cC9pbmRleC5qc1xudmFyIHBhdGhfdG9fcmVnZXhwID0gX193ZWJwYWNrX3JlcXVpcmVfXygxOCk7XG52YXIgcGF0aF90b19yZWdleHBfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4ocGF0aF90b19yZWdleHApO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXIvZXNtL3JlYWN0LXJvdXRlci5qc1xuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4vLyBUT0RPOiBSZXBsYWNlIHdpdGggUmVhY3QuY3JlYXRlQ29udGV4dCBvbmNlIHdlIGNhbiBhc3N1bWUgUmVhY3QgMTYrXG5cbnZhciByZWFjdF9yb3V0ZXJfY3JlYXRlTmFtZWRDb250ZXh0ID0gZnVuY3Rpb24gY3JlYXRlTmFtZWRDb250ZXh0KG5hbWUpIHtcbiAgdmFyIGNvbnRleHQgPSBPYmplY3QoZXNtWyJhIiAvKiBkZWZhdWx0ICovXSkoKTtcbiAgY29udGV4dC5kaXNwbGF5TmFtZSA9IG5hbWU7XG4gIHJldHVybiBjb250ZXh0O1xufTtcblxudmFyIGhpc3RvcnlDb250ZXh0ID1cbi8qI19fUFVSRV9fKi9cbnJlYWN0X3JvdXRlcl9jcmVhdGVOYW1lZENvbnRleHQoIlJvdXRlci1IaXN0b3J5Iik7XG5cbi8vIFRPRE86IFJlcGxhY2Ugd2l0aCBSZWFjdC5jcmVhdGVDb250ZXh0IG9uY2Ugd2UgY2FuIGFzc3VtZSBSZWFjdCAxNitcblxudmFyIGNyZWF0ZU5hbWVkQ29udGV4dCQxID0gZnVuY3Rpb24gY3JlYXRlTmFtZWRDb250ZXh0KG5hbWUpIHtcbiAgdmFyIGNvbnRleHQgPSBPYmplY3QoZXNtWyJhIiAvKiBkZWZhdWx0ICovXSkoKTtcbiAgY29udGV4dC5kaXNwbGF5TmFtZSA9IG5hbWU7XG4gIHJldHVybiBjb250ZXh0O1xufTtcblxudmFyIHJlYWN0X3JvdXRlcl9jb250ZXh0ID1cbi8qI19fUFVSRV9fKi9cbmNyZWF0ZU5hbWVkQ29udGV4dCQxKCJSb3V0ZXIiKTtcblxuLyoqXG4gKiBUaGUgcHVibGljIEFQSSBmb3IgcHV0dGluZyBoaXN0b3J5IG9uIGNvbnRleHQuXG4gKi9cblxudmFyIHJlYWN0X3JvdXRlcl9Sb3V0ZXIgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgT2JqZWN0KGluaGVyaXRzTG9vc2VbImEiIC8qIGRlZmF1bHQgKi9dKShSb3V0ZXIsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gIFJvdXRlci5jb21wdXRlUm9vdE1hdGNoID0gZnVuY3Rpb24gY29tcHV0ZVJvb3RNYXRjaChwYXRobmFtZSkge1xuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiAiLyIsXG4gICAgICB1cmw6ICIvIixcbiAgICAgIHBhcmFtczoge30sXG4gICAgICBpc0V4YWN0OiBwYXRobmFtZSA9PT0gIi8iXG4gICAgfTtcbiAgfTtcblxuICBmdW5jdGlvbiBSb3V0ZXIocHJvcHMpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfdGhpcyA9IF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcbiAgICBfdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGxvY2F0aW9uOiBwcm9wcy5oaXN0b3J5LmxvY2F0aW9uXG4gICAgfTsgLy8gVGhpcyBpcyBhIGJpdCBvZiBhIGhhY2suIFdlIGhhdmUgdG8gc3RhcnQgbGlzdGVuaW5nIGZvciBsb2NhdGlvblxuICAgIC8vIGNoYW5nZXMgaGVyZSBpbiB0aGUgY29uc3RydWN0b3IgaW4gY2FzZSB0aGVyZSBhcmUgYW55IDxSZWRpcmVjdD5zXG4gICAgLy8gb24gdGhlIGluaXRpYWwgcmVuZGVyLiBJZiB0aGVyZSBhcmUsIHRoZXkgd2lsbCByZXBsYWNlL3B1c2ggd2hlblxuICAgIC8vIHRoZXkgbW91bnQgYW5kIHNpbmNlIGNETSBmaXJlcyBpbiBjaGlsZHJlbiBiZWZvcmUgcGFyZW50cywgd2UgbWF5XG4gICAgLy8gZ2V0IGEgbmV3IGxvY2F0aW9uIGJlZm9yZSB0aGUgPFJvdXRlcj4gaXMgbW91bnRlZC5cblxuICAgIF90aGlzLl9pc01vdW50ZWQgPSBmYWxzZTtcbiAgICBfdGhpcy5fcGVuZGluZ0xvY2F0aW9uID0gbnVsbDtcblxuICAgIGlmICghcHJvcHMuc3RhdGljQ29udGV4dCkge1xuICAgICAgX3RoaXMudW5saXN0ZW4gPSBwcm9wcy5oaXN0b3J5Lmxpc3RlbihmdW5jdGlvbiAobG9jYXRpb24pIHtcbiAgICAgICAgaWYgKF90aGlzLl9pc01vdW50ZWQpIHtcbiAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpcy5fcGVuZGluZ0xvY2F0aW9uID0gbG9jYXRpb247XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIHZhciBfcHJvdG8gPSBSb3V0ZXIucHJvdG90eXBlO1xuXG4gIF9wcm90by5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuX2lzTW91bnRlZCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5fcGVuZGluZ0xvY2F0aW9uKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgbG9jYXRpb246IHRoaXMuX3BlbmRpbmdMb2NhdGlvblxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIF9wcm90by5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIGlmICh0aGlzLnVubGlzdGVuKSB0aGlzLnVubGlzdGVuKCk7XG4gIH07XG5cbiAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX2NvbnRleHQuUHJvdmlkZXIsIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIGhpc3Rvcnk6IHRoaXMucHJvcHMuaGlzdG9yeSxcbiAgICAgICAgbG9jYXRpb246IHRoaXMuc3RhdGUubG9jYXRpb24sXG4gICAgICAgIG1hdGNoOiBSb3V0ZXIuY29tcHV0ZVJvb3RNYXRjaCh0aGlzLnN0YXRlLmxvY2F0aW9uLnBhdGhuYW1lKSxcbiAgICAgICAgc3RhdGljQ29udGV4dDogdGhpcy5wcm9wcy5zdGF0aWNDb250ZXh0XG4gICAgICB9XG4gICAgfSwgcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoaGlzdG9yeUNvbnRleHQuUHJvdmlkZXIsIHtcbiAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNoaWxkcmVuIHx8IG51bGwsXG4gICAgICB2YWx1ZTogdGhpcy5wcm9wcy5oaXN0b3J5XG4gICAgfSkpO1xuICB9O1xuXG4gIHJldHVybiBSb3V0ZXI7XG59KHJlYWN0X2RlZmF1bHQuYS5Db21wb25lbnQpO1xuXG5pZiAoZmFsc2UpIHt9XG5cbi8qKlxuICogVGhlIHB1YmxpYyBBUEkgZm9yIGEgPFJvdXRlcj4gdGhhdCBzdG9yZXMgbG9jYXRpb24gaW4gbWVtb3J5LlxuICovXG5cbnZhciByZWFjdF9yb3V0ZXJfTWVtb3J5Um91dGVyID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gIE9iamVjdChpbmhlcml0c0xvb3NlWyJhIiAvKiBkZWZhdWx0ICovXSkoTWVtb3J5Um91dGVyLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICBmdW5jdGlvbiBNZW1vcnlSb3V0ZXIoKSB7XG4gICAgdmFyIF90aGlzO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIF90aGlzID0gX1JlYWN0JENvbXBvbmVudC5jYWxsLmFwcGx5KF9SZWFjdCRDb21wb25lbnQsIFt0aGlzXS5jb25jYXQoYXJncykpIHx8IHRoaXM7XG4gICAgX3RoaXMuaGlzdG9yeSA9IGNyZWF0ZU1lbW9yeUhpc3RvcnkoX3RoaXMucHJvcHMpO1xuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIHZhciBfcHJvdG8gPSBNZW1vcnlSb3V0ZXIucHJvdG90eXBlO1xuXG4gIF9wcm90by5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9Sb3V0ZXIsIHtcbiAgICAgIGhpc3Rvcnk6IHRoaXMuaGlzdG9yeSxcbiAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNoaWxkcmVuXG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIE1lbW9yeVJvdXRlcjtcbn0ocmVhY3RfZGVmYXVsdC5hLkNvbXBvbmVudCk7XG5cbmlmIChmYWxzZSkge31cblxudmFyIHJlYWN0X3JvdXRlcl9MaWZlY3ljbGUgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgT2JqZWN0KGluaGVyaXRzTG9vc2VbImEiIC8qIGRlZmF1bHQgKi9dKShMaWZlY3ljbGUsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gIGZ1bmN0aW9uIExpZmVjeWNsZSgpIHtcbiAgICByZXR1cm4gX1JlYWN0JENvbXBvbmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gTGlmZWN5Y2xlLnByb3RvdHlwZTtcblxuICBfcHJvdG8uY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5vbk1vdW50KSB0aGlzLnByb3BzLm9uTW91bnQuY2FsbCh0aGlzLCB0aGlzKTtcbiAgfTtcblxuICBfcHJvdG8uY29tcG9uZW50RGlkVXBkYXRlID0gZnVuY3Rpb24gY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLm9uVXBkYXRlKSB0aGlzLnByb3BzLm9uVXBkYXRlLmNhbGwodGhpcywgdGhpcywgcHJldlByb3BzKTtcbiAgfTtcblxuICBfcHJvdG8uY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5vblVubW91bnQpIHRoaXMucHJvcHMub25Vbm1vdW50LmNhbGwodGhpcywgdGhpcyk7XG4gIH07XG5cbiAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICByZXR1cm4gTGlmZWN5Y2xlO1xufShyZWFjdF9kZWZhdWx0LmEuQ29tcG9uZW50KTtcblxuLyoqXG4gKiBUaGUgcHVibGljIEFQSSBmb3IgcHJvbXB0aW5nIHRoZSB1c2VyIGJlZm9yZSBuYXZpZ2F0aW5nIGF3YXkgZnJvbSBhIHNjcmVlbi5cbiAqL1xuXG5mdW5jdGlvbiBQcm9tcHQoX3JlZikge1xuICB2YXIgbWVzc2FnZSA9IF9yZWYubWVzc2FnZSxcbiAgICAgIF9yZWYkd2hlbiA9IF9yZWYud2hlbixcbiAgICAgIHdoZW4gPSBfcmVmJHdoZW4gPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmJHdoZW47XG4gIHJldHVybiByZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfY29udGV4dC5Db25zdW1lciwgbnVsbCwgZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICAhY29udGV4dCA/ICBmYWxzZSA/IHVuZGVmaW5lZCA6IHRpbnlfaW52YXJpYW50X2VzbShmYWxzZSkgOiB2b2lkIDA7XG4gICAgaWYgKCF3aGVuIHx8IGNvbnRleHQuc3RhdGljQ29udGV4dCkgcmV0dXJuIG51bGw7XG4gICAgdmFyIG1ldGhvZCA9IGNvbnRleHQuaGlzdG9yeS5ibG9jaztcbiAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX0xpZmVjeWNsZSwge1xuICAgICAgb25Nb3VudDogZnVuY3Rpb24gb25Nb3VudChzZWxmKSB7XG4gICAgICAgIHNlbGYucmVsZWFzZSA9IG1ldGhvZChtZXNzYWdlKTtcbiAgICAgIH0sXG4gICAgICBvblVwZGF0ZTogZnVuY3Rpb24gb25VcGRhdGUoc2VsZiwgcHJldlByb3BzKSB7XG4gICAgICAgIGlmIChwcmV2UHJvcHMubWVzc2FnZSAhPT0gbWVzc2FnZSkge1xuICAgICAgICAgIHNlbGYucmVsZWFzZSgpO1xuICAgICAgICAgIHNlbGYucmVsZWFzZSA9IG1ldGhvZChtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9uVW5tb3VudDogZnVuY3Rpb24gb25Vbm1vdW50KHNlbGYpIHtcbiAgICAgICAgc2VsZi5yZWxlYXNlKCk7XG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgIH0pO1xuICB9KTtcbn1cblxuaWYgKGZhbHNlKSB7IHZhciBtZXNzYWdlVHlwZTsgfVxuXG52YXIgY2FjaGUgPSB7fTtcbnZhciBjYWNoZUxpbWl0ID0gMTAwMDA7XG52YXIgY2FjaGVDb3VudCA9IDA7XG5cbmZ1bmN0aW9uIGNvbXBpbGVQYXRoKHBhdGgpIHtcbiAgaWYgKGNhY2hlW3BhdGhdKSByZXR1cm4gY2FjaGVbcGF0aF07XG4gIHZhciBnZW5lcmF0b3IgPSBwYXRoX3RvX3JlZ2V4cF9kZWZhdWx0LmEuY29tcGlsZShwYXRoKTtcblxuICBpZiAoY2FjaGVDb3VudCA8IGNhY2hlTGltaXQpIHtcbiAgICBjYWNoZVtwYXRoXSA9IGdlbmVyYXRvcjtcbiAgICBjYWNoZUNvdW50Kys7XG4gIH1cblxuICByZXR1cm4gZ2VuZXJhdG9yO1xufVxuLyoqXG4gKiBQdWJsaWMgQVBJIGZvciBnZW5lcmF0aW5nIGEgVVJMIHBhdGhuYW1lIGZyb20gYSBwYXRoIGFuZCBwYXJhbWV0ZXJzLlxuICovXG5cblxuZnVuY3Rpb24gZ2VuZXJhdGVQYXRoKHBhdGgsIHBhcmFtcykge1xuICBpZiAocGF0aCA9PT0gdm9pZCAwKSB7XG4gICAgcGF0aCA9ICIvIjtcbiAgfVxuXG4gIGlmIChwYXJhbXMgPT09IHZvaWQgMCkge1xuICAgIHBhcmFtcyA9IHt9O1xuICB9XG5cbiAgcmV0dXJuIHBhdGggPT09ICIvIiA/IHBhdGggOiBjb21waWxlUGF0aChwYXRoKShwYXJhbXMsIHtcbiAgICBwcmV0dHk6IHRydWVcbiAgfSk7XG59XG5cbi8qKlxuICogVGhlIHB1YmxpYyBBUEkgZm9yIG5hdmlnYXRpbmcgcHJvZ3JhbW1hdGljYWxseSB3aXRoIGEgY29tcG9uZW50LlxuICovXG5cbmZ1bmN0aW9uIFJlZGlyZWN0KF9yZWYpIHtcbiAgdmFyIGNvbXB1dGVkTWF0Y2ggPSBfcmVmLmNvbXB1dGVkTWF0Y2gsXG4gICAgICB0byA9IF9yZWYudG8sXG4gICAgICBfcmVmJHB1c2ggPSBfcmVmLnB1c2gsXG4gICAgICBwdXNoID0gX3JlZiRwdXNoID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWYkcHVzaDtcbiAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9jb250ZXh0LkNvbnN1bWVyLCBudWxsLCBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICFjb250ZXh0ID8gIGZhbHNlID8gdW5kZWZpbmVkIDogdGlueV9pbnZhcmlhbnRfZXNtKGZhbHNlKSA6IHZvaWQgMDtcbiAgICB2YXIgaGlzdG9yeSA9IGNvbnRleHQuaGlzdG9yeSxcbiAgICAgICAgc3RhdGljQ29udGV4dCA9IGNvbnRleHQuc3RhdGljQ29udGV4dDtcbiAgICB2YXIgbWV0aG9kID0gcHVzaCA/IGhpc3RvcnkucHVzaCA6IGhpc3RvcnkucmVwbGFjZTtcbiAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihjb21wdXRlZE1hdGNoID8gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IGdlbmVyYXRlUGF0aCh0bywgY29tcHV0ZWRNYXRjaC5wYXJhbXMpIDogX2V4dGVuZHMoe30sIHRvLCB7XG4gICAgICBwYXRobmFtZTogZ2VuZXJhdGVQYXRoKHRvLnBhdGhuYW1lLCBjb21wdXRlZE1hdGNoLnBhcmFtcylcbiAgICB9KSA6IHRvKTsgLy8gV2hlbiByZW5kZXJpbmcgaW4gYSBzdGF0aWMgY29udGV4dCxcbiAgICAvLyBzZXQgdGhlIG5ldyBsb2NhdGlvbiBpbW1lZGlhdGVseS5cblxuICAgIGlmIChzdGF0aWNDb250ZXh0KSB7XG4gICAgICBtZXRob2QobG9jYXRpb24pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9MaWZlY3ljbGUsIHtcbiAgICAgIG9uTW91bnQ6IGZ1bmN0aW9uIG9uTW91bnQoKSB7XG4gICAgICAgIG1ldGhvZChsb2NhdGlvbik7XG4gICAgICB9LFxuICAgICAgb25VcGRhdGU6IGZ1bmN0aW9uIG9uVXBkYXRlKHNlbGYsIHByZXZQcm9wcykge1xuICAgICAgICB2YXIgcHJldkxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24ocHJldlByb3BzLnRvKTtcblxuICAgICAgICBpZiAoIWxvY2F0aW9uc0FyZUVxdWFsKHByZXZMb2NhdGlvbiwgX2V4dGVuZHMoe30sIGxvY2F0aW9uLCB7XG4gICAgICAgICAga2V5OiBwcmV2TG9jYXRpb24ua2V5XG4gICAgICAgIH0pKSkge1xuICAgICAgICAgIG1ldGhvZChsb2NhdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0bzogdG9cbiAgICB9KTtcbiAgfSk7XG59XG5cbmlmIChmYWxzZSkge31cblxudmFyIGNhY2hlJDEgPSB7fTtcbnZhciBjYWNoZUxpbWl0JDEgPSAxMDAwMDtcbnZhciBjYWNoZUNvdW50JDEgPSAwO1xuXG5mdW5jdGlvbiBjb21waWxlUGF0aCQxKHBhdGgsIG9wdGlvbnMpIHtcbiAgdmFyIGNhY2hlS2V5ID0gIiIgKyBvcHRpb25zLmVuZCArIG9wdGlvbnMuc3RyaWN0ICsgb3B0aW9ucy5zZW5zaXRpdmU7XG4gIHZhciBwYXRoQ2FjaGUgPSBjYWNoZSQxW2NhY2hlS2V5XSB8fCAoY2FjaGUkMVtjYWNoZUtleV0gPSB7fSk7XG4gIGlmIChwYXRoQ2FjaGVbcGF0aF0pIHJldHVybiBwYXRoQ2FjaGVbcGF0aF07XG4gIHZhciBrZXlzID0gW107XG4gIHZhciByZWdleHAgPSBwYXRoX3RvX3JlZ2V4cF9kZWZhdWx0KCkocGF0aCwga2V5cywgb3B0aW9ucyk7XG4gIHZhciByZXN1bHQgPSB7XG4gICAgcmVnZXhwOiByZWdleHAsXG4gICAga2V5czoga2V5c1xuICB9O1xuXG4gIGlmIChjYWNoZUNvdW50JDEgPCBjYWNoZUxpbWl0JDEpIHtcbiAgICBwYXRoQ2FjaGVbcGF0aF0gPSByZXN1bHQ7XG4gICAgY2FjaGVDb3VudCQxKys7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuLyoqXG4gKiBQdWJsaWMgQVBJIGZvciBtYXRjaGluZyBhIFVSTCBwYXRobmFtZSB0byBhIHBhdGguXG4gKi9cblxuXG5mdW5jdGlvbiBtYXRjaFBhdGgocGF0aG5hbWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkge1xuICAgIG9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgfHwgQXJyYXkuaXNBcnJheShvcHRpb25zKSkge1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICBwYXRoOiBvcHRpb25zXG4gICAgfTtcbiAgfVxuXG4gIHZhciBfb3B0aW9ucyA9IG9wdGlvbnMsXG4gICAgICBwYXRoID0gX29wdGlvbnMucGF0aCxcbiAgICAgIF9vcHRpb25zJGV4YWN0ID0gX29wdGlvbnMuZXhhY3QsXG4gICAgICBleGFjdCA9IF9vcHRpb25zJGV4YWN0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJGV4YWN0LFxuICAgICAgX29wdGlvbnMkc3RyaWN0ID0gX29wdGlvbnMuc3RyaWN0LFxuICAgICAgc3RyaWN0ID0gX29wdGlvbnMkc3RyaWN0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHN0cmljdCxcbiAgICAgIF9vcHRpb25zJHNlbnNpdGl2ZSA9IF9vcHRpb25zLnNlbnNpdGl2ZSxcbiAgICAgIHNlbnNpdGl2ZSA9IF9vcHRpb25zJHNlbnNpdGl2ZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRzZW5zaXRpdmU7XG4gIHZhciBwYXRocyA9IFtdLmNvbmNhdChwYXRoKTtcbiAgcmV0dXJuIHBhdGhzLnJlZHVjZShmdW5jdGlvbiAobWF0Y2hlZCwgcGF0aCkge1xuICAgIGlmICghcGF0aCAmJiBwYXRoICE9PSAiIikgcmV0dXJuIG51bGw7XG4gICAgaWYgKG1hdGNoZWQpIHJldHVybiBtYXRjaGVkO1xuXG4gICAgdmFyIF9jb21waWxlUGF0aCA9IGNvbXBpbGVQYXRoJDEocGF0aCwge1xuICAgICAgZW5kOiBleGFjdCxcbiAgICAgIHN0cmljdDogc3RyaWN0LFxuICAgICAgc2Vuc2l0aXZlOiBzZW5zaXRpdmVcbiAgICB9KSxcbiAgICAgICAgcmVnZXhwID0gX2NvbXBpbGVQYXRoLnJlZ2V4cCxcbiAgICAgICAga2V5cyA9IF9jb21waWxlUGF0aC5rZXlzO1xuXG4gICAgdmFyIG1hdGNoID0gcmVnZXhwLmV4ZWMocGF0aG5hbWUpO1xuICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsO1xuICAgIHZhciB1cmwgPSBtYXRjaFswXSxcbiAgICAgICAgdmFsdWVzID0gbWF0Y2guc2xpY2UoMSk7XG4gICAgdmFyIGlzRXhhY3QgPSBwYXRobmFtZSA9PT0gdXJsO1xuICAgIGlmIChleGFjdCAmJiAhaXNFeGFjdCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAvLyB0aGUgcGF0aCB1c2VkIHRvIG1hdGNoXG4gICAgICB1cmw6IHBhdGggPT09ICIvIiAmJiB1cmwgPT09ICIiID8gIi8iIDogdXJsLFxuICAgICAgLy8gdGhlIG1hdGNoZWQgcG9ydGlvbiBvZiB0aGUgVVJMXG4gICAgICBpc0V4YWN0OiBpc0V4YWN0LFxuICAgICAgLy8gd2hldGhlciBvciBub3Qgd2UgbWF0Y2hlZCBleGFjdGx5XG4gICAgICBwYXJhbXM6IGtleXMucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBrZXksIGluZGV4KSB7XG4gICAgICAgIG1lbW9ba2V5Lm5hbWVdID0gdmFsdWVzW2luZGV4XTtcbiAgICAgICAgcmV0dXJuIG1lbW87XG4gICAgICB9LCB7fSlcbiAgICB9O1xuICB9LCBudWxsKTtcbn1cblxuZnVuY3Rpb24gaXNFbXB0eUNoaWxkcmVuKGNoaWxkcmVuKSB7XG4gIHJldHVybiByZWFjdF9kZWZhdWx0LmEuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pID09PSAwO1xufVxuXG5mdW5jdGlvbiBldmFsQ2hpbGRyZW5EZXYoY2hpbGRyZW4sIHByb3BzLCBwYXRoKSB7XG4gIHZhciB2YWx1ZSA9IGNoaWxkcmVuKHByb3BzKTtcbiAgIGZhbHNlID8gdW5kZWZpbmVkIDogdm9pZCAwO1xuICByZXR1cm4gdmFsdWUgfHwgbnVsbDtcbn1cbi8qKlxuICogVGhlIHB1YmxpYyBBUEkgZm9yIG1hdGNoaW5nIGEgc2luZ2xlIHBhdGggYW5kIHJlbmRlcmluZy5cbiAqL1xuXG5cbnZhciByZWFjdF9yb3V0ZXJfUm91dGUgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgT2JqZWN0KGluaGVyaXRzTG9vc2VbImEiIC8qIGRlZmF1bHQgKi9dKShSb3V0ZSwgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgZnVuY3Rpb24gUm91dGUoKSB7XG4gICAgcmV0dXJuIF9SZWFjdCRDb21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICB9XG5cbiAgdmFyIF9wcm90byA9IFJvdXRlLnByb3RvdHlwZTtcblxuICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX2NvbnRleHQuQ29uc3VtZXIsIG51bGwsIGZ1bmN0aW9uIChjb250ZXh0JDEpIHtcbiAgICAgICFjb250ZXh0JDEgPyAgZmFsc2UgPyB1bmRlZmluZWQgOiB0aW55X2ludmFyaWFudF9lc20oZmFsc2UpIDogdm9pZCAwO1xuICAgICAgdmFyIGxvY2F0aW9uID0gX3RoaXMucHJvcHMubG9jYXRpb24gfHwgY29udGV4dCQxLmxvY2F0aW9uO1xuICAgICAgdmFyIG1hdGNoID0gX3RoaXMucHJvcHMuY29tcHV0ZWRNYXRjaCA/IF90aGlzLnByb3BzLmNvbXB1dGVkTWF0Y2ggLy8gPFN3aXRjaD4gYWxyZWFkeSBjb21wdXRlZCB0aGUgbWF0Y2ggZm9yIHVzXG4gICAgICA6IF90aGlzLnByb3BzLnBhdGggPyBtYXRjaFBhdGgobG9jYXRpb24ucGF0aG5hbWUsIF90aGlzLnByb3BzKSA6IGNvbnRleHQkMS5tYXRjaDtcblxuICAgICAgdmFyIHByb3BzID0gX2V4dGVuZHMoe30sIGNvbnRleHQkMSwge1xuICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sXG4gICAgICAgIG1hdGNoOiBtYXRjaFxuICAgICAgfSk7XG5cbiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLFxuICAgICAgICAgIGNoaWxkcmVuID0gX3RoaXMkcHJvcHMuY2hpbGRyZW4sXG4gICAgICAgICAgY29tcG9uZW50ID0gX3RoaXMkcHJvcHMuY29tcG9uZW50LFxuICAgICAgICAgIHJlbmRlciA9IF90aGlzJHByb3BzLnJlbmRlcjsgLy8gUHJlYWN0IHVzZXMgYW4gZW1wdHkgYXJyYXkgYXMgY2hpbGRyZW4gYnlcbiAgICAgIC8vIGRlZmF1bHQsIHNvIHVzZSBudWxsIGlmIHRoYXRcJ3MgdGhlIGNhc2UuXG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuKSAmJiBjaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY2hpbGRyZW4gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX2NvbnRleHQuUHJvdmlkZXIsIHtcbiAgICAgICAgdmFsdWU6IHByb3BzXG4gICAgICB9LCBwcm9wcy5tYXRjaCA/IGNoaWxkcmVuID8gdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gIGZhbHNlID8gdW5kZWZpbmVkIDogY2hpbGRyZW4ocHJvcHMpIDogY2hpbGRyZW4gOiBjb21wb25lbnQgPyByZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjb21wb25lbnQsIHByb3BzKSA6IHJlbmRlciA/IHJlbmRlcihwcm9wcykgOiBudWxsIDogdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gIGZhbHNlID8gdW5kZWZpbmVkIDogY2hpbGRyZW4ocHJvcHMpIDogbnVsbCk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIFJvdXRlO1xufShyZWFjdF9kZWZhdWx0LmEuQ29tcG9uZW50KTtcblxuaWYgKGZhbHNlKSB7fVxuXG5mdW5jdGlvbiByZWFjdF9yb3V0ZXJfYWRkTGVhZGluZ1NsYXNoKHBhdGgpIHtcbiAgcmV0dXJuIHBhdGguY2hhckF0KDApID09PSAiLyIgPyBwYXRoIDogIi8iICsgcGF0aDtcbn1cblxuZnVuY3Rpb24gYWRkQmFzZW5hbWUoYmFzZW5hbWUsIGxvY2F0aW9uKSB7XG4gIGlmICghYmFzZW5hbWUpIHJldHVybiBsb2NhdGlvbjtcbiAgcmV0dXJuIF9leHRlbmRzKHt9LCBsb2NhdGlvbiwge1xuICAgIHBhdGhuYW1lOiByZWFjdF9yb3V0ZXJfYWRkTGVhZGluZ1NsYXNoKGJhc2VuYW1lKSArIGxvY2F0aW9uLnBhdGhuYW1lXG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZWFjdF9yb3V0ZXJfc3RyaXBCYXNlbmFtZShiYXNlbmFtZSwgbG9jYXRpb24pIHtcbiAgaWYgKCFiYXNlbmFtZSkgcmV0dXJuIGxvY2F0aW9uO1xuICB2YXIgYmFzZSA9IHJlYWN0X3JvdXRlcl9hZGRMZWFkaW5nU2xhc2goYmFzZW5hbWUpO1xuICBpZiAobG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZihiYXNlKSAhPT0gMCkgcmV0dXJuIGxvY2F0aW9uO1xuICByZXR1cm4gX2V4dGVuZHMoe30sIGxvY2F0aW9uLCB7XG4gICAgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lLnN1YnN0cihiYXNlLmxlbmd0aClcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVVSTChsb2NhdGlvbikge1xuICByZXR1cm4gdHlwZW9mIGxvY2F0aW9uID09PSAic3RyaW5nIiA/IGxvY2F0aW9uIDogY3JlYXRlUGF0aChsb2NhdGlvbik7XG59XG5cbmZ1bmN0aW9uIHN0YXRpY0hhbmRsZXIobWV0aG9kTmFtZSkge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgZmFsc2UgPyB1bmRlZmluZWQgOiB0aW55X2ludmFyaWFudF9lc20oZmFsc2UpIDtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbm9vcCgpIHt9XG4vKipcbiAqIFRoZSBwdWJsaWMgdG9wLWxldmVsIEFQSSBmb3IgYSAic3RhdGljIiA8Um91dGVyPiwgc28tY2FsbGVkIGJlY2F1c2UgaXRcbiAqIGNhblwndCBhY3R1YWxseSBjaGFuZ2UgdGhlIGN1cnJlbnQgbG9jYXRpb24uIEluc3RlYWQsIGl0IGp1c3QgcmVjb3Jkc1xuICogbG9jYXRpb24gY2hhbmdlcyBpbiBhIGNvbnRleHQgb2JqZWN0LiBVc2VmdWwgbWFpbmx5IGluIHRlc3RpbmcgYW5kXG4gKiBzZXJ2ZXItcmVuZGVyaW5nIHNjZW5hcmlvcy5cbiAqL1xuXG5cbnZhciByZWFjdF9yb3V0ZXJfU3RhdGljUm91dGVyID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gIE9iamVjdChpbmhlcml0c0xvb3NlWyJhIiAvKiBkZWZhdWx0ICovXSkoU3RhdGljUm91dGVyLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICBmdW5jdGlvbiBTdGF0aWNSb3V0ZXIoKSB7XG4gICAgdmFyIF90aGlzO1xuXG4gICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldO1xuICAgIH1cblxuICAgIF90aGlzID0gX1JlYWN0JENvbXBvbmVudC5jYWxsLmFwcGx5KF9SZWFjdCRDb21wb25lbnQsIFt0aGlzXS5jb25jYXQoYXJncykpIHx8IHRoaXM7XG5cbiAgICBfdGhpcy5oYW5kbGVQdXNoID0gZnVuY3Rpb24gKGxvY2F0aW9uKSB7XG4gICAgICByZXR1cm4gX3RoaXMubmF2aWdhdGVUbyhsb2NhdGlvbiwgIlBVU0giKTtcbiAgICB9O1xuXG4gICAgX3RoaXMuaGFuZGxlUmVwbGFjZSA9IGZ1bmN0aW9uIChsb2NhdGlvbikge1xuICAgICAgcmV0dXJuIF90aGlzLm5hdmlnYXRlVG8obG9jYXRpb24sICJSRVBMQUNFIik7XG4gICAgfTtcblxuICAgIF90aGlzLmhhbmRsZUxpc3RlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBub29wO1xuICAgIH07XG5cbiAgICBfdGhpcy5oYW5kbGVCbG9jayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBub29wO1xuICAgIH07XG5cbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gU3RhdGljUm91dGVyLnByb3RvdHlwZTtcblxuICBfcHJvdG8ubmF2aWdhdGVUbyA9IGZ1bmN0aW9uIG5hdmlnYXRlVG8obG9jYXRpb24sIGFjdGlvbikge1xuICAgIHZhciBfdGhpcyRwcm9wcyA9IHRoaXMucHJvcHMsXG4gICAgICAgIF90aGlzJHByb3BzJGJhc2VuYW1lID0gX3RoaXMkcHJvcHMuYmFzZW5hbWUsXG4gICAgICAgIGJhc2VuYW1lID0gX3RoaXMkcHJvcHMkYmFzZW5hbWUgPT09IHZvaWQgMCA/ICIiIDogX3RoaXMkcHJvcHMkYmFzZW5hbWUsXG4gICAgICAgIF90aGlzJHByb3BzJGNvbnRleHQgPSBfdGhpcyRwcm9wcy5jb250ZXh0LFxuICAgICAgICBjb250ZXh0ID0gX3RoaXMkcHJvcHMkY29udGV4dCA9PT0gdm9pZCAwID8ge30gOiBfdGhpcyRwcm9wcyRjb250ZXh0O1xuICAgIGNvbnRleHQuYWN0aW9uID0gYWN0aW9uO1xuICAgIGNvbnRleHQubG9jYXRpb24gPSBhZGRCYXNlbmFtZShiYXNlbmFtZSwgY3JlYXRlTG9jYXRpb24obG9jYXRpb24pKTtcbiAgICBjb250ZXh0LnVybCA9IGNyZWF0ZVVSTChjb250ZXh0LmxvY2F0aW9uKTtcbiAgfTtcblxuICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIHZhciBfdGhpcyRwcm9wczIgPSB0aGlzLnByb3BzLFxuICAgICAgICBfdGhpcyRwcm9wczIkYmFzZW5hbWUgPSBfdGhpcyRwcm9wczIuYmFzZW5hbWUsXG4gICAgICAgIGJhc2VuYW1lID0gX3RoaXMkcHJvcHMyJGJhc2VuYW1lID09PSB2b2lkIDAgPyAiIiA6IF90aGlzJHByb3BzMiRiYXNlbmFtZSxcbiAgICAgICAgX3RoaXMkcHJvcHMyJGNvbnRleHQgPSBfdGhpcyRwcm9wczIuY29udGV4dCxcbiAgICAgICAgY29udGV4dCA9IF90aGlzJHByb3BzMiRjb250ZXh0ID09PSB2b2lkIDAgPyB7fSA6IF90aGlzJHByb3BzMiRjb250ZXh0LFxuICAgICAgICBfdGhpcyRwcm9wczIkbG9jYXRpb24gPSBfdGhpcyRwcm9wczIubG9jYXRpb24sXG4gICAgICAgIGxvY2F0aW9uID0gX3RoaXMkcHJvcHMyJGxvY2F0aW9uID09PSB2b2lkIDAgPyAiLyIgOiBfdGhpcyRwcm9wczIkbG9jYXRpb24sXG4gICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfdGhpcyRwcm9wczIsIFsiYmFzZW5hbWUiLCAiY29udGV4dCIsICJsb2NhdGlvbiJdKTtcblxuICAgIHZhciBoaXN0b3J5ID0ge1xuICAgICAgY3JlYXRlSHJlZjogZnVuY3Rpb24gY3JlYXRlSHJlZihwYXRoKSB7XG4gICAgICAgIHJldHVybiByZWFjdF9yb3V0ZXJfYWRkTGVhZGluZ1NsYXNoKGJhc2VuYW1lICsgY3JlYXRlVVJMKHBhdGgpKTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb246ICJQT1AiLFxuICAgICAgbG9jYXRpb246IHJlYWN0X3JvdXRlcl9zdHJpcEJhc2VuYW1lKGJhc2VuYW1lLCBjcmVhdGVMb2NhdGlvbihsb2NhdGlvbikpLFxuICAgICAgcHVzaDogdGhpcy5oYW5kbGVQdXNoLFxuICAgICAgcmVwbGFjZTogdGhpcy5oYW5kbGVSZXBsYWNlLFxuICAgICAgZ286IHN0YXRpY0hhbmRsZXIoImdvIiksXG4gICAgICBnb0JhY2s6IHN0YXRpY0hhbmRsZXIoImdvQmFjayIpLFxuICAgICAgZ29Gb3J3YXJkOiBzdGF0aWNIYW5kbGVyKCJnb0ZvcndhcmQiKSxcbiAgICAgIGxpc3RlbjogdGhpcy5oYW5kbGVMaXN0ZW4sXG4gICAgICBibG9jazogdGhpcy5oYW5kbGVCbG9ja1xuICAgIH07XG4gICAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9Sb3V0ZXIsIF9leHRlbmRzKHt9LCByZXN0LCB7XG4gICAgICBoaXN0b3J5OiBoaXN0b3J5LFxuICAgICAgc3RhdGljQ29udGV4dDogY29udGV4dFxuICAgIH0pKTtcbiAgfTtcblxuICByZXR1cm4gU3RhdGljUm91dGVyO1xufShyZWFjdF9kZWZhdWx0LmEuQ29tcG9uZW50KTtcblxuaWYgKGZhbHNlKSB7fVxuXG4vKipcbiAqIFRoZSBwdWJsaWMgQVBJIGZvciByZW5kZXJpbmcgdGhlIGZpcnN0IDxSb3V0ZT4gdGhhdCBtYXRjaGVzLlxuICovXG5cbnZhciByZWFjdF9yb3V0ZXJfU3dpdGNoID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gIE9iamVjdChpbmhlcml0c0xvb3NlWyJhIiAvKiBkZWZhdWx0ICovXSkoU3dpdGNoLCBfUmVhY3QkQ29tcG9uZW50KTtcblxuICBmdW5jdGlvbiBTd2l0Y2goKSB7XG4gICAgcmV0dXJuIF9SZWFjdCRDb21wb25lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICB9XG5cbiAgdmFyIF9wcm90byA9IFN3aXRjaC5wcm90b3R5cGU7XG5cbiAgX3Byb3RvLnJlbmRlciA9IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9jb250ZXh0LkNvbnN1bWVyLCBudWxsLCBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgICAgIWNvbnRleHQgPyAgZmFsc2UgPyB1bmRlZmluZWQgOiB0aW55X2ludmFyaWFudF9lc20oZmFsc2UpIDogdm9pZCAwO1xuICAgICAgdmFyIGxvY2F0aW9uID0gX3RoaXMucHJvcHMubG9jYXRpb24gfHwgY29udGV4dC5sb2NhdGlvbjtcbiAgICAgIHZhciBlbGVtZW50LCBtYXRjaDsgLy8gV2UgdXNlIFJlYWN0LkNoaWxkcmVuLmZvckVhY2ggaW5zdGVhZCBvZiBSZWFjdC5DaGlsZHJlbi50b0FycmF5KCkuZmluZCgpXG4gICAgICAvLyBoZXJlIGJlY2F1c2UgdG9BcnJheSBhZGRzIGtleXMgdG8gYWxsIGNoaWxkIGVsZW1lbnRzIGFuZCB3ZSBkbyBub3Qgd2FudFxuICAgICAgLy8gdG8gdHJpZ2dlciBhbiB1bm1vdW50L3JlbW91bnQgZm9yIHR3byA8Um91dGU+cyB0aGF0IHJlbmRlciB0aGUgc2FtZVxuICAgICAgLy8gY29tcG9uZW50IGF0IGRpZmZlcmVudCBVUkxzLlxuXG4gICAgICByZWFjdF9kZWZhdWx0LmEuQ2hpbGRyZW4uZm9yRWFjaChfdGhpcy5wcm9wcy5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgIGlmIChtYXRjaCA9PSBudWxsICYmIHJlYWN0X2RlZmF1bHQuYS5pc1ZhbGlkRWxlbWVudChjaGlsZCkpIHtcbiAgICAgICAgICBlbGVtZW50ID0gY2hpbGQ7XG4gICAgICAgICAgdmFyIHBhdGggPSBjaGlsZC5wcm9wcy5wYXRoIHx8IGNoaWxkLnByb3BzLmZyb207XG4gICAgICAgICAgbWF0Y2ggPSBwYXRoID8gbWF0Y2hQYXRoKGxvY2F0aW9uLnBhdGhuYW1lLCBfZXh0ZW5kcyh7fSwgY2hpbGQucHJvcHMsIHtcbiAgICAgICAgICAgIHBhdGg6IHBhdGhcbiAgICAgICAgICB9KSkgOiBjb250ZXh0Lm1hdGNoO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtYXRjaCA/IHJlYWN0X2RlZmF1bHQuYS5jbG9uZUVsZW1lbnQoZWxlbWVudCwge1xuICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sXG4gICAgICAgIGNvbXB1dGVkTWF0Y2g6IG1hdGNoXG4gICAgICB9KSA6IG51bGw7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIFN3aXRjaDtcbn0ocmVhY3RfZGVmYXVsdC5hLkNvbXBvbmVudCk7XG5cbmlmIChmYWxzZSkge31cblxuLyoqXG4gKiBBIHB1YmxpYyBoaWdoZXItb3JkZXIgY29tcG9uZW50IHRvIGFjY2VzcyB0aGUgaW1wZXJhdGl2ZSBBUElcbiAqL1xuXG5mdW5jdGlvbiB3aXRoUm91dGVyKENvbXBvbmVudCkge1xuICB2YXIgZGlzcGxheU5hbWUgPSAid2l0aFJvdXRlcigiICsgKENvbXBvbmVudC5kaXNwbGF5TmFtZSB8fCBDb21wb25lbnQubmFtZSkgKyAiKSI7XG5cbiAgdmFyIEMgPSBmdW5jdGlvbiBDKHByb3BzKSB7XG4gICAgdmFyIHdyYXBwZWRDb21wb25lbnRSZWYgPSBwcm9wcy53cmFwcGVkQ29tcG9uZW50UmVmLFxuICAgICAgICByZW1haW5pbmdQcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHByb3BzLCBbIndyYXBwZWRDb21wb25lbnRSZWYiXSk7XG5cbiAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX2NvbnRleHQuQ29uc3VtZXIsIG51bGwsIGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICAhY29udGV4dCA/ICBmYWxzZSA/IHVuZGVmaW5lZCA6IHRpbnlfaW52YXJpYW50X2VzbShmYWxzZSkgOiB2b2lkIDA7XG4gICAgICByZXR1cm4gcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQ29tcG9uZW50LCBfZXh0ZW5kcyh7fSwgcmVtYWluaW5nUHJvcHMsIGNvbnRleHQsIHtcbiAgICAgICAgcmVmOiB3cmFwcGVkQ29tcG9uZW50UmVmXG4gICAgICB9KSk7XG4gICAgfSk7XG4gIH07XG5cbiAgQy5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuICBDLldyYXBwZWRDb21wb25lbnQgPSBDb21wb25lbnQ7XG5cbiAgaWYgKGZhbHNlKSB7fVxuXG4gIHJldHVybiBob2lzdF9ub25fcmVhY3Rfc3RhdGljc19janNfZGVmYXVsdCgpKEMsIENvbXBvbmVudCk7XG59XG5cbnZhciB1c2VDb250ZXh0ID0gcmVhY3RfZGVmYXVsdC5hLnVzZUNvbnRleHQ7XG5mdW5jdGlvbiB1c2VIaXN0b3J5KCkge1xuICBpZiAoZmFsc2UpIHt9XG5cbiAgcmV0dXJuIHVzZUNvbnRleHQoaGlzdG9yeUNvbnRleHQpO1xufVxuZnVuY3Rpb24gdXNlTG9jYXRpb24oKSB7XG4gIGlmIChmYWxzZSkge31cblxuICByZXR1cm4gdXNlQ29udGV4dChyZWFjdF9yb3V0ZXJfY29udGV4dCkubG9jYXRpb247XG59XG5mdW5jdGlvbiB1c2VQYXJhbXMoKSB7XG4gIGlmIChmYWxzZSkge31cblxuICB2YXIgbWF0Y2ggPSB1c2VDb250ZXh0KHJlYWN0X3JvdXRlcl9jb250ZXh0KS5tYXRjaDtcbiAgcmV0dXJuIG1hdGNoID8gbWF0Y2gucGFyYW1zIDoge307XG59XG5mdW5jdGlvbiB1c2VSb3V0ZU1hdGNoKHBhdGgpIHtcbiAgaWYgKGZhbHNlKSB7fVxuXG4gIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7XG4gIHZhciBtYXRjaCA9IHVzZUNvbnRleHQocmVhY3Rfcm91dGVyX2NvbnRleHQpLm1hdGNoO1xuICByZXR1cm4gcGF0aCA/IG1hdGNoUGF0aChsb2NhdGlvbi5wYXRobmFtZSwgcGF0aCkgOiBtYXRjaDtcbn1cblxuaWYgKGZhbHNlKSB7IHZhciBzZWNvbmRhcnlCdWlsZE5hbWUsIGluaXRpYWxCdWlsZE5hbWUsIGJ1aWxkTmFtZXMsIHJlYWN0X3JvdXRlcl9rZXksIGdsb2JhbDsgfVxuXG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlYWN0LXJvdXRlci5qcy5tYXBcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2hlbHBlcnMvZm9ybWF0cy1saXN0LmpzXG5jb25zdCBnZXRGcHMgPSByZWMgPT4gKHJlYy5mcHMgPiAzMCA/IHJlYy5mcHMgOiAzMCk7XG5cbmNvbnN0IHN0cmVhbU9iaiA9IHN0cmVhbUxpc3QgPT4gc3RyZWFtTGlzdC5sZW5ndGggJiYgc3RyZWFtTGlzdFxuICAucmVkdWNlKChhY2MsIHJlYykgPT4ge1xuICAgIGNvbnN0IGZwcyA9IGdldEZwcyhyZWMpO1xuICAgIGFjY1tyZWMucXVhbGl0eU51bV0gPSB7XG4gICAgICAuLi5yZWMsXG4gICAgICBmcHMsXG4gICAgfTtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG5cbmNvbnN0IGZvcm1hdHNfbGlzdF92aWRlb09iaiA9IChcbiAgdmlkZW9MaXN0LFxuICBzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCxcbiAgc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24sXG4gIGNvbnRlbnRMaW1pdCxcbikgPT4gdmlkZW9MaXN0Lmxlbmd0aCAmJiB2aWRlb0xpc3RcbiAgLmZpbHRlcihpdGVtID0+IChcbiAgICAoImNvbnRlbnRMZW5ndGgiIGluIGl0ZW0pICYmICFOdW1iZXIuaXNOYU4oaXRlbS5jb250ZW50TGVuZ3RoKVxuICApKVxuICAucmVkdWNlKChhY2MsIHJlYykgPT4ge1xuICAgIGNvbnN0IHsgcXVhbGl0eU51bSB9ID0gcmVjO1xuICAgIGNvbnN0IGZwcyA9IGdldEZwcyhyZWMpO1xuICAgIGNvbnN0IHNldEl0ZW0gPSAoKSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0gKHJlYy5tdXhhYmxlICYmIChyZWMuY29udGVudExlbmd0aCA+IGNvbnRlbnRMaW1pdCkpID8gKFxuICAgICAgICBzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCAmJiB7XG4gICAgICAgICAgYXZhaWxhYmxlSW5VZGw6IHRydWUsXG4gICAgICAgICAgLi4ucmVjLFxuICAgICAgICAgIGZwcyxcbiAgICAgICAgfVxuICAgICAgKSA6IChcbiAgICAgICAgc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24gJiYge1xuICAgICAgICAgIGNvbnZlcnNpb25SZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAuLi5yZWMsXG4gICAgICAgICAgZnBzLFxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgaWYgKCEocXVhbGl0eU51bSBpbiBhY2MpKSBhY2NbcXVhbGl0eU51bV0gPSB7fTtcbiAgICAgICAgYWNjW3F1YWxpdHlOdW1dW2Zwc10gPSBpdGVtO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKChxdWFsaXR5TnVtIGluIGFjYykgJiYgKGZwcyBpbiBhY2NbcXVhbGl0eU51bV0pKSB7XG4gICAgICBjb25zdCBpdGVtID0gYWNjW3F1YWxpdHlOdW1dW2Zwc107XG4gICAgICBjb25zdCBpc0l0ZW1NcDQgPSBpdGVtLnR5cGUgPT09ICJtcDQiO1xuICAgICAgY29uc3QgaXNSZWNNcDQgPSByZWMudHlwZSA9PT0gIm1wNCI7XG4gICAgICBjb25zdCBpc1JlY0JpdHJhdGVIaWdoZXIgPSBpdGVtLm9iai5iaXRyYXRlIDwgcmVjLm9iai5iaXRyYXRlO1xuICAgICAgaWYgKCghaXNJdGVtTXA0ICYmIGlzUmVjTXA0KSB8fFxuICAgICAgICAoaXNJdGVtTXA0ICYmIGlzUmVjTXA0ICYmIGlzUmVjQml0cmF0ZUhpZ2hlcikgfHxcbiAgICAgICAgKCFpc0l0ZW1NcDQgJiYgIWlzUmVjTXA0ICYmIGlzUmVjQml0cmF0ZUhpZ2hlcilcbiAgICAgICkge1xuICAgICAgICBzZXRJdGVtKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldEl0ZW0oKTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfSwge30pO1xuXG5jb25zdCBmb3JtYXRzX2xpc3RfYXVkaW9PYmogPSBhdWRpb0xpc3QgPT4gYXVkaW9MaXN0Lmxlbmd0aCAmJiBhdWRpb0xpc3RcbiAgLnJlZHVjZSgocHJldiwgY3VycmVudCkgPT4ge1xuICAgIGNvbnN0IGlzUHJldk1wMyA9IHByZXYubWltZVR5cGUuaW5jbHVkZXMoImF1ZGlvL21wMyIpO1xuICAgIGNvbnN0IGlzQ3VycmVudE1wMyA9IGN1cnJlbnQubWltZVR5cGUuaW5jbHVkZXMoImF1ZGlvL21wMyIpO1xuICAgIGNvbnN0IGlzUHJldk1wNCA9IHByZXYubWltZVR5cGUuaW5jbHVkZXMoImF1ZGlvL21wNCIpO1xuICAgIGNvbnN0IGlzQ3VycmVudE1wNCA9IGN1cnJlbnQubWltZVR5cGUuaW5jbHVkZXMoImF1ZGlvL21wNCIpO1xuICAgIGNvbnN0IGlzQ3VycmVudEJpdHJhdGVIaWdoZXIgPSBwcmV2LmJpdHJhdGUgPCBjdXJyZW50LmJpdHJhdGU7XG4gICAgaWYgKFxuICAgICAgKCFpc1ByZXZNcDMgJiYgaXNDdXJyZW50TXAzKSB8fFxuICAgICAgKGlzUHJldk1wMyAmJiBpc0N1cnJlbnRNcDMgJiYgaXNDdXJyZW50Qml0cmF0ZUhpZ2hlcikgfHxcbiAgICAgICghaXNQcmV2TXA0ICYmIGlzQ3VycmVudE1wNCkgfHxcbiAgICAgIChpc1ByZXZNcDQgJiYgaXNDdXJyZW50TXA0ICYmIGlzQ3VycmVudEJpdHJhdGVIaWdoZXIpIHx8XG4gICAgICAoIWlzUHJldk1wMyAmJiAhaXNDdXJyZW50TXAzICYmICFpc1ByZXZNcDQgJiYgIWlzQ3VycmVudE1wNCAmJiBpc0N1cnJlbnRCaXRyYXRlSGlnaGVyKVxuICAgICkge1xuICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBwcmV2O1xuICB9KTtcblxuY29uc3Qgc29ydERlc2NlbmRpbmcgPSBhcnIgPT4gYXJyLnNvcnQoKGEsIGIpID0+IGIgLSBhKTtcblxuY29uc3QgZ2V0TWF4UXVhbGl0eU51bSA9IG9iaiA9PiBvYmogJiYgT2JqZWN0LmtleXMob2JqKS5yZWR1Y2UoKGEsIGIpID0+IChhID09PSAxMDgwID8gYSA6IE1hdGgubWF4KGEsIGIpKSwgMCk7XG5cbmNvbnN0IGZvcm1hdHNMaXN0ID0gKFxuICBzdHJlYW1JbmZvLFxuICB2aWRlb0luZm8sXG4gIGF1ZGlvSW5mbyxcbiAgc2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwsXG4gIHNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uLFxuICBjb250ZW50TGltaXQsXG4gIGxvYWRNb3JlLFxuKSA9PiB7XG4gIGNvbnN0IHNPYmogPSBzdHJlYW1PYmooc3RyZWFtSW5mbyB8fCBbXSk7XG5cbiAgY29uc3Qgdk9iaiA9IGZvcm1hdHNfbGlzdF92aWRlb09iaihcbiAgICB2aWRlb0luZm8gfHwgW10sXG4gICAgc2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwsXG4gICAgc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24sXG4gICAgY29udGVudExpbWl0LFxuICApO1xuXG4gIGNvbnN0IGFPYmogPSBmb3JtYXRzX2xpc3RfYXVkaW9PYmooYXVkaW9JbmZvIHx8IFtdKTtcblxuICBsZXQgbGlzdCA9IFtdO1xuICBjb25zdCBzT2JqTWF4UXVhbGl0eU51bSA9IGdldE1heFF1YWxpdHlOdW0oc09iaik7XG4gIGNvbnN0IHZPYmpNYXhRdWFsaXR5TnVtID0gZ2V0TWF4UXVhbGl0eU51bSh2T2JqKTtcbiAgY29uc3QgZGVtb1F1YWxpdHlOdW0gPSBNYXRoLm1heChzT2JqTWF4UXVhbGl0eU51bSwgdk9iak1heFF1YWxpdHlOdW0pO1xuICBjb25zdCBtaW5RdWFsaXR5TnVtID0gZGVtb1F1YWxpdHlOdW0gPj0gMzYwID8gMzYwIDogMDtcbiAgY29uc3Qgc0RlbW8gPSBzT2JqICYmIHNPYmpbZGVtb1F1YWxpdHlOdW1dO1xuICBjb25zdCB2RGVtbyA9IHZPYmogJiYgdk9ialtkZW1vUXVhbGl0eU51bV07XG4gIGNvbnN0IHNEZW1vRnBzID0gc0RlbW8gPyBzRGVtby5mcHMgOiAtMTtcbiAgY29uc3QgdkRlbW9MaXN0ID0gdkRlbW8gJiYgT2JqZWN0LmtleXModkRlbW8pO1xuICBjb25zdCB2RGVtb0ZwcyA9ICh2RGVtb0xpc3QgJiYgdkRlbW9MaXN0Lmxlbmd0aCkgPyB2RGVtb0xpc3QucmVkdWNlKChhLCBiKSA9PiAodkRlbW9bYV0uZnBzID4gdkRlbW9bYl0uZnBzID8gYSA6IGIpKSA6IC0xO1xuICBpZiAodkRlbW9GcHMgPiBzRGVtb0ZwcykgbGlzdC5wdXNoKHZEZW1vW3ZEZW1vRnBzXSk7XG4gIGxpc3QgPSBbXG4gICAgLi4ubGlzdCxcbiAgICAuLi5zb3J0RGVzY2VuZGluZyhPYmplY3Qua2V5cyhzT2JqKSlcbiAgICAgIC5tYXAocmVjID0+IHNPYmpbcmVjXSksXG4gIF07XG5cbiAgY29uc3Qgdk9iakZwcyA9IE9iamVjdC5rZXlzKHZPYmopXG4gICAgLnJlZHVjZSgoYWNjLCBxdWFsaXR5TnVtKSA9PiB7XG4gICAgICBjb25zdCBpdGVtID0gdk9ialtxdWFsaXR5TnVtXTtcbiAgICAgIE9iamVjdC5rZXlzKGl0ZW0pLm1hcCgoZnBzKSA9PiB7XG4gICAgICAgIGlmICghKGZwcyBpbiBhY2MpKSBhY2NbZnBzXSA9IHt9O1xuICAgICAgICBhY2NbZnBzXVtxdWFsaXR5TnVtXSA9IGl0ZW1bZnBzXTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30pO1xuXG4gIGNvbnN0IHZMaXN0ID0gc29ydERlc2NlbmRpbmcoT2JqZWN0LmtleXModk9iakZwcykpXG4gICAgLnJlZHVjZSgoYWNjLCBmcHMpID0+IHtcbiAgICAgIHNvcnREZXNjZW5kaW5nKE9iamVjdC5rZXlzKHZPYmpGcHNbZnBzXSkpXG4gICAgICAgIC5tYXAoKHF1YWxpdHlOdW0pID0+IHtcbiAgICAgICAgICBpZiAocXVhbGl0eU51bSA+PSBtaW5RdWFsaXR5TnVtKSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtID0gdk9iakZwc1tmcHNdW3F1YWxpdHlOdW1dO1xuICAgICAgICAgICAgbGV0IGlzRXhpc3QgPSBmYWxzZTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICBjb25zdCByZWMgPSBsaXN0W2ldO1xuICAgICAgICAgICAgICBpZiAoaXRlbS5xdWFsaXR5TnVtID09PSByZWMucXVhbGl0eU51bSAmJiBpdGVtLmZwcyA9PT0gcmVjLmZwcykge1xuICAgICAgICAgICAgICAgIGlzRXhpc3QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWlzRXhpc3QpIGFjYy5wdXNoKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIFtdKTtcblxuICBjb25zdCBzaG93TW9yZUZvcm1hdHMgPSBsb2FkTW9yZSB8fCB2TGlzdC5sZW5ndGggPCAzO1xuICBpZiAoYU9iaikgbGlzdC5wdXNoKGFPYmopO1xuICBpZiAoc2hvd01vcmVGb3JtYXRzKSB7XG4gICAgbGlzdCA9IFtcbiAgICAgIC4uLmxpc3QsXG4gICAgICAuLi52TGlzdCxcbiAgICBdO1xuICB9XG5cbiAgaWYgKGxpc3QubGVuZ3RoID4gMCkge1xuICAgIGlmIChzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCkge1xuICAgICAgbGlzdCA9IFtcbiAgICAgICAgLi4ubGlzdCxcbiAgICAgICAgeyBhdmFpbGFibGVJblVkbDogdHJ1ZSwgbWltZVR5cGU6ICJhdWRpby9tcDMiIH0sXG4gICAgICBdO1xuICAgIH1cbiAgICBsaXN0ID0gW1xuICAgICAgLi4ubGlzdCxcbiAgICAgIHsgZG93bmxvYWRVc2luZ1VkbDogdHJ1ZSB9LFxuICAgIF07XG4gIH1cblxuICByZXR1cm4geyBsaXN0LCBzaG93TW9yZUZvcm1hdHMgfTtcbn07XG5cbmNvbnN0IGZvcm1hdHNMaXN0RW1iZWQgPSAoXG4gIHN0cmVhbUluZm8sXG4gIGF1ZGlvSW5mbyxcbikgPT4ge1xuICBjb25zdCBzT2JqID0gc3RyZWFtT2JqKHN0cmVhbUluZm8gfHwgW10pO1xuICBjb25zdCBsaXN0ID0gc29ydERlc2NlbmRpbmcoT2JqZWN0LmtleXMoc09iaikpXG4gICAgLm1hcChyZWMgPT4gc09ialtyZWNdKTtcbiAgY29uc3QgYU9iaiA9IGZvcm1hdHNfbGlzdF9hdWRpb09iaihhdWRpb0luZm8gfHwgW10pO1xuICBpZiAoYU9iaikgbGlzdC5wdXNoKGFPYmopO1xuICByZXR1cm4gbGlzdDtcbn07XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL3BhZ2UvY29udGFpbmVyLmpzeFxuXG5cblxuY29uc3QgU2NvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYmFja2dyb3VuZCB8fCAid2hpdGUifTtcbiAgYm9yZGVyOiAxcHggc29saWQgJHtwcm9wcyA9PiBwcm9wcy5ib3JkZXJDb2xvciB8fCAiYmxhY2sifTtcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xuICBib3gtc2hhZG93OiAwIDAgOHB4ICR7cHJvcHMgPT4gcHJvcHMuYm94U2hhZG93Q29sb3IgfHwgInJnYmEoMCwwLDAsMC41KSJ9O1xuICBjdXJzb3I6IGRlZmF1bHQ7XG4gIHVzZXItc2VsZWN0OiBub25lO1xuICBmb250LWZhbWlseTogc2Fucy1zZXJpZjtcbiAgd2lkdGg6IDQ2MHB4O1xuYDtcblxuY29uc3QgY29udGFpbmVyX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lXG59KTtcblxuY29uc3QgQ29udGFpbmVyID0gKHtcbiAgY2hpbGRyZW5cbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3Rvcihjb250YWluZXJfbWFwU3RhdGUpO1xuICBjb25zdCBnbG9iYWxzID0gdGhlbWUgJiYgdGhlbWUuZ2xvYmFscztcbiAgY29uc3QgYmFja2dyb3VuZCA9IGdsb2JhbHMgJiYgZ2xvYmFscy5iYWNrZ3JvdW5kO1xuICBjb25zdCBib3JkZXJDb2xvciA9IGdsb2JhbHMgJiYgZ2xvYmFscy5ib3JkZXI7XG4gIGNvbnN0IGJveFNoYWRvd0NvbG9yID0gZ2xvYmFscyAmJiBnbG9iYWxzLnNoYWRvdztcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChTY29udGFpbmVyLCB7XG4gICAgYmFja2dyb3VuZDogYmFja2dyb3VuZCxcbiAgICBib3JkZXJDb2xvcjogYm9yZGVyQ29sb3IsXG4gICAgYm94U2hhZG93Q29sb3I6IGJveFNoYWRvd0NvbG9yXG4gIH0sIGNoaWxkcmVuKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGNvbnRhaW5lciA9IChDb250YWluZXIpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvcGFnZS9oZWFkZXIuanN4XG5cblxuXG5cbmNvbnN0IFN0SGVhZGVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmg0YFxuICBtYXJnaW46IDAgMTZweDtcbiAgZm9udC1zaXplOiAxNnB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBsaW5lLWhlaWdodDogNDhweDtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3IgfHwgImJsYWNrIn07XG5gO1xuXG5jb25zdCBoZWFkZXJfbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICB0aGVtZTogc3RhdGUudGhlbWVcbn0pO1xuXG5jb25zdCBIZWFkZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdGhlbWVcbiAgfSA9IHVzZVNlbGVjdG9yX3VzZVNlbGVjdG9yKGhlYWRlcl9tYXBTdGF0ZSk7XG4gIGNvbnN0IGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTtcbiAgY29uc3QgcGF0aG5hbWUgPSBsb2NhdGlvbiAmJiBsb2NhdGlvbi5wYXRobmFtZTtcbiAgY29uc3QgY29sb3IgPSBwYXRobmFtZSA9PT0gIi9hZHZlcnQiID8gdGhlbWUgJiYgdGhlbWUuYWR2ZXJ0ICYmIHRoZW1lLmFkdmVydC50aXRsZV9jb2xvciA6IHRoZW1lICYmIHRoZW1lLmhlYWRlcjtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChTdEhlYWRlciwge1xuICAgIGNvbG9yOiBjb2xvclxuICB9LCBjaGlsZHJlbik7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBwYWdlX2hlYWRlciA9IChIZWFkZXIpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvaGVhcnQuanN4XG5cblxuY29uc3QgSWNvbkhlYXJ0ID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMTguN3B4IixcbiAgdmlld0JveDogIjAgMCAyMSAxOC43IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDIxIDUuOCBRIDIxIDQuNjUgMjAuNiAzLjYgMjAuMTUgMi41NSAxOS4zIDEuNyAxOC41IDAuODUgMTcuNCAwLjQ1IDE2LjM1IDAgMTUuMiAwIDE0LjA1IDAgMTIuOTUgMC40NSAxMS45IDAuODUgMTEuMSAxLjcgTCAxMC41IDIuMyA5LjkgMS43IFEgOS4xIDAuODUgOC4wNSAwLjQ1IDcgMCA1LjggMCA0LjY1IDAgMy42IDAuNDUgMi41IDAuODUgMS43IDEuNyAwLjg1IDIuNTUgMC40IDMuNiAwIDQuNjUgMCA1LjggMCA2Ljk1IDAuNCA4IDAuODUgOS4xIDEuNyA5LjkgTCAxMC41IDE4LjcgMTkuMyA5LjkgUSAyMC4xNSA5LjEgMjAuNiA4IDIxIDYuOTUgMjEgNS44IE0gMTUuMiAxLjIgUSAxNi4xIDEuMiAxNi45NSAxLjU1IDE3LjggMS45IDE4LjQ1IDIuNTUgMTkuMSAzLjIgMTkuNDUgNC4xIDE5LjggNC45IDE5LjggNS44IDE5LjggNi43IDE5LjQ1IDcuNTUgMTkuMSA4LjQgMTguNDUgOS4wNSBMIDEwLjUgMTcgMi41NSA5LjA1IFEgMS45IDguNCAxLjU1IDcuNTUgMS4yNSA2LjcgMS4yNSA1LjggMS4yNSA0LjkgMS41NSA0LjEgMS45IDMuMiAyLjU1IDIuNTUgMy4yIDEuOSA0LjA1IDEuNTUgNC45IDEuMiA1LjggMS4yIDYuNzUgMS4yIDcuNTUgMS41NSA4LjQgMS45IDkuMDUgMi41NSBMIDEwLjUgNCAxMS45NSAyLjU1IFEgMTIuNiAxLjkgMTMuNDUgMS41NSAxNC4zIDEuMiAxNS4yIDEuMiBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBoZWFydCA9IChJY29uSGVhcnQpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvZ2Vhci5qc3hcblxuXG5jb25zdCBJY29uR2VhciA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjFweCIsXG4gIGhlaWdodDogIjIxcHgiLFxuICB2aWV3Qm94OiAiMCAwIDIxIDIxIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xOS41LDcuOGwtMS0wLjJjLTAuMS0wLjMtMC4yLTAuNS0wLjMtMC43bDAuNi0wLjhjMC41LTAuNywwLjQtMS43LTAuMi0yLjRsLTEuMi0xLjJDMTcsIDIuMSwxNi41LDEuOSwxNiwxLjljLTAuNCwwLTAuOCwwLjEtMS4xLDAuM2wtMC44LDAuNmMtMC4zLTAuMS0wLjUtMC4yLTAuOC0wLjNsLTAuMi0xQzEzLCAwLjYsMTIuMiwwLDExLjMsMEg5LjZDOC43LDAsNy45LDAuNiw3LjgsMS41bC0wLjIsMUM3LjQsMi43LDcuMSwyLjgsNi45LDIuOUw2LDIuM0M1LjcsIDIuMSw1LjMsMS45LDUsMS45Yy0wLjUsMC0xLDAuMi0xLjMsMC41TDIuNCwzLjdDMS44LDQuNCwxLjcsNS4zLDIuMiw2LjFsMC42LDAuOUMyLjcsNy4yLCAyLjYsNy40LDIuNSw3LjdsLTEsMC4yQzAuNiw4LDAsOC44LDAsOS43djEuN2MwLDAuOSwwLjYsMS43LDEuNSwxLjhsMSwwLjJjMC4xLDAuMywwLjIsIDAuNSwwLjMsMC43TDIuMywxNWMtMC41LDAuNy0wLjQsMS43LDAuMiwyLjRsMS4yLDEuMmMwLjMsMC4zLDAuOCwwLjUsMS4zLDAuNWMwLjQsMCwgMC44LTAuMSwxLjEtMC4zbDAuOS0wLjZjMC4yLDAuMSwwLjUsMC4yLDAuNywwLjNsMC4yLDFDOCwyMC40LDguNywyMSw5LjYsMjFoMS43YzAuOSwwLCAxLjctMC42LDEuOC0xLjVsMC4yLTFjMC4zLTAuMSwwLjUtMC4yLDAuNy0wLjNsMC44LDAuNmMwLjMsMC4yLDAuNywwLjMsMS4xLDAuM2MwLjUsMCwgMS0wLjIsMS4zLTAuNWwxLjItMS4yYzAuNi0wLjYsMC43LTEuNiwwLjItMi40bC0wLjYtMC44YzAuMS0wLjIsMC4yLTAuNSwwLjMtMC43bDEtMC4yYzAuOS0wLjEsIDEuNS0wLjksMS41LTEuOFY5LjZDMjEsOC43LDIwLjQsOCwxOS41LDcuOHogTTE5LjgsMTEuNGMwLDAuMy0wLjIsMC41LTAuNSwwLjZsLTEuNCwwLjJjLTAuMywgMC0wLjUsMC4yLTAuNSwwLjVjLTAuMSwwLjQtMC4zLDAuOC0wLjUsMS4yYy0wLjEsMC4yLTAuMSwwLjUsMCwwLjdsMC44LDEuMWMwLjIsMC4yLDAuMSwgMC42LTAuMSwwLjhsLTEuMiwxLjJjLTAuMSwwLjEtMC4zLDAuMi0wLjQsMC4yYy0wLjEsMC0wLjIsMC0wLjQtMC4xbC0xLjEtMC44Yy0wLjItMC4xLTAuNS0wLjItMC43LCAwYy0wLjQsMC4yLTAuOCwwLjQtMS4yLDAuNWMtMC4yLDAuMS0wLjQsMC4zLTAuNSwwLjVMMTIsMTkuM2MwLDAuMy0wLjMsMC41LTAuNiwwLjVIOS42Yy0wLjMsIDAtMC41LTAuMi0wLjYtMC41bC0wLjItMS40YzAtMC4yLTAuMi0wLjUtMC41LTAuNWMtMC40LTAuMS0wLjgtMC4zLTEuMS0wLjVjLTAuMS0wLjEtMC4yLTAuMS0wLjMtMC4xYy0wLjEsIDAtMC4zLDAtMC40LDAuMWwtMS4xLDAuOGMtMC4xLDAuMS0wLjIsMC4xLTAuMywwLjFjLTAuMiwgMC0wLjMtMC4xLTAuNC0wLjJsLTEuMi0xLjJjLTAuMi0wLjItMC4yLTAuNS0wLjEtMC44bDAuOC0xLjFjMC4xLTAuMiwwLjItMC41LCAwLTAuN2MtMC4yLTAuNC0wLjQtMC44LTAuNS0xLjJjLTAuMS0wLjItMC4zLTAuNC0wLjUtMC41TDEuNywxMmMtMC4zLDAtMC41LTAuMy0wLjUtMC42VjkuN2MwLTAuMywgMC4yLTAuNSwwLjUtMC42bDEuMy0wLjJjMC4zLDAsMC41LTAuMiwwLjUtMC41QzMuNyw4LDMuOSw3LjYsNC4xLDcuMkM0LjIsNyw0LjIsNi43LDQsNi41TDMuMiwgNS40QzMuMSw1LjEsMy4xLDQuOCwzLjMsNC42bDEuMi0xLjJsMCwwQzQuNiwzLjIsNC44LDMuMiw1LDMuMmMwLjEsMCwwLjIsMCwwLjQsMC4xbDEuMSwgMC44YzAuMiwwLjEsMC41LDAuMiwwLjcsMGMwLjQtMC4yLDAuOC0wLjQsMS4yLTAuNWMwLjItMC4xLDAuNC0wLjMsMC41LTAuNUw5LDEuN2MwLTAuMywgMC4zLTAuNSwwLjYtMC41aDEuN2MwLjMsMCwwLjUsMC4yLDAuNiwwLjVsMC4yLDEuM2MwLDAuMywwLjIsMC41LDAuNSwwLjVjMC40LDAuMSwwLjgsMC4zLCAxLjIsMC41YzAuMiwwLjEsMC41LDAuMSwwLjcsMGwxLjEtMC44YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xYzAuMiwwLDAuMywwLjEsMC40LDAuMmwxLjIsIDEuMmMwLjIsMC4yLDAuMiwwLjUsMC4xLDAuOGwtMC44LDEuMWMtMC4xLDAuMi0wLjIsMC41LDAsMC43YzAuMiwwLjQsMC40LDAuOCwwLjUsMS4yYzAuMSwgMC4yLDAuMywwLjQsMC41LDAuNUwxOS4zLDlsMCwwYzAuMywwLDAuNSwwLjMsMC41LDAuNlYxMS40eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTEwLjUsNi40Yy0yLjMsMC00LjEsMS44LTQuMSw0LjFzMS44LDQuMSw0LjEsNC4xczQuMS0xLjgsNC4xLTQuMVMxMi44LDYuNCwxMC41LCA2LjR6IE0xMC41LDEzLjRjLTEuNiwwLTIuOS0xLjMtMi45LTIuOXMxLjMtMi45LDIuOS0yLjlzMi45LDEuMywyLjksIDIuOVMxMi4xLDEzLjQsMTAuNSwxMy40eiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZ2VhciA9IChJY29uR2Vhcik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9oZWxwLmpzeFxuXG5cbmNvbnN0IEljb25IZWxwID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxOS4xcHgiLFxuICBoZWlnaHQ6ICIyMXB4IixcbiAgdmlld0JveDogIjAgMCAxOS4xIDIxIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk05LjQsNS43Yy0xLjksMC0yLjgsMS4xLTIuOCwxLjljMCwwLjYsMC41LDAuOCwwLjksMC44YzAuOCwwLDAuNS0xLjEsMS45LTEuMWMwLjcsMCwgMS4zLDAuMywxLjMsMWMwLDAuOC0wLjgsMS4yLTEuMywxLjZjLTAuNCwwLjQtMSwwLjktMSwyLjJjMCwwLjcsMC4yLDEsMC44LDFjMC43LDAsIDAuOC0wLjMsMC44LTAuNmMwLTAuNywwLTEuMiwwLjgtMS44YzAuNC0wLjMsMS42LTEuMywxLjYtMi42UzExLjMsNS43LDkuNCw1Ljd6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNOS4yLDE0LjFjLTAuNiwwLTEuMSwwLjUtMS4xLDEuMWMwLDAuNiwwLjUsMS4xLDEuMSwxLjFjMC42LDAsMS4xLTAuNSwgMS4xLTEuMUMxMC4zLDE0LjYsOS44LDE0LjEsOS4yLDE0LjF6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNMTcuNCw0bC02LjItMy42Yy0xLTAuNi0yLjMtMC42LTMuNCwwTDEuNyw0QzAuNiw0LjYsMCw1LjcsMCw2Ljl2Ny4xYzAsMS4yLDAuNiwyLjMsIDEuNywyLjlsNi4yLDMuNmMxLDAuNiwyLjMsMC42LDMuNCwwbDYuMi0zLjZjMS0wLjYsMS43LTEuNywxLjctMi45VjYuOUMxOS4xLDUuNywxOC41LCA0LjYsMTcuNCw0eiBNMTcuNSwxNC4xYzAsMC42LTAuMywxLjItMC45LDEuNWwtNi4yLDMuNmMtMC41LDAuMy0xLjIsMC4zLTEuNywgMGwtNi4yLTMuNmMtMC41LTAuMy0wLjktMC45LTAuOS0xLjVWNi45YzAtMC42LDAuMy0xLjIsMC45LTEuNWw2LjItMy42YzAuNS0wLjMsIDEuMi0wLjMsMS43LDBsNi4yLDMuNmMwLjUsMC4zLDAuOSwwLjksMC45LDEuNUwxNy41LDE0LjFMMTcuNSwxNC4xeiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgaGVscCA9IChJY29uSGVscCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9mZWVkYmFjay5qc3hcblxuXG5jb25zdCBJY29uRmVlZGJhY2sgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjE4LjVweCIsXG4gIGhlaWdodDogIjIxcHgiLFxuICB2aWV3Qm94OiAiMCAwIDE4LjUgMjEiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTkuMiwyLjVjLTIuNCwwLTQuMywxLjktNC4zLDQuM2MwLDEuNSwwLjcsMi44LDIsMy42YzEuMywwLjgsMi44LDAuOSw0LjMsIDAuMmMwLjMtMC4xLDAuNC0wLjUsMC4zLTAuOGMtMC4xLTAuMy0wLjUtMC40LTAuOC0wLjNDOS42LDEwLDguNSw5LjksNy42LCA5LjRDNi43LDguOCw2LjIsNy44LDYuMiw2LjhjMC0xLjcsMS40LTMuMSwzLjEtMy4xczMuMSwxLjQsMy4xLDMuMWMwLCAwLjMtMC4zLDAuNi0wLjYsMC42Yy0wLjMsMC0wLjYtMC4yLTAuNi0wLjZjMCwwLDAsMCwwLDBjMC0xLTAuOC0xLjgtMS44LTEuOFM3LjQsIDUuOCw3LjQsNi44czAuOCwxLjgsMS44LDEuOGMwLjUsMCwwLjktMC4yLDEuMi0wLjVjMC4zLDAuMywwLjgsMC41LDEuMiwgMC41YzEsMCwxLjgtMC44LDEuOC0xLjhDMTMuNSw0LjQsMTEuNiwyLjUsOS4yLDIuNXogTTkuOCw2LjljMCwwLjMtMC4zLCAwLjUtMC42LDAuNWMtMC4zLDAtMC42LTAuMy0wLjYtMC42YzAtMC4zLDAuMy0wLjYsMC42LTAuNmMwLjMsMCwwLjYsMC4yLCAwLjYsMC41QzkuOCw2LjgsOS44LDYuOCw5LjgsNi45eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTE4LjUsOC4xYzAtMC4yLTAuMS0wLjMtMC4yLTAuNEwxNiw1LjRWMC42QzE2LDAuMywxNS43LDAsMTUuNCwwSDMuMUMyLjcsIDAsMi41LDAuMywyLjUsMC42djQuN0wwLjIsNy42YzAsMCwwLDAsMCwwQzAuMSw3LjgsMCw3LjksMCw4LjFjMCwwLDAsMCwwLCAwdjExLjFjMCwxLDAuOCwxLjgsMS44LDEuOGgxNC44YzEsMCwxLjgtMC44LDEuOC0xLjhMMTguNSw4LjFDMTguNSw4LjEsIDE4LjUsOC4xLDE4LjUsOC4xeiBNMTYsNy4xbDEsMWwtMSwxVjcuMXogTTMuNyw1LjZDMy43LDUuNiwzLjcsNS42LDMuNywgNS42VjEuMmgxMS4xdjQuNGMwLDAsMCwwLDAsMHY0LjdsLTMuMywzLjNIN2wtMy4zLTMuM1Y1LjZ6IE0yLjUsNy4xdjJsLTEtMUwyLjUsIDcuMXpNMS4yLDE4LjlWOS42bDQuNyw0LjdMMS4yLDE4Ljl6IE0yLjEsMTkuOEw3LDE0LjhoNC40bDQuOSwgNC45SDIuMXogTTE3LjIsMTguOWwtNC43LTQuN2w0LjctNC43VjE4Ljl6IlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBmZWVkYmFjayA9IChJY29uRmVlZGJhY2spO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvYXJyb3ctYmFjay5qc3hcblxuXG5jb25zdCBJY29uQXJyb3dCYWNrID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNnB4IixcbiAgaGVpZ2h0OiAiMTZweCIsXG4gIHZpZXdCb3g6ICIwIDAgMTYgMTYiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTE2LDkuNXYtM0g2LjJsMy42LTIuOFYwLjJMMCw3LjlsOS44LDcuOXYtMy41TDYuMyw5LjVIMTZ6IlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBhcnJvd19iYWNrID0gKEljb25BcnJvd0JhY2spO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvcGFnZS9mb290ZXIuanN4XG5cblxuXG5cblxuXG5cblxuXG5cblxuY29uc3QgZm9vdGVyX0NvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIG1hcmdpbjogMCAxNnB4O1xuICBwYWRkaW5nOiAxMHB4IDAgMTRweDtcbiAgZGlzcGxheTogZmxleDtcbiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICR7cHJvcHMgPT4gcHJvcHMuYm9yZGVyVG9wfTtcbiAgJHtwcm9wcyA9PiBwcm9wcy5qdXN0aWZ5Q29udGVudEVuZCAmJiAianVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsifVxuICAmIGJ1dHRvbiB7XG4gICAgJiBzdmcgcGF0aCB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uQ29sb3J9OyB9XG4gICAgJiBzcGFuIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uQ29sb3J9OyB9XG4gICAgJjpob3ZlciB7XG4gICAgICAmIHN2ZyBwYXRoIHsgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5idXR0b25Ib3ZlckNvbG9yfTsgfVxuICAgICAgJiBzcGFuIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uSG92ZXJDb2xvcn07IH1cbiAgICB9XG4gIH1cbmA7XG5jb25zdCBCdXR0b24gPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uYnV0dG9uYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDtcbiAgb3V0bGluZTogbm9uZTtcbiAgYm9yZGVyOiBub25lO1xuICBwYWRkaW5nOiAwO1xuICBkaXNwbGF5OiBpbmxpbmUtZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICAke3Byb3BzID0+IHByb3BzLnNwYWNlQmV0d2VlbiAmJiAibWFyZ2luOiAwIDIwcHg7In1cbmA7XG5jb25zdCBCdXR0b25CYWNrID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGJvcmRlcjogbm9uZTtcbiAgbWFyZ2luOiAycHggMDtcbiAgcGFkZGluZzogMDtcbiAgZGlzcGxheTogaW5saW5lLWZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgJiBzdmcge1xuICAgICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAicnRsIiAmJiAidHJhbnNmb3JtOiBzY2FsZTNkKC0xLCAxLCAxKTsifVxuICB9XG5gO1xuY29uc3QgVGV4dEJhY2sgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uc3BhbmBcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgZm9udC1zaXplOiAxNHB4O1xuICAmOjpiZWZvcmUge1xuICAgIGNvbnRlbnQ6ICIgIjtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgd2lkdGg6IDlweDtcbiAgfVxuYDtcblxuY29uc3QgZm9vdGVyX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgZGlyOiBzdGF0ZS5kaXIsXG4gIHRoZW1lOiBzdGF0ZS50aGVtZSxcbiAgc2VuZEV2ZW50OiBzdGF0ZS5zZW5kRXZlbnQsXG4gIGRvd25sb2Fkc0NvdW50OiBzdGF0ZS5kb3dubG9hZHNDb3VudFxufSk7XG5cbmNvbnN0IEZvb3RlciA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIGRpcixcbiAgICB0aGVtZSxcbiAgICBzZW5kRXZlbnQsXG4gICAgZG93bmxvYWRzQ291bnRcbiAgfSA9IHVzZVNlbGVjdG9yX3VzZVNlbGVjdG9yKGZvb3Rlcl9tYXBTdGF0ZSk7XG4gIGNvbnN0IGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTtcbiAgY29uc3Qge1xuICAgIHQsXG4gICAgaTE4blxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgY29uc3QgcGF0aG5hbWUgPSBsb2NhdGlvbiAmJiBsb2NhdGlvbi5wYXRobmFtZTtcbiAgY29uc3QgaXNIb21lID0gcGF0aG5hbWUgPT09ICIvIjtcbiAgY29uc3QgYm9yZGVyVG9wID0gdGhlbWUgJiYgdGhlbWUuZm9vdGVyX2JvcmRlcl90b3A7XG4gIGNvbnN0IGJ1dHRvblN0eWxlcyA9IHRoZW1lICYmIHRoZW1lLmljb25fYnV0dG9uO1xuICBjb25zdCBidXR0b25Db2xvciA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuY29sb3I7XG4gIGNvbnN0IGJ1dHRvbkhvdmVyQ29sb3IgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmhvdmVyO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGZvb3Rlcl9Db250YWluZXIsIHtcbiAgICBqdXN0aWZ5Q29udGVudEVuZDogaXNIb21lLFxuICAgIGJvcmRlclRvcDogYm9yZGVyVG9wLFxuICAgIGJ1dHRvbkNvbG9yOiBidXR0b25Db2xvcixcbiAgICBidXR0b25Ib3ZlckNvbG9yOiBidXR0b25Ib3ZlckNvbG9yXG4gIH0sIGlzSG9tZSA/IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIGRvd25sb2Fkc0NvdW50ID4gMCAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQnV0dG9uLCB7XG4gICAgb25DbGljazogZXZ0ID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAic2hhcmUiXG4gICAgICB9KTtcbiAgICAgIGhpc3RvcnkucHVzaCgiL2FkdmVydCIpO1xuICAgIH0sXG4gICAgc3BhY2VCZXR3ZWVuOiB0cnVlXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChoZWFydCwgbnVsbCkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQnV0dG9uLCB7XG4gICAgb25DbGljazogZXZ0ID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAic2V0dGluZ3MiXG4gICAgICB9KTtcbiAgICAgIGhpc3RvcnkucHVzaCgiL3NldHRpbmdzIik7XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoZ2VhciwgbnVsbCkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQnV0dG9uLCB7XG4gICAgb25DbGljazogKCkgPT4ge1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAiaGVscCJcbiAgICAgIH0pO1xuICAgICAgaGlzdG9yeS5wdXNoKCIvaGVscCIpO1xuICAgIH0sXG4gICAgc3BhY2VCZXR3ZWVuOiB0cnVlXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChoZWxwLCBudWxsKSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChCdXR0b24sIHtcbiAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGxhbmd1YWdlXG4gICAgICB9ID0gaTE4bjtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgdHlwZVxuICAgICAgfSA9IGNvbmZpZ1siYSIgLyogZGVmYXVsdCAqL107XG4gICAgICBjb25zdCBsYW5kaW5nVXJsID0gYGh0dHBzOi8vdW5pZG93bmxvYWRlci5jb20vJHtsYW5ndWFnZX0vY29udGFjdC11cz9mcm9tXyR7dHlwZSA9PT0gInVkbC11c3JzY3IiID8gInVzcnNjciIgOiAiZXh0In09MWA7XG4gICAgICB3aW5kb3cub3BlbihsYW5kaW5nVXJsLCAiX2JsYW5rIik7XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoZmVlZGJhY2ssIG51bGwpKSkgOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQnV0dG9uQmFjaywge1xuICAgIGRpcjogZGlyLFxuICAgIG9uQ2xpY2s6ICgpID0+IGhpc3RvcnkuZ28oLTEpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcnJvd19iYWNrLCBudWxsKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFRleHRCYWNrLCBudWxsLCB0KCJyZXR1cm5fdG9fdGhlX3ByZXZpb3VzX3NjcmVlbiIpKSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZm9vdGVyID0gKEZvb3Rlcik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9lcnJvci1ib3VuZGFyeS5qc3hcblxuXG5cbmNsYXNzIGVycm9yX2JvdW5kYXJ5X0Vycm9yQm91bmRhcnkgZXh0ZW5kcyByZWFjdFsiQ29tcG9uZW50Il0ge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgaGFzRXJyb3I6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoKSB7XG4gICAgLy8gVXBkYXRlIHN0YXRlIHNvIHRoZSBuZXh0IHJlbmRlciB3aWxsIHNob3cgdGhlIGZhbGxiYWNrIFVJLlxuICAgIHJldHVybiB7XG4gICAgICBoYXNFcnJvcjogdHJ1ZVxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRDYXRjaChlcnJvciwgZXJyb3JJbmZvKSB7XG4gICAgLy8gWW91IGNhbiBhbHNvIGxvZyB0aGUgZXJyb3IgdG8gYW4gZXJyb3IgcmVwb3J0aW5nIHNlcnZpY2VcbiAgICBjb25zb2xlLmxvZyhlcnJvciwgZXJyb3JJbmZvKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjaGlsZHJlbixcbiAgICAgIHRoZW1lLFxuICAgICAgZW1iZWRcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBoYXNFcnJvclxuICAgIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGdsb2JhbHMgPSB0aGVtZSAmJiB0aGVtZS5nbG9iYWxzO1xuICAgIGNvbnN0IGNvbG9yID0gZ2xvYmFscyAmJiBnbG9iYWxzLmNvbG9yO1xuXG4gICAgaWYgKGhhc0Vycm9yKSB7XG4gICAgICAvLyBZb3UgY2FuIHJlbmRlciBhbnkgY3VzdG9tIGZhbGxiYWNrIFVJXG4gICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gICAgICAgIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICAgICAgICB3aWR0aDogIjM4cHgiLFxuICAgICAgICBoZWlnaHQ6ICIzNHB4IixcbiAgICAgICAgdmlld0JveDogIjAgMCAzOCAzNCIsXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgd2lkdGg6IGVtYmVkICYmIDIwLFxuICAgICAgICAgIGhlaWdodDogIjEwMCUiXG4gICAgICAgIH1cbiAgICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgICAgICAgZmlsbDogZW1iZWQgPyAid2hpdGUiIDogY29sb3IsXG4gICAgICAgIGQ6ICIgTSAzOCAxNyBRIDM4IDkuOTUgMzIuNCA1IDI2Ljg1IDAgMTkgMCAxMS4xNSAwIDUuNTUgNSAwIDkuOTUgMCAxNyAwIDIyLjE5ODA0Njg3NSAzIDI2LjI1IEwgMCAzNCA5LjI1IDMxLjY1IFEgMTMuNjA4MjAzMTI1IDM0IDE5IDM0IDI2Ljg1IDM0IDMyLjQgMjkgMzggMjQuMDUgMzggMTcgTSAyMy45IDkgTCAyNS4wNSAxMC4yIDI2LjI1IDkgUSAyNy41IDcuNzUgMjguNzUgOSAyOS45NSAxMC4yNSAyOC43NSAxMS40NSBMIDI3LjU1IDEyLjY1IDI4LjggMTMuOSBRIDMwLjA1IDE1LjE1IDI4LjggMTYuMzUgMjcuNTUgMTcuNiAyNi4zIDE2LjM1IEwgMjUuMDUgMTUuMSAyMy44NSAxNi4zIFEgMjIuNiAxNy41NSAyMS40IDE2LjM1IDIwLjE1IDE1LjEgMjEuNCAxMy44NSBMIDIyLjYgMTIuNjUgMjEuNDUgMTEuNSBRIDIwLjI1IDEwLjI1IDIxLjUgOSAyMi43IDcuOCAyMy45IDkgTSAxMS43NSA4Ljk1IEwgMTMgMTAuMTUgMTQuMiA4Ljk1IFEgMTUuNCA3LjcgMTYuNjUgOSAxNy44NSAxMC4yIDE2LjY1IDExLjQgTCAxNS40NSAxMi42IDE2LjY1IDEzLjggUSAxNy45IDE1LjA1IDE2LjcgMTYuMjUgMTUuNDUgMTcuNSAxNC4yIDE2LjI1IEwgMTMgMTUuMDUgMTEuNzUgMTYuMjUgUSAxMC41IDE3LjUgOS4zIDE2LjMgOC4wNSAxNS4wNSA5LjMgMTMuOCBMIDEwLjUgMTIuNiA5LjMgMTEuNCBRIDguMSAxMC4yIDkuMzUgOC45NSAxMC41NSA3LjcgMTEuNzUgOC45NSBNIDguNjUgMjMuMSBRIDE5LjM1IDE3Ljc1IDI5LjQgMjMuMSBMIDI5LjQgMjUuNyBRIDE5LjM1IDIwLjM1IDguNjUgMjUuNyBMIDguNjUgMjMuMSBaIlxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZHJlbjtcbiAgfVxuXG59XG5cbmNvbnN0IGVycm9yX2JvdW5kYXJ5X21hcFN0YXRlVG9Qcm9wcyA9IHN0YXRlID0+ICh7XG4gIHRoZW1lOiBzdGF0ZS50aGVtZVxufSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGVycm9yX2JvdW5kYXJ5ID0gKGNvbm5lY3RfY29ubmVjdChlcnJvcl9ib3VuZGFyeV9tYXBTdGF0ZVRvUHJvcHMpKGVycm9yX2JvdW5kYXJ5X0Vycm9yQm91bmRhcnkpKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL3BhZ2UvaW5kZXguanN4XG5cblxuXG5cblxuXG5cbmNvbnN0IFBhZ2UgPSAoe1xuICBjaGlsZHJlbixcbiAgdGl0bGVcbn0pID0+IHtcbiAgY29uc3QgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpO1xuICBjb25zdCBwYXRobmFtZSA9IGxvY2F0aW9uICYmIGxvY2F0aW9uLnBhdGhuYW1lO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGVycm9yX2JvdW5kYXJ5LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY29udGFpbmVyLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocGFnZV9oZWFkZXIsIG51bGwsIHRpdGxlKSwgY2hpbGRyZW4sIHBhdGhuYW1lICE9PSAiL2FkdmVydCIgJiYgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGZvb3RlciwgbnVsbCkpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHBhZ2UgPSAoUGFnZSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy91bmlkb3dubG9hZGVyLmpzeFxuXG5cbmNvbnN0IEljb25Vbmlkb3dubG9hZGVyID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNy43cHgiLFxuICBoZWlnaHQ6ICIyMHB4IixcbiAgdmlld0JveDogIjAgMCAxNy43IDIwIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0wLDUuOWgyLjlWNWw4LjgsNC45djAuMUwyLjksMTVWOS4xSDBWMjBMMTcuNyw5LjhMMCwwVjUuOXoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHVuaWRvd25sb2FkZXIgPSAoSWNvblVuaWRvd25sb2FkZXIpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvY3B1LWFjdGl2aXR5LmpzeFxuXG5cbmNvbnN0IEljb25DcHVBY3Rpdml0eSA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMThweCIsXG4gIGhlaWdodDogIjE4cHgiLFxuICB2aWV3Qm94OiAiMCAwIDE4IDE4IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xMC45LDZjLTAuMi0wLjEtMC4zLDAtMC41LDAuMXMtMC4yLDAuMy0wLjIsMC40bC0xLjEsNC4xTDcuNywgNS41YzAtMC4xLTAuMS0wLjMtMC4yLTAuNEM3LjMsNSw3LjIsNSw3LDVDNi45LDUuMSw2LjgsNS4yLDYuNywgNS4zTDUuMSw5LjFINC40Yy0wLjEsMC0wLjMsMC0wLjQsMC4xQzQsOS4zLDMuOSw5LjQsMy45LDkuNmMwLDAuMiwwLDAuMywwLjIsIDAuNGMwLjEsMC4xLDAuMywwLjEsMC40LDAuMWwwLjksMGwwLDBjMC40LDAsMC41LTAuMywwLjYtMC40bDEuMS0yLjVsMS41LCA1LjVjMC4xLDAuMiwwLjEsMC4zLDAuMiwwLjRjMC4xLDAuMSwwLjIsMC4xLDAuNCwwLjFjMC4xLDAsMC4yLTAuMSwgMC4zLTAuMmMwLjEtMC4xLDAuMS0wLjMsMC4yLTAuNGwwLDBsMS4xLTMuOWwwLjQsMS40aDIuM2MwLjEsMCwwLjMtMC4xLCAwLjQtMC4xQzEzLjksOS45LDE0LDkuOCwxNCwgOS42cy0wLjEtMC4zLTAuMS0wLjRjLTAuMS0wLjEtMC4zLTAuMS0wLjQtMC4xaC0xLjVsLTAuOC0yLjdDMTEuMSw2LjIsMTEuMSwgNi4xLDEwLjksNiBNMTcuOSw1LjhjLTAuMS0wLjEtMC4zLTAuMi0wLjQtMC4yaC0yLjJjLTAuMSwwLTAuMywwLjEtMC40LCAwLjJjLTAuMSwwLjEtMC4xLDAuMi0wLjIsMC4zdjguNUgzLjNWMy4zaDExLjR2MS40YzAsMC4xLDAuMSwwLjMsMC4yLCAwLjRjMC4xLDAuMSwwLjIsMC4yLDAuNCwwLjJzMC4zLDAsMC40LTAuMmMwLjEtMC4xLDAuMS0wLjMsIDAuMi0wLjRWMy4zYzAtMC4zLTAuMS0wLjUtMC40LTAuN2MtMC4zLTAuMy0wLjYtMC40LTAuOS0wLjRoLTIuMVYwLjZjMC0wLjEtMC4xLTAuMy0wLjItMC40QzEyLjEsIDAuMSwxMiwwLDExLjgsMGMtMC4yLDAtMC4zLDAuMS0wLjQsMC4yYy0wLjEsMC4xLTAuMSwwLjMtMC4xLCAwLjR2MS43SDkuNlYwLjZjMC0wLjEtMC4xLTAuMy0wLjItMC40QzkuMywwLjEsOS4yLDAsOSwwUzguNywwLjEsOC42LDAuMkM4LjUsIDAuMyw4LjQsMC40LDguNCwwLjZ2MS43SDYuOFYwLjZjMC0wLjEsMC0wLjMtMC4yLTAuNEM2LjUsMC4xLDYuNCwwLDYuMiwwQzYsIDAsNS45LDAuMSw1LjgsMC4yQzUuNywwLjMsNS43LDAuNCw1LjcsMC42djEuN0gzLjVjLTAuMywwLTAuNiwwLjEtMC45LDAuNEMyLjQsIDIuOCwyLjMsMywyLjIsMy4zdjIuNEgwLjZjLTAuMSwwLTAuMywwLjEtMC40LDAuMkMwLjEsNS45LDAsNiwwLDYuMmMwLDAuMiwwLjEsIDAuMywwLjIsMC40YzAuMSwwLjEsMC4zLDAuMiwwLjQsMC4yaDEuN3YxLjdIMC42Yy0wLjEsMC0wLjMsMC4xLTAuNCwwLjJDMC4xLDguNywgMCw4LjgsMCw5czAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMmgxLjd2MS43SDAuNmMtMC4xLDAtMC4zLDAuMS0wLjQsIDAuMUMwLjEsMTEuNSwwLDExLjYsMCwxMS44YzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMmgxLjd2Mi4zYzAsIDAuMywwLjIsMC41LDAuMywwLjdjMC4zLDAuMywwLjYsMC40LDAuOSwwLjRoMi4ydjEuN2MwLDAuMSwwLjEsMC4zLDAuMiwwLjRDNS45LDE3LjksIDYsMTgsNi4yLDE4YzAuMiwwLDAuMy0wLjEsMC40LTAuMWMwLjEtMC4xLDAuMi0wLjMsMC4yLTAuNHYtMS43aDEuN3YxLjdjMCwwLjEsMC4xLDAuMywgMC4yLDAuNEM4LjcsMTcuOSw4LjgsMTgsOSwxOHMwLjMtMC4xLDAuNC0wLjFjMC4xLTAuMSwwLjItMC4zLDAuMi0wLjR2LTEuN2gxLjd2MS43YzAsIDAuMSwwLjEsMC4zLDAuMSwwLjRjMC4xLDAuMSwwLjIsMC4xLDAuNCwwLjFjMC4yLDAsMC4zLTAuMSwwLjQtMC4xYzAuMS0wLjEsMC4yLTAuMywgMC4yLTAuNHYtMS43aDIuM2MwLjMsMCwwLjUtMC4xLDAuNy0wLjRjMC4zLTAuMywwLjQtMC42LDAuNC0wLjl2LTIuMmgxLjdjMC4xLDAsMC4zLTAuMSwgMC40LTAuMmMwLjEtMC4xLDAuMS0wLjIsIDAuMS0wLjRjMC0wLjItMC4xLTAuMy0wLjEtMC40Yy0wLjEtMC4xLTAuMy0wLjEtMC40LTAuMWgtMS43VjkuNmgxLjdjMC4xLDAsMC4zLTAuMSwgMC40LTAuMkMxNy45LDkuMywxOCw5LjIsMTgsIDlzLTAuMS0wLjMtMC4xLTAuNGMtMC4xLTAuMS0wLjMtMC4yLTAuNC0wLjJoLTEuN1Y2LjhoMS43YzAuMSwwLDAuMywwLDAuNC0wLjJDMTcuOSwgNi41LDE4LDYuNCwxOCw2LjJDMTgsNiwxNy45LDUuOSwxNy45LDUuOHoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGNwdV9hY3Rpdml0eSA9IChJY29uQ3B1QWN0aXZpdHkpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvZXh0ZXJuYWwtbGluay5qc3hcblxuXG5jb25zdCBJY29uRXh0ZXJuYWxMaW5rID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNXB4IixcbiAgaGVpZ2h0OiAiMTVweCIsXG4gIHZpZXdCb3g6ICIwIDAgMTUgMTUiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTE0LjEsMEg4LjlDOC40LDAsOCwwLjQsOCwwLjlzMC40LDAuOSwwLjksMC45aDIuOUw3LDYuN0M2LjgsNi45LDYuNyw3LjEsNi43LCA3LjRTNi44LDcuOSw3LDhjMC4yLDAuMiwwLjQsMC4zLDAuNywwLjNjMC4yLDAsMC41LTAuMSwwLjctMC4zbDQuOS00Ljl2Mi45YzAsIDAuNSwwLjQsMC45LDAuOSwwLjlDMTQuNiw3LDE1LDYuNiwxNSw2LjFWMC45QzE1LDAuNCwxNC42LDAsMTQuMSwweiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTEwLjYsMTMuNGgtOXYtOWg2LjhMMTAsMi44SDAuOEMwLjQsMi44LDAsMy4xLDAsMy42djEwLjZDMCwxNC42LDAuNCwxNSwwLjgsIDE1aDEwLjZjMC40LDAsMC44LTAuNCwwLjgtMC44VjVsLTEuNiwxLjZWMTMuNHoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGV4dGVybmFsX2xpbmsgPSAoSWNvbkV4dGVybmFsTGluayk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9jb3B5LmpzeFxuXG5cbmNvbnN0IEljb25Db3B5ID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxM3B4IixcbiAgaGVpZ2h0OiAiMTVweCIsXG4gIHZpZXdCb3g6ICIwIDAgMTMgMTUiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTkuNSwwSDEuNEMwLjYsMCwwLDAuNiwwLDEuNHY5LjVoMS40VjEuNGg4LjJWMHogTTExLjYsMi43SDQuMWMtMC44LDAtMS40LDAuNi0xLjQsIDEuNHY5LjVjMCwwLjgsMC42LDEuNCwxLjQsMS40aDcuNWMwLjgsMCwxLjQtMC42LDEuNC0xLjRWNC4xQzEzLDMuMywxMi4zLDIuNywgMTEuNiwyLjd6IE0xMS42LDEzLjZINC4xVjQuMWg3LjVWMTMuNnoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGljb25zX2NvcHkgPSAoSWNvbkNvcHkpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcXItY29kZS5qc3hcblxuXG5jb25zdCBJY29uUXJDb2RlID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNXB4IixcbiAgaGVpZ2h0OiAiMTVweCIsXG4gIHZpZXdCb3g6ICIwIDAgMTUgMTUiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTAsMHY2LjhoNi44VjBIMHogTTUuOSw1LjlIMVYxaDQuOUw1LjksNS45TDUuOSw1Ljl6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicmVjdCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIHg6ICIyIixcbiAgeTogIjIiLFxuICB3aWR0aDogIjIuOSIsXG4gIGhlaWdodDogIjIuOSJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTguMiwwdjYuOEgxNVYwSDguMnogTTE0LDUuOUg5LjFWMUgxNFY1Ljl6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicmVjdCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIHg6ICIxMC4xIixcbiAgeTogIjIiLFxuICB3aWR0aDogIjIuOSIsXG4gIGhlaWdodDogIjIuOSJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTAsOC4yVjE1aDYuOFY4LjJIMHogTTUuOSwxNEgxVjkuMWg0LjlMNS45LDE0TDUuOSwxNHoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJyZWN0Iiwge1xuICBmaWxsOiBjb2xvcixcbiAgeDogIjIiLFxuICB5OiAiMTAuMSIsXG4gIHdpZHRoOiAiMi45IixcbiAgaGVpZ2h0OiAiMi45IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicG9seWdvbiIsIHtcbiAgZmlsbDogY29sb3IsXG4gIHBvaW50czogIjguMiw4LjIgOC4yLDE1IDEwLjEsMTUgMTAuMSwxNCA5LjEsMTQgOS4xLDEyLjEgMTAuMSwxMi4xIDEwLjEsMTEuMSA5LjEsMTEuMSA5LjEsOS4xIDEwLjEsOS4xIDEwLjEsOC4yICJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInJlY3QiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICB4OiAiMTQiLFxuICB5OiAiOC4yIixcbiAgd2lkdGg6ICIxIixcbiAgaGVpZ2h0OiAiMSJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBvbHlnb24iLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBwb2ludHM6ICIxNCwxNCAxMywxNCAxMywxNSAxNSwxNSAxNSwxMC40IDE0LDEwLjQgIlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicmVjdCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIHg6ICIxMS4xIixcbiAgeTogIjguMiIsXG4gIHdpZHRoOiAiMiIsXG4gIGhlaWdodDogIjEiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwb2x5Z29uIiwge1xuICBmaWxsOiBjb2xvcixcbiAgcG9pbnRzOiAiMTMsMTIuMSAxMi4xLDEyLjEgMTIuMSwxMS4xIDEzLDExLjEgMTMsMTAuMSAxMS4xLDEwLjEgMTEuMSwxMyAxMywxMyAiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJyZWN0Iiwge1xuICBmaWxsOiBjb2xvcixcbiAgeDogIjExLjEiLFxuICB5OiAiMTQiLFxuICB3aWR0aDogIjEiLFxuICBoZWlnaHQ6ICIxIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBxcl9jb2RlID0gKEljb25RckNvZGUpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvY2hlY2suanN4XG5cblxuY29uc3QgSWNvbkNoZWNrID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIzMHB4IixcbiAgaGVpZ2h0OiAiMjEuNXB4IixcbiAgdmlld0JveDogIjAgMCAzMCAyMS41IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0yOS43LDBjLTAuNS0wLjUtMS4yLTAuNS0xLjYsMEw5LjMsMTguN0wyLDExLjNjLTAuNS0wLjUtMS4yLTAuNS0xLjYsIDBjLTAuNSwwLjUtMC41LDEuMiwwLDEuNmw4LjIsOC4yYzAuNSwwLjUsMS4yLDAuNSwxLjYsMEwyOS43LDEuNkMzMC4xLCAxLjIsMzAuMSwwLjUsMjkuNywweiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgY2hlY2sgPSAoSWNvbkNoZWNrKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2Zvcm1hdHMtdGFibGUvY2VsbC5qc3hcblxuXG5cbmNvbnN0IFN0Q2VsbCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS50ZGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICB6LWluZGV4OiAxO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBmb250LXNpemU6IDE0cHg7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yIHx8ICJibGFjayJ9O1xuICAmOmZpcnN0LWNoaWxkOjpiZWZvcmUsXG4gICY6bGFzdC1jaGlsZDo6YWZ0ZXIsXG4gICY6bnRoLWNoaWxkKDUpW2NvbHNwYW5dOm5vdCg6bGFzdC1jaGlsZCk6OmFmdGVyIHtcbiAgICBjb250ZW50OiAiICI7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgIHdpZHRoOiAxNnB4O1xuICB9XG4gICY6Zmlyc3QtY2hpbGQsXG4gICY6bm90KDpudGgtY2hpbGQoNSkpOmxhc3QtY2hpbGQge1xuICAgIHdpZHRoOiAzMnB4O1xuICB9XG4gICY6bnRoLWNoaWxkKDIpIHsgcGFkZGluZzogMCAxMHB4OyB9XG4gICY6bnRoLWNoaWxkKDMpOm5vdCg6bGFzdC1jaGlsZCkgZGl2IHN2ZyB7XG4gICAgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy52aWRlb0ljb25Db2xvcn07XG4gIH1cbiAgJjpudGgtY2hpbGQoMyk6bGFzdC1jaGlsZCxcbiAgJjpub3QoOm50aC1jaGlsZCgzKSkge1xuICAgICYgc3ZnIHsgdmVydGljYWwtYWxpZ246IG1pZGRsZTsgfVxuICB9XG4gICY6bnRoLWNoaWxkKDQpIHtcbiAgICAmOm5vdChbY29sc3Bhbl0pOm5vdCg6ZW1wdHkpIHtcbiAgICAgIHdpZHRoOiAxOHB4O1xuICAgICAgJiBzdmcgeyBmaWxsOiAke3Byb3BzID0+IHByb3BzLnZpZGVvSWNvbkNvbG9yfTsgfVxuICAgICAgJiArIHRkIHsgcGFkZGluZzogMCA1cHg7IH1cbiAgICB9XG4gICAgJltjb2xzcGFuXSArIHRkIHsgd2lkdGg6IDIwcHg7IH1cbiAgfVxuICAmOmZpcnN0LWNoaWxkIHN2ZyB7XG4gICAgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5tZWRpYVR5cGVJY29uQ29sb3J9O1xuICB9XG4gICYgYnV0dG9uIHtcbiAgICAmIHN2ZyB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuc2VydmljZUljb25Db2xvcn07IH1cbiAgICAmOmhvdmVyIHN2ZyB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuc2VydmljZUljb25Ib3ZlckNvbG9yfTsgfVxuICB9XG5gO1xuXG5jb25zdCBjZWxsX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lXG59KTtcblxuY29uc3QgQ2VsbCA9ICh7XG4gIGNvbFNwYW4sXG4gIGNoaWxkcmVuXG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IoY2VsbF9tYXBTdGF0ZSk7XG4gIGNvbnN0IGZvcm1hdHNUYWJsZSA9IHRoZW1lICYmIHRoZW1lLmZvcm1hdHNfdGFibGU7XG4gIGNvbnN0IGNvbG9yID0gZm9ybWF0c1RhYmxlICYmIGZvcm1hdHNUYWJsZS5jb2xvcjtcbiAgY29uc3QgbWVkaWFUeXBlSWNvbkNvbG9yID0gZm9ybWF0c1RhYmxlICYmIGZvcm1hdHNUYWJsZS5tZWRpYV90eXBlX2ljb247XG4gIGNvbnN0IHZpZGVvSWNvbkNvbG9yID0gZm9ybWF0c1RhYmxlICYmIGZvcm1hdHNUYWJsZS52aWRlb19pY29uO1xuICBjb25zdCBzZXJ2aWNlSWNvblN0eWxlcyA9IGZvcm1hdHNUYWJsZSAmJiBmb3JtYXRzVGFibGUuc2VydmljZV9pY29uO1xuICBjb25zdCBzZXJ2aWNlSWNvbkNvbG9yID0gc2VydmljZUljb25TdHlsZXMgJiYgc2VydmljZUljb25TdHlsZXMuY29sb3I7XG4gIGNvbnN0IHNlcnZpY2VJY29uSG92ZXJDb2xvciA9IHNlcnZpY2VJY29uU3R5bGVzICYmIHNlcnZpY2VJY29uU3R5bGVzLmhvdmVyO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFN0Q2VsbCwge1xuICAgIGNvbFNwYW46IGNvbFNwYW4sXG4gICAgY29sb3I6IGNvbG9yLFxuICAgIG1lZGlhVHlwZUljb25Db2xvcjogbWVkaWFUeXBlSWNvbkNvbG9yLFxuICAgIHZpZGVvSWNvbkNvbG9yOiB2aWRlb0ljb25Db2xvcixcbiAgICBzZXJ2aWNlSWNvbkNvbG9yOiBzZXJ2aWNlSWNvbkNvbG9yLFxuICAgIHNlcnZpY2VJY29uSG92ZXJDb2xvcjogc2VydmljZUljb25Ib3ZlckNvbG9yXG4gIH0sIGNoaWxkcmVuKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGNlbGwgPSAoQ2VsbCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9mb3JtYXRzLXRhYmxlL3Jvdy5qc3hcblxuXG5cblxuXG5cbiAvLyBpbXBvcnQgbm90aWZpY2F0aW9uIGZyb20gIi4uL3VpL25vdGlmaWNhdGlvbnMiO1xuXG5cblxuXG5cblxuXG5cblxuY29uc3QgU3RSb3cgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10udHJgXG4gIGhlaWdodDogMzVweDtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICAmOjpiZWZvcmUsXG4gICY6Zmlyc3QtY2hpbGQ6OmFmdGVyIHtcbiAgICBjb250ZW50OiAiICI7XG4gICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgei1pbmRleDogMDtcbiAgfVxuICAmOmhvdmVyOjpiZWZvcmUge1xuICAgIG1hcmdpbi10b3A6IDRweDtcbiAgICBsZWZ0OiAwO1xuICAgIHJpZ2h0OiAwO1xuICAgIGhlaWdodDogMjdweDtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLmhvdmVyQmFja2dyb3VuZH07XG4gIH1cbiAgJjpmaXJzdC1jaGlsZDo6YWZ0ZXIge1xuICAgIGxlZnQ6IDE2cHg7XG4gICAgcmlnaHQ6IDE2cHg7XG4gICAgaGVpZ2h0OiAzNXB4O1xuICAgIGJvcmRlci10b3A6ICR7cHJvcHMgPT4gcHJvcHMuYm9yZGVyfTtcbiAgICBib3JkZXItYm90dG9tOiAke3Byb3BzID0+IHByb3BzLmJvcmRlcn07XG4gIH1cbmA7XG5jb25zdCBWaWRlb0ljb25zQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogaW5saW5lLWZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG1hcmdpbjogMTBweCA2cHg7XG4gIHBhZGRpbmc6IDAgNnB4O1xuICAmIHN2ZyB7XG4gICAgJjpub3QoLmZoZCkgeyBtYXJnaW46IDAgMTBweDsgfVxuICAgICYuZmhkIHsgbWFyZ2luOiAwIDZweDsgfVxuICB9XG5gO1xuY29uc3Qgcm93X0J1dHRvbiA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5idXR0b25gXG4gIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuICBvdXRsaW5lOiBub25lO1xuICBib3JkZXI6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgJjpkaXNhYmxlZCB7IG9wYWNpdHk6IDAuNDsgfVxuICAmIHN2ZyB7IHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IH1cbmA7XG5cbmNvbnN0IEljb25Mb2dvID0gKCkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVuaWRvd25sb2FkZXIsIHtcbiAgc3R5bGU6IHtcbiAgICB3aWR0aDogMTIsXG4gICAgbWFyZ2luOiAiMCAzcHgiXG4gIH1cbn0pO1xuXG5jb25zdCBUb29sdGlwQ2VsbCA9ICh7XG4gIHN0YXR1c1xufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjZWxsLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQodWlfdG9vbHRpcCwge1xuICAgIHRpdGxlOiB0KHN0YXR1cyA9PT0gImlkbGUiID8gImRvd25sb2FkX3VzaW5nX3VkbF90b29sdGlwIiA6ICJkb3dubG9hZF92aWFfdW5pZG93bmxvYWRlcl90b29sdGlwIilcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJvd19CdXR0b24sIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChleHRlcm5hbF9saW5rLCB7XG4gICAgc3R5bGU6IHtcbiAgICAgIHRyYW5zZm9ybTogInRyYW5zbGF0ZVkoLTNweCkiXG4gICAgfVxuICB9KSkpKTtcbn07XG5cbmNvbnN0IFJvd1N0YXJ0ID0gKHtcbiAgZGF0YVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X2RlZmF1bHQuYS5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGNlbGwsIG51bGwsIGdldEljb25NZWRpYVR5cGUoZGF0YSkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwgbnVsbCwgZ2V0VGl0bGUoZGF0YSkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwgbnVsbCwgKGRhdGEuZnBzID09PSA2MCB8fCBkYXRhLndpZHRoID4gMTI3OSkgJiYgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFZpZGVvSWNvbnNDb250YWluZXIsIG51bGwsIGdldEljb25SZXNvbHV0aW9uKGRhdGEpLCBnZXRJY29uRnJhbWVyYXRlKGRhdGEpKSkpO1xuXG5jb25zdCBDZWxscyA9ICh7XG4gIGRhdGFcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIHN0YXR1cyxcbiAgICBkaXNwbGF5UXJDb2RlcyxcbiAgICBhZGROb3RpZmljYXRpb25cbiAgfSA9IHVzZUFwcFN0YXRlKFsic3RhdHVzIiwgImRpc3BsYXlRckNvZGVzIiwgImFkZE5vdGlmaWNhdGlvbiJdKTtcbiAgY29uc3QgW2lzTm90aWZpY2F0aW9uU2hvdywgc2V0SXNOb3RpZmljYXRpb25TaG93XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3QgdXJsID0gZGF0YS5kaXJlY3RVcmwgfHwgZGF0YS51cmwgfHwgZGF0YS5vYmogJiYgZGF0YS5vYmoudXJsO1xuICBjb25zdCBkaWRNb3VudFJlZiA9IE9iamVjdChyZWFjdFsidXNlUmVmIl0pKG51bGwpO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgZGlkTW91bnRSZWYuY3VycmVudCA9IHRydWU7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGRpZE1vdW50UmVmLmN1cnJlbnQgPSBmYWxzZTtcbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgaWYgKGRhdGEuZG93bmxvYWRVc2luZ1VkbCkge1xuICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3RfZGVmYXVsdC5hLkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KEljb25Mb2dvLCBudWxsKSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjZWxsLCB7XG4gICAgICBjb2xTcGFuOiA1XG4gICAgfSwgdChzdGF0dXMgPT09ICJpZGxlIiA/ICJkb3dubG9hZF91c2luZ191ZGwiIDogImRvd25sb2FkX3ZpYV91bmlkb3dubG9hZGVyIikpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoVG9vbHRpcENlbGwsIHtcbiAgICAgIHN0YXR1czogc3RhdHVzXG4gICAgfSkpO1xuICB9XG5cbiAgaWYgKGRhdGEuYXZhaWxhYmxlSW5VZGwpIHtcbiAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X2RlZmF1bHQuYS5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFJvd1N0YXJ0LCB7XG4gICAgICBkYXRhOiBkYXRhXG4gICAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjZWxsLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSWNvbkxvZ28sIG51bGwpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGNlbGwsIHtcbiAgICAgIGNvbFNwYW46IDJcbiAgICB9LCB0KCJ1ZGxfY2xpZW50IikpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoVG9vbHRpcENlbGwsIHtcbiAgICAgIHN0YXR1czogc3RhdHVzXG4gICAgfSkpO1xuICB9XG5cbiAgaWYgKGRhdGEuY29udmVyc2lvblJlcXVpcmVkKSB7XG4gICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChSb3dTdGFydCwge1xuICAgICAgZGF0YTogZGF0YVxuICAgIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGNwdV9hY3Rpdml0eSwgbnVsbCkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwge1xuICAgICAgY29sU3BhbjogM1xuICAgIH0sIHQoImNvbnZlcnNpb25fcmVxdWlyZWQiKSkpO1xuICB9XG5cbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChSb3dTdGFydCwge1xuICAgIGRhdGE6IGRhdGFcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjZWxsLCB7XG4gICAgY29sU3BhbjogMlxuICB9LCBnZXRTaXplKGRhdGEpKSwgIWRpc3BsYXlRckNvZGVzICYmIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjZWxsLCBudWxsKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGNlbGwsIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV90b29sdGlwLCB7XG4gICAgdGl0bGU6IHQoImNvcHlfbGlua190b19jbGlwYm9hcmRfdG9vbHRpcCIpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyb3dfQnV0dG9uLCB7XG4gICAgZGlzYWJsZWQ6ICF1cmwsXG4gICAgb25DbGljazogZXZ0ID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgY29uc3QgdGV4dEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpO1xuICAgICAgdGV4dEFyZWEudmFsdWUgPSB1cmw7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRBcmVhKTtcbiAgICAgIHRleHRBcmVhLnNlbGVjdCgpO1xuICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoIkNvcHkiKTtcbiAgICAgIHRleHRBcmVhLnJlbW92ZSgpO1xuXG4gICAgICBpZiAoZGlkTW91bnRSZWYuY3VycmVudCAmJiAhaXNOb3RpZmljYXRpb25TaG93KSB7XG4gICAgICAgIHNldElzTm90aWZpY2F0aW9uU2hvdyh0cnVlKTtcbiAgICAgICAgYWRkTm90aWZpY2F0aW9uKHtcbiAgICAgICAgICBpY29uOiBjaGVjayxcbiAgICAgICAgICBtZXNzYWdlOiB0KCJjb3B5X2xpbmtfdG9fY2xpcGJvYXJkX25vdGlmaWNhdGlvbl9tZXNzYWdlIiksXG4gICAgICAgICAgb25DbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGRpZE1vdW50UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgICAgICAgc2V0SXNOb3RpZmljYXRpb25TaG93KGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGljb25zX2NvcHksIG51bGwpKSkpLCBkaXNwbGF5UXJDb2RlcyAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY2VsbCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX3Rvb2x0aXAsIHtcbiAgICB0aXRsZTogdCgicXJfY29kZV90b29sdGlwIilcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJvd19CdXR0b24sIHtcbiAgICBvbkNsaWNrOiBldnQgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBoaXN0b3J5LnB1c2goYC9xcmNvZGUvJHtidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChkYXRhLm9iai51cmwpKSl9YCk7XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocXJfY29kZSwgbnVsbCkpKSkpO1xufTtcblxuY29uc3QgUm93ID0gKHtcbiAgZGF0YVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdGhlbWUsXG4gICAgc2VuZEV2ZW50LFxuICAgIGRvd25sb2FkLFxuICAgIHNldERlZmF1bHRJdGVtLFxuICAgIHdhcm5CZWZvcmVDb252ZXJ0aW5nXG4gIH0gPSB1c2VBcHBTdGF0ZShbInRoZW1lIiwgInNlbmRFdmVudCIsICJkb3dubG9hZCIsICJzZXREZWZhdWx0SXRlbSIsICJ3YXJuQmVmb3JlQ29udmVydGluZyJdKTtcbiAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgY29uc3Qge1xuICAgIGkxOG5cbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG5cbiAgaWYgKGRhdGEpIHtcbiAgICBjb25zdCBmb3JtYXRzVGFibGUgPSB0aGVtZSAmJiB0aGVtZS5mb3JtYXRzX3RhYmxlO1xuICAgIGNvbnN0IHJvd0JvcmRlciA9IGZvcm1hdHNUYWJsZSAmJiBmb3JtYXRzVGFibGUucm93X2JvcmRlcjtcbiAgICBjb25zdCByb3dIb3ZlckJhY2tncm91bmQgPSBmb3JtYXRzVGFibGUgJiYgZm9ybWF0c1RhYmxlLnJvd19ob3Zlcl9iYWNrZ3JvdW5kO1xuICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoU3RSb3csIHtcbiAgICAgIGJvcmRlcjogYDFweCBzb2xpZCAke3Jvd0JvcmRlciB8fCAiYmxhY2sifWAsXG4gICAgICBob3ZlckJhY2tncm91bmQ6IHJvd0hvdmVyQmFja2dyb3VuZCB8fCAicmdiYSgwLDAsMCwwLjMpIixcbiAgICAgIG9uQ2xpY2s6IGV2dCA9PiB7XG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBsYW5kaW5nVXJsID0gdXRpbHNfY3R4WyJhIiAvKiBkZWZhdWx0ICovXS5nZXRTZXJ2aWNlVXJsKHV0aWxzX2N0eFsiYSIgLyogZGVmYXVsdCAqL10ud2luZG93LmxvY2F0aW9uLmhyZWYsIGkxOG4ubGFuZ3VhZ2UpO1xuXG4gICAgICAgIGlmIChkYXRhLmRvd25sb2FkVXNpbmdVZGwpIHtcbiAgICAgICAgICB3aW5kb3cub3BlbihsYW5kaW5nVXJsLCAiX2JsYW5rIik7XG4gICAgICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgICAgIGFjdGlvbjogImxhbmRpbmciLFxuICAgICAgICAgICAgZm9ybWF0OiAiIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuYXZhaWxhYmxlSW5VZGwpIHtcbiAgICAgICAgICBpZiAoZGF0YS5taW1lVHlwZSA9PT0gImF1ZGlvL21wMyIgJiYgIWRhdGEuYml0cmF0ZSkge1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oYCR7bGFuZGluZ1VybH0/dGY9Y2xpZW50LW1wM2AsICJfYmxhbmsiKTtcbiAgICAgICAgICAgIHNlbmRFdmVudCh7XG4gICAgICAgICAgICAgIGFjdGlvbjogImxhbmRpbmdfYXVkaW8iLFxuICAgICAgICAgICAgICBmb3JtYXQ6ICIiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICBmcHNcbiAgICAgICAgICAgIH0gPSBkYXRhO1xuICAgICAgICAgICAgY29uc3QgdGYgPSBgY2xpZW50LW1wNC0ke2RhdGEuaGVpZ2h0fSR7ZnBzID4gMzAgPyBgLSR7ZnBzfWAgOiAiIn1gO1xuICAgICAgICAgICAgd2luZG93Lm9wZW4oYCR7bGFuZGluZ1VybH0/dGY9JHt0Zn1gLCAiX2JsYW5rIik7XG4gICAgICAgICAgICBzZW5kRXZlbnQoe1xuICAgICAgICAgICAgICBhY3Rpb246ICJsYW5kaW5nX3ZpZGVvIixcbiAgICAgICAgICAgICAgZm9ybWF0OiBkYXRhLnF1YWxpdHlMYWJlbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY29udmVyc2lvblJlcXVpcmVkICYmIHdhcm5CZWZvcmVDb252ZXJ0aW5nKSB7XG4gICAgICAgICAgc2V0RGVmYXVsdEl0ZW0oZGF0YSk7XG4gICAgICAgICAgaGlzdG9yeS5wdXNoKCIvY29uZmlybSIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRvd25sb2FkKGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KENlbGxzLCB7XG4gICAgICBkYXRhOiBkYXRhXG4gICAgfSkpO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciByb3cgPSAoUm93KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2Zvcm1hdHMtdGFibGUvaW5kZXguanN4XG5cblxuXG5jb25zdCBUYWJsZSA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS50YWJsZWBcbiAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTtcbiAgYm9yZGVyLXNwYWNpbmc6IDA7XG4gIHdpZHRoOiAxMDAlO1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGVtcHR5LWNlbGxzOiBoaWRlO1xuYDtcbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGZvcm1hdHNfdGFibGUgPSAoKHtcbiAgZGF0YVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFRhYmxlLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInRib2R5IiwgbnVsbCwgZGF0YS5tYXAocmVjID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyb3csIHtcbiAga2V5OiBgJHtyZWMud2lkdGh9OiR7cmVjLmZwc306JHtPYmplY3Qua2V5cyhyZWMpLmpvaW4oIiIpfWAsXG4gIGRhdGE6IHJlY1xufSkpKSkpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvcGx1cy5qc3hcblxuXG5jb25zdCBJY29uUGx1cyA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMTBweCIsXG4gIGhlaWdodDogIjEwcHgiLFxuICB2aWV3Qm94OiAiMCAwIDEwIDEwIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk05LjgsMy44QzkuNywzLjcsOS41LDMuNyw5LjMsMy43aC0zdi0zYzAtMC4yLTAuMS0wLjMtMC4yLTAuNUM2LDAuMSw1LjgsMCw1LjcsIDBINC4zQzQuMiwwLDQsMC4xLDMuOCwwLjJDMy43LDAuMywzLjcsMC41LDMuNywwLjd2Mi45aC0zYy0wLjIsMC0wLjMsMC4xLTAuNSwwLjJTMCwgNC4yLDAsNC4zdjEuM0MwLDUuOCwwLjEsNiwwLjIsNi4yYzAuMiwwLjIsMC4zLDAuMiwwLjUsMC4yaDIuOXYyLjljMCwwLjIsMC4xLDAuMywgMC4yLDAuNUM0LDkuOSw0LjIsMTAsNC4zLDEwaDEuM0M1LjgsMTAsNiw5LjksNi4yLDkuOGMwLjItMC4yLDAuMi0wLjMsIDAuMi0wLjV2LTNoMi45YzAuMiwwLDAuMy0wLjEsMC41LTAuMkM5LjksNiwxMCw1LjgsMTAsNS43VjQuM0MxMCw0LjIsOS45LDQsOS44LDMuOHoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHBsdXMgPSAoSWNvblBsdXMpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L3BhZ2VzL21haW4uanN4XG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBtYWluX0J1dHRvbiA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5idXR0b25gXG4gIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuICBvdXRsaW5lOiBub25lO1xuICBib3JkZXI6IG5vbmU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIG1hcmdpbjogNHB4IGF1dG87XG4gIHBhZGRpbmc6IDZweCAzcHg7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgJjpub3QoOmhvdmVyKSB7XG4gICAgJiBzdmcgcGF0aCB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uQ29sb3J9OyB9XG4gICAgJiBzcGFuIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uQ29sb3J9OyB9XG4gIH1cbiAgJjpob3ZlciB7XG4gICAgJiBzdmcgcGF0aCB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uSG92ZXJDb2xvcn07IH1cbiAgICAmIHNwYW4geyBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5idXR0b25Ib3ZlckNvbG9yfTsgfVxuICB9XG4gICYgc3ZnIHsgbWFyZ2luOiAwIDNweDsgfVxuYDtcbmNvbnN0IFRleHQgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uc3BhbmBcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgZm9udC1zaXplOiAxNHB4O1xuICBtYXJnaW46IDAgM3B4O1xuICBwYWRkaW5nOiAwO1xuYDtcbmNvbnN0IG1haW5fSGVhZGVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmg0YFxuICBtYXJnaW46IDE2cHg7XG4gIGZvbnQtc2l6ZTogMTZweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgbGluZS1oZWlnaHQ6IDI0cHg7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yIHx8ICJibGFjayJ9O1xuICAmIGEge1xuICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgfVxuYDtcblxuY29uc3QgRm9ybWF0cyA9ICh7XG4gIGxvYWRNb3JlXG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBzdHJlYW1JbmZvLFxuICAgIHZpZGVvSW5mbyxcbiAgICBhdWRpb0luZm8sXG4gICAgY29udGVudExpbWl0LFxuICAgIHRoZW1lLFxuICAgIHNlbmRFdmVudCxcbiAgICBzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCxcbiAgICBzaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJzdGF0dXMiLCAidmlkZW9JbmZvIiwgImF1ZGlvSW5mbyIsICJzdHJlYW1JbmZvIiwgImNvbnRlbnRMaW1pdCIsICJ0aGVtZSIsICJzZW5kRXZlbnQiLCAic2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwiLCAic2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24iXSk7XG4gIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5KCk7XG4gIGNvbnN0IHtcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBidXR0b25TdHlsZXMgPSB0aGVtZSAmJiB0aGVtZS5pY29uX2J1dHRvbjtcbiAgY29uc3QgYnV0dG9uQ29sb3IgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmNvbG9yO1xuICBjb25zdCBidXR0b25Ib3ZlckNvbG9yID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5ob3ZlcjtcbiAgY29uc3QgdGl0bGUgPSB0KGxvYWRNb3JlID8gImFsbF9mb3JtYXRzX2Zvcl9kb3dubG9hZCIgOiAiZm9ybWF0c19mb3JfZG93bmxvYWQiKTtcbiAgY29uc3Qge1xuICAgIGxpc3QsXG4gICAgc2hvd01vcmVGb3JtYXRzXG4gIH0gPSBmb3JtYXRzTGlzdChzdHJlYW1JbmZvLCB2aWRlb0luZm8sIGF1ZGlvSW5mbywgc2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwsIHNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uLCBjb250ZW50TGltaXQsIGxvYWRNb3JlKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChwYWdlLCB7XG4gICAgdGl0bGU6IHRpdGxlXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChmb3JtYXRzX3RhYmxlLCB7XG4gICAgZGF0YTogbGlzdFxuICB9KSwgIXNob3dNb3JlRm9ybWF0cyAmJiBsaXN0Lmxlbmd0aCA+IDAgJiYgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG1haW5fQnV0dG9uLCB7XG4gICAgb25DbGljazogKCkgPT4ge1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAibW9yZSJcbiAgICAgIH0pO1xuICAgICAgaGlzdG9yeS5wdXNoKCIvbW9yZSIpO1xuICAgIH0sXG4gICAgYnV0dG9uQ29sb3I6IGJ1dHRvbkNvbG9yLFxuICAgIGJ1dHRvbkhvdmVyQ29sb3I6IGJ1dHRvbkhvdmVyQ29sb3JcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBsdXMsIG51bGwpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoVGV4dCwgbnVsbCwgdCgibW9yZV9mb3JtYXRzIikpKSk7XG59O1xuXG5jb25zdCBVbmF2YWlsYWJsZSA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIGNvbnN0IHtcbiAgICB0aGVtZVxuICB9ID0gdXNlQXBwU3RhdGUoWyJ0aGVtZSJdKTtcbiAgY29uc3QgY29sb3IgPSB0aGVtZSAmJiB0aGVtZS5oZWFkZXI7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBjb25zdCBoYW5kbGVyID0gZSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQubG9jYWxOYW1lID09PSAiYSIgJiYgZS50YXJnZXQuZ2V0QXR0cmlidXRlKCJkYXRhLXVuaWRvd25sb2FkZXItZnVuY3Rpb24iKSA9PT0gInJlbG9hZCIpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZXIpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVyKTtcbiAgICB9O1xuICB9LCBbXSk7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocGFnZSwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG1haW5fSGVhZGVyLCB7XG4gICAgY29sb3I6IGNvbG9yLFxuICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7XG4gICAgICBfX2h0bWw6IHQoImRpcmVjdF9saW5rc191bmF2YWlsYWJsZSIpXG4gICAgfVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGZvcm1hdHNfdGFibGUsIHtcbiAgICBkYXRhOiBbe1xuICAgICAgZG93bmxvYWRVc2luZ1VkbDogdHJ1ZVxuICAgIH1dXG4gIH0pKTtcbn07XG5cbmNvbnN0IE1haW4gPSAoe1xuICBsb2FkTW9yZVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgc3RhdHVzXG4gIH0gPSB1c2VBcHBTdGF0ZShbInN0YXR1cyJdKTtcbiAgaWYgKHN0YXR1cyA9PT0gInVuYXZhaWxhYmxlIikgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChVbmF2YWlsYWJsZSwgbnVsbCk7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoRm9ybWF0cywge1xuICAgIGxvYWRNb3JlOiBsb2FkTW9yZVxuICB9KTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG1haW4gPSAoTWFpbik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9jaGVja2JveC5qc3hcblxuXG5cbmNvbnN0IElucHV0ID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmlucHV0YFxuICBkaXNwbGF5OiBub25lO1xuICAmOm5vdCg6Y2hlY2tlZCkgKyBsYWJlbDo6YWZ0ZXIgeyBvcGFjaXR5OiAwOyB9XG4gICY6Y2hlY2tlZCArIGxhYmVsOjphZnRlciB7IG9wYWNpdHk6IDE7IH1cbiAgJjpub3QoOmRpc2FibGVkKSArIGxhYmVsIHsgY3Vyc29yOiBwb2ludGVyOyB9XG4gICY6ZGlzYWJsZWQgKyBsYWJlbCB7IG9wYWNpdHk6IDAuNTsgfVxuYDtcbmNvbnN0IExhYmVsID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmxhYmVsYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBmb250LXNpemU6IDE0cHg7XG4gIGxpbmUtaGVpZ2h0OiAxOHB4O1xuICAke3Byb3BzID0+IHByb3BzLmRpciA9PT0gInJ0bCIgPyAicGFkZGluZy1yaWdodDogMjVweDsiIDogInBhZGRpbmctbGVmdDogMjVweDsifVxuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5jb2xvcn07XG4gICY6OmJlZm9yZSxcbiAgJjo6YWZ0ZXIge1xuICAgIGNvbnRlbnQ6ICIgIjtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIH1cbiAgJjo6YmVmb3JlIHtcbiAgICB0b3A6IDA7XG4gICAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gInJpZ2h0OiAwOyIgOiAibGVmdDogMDsifVxuICAgIHdpZHRoOiAxOHB4O1xuICAgIGhlaWdodDogMThweDtcbiAgICBib3JkZXItcmFkaXVzOiAzcHg7XG4gICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICBib3JkZXI6IDJweCBzb2xpZCAgJHtwcm9wcyA9PiBwcm9wcy5ib3JkZXJ9O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYmFja2dyb3VuZH07XG4gIH1cbiAgJjo6YWZ0ZXIge1xuICAgIHdpZHRoOiAzcHg7XG4gICAgaGVpZ2h0OiA3cHg7XG4gICAgdG9wOiAzcHg7XG4gICAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gInJpZ2h0OiA3cHg7IiA6ICJsZWZ0OiA3cHg7In1cbiAgICBib3JkZXItcmlnaHQ6IDJweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLmNoZWNrbWFya307XG4gICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICR7cHJvcHMgPT4gcHJvcHMuY2hlY2ttYXJrfTtcbiAgICB0cmFuc2Zvcm06IHJvdGF0ZSg0NWRlZyk7XG4gIH1cbmA7XG5cbmNvbnN0IGNoZWNrYm94X21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgZGlyOiBzdGF0ZS5kaXIsXG4gIHRoZW1lOiBzdGF0ZS50aGVtZVxufSk7XG5cbmNvbnN0IENoZWNrQm94ID0gKHtcbiAgaWQsXG4gIG5hbWUsXG4gIGxhYmVsLFxuICBjaGVja2VkLFxuICBkaXNhYmxlZCxcbiAgb25DaGFuZ2Vcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIGRpcixcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IoY2hlY2tib3hfbWFwU3RhdGUpO1xuICBjb25zdCBjaGVja2JveElkID0gaWQgJiYgYHVuaWRvd25sb2FkZXItY2hlY2tib3gtJHtpZH1gO1xuICBjb25zdCBjaGVja2JveE5hbWUgPSBuYW1lICYmIGB1bmlkb3dubG9hZGVyLWNoZWNrYm94LSR7bmFtZX1gO1xuICBjb25zdCBjaGVja2JveFN0eWxlcyA9IHRoZW1lICYmIHRoZW1lLmNoZWNrYm94O1xuICBjb25zdCBjb2xvciA9IGNoZWNrYm94U3R5bGVzICYmIGNoZWNrYm94U3R5bGVzLmNvbG9yO1xuICBjb25zdCBiYWNrZ3JvdW5kID0gY2hlY2tib3hTdHlsZXMgJiYgY2hlY2tib3hTdHlsZXMuYmFja2dyb3VuZDtcbiAgY29uc3QgYm9yZGVyID0gY2hlY2tib3hTdHlsZXMgJiYgY2hlY2tib3hTdHlsZXMuYm9yZGVyO1xuICBjb25zdCBjaGVja21hcmsgPSBjaGVja2JveFN0eWxlcyAmJiBjaGVja2JveFN0eWxlcy5jaGVja21hcms7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3RfZGVmYXVsdC5hLkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSW5wdXQsIHtcbiAgICB0eXBlOiAiY2hlY2tib3giLFxuICAgIGlkOiBjaGVja2JveElkLFxuICAgIG5hbWU6IGNoZWNrYm94TmFtZSxcbiAgICBjaGVja2VkOiBjaGVja2VkLFxuICAgIGRpc2FibGVkOiBpZCAmJiBkaXNhYmxlZCxcbiAgICBvbkNoYW5nZTogb25DaGFuZ2VcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChMYWJlbCwge1xuICAgIGh0bWxGb3I6IGNoZWNrYm94SWQsXG4gICAgZGlyOiBkaXIsXG4gICAgY29sb3I6IGNvbG9yLFxuICAgIGJhY2tncm91bmQ6IGJhY2tncm91bmQsXG4gICAgYm9yZGVyOiBib3JkZXIsXG4gICAgY2hlY2ttYXJrOiBjaGVja21hcmtcbiAgfSwgbGFiZWwpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHVpX2NoZWNrYm94ID0gKENoZWNrQm94KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL3dhcm5pbmcuanN4XG5cblxuY29uc3QgSWNvbldhcm5pbmcgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjgwcHgiLFxuICBoZWlnaHQ6ICI3My43cHgiLFxuICB2aWV3Qm94OiAiMCAwIDgwIDczLjciLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTM3LjYsMC41YzEuNS0wLjcsMy4zLTAuNyw0LjksMGMxLjIsMC41LDIuMywxLjUsMywyLjZDNTYuNywyMy42LDY4LDQ0LCA3OS4yLDY0LjVjMC40LDAuOCwwLjYsMS42LDAuNywyLjV2MC45Yy0wLjIsMi40LTEuOCw0LjctNC4xLDUuNWMtMS4yLCAwLjUtMi41LDAuMy0zLjgsMC40Yy04LjMsMC0xNi42LDAtMjQuOCwwYy0wLjYsMC0xLjEtMC4yLTEuNC0wLjdjLTAuNS0wLjYtMC4zLTEuNiwgMC4zLTIuMWMwLjUtMC40LDEuMy0wLjMsMS45LTAuM2M4LjYsMCwxNy4yLDAsMjUuOCwwYzEuNSwwLDIuOS0xLjIsIDMuMS0yLjhjMC4xLTAuNy0wLjEtMS4zLTAuNC0xLjlDNjUuMiw0NS41LDU0LDI1LjIsNDIuOCwgNC44Yy0wLjUtMS0xLjUtMS43LTIuNi0xLjdjLTEuMi0wLjEtMi4zLDAuNi0yLjksMS42QzI2LDI1LjEsMTQuOCw0NS41LDMuNSwgNjZjLTAuOCwxLjMtMC4zLDMuMiwxLDRjMC42LDAuNCwxLjMsMC42LDIuMSwwLjVjOC41LDAsMTcsMCwyNS41LDBjMC42LDAsIDEuMy0wLjEsMS44LDAuM2MwLjcsMC40LDAuOSwxLjQsMC41LDIuMWMtMC4zLDAuNS0wLjksMC44LTEuNSwwLjhjLTguMywgMC0xNi42LDAtMjQuOSwwYy0xLjMsMC0yLjYsMC4xLTMuOC0wLjNjLTIuMy0wLjgtNC0zLjEtNC4yLTUuNVY2N2MwLjEtMS44LCAxLjItMy4yLDItNC43QzEyLjksNDIuNSwyMy43LDIyLjgsMzQuNiwzLjFDMzUuMiwyLDM2LjMsMSwzNy42LDAuNXoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0zOC44LDE5LjFjMS41LTAuMywzLjEsMCw0LjUsMC44YzEuNCwwLjksMi40LDIuMywyLjgsMy45YzAuMiwxLDAuMSwyLDAuMiwgMi45YzAsNC4xLDAsOC4yLDAsMTIuNGMwLDEuNC0wLjQsMi44LTEuMywzLjljLTEuMSwxLjQtMi43LDIuMy00LjUsMi40Yy0xLjksIDAuMi0zLjgtMC42LTUuMS0yYy0xLjEtMS4yLTEuNi0yLjctMS42LTQuM2MwLTQuNywwLTkuNSwwLTE0LjJDMzMuOCwyMi4xLCAzNi4xLDE5LjYsMzguOCwxOS4xTTM5LjQsMjIuMmMtMS4xLDAuMi0yLjEsMS4xLTIuNCwyLjFjLTAuMSwwLjUtMC4xLCAwLjktMC4xLDEuNGMwLDQuNSwwLDkuMSwwLDEzLjZjMCwxLjUsMS4xLDIuOCwyLjUsM2MxLjQsMC4zLDIuOS0wLjUsIDMuNC0xLjhjMC40LTAuOCwwLjMtMS44LDAuMy0yLjdjMC00LjMsMC04LjUsMC0xMi44QzQzLjEsMjMuMyw0MS4yLDIxLjgsMzkuNCwyMi4yeiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTM4LjgsNTEuOWMxLjctMC4zLDMuNiwwLjEsNSwxLjJjMi40LDEuOCwzLjEsNS40LDEuNiw4Yy0wLjksMS42LTIuNSwyLjctNC4zLCAzYy0yLDAuNC00LjItMC40LTUuNi0xLjljLTEuNC0xLjUtMi0zLjctMS41LTUuNkMzNC40LDU0LjMsMzYuNCw1Mi40LDM4LjgsIDUxLjkgTTM5LjEsNTUuMWMtMS4xLDAuMy0yLjEsMS40LTIuMiwyLjVjLTAuMiwxLDAuMywyLjIsMS4xLDIuOGMwLjksMC44LDIuMiwgMSwzLjMsMC41YzEtMC40LDEuNy0xLjMsMS44LTIuM2MwLjItMS4xLTAuMi0yLjMtMS4xLTIuOUM0MS4yLDU1LDQwLjEsNTQuOCwzOS4xLDU1LjF6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNMzkuNCw3MC42YzEuMS0wLjUsMi40LDAuNSwyLjEsMS43Yy0wLjEsMS4xLTEuNiwxLjctMi41LDFDMzguMSw3Mi42LDM4LjMsNzEsMzkuNCw3MC42eiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgaWNvbnNfd2FybmluZyA9IChJY29uV2FybmluZyk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9zcGFubmVyLmpzeFxuXG5cbmNvbnN0IEljb25TcGFubmVyID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyMXB4IixcbiAgaGVpZ2h0OiAiMjFweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjEgMjEiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiIE0gMjAuNyA0Ljk1IFEgMjAuNDUgNC44NSAyMC4zIDUuMDUgTCAxNy43NSA3LjU1IDE0LjA1IDYuOSAxMy40NSAzLjIgMTUuOTUgMC43IFEgMTYuMSAwLjU1IDE2LjA1IDAuMyAxNS45NSAwLjEgMTUuNzUgMC4wNSAxNC4zIC0wLjE1IDEzIDAuMyAxMS42NSAwLjc1IDEwLjY1IDEuOCA5LjQ1IDIuOTUgOS4wNSA0LjU1IDguNjUgNi4xIDkuMDUgNy42NSBMIDAuOSAxNS44IFEgMCAxNi43IDAgMTcuOTUgMCAxOS4yIDAuOSAyMC4xIDEuNzUgMjEgMyAyMSA0LjMgMjEgNS4xNSAyMC4xIEwgMTMuMzUgMTEuOTUgUSAxNC45IDEyLjM1IDE2LjQ1IDExLjk1IDE4LjA1IDExLjU1IDE5LjIgMTAuMzUgMjAuMjUgOS4zNSAyMC43IDggMjEuMTUgNi42NSAyMC45NSA1LjI1IDIwLjkgNSAyMC43IDQuOTUgTSAxMi44NSAxLjE1IFEgMTMuOCAwLjc1IDE0Ljg1IDAuNzUgTCAxMi43NSAyLjg1IFEgMTIuNjUgMi45NSAxMi42NSAzLjE1IEwgMTMuNCA3LjMgUSAxMy40IDcuNCAxMy41IDcuNSAxMy41NSA3LjYgMTMuNyA3LjYgTCAxNy44NSA4LjMgUSAxOCA4LjM1IDE4LjE1IDguMiBMIDIwLjI1IDYuMTUgUSAyMC4yNSA3LjIgMTkuODUgOC4xNSAxOS40NSA5LjEgMTguNyA5Ljg1IDE3LjE1IDExLjQgMTQuOSAxMS40IDEyLjcgMTEuNCAxMS4xNSA5Ljg1IDkuNiA4LjMgOS42IDYuMDUgOS42IDMuODUgMTEuMTUgMi4zIDExLjkgMS41NSAxMi44NSAxLjE1IE0gMTAuNjUgMTAuMzUgUSAxMS40NSAxMS4yIDEyLjU1IDExLjY1IEwgNC42NSAxOS42IFEgNCAyMC4yNSAzIDIwLjI1IDIuMSAyMC4yNSAxLjQgMTkuNiAwLjc1IDE4LjkgMC43NSAxNy45NSAwLjc1IDE3IDEuNCAxNi4zNSBMIDkuMzUgOC40IFEgOS44IDkuNSAxMC42NSAxMC4zNSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBzcGFubmVyID0gKEljb25TcGFubmVyKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL3VpL3JhZGlvLWJ1dHRvbi5qc3hcblxuXG5cbmNvbnN0IHJhZGlvX2J1dHRvbl9JbnB1dCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5pbnB1dGBcbiAgZGlzcGxheTogbm9uZTtcbiAgJjpub3QoOmNoZWNrZWQpICsgbGFiZWw6OmFmdGVyIHsgb3BhY2l0eTogMDsgfVxuICAmOmNoZWNrZWQgKyBsYWJlbDo6YWZ0ZXIgeyBvcGFjaXR5OiAxOyB9XG4gICY6bm90KDpkaXNhYmxlZCk6bm90KDpjaGVja2VkKSArIGxhYmVsIHsgY3Vyc29yOiBwb2ludGVyOyB9XG4gICY6ZGlzYWJsZWQgKyBsYWJlbCB7IG9wYWNpdHk6IDAuNTsgfVxuYDtcbmNvbnN0IHJhZGlvX2J1dHRvbl9MYWJlbCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5sYWJlbGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBkaXNwbGF5OiBibG9jaztcbiAgZm9udC1zaXplOiAxNHB4O1xuICBsaW5lLWhlaWdodDogMThweDtcbiAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gInBhZGRpbmctcmlnaHQ6IDI1cHg7IiA6ICJwYWRkaW5nLWxlZnQ6IDI1cHg7In1cbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3J9O1xuICAmOjpiZWZvcmUsXG4gICY6OmFmdGVyIHtcbiAgICBjb250ZW50OiAiICI7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICB9XG4gICY6OmJlZm9yZSB7XG4gICAgdG9wOiAwO1xuICAgICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAicnRsIiA/ICJyaWdodDogMDsiIDogImxlZnQ6IDA7In1cbiAgICB3aWR0aDogMThweDtcbiAgICBoZWlnaHQ6IDE4cHg7XG4gICAgYm9yZGVyOiAycHggc29saWQgICR7cHJvcHMgPT4gcHJvcHMuYm9yZGVyfTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLmJhY2tncm91bmR9O1xuICB9XG4gICY6OmFmdGVyIHtcbiAgICB3aWR0aDogMTBweDtcbiAgICBoZWlnaHQ6IDEwcHg7XG4gICAgdG9wOiA0cHg7XG4gICAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gInJpZ2h0OiA0cHg7IiA6ICJsZWZ0OiA0cHg7In1cbiAgICBib3JkZXI6IDVweCBzb2xpZCAgJHtwcm9wcyA9PiBwcm9wcy5ib3JkZXJ9O1xuICB9XG5gO1xuXG5jb25zdCByYWRpb19idXR0b25fbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICBkaXI6IHN0YXRlLmRpcixcbiAgdGhlbWU6IHN0YXRlLnRoZW1lXG59KTtcblxuY29uc3QgUmFkaW8gPSAoe1xuICBpZCxcbiAgbmFtZSxcbiAgbGFiZWwsXG4gIGNoZWNrZWQsXG4gIGRpc2FibGVkLFxuICBvbkNoYW5nZVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGlyLFxuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihyYWRpb19idXR0b25fbWFwU3RhdGUpO1xuICBjb25zdCByYWRpb0J1dHRvbklkID0gaWQgJiYgYHVuaWRvd25sb2FkZXItcmFkaW8tYnV0dG9uLSR7aWR9YDtcbiAgY29uc3QgcmFkaW9CdXR0b25OYW1lID0gbmFtZSAmJiBgdW5pZG93bmxvYWRlci1yYWRpby1idXR0b24tJHtuYW1lfWA7XG4gIGNvbnN0IHJhZGlvQnV0dG9uU3R5bGVzID0gdGhlbWUgJiYgdGhlbWUucmFkaW9fYnV0dG9uO1xuICBjb25zdCBjb2xvciA9IHJhZGlvQnV0dG9uU3R5bGVzICYmIHJhZGlvQnV0dG9uU3R5bGVzLmNvbG9yO1xuICBjb25zdCBiYWNrZ3JvdW5kID0gcmFkaW9CdXR0b25TdHlsZXMgJiYgcmFkaW9CdXR0b25TdHlsZXMuYmFja2dyb3VuZDtcbiAgY29uc3QgYm9yZGVyID0gcmFkaW9CdXR0b25TdHlsZXMgJiYgcmFkaW9CdXR0b25TdHlsZXMuYm9yZGVyO1xuICBjb25zdCBjaGVja21hcmsgPSByYWRpb0J1dHRvblN0eWxlcyAmJiByYWRpb0J1dHRvblN0eWxlcy5jaGVja21hcms7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3RfZGVmYXVsdC5hLkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmFkaW9fYnV0dG9uX0lucHV0LCB7XG4gICAgdHlwZTogInJhZGlvIixcbiAgICBpZDogcmFkaW9CdXR0b25JZCxcbiAgICBuYW1lOiByYWRpb0J1dHRvbk5hbWUsXG4gICAgY2hlY2tlZDogY2hlY2tlZCxcbiAgICBkaXNhYmxlZDogaWQgJiYgZGlzYWJsZWQsXG4gICAgb25DaGFuZ2U6IG9uQ2hhbmdlXG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmFkaW9fYnV0dG9uX0xhYmVsLCB7XG4gICAgaHRtbEZvcjogcmFkaW9CdXR0b25JZCxcbiAgICBkaXI6IGRpcixcbiAgICBjb2xvcjogY29sb3IsXG4gICAgYmFja2dyb3VuZDogYmFja2dyb3VuZCxcbiAgICBib3JkZXI6IGJvcmRlcixcbiAgICBjaGVja21hcms6IGNoZWNrbWFya1xuICB9LCBsYWJlbCkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcmFkaW9fYnV0dG9uID0gKFJhZGlvKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9wYWdlcy9zZXR0aW5ncy5qc3hcblxuXG5cblxuXG5cblxuY29uc3Qgc2V0dGluZ3NfQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgbWFyZ2luOiA4cHggMTZweCAyNHB4O1xuICAmIGxhYmVsIHsgIG1hcmdpbi1ib3R0b206IDE2cHg7IH1cbiAgJiBoNCB7IGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yfSB9XG5gO1xuY29uc3QgVGl0bGUgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uaDRgXG4gIGZvbnQtc2l6ZTogMTZweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgcGFkZGluZzogMTRweCAwO1xuYDtcbmNvbnN0IFBhZ2VDb250YWluZXIgPSAoe1xuICBjaGlsZHJlblxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3Qge1xuICAgIHRoZW1lXG4gIH0gPSB1c2VBcHBTdGF0ZShbInRoZW1lIl0pO1xuICBjb25zdCBnbG9iYWxzID0gdGhlbWUgJiYgdGhlbWUuZ2xvYmFscztcbiAgY29uc3QgY29sb3IgPSBnbG9iYWxzICYmIGdsb2JhbHMuY29sb3I7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocGFnZSwge1xuICAgIHRpdGxlOiB0KCJzZXR0aW5ncyIpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Db250YWluZXIsIHtcbiAgICBjb2xvcjogY29sb3JcbiAgfSwgY2hpbGRyZW4pKTtcbn07XG5jb25zdCBNYWluU2V0dGluZ3MgPSAoKSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCB7XG4gICAgZGlzcGxheVFyQ29kZXMsXG4gICAgc2V0RGlzcGxheVFyQ29kZXMsXG4gICAgc2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwsXG4gICAgc2V0U2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwsXG4gICAgc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24sXG4gICAgc2V0U2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24sXG4gICAgd2FybkJlZm9yZUNvbnZlcnRpbmcsXG4gICAgc2V0V2FybkJlZm9yZUNvbnZlcnRpbmcsXG4gICAgd2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24sXG4gICAgc2V0V2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24sXG4gICAgc2hvd1NuYXBzaG90QnV0dG9uLFxuICAgIHNldFNob3dTbmFwc2hvdEJ1dHRvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJkaXNwbGF5UXJDb2RlcyIsICJzZXREaXNwbGF5UXJDb2RlcyIsICJzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCIsICJzZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCIsICJzaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbiIsICJzZXRTaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbiIsICJ3YXJuQmVmb3JlQ29udmVydGluZyIsICJzZXRXYXJuQmVmb3JlQ29udmVydGluZyIsICJ3YXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbiIsICJzZXRXYXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbiIsICJzaG93U25hcHNob3RCdXR0b24iLCAic2V0U2hvd1NuYXBzaG90QnV0dG9uIl0pO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X2RlZmF1bHQuYS5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX2NoZWNrYm94LCB7XG4gICAgaWQ6ICJzaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCIsXG4gICAgbGFiZWw6IHQoInNldHRpbmdzX3Nob3dfZm9ybWF0c19hdmFpbGFibGVfdmlhX3VkbCIpLFxuICAgIGNoZWNrZWQ6IHNob3dGb3JtYXRzQXZhaWxhYmxlVmlhVURMLFxuICAgIG9uQ2hhbmdlOiAoKSA9PiBzZXRTaG93Rm9ybWF0c0F2YWlsYWJsZVZpYVVETCghc2hvd0Zvcm1hdHNBdmFpbGFibGVWaWFVREwpXG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQodWlfY2hlY2tib3gsIHtcbiAgICBpZDogInNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uIixcbiAgICBsYWJlbDogdCgic2V0dGluZ3Nfc2hvd19mb3JtYXRzX3JlcXVpcmVkX29ubGluZV9jb252ZXJzaW9uIiksXG4gICAgY2hlY2tlZDogc2hvd0Zvcm1hdHNSZXF1aXJlZE9ubGluZUNvbnZlcnNpb24sXG4gICAgb25DaGFuZ2U6ICgpID0+IHNldFNob3dGb3JtYXRzUmVxdWlyZWRPbmxpbmVDb252ZXJzaW9uKCFzaG93Rm9ybWF0c1JlcXVpcmVkT25saW5lQ29udmVyc2lvbilcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9jaGVja2JveCwge1xuICAgIGlkOiAid2FybkJlZm9yZUNvbnZlcnRpbmciLFxuICAgIGxhYmVsOiB0KCJzZXR0aW5nc193YXJuX2JlZm9yZV9jb252ZXJ0aW5nIiksXG4gICAgY2hlY2tlZDogd2FybkJlZm9yZUNvbnZlcnRpbmcsXG4gICAgb25DaGFuZ2U6ICgpID0+IHNldFdhcm5CZWZvcmVDb252ZXJ0aW5nKCF3YXJuQmVmb3JlQ29udmVydGluZylcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9jaGVja2JveCwge1xuICAgIGlkOiAiZGlzcGxheVFyQ29kZXMiLFxuICAgIGxhYmVsOiB0KCJzZXR0aW5nc19kaXNwbGF5X3FyX2NvZGVzIiksXG4gICAgY2hlY2tlZDogZGlzcGxheVFyQ29kZXMsXG4gICAgb25DaGFuZ2U6ICgpID0+IHNldERpc3BsYXlRckNvZGVzKCFkaXNwbGF5UXJDb2RlcylcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9jaGVja2JveCwge1xuICAgIGlkOiAid2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24iIC8vIGxhYmVsPXt0KCJzZXR0aW5nc193YXJuX2Fib3V0X2NvbXBldGl0b3JzX2RldGVjdGlvbiIpfVxuICAgICxcbiAgICBsYWJlbDogIlxcdTA0MUZcXHUwNDQwXFx1MDQzNVxcdTA0MzRcXHUwNDQzXFx1MDQzRlxcdTA0NDBcXHUwNDM1XFx1MDQzNlxcdTA0MzRcXHUwNDMwXFx1MDQ0MlxcdTA0NEMgXFx1MDQzRVxcdTA0MzEgXFx1MDQzRVxcdTA0MzFcXHUwNDNEXFx1MDQzMFxcdTA0NDBcXHUwNDQzXFx1MDQzNlxcdTA0MzVcXHUwNDNEXFx1MDQzOFxcdTA0MzggXFx1MDQ0MVxcdTA0NDJcXHUwNDNFXFx1MDQ0MFxcdTA0M0VcXHUwNDNEXFx1MDQzRFxcdTA0MzhcXHUwNDQ1IFxcdTA0NDBcXHUwNDMwXFx1MDQ0MVxcdTA0NDhcXHUwNDM4XFx1MDQ0MFxcdTA0MzVcXHUwNDNEXFx1MDQzOFxcdTA0MzkgXFx1MDQzNFxcdTA0M0JcXHUwNDRGIFxcdTA0NDFcXHUwNDNBXFx1MDQzMFxcdTA0NDdcXHUwNDM4XFx1MDQzMlxcdTA0MzBcXHUwNDNEXFx1MDQzOFxcdTA0NEYgXFx1MDQzQ1xcdTA0NDNcXHUwNDNCXFx1MDQ0Q1xcdTA0NDJcXHUwNDM4XFx1MDQzQ1xcdTA0MzVcXHUwNDM0XFx1MDQzOFxcdTA0MzAuIixcbiAgICBjaGVja2VkOiB3YXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbixcbiAgICBvbkNoYW5nZTogKCkgPT4ge1xuICAgICAgc2V0V2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24oIXdhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uKTtcbiAgICB9XG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQodWlfY2hlY2tib3gsIHtcbiAgICBpZDogInNob3dTbmFwc2hvdEJ1dHRvbiIsXG4gICAgbGFiZWw6IHQoInNldHRpbmdzX3Nob3dfc25hcHNob3RfYnV0dG9uIiksXG4gICAgY2hlY2tlZDogc2hvd1NuYXBzaG90QnV0dG9uLFxuICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICBzZXRTaG93U25hcHNob3RCdXR0b24oIXNob3dTbmFwc2hvdEJ1dHRvbik7XG4gICAgfVxuICB9KSk7XG59O1xuY29uc3QgQXBwQnV0dG9uU3R5bGVTZXR0aW5ncyA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIGNvbnN0IHtcbiAgICBhcHBCdXR0b25TdHlsZSxcbiAgICBzZXRBcHBCdXR0b25TdHlsZVxuICB9ID0gdXNlQXBwU3RhdGUoWyJhcHBCdXR0b25TdHlsZSIsICJzZXRBcHBCdXR0b25TdHlsZSJdKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChUaXRsZSwgbnVsbCwgdCgic2V0dGluZ3NfdGl0bGVfYXBwX2J1dHRvbl9zdHlsZSIpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJhZGlvX2J1dHRvbiwge1xuICAgIGlkOiAiYnV0dG9uU29saWQiLFxuICAgIG5hbWU6ICJzZXR0aW5nc0FwcEJ1dHRvblN0eWxlIixcbiAgICBsYWJlbDogdCgic2V0dGluZ3NfYXBwX2J1dHRvbl9zdHlsZV9zb2xpZCIpLFxuICAgIGNoZWNrZWQ6IGFwcEJ1dHRvblN0eWxlID09PSAiU29saWQiLFxuICAgIG9uQ2hhbmdlOiAoKSA9PiB7XG4gICAgICBzZXRBcHBCdXR0b25TdHlsZSgiU29saWQiKTtcbiAgICB9XG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmFkaW9fYnV0dG9uLCB7XG4gICAgaWQ6ICJidXR0b25TcGxpdCIsXG4gICAgbmFtZTogInNldHRpbmdzQXBwQnV0dG9uU3R5bGUiLFxuICAgIGxhYmVsOiB0KCJzZXR0aW5nc19hcHBfYnV0dG9uX3N0eWxlX3NwbGl0IiksXG4gICAgY2hlY2tlZDogYXBwQnV0dG9uU3R5bGUgPT09ICJTcGxpdCIsXG4gICAgb25DaGFuZ2U6ICgpID0+IHtcbiAgICAgIHNldEFwcEJ1dHRvblN0eWxlKCJTcGxpdCIpO1xuICAgIH1cbiAgfSkpO1xufTtcbmNvbnN0IExhbmdTZXR0aW5ncyA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIGxhbmcsXG4gICAgc2V0TGFuZ1xuICB9ID0gdXNlQXBwU3RhdGUoWyJsYW5nIiwgInNldExhbmciXSk7XG4gIGNvbnN0IHtcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X2RlZmF1bHQuYS5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFRpdGxlLCBudWxsLCB0KCJsYW5ndWFnZSIpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJhZGlvX2J1dHRvbiwge1xuICAgIGlkOiAiYXV0b0RldGVjdCIsXG4gICAgbmFtZTogInNldHRpbmdzTGFuZ3VhZ2UiLFxuICAgIGxhYmVsOiB0KCJhdXRvX2RldGVjdCIpLFxuICAgIGNoZWNrZWQ6IGxhbmcgPT09ICJhdXRvRGV0ZWN0IixcbiAgICBvbkNoYW5nZTogKCkgPT4gc2V0TGFuZygiYXV0b0RldGVjdCIpXG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmFkaW9fYnV0dG9uLCB7XG4gICAgaWQ6ICJlbiIsXG4gICAgbmFtZTogInNldHRpbmdzTGFuZ3VhZ2UiLFxuICAgIGxhYmVsOiAiRW5nbGlzaCIsXG4gICAgY2hlY2tlZDogbGFuZyA9PT0gImVuIixcbiAgICBvbkNoYW5nZTogKCkgPT4gc2V0TGFuZygiZW4iKVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJhZGlvX2J1dHRvbiwge1xuICAgIGlkOiAicnUiLFxuICAgIG5hbWU6ICJzZXR0aW5nc0xhbmd1YWdlIixcbiAgICBsYWJlbDogIlxcdTA0MjBcXHUwNDQzXFx1MDQ0MVxcdTA0NDFcXHUwNDNBXFx1MDQzOFxcdTA0MzkiLFxuICAgIGNoZWNrZWQ6IGxhbmcgPT09ICJydSIsXG4gICAgb25DaGFuZ2U6ICgpID0+IHNldExhbmcoInJ1IilcbiAgfSkpO1xufTtcblxuY29uc3QgU2V0dGluZ3MgPSAoKSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoUGFnZUNvbnRhaW5lciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KE1haW5TZXR0aW5ncywgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChBcHBCdXR0b25TdHlsZVNldHRpbmdzLCBudWxsKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KExhbmdTZXR0aW5ncywgbnVsbCkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBzZXR0aW5ncyA9IChTZXR0aW5ncyk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvcGFnZXMvc2V0dGluZ3MtZnVsbC5qc3hcblxuXG5cblxuIC8vIGltcG9ydCBub3RpZmljYXRpb24gZnJvbSAiLi4vY29tcG9uZW50cy91aS9ub3RpZmljYXRpb25zIjtcblxuXG5cblxuY29uc3QgWWFuZGV4TWFya2V0QWR2aXNlciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgJiBsYWJlbCB7IHdpZHRoOiBjYWxjKDEwMCUgLSA3MHB4KTsgfVxuYDtcbmNvbnN0IHNldHRpbmdzX2Z1bGxfQnV0dG9uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGJvcmRlcjogbm9uZTtcbiAgcGFkZGluZzogMDtcbiAgaGVpZ2h0OiAyMXB4O1xuICAmIHN2ZyBwYXRoIHsgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5idXR0b25Db2xvcn07IH1cbiAgJjpub3QoOmRpc2FibGVkKSB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICY6aG92ZXIge1xuICAgICAgJiBzdmcgcGF0aCB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uSG92ZXJDb2xvcn07IH1cbiAgICAgICYgc3BhbiB7IGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmJ1dHRvbkhvdmVyQ29sb3J9OyB9XG4gICAgfVxuICB9XG4gICY6ZGlzYWJsZWQgeyBvcGFjaXR5OiAwLjQ7IH1cbmA7XG5cbmNvbnN0IFNldHRpbmdzRnVsbCA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIHRoZW1lLFxuICAgIGxvYWRZYW5kZXhNYXJrZXRBZHZpc2VyLFxuICAgIHNldExvYWRZYW5kZXhNYXJrZXRBZHZpc2VyLFxuICAgIGFkZE5vdGlmaWNhdGlvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJ0aGVtZSIsICJsb2FkWWFuZGV4TWFya2V0QWR2aXNlciIsICJzZXRMb2FkWWFuZGV4TWFya2V0QWR2aXNlciIsICJhZGROb3RpZmljYXRpb24iXSk7XG4gIGNvbnN0IHtcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBidXR0b25TdHlsZXMgPSB0aGVtZSAmJiB0aGVtZS5pY29uX2J1dHRvbjtcbiAgY29uc3QgYnV0dG9uQ29sb3IgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmNvbG9yO1xuICBjb25zdCBidXR0b25Ib3ZlckNvbG9yID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5ob3ZlcjtcbiAgY29uc3QgW2lzTm90aWZpY2F0aW9uU2hvdywgc2V0SXNOb3RpZmljYXRpb25TaG93XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBkaWRNb3VudFJlZiA9IE9iamVjdChyZWFjdFsidXNlUmVmIl0pKG51bGwpO1xuICBjb25zdCBsb2NhbExvYWRZYW5kZXhNYXJrZXRBZHZpc2VyID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkobnVsbCk7XG5cbiAgaWYgKGxvY2FsTG9hZFlhbmRleE1hcmtldEFkdmlzZXIuY3VycmVudCA9PT0gbnVsbCkge1xuICAgIGxvY2FsTG9hZFlhbmRleE1hcmtldEFkdmlzZXIuY3VycmVudCA9IGxvYWRZYW5kZXhNYXJrZXRBZHZpc2VyO1xuICB9XG5cbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGRpZE1vdW50UmVmLmN1cnJlbnQgPSB0cnVlO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkaWRNb3VudFJlZi5jdXJyZW50ID0gZmFsc2U7XG4gICAgfTtcbiAgfSwgW10pO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgaWYgKGRpZE1vdW50UmVmLmN1cnJlbnQgJiYgbG9hZFlhbmRleE1hcmtldEFkdmlzZXIgIT09IGxvY2FsTG9hZFlhbmRleE1hcmtldEFkdmlzZXIuY3VycmVudCkge1xuICAgICAgbG9jYWxMb2FkWWFuZGV4TWFya2V0QWR2aXNlci5jdXJyZW50ID0gbG9hZFlhbmRleE1hcmtldEFkdmlzZXI7XG5cbiAgICAgIGlmICghaXNOb3RpZmljYXRpb25TaG93KSB7XG4gICAgICAgIHNldElzTm90aWZpY2F0aW9uU2hvdyh0cnVlKTtcbiAgICAgICAgYWRkTm90aWZpY2F0aW9uKHtcbiAgICAgICAgICBpY29uOiBpY29uc193YXJuaW5nLFxuICAgICAgICAgIG1lc3NhZ2U6IHQoIndhcm5pbmciKSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogdCgieWFuZGV4X21hcmtldF9hZHZpc2VyX25vdGlmaWNhdGlvbl9kZXNjcmlwdGlvbiIpLFxuICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChkaWRNb3VudFJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgICAgIHNldElzTm90aWZpY2F0aW9uU2hvdyhmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIFtsb2FkWWFuZGV4TWFya2V0QWR2aXNlciwgdCwgYWRkTm90aWZpY2F0aW9uLCBpc05vdGlmaWNhdGlvblNob3ddKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChQYWdlQ29udGFpbmVyLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoTWFpblNldHRpbmdzLCBudWxsKSwgbG9hZFlhbmRleE1hcmtldEFkdmlzZXIgIT09IG51bGwgJiYgbG9hZFlhbmRleE1hcmtldEFkdmlzZXIgIT09IHVuZGVmaW5lZCAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoWWFuZGV4TWFya2V0QWR2aXNlciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX2NoZWNrYm94LCB7XG4gICAgaWQ6ICJsb2FkWWFuZGV4TWFya2V0QWR2aXNlciIsXG4gICAgbGFiZWw6IHQoInNob3dfeWFuZGV4X21hcmtldF9hZHZpc2VyIiksXG4gICAgY2hlY2tlZDogbG9hZFlhbmRleE1hcmtldEFkdmlzZXIsXG4gICAgb25DaGFuZ2U6ICgpID0+IHNldExvYWRZYW5kZXhNYXJrZXRBZHZpc2VyKCFsb2FkWWFuZGV4TWFya2V0QWR2aXNlcilcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChzZXR0aW5nc19mdWxsX0J1dHRvbiwge1xuICAgIGRpc2FibGVkOiAhbG9hZFlhbmRleE1hcmtldEFkdmlzZXIsXG4gICAgb25DbGljazogKCkgPT4ge1xuICAgICAgd2luZG93Lm9wZW4oImh0dHBzOi8vc292ZXRuaWsubWFya2V0LnlhbmRleC5ydS9hcHAvc2V0dGluZ3MvIiwgIl9ibGFuayIpO1xuICAgIH0sXG4gICAgYnV0dG9uQ29sb3I6IGJ1dHRvbkNvbG9yLFxuICAgIGJ1dHRvbkhvdmVyQ29sb3I6IGJ1dHRvbkhvdmVyQ29sb3JcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHNwYW5uZXIsIG51bGwpKSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChBcHBCdXR0b25TdHlsZVNldHRpbmdzLCBudWxsKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KExhbmdTZXR0aW5ncywgbnVsbCkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgc2V0dGluZ3NfZnVsbCA9IChTZXR0aW5nc0Z1bGwpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdXRpbHMvc2Nyb2xsLXRvLmpzXG5jb25zdCBzY3JvbGxUbyA9IChlbGVtZW50LCB0bywgZHVyYXRpb24pID0+IHtcbiAgaWYgKGR1cmF0aW9uIDw9IDApIHJldHVybjtcbiAgY29uc3QgeyBzY3JvbGxUb3AgfSA9IGVsZW1lbnQ7XG4gIGNvbnN0IGRpZmZlcmVuY2UgPSB0byAtIHNjcm9sbFRvcDtcbiAgY29uc3QgcGVyVGljayA9IChkaWZmZXJlbmNlIC8gZHVyYXRpb24pICogMTA7XG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIE9iamVjdC5hc3NpZ24oZWxlbWVudCwgeyBzY3JvbGxUb3A6IHNjcm9sbFRvcCArIHBlclRpY2sgfSk7XG4gICAgaWYgKGVsZW1lbnQuc2Nyb2xsVG9wID09PSB0bykgcmV0dXJuO1xuICAgIHNjcm9sbFRvKGVsZW1lbnQsIHRvLCBkdXJhdGlvbiAtIDEwKTtcbiAgfSwgMTApO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgc2Nyb2xsX3RvID0gKHNjcm9sbFRvKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvZW5xdWlyeS5qc3hcblxuXG5jb25zdCBJY29uRW5xdWlyeSA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjNweCIsXG4gIGhlaWdodDogIjE0cHgiLFxuICB2aWV3Qm94OiAiMCAwIDIzIDE0IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk01LjIsMi41SDVjLTEuMiwwLTIuMiwxLTIuMiwyLjJ2MC41aDEuNFY0LjdjMC0wLjUsMC40LTAuOSwwLjktMC45aDAuM2MwLjUsIDAsMC45LDAuNCwwLjksMC45YzAsMC4zLTAuMiwwLjYtMC41LDAuOEw0LjEsNi40djIuMmgxLjRWNy4ybDAuOS0wLjVjMC43LTAuNCwgMS4yLTEuMSwxLjItMkM3LjUsMy41LDYuNCwyLjUsNS4yLDIuNXoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk00LjEsOS45aDEuNHYxLjRINC4xVjkuOXoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0yMC43LDBIMi4zQzEsMCwwLDEsMCwyLjN2OS40QzAsMTMsMSwxNCwyLjMsMTRoMTguNGMxLjMsMCwyLjMtMSwyLjMtMi4zVjIuM0MyMywgMSwyMiwwLDIwLjcsMHogTTEuNCwxMS43VjIuM2MwLTAuNSwwLjQtMSwxLTFoNi41djExLjNIMi4zQzEuOCwxMi42LDEuNCwxMi4yLDEuNCwgMTEuN3ogTTIxLjcsMTEuN2MwLDAuNS0wLjQsMS0xLDFIMTAuMlYxLjRoMTAuNmMwLjUsMCwxLDAuNCwxLDFWMTEuN3oiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xMS41LDMuNmg4LjhWNWgtOC44VjMuNnoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xMS41LDYuM2g2LjF2MS40aC02LjFWNi4zeiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTExLjUsOWg0LjF2MS40aC00LjFWOXoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGVucXVpcnkgPSAoSWNvbkVucXVpcnkpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvYW5nbGUtZG93bi5qc3hcblxuXG5jb25zdCBJY29uQW5nbGVEb3duID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxMy43cHgiLFxuICBoZWlnaHQ6ICI4cHgiLFxuICB2aWV3Qm94OiAiMCAwIDEzLjcgOCIsXG4gIHN0eWxlOiBzdHlsZSxcbiAgY2xhc3NOYW1lOiBjbGFzc05hbWVcbn0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNMTMuNSwwLjJjLTAuMi0wLjItMC42LTAuMi0wLjgsMEw2LjksNi42TDEsMC4yYy0wLjItMC4yLTAuNi0wLjItMC44LCAwcy0wLjIsMC42LDAsMC44bDYuMiw2LjlDNi41LDgsNi43LDgsNi44LDhDNyw4LDcuMiw4LDcuMyw3LjhMMTMuNSwgMUMxMy44LDAuOCwxMy44LDAuNCwxMy41LDAuMnoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGFuZ2xlX2Rvd24gPSAoSWNvbkFuZ2xlRG93bik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9hY2NvcmRpb24vaXRlbS5qc3hcblxuXG5cblxuXG5cbmNvbnN0IGl0ZW1fSW5wdXQgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uaW5wdXRgXG4gIGRpc3BsYXk6IG5vbmU7XG4gICY6bm90KDpjaGVja2VkKSArIGxhYmVsIHtcbiAgICAmIGRpdiArIHN2ZyB7IHRyYW5zZm9ybTogJHtwcm9wcyA9PiBwcm9wcy5pY29uVHJhbnNmb3JtfTsgfVxuICAgICYgKyBkaXYgeyAgaGVpZ2h0OiAwOyB9XG4gIH1cbiAgJjpjaGVja2VkICsgbGFiZWwgKyBkaXYge1xuICAgIGhlaWdodDogJHtwcm9wcyA9PiBwcm9wcy5jb250ZW50SGVpZ2h0ICYmIGAke3Byb3BzLmNvbnRlbnRIZWlnaHR9cHhgfTtcbiAgfVxuYDtcbmNvbnN0IGl0ZW1fTGFiZWwgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10ubGFiZWxgXG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBib3JkZXItcmFkaXVzOiAycHg7XG4gIG1pbi1oZWlnaHQ6IDMwcHg7XG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuaGVhZGVyQmFja2dyb3VuZH07XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmhlYWRlckNvbG9yfTtcbiAgcGFkZGluZzogNHB4IDhweDtcbiAgJjpub3QoOmZpcnN0LW9mLXR5cGUpIHsgbWFyZ2luLXRvcDogOHB4IH1cbiAgJiBzdmcgeyBmaWxsOiAke3Byb3BzID0+IHByb3BzLmhlYWRlckNvbG9yfSB9XG5gO1xuY29uc3QgVGl0bGVDb250YWluZXIgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBtYXgtd2lkdGg6IGNhbGMoMTAwJSAtIDMwcHgpO1xuICAmICsgc3ZnIHsgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuM3MgZWFzZS1pbi1vdXQgfVxuYDtcbmNvbnN0IGl0ZW1fVGl0bGUgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uc3BhbmBcbiAgZm9udC1zaXplOiAxNHB4O1xuICBtYXJnaW46IDAgOHB4O1xuYDtcbmNvbnN0IENvbnRlbnRNYXNrID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgdHJhbnNpdGlvbjogaGVpZ2h0IDAuM3MgZWFzZS1pbi1vdXQ7XG5gO1xuY29uc3QgQ29udGVudCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29udGVudEJhY2tncm91bmR9O1xuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5jb250ZW50Q29sb3J9O1xuICBmb250LXNpemU6IDE0cHg7XG4gIHBhZGRpbmc6IDhweDtcbiAgJiBhIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29udGVudENvbG9yfSB9XG5gO1xuXG5jb25zdCBpdGVtX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgZGlyOiBzdGF0ZS5kaXIsXG4gIHRoZW1lOiBzdGF0ZS50aGVtZVxufSk7XG5cbmNvbnN0IEl0ZW0gPSAoe1xuICB0eXBlLFxuICBpZCxcbiAgbmFtZSxcbiAgY2hlY2tlZCxcbiAgb25DaGVjayxcbiAgb25DaGFuZ2UsXG4gIGhlYWRlcixcbiAgY29udGVudFxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGlyLFxuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihpdGVtX21hcFN0YXRlKTtcbiAgY29uc3QgW2NvbnRlbnROb2RlLCBzZXRDb250ZW50Tm9kZV0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKG51bGwpO1xuICBjb25zdCBbY29udGVudEhlaWdodCwgc2V0Q29udGVudEhlaWdodF0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKG51bGwpO1xuXG4gIGNvbnN0IGNvbnRlbnRSZWYgPSBub2RlID0+IHtcbiAgICBzZXRDb250ZW50Tm9kZShub2RlKTtcblxuICAgIGlmIChub2RlICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBib3VuZGluZ0NsaWVudFJlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gYm91bmRpbmdDbGllbnRSZWN0ICYmIGJvdW5kaW5nQ2xpZW50UmVjdC5oZWlnaHQ7XG4gICAgICBpZiAoaGVpZ2h0KSBzZXRDb250ZW50SGVpZ2h0KGhlaWdodCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGlzQ2hlY2tib3ggPSB0eXBlID09PSAiY2hlY2tib3giO1xuICBjb25zdCBbaXNDaGVja2VkLCBzZXRJc0NoZWNrZWRdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShjaGVja2VkKTtcbiAgY29uc3QgZGVmYXVsdENoZWNrZWQgPSBpc0NoZWNrYm94ID8gaXNDaGVja2VkIDogY2hlY2tlZDtcbiAgY29uc3QgYWNjb3JkaW9uU3R5bGVzID0gdGhlbWUgJiYgdGhlbWUuYWNjb3JkaW9uO1xuICBjb25zdCBoZWFkZXJTdHlsZXMgPSBhY2NvcmRpb25TdHlsZXMgJiYgYWNjb3JkaW9uU3R5bGVzLmhlYWRlcjtcbiAgY29uc3QgaGVhZGVyQmFja2dyb3VuZCA9IGhlYWRlclN0eWxlcyAmJiBoZWFkZXJTdHlsZXMuYmFja2dyb3VuZDtcbiAgY29uc3QgaGVhZGVyQ29sb3IgPSBoZWFkZXJTdHlsZXMgJiYgaGVhZGVyU3R5bGVzLmNvbG9yO1xuICBjb25zdCBjb250ZW50U3R5bGVzID0gYWNjb3JkaW9uU3R5bGVzICYmIGFjY29yZGlvblN0eWxlcy5jb250ZW50O1xuICBjb25zdCBjb250ZW50QmFja2dyb3VuZCA9IGNvbnRlbnRTdHlsZXMgJiYgY29udGVudFN0eWxlcy5iYWNrZ3JvdW5kO1xuICBjb25zdCBjb250ZW50Q29sb3IgPSBjb250ZW50U3R5bGVzICYmIGNvbnRlbnRTdHlsZXMuY29sb3I7XG4gIGNvbnN0IGNvbnRlbnRIeXBlcmxpbmsgPSBjb250ZW50U3R5bGVzICYmIGNvbnRlbnRTdHlsZXMuaHlwZXJsaW5rO1xuICBjb25zdCBjb250ZW50SHlwZXJsaW5rQ29sb3IgPSBjb250ZW50SHlwZXJsaW5rICYmIGNvbnRlbnRIeXBlcmxpbmsuY29sb3I7XG4gIGNvbnN0IGNvbnRlbnRIeXBlcmxpbmtIb3ZlciA9IGNvbnRlbnRIeXBlcmxpbmsgJiYgY29udGVudEh5cGVybGluay5ob3ZlcjtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChpdGVtX0lucHV0LCB7XG4gICAgdHlwZTogaXNDaGVja2JveCA/ICJjaGVja2JveCIgOiAicmFkaW8iLFxuICAgIGlkOiBpZCxcbiAgICBuYW1lOiBuYW1lLFxuICAgIGRlZmF1bHRDaGVja2VkOiBkZWZhdWx0Q2hlY2tlZCxcbiAgICBjb250ZW50SGVpZ2h0OiBjb250ZW50SGVpZ2h0LFxuICAgIGljb25UcmFuc2Zvcm06IGByb3RhdGUoJHtkaXIgPT09ICJydGwiID8gLTkwIDogOTB9ZGVnKWAsXG4gICAgb25DaGFuZ2U6ICgpID0+IG9uQ2hhbmdlKGRlZmF1bHRDaGVja2VkKVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGl0ZW1fTGFiZWwsIHtcbiAgICBodG1sRm9yOiBpZCxcbiAgICBoZWFkZXJCYWNrZ3JvdW5kOiBoZWFkZXJCYWNrZ3JvdW5kLFxuICAgIGhlYWRlckNvbG9yOiBoZWFkZXJDb2xvcixcbiAgICBvbkNsaWNrOiAoKSA9PiBpc0NoZWNrYm94ID8gc2V0SXNDaGVja2VkKCFpc0NoZWNrZWQpIDogb25DaGVjaygpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChUaXRsZUNvbnRhaW5lciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGVucXVpcnksIHtcbiAgICBzdHlsZToge1xuICAgICAgbWluV2lkdGg6IDIzXG4gICAgfVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGl0ZW1fVGl0bGUsIG51bGwsIGhlYWRlcikpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoYW5nbGVfZG93biwgbnVsbCkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQ29udGVudE1hc2ssIHtcbiAgICBvblRyYW5zaXRpb25FbmQ6ICgpID0+IHtcbiAgICAgIGlmIChkZWZhdWx0Q2hlY2tlZCAmJiBjb250ZW50Tm9kZSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBjb250YWluZXJOb2RlID0gY29udGVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgICAgICBjb25zdCBib3VuZGluZ0NsaWVudFJlY3QgPSBjb250YWluZXJOb2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSBib3VuZGluZ0NsaWVudFJlY3QgJiYgYm91bmRpbmdDbGllbnRSZWN0LmhlaWdodDtcblxuICAgICAgICBpZiAoY29udGFpbmVySGVpZ2h0ICYmIGNvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgICBjb25zdCB0aXRsZU5vZGUgPSBjb250ZW50Tm9kZS5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZztcbiAgICAgICAgICBjb25zdCB0aXRsZU9mZnNldFRvcCA9IHRpdGxlTm9kZS5vZmZzZXRUb3A7XG4gICAgICAgICAgY29uc3QgY29udGFpbmVyT2Zmc2V0VG9wID0gY29udGFpbmVyTm9kZS5vZmZzZXRUb3A7XG4gICAgICAgICAgY29uc3QgY29udGVudE9mZnNldFRvcCA9IGNvbnRlbnROb2RlLm9mZnNldFRvcDtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICBzY3JvbGxUb3BcbiAgICAgICAgICB9ID0gY29udGFpbmVyTm9kZTtcbiAgICAgICAgICBjb25zdCBzY3JvbGxUb3BNaW4gPSBjb250ZW50T2Zmc2V0VG9wIC0gY29udGFpbmVyT2Zmc2V0VG9wICsgY29udGVudEhlaWdodCAtIGNvbnRhaW5lckhlaWdodDtcbiAgICAgICAgICBjb25zdCBzY3JvbGxUb3BNYXggPSB0aXRsZU9mZnNldFRvcCAtIGNvbnRhaW5lck9mZnNldFRvcDtcblxuICAgICAgICAgIGlmIChzY3JvbGxUb3AgPCBzY3JvbGxUb3BNaW4pIHtcbiAgICAgICAgICAgIHNjcm9sbF90byhjb250YWluZXJOb2RlLCBzY3JvbGxUb3BNaW4sIDIwMCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChzY3JvbGxUb3AgPiBzY3JvbGxUb3BNYXgpIHtcbiAgICAgICAgICAgIHNjcm9sbF90byhjb250YWluZXJOb2RlLCBzY3JvbGxUb3BNYXgsIDIwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQ29udGVudCwge1xuICAgIHJlZjogY29udGVudFJlZixcbiAgICBjb250ZW50QmFja2dyb3VuZDogY29udGVudEJhY2tncm91bmQsXG4gICAgY29udGVudENvbG9yOiBjb250ZW50Q29sb3IsXG4gICAgY29udGVudEh5cGVybGlua0NvbG9yOiBjb250ZW50SHlwZXJsaW5rQ29sb3IsXG4gICAgY29udGVudEh5cGVybGlua0hvdmVyOiBjb250ZW50SHlwZXJsaW5rSG92ZXJcbiAgfSwgY29udGVudCkpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGFjY29yZGlvbl9pdGVtID0gKEl0ZW0pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvdWkvYWNjb3JkaW9uL2luZGV4LmpzeFxuXG5cblxuXG5jb25zdCBhY2NvcmRpb25fQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgaGVpZ2h0OiAzMjBweDtcbiAgbWFyZ2luOiAwIDE2cHg7XG4gIHBhZGRpbmctYm90dG9tOiA4cHg7XG4gICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAibHRyIiAmJiAicGFkZGluZy1yaWdodDogNnB4OyJ9XG4gICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAicnRsIiAmJiAicGFkZGluZy1sZWZ0OiA2cHg7In1cbiAgJjo6LXdlYmtpdC1zY3JvbGxiYXIge1xuICAgIHdpZHRoOiA0cHg7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5zY3JvbGxiYXJCYWNrZ3JvdW5kfTtcbiAgICBib3JkZXI6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLnNjcm9sbGJhckJvcmRlcn07XG4gIH1cbiAgJjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuc2Nyb2xsYmFyVGh1bWJ9O1xuICB9XG4gIHNjcm9sbGJhci1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5zY3JvbGxiYXJUaHVtYn0gJHtwcm9wcyA9PiBwcm9wcy5zY3JvbGxiYXJCYWNrZ3JvdW5kRmlyZWZveH07XG4gIHNjcm9sbGJhci13aWR0aDogdGhpbjtcbmA7XG5cbmNvbnN0IGFjY29yZGlvbl9tYXBTdGF0ZSA9IHN0YXRlID0+ICh7XG4gIGRpcjogc3RhdGUuZGlyLFxuICB0aGVtZTogc3RhdGUudGhlbWVcbn0pO1xuXG5jb25zdCBBY2NvcmRpb24gPSAoe1xuICB0eXBlLFxuICBuYW1lLFxuICBkYXRhLFxuICBzY3JvbGxUb3AsXG4gIG9uU2Nyb2xsLFxuICBvbkNoYW5nZVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGlyLFxuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihhY2NvcmRpb25fbWFwU3RhdGUpO1xuICBjb25zdCBbY29udGFpbmVyTm9kZSwgc2V0Q29udGFpbmVyTm9kZV0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKG51bGwpO1xuICBjb25zdCBbY2hlY2tlZEl0ZW0sIHNldENoZWNrZWRJdGVtXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZGF0YSAmJiBkYXRhLm1hcChlID0+IGUuY2hlY2tlZCkuaW5kZXhPZih0cnVlKSk7XG4gIGNvbnN0IGl0ZW1OYW1lID0gYHVuaWRvd25sb2FkZXItYWNjb3JkaW9uLSR7bmFtZX1gO1xuICBjb25zdCBzY3JvbGxiYXJTdHlsZXMgPSB0aGVtZSAmJiB0aGVtZS5zY3JvbGxiYXI7XG4gIGNvbnN0IHNjcm9sbGJhckJhY2tncm91bmQgPSBzY3JvbGxiYXJTdHlsZXMgJiYgc2Nyb2xsYmFyU3R5bGVzLmJhY2tncm91bmQ7XG4gIGNvbnN0IHNjcm9sbGJhckJhY2tncm91bmRGaXJlZm94ID0gc2Nyb2xsYmFyU3R5bGVzICYmIHNjcm9sbGJhclN0eWxlcy5iYWNrZ3JvdW5kX2ZpcmVmb3g7XG4gIGNvbnN0IHNjcm9sbGJhckJvcmRlciA9IHNjcm9sbGJhclN0eWxlcyAmJiBzY3JvbGxiYXJTdHlsZXMuYm9yZGVyO1xuICBjb25zdCBzY3JvbGxiYXJUaHVtYiA9IHNjcm9sbGJhclN0eWxlcyAmJiBzY3JvbGxiYXJTdHlsZXMudGh1bWI7XG5cbiAgaWYgKHNjcm9sbFRvcCAmJiBjb250YWluZXJOb2RlKSB7XG4gICAgY29udGFpbmVyTm9kZS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gIH1cblxuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFjY29yZGlvbl9Db250YWluZXIsIHtcbiAgICBkaXI6IGRpcixcbiAgICBzY3JvbGxiYXJCYWNrZ3JvdW5kOiBzY3JvbGxiYXJCYWNrZ3JvdW5kLFxuICAgIHNjcm9sbGJhckJhY2tncm91bmRGaXJlZm94OiBzY3JvbGxiYXJCYWNrZ3JvdW5kRmlyZWZveCxcbiAgICBzY3JvbGxiYXJCb3JkZXI6IHNjcm9sbGJhckJvcmRlcixcbiAgICBzY3JvbGxiYXJUaHVtYjogc2Nyb2xsYmFyVGh1bWIsXG4gICAgcmVmOiBub2RlID0+IHtcbiAgICAgIHNldENvbnRhaW5lck5vZGUobm9kZSk7XG4gICAgfSxcbiAgICBvblNjcm9sbDogKCkgPT4ge1xuICAgICAgaWYgKG9uU2Nyb2xsICYmIGNvbnRhaW5lck5vZGUpIHtcbiAgICAgICAgb25TY3JvbGwoY29udGFpbmVyTm9kZS5zY3JvbGxUb3ApO1xuICAgICAgfVxuICAgIH1cbiAgfSwgZGF0YSAmJiBkYXRhLm1hcCgoaXRlbSwgaSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFjY29yZGlvbl9pdGVtLCB7XG4gICAga2V5OiBpdGVtLmhlYWRlcixcbiAgICB0eXBlOiB0eXBlLFxuICAgIGlkOiBgJHtpdGVtTmFtZX0tJHtpfWAsXG4gICAgbmFtZTogaXRlbU5hbWUsXG4gICAgY2hlY2tlZDogdHlwZSA9PT0gImNoZWNrYm94IiA/IGl0ZW0uY2hlY2tlZCA6IGkgPT09IGNoZWNrZWRJdGVtLFxuICAgIG9uQ2hlY2s6ICgpID0+IHtcbiAgICAgIHNldENoZWNrZWRJdGVtKGkgPT09IGNoZWNrZWRJdGVtID8gLTEgOiBpKTtcbiAgICB9LFxuICAgIG9uQ2hhbmdlOiBjaGVja2VkID0+IHtcbiAgICAgIGlmIChvbkNoYW5nZSkgb25DaGFuZ2UoaSwgY2hlY2tlZCk7XG4gICAgfSxcbiAgICBoZWFkZXI6IGl0ZW0uaGVhZGVyLFxuICAgIGNvbnRlbnQ6IGl0ZW0uY29udGVudFxuICB9KSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgYWNjb3JkaW9uID0gKEFjY29yZGlvbik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9jYW1lcmEuanN4XG5cblxuY29uc3QgSWNvbkNhbWVyYSA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjJweCIsXG4gIGhlaWdodDogIjE4cHgiLFxuICB2aWV3Qm94OiAiMCAwIDIyIDE4IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0gMjIgNC45IFEgMjIgMy44IDIxLjIgMy4wNSAyMC40IDIuMjUgMTkuMyAyLjI1IEwgMTYuNCAyLjI1IDE2IDEuMyBRIDE1LjY1IDAuNSAxNC45IDAuMiAxNC41NSAwLjA1IDE0LjI1IDAgTCA3Ljc1IDAgUSA3LjQ1IDAuMDUgNy4xIDAuMiA2LjM1IDAuNSA2IDEuMyBMIDUuNiAyLjI1IDIuNyAyLjI1IFEgMS42IDIuMjUgMC44NSAzLjA1IDAuMDUgMy44IDAgNC45IEwgMCAxNS4zIFEgMC4wNSAxNi40IDAuODUgMTcuMTUgMS42IDE3Ljk1IDIuNyAxOCBMIDE5LjMgMTggUSAyMC40IDE3Ljk1IDIxLjIgMTcuMTUgMjIgMTYuNCAyMiAxNS4zIEwgMjIgNC45IE0gMTEgNC45IFEgMTMuMTUgNC45IDE0LjcgNi40IDE2LjIgNy45NSAxNi4yIDEwLjEgMTYuMiAxMi4zIDE0LjcgMTMuOCAxMy4xNSAxNS4zIDExIDE1LjMgOC44NSAxNS4zIDcuMzUgMTMuOCA1LjggMTIuMyA1LjggMTAuMSA1LjggNy45NSA3LjM1IDYuNCA4Ljg1IDQuOSAxMSA0LjkgTSAxMy40IDcuNzUgUSAxMi40IDYuNzUgMTEgNi43NSA5LjYgNi43NSA4LjYgNy43NSA3LjY1IDguNyA3LjY1IDEwLjEgNy42NSAxMS41IDguNiAxMi41IDkuNiAxMy41IDExIDEzLjUgMTIuNCAxMy41IDEzLjQgMTIuNSAxNC4zNSAxMS41IDE0LjM1IDEwLjEgMTQuMzUgOC43IDEzLjQgNy43NSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBjYW1lcmEgPSAoSWNvbkNhbWVyYSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvcGFnZXMvaGVscC5qc3hcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbmNvbnN0IGhlbHBfQnV0dG9uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgb3V0bGluZTogbm9uZTtcbiAgYm9yZGVyOiBub25lO1xuICBtYXJnaW46IDIycHggYXV0byAxMXB4O1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50O1xuICAmIHN2ZyBwYXRoIHsgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5idXR0b25Db2xvcn07IH1cbiAgJiBzcGFuIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uQ29sb3J9OyB9XG4gICY6aG92ZXIge1xuICAgICYgc3ZnIHBhdGggeyBmaWxsOiAke3Byb3BzID0+IHByb3BzLmJ1dHRvbkhvdmVyQ29sb3J9OyB9XG4gICAgJiBzcGFuIHsgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYnV0dG9uSG92ZXJDb2xvcn07IH1cbiAgfVxuYDtcbmNvbnN0IGhlbHBfVGV4dCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5zcGFuYFxuICBmb250LXNpemU6IDE0cHg7XG4gICY6OmJlZm9yZSB7XG4gICAgY29udGVudDogIiAiO1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICB3aWR0aDogN3B4O1xuICB9XG5gO1xuY29uc3QgU3RTcGFuID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLnNwYW5gXG4gIGZvbnQtc2l6ZTogMTRweDtcbiAgbGluZS1oZWlnaHQ6IDIwcHg7XG4gIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG4gICYgYSB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lO1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbnRlbnRIeXBlcmxpbmtDb2xvcn07XG4gICAgJjpob3ZlciB7IGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbnRlbnRIeXBlcmxpbmtIb3Zlcn0gfVxuICB9XG4gICYgbGk6OmJlZm9yZSB7XG4gICAgY29udGVudDogIlxcdTI1Q0YiO1xuICAgIG1hcmdpbjogMCA2cHg7XG4gIH1cbmA7XG5cbmNvbnN0IFNwYW4gPSAoe1xuICBodG1sXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoU3RTcGFuLCB7XG4gIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7XG4gICAgX19odG1sOiBodG1sXG4gIH1cbn0pO1xuXG5jb25zdCBoZWxwX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lLFxuICBoZWxwU3RhdGU6IHN0YXRlLmhlbHBTdGF0ZVxufSk7XG5cbmNvbnN0IEltZ0lubGluZSA9IChpbWcsIGtleSwgaXNOYnNwQmVmb3JlKSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IoaGVscF9tYXBTdGF0ZSk7XG4gIGNvbnN0IGFjY29yZGlvblN0eWxlcyA9IHRoZW1lICYmIHRoZW1lLmFjY29yZGlvbjtcbiAgY29uc3QgY29udGVudFN0eWxlcyA9IGFjY29yZGlvblN0eWxlcyAmJiBhY2NvcmRpb25TdHlsZXMuY29udGVudDtcbiAgY29uc3QgY29udGVudENvbG9yID0gY29udGVudFN0eWxlcyAmJiBjb250ZW50U3R5bGVzLmNvbG9yO1xuICBjb25zdCBzdHlsZSA9IHtcbiAgICBmaWxsOiBjb250ZW50Q29sb3IsXG4gICAgdmVydGljYWxBbGlnbjogIm1pZGRsZSJcbiAgfTtcblxuICBpZiAoaXNOYnNwQmVmb3JlKSB7XG4gICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgibm9iciIsIHtcbiAgICAgIGtleToga2V5XG4gICAgfSwgIlxceEEwIiwgcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoaW1nLCB7XG4gICAgICBzdHlsZVxuICAgIH0pKTtcbiAgfVxuXG4gIHJldHVybiByZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChpbWcsIHtcbiAgICBrZXksXG4gICAgc3R5bGVcbiAgfSk7XG59O1xuXG5jb25zdCBBcnRpY2xlID0gKHtcbiAgY29udGVudFxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgaTE4blxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgbGV0IGVuZHNXaXRoTmJzcCA9IGZhbHNlO1xuICByZXR1cm4gY29udGVudC5yZXBsYWNlKC97JWxhbmclfS9nLCBpMThuLmxhbmd1YWdlKS5zcGxpdCgiXHgzYyEtLVsiKS5yZWR1Y2UoKHJlc3VsdCwgaXRlbSkgPT4ge1xuICAgIGlmIChpdGVtLnN0YXJ0c1dpdGgoImltZy1jYW1lcmEiKSkge1xuICAgICAgcmVzdWx0LnB1c2goSW1nSW5saW5lKGNhbWVyYSwgcmVzdWx0LCBlbmRzV2l0aE5ic3ApKTtcbiAgICB9IGVsc2UgaWYgKGl0ZW0uc3RhcnRzV2l0aCgiaW1nLWNvcHkiKSkge1xuICAgICAgcmVzdWx0LnB1c2goSW1nSW5saW5lKGljb25zX2NvcHksIHJlc3VsdCwgZW5kc1dpdGhOYnNwKSk7XG4gICAgfSBlbHNlIGlmIChpdGVtLnN0YXJ0c1dpdGgoImltZy1xci1jb2RlIikpIHtcbiAgICAgIHJlc3VsdC5wdXNoKEltZ0lubGluZShxcl9jb2RlLCByZXN1bHQsIGVuZHNXaXRoTmJzcCkpO1xuICAgIH0gZWxzZSBpZiAoaXRlbS5zdGFydHNXaXRoKCJpbWctZnBzLTYwIikpIHtcbiAgICAgIHJlc3VsdC5wdXNoKEltZ0lubGluZShmcHNfNjAsIHJlc3VsdCwgZW5kc1dpdGhOYnNwKSk7XG4gICAgfSBlbHNlIGlmIChpdGVtLnN0YXJ0c1dpdGgoImltZy1zb3VuZC1vbiIpKSB7XG4gICAgICByZXN1bHQucHVzaChJbWdJbmxpbmUoc291bmRfb24sIHJlc3VsdCwgZW5kc1dpdGhOYnNwKSk7XG4gICAgfVxuXG4gICAgY29uc3QgaW5kZXggPSBpdGVtLmluZGV4T2YoIl0tLVx4M2UiKTtcbiAgICBsZXQgc3RyID0gaW5kZXggPT09IC0xID8gaXRlbSA6IGl0ZW0uc3Vic3RyaW5nKGluZGV4ICsgNCk7XG4gICAgY29uc3QgbmJzcFBvcyA9IHN0ci5sZW5ndGggLSA2O1xuICAgIGVuZHNXaXRoTmJzcCA9IHN0ci5pbmRleE9mKCImbmJzcDsiLCBuYnNwUG9zKSAhPT0gLTE7XG4gICAgaWYgKGVuZHNXaXRoTmJzcCkgc3RyID0gc3RyLnN1YnN0cmluZygwLCBuYnNwUG9zKTtcbiAgICBpZiAoc3RyICE9PSAiIikgcmVzdWx0LnB1c2goIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChTcGFuLCB7XG4gICAgICBrZXk6IHJlc3VsdCxcbiAgICAgIGh0bWw6IHN0clxuICAgIH0pKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LCBbXSk7XG59O1xuXG5jb25zdCBIZWxwID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgdGhlbWUsXG4gICAgaGVscFN0YXRlXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihoZWxwX21hcFN0YXRlKTtcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICBjb25zdCB7XG4gICAgdCxcbiAgICBpMThuXG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBhcnRpY2xlcyA9IGkxOG4udCgiaGVscF9hcnRpY2xlcyIsIHtcbiAgICByZXR1cm5PYmplY3RzOiB0cnVlXG4gIH0pO1xuXG4gIGNvbnN0IGdldFNjcm9sbFRvcCA9ICgpID0+IGhlbHBTdGF0ZSAmJiBoZWxwU3RhdGUuc2Nyb2xsVG9wIHx8IDA7XG5cbiAgY29uc3QgZ2V0SXRlbUNoZWNrZWQgPSAoKSA9PiBoZWxwU3RhdGUgJiYgaGVscFN0YXRlLml0ZW1DaGVja2VkIHx8IG5ldyBBcnJheShhcnRpY2xlcy5sZW5ndGgpLmZpbGwoZmFsc2UpO1xuXG4gIGNvbnN0IGJ1dHRvblN0eWxlcyA9IHRoZW1lICYmIHRoZW1lLmljb25fYnV0dG9uO1xuICBjb25zdCBidXR0b25Db2xvciA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuY29sb3I7XG4gIGNvbnN0IGJ1dHRvbkhvdmVyQ29sb3IgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmhvdmVyO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgY29uc3QgaGFuZGxlciA9IGUgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmxvY2FsTmFtZSA9PT0gImEiICYmIGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgiZGF0YS11bmlkb3dubG9hZGVyLXBhZ2UiKSA9PT0gInNldHRpbmdzIikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGhpc3RvcnkucHVzaCgiL3NldHRpbmdzIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZXIpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVyKTtcbiAgICB9O1xuICB9LCBbaGlzdG9yeV0pO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBhZ2UsIHtcbiAgICB0aXRsZTogdCgiaGVscCIpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhY2NvcmRpb24gLy8gdHlwZT0icmFkaW8iXG4gICwge1xuICAgIHR5cGU6ICJjaGVja2JveCIsXG4gICAgbmFtZTogImhlbHAiLFxuICAgIGRhdGE6IGFydGljbGVzLm1hcCgoaXRlbSwgaSkgPT4gKHtcbiAgICAgIGNoZWNrZWQ6IGdldEl0ZW1DaGVja2VkKClbaV0sXG4gICAgICBoZWFkZXI6IGl0ZW0udGl0bGUsXG4gICAgICBjb250ZW50OiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQXJ0aWNsZSwge1xuICAgICAgICBjb250ZW50OiBpdGVtLmFydGljbGVcbiAgICAgIH0pXG4gICAgfSkpLFxuICAgIHNjcm9sbFRvcDogZ2V0U2Nyb2xsVG9wKCksXG4gICAgb25TY3JvbGw6IHNjcm9sbFRvcCA9PiB7XG4gICAgICBjb25zdCBpdGVtQ2hlY2tlZCA9IGdldEl0ZW1DaGVja2VkKCk7XG4gICAgICBkaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0SGVscFN0YXRlKHtcbiAgICAgICAgc2Nyb2xsVG9wLFxuICAgICAgICBpdGVtQ2hlY2tlZFxuICAgICAgfSkpO1xuICAgIH0sXG4gICAgb25DaGFuZ2U6IChpdGVtLCBjaGVja2VkKSA9PiB7XG4gICAgICBjb25zdCBzY3JvbGxUb3AgPSBnZXRTY3JvbGxUb3AoKTtcbiAgICAgIGNvbnN0IGl0ZW1DaGVja2VkID0gZ2V0SXRlbUNoZWNrZWQoKTtcbiAgICAgIGl0ZW1DaGVja2VkW2l0ZW1dID0gY2hlY2tlZDtcbiAgICAgIGRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRIZWxwU3RhdGUoe1xuICAgICAgICBzY3JvbGxUb3AsXG4gICAgICAgIGl0ZW1DaGVja2VkXG4gICAgICB9KSk7XG4gICAgfVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGhlbHBfQnV0dG9uLCB7XG4gICAgYnV0dG9uQ29sb3I6IGJ1dHRvbkNvbG9yLFxuICAgIGJ1dHRvbkhvdmVyQ29sb3I6IGJ1dHRvbkhvdmVyQ29sb3IsXG4gICAgb25DbGljazogKCkgPT4ge1xuICAgICAgY29uc3QgbGFuZGluZ1VybCA9IGBodHRwczovL3VuaWRvd25sb2FkZXIuY29tLyR7aTE4bi5sYW5ndWFnZX0vY29udGFjdC11cz9mcm9tXyR7Y29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXS50eXBlID09PSAidWRsLXVzcnNjciIgPyAidXNyc2NyIiA6ICJleHQifT0xYDtcbiAgICAgIHdpbmRvdy5vcGVuKGxhbmRpbmdVcmwsICJfYmxhbmsiKTtcbiAgICB9XG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChmZWVkYmFjaywgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChoZWxwX1RleHQsIG51bGwsIHQoImRyb3BfdXNfYV9saW5lIikpKSk7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBwYWdlc19oZWxwID0gKEhlbHApO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvdWkvYnV0dG9uLmpzeFxuXG5cblxuY29uc3QgU3RCdXR0b24gPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uYnV0dG9uYFxuICBvdXRsaW5lOiBub25lO1xuICBwYWRkaW5nOiA2cHggOHB4O1xuICBkaXNwbGF5OiBpbmxpbmUtZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5iYWNrZ3JvdW5kfTtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3J9O1xuICBib3JkZXItcmFkaXVzOiAycHg7XG4gIGJvcmRlcjogJHtwcm9wcyA9PiB7XG4gIGlmIChwcm9wcy5zdHlsZU5hbWUgPT09ICJnbG93Qm9yZGVyIikge1xuICAgIHJldHVybiBgMXB4IHNvbGlkICR7cHJvcHMuYm9yZGVyIHx8ICJibGFjayJ9YDtcbiAgfVxuXG4gIHJldHVybiAibm9uZSI7XG59fTtcbiAgJiBzdmcge1xuICAgIGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3J9O1xuICAgICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAicnRsIiAmJiAidHJhbnNmb3JtOiBzY2FsZVgoLTEpOyJ9XG4gICAgJiArIHNwYW4ge1xuICAgICAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gIm1hcmdpbi1yaWdodDogNnB4OyIgOiAibWFyZ2luLWxlZnQ6IDZweDsifVxuICAgIH1cbiAgfVxuICAmOm5vdCg6ZGlzYWJsZWQpIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgJjpob3ZlciB7XG4gICAgICAke3Byb3BzID0+IHByb3BzLnN0eWxlTmFtZSA9PT0gImdsb3dCb3JkZXIiICYmIGBcbiAgICAgICAgYm9yZGVyLWNvbG9yOiAke3Byb3BzLmhvdmVyQm9yZGVyfTtcbiAgICAgICAgYm94LXNoYWRvdzogJHtwcm9wcy5ob3ZlckJveFNoYWRvd307XG4gICAgICBgfVxuICAgICAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5ob3ZlckJhY2tncm91bmR9O1xuICAgICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuaG92ZXJDb2xvcn07XG4gICAgICAmIHN2ZyB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuaG92ZXJDb2xvcn07IH1cbiAgICB9XG4gICAgJHtwcm9wcyA9PiBwcm9wcy5zdHlsZU5hbWUgPT09ICJnbG93Qm9yZGVyIiAmJiBgXG4gICAgICAmOmFjdGl2ZSB7XG4gICAgICAgIGJvcmRlci1jb2xvcjogJHtwcm9wcy5hY3RpdmVyQm9yZGVyfTtcbiAgICAgICAgYm94LXNoYWRvdzogJHtwcm9wcy5hY3RpdmVCb3hTaGFkb3d9O1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzLmFjdGl2ZUJhY2tncm91bmR9O1xuICAgICAgICBjb2xvcjogJHtwcm9wcy5hY3RpdmVDb2xvcn07XG4gICAgICAgICYgc3ZnIHsgZmlsbDogJHtwcm9wcy5hY3RpdmVDb2xvcn07IH1cbiAgICAgIH1cbiAgICBgfVxuICB9XG4gICY6ZGlzYWJsZWQgeyBvcGFjaXR5OiAwLjU7IH1cbmA7XG5jb25zdCBidXR0b25fVGV4dCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5zcGFuYFxuICBmb250LXNpemU6IDE2cHg7XG5gO1xuXG5jb25zdCBidXR0b25fbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICBkaXI6IHN0YXRlLmRpcixcbiAgdGhlbWU6IHN0YXRlLnRoZW1lXG59KTtcblxuY29uc3QgYnV0dG9uX0J1dHRvbiA9ICh7XG4gIHR5cGUsXG4gIGRpc2FibGVkLFxuICBvbkNsaWNrLFxuICBpY29uLFxuICB0ZXh0LFxuICBzdHlsZU5hbWVcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIGRpcixcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IoYnV0dG9uX21hcFN0YXRlKTtcbiAgY29uc3QgYnV0dG9uU3R5bGVzID0gdGhlbWUgJiYgKHN0eWxlTmFtZSA9PT0gImdsb3dCb3JkZXIiID8gdGhlbWUuYnV0dG9uX2dsb3dfYm9yZGVyIDogdGhlbWUuYnV0dG9uX3NvbGlkKTtcbiAgY29uc3QgYm9yZGVyID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5ib3JkZXI7XG4gIGNvbnN0IGJhY2tncm91bmQgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmJhY2tncm91bmQ7XG4gIGNvbnN0IGNvbG9yID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5jb2xvcjtcbiAgY29uc3QgaG92ZXJCb3JkZXIgPSBidXR0b25TdHlsZXMgJiYgYnV0dG9uU3R5bGVzLmhvdmVyX2JvcmRlcjtcbiAgY29uc3QgaG92ZXJCYWNrZ3JvdW5kID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5ob3Zlcl9iYWNrZ3JvdW5kO1xuICBjb25zdCBob3ZlckJveFNoYWRvdyA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuaG92ZXJfYm94X3NoYWRvdztcbiAgY29uc3QgaG92ZXJDb2xvciA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuaG92ZXJfY29sb3I7XG4gIGNvbnN0IGFjdGl2ZUJvcmRlciA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuYWN0aXZlX2JvcmRlcjtcbiAgY29uc3QgYWN0aXZlQmFja2dyb3VuZCA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuYWN0aXZlX2JhY2tncm91bmQ7XG4gIGNvbnN0IGFjdGl2ZUJveFNoYWRvdyA9IGJ1dHRvblN0eWxlcyAmJiBidXR0b25TdHlsZXMuYWN0aXZlX2JveF9zaGFkb3c7XG4gIGNvbnN0IGFjdGl2ZUNvbG9yID0gYnV0dG9uU3R5bGVzICYmIGJ1dHRvblN0eWxlcy5hY3RpdmVfY29sb3I7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoU3RCdXR0b24sIHtcbiAgICB0eXBlOiB0eXBlLFxuICAgIGRpc2FibGVkOiBkaXNhYmxlZCxcbiAgICBvbkNsaWNrOiBvbkNsaWNrLFxuICAgIGRpcjogZGlyLFxuICAgIHN0eWxlTmFtZTogc3R5bGVOYW1lLFxuICAgIGJvcmRlcjogYm9yZGVyLFxuICAgIGJhY2tncm91bmQ6IGJhY2tncm91bmQsXG4gICAgY29sb3I6IGNvbG9yLFxuICAgIGhvdmVyQm9yZGVyOiBob3ZlckJvcmRlcixcbiAgICBob3ZlckJhY2tncm91bmQ6IGhvdmVyQmFja2dyb3VuZCxcbiAgICBob3ZlckJveFNoYWRvdzogaG92ZXJCb3hTaGFkb3csXG4gICAgaG92ZXJDb2xvcjogaG92ZXJDb2xvcixcbiAgICBhY3RpdmVCb3JkZXI6IGFjdGl2ZUJvcmRlcixcbiAgICBhY3RpdmVCYWNrZ3JvdW5kOiBhY3RpdmVCYWNrZ3JvdW5kLFxuICAgIGFjdGl2ZUJveFNoYWRvdzogYWN0aXZlQm94U2hhZG93LFxuICAgIGFjdGl2ZUNvbG9yOiBhY3RpdmVDb2xvclxuICB9LCBpY29uICYmIHJlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGljb24pLCB0ZXh0ICYmIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChidXR0b25fVGV4dCwgbnVsbCwgdGV4dCkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgdWlfYnV0dG9uID0gKGJ1dHRvbl9CdXR0b24pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvYXJyb3ctZmF0LWRvd24uanN4XG5cblxuY29uc3QgSWNvbkFycm93RmF0RG93biA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMTRweCIsXG4gIGhlaWdodDogIjE2cHgiLFxuICB2aWV3Qm94OiAiMCAwIDE0IDE2IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xNCw4LjljLTAuMS0wLjEtMC4yLTAuMi0wLjMtMC4ySDEwVjAuM0MxMCwwLjEsOS44LDAsOS43LDBINC4zQzQuMSwwLDQsIDAuMSw0LDAuM3Y4LjNIMC4zQzAuMiw4LjcsMC4xLDguNywwLDguOUMwLDksMCw5LjEsMC4xLDkuMmw2LjYsNi43QzYuOCwgMTYsNi45LDE2LDcsMTZzMC4yLDAsMC4yLTAuMWw2LjctNi43QzE0LDkuMSwxNCw5LDE0LDguOXoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGFycm93X2ZhdF9kb3duID0gKEljb25BcnJvd0ZhdERvd24pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L3BhZ2VzL2NvbmZpcm0uanN4XG5cblxuXG5cblxuXG5cblxuXG5cbmNvbnN0IGNvbmZpcm1fQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBtYXJnaW46IDZweCAxMHB4O1xuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5jb2xvcn07XG4gICYgLmljb25DcHVBY3Rpdml0eSB7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5jb2xvcn07XG4gICAgd2lkdGg6IDU2cHg7XG4gICAgaGVpZ2h0OiA1NnB4O1xuICAgIG1hcmdpbjogMCA2cHg7XG4gIH1cbmA7XG5jb25zdCBDb25sdW1uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgYWxpZ24taXRlbXM6IGZsZXgtZW5kO1xuICBtYXJnaW46IDAgNnB4O1xuYDtcbmNvbnN0IFBhcmFncmFwaCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5wYFxuICBmb250LXNpemU6IDE0cHg7XG4gIHdpZHRoOiAzNTBweDtcbiAgbWFyZ2luLWJvdHRvbTogMTZweDtcbmA7XG5jb25zdCBGb3JtID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmZvcm1gXG4gIG1hcmdpbi1ib3R0b206IDExcHg7XG4gICYgYnV0dG9uIHtcbiAgICBtYXJnaW4tYm90dG9tOiAxMnB4O1xuICAgICY6bm90KDpmaXJzdC1vZi10eXBlKSB7XG4gICAgICAke3Byb3BzID0+IHByb3BzLmRpciA9PT0gInJ0bCIgPyAibWFyZ2luLXJpZ2h0OiA4cHg7IiA6ICJtYXJnaW4tbGVmdDogOHB4OyJ9XG4gICAgfVxuICB9XG5gO1xuXG5jb25zdCBDb25maXJtID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgZGlyLFxuICAgIHRoZW1lLFxuICAgIGRvd25sb2FkLFxuICAgIHdhcm5CZWZvcmVDb252ZXJ0aW5nLFxuICAgIHNldFdhcm5CZWZvcmVDb252ZXJ0aW5nXG4gIH0gPSB1c2VBcHBTdGF0ZShbImRpciIsICJ0aGVtZSIsICJkb3dubG9hZCIsICJ3YXJuQmVmb3JlQ29udmVydGluZyIsICJzZXRXYXJuQmVmb3JlQ29udmVydGluZyJdKTtcbiAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKTtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIGNvbnN0IGdsb2JhbHMgPSB0aGVtZSAmJiB0aGVtZS5nbG9iYWxzO1xuICBjb25zdCBjb2xvciA9IGdsb2JhbHMgJiYgZ2xvYmFscy5jb2xvcjtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChwYWdlLCB7XG4gICAgdGl0bGU6IHQoImNvbmZpcm1fY29udmVyc2lvbl90aXRsZSIpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjb25maXJtX0NvbnRhaW5lciwge1xuICAgIGNvbG9yOiBjb2xvclxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoY3B1X2FjdGl2aXR5LCB7XG4gICAgY2xhc3NOYW1lOiAiaWNvbkNwdUFjdGl2aXR5IlxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KENvbmx1bW4sIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChQYXJhZ3JhcGgsIG51bGwsIHQoImNvbmZpcm1fY29udmVyc2lvbl9tZXNzYWdlIikpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoRm9ybSwge1xuICAgIGRpcjogZGlyLFxuICAgIG9uU3VibWl0OiBldnQgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBkb3dubG9hZCgpO1xuICAgIH1cbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX2J1dHRvbiwge1xuICAgIG9uQ2xpY2s6IGV2dCA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGhpc3RvcnkuZ28oLTEpO1xuICAgIH0sXG4gICAgdGV4dDogdCgiY2FuY2VsIiksXG4gICAgc3R5bGVOYW1lOiAiZ2xvd0JvcmRlciJcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9idXR0b24sIHtcbiAgICB0eXBlOiAic3VibWl0IixcbiAgICBpY29uOiBhcnJvd19mYXRfZG93bixcbiAgICB0ZXh0OiB0KCJjb250aW51ZSIpLFxuICAgIGRpc2FibGVkOiAhZG93bmxvYWQsXG4gICAgc3R5bGVOYW1lOiAiZ2xvd0JvcmRlciJcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9jaGVja2JveCwge1xuICAgIGlkOiAiZG9Ob3RTaG93T25Mb2FkIixcbiAgICBsYWJlbDogdCgiZG9fbm90X3Nob3dfb25fbG9hZCIpLFxuICAgIGNoZWNrZWQ6ICF3YXJuQmVmb3JlQ29udmVydGluZyxcbiAgICBvbkNoYW5nZTogKCkgPT4gc2V0V2FybkJlZm9yZUNvbnZlcnRpbmcoIXdhcm5CZWZvcmVDb252ZXJ0aW5nKVxuICB9KSkpKSk7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBwYWdlc19jb25maXJtID0gKENvbmZpcm0pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvc2hhcmUuanN4XG5cblxuY29uc3QgSWNvblNoYXJlID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxOXB4IixcbiAgaGVpZ2h0OiAiMjAuOHB4IixcbiAgdmlld0JveDogIjAgMCAxOSAyMC44IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xOC40LDMuNmMwLDEuNi0xLjMsMi44LTIuOCwyLjhzLTIuOS0xLjMtMi45LTIuOGMwLTEuNiwxLjMtMi44LDIuOC0yLjhTMTguNCwyLDE4LjQsMy42eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTE1LjUsN0MxMy42LDcsMTIsNS41LDEyLDMuNUMxMiwxLjYsMTMuNSwwLDE1LjUsMFMxOSwxLjYsMTksMy42QzE5LDUuNSwxNy41LDcsMTUuNSw3eiBNMTUuNSwxLjRjLTEuMiwwLTIuMiwxLTIuMiwyLjJzMSwyLjIsMi4yLDIuMnMyLjItMSwyLjItMi4yUzE2LjcsMS40LDE1LjUsMS40eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTE4LjQsMTcuNGMwLDEuNi0xLjMsMi44LTIuOCwyLjhzLTIuOC0xLjMtMi44LTIuOGMwLTEuNiwxLjMtMi44LDIuOC0yLjhTMTguNCwxNS44LDE4LjQsMTcuNHoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xNS41LDIwLjhjLTEuOSwwLTMuNS0xLjUtMy41LTMuNWMwLTEuOSwxLjUtMy41LDMuNS0zLjVzMy41LDEuNSwzLjUsMy41UzE3LjUsMjAuOCwxNS41LDIwLjh6IE0xNS41LDE1LjJjLTEuMiwwLTIuMiwxLTIuMiwyLjJzMSwyLjIsMi4yLDIuMnMyLjItMSwyLjItMi4yUzE2LjcsMTUuMiwxNS41LDE1LjJ6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNNi4zLDEwLjVjMCwxLjYtMS4zLDIuOC0yLjgsMi44Yy0xLjYsMC0yLjgtMS4zLTIuOC0yLjhTMiw3LjcsMy41LDcuN0M1LDcuNyw2LjMsOC45LDYuMywxMC41eiJcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiTTMuNSwxMy45Yy0xLjksMC0zLjUtMS41LTMuNS0zLjVzMS41LTMuNSwzLjUtMy41QzUuNCw2LjksNyw4LjQsNywxMC40UzUuNCwxMy45LDMuNSwxMy45eiBNMy41LDguM2MtMS4yLDAtMi4yLDEtMi4yLDIuMmMwLDEuMiwxLDIuMiwyLjIsMi4yczIuMi0xLDIuMi0yLjJDNS43LDkuMyw0LjYsOC4zLDMuNSw4LjN6IlxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICJNNS41LDEwYy0wLjMsMC0wLjYtMC4yLTAuOC0wLjRjLTAuMi0wLjQsMC0wLjksMC40LTEuMmw4LTQuNmMwLjQtMC4yLDAuOS0wLjEsMS4yLDAuMyBDMTQuNSw0LjUsMTQuNCw1LDE0LDUuM0w2LDkuOUM1LjgsMTAsNS42LDEwLDUuNSwxMHoiXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xMy41LDE3LjJjLTAuMSwwLTAuMywwLTAuNC0wLjFsLTgtNC42Yy0wLjQtMC4yLTAuNi0wLjgtMC4zLTEuMkM1LDEwLjksNS42LDEwLjcsNiwxMWw4LCA0LjZjMC40LDAuMiwwLjYsMC44LDAuMywxLjJDMTQuMSwxNywxMy44LDE3LjIsMTMuNSwxNy4yeiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgc2hhcmUgPSAoSWNvblNoYXJlKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL292ZXItcnUuanN4XG5cblxuY29uc3QgSWNvbk92ZXJSdSA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiNTEuMjVweCIsXG4gIGhlaWdodDogIjEzcHgiLFxuICB2aWV3Qm94OiAiMCAwIDUxLjI1IDEzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDcuMSA0LjI1IFEgNi44IDQuMSA2LjQ1IDQuMSBMIDEuNyA0LjEgMS43IDIuNTUgNy4xIDEuNyA3LjEgMCAxLjg1IDAuODUgUSAxLjM1IDAuOTUgMSAxLjEgMC43IDEuMiAwLjUgMS40NSAwLjI1IDEuNyAwLjEgMiAwIDIuMyAwIDIuNzUgTCAwIDExLjMgUSAwIDExLjY1IDAuMSAxMS45NSAwLjI1IDEyLjI1IDAuNSAxMi41IDAuNyAxMi43NSAxIDEyLjg1IDEuMzUgMTMgMS43IDEzIEwgNi40NSAxMyBRIDYuOCAxMyA3LjEgMTIuODUgNy40NSAxMi43NSA3LjY1IDEyLjUgNy45IDEyLjI1IDguMDUgMTEuOTUgOC4xNSAxMS42NSA4LjE1IDExLjMgTCA4LjE1IDUuOCBRIDguMTUgNS40NSA4LjA1IDUuMTUgNy45IDQuODUgNy42NSA0LjYgNy40NSA0LjM1IDcuMSA0LjI1IE0gNi40NSA1LjggTCA2LjQ1IDExLjMgMS43IDExLjMgMS43IDUuOCA2LjQ1IDUuOCBNIDE4Ljg1IDQuOCBRIDE4LjcgNC40NSAxOC41IDQuMjUgMTguMjUgNCAxNy45NSAzLjkgMTcuNjUgMy43NSAxNy4zIDMuNzUgTCAxMi43IDMuNzUgUSAxMi4zNSAzLjc1IDEyIDMuOSAxMS43IDQgMTEuNSA0LjI1IDExLjI1IDQuNDUgMTEuMSA0LjggMTEgNS4xIDExIDUuNDUgTCAxMSAxMS4zIFEgMTEgMTEuNjUgMTEuMSAxMS45NSAxMS4yNSAxMi4yNSAxMS41IDEyLjUgMTEuNyAxMi43NSAxMiAxMi44NSAxMi4zNSAxMyAxMi43IDEzIEwgMTcuMyAxMyBRIDE3LjY1IDEzIDE3Ljk1IDEyLjg1IDE4LjI1IDEyLjc1IDE4LjUgMTIuNSAxOC43IDEyLjI1IDE4Ljg1IDExLjk1IDE5IDExLjY1IDE5IDExLjMgTCAxOSA1LjQ1IFEgMTkgNS4xIDE4Ljg1IDQuOCBNIDEyLjcgMTEuMyBMIDEyLjcgNS40NSAxNy4zIDUuNDUgMTcuMyAxMS4zIDEyLjcgMTEuMyBNIDI0LjM1IDMuNzUgUSAyMy45NSAzLjc1IDIzLjY1IDMuOSAyMy4zNSA0IDIzLjEgNC4yNSAyMi45IDQuNDUgMjIuNzUgNC44IDIyLjYgNS4xIDIyLjYgNS40NSBMIDIyLjYgMTEuMyAyMS4zIDExLjMgMjEuMyAxMyAyMi42IDEzIFEgMjIuOTUgMTMgMjMuMyAxMi44NSAyMy42IDEyLjc1IDIzLjg1IDEyLjUgMjQuMDUgMTIuMjUgMjQuMiAxMS45NSAyNC4zNSAxMS42NSAyNC4zNSAxMS4zIEwgMjQuMzUgNS40NSAyOC4yNSA1LjQ1IDI4LjI1IDEzIDI5Ljk1IDEzIDI5Ljk1IDMuNzUgMjQuMzUgMy43NSBNIDQwLjYgNS40NSBRIDQwLjYgNS4xIDQwLjUgNC44IDQwLjM1IDQuNDUgNDAuMSA0LjI1IDM5LjkgNCAzOS41NSAzLjkgMzkuMjUgMy43NSAzOC45IDMuNzUgTCAzNC41IDMuNzUgUSAzNC4xNSAzLjc1IDMzLjggMy45IDMzLjUgNCAzMy4zIDQuMjUgMzMuMDUgNC40NSAzMi45IDQuOCAzMi44IDUuMSAzMi44IDUuNDUgTCAzMi44IDExLjMgUSAzMi44IDExLjY1IDMyLjkgMTEuOTUgMzMuMDUgMTIuMjUgMzMuMyAxMi41IDMzLjUgMTIuNzUgMzMuOCAxMi44NSAzNC4xNSAxMyAzNC41IDEzIEwgNDAuNiAxMyA0MC42IDExLjMgMzQuNSAxMS4zIDM0LjUgOS4yNSA0MC42IDkuMjUgNDAuNiA1LjQ1IE0gMzguOSA3LjU1IEwgMzQuNSA3LjU1IDM0LjUgNS40NSAzOC45IDUuNDUgMzguOSA3LjU1IE0gNTEuMTUgNC44IFEgNTEgNC40NSA1MC43NSA0LjI1IDUwLjU1IDQgNTAuMiAzLjkgNDkuOSAzLjc1IDQ5LjU1IDMuNzUgTCA0NS4xNSAzLjc1IFEgNDQuOCAzLjc1IDQ0LjQ1IDMuOSA0NC4xNSA0IDQzLjk1IDQuMjUgNDMuNyA0LjQ1IDQzLjU1IDQuOCA0My40NSA1LjEgNDMuNDUgNS40NSBMIDQzLjQ1IDExLjMgUSA0My40NSAxMS42NSA0My41NSAxMS45NSA0My43IDEyLjI1IDQzLjk1IDEyLjUgNDQuMTUgMTIuNzUgNDQuNDUgMTIuODUgNDQuOCAxMyA0NS4xNSAxMyBMIDUxLjI1IDEzIDUxLjI1IDExLjMgNDUuMTUgMTEuMyA0NS4xNSA5LjI1IDUxLjI1IDkuMjUgNTEuMjUgNS40NSBRIDUxLjI1IDUuMSA1MS4xNSA0LjggTSA0NS4xNSA3LjU1IEwgNDUuMTUgNS40NSA0OS41NSA1LjQ1IDQ5LjU1IDcuNTUgNDUuMTUgNy41NSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBvdmVyX3J1ID0gKEljb25PdmVyUnUpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvb3Zlci1lbi5qc3hcblxuXG5jb25zdCBJY29uT3ZlckVuID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIzOC4yNXB4IixcbiAgaGVpZ2h0OiAiOS4yNXB4IixcbiAgdmlld0JveDogIjAgMCAzOC4yNSA5LjI1IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDYuOTUgMC4xNSBRIDYuNjUgMCA2LjMgMCBMIDEuNyAwIFEgMS4zNSAwIDEgMC4xNSAwLjcgMC4yNSAwLjUgMC41IDAuMjUgMC43IDAuMSAxLjA1IDAgMS4zNSAwIDEuNyBMIDAgNy41NSBRIDAgNy45IDAuMSA4LjIgMC4yNSA4LjUgMC41IDguNzUgMC43IDkgMSA5LjEgMS4zNSA5LjI1IDEuNyA5LjI1IEwgNi4zIDkuMjUgUSA2LjY1IDkuMjUgNi45NSA5LjEgNy4yNSA5IDcuNSA4Ljc1IDcuNyA4LjUgNy44NSA4LjIgOCA3LjkgOCA3LjU1IEwgOCAxLjcgUSA4IDEuMzUgNy44NSAxLjA1IDcuNyAwLjcgNy41IDAuNSA3LjI1IDAuMjUgNi45NSAwLjE1IE0gMS43IDcuNTUgTCAxLjcgMS43IDYuMyAxLjcgNi4zIDcuNTUgMS43IDcuNTUgTSAxNC4zIDcuMiBMIDExLjUgMCA5LjcgMCAxMy40IDkuMjUgMTUuMiA5LjI1IDE4LjkgMCAxNy4xIDAgMTQuMyA3LjIgTSAyOC40IDEuMDUgUSAyOC4yNSAwLjcgMjggMC41IDI3LjggMC4yNSAyNy40NSAwLjE1IDI3LjE1IDAgMjYuOCAwIEwgMjIuNCAwIFEgMjIuMDUgMCAyMS43IDAuMTUgMjEuNCAwLjI1IDIxLjIgMC41IDIwLjk1IDAuNyAyMC44IDEuMDUgMjAuNyAxLjM1IDIwLjcgMS43IEwgMjAuNyA3LjU1IFEgMjAuNyA3LjkgMjAuOCA4LjIgMjAuOTUgOC41IDIxLjIgOC43NSAyMS40IDkgMjEuNyA5LjEgMjIuMDUgOS4yNSAyMi40IDkuMjUgTCAyOC41IDkuMjUgMjguNSA3LjU1IDIyLjQgNy41NSAyMi40IDUuNSAyOC41IDUuNSAyOC41IDEuNyBRIDI4LjUgMS4zNSAyOC40IDEuMDUgTSAyNi44IDEuNyBMIDI2LjggMy44IDIyLjQgMy44IDIyLjQgMS43IDI2LjggMS43IE0gMzguMjUgMS43IFEgMzguMjUgMS4zNSAzOC4xNSAxLjA1IDM4IDAuNyAzNy43NSAwLjUgMzcuNTUgMC4yNSAzNy4yNSAwLjE1IDM2LjkgMCAzNi41NSAwIEwgMzQuNzUgMCBRIDM0LjQgMCAzNC4xIDAuMSAzMy44IDAuMjUgMzMuNTUgMC40NSAzMy4zIDAuNyAzMy4yIDEgMzMuMDU5Mzc1IDEuMjgxMjUgMzMuMDUgMS41NSBMIDMzLjA1IDAgMzEuMzUgMCAzMS4zNSA5LjI1IDMzLjA1IDkuMjUgMzMuMDUgMS43IDM2LjU1IDEuNyAzNi41NSAzLjI1IDM4LjI1IDMuMjUgMzguMjUgMS43IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG92ZXJfZW4gPSAoSWNvbk92ZXJFbik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9udW0tMC5qc3hcblxuXG5jb25zdCBJY29uTnVtMCA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjUuOXB4IixcbiAgaGVpZ2h0OiAiMzNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjUuOSAzMyIsXG4gIHN0eWxlOiBzdHlsZSxcbiAgY2xhc3NOYW1lOiBjbGFzc05hbWVcbn0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICIgTSAyMy4wNSAwLjQgUSAyMi4xNSAwIDIxLjIgMCBMIDQuNyAwIFEgMy43NSAwIDIuOSAwLjQgMiAwLjggMS4zNSAxLjQgMC43IDIuMDUgMC4zNSAyLjkgMCAzLjc1IDAgNC43NSBMIDAgMjguMyBRIDAgMjkuMjUgMC4zNSAzMC4xNSAwLjQ1IDMwLjQgMC42IDMwLjYgMC45IDMxLjE1IDEuMzUgMzEuNiAyIDMyLjI1IDIuOSAzMi42NSAzLjc1IDMzIDQuNyAzMyBMIDIxLjIgMzMgUSAyMi4xNSAzMyAyMy4wNSAzMi42NSAyMy45IDMyLjI1IDI0LjUgMzEuNiAyNC45NSAzMS4xNSAyNS4zIDMwLjYgMjUuNDUgMzAuNCAyNS41NSAzMC4xNSAyNS45IDI5LjI1IDI1LjkgMjguMyBMIDI1LjkgNC43NSBRIDI1LjkgMy43NSAyNS41NSAyLjkgMjUuMTUgMi4wNSAyNC41IDEuNCAyMy45IDAuOCAyMy4wNSAwLjQgTSA0LjcgNC43NSBMIDIxLjIgNC43NSAyMS4yIDI4LjMgNC43IDI4LjMgNC43IDQuNzUgWiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbnVtXzAgPSAoSWNvbk51bTApO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvbnVtLTEuanN4XG5cblxuY29uc3QgSWNvbk51bTEgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjEwLjRweCIsXG4gIGhlaWdodDogIjMzcHgiLFxuICB2aWV3Qm94OiAiMCAwIDEwLjQgMzMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiIE0gMTAuNCAwIEwgMCAwIDAgNC43NSA1LjY1IDQuNzUgNS42NSAzMyAxMC40IDMzIDEwLjQgMCBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBudW1fMSA9IChJY29uTnVtMSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9udW0tMi5qc3hcblxuXG5jb25zdCBJY29uTnVtMiA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjQuOTVweCIsXG4gIGhlaWdodDogIjMzcHgiLFxuICB2aWV3Qm94OiAiMCAwIDI0Ljk1IDMzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDIzIDEuNCBRIDIyLjM1IDAuOCAyMS41IDAuNCAyMC42NSAwIDE5LjY1IDAgTCA0Ljc1IDAgUSAzLjc1IDAgMi45IDAuNCAyLjA1IDAuOCAxLjQgMS40IDAuNzUgMi4wNSAwLjQgMi45IDAgMy43NSAwIDQuNzUgTCAwIDkgNC43NSA5IDQuNzUgNC43NSAxOS42NSA0Ljc1IDE5LjY1IDExLjU1IDMuMyAxOS4yNSBRIDIuNDUgMTkuNjUgMS44NSAyMC4xNSAxLjIgMjAuNjUgMC44IDIxLjI1IDAuNCAyMS44NSAwLjI1IDIyLjYgMCAyMy4zNSAwIDI0LjM1IEwgMCAzMyAyNC45NSAzMyAyNC45NSAyNC4wNSAyMC4yNSAyNC4wNSAyMC4yNSAyOC4zIDQuNzUgMjguMyA0Ljc1IDIzLjUgMjEuMDUgMTUuODUgUSAyMS45NSAxNS40NSAyMi42IDE0Ljk1IDIzLjIgMTQuNDUgMjMuNiAxMy44NSAyNCAxMy4yNSAyNC4yIDEyLjUgMjQuNCAxMS43NSAyNC40IDEwLjc1IEwgMjQuNCA0Ljc1IFEgMjQuNCAzLjc1IDI0IDIuOSAyMy42IDIuMDUgMjMgMS40IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG51bV8yID0gKEljb25OdW0yKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL251bS0zLmpzeFxuXG5cbmNvbnN0IEljb25OdW0zID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyNS44cHgiLFxuICBoZWlnaHQ6ICIzM3B4IixcbiAgdmlld0JveDogIjAgMCAyNS44IDMzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDIwLjc1IDguMyBMIDIwLjc1IDEwLjQ1IFEgMjAuNzUgMTIuMjUgMjAgMTMuMSAxOS4yNSAxMy45NSAxNy41IDE0LjA1IEwgNy45IDE0LjA1IDcuOSAxOC42NSAxNy42NSAxOC42NSBRIDE5LjU1IDE4LjY1IDIwLjM1IDE5LjUgMjEuMiAyMC4zNSAyMS4yIDIyLjIgTCAyMS4yIDI0Ljc1IFEgMjEuMiAyNi42NSAyMC4zNSAyNy41IDE5LjU1IDI4LjQgMTcuNjUgMjguNCBMIDguMTUgMjguNCBRIDYuMjUgMjguNCA1LjQ1IDI3LjUgNC42IDI2LjY1IDQuNiAyNC43NSBMIDQuNiAyMyAwIDIzIDAgMjUgUSAwIDMzIDggMzMgTCAxNy44IDMzIFEgMjUuOCAzMyAyNS44IDI1IEwgMjUuOCAyMy4zNSBRIDI1LjggMjAuMjUgMjQuNyAxOC40IDIzLjYgMTYuNTUgMjEuNSAxNS45IDIzLjQgMTUuMDUgMjQuMzUgMTMuMjUgMjUuMzUgMTEuNDUgMjUuMzUgOC42NSBMIDI1LjM1IDguMDUgUSAyNS4zNSA0IDIzLjQgMiAyMS40IDAgMTcuMzUgMCBMIDguNSAwIFEgMC41IDAgMC41IDguMDUgTCAwLjUgMTAgNS4xIDEwIDUuMSA4LjMgUSA1LjEgNi40IDUuOTUgNS41IDYuNzUgNC42NSA4LjYgNC42NSBMIDE3LjIgNC42NSBRIDE5LjA1IDQuNjUgMTkuOSA1LjUgMjAuNzUgNi40IDIwLjc1IDguMyBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBudW1fMyA9IChJY29uTnVtMyk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9udW0tNC5qc3hcblxuXG5jb25zdCBJY29uTnVtNCA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjYuMjVweCIsXG4gIGhlaWdodDogIjMzcHgiLFxuICB2aWV3Qm94OiAiMCAwIDI2LjI1IDMzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDIxLjggMjEuNjUgTCAyMS44IDAgMTYuMjUgMCAwIDIxLjY1IDAgMjYuMTUgMTcuMSAyNi4xNSAxNy4xIDMzIDIxLjggMzMgMjEuOCAyNi4xNSAyNi4yNSAyNi4xNSAyNi4yNSAyMS42NSAyMS44IDIxLjY1IE0gMTcuMSA1LjcgTCAxNy4xIDIxLjY1IDUuMSAyMS42NSAxNy4xIDUuNyBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBudW1fNCA9IChJY29uTnVtNCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9udW0tNS5qc3hcblxuXG5jb25zdCBJY29uTnVtNSA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjQuOXB4IixcbiAgaGVpZ2h0OiAiMzNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjQuOSAzMyIsXG4gIHN0eWxlOiBzdHlsZSxcbiAgY2xhc3NOYW1lOiBjbGFzc05hbWVcbn0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICIgTSAyNC4wNSA0Ljc1IEwgMjQuMDUgMCAwLjk1IDAgMC45NSAxNi43NSAxNi43IDE2Ljc1IFEgMTguNiAxNi43NSAxOS40NSAxNy42IDIwLjI1IDE4LjQ1IDIwLjI1IDIwLjM1IEwgMjAuMjUgMjQuNzUgUSAyMC4yNSAyNi42NSAxOS40NSAyNy41IDE4LjYgMjguNCAxNi43IDI4LjQgTCA4LjE1IDI4LjQgUSA2LjI1IDI4LjQgNS40NSAyNy41IDQuNiAyNi42NSA0LjYgMjQuNzUgTCA0LjYgMjMgMCAyMyAwIDI1IFEgMCAzMyA4IDMzIEwgMTYuOSAzMyBRIDIwLjkgMzMgMjIuODUgMzEgMjQuOCAyOSAyNC45IDI1IEwgMjQuOSAyMC4xNSBRIDI0LjkgMTYuMDUgMjIuOSAxNC4xIDIwLjkgMTIuMTUgMTYuOSAxMi4xNSBMIDUuNjUgMTIuMTUgNS42NSA0Ljc1IDI0LjA1IDQuNzUgWiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbnVtXzUgPSAoSWNvbk51bTUpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvbnVtLTYuanN4XG5cblxuY29uc3QgSWNvbk51bTYgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjI0LjQ1cHgiLFxuICBoZWlnaHQ6ICIzM3B4IixcbiAgdmlld0JveDogIjAgMCAyNC40NSAzMyIsXG4gIHN0eWxlOiBzdHlsZSxcbiAgY2xhc3NOYW1lOiBjbGFzc05hbWVcbn0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgicGF0aCIsIHtcbiAgZmlsbDogY29sb3IsXG4gIGQ6ICIgTSAyNC40NSA5IEwgMjQuNDUgNC43NSBRIDI0LjQ1IDMuNzUgMjQuMSAyLjkgMjMuNzUgMi4wNSAyMy4xIDEuNCAyMi40NSAwLjggMjEuNiAwLjQgMjAuNzUgMCAxOS43NSAwIEwgNC43IDAgUSAzLjc1IDAgMi45IDAuNCAyIDAuOCAxLjM1IDEuNCAwLjcgMi4wNSAwLjM1IDIuOSAwIDMuNzUgMCA0Ljc1IEwgMCAyOC4zIFEgMCAyOS4yNSAwLjM1IDMwLjE1IDAuNyAzMSAxLjM1IDMxLjYgMiAzMi4yNSAyLjkgMzIuNjUgMy43NSAzMyA0LjcgMzMgTCAxOS43NSAzMyBRIDIwLjc1IDMzIDIxLjYgMzIuNjUgMjIuNDUgMzIuMjUgMjMuMSAzMS42IDIzLjc1IDMxIDI0LjEgMzAuMTUgMjQuNDUgMjkuMjUgMjQuNDUgMjguMyBMIDI0LjQ1IDE4LjkgUSAyNC40NSAxNy45IDI0LjEgMTcuMDUgMjMuNzUgMTYuMiAyMy4xIDE1LjU1IDIyLjQ1IDE0LjkgMjEuNiAxNC41NSAyMC43NSAxNC4xNSAxOS43NSAxNC4xNSBMIDQuNyAxNC4xNSA0LjcgNC43NSAxOS43NSA0Ljc1IDE5Ljc1IDkgMjQuNDUgOSBNIDQuNyAxOC45IEwgMTkuNzUgMTguOSAxOS43NSAyOC4zIDQuNyAyOC4zIDQuNyAxOC45IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG51bV82ID0gKEljb25OdW02KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL251bS03LmpzeFxuXG5cbmNvbnN0IEljb25OdW03ID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyNS40cHgiLFxuICBoZWlnaHQ6ICIzM3B4IixcbiAgdmlld0JveDogIjAgMCAyNS40IDMzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDkuMDUgMzMgTCAyNS40IDEuNDUgMjUuNCAwIDAgMCAwIDQuNzUgMTguNCA0Ljc1IDMuNiAzMyA5LjA1IDMzIFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG51bV83ID0gKEljb25OdW03KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL251bS04LmpzeFxuXG5cbmNvbnN0IEljb25OdW04ID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyNS44cHgiLFxuICBoZWlnaHQ6ICIzM3B4IixcbiAgdmlld0JveDogIjAgMCAyNS44IDMzIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDI1LjM1IDguNjUgTCAyNS4zNSA4LjA1IFEgMjUuMzUgMCAxNy4zNSAwIEwgOC41IDAgUSAwLjQ1IDAgMC40NSA4LjA1IEwgMC40NSA4LjY1IFEgMC40NSAxMS40NSAxLjQ1IDEzLjI1IDIuNDUgMTUuMDUgNC4zIDE1LjkgMi4yIDE2LjU1IDEuMSAxOC40IDAgMjAuMjUgMCAyMy4zNSBMIDAgMjUgUSAwIDMzIDggMzMgTCAxNy44IDMzIFEgMjUuOCAzMyAyNS44IDI1IEwgMjUuOCAyMy4zNSBRIDI1LjggMjAuMjUgMjQuNyAxOC40IDIzLjYgMTYuNTUgMjEuNSAxNS45IDIzLjQgMTUuMDUgMjQuMzUgMTMuMjUgMjUuMzUgMTEuNDUgMjUuMzUgOC42NSBNIDIwLjcgOC4zIEwgMjAuNyAxMC40NSBRIDIwLjcgMTIuMjUgMTkuOTUgMTMuMSAxOS4yNSAxMy45NSAxNy41IDE0LjA1IEwgOC4zIDE0LjA1IFEgNi42IDEzLjk1IDUuODUgMTMuMSA1LjEgMTIuMjUgNS4xIDEwLjQ1IEwgNS4xIDguMyBRIDUuMSA2LjQgNS45IDUuNSA2Ljc1IDQuNjUgOC42IDQuNjUgTCAxNy4yIDQuNjUgUSAxOS4wNSA0LjY1IDE5LjkgNS41IDIwLjcgNi40IDIwLjcgOC4zIE0gMjAuMzUgMTkuNSBRIDIxLjIgMjAuMzUgMjEuMiAyMi4yIEwgMjEuMiAyNC43NSBRIDIxLjIgMjYuNjUgMjAuMzUgMjcuNSAxOS41NSAyOC40IDE3LjY1IDI4LjQgTCA4LjE1IDI4LjQgUSA2LjI1IDI4LjQgNS40NSAyNy41IDQuNiAyNi42NSA0LjYgMjQuNzUgTCA0LjYgMjIuMiBRIDQuNiAyMC4zNSA1LjQ1IDE5LjUgNi4yNSAxOC42NSA4LjE1IDE4LjY1IEwgMTcuNjUgMTguNjUgUSAxOS41NSAxOC42NSAyMC4zNSAxOS41IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG51bV84ID0gKEljb25OdW04KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL251bS05LmpzeFxuXG5cbmNvbnN0IEljb25OdW05ID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIyNC40NXB4IixcbiAgaGVpZ2h0OiAiMzNweCIsXG4gIHZpZXdCb3g6ICIwIDAgMjQuNDUgMzMiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiIE0gMjMuMSAxLjQgUSAyMi40NSAwLjggMjEuNiAwLjQgMjAuNzUgMCAxOS43NSAwIEwgNC43IDAgUSAzLjc1IDAgMi45IDAuNCAyIDAuOCAxLjM1IDEuNCAwLjcgMi4wNSAwLjM1IDIuOSAwIDMuNzUgMCA0Ljc1IEwgMCAxNC4xNSBRIDAgMTUuMTUgMC4zNSAxNiAwLjcgMTYuODUgMS4zNSAxNy41IDIgMTguMSAyLjkgMTguNSAzLjc1IDE4LjkgNC43IDE4LjkgTCAxOS43NSAxOC45IDE5Ljc1IDI4LjMgNC43IDI4LjMgNC43IDI0LjA1IDAgMjQuMDUgMCAyOC4zIFEgMCAyOS4yNSAwLjM1IDMwLjE1IDAuNyAzMSAxLjM1IDMxLjYgMiAzMi4yNSAyLjkgMzIuNjUgMy43NSAzMyA0LjcgMzMgTCAxOS43NSAzMyBRIDIwLjc1IDMzIDIxLjYgMzIuNjUgMjIuNDUgMzIuMjUgMjMuMSAzMS42IDIzLjc1IDMxIDI0LjEgMzAuMTUgMjQuNDUgMjkuMjUgMjQuNDUgMjguMyBMIDI0LjQ1IDQuNzUgUSAyNC40NSAzLjc1IDI0LjEgMi45IDIzLjc1IDIuMDUgMjMuMSAxLjQgTSAxOS43NSAxNC4xNSBMIDQuNyAxNC4xNSA0LjcgNC43NSAxOS43NSA0Ljc1IDE5Ljc1IDE0LjE1IFoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG51bV85ID0gKEljb25OdW05KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9wYWdlcy9hZHZlcnQuanN4XG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuY29uc3QgYWR2ZXJ0X0NvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgbWFyZ2luOiA2cHggMTZweCAyNnB4O1xuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5jb2xvcn07XG4gICYgKyBidXR0b24ge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgbWFyZ2luOiAwIGF1dG8gMjRweDtcbiAgfVxuICAmIGIgeyBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5udW1Db2xvcn0gfVxuYDtcbmNvbnN0IENvdW50ZXIgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uZGl2YFxuICBib3JkZXI6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLmZpZ3VyZUJvcmRlcn07XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDgwcHg7XG4gIGhlaWdodDogODBweDtcbiAgbWFyZ2luOiAxMHB4O1xuICAmOjpiZWZvcmUsXG4gICY6OmFmdGVyIHtcbiAgICBib3JkZXI6IDJweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLmZpZ3VyZUNvbG9yfTtcbiAgICBjb250ZW50OiAiICI7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIHdpZHRoOiA3MHB4O1xuICAgIGhlaWdodDogNzBweDtcbiAgfVxuICAmOjpiZWZvcmUge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuZmlndXJlQ29sb3J9O1xuICAgIHRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTtcbiAgfVxuICAmOjphZnRlciB7IGJvcmRlci1yYWRpdXM6IDJweCB9XG4gICYgc3ZnIHsgZmlsbDogJHtwcm9wcyA9PiBwcm9wcy5maWd1cmVOdW1Db2xvcn0gfVxuYDtcbmNvbnN0IEljb25PdmVyQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGZsZXgtZW5kO1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHotaW5kZXg6IDE7XG5gO1xuY29uc3QgTnVtYmVyQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIHRyYW5zZm9ybTogJHtwcm9wcyA9PiBgc2NhbGUoJHtwcm9wcy5zY2FsZX0pYH07XG4gICYgc3ZnIHsgbWFyZ2luOiAwIDNweCB9XG5gO1xuY29uc3QgYWR2ZXJ0X0Nvbmx1bW4gPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICBhbGlnbi1pdGVtczogZmxleC1lbmQ7XG5gO1xuY29uc3QgYWR2ZXJ0X1BhcmFncmFwaCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5wYFxuICBmb250LXNpemU6IDE0cHg7XG4gIHdpZHRoOiAzMTBweDtcbiAgbWFyZ2luLWJvdHRvbTogMTJweDtcbmA7XG5jb25zdCBCdXR0b25DYW5jZWwgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uYnV0dG9uYFxuICBvdXRsaW5lOiBub25lO1xuICBib3JkZXI6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIG1hcmdpbjogMCBhdXRvIDI0cHg7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGZvbnQtc2l6ZTogMTZweDtcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yfTtcbiAgJjpob3ZlciB7IGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmhvdmVyfTsgfVxuYDtcblxuY29uc3QgSWNvbk92ZXIgPSAoKSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KEljb25PdmVyQ29udGFpbmVyLCBudWxsLCB0KCJsYW5nIikgPT09ICJydSIgPyAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQob3Zlcl9ydSwgbnVsbCkgOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQob3Zlcl9lbiwgbnVsbCkpO1xufTtcblxuY29uc3QgYWR2ZXJ0X051bWJlciA9ICh7XG4gIG51bVxufSkgPT4ge1xuICBjb25zdCBzdHIgPSAobnVtID4gOTk5ID8gOTk5IDogbnVtKS50b1N0cmluZygpO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KE51bWJlckNvbnRhaW5lciwge1xuICAgIHNjYWxlOiBudW0gPiA5OSA/IDAuNiA6IDFcbiAgfSwgWy4uLnN0cl0ucmVkdWNlKChyZXN1bHQsIGl0ZW0pID0+IHtcbiAgICBzd2l0Y2ggKGl0ZW0pIHtcbiAgICAgIGNhc2UgIjEiOlxuICAgICAgICByZXN1bHQucHVzaCggLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG51bV8xLCB7XG4gICAgICAgICAga2V5OiByZXN1bHRcbiAgICAgICAgfSkpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAiMiI6XG4gICAgICAgIHJlc3VsdC5wdXNoKCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobnVtXzIsIHtcbiAgICAgICAgICBrZXk6IHJlc3VsdFxuICAgICAgICB9KSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICIzIjpcbiAgICAgICAgcmVzdWx0LnB1c2goIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChudW1fMywge1xuICAgICAgICAgIGtleTogcmVzdWx0XG4gICAgICAgIH0pKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgIjQiOlxuICAgICAgICByZXN1bHQucHVzaCggLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG51bV80LCB7XG4gICAgICAgICAga2V5OiByZXN1bHRcbiAgICAgICAgfSkpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAiNSI6XG4gICAgICAgIHJlc3VsdC5wdXNoKCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobnVtXzUsIHtcbiAgICAgICAgICBrZXk6IHJlc3VsdFxuICAgICAgICB9KSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICI2IjpcbiAgICAgICAgcmVzdWx0LnB1c2goIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChudW1fNiwge1xuICAgICAgICAgIGtleTogcmVzdWx0XG4gICAgICAgIH0pKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgIjciOlxuICAgICAgICByZXN1bHQucHVzaCggLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG51bV83LCB7XG4gICAgICAgICAga2V5OiByZXN1bHRcbiAgICAgICAgfSkpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAiOCI6XG4gICAgICAgIHJlc3VsdC5wdXNoKCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobnVtXzgsIHtcbiAgICAgICAgICBrZXk6IHJlc3VsdFxuICAgICAgICB9KSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICI5IjpcbiAgICAgICAgcmVzdWx0LnB1c2goIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChudW1fOSwge1xuICAgICAgICAgIGtleTogcmVzdWx0XG4gICAgICAgIH0pKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlc3VsdC5wdXNoKCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobnVtXzAsIHtcbiAgICAgICAgICBrZXk6IHJlc3VsdFxuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSwgW10pKTtcbn07XG5cbmNvbnN0IHBsdXJhbCA9IChuLCBsYW5nLCBhcnIpID0+IHtcbiAgaWYgKGxhbmcgPT09ICJydSIpIHtcbiAgICBjb25zdCBudW0gPSBuICUgMTAwO1xuICAgIGlmIChudW0gPj0gMTEgJiYgbnVtIDw9IDE5KSByZXR1cm4gYXJyWzJdO1xuXG4gICAgc3dpdGNoIChudW0gJSAxMCkge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByZXR1cm4gYXJyWzBdO1xuXG4gICAgICBjYXNlIDI6XG4gICAgICBjYXNlIDM6XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHJldHVybiBhcnJbMV07XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBhcnJbMl07XG4gICAgfVxuICB9IGVsc2UgaWYgKGxhbmcgPT09ICJlbiIpIHtcbiAgICBpZiAobiA9PT0gMSkgcmV0dXJuIGFyclswXTtcbiAgICByZXR1cm4gYXJyWzFdO1xuICB9XG5cbiAgcmV0dXJuICIiO1xufTtcblxuY29uc3QgYWR2ZXJ0X21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lLFxuICBzZW5kRXZlbnQ6IHN0YXRlLnNlbmRFdmVudCxcbiAgZG93bmxvYWRzQ291bnQ6IHN0YXRlLmRvd25sb2Fkc0NvdW50XG59KTtcblxuY29uc3QgQWR2ZXJ0ID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgdGhlbWUsXG4gICAgc2VuZEV2ZW50LFxuICAgIGRvd25sb2Fkc0NvdW50XG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihhZHZlcnRfbWFwU3RhdGUpO1xuICBjb25zdCB7XG4gICAgaTE4bixcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBoaXN0b3J5ID0gdXNlSGlzdG9yeSgpO1xuICBjb25zdCBhZHZlcnQgPSB0aGVtZSAmJiB0aGVtZS5hZHZlcnQ7XG4gIGNvbnN0IGNvbG9yID0gYWR2ZXJ0ICYmIGFkdmVydC5jb2xvciB8fCAiZ3JheSI7XG4gIGNvbnN0IG51bUNvbG9yID0gYWR2ZXJ0ICYmIGFkdmVydC5udW1fY29sb3IgfHwgImdyYXkiO1xuICBjb25zdCBmaWd1cmVDb2xvciA9IGFkdmVydCAmJiBhZHZlcnQuZmlndXJlIHx8ICJibGFjayI7XG4gIGNvbnN0IGZpZ3VyZUJvcmRlciA9IGFkdmVydCAmJiBhZHZlcnQuZmlndXJlX2JvcmRlciB8fCAiYmxhY2siO1xuICBjb25zdCBmaWd1cmVOdW1Db2xvciA9IGFkdmVydCAmJiBhZHZlcnQuZmlndXJlX251bV9jb2xvciB8fCAiYmxhY2siO1xuICBjb25zdCBidXR0b25DYW5jZWwgPSBhZHZlcnQgJiYgYWR2ZXJ0LmJ1dHRvbl9jYW5jZWw7XG4gIGNvbnN0IGJ1dHRvbkNhbmNlbENvbG9yID0gYnV0dG9uQ2FuY2VsICYmIGJ1dHRvbkNhbmNlbC5jb2xvciB8fCAiZ3JheSI7XG4gIGNvbnN0IGJ1dHRvbkNhbmNlbEhvdmVyID0gYnV0dG9uQ2FuY2VsICYmIGJ1dHRvbkNhbmNlbC5ob3ZlciB8fCAiYmxhY2siO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBhZ2UsIHtcbiAgICB0aXRsZTogdCgic29jaWFsX21lZGlhX3NoYXJpbmdfdGl0bGUiKVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoYWR2ZXJ0X0NvbnRhaW5lciwge1xuICAgIGNvbG9yOiBjb2xvcixcbiAgICBudW1Db2xvcjogbnVtQ29sb3JcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KENvdW50ZXIsIHtcbiAgICBmaWd1cmVDb2xvcjogZmlndXJlQ29sb3IsXG4gICAgZmlndXJlQm9yZGVyOiBmaWd1cmVCb3JkZXIsXG4gICAgZmlndXJlTnVtQ29sb3I6IGZpZ3VyZU51bUNvbG9yXG4gIH0sIGRvd25sb2Fkc0NvdW50ID4gOTk5ICYmIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChJY29uT3ZlciwgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhZHZlcnRfTnVtYmVyLCB7XG4gICAgbnVtOiBkb3dubG9hZHNDb3VudFxuICB9KSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhZHZlcnRfQ29ubHVtbiwgbnVsbCwgdCgic29jaWFsX21lZGlhX3NoYXJpbmdfbWVzc2FnZSIpLnJlcGxhY2UoL3slYWxyZWFkeSV9L2csIGRvd25sb2Fkc0NvdW50ID4gMSA/IGAke3QoImFscmVhZHkiKX0gYCA6ICIiKS5yZXBsYWNlKC97JXZpZGVvJX0vZywgcGx1cmFsKGRvd25sb2Fkc0NvdW50LCBpMThuLmxhbmd1YWdlLCB0KCJwbHVyYWxfdmlkZW8iKS5zcGxpdCgiLCIpKSkuc3BsaXQoL1xcbi8pLm1hcChwYXJhZ3JhcGggPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFkdmVydF9QYXJhZ3JhcGgsIHtcbiAgICBrZXk6IHBhcmFncmFwaFxuICB9LCBwYXJhZ3JhcGguc3BsaXQoInslZG93bmxvYWRzQ291bnQlfSIpLm1hcCgocGFydCwgaSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzcGFuIiwge1xuICAgIGtleTogcGFydFxuICB9LCBpID4gMCAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoImIiLCBudWxsLCBkb3dubG9hZHNDb3VudCksIHBhcnQpKSkpKSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9idXR0b24sIHtcbiAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICBzZW5kRXZlbnQoe1xuICAgICAgICBhY3Rpb246ICJzaGFyZV9idG4iXG4gICAgICB9KTtcbiAgICAgIHdpbmRvdy5vcGVuKGBodHRwczovL3VuaWRvd25sb2FkZXIuY29tLyR7aTE4bi5sYW5ndWFnZX0vdWRsLWhlbHBlcj9zaGFyZT0xYCwgIl9ibGFuayIpO1xuICAgIH0sXG4gICAgaWNvbjogc2hhcmUsXG4gICAgdGV4dDogdCgic29jaWFsX21lZGlhX3NoYXJpbmdfYnV0dG9uX29rIilcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChCdXR0b25DYW5jZWwsIHtcbiAgICBjb2xvcjogYnV0dG9uQ2FuY2VsQ29sb3IsXG4gICAgaG92ZXI6IGJ1dHRvbkNhbmNlbEhvdmVyLFxuICAgIG9uQ2xpY2s6ICgpID0+IGhpc3RvcnkuZ28oLTEpXG4gIH0sIHQoInNvY2lhbF9tZWRpYV9zaGFyaW5nX2J1dHRvbl9jYW5jZWwiKSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgcGFnZXNfYWR2ZXJ0ID0gKEFkdmVydCk7XG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXVzZS1jYWNoZS9kaXN0L2luZGV4LmpzXG52YXIgcmVhY3RfdXNlX2NhY2hlX2Rpc3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM3KTtcblxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9xcmNvZGUucmVhY3QvbGliL2luZGV4LmpzXG52YXIgbGliID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCk7XG52YXIgbGliX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGxpYik7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL3VpL3NwaW5uZXIuanN4XG5cblxuXG5jb25zdCBzcGluQW5pbWF0aW9uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImIiIC8qIGtleWZyYW1lcyAqL11gXG4gIGZyb20geyB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsgfVxuICB0byB7IHRyYW5zZm9ybTogcm90YXRlKDM2MGRlZyk7IH1cbmA7XG5jb25zdCBTdmcgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uc3ZnYFxuICBtYXJnaW46IGF1dG87XG4gIG1heC1oZWlnaHQ6IGNhbGMoMTAwJSAtIDZweCk7XG4gIGFuaW1hdGlvbi1uYW1lOiAke3NwaW5BbmltYXRpb259O1xuICBhbmltYXRpb24tZHVyYXRpb246IDAuOXM7XG4gIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGxpbmVhcjtcbiAgYW5pbWF0aW9uLWl0ZXJhdGlvbi1jb3VudDogaW5maW5pdGU7XG5gO1xuXG5jb25zdCBzcGlubmVyX21hcFN0YXRlID0gc3RhdGUgPT4gKHtcbiAgdGhlbWU6IHN0YXRlLnRoZW1lXG59KTtcblxuY29uc3QgU3Bpbm5lciA9ICh7XG4gIGNvbG9yXG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3Ioc3Bpbm5lcl9tYXBTdGF0ZSk7XG4gIGNvbnN0IHRoZW1lU3Bpbm5lciA9IHRoZW1lICYmIHRoZW1lLnNwaW5uZXIgfHwgIiMzNDk4ZGIiO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KFN2Zywge1xuICAgIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICAgIHdpZHRoOiAiMjRweCIsXG4gICAgaGVpZ2h0OiAiMjRweCIsXG4gICAgdmlld0JveDogIjAgMCAyNCAyNCJcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICAgIGZpbGw6IGNvbG9yIHx8IHRoZW1lU3Bpbm5lcixcbiAgICBkOiAiIE0gMTIgMCBRIDcuMDUgMCAzLjUgMy40NSBMIDUuNiA1LjU1IFEgOC4yNjc5Njg3NSAzIDEyIDMgMTUuNyAzIDE4LjMgNS42IDE4LjMzNzg5MDYyNSA1LjYzNzMwNDY4NzUgMTguMzUgNS42NSBMIDIwLjUgMy41IFEgMjAuNDg3Njk1MzEyNSAzLjQ4NzY5NTMxMjUgMjAuNDUgMy40NSAxNi45NSAwIDEyIDAgWiJcbiAgfSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgc3Bpbm5lciA9IChTcGlubmVyKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9jb21wb25lbnRzL2ljb25zL3dhcm5pbmctMi5qc3hcblxuXG5jb25zdCBJY29uV2FybmluZzIgPSAoe1xuICBzdHlsZSxcbiAgY29sb3IsXG4gIGNsYXNzTmFtZVxufSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJzdmciLCB7XG4gIHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLFxuICB3aWR0aDogIjQ1LjlweCIsXG4gIGhlaWdodDogIjQwcHgiLFxuICB2aWV3Qm94OiAiMCAwIDQ1LjkgNDAiLFxuICBzdHlsZTogc3R5bGUsXG4gIGNsYXNzTmFtZTogY2xhc3NOYW1lXG59LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7XG4gIGZpbGw6IGNvbG9yLFxuICBkOiAiIE0gMjQuMiAyOS44NSBRIDIzLjcgMjkuMyAyMi45NSAyOS4zIDIyLjIgMjkuMyAyMS43IDI5Ljg1IDIxLjE1IDMwLjM1IDIxLjE1IDMxLjEgMjEuMTUgMzEuODUgMjEuNyAzMi4zNSAyMi4yIDMyLjkgMjIuOTUgMzIuOSAyMy43IDMyLjkgMjQuMiAzMi4zNSAyNC43NSAzMS44NSAyNC43NSAzMS4xIDI0Ljc1IDMwLjM1IDI0LjIgMjkuODUgTSAyNC4yIDEwLjQgUSAyMy43IDkuODUgMjIuOTUgOS44NSAyMi4yIDkuODUgMjEuNyAxMC40IDIxLjE1IDEwLjkgMjEuMTUgMTEuNjUgTCAyMS4xNSAyNC44NSBRIDIxLjE1IDI1LjU1IDIxLjcgMjYuMSAyMi4yIDI2LjYgMjIuOTUgMjYuNiAyMy43IDI2LjYgMjQuMiAyNi4xIDI0Ljc1IDI1LjU1IDI0Ljc1IDI0Ljg1IEwgMjQuNzUgMTEuNjUgUSAyNC43NSAxMC45IDI0LjIgMTAuNCBNIDQwLjk1IDIzLjQ1IFEgNDEuMSAyMi43NSA0MC43NSAyMi4xIEwgMjkuMjUgMy41NSBRIDI4LjI1IDEuOSAyNi41NSAwLjk1IDI0LjkgMCAyMi45NSAwIDIxIDAgMTkuMyAwLjk1IDE3LjY1IDEuOSAxNi42NSAzLjU1IEwgMS4xIDI4LjY1IFEgMC4wNSAzMC40IDAgMzIuNCAtMC4wNSAzNC40IDAuOTUgMzYuMTUgMS45NSAzNy45NSAzLjY1IDM4Ljk1IDUuNCA0MCA3LjQ1IDQwIEwgMzguNDUgNDAgUSA0MC4zIDQwIDQxLjk1IDM5LjE1IDQzLjU1IDM4LjMgNDQuNiAzNi43IDQ1LjY1IDM1LjIgNDUuODUgMzMuMzUgNDYuMDUgMzEuNSA0NS4zNSAyOS44IDQ1LjEgMjkuMSA0NC40IDI4Ljg1IDQzLjc1IDI4LjU1IDQzLjA1IDI4LjggNDIuMzUgMjkuMSA0Mi4wNSAyOS43NSA0MS43NSAzMC40NSA0Mi4wNSAzMS4xNSA0Mi40IDMyIDQyLjMgMzIuOTUgNDIuMTUgMzMuOSA0MS42NSAzNC43IDQxLjEgMzUuNSA0MC4yNSAzNS45NSAzOS40IDM2LjQgMzguNDUgMzYuNCBMIDcuNDUgMzYuNCBRIDYuNCAzNi40IDUuNSAzNS44NSA0LjYgMzUuMzUgNC4xIDM0LjQgMy41NSAzMy41IDMuNiAzMi40NSAzLjYgMzEuNCA0LjE1IDMwLjUgTCAxOS42NSA1LjQgUSAyMC4yIDQuNTUgMjEuMDUgNC4xIDIxLjk1IDMuNiAyMi45NSAzLjYgMjMuOTUgMy42IDI0LjggNC4xIDI1LjcgNC41NSAyNi4yIDUuNCBMIDM3LjcgMjQgUSAzOC4wNSAyNC42IDM4LjggMjQuOCAzOS41IDI0Ljk1IDQwLjE1IDI0LjU1IDQwLjggMjQuMiA0MC45NSAyMy40NSBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB3YXJuaW5nXzIgPSAoSWNvbldhcm5pbmcyKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9wYWdlcy9xci1jb2RlLmpzeFxuXG5cblxuXG5cblxuXG5cblxuY29uc3QgcXJfY29kZV9Db250YWluZXIgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kO1xuICBtYXJnaW4tdG9wOiAxNnB4O1xuICAmIGRpdiB7IG1hcmdpbi1ib3R0b206IDI0cHg7IH1cbiAgJiBwIHsgd2lkdGg6IDI4MHB4OyB9XG4gICYgY2FudmFzIHtcbiAgICBib3JkZXI6IDE2cHggc29saWQgd2hpdGU7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgbWFyZ2luOiAwIGF1dG8gMjRweDtcbiAgfVxuYDtcbmNvbnN0IHFyX2NvZGVfUGFyYWdyYXBoID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLnBgXG4gIGZvbnQtc2l6ZTogMTRweDtcbiAgbGluZS1oZWlnaHQ6IDIwcHg7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yfTtcbiAgbWFyZ2luOiAwIDE2cHggMjRweDtcbmA7XG5cbmNvbnN0IHFyX2NvZGVfbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICB0aGVtZTogc3RhdGUudGhlbWVcbn0pO1xuXG5jb25zdCBRUmNvZGVDb250ZW50ID0gKHtcbiAgZGF0YVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3Qge1xuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3Rvcihxcl9jb2RlX21hcFN0YXRlKTtcbiAgY29uc3QgdGhlbWVRckNvZGUgPSB0aGVtZSAmJiB0aGVtZS5xcl9jb2RlO1xuICBjb25zdCBlcnJvckNvbG9yID0gdGhlbWVRckNvZGUgJiYgdGhlbWVRckNvZGUuZXJyb3I7XG4gIHJldHVybiBkYXRhLmVyciA9PT0gbnVsbCA/IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChsaWJfZGVmYXVsdC5hLCB7XG4gICAgc2l6ZTogMjU2LFxuICAgIHZhbHVlOiBkYXRhLnVybCxcbiAgICBiZ0NvbG9yOiAid2hpdGUiLFxuICAgIGZnQ29sb3I6ICJibGFjayJcbiAgfSkgOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3RfZGVmYXVsdC5hLkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQod2FybmluZ18yLCB7XG4gICAgY29sb3I6IGVycm9yQ29sb3JcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChxcl9jb2RlX1BhcmFncmFwaCwge1xuICAgIGNvbG9yOiBlcnJvckNvbG9yXG4gIH0sIHQoInFyX2NvZGVfZXJyb3IiKSkpO1xufTtcblxuY29uc3QgUVJjb2RlUGFnZSA9ICh7XG4gIHVybFxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3Qge1xuICAgIHRoZW1lXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3Rvcihxcl9jb2RlX21hcFN0YXRlKTtcbiAgY29uc3QgdGhlbWVRckNvZGUgPSB0aGVtZSAmJiB0aGVtZS5xcl9jb2RlO1xuICBjb25zdCBjb2xvciA9IHRoZW1lUXJDb2RlICYmIHRoZW1lUXJDb2RlLmNvbG9yO1xuICBjb25zdCB7XG4gICAgaXNGZXRjaGluZyxcbiAgICBkYXRhXG4gIH0gPSBPYmplY3QocmVhY3RfdXNlX2NhY2hlX2Rpc3RbInVzZUNhY2hlIl0pKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vdW5pZG93bmxvYWRlci5jb20vYXBpL3N0b3JhZ2UvZmluZE9yQ3JlYXRlIiwge1xuICAgICAgICBtZXRob2Q6ICJQT1NUIixcbiAgICAgICAgbW9kZTogImNvcnMiLFxuICAgICAgICAvLyBuby1jb3JzLCAqY29ycywgc2FtZS1vcmlnaW5cbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJcbiAgICAgICAgfSxcbiAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciLFxuICAgICAgICByZWZlcnJlclBvbGljeTogIm5vLXJlZmVycmVyIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHdlYnBhZ2VfdXJsOiB1cmxcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGNvbnN0IGJ1bmRsZSA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdXJsOiBgaHR0cHM6Ly91bmlkb3dubG9hZGVyLmNvbS9yLyR7YnVuZGxlLmluY3JlbWVudH1gLFxuICAgICAgICAgIGVycjogbnVsbFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB1cmw6IG51bGwsXG4gICAgICAgIGVycjogcmVzLnN0YXR1c1RleHRcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXJsOiBudWxsLFxuICAgICAgICBlcnI6IGVcbiAgICAgIH07XG4gICAgfVxuICB9LCB1cmwpO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBhZ2UsIHtcbiAgICB0aXRsZTogdCgicXJfY29kZV90aXRsZSIpXG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChxcl9jb2RlX0NvbnRhaW5lciwgbnVsbCwgaXNGZXRjaGluZyA/IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChzcGlubmVyLCBudWxsKSA6IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChRUmNvZGVDb250ZW50LCB7XG4gICAgZGF0YTogZGF0YVxuICB9KSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChxcl9jb2RlX1BhcmFncmFwaCwge1xuICAgIGNvbG9yOiBjb2xvclxuICB9LCB0KCJxcl9jb2RlX2Rlc2NyaXB0aW9uIikpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHBhZ2VzX3FyX2NvZGUgPSAoUVJjb2RlUGFnZSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9kcm9wZG93bi5qc3hcblxuXG5cblxuY29uc3QgZHJvcGRvd25fQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgcGFkZGluZzogJHtwcm9wcyA9PiBwcm9wcy5pc0JvdHRvbVRvVG9wID8gIjAgMCA0cHggMCIgOiAiNHB4IDAgMCAwIn07XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdG9wOiAke3Byb3BzID0+IHByb3BzLnBvc1l9cHg7XG4gIGxlZnQ6ICR7cHJvcHMgPT4gcHJvcHMucG9zWH1weDtcbiAgdHJhbnNmb3JtOiAke3Byb3BzID0+IHByb3BzLmlzQm90dG9tVG9Ub3AgPyAidHJhbnNsYXRlWSgtMTAwJSkiIDogIm5vbmUifTtcbiAgb3BhY2l0eTogJHtwcm9wcyA9PiBwcm9wcy5pc0Ryb3Bkb3duU2hvdyA/IDEgOiAwfTtcbiAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjI1cyBlYXNlLWluLW91dDtcbmA7XG5jb25zdCBNYXNrID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgb3ZlcmZsb3c6ICR7cHJvcHMgPT4gcHJvcHMuaXNBbmltYXRlZCA/ICJoaWRkZW4iIDogInZpc2libGUifTtcbmA7XG5jb25zdCBkcm9wZG93bl9Db250ZW50ID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgdHJhbnNmb3JtOiAke3Byb3BzID0+IHByb3BzLmlzRHJvcGRvd25TaG93ID8gIm5vbmUiIDogcHJvcHMudHJhbnNmb3JtfTtcbiAgdHJhbnNpdGlvbjogJHtwcm9wcyA9PiBwcm9wcy5pc0FuaW1hdGVkID8gInRyYW5zZm9ybSAwLjI1cyBlYXNlLWluLW91dCIgOiAibm9uZSJ9O1xuYDtcblxuY29uc3QgZHJvcGRvd25fbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICBkaXI6IHN0YXRlLmRpcixcbiAgbW9kdWxlOiBzdGF0ZS5tb2R1bGVcbn0pO1xuXG5jb25zdCBPdmVybGF5ID0gKHtcbiAgY29udGVudCxcbiAgZWxlbWVudCxcbiAgdHJpZ2dlcixcbiAgaXNFbGVtZW50Q2xpY2tlZCxcbiAgaXNFbGVtZW50TW91c2VPdmVyXG59KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkaXIsXG4gICAgbW9kdWxlXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3Rvcihkcm9wZG93bl9tYXBTdGF0ZSk7XG4gIGNvbnN0IHtcbiAgICBnZXRTY3JvbGxDb250YWluZXJcbiAgfSA9IG1vZHVsZTtcbiAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidW5pZG93bmxvYWRlci1kcm9wZG93biIpO1xuICBjb25zdCBbZHJvcGRvd25Ob2RlLCBzZXREcm9wZG93bk5vZGVdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKSgpO1xuICBjb25zdCBbaXNEcm9wZG93biwgc2V0SXNEcm9wZG93bl0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGZhbHNlKTtcbiAgY29uc3QgW2lzRHJvcGRvd25TaG93LCBzZXRJc0Ryb3Bkb3duU2hvd10gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGZhbHNlKTtcbiAgY29uc3QgW2lzRHJvcGRvd25Nb3VzZU92ZXIsIHNldElzRHJvcGRvd25Nb3VzZU92ZXJdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IFtpc0FuaW1hdGVkLCBzZXRJc0FuaW1hdGVkXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBbaXNNb3VzZU92ZXIsIHNldElzTW91c2VPdmVyXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBbaXNUaW1lb3V0LCBzZXRJc1RpbWVvdXRdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IFtwb3NYLCBzZXRQb3NYXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG4gIGNvbnN0IFtwb3NZLCBzZXRQb3NZXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG4gIGNvbnN0IFtpc0JvdHRvbVRvVG9wLCBzZXRJc0JvdHRvbVRvVG9wXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBjb25zdCBbaXNEcm9wZG93bkNsaWNrZWRPdXRzaWRlLCBzZXRJc0Ryb3Bkb3duQ2xpY2tlZE91dHNpZGVdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBpZiAoaXNEcm9wZG93bkNsaWNrZWRPdXRzaWRlKSBzZXRJc0Ryb3Bkb3duQ2xpY2tlZE91dHNpZGUoZmFsc2UpO1xuICB9LCBbaXNEcm9wZG93bkNsaWNrZWRPdXRzaWRlXSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBjb25zdCBoYW5kbGVDbGljayA9IGV2ZW50ID0+IHtcbiAgICAgIGlmICghZHJvcGRvd25Ob2RlLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgc2V0SXNEcm9wZG93bkNsaWNrZWRPdXRzaWRlKHRydWUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoZHJvcGRvd25Ob2RlICYmIGlzRHJvcGRvd24gJiYgdHJpZ2dlciA9PT0gImNsaWNrIikge1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljaywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlUG9wc3RhdGUgPSAoKSA9PiB7XG4gICAgICBzZXRJc0Ryb3Bkb3duKGZhbHNlKTtcbiAgICB9O1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInBvcHN0YXRlIiwgaGFuZGxlUG9wc3RhdGUpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrLCB0cnVlKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJwb3BzdGF0ZSIsIGhhbmRsZVBvcHN0YXRlKTtcbiAgICB9O1xuICB9LCBbZHJvcGRvd25Ob2RlLCBpc0Ryb3Bkb3duLCB0cmlnZ2VyXSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBjb25zdCBzZXRQb3MgPSAoKSA9PiB7XG4gICAgICBjb25zdCBlbGVtZW50UmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgIGlmIChlbGVtZW50UmVjdCkge1xuICAgICAgICBjb25zdCBub2RlUmVjdCA9IGRyb3Bkb3duTm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICBpZiAobm9kZVJlY3QpIHtcbiAgICAgICAgICBjb25zdCBtYXJnaW4gPSA0O1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGlubmVySGVpZ2h0XG4gICAgICAgICAgfSA9IHdpbmRvdztcbiAgICAgICAgICBjb25zdCBzY3JvbGxUb3AgPSBnZXRTY3JvbGxDb250YWluZXIgPyBnZXRTY3JvbGxDb250YWluZXIoKS5zY3JvbGxUb3AgOiB3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgICAgICAgY29uc3QgZWxlbWVudFRvcCA9IGVsZW1lbnRSZWN0LnRvcDtcbiAgICAgICAgICBjb25zdCBlbGVtZW50UmlnaHQgPSBlbGVtZW50UmVjdC5yaWdodDtcbiAgICAgICAgICBjb25zdCBlbGVtZW50Qm90dG9tID0gZWxlbWVudFJlY3QuYm90dG9tO1xuICAgICAgICAgIGNvbnN0IGVsZW1lbnRMZWZ0ID0gZWxlbWVudFJlY3QubGVmdDtcbiAgICAgICAgICBjb25zdCBub2RlV2lkdGggPSBub2RlUmVjdC53aWR0aDtcbiAgICAgICAgICBjb25zdCBub2RlSGVpZ2h0ID0gbm9kZVJlY3QuaGVpZ2h0O1xuXG4gICAgICAgICAgaWYgKGVsZW1lbnRCb3R0b20gKyBub2RlSGVpZ2h0ID4gaW5uZXJIZWlnaHQgJiYgZWxlbWVudFRvcCAtIG5vZGVIZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICBzZXRQb3NZKHNjcm9sbFRvcCArIGVsZW1lbnRUb3ApO1xuICAgICAgICAgICAgc2V0SXNCb3R0b21Ub1RvcCh0cnVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0UG9zWShzY3JvbGxUb3AgKyBlbGVtZW50Qm90dG9tKTtcbiAgICAgICAgICAgIHNldElzQm90dG9tVG9Ub3AoZmFsc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGNsaWVudFdpZHRoXG4gICAgICAgICAgfSA9IGRvY3VtZW50LmJvZHk7XG5cbiAgICAgICAgICBpZiAoZGlyID09PSAicnRsIikge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnRMZWZ0ICsgbm9kZVdpZHRoICsgbWFyZ2luID4gY2xpZW50V2lkdGgpIHtcbiAgICAgICAgICAgICAgc2V0UG9zWChjbGllbnRXaWR0aCAtIG5vZGVXaWR0aCAtIG1hcmdpbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzZXRQb3NYKGVsZW1lbnRMZWZ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnRSaWdodCAtIG5vZGVXaWR0aCAtIG1hcmdpbiA8IDApIHtcbiAgICAgICAgICAgIHNldFBvc1gobWFyZ2luKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2V0UG9zWChlbGVtZW50UmlnaHQgLSBub2RlV2lkdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcihzZXRQb3MpO1xuXG4gICAgaWYgKGlzRHJvcGRvd24gJiYgZHJvcGRvd25Ob2RlICYmIGVsZW1lbnQpIHtcbiAgICAgIHNldFBvcygpO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgc2V0UG9zKTtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCBzZXRQb3MpO1xuICAgICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShkcm9wZG93bk5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoaXNEcm9wZG93biAmJiBkcm9wZG93bk5vZGUgJiYgZWxlbWVudCkge1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBzZXRQb3MpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgc2V0UG9zKTtcbiAgICAgICAgcmVzaXplT2JzZXJ2ZXIudW5vYnNlcnZlKGRyb3Bkb3duTm9kZSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW2Ryb3Bkb3duTm9kZSwgaXNEcm9wZG93biwgZWxlbWVudCwgZGlyLCBnZXRTY3JvbGxDb250YWluZXJdKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGlmIChkcm9wZG93biAmJiBlbGVtZW50ICYmICFpc0Ryb3Bkb3duICYmICFpc0FuaW1hdGVkICYmICFpc0Ryb3Bkb3duU2hvdyAmJiAodHJpZ2dlciA9PT0gImNsaWNrIiAmJiBpc0VsZW1lbnRDbGlja2VkIHx8IHRyaWdnZXIgPT09ICJob3ZlciIgJiYgaXNFbGVtZW50TW91c2VPdmVyKSkge1xuICAgICAgc2V0SXNEcm9wZG93bih0cnVlKTtcbiAgICB9XG4gIH0sIFtkcm9wZG93biwgZWxlbWVudCwgaXNBbmltYXRlZCwgaXNEcm9wZG93blNob3csIHRyaWdnZXIsIGlzRWxlbWVudENsaWNrZWQsIGlzRWxlbWVudE1vdXNlT3ZlciwgaXNEcm9wZG93bl0pO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgaWYgKGlzRHJvcGRvd24pIHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJc0FuaW1hdGVkKHRydWUpO1xuICAgICAgICBzZXRJc0Ryb3Bkb3duU2hvdyh0cnVlKTtcbiAgICAgIH0sIDEpO1xuICAgIH1cbiAgfSwgW2lzRHJvcGRvd25dKTtcblxuICBpZiAoaXNNb3VzZU92ZXIpIHtcbiAgICBpZiAoIWlzRHJvcGRvd25Nb3VzZU92ZXIpIHtcbiAgICAgIHNldElzRHJvcGRvd25Nb3VzZU92ZXIodHJ1ZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKCFpc1RpbWVvdXQpIHtcbiAgICBpZiAoaXNEcm9wZG93bk1vdXNlT3Zlcikge1xuICAgICAgc2V0SXNEcm9wZG93bk1vdXNlT3ZlcihmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGlzRHJvcGRvd25TaG93ICYmICFpc0FuaW1hdGVkICYmICFpc0Ryb3Bkb3duTW91c2VPdmVyICYmICh0cmlnZ2VyID09PSAiY2xpY2siICYmIGlzRHJvcGRvd25DbGlja2VkT3V0c2lkZSB8fCB0cmlnZ2VyID09PSAiaG92ZXIiICYmICFpc0VsZW1lbnRNb3VzZU92ZXIpKSB7XG4gICAgc2V0SXNBbmltYXRlZCh0cnVlKTtcbiAgICBzZXRJc0Ryb3Bkb3duU2hvdyhmYWxzZSk7XG4gIH1cblxuICBpZiAoZHJvcGRvd24gJiYgaXNEcm9wZG93bikge1xuICAgIHJldHVybiBPYmplY3QocmVhY3RfZG9tWyJjcmVhdGVQb3J0YWwiXSkoIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChkcm9wZG93bl9Db250YWluZXIsIHtcbiAgICAgIHJlZjogbm9kZSA9PiB7XG4gICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgc2V0RHJvcGRvd25Ob2RlKG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcG9zWDogcG9zWCxcbiAgICAgIHBvc1k6IHBvc1ksXG4gICAgICBpc0JvdHRvbVRvVG9wOiBpc0JvdHRvbVRvVG9wLFxuICAgICAgaXNEcm9wZG93blNob3c6IGlzRHJvcGRvd25TaG93LFxuICAgICAgb25Nb3VzZUVudGVyOiAoKSA9PiB7XG4gICAgICAgIHNldElzTW91c2VPdmVyKHRydWUpO1xuICAgICAgfSxcbiAgICAgIG9uTW91c2VMZWF2ZTogKCkgPT4ge1xuICAgICAgICBzZXRJc1RpbWVvdXQodHJ1ZSk7XG4gICAgICAgIHNldElzTW91c2VPdmVyKGZhbHNlKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc2V0SXNUaW1lb3V0KGZhbHNlKTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgIH1cbiAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoTWFzaywge1xuICAgICAgaXNBbmltYXRlZDogaXNBbmltYXRlZFxuICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChkcm9wZG93bl9Db250ZW50LCB7XG4gICAgICBpc0FuaW1hdGVkOiBpc0FuaW1hdGVkLFxuICAgICAgaXNEcm9wZG93blNob3c6IGlzRHJvcGRvd25TaG93LFxuICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke2lzQm90dG9tVG9Ub3AgPyAxMDAgOiAtMTAwfSUpYCxcbiAgICAgIG9uVHJhbnNpdGlvbkVuZDogKCkgPT4ge1xuICAgICAgICBzZXRJc0FuaW1hdGVkKGZhbHNlKTtcbiAgICAgICAgaWYgKCFpc0Ryb3Bkb3duU2hvdykgc2V0SXNEcm9wZG93bihmYWxzZSk7XG4gICAgICB9XG4gICAgfSwgY29udGVudCkpKSwgZHJvcGRvd24pO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5jb25zdCBEcm9wZG93biA9ICh7XG4gIGNoaWxkcmVuLFxuICBvdmVybGF5LFxuICB0cmlnZ2VyXG59KSA9PiB7XG4gIGNvbnN0IFtlbGVtZW50LCBzZXRFbGVtZW50XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoKTtcbiAgY29uc3QgW2lzRWxlbWVudENsaWNrZWQsIHNldElzRWxlbWVudENsaWNrZWRdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBpZiAoaXNFbGVtZW50Q2xpY2tlZCkgc2V0SXNFbGVtZW50Q2xpY2tlZChmYWxzZSk7XG4gIH0sIFtpc0VsZW1lbnRDbGlja2VkXSk7XG4gIGNvbnN0IFtpc01vdXNlT3Zlciwgc2V0SXNNb3VzZU92ZXJdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IFtpc0VsZW1lbnRNb3VzZU92ZXIsIHNldElzRWxlbWVudE1vdXNlT3Zlcl0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGZhbHNlKTtcbiAgY29uc3QgW2lzVGltZW91dCwgc2V0SXNUaW1lb3V0XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoZmFsc2UpO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgaWYgKGlzTW91c2VPdmVyKSB7XG4gICAgICBzZXRJc0VsZW1lbnRNb3VzZU92ZXIodHJ1ZSk7XG4gICAgfSBlbHNlIGlmICghaXNUaW1lb3V0KSB7XG4gICAgICBzZXRJc0VsZW1lbnRNb3VzZU92ZXIoZmFsc2UpO1xuICAgIH1cbiAgfSwgW2lzTW91c2VPdmVyLCBpc1RpbWVvdXRdKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZUNsaWNrID0gKCkgPT4ge1xuICAgICAgaWYgKHRyaWdnZXIgPT09ICJjbGljayIpIHNldElzRWxlbWVudENsaWNrZWQodHJ1ZSk7XG5cbiAgICAgIGlmICh0cmlnZ2VyID09PSAiaG92ZXIiKSB7XG4gICAgICAgIGNvbnN0IG9uQ2xpY2sgPSBjaGlsZHJlbiAmJiBjaGlsZHJlbi5wcm9wcyAmJiBjaGlsZHJlbi5wcm9wcy5vbkNsaWNrO1xuICAgICAgICBpZiAob25DbGljaykgb25DbGljaygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoZWxlbWVudCkge1xuICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrKTtcbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrKTtcbiAgICAgIH1cbiAgICB9O1xuICB9LCBbY2hpbGRyZW4sIHRyaWdnZXIsIGVsZW1lbnRdKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIE9iamVjdChyZWFjdFsiY2xvbmVFbGVtZW50Il0pKGNoaWxkcmVuLCB7IC4uLih0cmlnZ2VyID09PSAiaG92ZXIiICYmIHtcbiAgICAgIG9uTW91c2VFbnRlcjogKCkgPT4ge1xuICAgICAgICBzZXRJc01vdXNlT3Zlcih0cnVlKTtcbiAgICAgIH0sXG4gICAgICBvbk1vdXNlTGVhdmU6ICgpID0+IHtcbiAgICAgICAgc2V0SXNUaW1lb3V0KHRydWUpO1xuICAgICAgICBzZXRJc01vdXNlT3ZlcihmYWxzZSk7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHNldElzVGltZW91dChmYWxzZSk7XG4gICAgICAgIH0sIDIwMCk7XG4gICAgICB9XG4gICAgfSksXG4gICAgb25DbGljazogbnVsbCxcbiAgICByZWY6IG5vZGUgPT4ge1xuICAgICAgaWYgKG5vZGUpIHNldEVsZW1lbnQobm9kZSk7XG4gICAgfVxuICB9KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KE92ZXJsYXksIHtcbiAgICBjb250ZW50OiBvdmVybGF5LFxuICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgdHJpZ2dlcjogdHJpZ2dlciB8fCAiaG92ZXIiLFxuICAgIGlzRWxlbWVudENsaWNrZWQ6IGlzRWxlbWVudENsaWNrZWQsXG4gICAgaXNFbGVtZW50TW91c2VPdmVyOiBpc0VsZW1lbnRNb3VzZU92ZXJcbiAgfSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgdWlfZHJvcGRvd24gPSAoRHJvcGRvd24pO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvZG93bmxvYWQuanN4XG5cblxuY29uc3QgSWNvbkRvd25sb2FkID0gKHtcbiAgc3R5bGUsXG4gIGNvbG9yLFxuICBjbGFzc05hbWVcbn0pID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCgic3ZnIiwge1xuICB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixcbiAgd2lkdGg6ICIxNi41cHgiLFxuICBoZWlnaHQ6ICIyMHB4IixcbiAgdmlld0JveDogIjAgMCAxNi41IDIwIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk0xNi41LDcuMWgtNC43VjBoLTd2Ny4xSDBsOC4yLDguMkwxNi41LDcuMXogTTAsMTcuN1YyMGgxNi41di0yLjNIMHoiXG59KSk7XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGljb25zX2Rvd25sb2FkID0gKEljb25Eb3dubG9hZCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvYXBwLmpzeFxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuY29uc3QgYXBwX0J1dHRvbiA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5idXR0b25gXG4gIG91dGxpbmU6IG5vbmU7XG4gIGZsZXg6IDE7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBjdXJzb3I6ICR7cHJvcHMgPT4gcHJvcHMuZW5hYmxlZCA9PT0gZmFsc2UgPyAiZGVmYXVsdCIgOiAicG9pbnRlciJ9O1xuICAke3Byb3BzID0+IHtcbiAgaWYgKHByb3BzLmRvd25sb2FkKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYFxuICAgICAgICBwYWRkaW5nOiAwIDlweDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgJHtwcm9wcy5ib3JkZXJ9O1xuICAgICAgYDtcblxuICAgIGlmIChwcm9wcy5kaXIgPT09ICJsdHIiKSB7XG4gICAgICByZXR1cm4gYFxuICAgICAgICAgICR7cmVzdWx0fVxuICAgICAgICAgIGJvcmRlci1yaWdodDogbm9uZTtcbiAgICAgICAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiAycHg7XG4gICAgICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogMnB4O1xuICAgICAgICBgO1xuICAgIH1cblxuICAgIGlmIChwcm9wcy5kaXIgPT09ICJydGwiKSB7XG4gICAgICByZXR1cm4gYFxuICAgICAgICAgICR7cmVzdWx0fVxuICAgICAgICAgIGJvcmRlci1sZWZ0OiBub25lO1xuICAgICAgICAgIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAycHg7XG4gICAgICAgICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDJweDtcbiAgICAgICAgYDtcbiAgICB9XG4gIH1cblxuICBpZiAocHJvcHMuZHJvcGRvd24pIHtcbiAgICBjb25zdCByZXN1bHQgPSBgXG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7cHJvcHMuYm9yZGVyfTtcbiAgICAgIGA7XG5cbiAgICBpZiAocHJvcHMuZGlyID09PSAibHRyIikge1xuICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAke3Jlc3VsdH1cbiAgICAgICAgICBib3JkZXItbGVmdDogbm9uZTtcbiAgICAgICAgICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMnB4O1xuICAgICAgICAgIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiAycHg7XG4gICAgICAgIGA7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmRpciA9PT0gInJ0bCIpIHtcbiAgICAgIHJldHVybiBgXG4gICAgICAgICAgJHtyZXN1bHR9XG4gICAgICAgICAgYm9yZGVyLXJpZ2h0OiBub25lO1xuICAgICAgICAgIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDJweDtcbiAgICAgICAgICBib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOiAycHg7XG4gICAgICAgIGA7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGBcbiAgICAgIHBhZGRpbmc6IDAgNnB4O1xuICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgYm9yZGVyLXJhZGl1czogMnB4O1xuICAgIGA7XG59fVxuICAke3Byb3BzID0+IHtcbiAgaWYgKHByb3BzLmVuYWJsZWQgPT09IGZhbHNlKSByZXR1cm4gImJhY2tncm91bmQtY29sb3I6IHJnYmEoMTI4LDEyOCwxMjgsMC42NSk7IjtcblxuICBpZiAocHJvcHMuZHJvcGRvd24pIHtcbiAgICByZXR1cm4gYFxuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmNmU1O1xuICAgICAgICAmOmhvdmVyIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmM2RkO1xuICAgICAgICAgICYgc3BhbiB7XG4gICAgICAgICAgICBjb2xvcjogIzI4MjgyODtcbiAgICAgICAgICAgICY6OmFmdGVyIHtcbiAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0LWNvbG9yOiAjMjgyODI4O1xuICAgICAgICAgICAgICBib3JkZXItYm90dG9tLWNvbG9yOiAjMjgyODI4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgYDtcbiAgfVxuXG4gIGlmIChwcm9wcy5kb3dubG9hZCkge1xuICAgIHJldHVybiBgXG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmEyMDA7XG4gICAgICAgICY6aG92ZXIgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmY5ODJhIH1cbiAgICAgICAgJjphY3RpdmUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmY4NDAwfVxuICAgICAgYDtcbiAgfVxuXG4gIHJldHVybiBgXG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZhMjAwO1xuICAgICAgJjphY3RpdmUgeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmY4NDAwIH1cbiAgICBgO1xufX1cbiAgJiBzdmcge1xuICAgIG1heC1oZWlnaHQ6IGNhbGMoMTAwJSAtIDEwcHgpO1xuICAgIG1hcmdpbjogMCA0cHg7XG4gICAgZmlsbDogd2hpdGU7XG4gIH1cbiAgJiBzcGFuIHtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5kcm9wZG93biA/ICIjNWU1ZTVlIiA6ICJ3aGl0ZSJ9O1xuICAgICR7cHJvcHMgPT4gcHJvcHMuZHJvcGRvd24gJiYgYFxuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIHBhZGRpbmc6IDAgNnB4O1xuICAgICAgJjo6YmVmb3JlIHtcbiAgICAgICAgY29udGVudDogIiAiO1xuICAgICAgICB3aWR0aDogNHB4O1xuICAgICAgfVxuICAgICAgJjo6YWZ0ZXIge1xuICAgICAgICBjb250ZW50OiAiICI7XG4gICAgICAgIHdpZHRoOiA5cHg7XG4gICAgICAgIGhlaWdodDogOXB4O1xuICAgICAgICBtYXJnaW46IDAgNHB4O1xuICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSg0NWRlZykgc2NhbGUoMC43KTtcbiAgICAgICAgYm9yZGVyLXJpZ2h0OiAycHggc29saWQgIzVlNWU1ZTtcbiAgICAgICAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICM1ZTVlNWU7XG4gICAgICB9XG4gICAgYH1cbiAgfVxuYDtcbmNvbnN0IGFwcF9UZXh0ID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLnNwYW5gXG4gIHVzZXItc2VsZWN0OiBub25lO1xuICBtYXJnaW46IDAgNHB4O1xuYDtcblxuY29uc3QgQXBwQm9keSA9ICgpID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfU3dpdGNoLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX1JvdXRlLCB7XG4gIGV4YWN0OiB0cnVlLFxuICBwYXRoOiAiLyIsXG4gIHJlbmRlcjogKCkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KG1haW4sIG51bGwpXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9Sb3V0ZSwge1xuICBwYXRoOiAiL21vcmUiLFxuICByZW5kZXI6ICgpID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChtYWluLCB7XG4gICAgbG9hZE1vcmU6ICJ0cnVlIlxuICB9KVxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfUm91dGUsIHtcbiAgcGF0aDogIi9zZXR0aW5ncyIsXG4gIHJlbmRlcjogKCkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHNldHRpbmdzX2Z1bGwsIG51bGwpXG59KSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHJlYWN0X3JvdXRlcl9Sb3V0ZSwge1xuICBwYXRoOiAiL2hlbHAiLFxuICByZW5kZXI6ICgpID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChwYWdlc19oZWxwLCBudWxsKVxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfUm91dGUsIHtcbiAgcGF0aDogIi9jb25maXJtIixcbiAgcmVuZGVyOiAoKSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocGFnZXNfY29uZmlybSwgbnVsbClcbn0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3Rfcm91dGVyX1JvdXRlLCB7XG4gIHBhdGg6ICIvYWR2ZXJ0IixcbiAgcmVuZGVyOiAoKSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocGFnZXNfYWR2ZXJ0LCBudWxsKVxufSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfUm91dGUsIHtcbiAgcGF0aDogIi9xcmNvZGUvOmRhdGEiLFxuICByZW5kZXI6ICh7XG4gICAgbWF0Y2hcbiAgfSkgPT4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBhZ2VzX3FyX2NvZGUsIHtcbiAgICB1cmw6IGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoYXRvYihtYXRjaC5wYXJhbXMuZGF0YSkpKVxuICB9KVxufSkpO1xuXG5jb25zdCBBcHAgPSAoKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBzdGF0dXMsXG4gICAgZGVmYXVsdEl0ZW0sXG4gICAgYnV0dG9uVGl0bGUsXG4gICAgZGlyLFxuICAgIHNlbmRFdmVudCxcbiAgICBkb3dubG9hZCxcbiAgICBhcHBCdXR0b25TdHlsZVxuICB9ID0gdXNlQXBwU3RhdGUoWyJzdGF0dXMiLCAiZGVmYXVsdEl0ZW0iLCAiYnV0dG9uVGl0bGUiLCAiZGlyIiwgInNlbmRFdmVudCIsICJkb3dubG9hZCIsICJhcHBCdXR0b25TdHlsZSJdKTtcbiAgY29uc3Qge1xuICAgIGkxOG4sXG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgY29uc3QgaXNTcGxpdCA9IGFwcEJ1dHRvblN0eWxlID09PSAiU3BsaXQiO1xuICBjb25zdCBvcGVuTGFuZGluZ1VybCA9IE9iamVjdChyZWFjdFsidXNlQ2FsbGJhY2siXSkoKCkgPT4ge1xuICAgIGNvbnN0IGxhbmRpbmdVcmwgPSB1dGlsc19jdHhbImEiIC8qIGRlZmF1bHQgKi9dLmdldFNlcnZpY2VVcmwodXRpbHNfY3R4WyJhIiAvKiBkZWZhdWx0ICovXS53aW5kb3cubG9jYXRpb24uaHJlZiwgaTE4bi5sYW5ndWFnZSk7XG4gICAgd2luZG93Lm9wZW4obGFuZGluZ1VybCwgIl9ibGFuayIpO1xuICAgIHNlbmRFdmVudCh7XG4gICAgICBhY3Rpb246ICJsYW5kaW5nIixcbiAgICAgIGZvcm1hdDogIiJcbiAgICB9KTtcbiAgfSwgW2kxOG4sIHNlbmRFdmVudF0pO1xuICBjb25zdCBbc3BsaXREb3dubG9hZEJ1dHRvbk5vZGUsIHNldFNwbGl0RG93bmxvYWRCdXR0b25Ob2RlXSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZUNsaWNrID0gZXZ0ID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBpZiAoc3RhdHVzID09PSAidW5hdmFpbGFibGUiKSB7XG4gICAgICAgIG9wZW5MYW5kaW5nVXJsKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb3dubG9hZCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoc3BsaXREb3dubG9hZEJ1dHRvbk5vZGUpIHtcbiAgICAgIHNwbGl0RG93bmxvYWRCdXR0b25Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGFuZGxlQ2xpY2spO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoc3BsaXREb3dubG9hZEJ1dHRvbk5vZGUpIHtcbiAgICAgICAgc3BsaXREb3dubG9hZEJ1dHRvbk5vZGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljayk7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW3NwbGl0RG93bmxvYWRCdXR0b25Ob2RlLCBzdGF0dXMsIG9wZW5MYW5kaW5nVXJsLCBkb3dubG9hZF0pO1xuXG4gIGlmIChhcHBCdXR0b25TdHlsZSkge1xuICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoZXJyb3JfYm91bmRhcnksIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9yb3V0ZXJfTWVtb3J5Um91dGVyLCBudWxsLCBpc1NwbGl0ICYmIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcHBfQnV0dG9uLCB7XG4gICAgICBkb3dubG9hZDogInRydWUiLFxuICAgICAgZGlyOiBkaXIsXG4gICAgICBib3JkZXI6ICIjZDVkMGQwIixcbiAgICAgIHJlZjogbm9kZSA9PiB7XG4gICAgICAgIGlmIChub2RlKSB7XG4gICAgICAgICAgc2V0U3BsaXREb3dubG9hZEJ1dHRvbk5vZGUobm9kZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoaWNvbnNfZG93bmxvYWQsIG51bGwpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX2Ryb3Bkb3duLCB7XG4gICAgICBvdmVybGF5OiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQXBwQm9keSwgbnVsbCksXG4gICAgICB0cmlnZ2VyOiBpc1NwbGl0ID8gImNsaWNrIiA6ICJob3ZlciJcbiAgICB9LCBpc1NwbGl0ID8gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFwcF9CdXR0b24sIHtcbiAgICAgIGRyb3Bkb3duOiAidHJ1ZSIsXG4gICAgICBkaXI6IGRpcixcbiAgICAgIGJvcmRlcjogIiNkNWQwZDAiXG4gICAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFwcF9UZXh0LCB7XG4gICAgICBpZDogInVuaWRvd25sb2FkZXItYnRuLXRleHQiXG4gICAgfSwgc3RhdHVzID09PSAidW5hdmFpbGFibGUiID8gdCgidWRsX3BvcnRhbCIpIDogYnV0dG9uVGl0bGUpKSA6IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcHBfQnV0dG9uLCB7XG4gICAgICBvbkNsaWNrOiAoKSA9PiB7XG4gICAgICAgIGlmIChzdGF0dXMgPT09ICJ1bmF2YWlsYWJsZSIpIHtcbiAgICAgICAgICBvcGVuTGFuZGluZ1VybCgpO1xuICAgICAgICB9IGVsc2UgaWYgKGRlZmF1bHRJdGVtKSB7XG4gICAgICAgICAgZG93bmxvYWQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChpY29uc19kb3dubG9hZCwgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcHBfVGV4dCwge1xuICAgICAgaWQ6ICJ1bmlkb3dubG9hZGVyLWJ0bi10ZXh0IlxuICAgIH0sIGAke3QoImRvd25sb2FkIikudG9VcHBlckNhc2UoKX0gJHtidXR0b25UaXRsZX1gKSkpKSk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGFwcCA9IChBcHApO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2xpdmUtc3RyZWFtLmpzeFxuXG5cblxuXG5cblxuY29uc3QgTGl2ZVN0cmVhbSA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQodWlfdG9vbHRpcCwge1xuICAgIHRpdGxlOiB0KCJsaXZlX3N0cmVhbV90b29sdGlwIilcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFwcF9CdXR0b24sIHtcbiAgICBlbmFibGVkOiBmYWxzZVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQodW5pZG93bmxvYWRlciwgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcHBfVGV4dCwge1xuICAgIGlkOiAidW5pZG93bmxvYWRlci1idG4tdGV4dCJcbiAgfSwgdCgibGl2ZV9zdHJlYW0iKS50b1VwcGVyQ2FzZSgpKSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbGl2ZV9zdHJlYW0gPSAoTGl2ZVN0cmVhbSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9jYW5jZWwuanN4XG5cblxuY29uc3QgSWNvbkNhbmNlbCA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMTRweCIsXG4gIGhlaWdodDogIjE0cHgiLFxuICB2aWV3Qm94OiAiMCAwIDE0IDE0IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIk03LDBDMy4yLDAsMCwzLjEsMCw3czMuMiw3LDcsN3M3LTMuMiw3LTdTMTAuOSwwLDcsMHogTTEwLjUsOS4zYzAuMywgMC4zLDAuMywwLjgsMCwxLjJjLTAuMywwLjMtMC44LDAuMy0xLjIsMEw3LDguMWwtMi4zLDIuM2MtMC4zLDAuMy0wLjgsIDAuMy0xLjIsMGMtMC4zLTAuMy0wLjMtMC44LDAtMS4yTDUuOCw3TDMuNSw0LjdjLTAuMy0wLjMtMC4zLTAuOCwgMC0xLjJjMC4zLTAuMywwLjgtMC4zLDEuMiwwTDcsNS44bDIuMy0yLjNjMC4zLTAuMywwLjgtMC4zLDEuMiwwYzAuMywgMC4zLDAuMywwLjgsMCwxLjJMOC4yLDdMMTAuNSw5LjN6IlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBpY29uc19jYW5jZWwgPSAoSWNvbkNhbmNlbCk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9wcm9ncmVzcy1iYXIuanN4XG5cblxuXG5cblxuXG5jb25zdCBwcm9ncmVzc19iYXJfQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbmA7XG5jb25zdCBQcm9ncmVzcyA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuYmFja2dyb3VuZCB8fCAiYmxhY2sifTtcbiAgd2lkdGg6IDg1cHg7XG4gIGhlaWdodDogOHB4O1xuICBib3JkZXItcmFkaXVzOiA2cHg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgJHtwcm9wcyA9PiBwcm9wcy5ib3JkZXJDb2xvciAmJiBgYm9yZGVyOiAxcHggc29saWQgJHtwcm9wcy5ib3JkZXJDb2xvcn07YH1cbiAgJjo6YmVmb3JlIHtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnByb2dyZXNzQ29sb3IgfHwgImdyYXkifTtcbiAgICBjb250ZW50OiAiICI7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgIGRpc3BsYXk6ICR7cHJvcHMgPT4gcHJvcHMucGVyY2VudCA/ICJibG9jayIgOiAibm9uZSJ9JTtcbiAgICB3aWR0aDogJHtwcm9wcyA9PiBwcm9wcy5wZXJjZW50IHx8IDB9JTtcbiAgICBoZWlnaHQ6IDhweDtcbiAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIH1cbmA7XG5jb25zdCBDYW5jZWwgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uYnV0dG9uYFxuICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDtcbiAgb3V0bGluZTogbm9uZTtcbiAgYm9yZGVyOiBub25lO1xuICBwYWRkaW5nOiAwO1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGRpc3BsYXk6IGZsZXg7XG4gICY6OmJlZm9yZSB7XG4gICAgY29udGVudDogIiAiO1xuICAgIHdpZHRoOiA2cHg7XG4gIH1cbmA7XG5cbmNvbnN0IHByb2dyZXNzX2Jhcl9tYXBTdGF0ZSA9IHN0YXRlID0+ICh7XG4gIHByb2dyZXNzOiBzdGF0ZS5wcm9ncmVzcyxcbiAgY2FuY2VsOiBzdGF0ZS5jYW5jZWwsXG4gIHRoZW1lOiBzdGF0ZS50aGVtZVxufSk7XG5cbmNvbnN0IFByb2dyZXNzQmFyID0gKHtcbiAgY29sb3Jcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIHByb2dyZXNzLFxuICAgIGNhbmNlbCxcbiAgICB0aGVtZVxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IocHJvZ3Jlc3NfYmFyX21hcFN0YXRlKTtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIGNvbnN0IHRhc2tzID0gcHJvZ3Jlc3MgJiYgT2JqZWN0LmtleXMocHJvZ3Jlc3MpO1xuICBjb25zdCBwZXJjZW50ID0gdGFza3MgJiYgcGFyc2VGbG9hdCh0YXNrcy5yZWR1Y2UoKGFjYywga2V5KSA9PiBhY2MgKyBwcm9ncmVzc1trZXldIC8gdGFza3MubGVuZ3RoLCAwKS50b0ZpeGVkKDIpKTtcbiAgY29uc3QgcHJvZ3Jlc3NCYXJTdHlsZXMgPSB0aGVtZSAmJiB0aGVtZS5wcm9ncmVzc19iYXI7XG4gIGNvbnN0IGJhY2tncm91bmQgPSBwcm9ncmVzc0JhclN0eWxlcyAmJiBwcm9ncmVzc0JhclN0eWxlcy5iYWNrZ3JvdW5kO1xuICBjb25zdCBwcm9ncmVzc0NvbG9yID0gcHJvZ3Jlc3NCYXJTdHlsZXMgJiYgcHJvZ3Jlc3NCYXJTdHlsZXMucHJvZ3Jlc3M7XG4gIGNvbnN0IGNhbmNlbENvbG9yID0gcHJvZ3Jlc3NCYXJTdHlsZXMgJiYgcHJvZ3Jlc3NCYXJTdHlsZXMuY2FuY2VsO1xuXG4gIGNvbnN0IHRvb2x0aXBUZXh0ID0gKCkgPT4ge1xuICAgIGlmIChwcm9ncmVzcykge1xuICAgICAgaWYgKHByb2dyZXNzLm11eGluZyAhPT0gMCkgcmV0dXJuIHQoImNhbmNlbF9jb252ZXJzaW9uIik7XG4gICAgICByZXR1cm4gdCgiY2FuY2VsX2Rvd25sb2FkIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgY29uc29sZS5sb2coIlBST0dSRVNTOiIsIHBlcmNlbnQsIHByb2dyZXNzKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChwcm9ncmVzc19iYXJfQ29udGFpbmVyLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoUHJvZ3Jlc3MsIHtcbiAgICBwZXJjZW50OiBwZXJjZW50IHx8IDIwLFxuICAgIGJhY2tncm91bmQ6IGNvbG9yID8gInRyYW5zcGFyZW50IiA6IGJhY2tncm91bmQsXG4gICAgcHJvZ3Jlc3NDb2xvcjogY29sb3IgfHwgcHJvZ3Jlc3NDb2xvcixcbiAgICBib3JkZXJDb2xvcjogY29sb3JcbiAgfSksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV90b29sdGlwLCB7XG4gICAgdGl0bGU6IHRvb2x0aXBUZXh0KClcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KENhbmNlbCwge1xuICAgIG9uQ2xpY2s6IGV2dCA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGV2dC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGNvbnNvbGUubG9nKCJjYW5jZWwgY2FsbGVkIiwgY2FuY2VsKTtcbiAgICAgIGlmIChjYW5jZWwpIGNhbmNlbCgpO1xuICAgIH1cbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGljb25zX2NhbmNlbCwge1xuICAgIGNvbG9yOiBjb2xvciB8fCBjYW5jZWxDb2xvclxuICB9KSkpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHByb2dyZXNzX2JhciA9IChQcm9ncmVzc0Jhcik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9pY29ucy9saWdodG5pbmcuanN4XG5cblxuY29uc3QgSWNvbkxpZ2h0bmluZyA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiODBweCIsXG4gIGhlaWdodDogIjczLjk1cHgiLFxuICB2aWV3Qm94OiAiMCAwIDgwIDczLjk1IixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDE1LjkgNzAuNzUgUSAxNS4zNSA3MS4zIDE1LjM1IDcyLjA1IDE1LjM1IDcyLjg1IDE1LjkgNzMuNCAxNi40NSA3My45IDE3LjIgNzMuOSAxOCA3My45IDE4LjUgNzMuMzUgMTkuMDUgNzIuODUgMTkuMDUgNzIuMDUgMTkuMDUgNzEuMyAxOC41IDcwLjc1IDE4IDcwLjIgMTcuMiA3MC4yIDE2LjQ1IDcwLjIgMTUuOSA3MC43NSBNIDM4LjQgNC42NSBRIDM4LjkgMy42NSA0MCAzLjY1IDQxLjEgMy42NSA0MS42IDQuNjUgTCA3Ni4xIDY3LjY1IFEgNzYuNSA2OC40NSA3NS45NSA2OS4zNSA3NS40IDcwLjIgNzQuNCA3MC4yIEwgMjQuNiA3MC4yIFEgMjMuODUgNzAuMiAyMy4zIDcwLjc1IDIyLjc1IDcxLjMgMjIuNzUgNzIuMDUgMjIuNzUgNzIuODUgMjMuMyA3My40IDIzLjggNzMuOSAyNC42IDczLjkgTCA3NC40IDczLjkgUSA3Ny41IDczLjkgNzkuMTUgNzEuMiA4MC43IDY4LjYgNzkuMzUgNjUuOTUgTCA3OS4zNSA2NS45IDQ0LjkgMi45IFEgNDMuMyAwIDQwIDAgMzYuNjUgMCAzNS4xIDIuOSBMIDAuNyA2NS44IFEgLTAuNzUgNjguNiAwLjkgNzEuMjUgMi41NSA3My45NSA1LjY1IDczLjk1IEwgOS44IDczLjk1IFEgMTAuNTUgNzMuOTUgMTEuMSA3My40IDExLjY1IDcyLjkgMTEuNjUgNzIuMSAxMS42NSA3MS4zIDExLjA1IDcwLjc1IDEwLjU1IDcwLjI1IDkuOCA3MC4yNSBMIDUuNjUgNzAuMjUgUSA0LjU1IDcwLjI1IDQuMDUgNjkuMzUgMy41IDY4LjUgMy45NSA2Ny41NSBMIDM4LjQgNC42NSBNIDQxLjg1IDE2LjYgUSA0MS44NSAxNS45NSA0MS40NSAxNS40NSA0MSAxNC45IDQwLjM1IDE0LjggMzkuNzUgMTQuNjUgMzkuMTUgMTQuOTUgMzguNTUgMTUuMyAzOC4zIDE1LjkgTCAyNy4yIDQzLjY1IFEgMjYuODUgNDQuNjUgMjcuNCA0NS4zNSAyNy45IDQ2LjE1IDI4Ljk1IDQ2LjE1IEwgMzguMTUgNDYuMTUgMzguMTUgNjQuNjUgUSAzOC4xNSA2NS4zIDM4LjU1IDY1Ljg1IDM5LjA1IDY2LjQgMzkuNjUgNjYuNDUgNDAuMyA2Ni42IDQwLjkgNjYuMyA0MS41IDY2IDQxLjcgNjUuMzUgTCA1Mi44NSAzNy42NSBRIDUzLjE1IDM2LjY1IDUyLjY1IDM1Ljg1IDUyLjEgMzUuMSA1MS4xNSAzNS4xIEwgNDEuODUgMzUuMSA0MS44NSAxNi42IE0gNDEuODUgNDQuMyBRIDQxLjg1IDQzLjYgNDEuMyA0My4wNSA0MC44IDQyLjQ1IDQwIDQyLjQ1IEwgMzEuNjUgNDIuNDUgMzguMTUgMjYuMiAzOC4xNSAzNi45NSBRIDM4LjE1IDM3LjcgMzguNyAzOC4yNSAzOS4yNSAzOC44IDQwIDM4LjggTCA0OC4zNSAzOC44IDQxLjg1IDU1LjA1IDQxLjg1IDQ0LjMgWiJcbn0pKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgbGlnaHRuaW5nID0gKEljb25MaWdodG5pbmcpO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2NvbXBvbmVudHMvaWNvbnMvaW5mby5qc3hcblxuXG5jb25zdCBJY29uSW5mbyA9ICh7XG4gIHN0eWxlLFxuICBjb2xvcixcbiAgY2xhc3NOYW1lXG59KSA9PiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHtcbiAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsXG4gIHdpZHRoOiAiMjFweCIsXG4gIGhlaWdodDogIjIxcHgiLFxuICB2aWV3Qm94OiAiMCAwIDIxIDIxIixcbiAgc3R5bGU6IHN0eWxlLFxuICBjbGFzc05hbWU6IGNsYXNzTmFtZVxufSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJwYXRoIiwge1xuICBmaWxsOiBjb2xvcixcbiAgZDogIiBNIDE3Ljk1IDMuMSBRIDE0Ljg1IDAgMTAuNSAwIDYuMTUgMCAzLjEgMy4xIDAgNi4yIDAgMTAuNTUgMCAxNC45IDMuMSAxNy45NSA2LjE1IDIxIDEwLjUgMjEgMTQuODUgMjEgMTcuOTUgMTcuOTUgMjEgMTQuODUgMjEgMTAuNTUgMjEgNi4yIDE3Ljk1IDMuMSBNIDEwLjUgMS45IFEgMTQuMDUgMS45IDE2LjYgNC40NSAxOS4xIDcgMTkuMSAxMC41NSAxOS4xIDE0LjEgMTYuNiAxNi42IDE0LjA1IDE5LjE1IDEwLjUgMTkuMTUgNi45NSAxOS4xNSA0LjQgMTYuNiAxLjkgMTQuMSAxLjkgMTAuNTUgMS45IDcgNC40IDQuNDUgNi45NSAxLjkgMTAuNSAxLjkgTSAxMS4yIDkuMiBRIDEwLjkgOC45NSAxMC41IDguOTUgMTAuMSA4Ljk1IDkuOCA5LjIgOS41NSA5LjUgOS41NSA5LjkgTCA5LjU1IDE1LjYgUSA5LjU1IDE2IDkuOCAxNi4zIDEwLjEgMTYuNiAxMC41IDE2LjYgMTAuOSAxNi42IDExLjIgMTYuMyAxMS40NSAxNiAxMS40NSAxNS42IEwgMTEuNDUgOS45IFEgMTEuNDUgOS41IDExLjIgOS4yIE0gMTAuNDUgNyBRIDExIDcgMTEuMzUgNi42NSAxMS43NSA2LjI1IDExLjc1IDUuNzUgMTEuNzUgNS4yIDExLjM1IDQuODUgMTEgNC40NSAxMC40NSA0LjQ1IDEwIDQuNDUgOS42IDQuODUgOS4yNSA1LjIgOS4yNSA1Ljc1IDkuMjUgNi4yNSA5LjYgNi42NSA5Ljk1IDcgMTAuNDUgNyBaIlxufSkpO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBpY29uc19pbmZvID0gKEljb25JbmZvKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3V0aWxzL3NhdmUtZmlsZS5qc1xubGV0IHNhdmluZyA9IGZhbHNlO1xuY29uc3Qgc2F2ZV9maWxlX3NhdmVGaWxlID0gZnVuY3Rpb24gKHVybCwgZmlsZW5hbWUpIHtcbiAgaWYgKCFzYXZpbmcpIHtcbiAgICBzYXZpbmcgPSB0cnVlO1xuICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7XG4gICAgYS5ocmVmID0gdXJsO1xuICAgIGEuZG93bmxvYWQgPSBmaWxlbmFtZTtcbiAgICBjb25zb2xlLmxvZyhkb2N1bWVudC5jcmVhdGVFbGVtZW50KTtcbiAgICBhLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgICBjb25zb2xlLmxvZygiRkFLRSEhISIsIGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgfTtcbiAgICAvLyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xuICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkge1xuICAgICAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiTW91c2VFdmVudHMiKTtcbiAgICAgIGV2ZW50LmluaXRFdmVudCgiY2xpY2siLCB0cnVlLCB0cnVlKTtcbiAgICAgIGEuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGEuY2xpY2soKTtcbiAgICB9XG4gICAgc2F2aW5nID0gZmFsc2U7XG4gIH1cbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHNhdmVfZmlsZSA9IChzYXZlX2ZpbGVfc2F2ZUZpbGUpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy9zbmFwc2hvdC1idXR0b24uanN4XG5cblxuXG5cblxuXG5cblxuY29uc3Qgc25hcHNob3RfYnV0dG9uX0NvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbmA7XG5jb25zdCBzbmFwc2hvdF9idXR0b25fQnV0dG9uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGZsZXg6IDE7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBib3JkZXI6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIGN1cnNvcjogcG9pbnRlcjtcbmA7XG5cbmNvbnN0IFNuYXBzaG90QnV0dG9uID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgc3RhdHVzLFxuICAgIHNuYXAsXG4gICAgZGVmYXVsdEl0ZW0sXG4gICAgc2VuZEV2ZW50LFxuICAgIHNob3dTbmFwc2hvdEJ1dHRvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJzdGF0dXMiLCAic25hcCIsICJkZWZhdWx0SXRlbSIsICJzZW5kRXZlbnQiLCAic2hvd1NuYXBzaG90QnV0dG9uIl0pO1xuICBjb25zdCB7XG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTsgLy8gVE9ETyDRjdGC0L4g0LbQvtC90LPQu9C40YDQvtCy0LDQvdC40LUg0L7QsdGA0LDQsdC+0YLRh9C40LrQvtC8IGNsaWNrINCy0YvQt9Cy0LDQvdC+INGA0LDQsdC+0YLQvtC5INC+0LTQvdC+0LrQu9Cw0YHRgdC90LjQutC+0LJcbiAgLy8g0LLQvtC30LzQvtC20L3QviDQvNC+0LbQvdC+ICLRh9C40YHRgtC+IiDQstGL0L3QtdGB0YLQuCDRjdGC0YMg0LvQvtCz0LjQutGDLCDRgdC00LXQu9Cw0LIg0YPQvdC40LLQtdGA0YHQsNC70YzQvdC+0Lkg0LTQu9GPINC60L7QvNC/0L7QvdC10L3RgiDRgdC+0LTQtdGA0LbQsNGJ0LjRhSBvbkNsaWNrXG4gIC8vINC40LTQtdGPINC30LDQutC70Y7Rh9Cw0LXRgtGB0Y8g0LIg0YLQvtC8INGH0YLQviDQsdGLINC40L3RjNC10LrRgtC40YLRjCDRjdGC0YMg0LvQvtCz0LjQutGDINCi0J7Qm9Cs0JrQniDQtNC70Y8gdWkg0YDQsNCx0L7RgtCw0Y7RidC10LPQviDQsiBva1xuXG4gIGNvbnN0IHNuYXBzaG90ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVuaWRvd25sb2FkZXItc25hcHNob3QiKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZUNsaWNrID0gKCkgPT4ge1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAic25hcCJcbiAgICAgIH0pO1xuICAgICAgc2F2ZV9maWxlKHNuYXAoKSwgYCR7ZGVmYXVsdEl0ZW0udGl0bGV9LmpwZWdgKTtcbiAgICB9O1xuXG4gICAgaWYgKHNuYXBzaG90KSB7XG4gICAgICBzbmFwc2hvdC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrKTtcblxuICAgICAgaWYgKHNob3dTbmFwc2hvdEJ1dHRvbikge1xuICAgICAgICBzbmFwc2hvdC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIiIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc25hcHNob3Quc2V0QXR0cmlidXRlKCJzdHlsZSIsICJkaXNwbGF5Om5vbmUiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKHNuYXBzaG90KSB7XG4gICAgICAgIHNuYXBzaG90LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGFuZGxlQ2xpY2spO1xuICAgICAgfVxuICAgIH07XG4gIH0sIFtzaG93U25hcHNob3RCdXR0b24sIHNuYXBzaG90LCBzbmFwLCBzZW5kRXZlbnQsIGRlZmF1bHRJdGVtXSk7XG4gIGNvbnN0IHNuYXBzaG90QnV0dG9uID0gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX3Rvb2x0aXAsIHtcbiAgICB0aXRsZTogdCgidGFrZV9zY3JlZW5zaG90X3Rvb2x0aXAiKVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoc25hcHNob3RfYnV0dG9uX0NvbnRhaW5lciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHNuYXBzaG90X2J1dHRvbl9CdXR0b24sIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChjYW1lcmEsIHtcbiAgICBjb2xvcjogIndoaXRlIlxuICB9KSkpKTsgLy8gVE9ETyDRgdC90LDQv9GI0L7RgtGLINC80L7QttC90L4g0YHQvdC40LzQsNGC0Ywg0LIg0LvRjtCx0L7QtSDQstGA0LXQvNGPXG4gIC8vINC+0LPRgNCw0L3QuNGH0LXQvdC40LUg0L3QsCDRgdGC0LDRgtGD0YEg0LLRi9C30LLQsNC90L4g0YLQtdC8INGH0YLQviDQvNGLINC90LUg0LjQvNC10LXQvCB0aXRsZVxuICAvLyB0aXRsZSDQvNC+0LbQvdC+INC/0L7Qu9GD0YfQsNGC0Ywg0LjQtyDQstC10YDRgdGC0LrQuCDQvdC1INC00L7QttC40LTQsNGP0YHRjCB2aWRlbyBpbmZvXG4gIC8vINCyINGC0L7QvCDRh9C40YHQu9C1INC4INC90LAg0YLRgNCw0L3RgdC70Y/RhtC40Y/RhVxuXG4gIGlmIChzdGF0dXMgPT09ICJpZGxlIiAmJiBzbmFwc2hvdCkge1xuICAgIHJldHVybiBPYmplY3QocmVhY3RfZG9tWyJjcmVhdGVQb3J0YWwiXSkoc2hvd1NuYXBzaG90QnV0dG9uID8gc25hcHNob3RCdXR0b24gOiBudWxsLCBzbmFwc2hvdCk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHNuYXBzaG90X2J1dHRvbiA9IChTbmFwc2hvdEJ1dHRvbik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9ub3RpZmljYXRpb25zL25vdGlmaWNhdGlvbi5qc3hcblxuXG5cblxuY29uc3QgSG9sZGVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgdHJhbnNpdGlvbjogJHtwcm9wcyA9PiBwcm9wcy50cmFuc2l0aW9ufTtcbiAgbWFyZ2luOiAke3Byb3BzID0+IHByb3BzLm1hcmdpbn07XG4gIG1heC1oZWlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMubWF4SGVpZ2h0fTtcbmA7XG5jb25zdCBub3RpZmljYXRpb25fQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5iYWNrZ3JvdW5kIHx8ICJ3aGl0ZSJ9O1xuICB1c2VyLXNlbGVjdDogbm9uZTtcbiAgYm9yZGVyLXJhZGl1czogMnB4O1xuICBib3JkZXI6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLmJvcmRlcn07XG4gIHBhZGRpbmc6IDhweDtcbiAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMjVzIGVhc2UtaW4tb3V0O1xuICB0cmFuc2Zvcm06ICR7cHJvcHMgPT4gcHJvcHMudHJhbnNmb3JtfTtcbiAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG4gICYgLnVuaWRvd25sb2FkZXItaWNvbiB7IGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMuaWNvbkNvbG9yfTsgfVxuYDtcbmNvbnN0IEhlYWRlckNvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbmA7XG5jb25zdCBub3RpZmljYXRpb25fSGVhZGVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgJjo6YWZ0ZXIge1xuICAgIGNvbnRlbnQ6ICIgIjtcbiAgICB3aWR0aDogNTRweDtcbiAgfVxuYDtcbmNvbnN0IEljb25Db250YWluZXIgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uZGl2YFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmY3YTBmO1xuICBiYWNrZ3JvdW5kLWltYWdlOiBsaW5lYXItZ3JhZGllbnQoI2ZmN2EwZiwgI2ZmYTcwZCk7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICB3aWR0aDogMThweDtcbiAgaGVpZ2h0OiAxOHB4O1xuICBib3JkZXItcmFkaXVzOiAycHg7XG4gICYgc3ZnIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICB3aWR0aDogMTNweDtcbiAgICBmaWxsOiB3aGl0ZTtcbiAgfVxuYDtcbmNvbnN0IE1lc3NhZ2UgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10uc3BhbmBcbiAgZm9udC1zaXplOiAxNnB4O1xuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5jb2xvcn07XG4gICR7cHJvcHMgPT4gcHJvcHMuZGlyID09PSAicnRsIiA/ICJtYXJnaW4tcmlnaHQ6IDEwcHg7IiA6ICJtYXJnaW4tbGVmdDogMTBweDsifVxuYDtcbmNvbnN0IEJ1dHRvbkNsb3NlID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGJvcmRlcjogbm9uZTtcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHdpZHRoOiAyMXB4O1xuICBoZWlnaHQ6IDIxcHg7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJvcmRlcjogMXB4IHNvbGlkICR7cHJvcHMgPT4gcHJvcHMuYm9yZGVyfTtcbiAgJjo6YmVmb3JlLFxuICAmOjphZnRlciB7XG4gICAgY29udGVudDogIiAiO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB3aWR0aDogMTNweDtcbiAgICBoZWlnaHQ6IDFweDtcbiAgICB0b3A6IDlweDtcbiAgICBsZWZ0OiAzcHg7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy5ib3JkZXIgfHwgImJsYWNrIn07XG4gIH1cbiAgJjo6YmVmb3JlIHsgdHJhbnNmb3JtOiByb3RhdGUoLTQ1ZGVnKTsgfVxuICAmOjphZnRlciB7IHRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTsgfVxuYDtcbmNvbnN0IG5vdGlmaWNhdGlvbl9Db250ZW50ID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBtYXJnaW4tdG9wOiA2cHg7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZCAke3Byb3BzID0+IHByb3BzLmJvcmRlclRvcH07XG4gIHBhZGRpbmc6IDIwcHggMDtcbmA7XG5jb25zdCBEZXNjcmlwdGlvbiA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5zcGFuYFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGZvbnQtc2l6ZTogMTRweDtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3J9O1xuICBsaW5lLWhlaWdodDogMjhweDtcbiAgbWF4LXdpZHRoOiAzMjBweDtcbiAgJHtwcm9wcyA9PiBwcm9wcy5kaXIgPT09ICJydGwiID8gIm1hcmdpbi1yaWdodDogMjBweDsiIDogIm1hcmdpbi1sZWZ0OiAyMHB4OyJ9XG5gO1xuXG5jb25zdCBOb3RpZmljYXRpb24gPSAoe1xuICBpbmRleCxcbiAgdGhlT25seSxcbiAgaWNvbixcbiAgbWVzc2FnZSxcbiAgZGVzY3JpcHRpb24sXG4gIGJvdHRvbUNvbnRlbnQsXG4gIGR1cmF0aW9uLFxuICBjbG9zZSxcbiAgb25DbG9zZVxufSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGlyLFxuICAgIHRoZW1lLFxuICAgIHJlbW92ZU5vdGlmaWNhdGlvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJkaXIiLCAidGhlbWUiLCAicmVtb3ZlTm90aWZpY2F0aW9uIl0pO1xuICBjb25zdCBbdHJhbnNpdGlvbiwgc2V0VHJhbnNpdGlvbl0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGBhbGwgJHt0aGVPbmx5ID8gMC4wMSA6IDAuMjV9cyBlYXNlLWluLW91dGApO1xuICBjb25zdCBbbWFyZ2luLCBzZXRNYXJnaW5dID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKSgwKTtcbiAgY29uc3QgW21heEhlaWdodCwgc2V0TWF4SGVpZ2h0XSA9IE9iamVjdChyZWFjdFsidXNlU3RhdGUiXSkoMCk7XG4gIGNvbnN0IFtpc0xvYWRlZCwgc2V0SXNMb2FkZWRdID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShmYWxzZSk7XG4gIGNvbnN0IHRyYW5zZm9ybVJUTCA9ICJ0cmFuc2xhdGVYKDEwMCUpIHRyYW5zbGF0ZVgoMzBweCkiO1xuICBjb25zdCB0cmFuc2Zvcm1MVFIgPSAidHJhbnNsYXRlWCgtMTAwJSkgdHJhbnNsYXRlWCgtMzBweCkiO1xuICBjb25zdCBbdHJhbnNmb3JtLCBzZXRUcmFuc2Zvcm1dID0gT2JqZWN0KHJlYWN0WyJ1c2VTdGF0ZSJdKShkaXIgPT09ICJydGwiID8gdHJhbnNmb3JtUlRMIDogdHJhbnNmb3JtTFRSKTtcbiAgY29uc3QgW2lzQ2xvc2VkLCBzZXRJc0Nsb3NlZF0gPSBPYmplY3QocmVhY3RbInVzZVN0YXRlIl0pKGZhbHNlKTtcbiAgT2JqZWN0KHJlYWN0WyJ1c2VFZmZlY3QiXSkoKCkgPT4ge1xuICAgIGlmIChpc0xvYWRlZCkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiBzZXRUcmFuc2Zvcm0oIm5vbmUiKSwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldE1hcmdpbigiMCAzMHB4IDMwcHgiKTtcbiAgICB9XG4gIH0sIFtpc0xvYWRlZF0pO1xuICBPYmplY3QocmVhY3RbInVzZUVmZmVjdCJdKSgoKSA9PiB7XG4gICAgbGV0IHRpbWVvdXQ7XG5cbiAgICBpZiAoaXNDbG9zZWQpIHtcbiAgICAgIHNldFRyYW5zZm9ybShkaXIgPT09ICJydGwiID8gdHJhbnNmb3JtUlRMIDogdHJhbnNmb3JtTFRSKTtcbiAgICB9IGVsc2UgaWYgKGR1cmF0aW9uICE9PSAtMSkge1xuICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzZXRJc0Nsb3NlZCh0cnVlKTtcbiAgICAgIH0sIGR1cmF0aW9uIHx8IDQ1MDApO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB0aW1lb3V0ICYmIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgfSwgW2lzQ2xvc2VkLCBkaXIsIGR1cmF0aW9uXSk7XG5cbiAgaWYgKGNsb3NlKSB7XG4gICAgY2xvc2UoKCkgPT4gc2V0SXNDbG9zZWQodHJ1ZSkpO1xuICB9XG5cbiAgY29uc3QgSWNvbiA9ICgpID0+IGljb24gJiYgcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoaWNvbiwge1xuICAgIGNsYXNzTmFtZTogInVuaWRvd25sb2FkZXItaWNvbiJcbiAgfSk7XG5cbiAgY29uc3Qgbm90aWZpY2F0aW9uU3R5bGVzID0gdGhlbWUgJiYgdGhlbWUubm90aWZpY2F0aW9uO1xuICBjb25zdCBiYWNrZ3JvdW5kID0gbm90aWZpY2F0aW9uU3R5bGVzICYmIG5vdGlmaWNhdGlvblN0eWxlcy5iYWNrZ3JvdW5kO1xuICBjb25zdCBib3JkZXIgPSBub3RpZmljYXRpb25TdHlsZXMgJiYgbm90aWZpY2F0aW9uU3R5bGVzLmJvcmRlcjtcbiAgY29uc3QgYm9yZGVyVG9wID0gbm90aWZpY2F0aW9uU3R5bGVzICYmIG5vdGlmaWNhdGlvblN0eWxlcy5ib3JkZXJfdG9wO1xuICBjb25zdCBjbG9zZUJ1dHRvbkJvcmRlciA9IG5vdGlmaWNhdGlvblN0eWxlcyAmJiBub3RpZmljYXRpb25TdHlsZXMuY2xvc2VfYnV0dG9uO1xuICBjb25zdCBpY29uQ29sb3IgPSBub3RpZmljYXRpb25TdHlsZXMgJiYgbm90aWZpY2F0aW9uU3R5bGVzLmljb247XG4gIGNvbnN0IG1lc3NhZ2VDb2xvciA9IG5vdGlmaWNhdGlvblN0eWxlcyAmJiBub3RpZmljYXRpb25TdHlsZXMubWVzc2FnZTtcbiAgY29uc3QgZGVzY3JpcHRpb25Db2xvciA9IG5vdGlmaWNhdGlvblN0eWxlcyAmJiBub3RpZmljYXRpb25TdHlsZXMuZGVzY3JpcHRpb247XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSG9sZGVyLCB7XG4gICAgdHJhbnNpdGlvbjogdHJhbnNpdGlvbixcbiAgICBtYXJnaW46IG1hcmdpbixcbiAgICBtYXhIZWlnaHQ6IG1heEhlaWdodCxcbiAgICBvblRyYW5zaXRpb25FbmQ6ICgpID0+IHtcbiAgICAgIGlmICh0cmFuc2l0aW9uICE9PSAiYWxsIDBzIGVhc2UgMHMiKSB7XG4gICAgICAgIHNldFRyYW5zaXRpb24oImFsbCAwcyBlYXNlIDBzIik7XG5cbiAgICAgICAgaWYgKCFpc0xvYWRlZCkge1xuICAgICAgICAgIHNldElzTG9hZGVkKHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzQ2xvc2VkKSB7XG4gICAgICAgICAgaWYgKG9uQ2xvc2UpIG9uQ2xvc2UoKTtcbiAgICAgICAgICByZW1vdmVOb3RpZmljYXRpb24oaW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobm90aWZpY2F0aW9uX0NvbnRhaW5lciwge1xuICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtLFxuICAgIGJhY2tncm91bmQ6IGJhY2tncm91bmQsXG4gICAgYm9yZGVyOiBib3JkZXIsXG4gICAgaWNvbkNvbG9yOiBpY29uQ29sb3IsXG4gICAgcmVmOiBub2RlID0+IHtcbiAgICAgIGlmIChub2RlICYmICFpc0Nsb3NlZCkge1xuICAgICAgICBjb25zdCBub2RlUmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIGNvbnN0IG5vZGVIZWlnaHQgPSBNYXRoLnJvdW5kKG5vZGVSZWN0LmhlaWdodCk7XG4gICAgICAgIHNldE1heEhlaWdodChgJHtub2RlSGVpZ2h0fXB4YCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBvblRyYW5zaXRpb25FbmQ6ICgpID0+IHtcbiAgICAgIGlmICh0cmFuc2Zvcm0gIT09ICJub25lIikge1xuICAgICAgICBzZXRUcmFuc2l0aW9uKCJhbGwgMC4yNXMgZWFzZS1pbi1vdXQiKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc2V0TWFyZ2luKDApO1xuICAgICAgICAgIHNldE1heEhlaWdodCgwKTtcbiAgICAgICAgfSwgMCk7XG4gICAgICB9XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSGVhZGVyQ29udGFpbmVyLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobm90aWZpY2F0aW9uX0hlYWRlciwgbnVsbCwgZGVzY3JpcHRpb24gfHwgIWljb24gPyAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSWNvbkNvbnRhaW5lciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVuaWRvd25sb2FkZXIsIG51bGwpKSA6IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChJY29uLCBudWxsKSwgbWVzc2FnZSAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoTWVzc2FnZSwge1xuICAgIGRpcjogZGlyLFxuICAgIGNvbG9yOiBtZXNzYWdlQ29sb3JcbiAgfSwgbWVzc2FnZSkpLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoQnV0dG9uQ2xvc2UsIHtcbiAgICBvbkNsaWNrOiBldnQgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBzZXRJc0Nsb3NlZCh0cnVlKTtcbiAgICB9LFxuICAgIGJvcmRlcjogY2xvc2VCdXR0b25Cb3JkZXJcbiAgfSkpLCBkZXNjcmlwdGlvbiAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobm90aWZpY2F0aW9uX0NvbnRlbnQsIHtcbiAgICBib3JkZXJUb3A6IGJvcmRlclRvcFxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoSWNvbiwgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChEZXNjcmlwdGlvbiwge1xuICAgIGRpcjogZGlyLFxuICAgIGNvbG9yOiBkZXNjcmlwdGlvbkNvbG9yLFxuICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7XG4gICAgICBfX2h0bWw6IGRlc2NyaXB0aW9uXG4gICAgfVxuICB9KSksIGJvdHRvbUNvbnRlbnQpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG5vdGlmaWNhdGlvbnNfbm90aWZpY2F0aW9uID0gKE5vdGlmaWNhdGlvbik7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvY29tcG9uZW50cy91aS9ub3RpZmljYXRpb25zL2luZGV4LmpzeFxuZnVuY3Rpb24gbm90aWZpY2F0aW9uc19leHRlbmRzKCkgeyBub3RpZmljYXRpb25zX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OyByZXR1cm4gbm90aWZpY2F0aW9uc19leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cblxuXG5cblxuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB1aV9ub3RpZmljYXRpb25zID0gKCgpID0+IHtcbiAgY29uc3Qge1xuICAgIG5vdGlmaWNhdGlvbnNcbiAgfSA9IHVzZUFwcFN0YXRlKFsibm90aWZpY2F0aW9ucyJdKTtcbiAgY29uc3Qgbm90aWZpY2F0aW9uc0hvbGRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1bmlkb3dubG9hZGVyLW5vdGlmaWNhdGlvbnMiKTtcbiAgY29uc3QgZG9tID0gbm90aWZpY2F0aW9ucy5tYXAoKG5vdGlmaWNhdGlvbiwgaW5kZXgpID0+IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChub3RpZmljYXRpb25zX25vdGlmaWNhdGlvbiwgbm90aWZpY2F0aW9uc19leHRlbmRzKHt9LCBub3RpZmljYXRpb24sIHtcbiAgICBrZXk6IG5vdGlmaWNhdGlvbi5pZCxcbiAgICBpbmRleDogaW5kZXgsXG4gICAgdGhlT25seTogbm90aWZpY2F0aW9ucy5sZW5ndGggPT09IDFcbiAgfSkpKTtcbiAgcmV0dXJuIE9iamVjdChyZWFjdF9kb21bImNyZWF0ZVBvcnRhbCJdKShkb20sIG5vdGlmaWNhdGlvbnNIb2xkZXIpO1xufSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvd2lkZ2V0LmpzeFxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxubGV0IGlzQWN0aXZlRG93bmxvYWROb3RpZmljYXRpb25TaG93ID0gZmFsc2U7XG5sZXQgaXNDb21wZXRpdG9yc0RldGVjdGlvbk5vdGlmaWNhdGlvblNob3cgPSB0cnVlOyAvLyBUT0RPOiBmYWxzZTtcblxuY29uc3Qgd2lkZ2V0X0NvbnRhaW5lciA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgbWFyZ2luOiAwIC00cHg7XG4gICYgYnV0dG9uIHsgbWFyZ2luOiAwIDRweDsgfVxuYDtcbmNvbnN0IEJ1dHRvblVuZGVybGluZSA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5idXR0b25gXG4gIG91dGxpbmU6IG5vbmU7XG4gIGJvcmRlcjogbm9uZTtcbiAgcGFkZGluZzogNnB4IDhweDtcbiAgbWFyZ2luOiAwIGF1dG8gMjRweDtcbiAgZGlzcGxheTogYmxvY2s7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgZm9udC1zaXplOiAxNnB4O1xuICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLmNvbG9yfTtcbiAgJjpob3ZlciB7XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuaG92ZXJ9O1xuICB9XG5gO1xuXG5jb25zdCBCb3R0b21Db250ZW50ID0gKHtcbiAgY2xvc2Vcbn0pID0+IHtcbiAgY29uc3Qge1xuICAgIHRoZW1lXG4gIH0gPSB1c2VBcHBTdGF0ZShbInRoZW1lIl0pO1xuICBjb25zdCBub3RpZmljYXRpb25TdHlsZXMgPSB0aGVtZSAmJiB0aGVtZS5ub3RpZmljYXRpb247XG4gIGNvbnN0IGJ1dHRvblVuZGVybGluZSA9IG5vdGlmaWNhdGlvblN0eWxlcyAmJiBub3RpZmljYXRpb25TdHlsZXMuYnV0dG9uX3VuZGVybGluZTtcbiAgY29uc3QgY29sb3IgPSBidXR0b25VbmRlcmxpbmUgJiYgYnV0dG9uVW5kZXJsaW5lLmNvbG9yO1xuICBjb25zdCBob3ZlciA9IGJ1dHRvblVuZGVybGluZSAmJiBidXR0b25VbmRlcmxpbmUuaG92ZXI7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQod2lkZ2V0X0NvbnRhaW5lciwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KEJ1dHRvblVuZGVybGluZSwge1xuICAgIGNvbG9yOiBjb2xvcixcbiAgICBob3ZlcjogaG92ZXIsXG4gICAgb25DbGljazogY2xvc2VcbiAgfSwgIlxcdTA0MkYgXFx1MDQzRlxcdTA0M0VcXHUwNDNEXFx1MDQzOFxcdTA0M0NcXHUwNDMwXFx1MDQ0RSBcXHUwNDQwXFx1MDQzOFxcdTA0NDFcXHUwNDNBIiksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudCh1aV9idXR0b24gLy8gb25DbGljaz17KCkgPT4ge319XG4gICwge1xuICAgIGljb246IGljb25zX2luZm8sXG4gICAgdGV4dDogIlxcdTA0MUFcXHUwNDMwXFx1MDQzQSBcXHUwNDM4XFx1MDQ0MVxcdTA0M0ZcXHUwNDQwXFx1MDQzMFxcdTA0MzJcXHUwNDM4XFx1MDQ0MlxcdTA0NEMgXFx1MDQ0RFxcdTA0NDJcXHUwNDQzIFxcdTA0M0ZcXHUwNDQwXFx1MDQzRVxcdTA0MzFcXHUwNDNCXFx1MDQzNVxcdTA0M0NcXHUwNDQzPyJcbiAgfSkpO1xufTtcblxuY29uc3Qgd2lkZ2V0X1dpZGdldCA9ICgpID0+IHtcbiAgY29uc3Qge1xuICAgIHN0YXR1cyxcbiAgICBzbmFwLFxuICAgIHdhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uLFxuICAgIGFkZE5vdGlmaWNhdGlvblxuICB9ID0gdXNlQXBwU3RhdGUoWyJzdGF0dXMiLCAic25hcCIsICJ3YXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbiIsICJhZGROb3RpZmljYXRpb24iXSk7XG4gIGNvbnN0IGRpZE1vdW50UmVmID0gT2JqZWN0KHJlYWN0WyJ1c2VSZWYiXSkobnVsbCk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBkaWRNb3VudFJlZi5jdXJyZW50ID0gdHJ1ZTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZGlkTW91bnRSZWYuY3VycmVudCA9IGZhbHNlO1xuICAgIH07XG4gIH0sIFtdKTtcbiAgY29uc3Qge1xuICAgIHRcbiAgfSA9IHVzZVRyYW5zbGF0aW9uKCk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBjb25zdCBzaG93QWN0aXZlRG93bmxvYWROb3RpZmljYXRpb24gPSAoKSA9PiB7XG4gICAgICBpZiAoZGlkTW91bnRSZWYuY3VycmVudCAmJiAhaXNBY3RpdmVEb3dubG9hZE5vdGlmaWNhdGlvblNob3cpIHtcbiAgICAgICAgYWRkTm90aWZpY2F0aW9uKHtcbiAgICAgICAgICBpY29uOiBpY29uc193YXJuaW5nLFxuICAgICAgICAgIG1lc3NhZ2U6IHQoImFjdGl2ZV9kb3dubG9hZF93YXJuaW5nX25vdGlmaWNhdGlvbl9tZXNzYWdlIiksXG4gICAgICAgICAgZGVzY3JpcHRpb246IHQoImFjdGl2ZV9kb3dubG9hZF93YXJuaW5nX25vdGlmaWNhdGlvbl9kZXNjcmlwdGlvbiIpLFxuICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChkaWRNb3VudFJlZi5jdXJyZW50KSB7XG4gICAgICAgICAgICAgIGlzQWN0aXZlRG93bmxvYWROb3RpZmljYXRpb25TaG93ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHN0YXR1cyA9PT0gImRvd25sb2FkaW5nIikge1xuICAgICAgd2luZG93Lm9uYmVmb3JldW5sb2FkID0gKCkgPT4ge1xuICAgICAgICBzaG93QWN0aXZlRG93bmxvYWROb3RpZmljYXRpb24oKTtcbiAgICAgICAgcmV0dXJuICJEbyB5b3UgcmVhbGx5IHdhbnQgdG8gY2xvc2U/IjtcbiAgICAgIH07XG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwb3BzdGF0ZSIsIHNob3dBY3RpdmVEb3dubG9hZE5vdGlmaWNhdGlvbiwgZmFsc2UpO1xuICAgIH1cblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBudWxsO1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBvcHN0YXRlIiwgc2hvd0FjdGl2ZURvd25sb2FkTm90aWZpY2F0aW9uLCBmYWxzZSk7XG4gICAgfTtcbiAgfSwgW3N0YXR1cywgdCwgYWRkTm90aWZpY2F0aW9uXSk7XG4gIE9iamVjdChyZWFjdFsidXNlRWZmZWN0Il0pKCgpID0+IHtcbiAgICBjb25zdCBzaG93Q29tcGV0aXRvcnNEZXRlY3Rpb25Ob3RpZmljYXRpb24gPSAoKSA9PiB7XG4gICAgICBpZiAoZGlkTW91bnRSZWYuY3VycmVudCAmJiB3YXJuQWJvdXRDb21wZXRpdG9yc0RldGVjdGlvbiAmJiAhaXNDb21wZXRpdG9yc0RldGVjdGlvbk5vdGlmaWNhdGlvblNob3cpIHtcbiAgICAgICAgaXNDb21wZXRpdG9yc0RldGVjdGlvbk5vdGlmaWNhdGlvblNob3cgPSB0cnVlO1xuXG4gICAgICAgIGxldCBjbG9zZSA9IGZ1bmMgPT4ge1xuICAgICAgICAgIGNsb3NlID0gZnVuYztcbiAgICAgICAgfTtcblxuICAgICAgICBhZGROb3RpZmljYXRpb24oe1xuICAgICAgICAgIGljb246IGxpZ2h0bmluZyxcbiAgICAgICAgICBtZXNzYWdlOiAi0JLQvdC40LzQsNC90LjQtSEiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBg0J7QsdC90LDRgNGD0LbQtdC90L4g0YDQsNGB0YjQuNGA0LXQvdC40LUgPGI+JHtjb21wZXRpdG9yc19kZXRlY3Rpb24oKX08L2I+INC00LvRjyDQt9Cw0LPRgNGD0LfQutC4INC80YPQu9GM0YLQuNC80LXQtNC40LAg0YTQsNC50LvQvtCyLlxuICAgICAgICAgINCe0LTQvdC+0LLRgNC10LzQtdC90L3QsNGPINGA0LDQsdC+0YLQsCDQvdC10YHQutC+0LvRjNC60LjRhSDQsdGA0LDRg9C30LXRgNC90YvRhSDRgNCw0YHRiNC40YDQtdC90LjQuSDQvNC+0LbQtdGCINC/0YDQuNCy0LXRgdGC0Lgg0LogPGI+0YHQsdC+0Y/QvDwvYj4g0LIg0YDQsNCx0L7RgtC1INCy0LDRiNC10LPQviDQsdGA0LDRg9C30LXRgNCwLmAsXG4gICAgICAgICAgYm90dG9tQ29udGVudDogLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KEJvdHRvbUNvbnRlbnQsIHtcbiAgICAgICAgICAgIGNsb3NlOiAoKSA9PiBjbG9zZSgpXG4gICAgICAgICAgfSksXG4gICAgICAgICAgZHVyYXRpb246IC0xLFxuICAgICAgICAgIGNsb3NlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgIGlmIChjb21wZXRpdG9yc19kZXRlY3Rpb24oKSkge1xuICAgICAgICBzaG93Q29tcGV0aXRvcnNEZXRlY3Rpb25Ob3RpZmljYXRpb24oKTtcbiAgICAgICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHdhcm5BYm91dENvbXBldGl0b3JzRGV0ZWN0aW9uKSB7XG4gICAgICBpZiAoY29tcGV0aXRvcnNfZGV0ZWN0aW9uKCkpIHtcbiAgICAgICAgc2hvd0NvbXBldGl0b3JzRGV0ZWN0aW9uTm90aWZpY2F0aW9uKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LCB7XG4gICAgICAgICAgYXR0cmlidXRlczogZmFsc2UsXG4gICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICAgIGNoYXJhY3RlckRhdGE6IGZhbHNlLFxuICAgICAgICAgIHN1YnRyZWU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9O1xuICB9LCBbd2FybkFib3V0Q29tcGV0aXRvcnNEZXRlY3Rpb24sIGFkZE5vdGlmaWNhdGlvbiwgdF0pO1xuICBjb25zdCBjb21wb25lbnRzID0ge1xuICAgIGRvd25sb2FkaW5nOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocHJvZ3Jlc3NfYmFyLCBudWxsKSxcbiAgICBsaXZlU3RyZWFtOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQobGl2ZV9zdHJlYW0sIG51bGwpLFxuICAgIGdldHRpbmdJbmZvOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoc3Bpbm5lciwgbnVsbCksXG4gICAgaWRsZTogLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGFwcCwgbnVsbCksXG4gICAgdW5hdmFpbGFibGU6IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChhcHAsIG51bGwpXG4gIH07XG5cbiAgaWYgKHN0YXR1cyBpbiBjb21wb25lbnRzKSB7XG4gICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChyZWFjdF9kZWZhdWx0LmEuRnJhZ21lbnQsIG51bGwsIGNvbXBvbmVudHNbc3RhdHVzXSwgc25hcCAmJiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoc25hcHNob3RfYnV0dG9uLCBudWxsKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX25vdGlmaWNhdGlvbnMsIG51bGwpKTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgd2lkZ2V0X3dpZGdldCA9ICh3aWRnZXRfV2lkZ2V0KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC9lbWJlZC9ib2R5LmpzeFxuXG5cblxuXG5cblxuXG5cbmNvbnN0IGJvZHlfQ29udGFpbmVyID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmRpdmBcbiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLDAsMCwwLjg1KTtcbiAgYm9yZGVyLXJhZGl1czogM3B4O1xuICBwYWRkaW5nOiA2cHggMDtcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XG5gO1xuY29uc3QgYm9keV9UYWJsZSA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS50YWJsZWBcbiAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTtcbiAgYm9yZGVyLXNwYWNpbmc6IDA7XG5gO1xuY29uc3QgYm9keV9Sb3cgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10udHJgXG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgJjpob3ZlciB0ZCB7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC4yNSk7IH1cbmA7XG5jb25zdCBib2R5X0NlbGwgPSBzdHlsZWRfY29tcG9uZW50c19icm93c2VyX2VzbVsiYSIgLyogZGVmYXVsdCAqL10udGRgXG4gIGNvbG9yOiB3aGl0ZTtcbiAgaGVpZ2h0OiAyMHB4O1xuICAmOm50aC1jaGlsZCgxKSxcbiAgJjpudGgtY2hpbGQoMykge1xuICAgIHBhZGRpbmc6IDAgNnB4O1xuICB9XG4gICY6bnRoLWNoaWxkKDIpIHsgcGFkZGluZzogMDsgfVxuICAmIHN2ZyB7XG4gICAgZGlzcGxheTogYmxvY2s7XG4gICAgbWF4LXdpZHRoOiAxMnB4O1xuICAgIG1hcmdpbjogYXV0bztcbiAgICBmaWxsOiB3aGl0ZTtcbiAgfVxuYDtcblxuY29uc3QgYm9keV9tYXBTdGF0ZSA9IHN0YXRlID0+ICh7XG4gIHN0cmVhbUluZm86IHN0YXRlLnN0cmVhbUluZm8sXG4gIGF1ZGlvSW5mbzogc3RhdGUuYXVkaW9JbmZvLFxuICBzZW5kRXZlbnQ6IHN0YXRlLnNlbmRFdmVudCxcbiAgZG93bmxvYWQ6IHN0YXRlLm1vZHVsZS5kb3dubG9hZFxufSk7XG5cbmNvbnN0IEJvZHkgPSAoKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBzdHJlYW1JbmZvLFxuICAgIGF1ZGlvSW5mbyxcbiAgICBzZW5kRXZlbnQsXG4gICAgZG93bmxvYWRcbiAgfSA9IHVzZVNlbGVjdG9yX3VzZVNlbGVjdG9yKGJvZHlfbWFwU3RhdGUpO1xuICBjb25zdCB7XG4gICAgaTE4bixcbiAgICB0XG4gIH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBsaXN0ID0gZm9ybWF0c0xpc3RFbWJlZChzdHJlYW1JbmZvLCBhdWRpb0luZm8pO1xuICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHlfQ29udGFpbmVyLCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoYm9keV9UYWJsZSwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIG51bGwsIGxpc3QubWFwKGl0ZW0gPT4ge1xuICAgIGNvbnN0IG1lZGlhVHlwZSA9IGdldE1lZGlhVHlwZShpdGVtKTtcbiAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHlfUm93LCB7XG4gICAgICBrZXk6IGAke2l0ZW0ud2lkdGh9OiR7aXRlbS5mcHN9OiR7T2JqZWN0LmtleXMoaXRlbSkuam9pbigiIil9YCxcbiAgICAgIG9uQ2xpY2s6IGV2dCA9PiB7XG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBkb3dubG9hZChpdGVtKTtcbiAgICAgIH1cbiAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoYm9keV9DZWxsLCBudWxsLCBnZXRJY29uTWVkaWFUeXBlKGl0ZW0pKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHlfQ2VsbCwgbWVkaWFUeXBlID09PSAiYXVkaW8iICYmIHtcbiAgICAgIGNvbFNwYW46IDJcbiAgICB9LCBnZXRUaXRsZUVtYmVkKGl0ZW0pKSwgbWVkaWFUeXBlID09PSAidmlkZW8iICYmIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChib2R5X0NlbGwsIG51bGwsIGAoJHtpdGVtLndpZHRofXgke2l0ZW0uaGVpZ2h0fSlgKSk7XG4gIH0pLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoYm9keV9Sb3csIHtcbiAgICBvbkNsaWNrOiBldnQgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBjb25zdCBsYW5kaW5nVXJsID0gdXRpbHNfY3R4WyJhIiAvKiBkZWZhdWx0ICovXS5nZXRTZXJ2aWNlVXJsKHV0aWxzX2N0eFsiYSIgLyogZGVmYXVsdCAqL10ud2luZG93LmxvY2F0aW9uLmhyZWYsIGkxOG4ubGFuZ3VhZ2UpO1xuICAgICAgd2luZG93Lm9wZW4obGFuZGluZ1VybCwgIl9ibGFuayIpO1xuICAgICAgc2VuZEV2ZW50KHtcbiAgICAgICAgYWN0aW9uOiAibGFuZGluZyIsXG4gICAgICAgIGZvcm1hdDogIiJcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHlfQ2VsbCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHBsdXMsIG51bGwpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHlfQ2VsbCwge1xuICAgIGNvbFNwYW46IDJcbiAgfSwgdCgibW9yZV9mb3JtYXRzIikpKSkpKTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGJvZHkgPSAoQm9keSk7XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvZW1iZWQvYXBwLmpzeFxuXG5cblxuXG5cblxuXG5cblxuXG5jb25zdCBlbWJlZF9hcHBfQnV0dG9uID0gc3R5bGVkX2NvbXBvbmVudHNfYnJvd3Nlcl9lc21bImEiIC8qIGRlZmF1bHQgKi9dLmJ1dHRvbmBcbiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gIG91dGxpbmU6IG5vbmU7XG4gIGZsZXg6IDE7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBib3JkZXI6IG5vbmU7XG4gIHBhZGRpbmc6IDA7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgJiBzdmcge1xuICAgIG1hcmdpbjogMCA0cHg7XG4gICAgZmlsbDogd2hpdGU7XG4gIH1cbmA7XG5jb25zdCBlbWJlZF9hcHBfVGV4dCA9IHN0eWxlZF9jb21wb25lbnRzX2Jyb3dzZXJfZXNtWyJhIiAvKiBkZWZhdWx0ICovXS5zcGFuYFxuICB1c2VyLXNlbGVjdDogbm9uZTtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgZm9udC13ZWlnaHQ6IDYwMDtcbiAgY29sb3I6IHdoaXRlO1xuICAke3Byb3BzID0+IHByb3BzLmNoZWNrbWFyayA/IGBcbiAgICAmOjpiZWZvcmUge1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgY29udGVudDogIiAiO1xuICAgICAgd2lkdGg6IDRweDtcbiAgICB9XG4gICAgJjo6YWZ0ZXIge1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgY29udGVudDogIiAiO1xuICAgICAgd2lkdGg6IDlweDtcbiAgICAgIGhlaWdodDogOXB4O1xuICAgICAgbWFyZ2luOiAwIDRweDtcbiAgICAgIHRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKSBzY2FsZSgwLjcpO1xuICAgICAgYm9yZGVyLXJpZ2h0OiAzcHggc29saWQgd2hpdGU7XG4gICAgICBib3JkZXItYm90dG9tOiAzcHggc29saWQgd2hpdGU7XG4gICAgfVxuICBgIDogYFxuICAgIG1hcmdpbjogMCA0cHg7XG4gIGB9XG5gO1xuXG5jb25zdCBhcHBfbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICBzdGF0dXM6IHN0YXRlLnN0YXR1cyxcbiAgc2VuZEV2ZW50OiBzdGF0ZS5zZW5kRXZlbnQsXG4gIHRpdGxlOiBzdGF0ZS5kZWZhdWx0SXRlbSA/IGdldEV4dFRpdGxlKHN0YXRlLmRlZmF1bHRJdGVtKSA6ICIiLFxuICBkb3dubG9hZDogc3RhdGUuZG93bmxvYWRcbn0pO1xuXG5jb25zdCBhcHBfQXBwID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgc3RhdHVzLFxuICAgIHNlbmRFdmVudCxcbiAgICB0aXRsZSxcbiAgICBkb3dubG9hZFxuICB9ID0gdXNlU2VsZWN0b3JfdXNlU2VsZWN0b3IoYXBwX21hcFN0YXRlKTtcbiAgY29uc3Qge1xuICAgIGkxOG4sXG4gICAgdFxuICB9ID0gdXNlVHJhbnNsYXRpb24oKTtcbiAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChlcnJvcl9ib3VuZGFyeSwge1xuICAgIGVtYmVkOiB0cnVlXG4gIH0sIHN0YXR1cyA9PT0gInVuYXZhaWxhYmxlIiA/IC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChlbWJlZF9hcHBfQnV0dG9uLCB7XG4gICAgb25DbGljazogZXZ0ID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgbGFuZGluZ1VybCA9IHV0aWxzX2N0eFsiYSIgLyogZGVmYXVsdCAqL10uZ2V0U2VydmljZVVybCh1dGlsc19jdHhbImEiIC8qIGRlZmF1bHQgKi9dLndpbmRvdy5sb2NhdGlvbi5ocmVmLCBpMThuLmxhbmd1YWdlKTtcbiAgICAgIHdpbmRvdy5vcGVuKGxhbmRpbmdVcmwsICJfYmxhbmsiKTtcbiAgICAgIHNlbmRFdmVudCh7XG4gICAgICAgIGFjdGlvbjogImxhbmRpbmciLFxuICAgICAgICBmb3JtYXQ6ICIiXG4gICAgICB9KTtcbiAgICB9XG4gIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChpY29uc19kb3dubG9hZCwgbnVsbCksIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChlbWJlZF9hcHBfVGV4dCwgbnVsbCwgdCgidWRsX3BvcnRhbCIpKSkgOiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocmVhY3RfZGVmYXVsdC5hLkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoZW1iZWRfYXBwX0J1dHRvbiwge1xuICAgIG9uQ2xpY2s6IGV2dCA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGRvd25sb2FkKCk7XG4gICAgfVxuICB9LCAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoaWNvbnNfZG93bmxvYWQsIG51bGwpKSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KHVpX2Ryb3Bkb3duLCB7XG4gICAgb3ZlcmxheTogLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGJvZHksIG51bGwpLFxuICAgIHRyaWdnZXI6ICJjbGljayJcbiAgfSwgLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGVtYmVkX2FwcF9CdXR0b24sIG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChlbWJlZF9hcHBfVGV4dCwge1xuICAgIGNoZWNrbWFyazogdHJ1ZVxuICB9LCB0aXRsZSkpKSkpO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZW1iZWRfYXBwID0gKGFwcF9BcHApO1xuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L2VtYmVkL2luZGV4LmpzeFxuXG5cblxuXG5cblxuY29uc3QgZW1iZWRfbWFwU3RhdGUgPSBzdGF0ZSA9PiAoe1xuICBzdGF0dXM6IHN0YXRlLnN0YXR1c1xufSk7XG5cbmNvbnN0IFdpZGdldEVtYmVkID0gKCkgPT4ge1xuICBjb25zdCB7XG4gICAgc3RhdHVzXG4gIH0gPSB1c2VTZWxlY3Rvcl91c2VTZWxlY3RvcihlbWJlZF9tYXBTdGF0ZSk7XG4gIGlmIChzdGF0dXMgPT09ICJkb3dubG9hZGluZyIpIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQocHJvZ3Jlc3NfYmFyLCB7XG4gICAgY29sb3I6ICJ3aGl0ZSJcbiAgfSk7XG4gIGlmIChzdGF0dXMgPT09ICJnZXR0aW5nSW5mbyIpIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3RfZGVmYXVsdC5hLmNyZWF0ZUVsZW1lbnQoc3Bpbm5lciwge1xuICAgIGNvbG9yOiAid2hpdGUiXG4gIH0pO1xuICBpZiAoc3RhdHVzID09PSAiaWRsZSIgfHwgc3RhdHVzID09PSAidW5hdmFpbGFibGUiKSByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGVtYmVkX2FwcCwgbnVsbCk7XG4gIHJldHVybiBudWxsO1xufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgd2lkZ2V0X2VtYmVkID0gKFdpZGdldEVtYmVkKTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3V0aWxzL2dldC1jb250ZW50LWxpbWl0LmpzXG5jb25zdCBnZXREZWZhdWx0TWVtb3J5U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIDIgKiAxMDI0ICogMTAyNCAqIDEwMjQ7XG59O1xuXG5jb25zdCBnZXRGcmVlTWVtb3J5U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cucGVyZm9ybWFuY2UubWVtb3J5KSB7XG4gICAgcmV0dXJuIHdpbmRvdy5wZXJmb3JtYW5jZS5tZW1vcnkuanNIZWFwU2l6ZUxpbWl0IC0gd2luZG93LnBlcmZvcm1hbmNlLm1lbW9yeS51c2VkSlNIZWFwU2l6ZTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IGdldFBsYXRmb3JtID0gKCgpID0+IHtcbiAgbGV0IHBsYXRmb3JtID0gIiI7XG4gIGNvbnN0IGRlc2MgPSB3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtLnRvTG93ZXJDYXNlKCk7XG4gIC8vIE1hYzY4SyBNYWNQUEMgTWFjSW50ZWxcbiAgaWYgKC9ebWFjLiovLnRlc3QoZGVzYykpIHBsYXRmb3JtID0gIm1hY09TIjtcbiAgLy8gV2luMTYgV2luMzIgV2luQ0VcbiAgaWYgKC9ed2luLiovLnRlc3QoZGVzYykpIHBsYXRmb3JtID0gIndpbmRvd3MiO1xuICBpZiAoL15saW51eC4qLy50ZXN0KGRlc2MpKSBwbGF0Zm9ybSA9ICJsaW51eCI7XG4gIHJldHVybiBwbGF0Zm9ybTtcbn0pO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBnZXRfY29udGVudF9saW1pdCA9IChhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHBsYXRmb3JtID0gZ2V0UGxhdGZvcm0oKTtcbiAgY29uc3QgZnJlZU1lbW9yeVNpemUgPSBnZXRGcmVlTWVtb3J5U2l6ZSgpO1xuICBjb25zdCBmcmVlTWVtb3J5ID0gKGZyZWVNZW1vcnlTaXplICYmIGZyZWVNZW1vcnlTaXplID4gMCkgPyBmcmVlTWVtb3J5U2l6ZSA6IGdldERlZmF1bHRNZW1vcnlTaXplKHBsYXRmb3JtKTtcbiAgbGV0IGxpbWl0ID0gMDtcbiAgc3dpdGNoIChwbGF0Zm9ybSkge1xuICBjYXNlICJtYWNPUyI6XG4gIGNhc2UgImxpbnV4IjpcbiAgICBsaW1pdCA9IDAuNzUgKiBmcmVlTWVtb3J5O1xuICAgIGJyZWFrO1xuICBjYXNlICJ3aW5kb3dzIjpcbiAgICBsaW1pdCA9IDAuMSAqIGZyZWVNZW1vcnk7XG4gICAgYnJlYWs7XG4gIGRlZmF1bHQ6XG4gICAgbGltaXQgPSAwLjUgKiBmcmVlTWVtb3J5O1xuICB9XG4gIGNvbnN0IHN0b3JhZ2UgPSBuYXZpZ2F0b3Iuc3RvcmFnZSA/IGF3YWl0IG5hdmlnYXRvci5zdG9yYWdlLmVzdGltYXRlKCkgOiBudWxsO1xuICByZXR1cm4gc3RvcmFnZSA/IE1hdGgubWluKGxpbWl0LCBzdG9yYWdlLnF1b3RhIC0gc3RvcmFnZS51c2FnZSkgOiBsaW1pdDtcbn0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YuanNcbmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gICJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7XG5cbiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHtcbiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHtcbiAgICAgIHJldHVybiB0eXBlb2Ygb2JqO1xuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO1xuICAgIH07XG4gIH1cblxuICByZXR1cm4gX3R5cGVvZihvYmopO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanNcbmZ1bmN0aW9uIGRlZmluZVByb3BlcnR5X2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICBpZiAoa2V5IGluIG9iaikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQuanNcblxuZnVuY3Rpb24gb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh0YXJnZXQpIHtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBPYmplY3QoYXJndW1lbnRzW2ldKSA6IHt9O1xuICAgIHZhciBvd25LZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTtcblxuICAgIGlmICh0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICBvd25LZXlzID0gb3duS2V5cy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2UpLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwgc3ltKS5lbnVtZXJhYmxlO1xuICAgICAgfSkpO1xuICAgIH1cblxuICAgIG93bktleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBkZWZpbmVQcm9wZXJ0eV9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrLmpzXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7XG4gIH1cbn1cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzLmpzXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO1xuICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtcbiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICB9XG59XG5cbmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtcbiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7XG4gIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcbiAgcmV0dXJuIENvbnN0cnVjdG9yO1xufVxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZi5qc1xudmFyIGhlbHBlcnNfdHlwZW9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOSk7XG52YXIgdHlwZW9mX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGhlbHBlcnNfdHlwZW9mKTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXNzZXJ0VGhpc0luaXRpYWxpemVkLmpzXG5mdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtcbiAgaWYgKHNlbGYgPT09IHZvaWQgMCkge1xuICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuXCd0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc25cJ3QgYmVlbiBjYWxsZWQiKTtcbiAgfVxuXG4gIHJldHVybiBzZWxmO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcG9zc2libGVDb25zdHJ1Y3RvclJldHVybi5qc1xuXG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtcbiAgaWYgKGNhbGwgJiYgKHR5cGVvZl9kZWZhdWx0KCkoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge1xuICAgIHJldHVybiBjYWxsO1xuICB9XG5cbiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7XG59XG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9nZXRQcm90b3R5cGVPZi5qc1xuZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtcbiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtcbiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO1xuICB9O1xuICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO1xufVxuLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zZXRQcm90b3R5cGVPZi5qc1xudmFyIHNldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMik7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzLmpzXG5cbmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge1xuICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7XG4gIH1cblxuICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHtcbiAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgdmFsdWU6IHN1YkNsYXNzLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9XG4gIH0pO1xuICBpZiAoc3VwZXJDbGFzcykgT2JqZWN0KHNldFByb3RvdHlwZU9mWyJhIiAvKiBkZWZhdWx0ICovXSkoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO1xufVxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvaTE4bmV4dC9kaXN0L2VzbS9pMThuZXh0LmpzXG5cblxuXG5cblxuXG5cblxuXG52YXIgY29uc29sZUxvZ2dlciA9IHtcbiAgdHlwZTogXCdsb2dnZXJcJyxcbiAgbG9nOiBmdW5jdGlvbiBsb2coYXJncykge1xuICAgIHRoaXMub3V0cHV0KFwnbG9nXCcsIGFyZ3MpO1xuICB9LFxuICB3YXJuOiBmdW5jdGlvbiB3YXJuKGFyZ3MpIHtcbiAgICB0aGlzLm91dHB1dChcJ3dhcm5cJywgYXJncyk7XG4gIH0sXG4gIGVycm9yOiBmdW5jdGlvbiBlcnJvcihhcmdzKSB7XG4gICAgdGhpcy5vdXRwdXQoXCdlcnJvclwnLCBhcmdzKTtcbiAgfSxcbiAgb3V0cHV0OiBmdW5jdGlvbiBvdXRwdXQodHlwZSwgYXJncykge1xuICAgIGlmIChjb25zb2xlICYmIGNvbnNvbGVbdHlwZV0pIGNvbnNvbGVbdHlwZV0uYXBwbHkoY29uc29sZSwgYXJncyk7XG4gIH1cbn07XG5cbnZhciBpMThuZXh0X0xvZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTG9nZ2VyKGNvbmNyZXRlTG9nZ2VyKSB7XG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuXG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExvZ2dlcik7XG5cbiAgICB0aGlzLmluaXQoY29uY3JldGVMb2dnZXIsIG9wdGlvbnMpO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKExvZ2dlciwgW3tcbiAgICBrZXk6ICJpbml0IixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdChjb25jcmV0ZUxvZ2dlcikge1xuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuICAgICAgdGhpcy5wcmVmaXggPSBvcHRpb25zLnByZWZpeCB8fCBcJ2kxOG5leHQ6XCc7XG4gICAgICB0aGlzLmxvZ2dlciA9IGNvbmNyZXRlTG9nZ2VyIHx8IGNvbnNvbGVMb2dnZXI7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgdGhpcy5kZWJ1ZyA9IG9wdGlvbnMuZGVidWc7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAic2V0RGVidWciLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZXREZWJ1Zyhib29sKSB7XG4gICAgICB0aGlzLmRlYnVnID0gYm9vbDtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJsb2ciLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBsb2coKSB7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZm9yd2FyZChhcmdzLCBcJ2xvZ1wnLCBcJ1wnLCB0cnVlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJ3YXJuIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gd2FybigpIHtcbiAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xuICAgICAgICBhcmdzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmZvcndhcmQoYXJncywgXCd3YXJuXCcsIFwnXCcsIHRydWUpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImVycm9yIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZXJyb3IoKSB7XG4gICAgICBmb3IgKHZhciBfbGVuMyA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjMpLCBfa2V5MyA9IDA7IF9rZXkzIDwgX2xlbjM7IF9rZXkzKyspIHtcbiAgICAgICAgYXJnc1tfa2V5M10gPSBhcmd1bWVudHNbX2tleTNdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5mb3J3YXJkKGFyZ3MsIFwnZXJyb3JcJywgXCdcJyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZGVwcmVjYXRlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVwcmVjYXRlKCkge1xuICAgICAgZm9yICh2YXIgX2xlbjQgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW40KSwgX2tleTQgPSAwOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7XG4gICAgICAgIGFyZ3NbX2tleTRdID0gYXJndW1lbnRzW19rZXk0XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZm9yd2FyZChhcmdzLCBcJ3dhcm5cJywgXCdXQVJOSU5HIERFUFJFQ0FURUQ6IFwnLCB0cnVlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJmb3J3YXJkIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZm9yd2FyZChhcmdzLCBsdmwsIHByZWZpeCwgZGVidWdPbmx5KSB7XG4gICAgICBpZiAoZGVidWdPbmx5ICYmICF0aGlzLmRlYnVnKSByZXR1cm4gbnVsbDtcbiAgICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gXCdzdHJpbmdcJykgYXJnc1swXSA9ICIiLmNvbmNhdChwcmVmaXgpLmNvbmNhdCh0aGlzLnByZWZpeCwgIiAiKS5jb25jYXQoYXJnc1swXSk7XG4gICAgICByZXR1cm4gdGhpcy5sb2dnZXJbbHZsXShhcmdzKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJjcmVhdGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUobW9kdWxlTmFtZSkge1xuICAgICAgcmV0dXJuIG5ldyBMb2dnZXIodGhpcy5sb2dnZXIsIG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIHtcbiAgICAgICAgcHJlZml4OiAiIi5jb25jYXQodGhpcy5wcmVmaXgsICI6IikuY29uY2F0KG1vZHVsZU5hbWUsICI6IilcbiAgICAgIH0sIHRoaXMub3B0aW9ucykpO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBMb2dnZXI7XG59KCk7XG5cbnZhciBiYXNlTG9nZ2VyID0gbmV3IGkxOG5leHRfTG9nZ2VyKCk7XG5cbnZhciBpMThuZXh0X0V2ZW50RW1pdHRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFdmVudEVtaXR0ZXIpO1xuXG4gICAgdGhpcy5vYnNlcnZlcnMgPSB7fTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhFdmVudEVtaXR0ZXIsIFt7XG4gICAga2V5OiAib24iLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBvbihldmVudHMsIGxpc3RlbmVyKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICBldmVudHMuc3BsaXQoXCcgXCcpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIF90aGlzLm9ic2VydmVyc1tldmVudF0gPSBfdGhpcy5vYnNlcnZlcnNbZXZlbnRdIHx8IFtdO1xuXG4gICAgICAgIF90aGlzLm9ic2VydmVyc1tldmVudF0ucHVzaChsaXN0ZW5lcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogIm9mZiIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG9mZihldmVudCwgbGlzdGVuZXIpIHtcbiAgICAgIGlmICghdGhpcy5vYnNlcnZlcnNbZXZlbnRdKSByZXR1cm47XG5cbiAgICAgIGlmICghbGlzdGVuZXIpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2V2ZW50XTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm9ic2VydmVyc1tldmVudF0gPSB0aGlzLm9ic2VydmVyc1tldmVudF0uZmlsdGVyKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgIHJldHVybiBsICE9PSBsaXN0ZW5lcjtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImVtaXQiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBlbWl0KGV2ZW50KSB7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vYnNlcnZlcnNbZXZlbnRdKSB7XG4gICAgICAgIHZhciBjbG9uZWQgPSBbXS5jb25jYXQodGhpcy5vYnNlcnZlcnNbZXZlbnRdKTtcbiAgICAgICAgY2xvbmVkLmZvckVhY2goZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgb2JzZXJ2ZXIuYXBwbHkodm9pZCAwLCBhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9ic2VydmVyc1tcJypcJ10pIHtcbiAgICAgICAgdmFyIF9jbG9uZWQgPSBbXS5jb25jYXQodGhpcy5vYnNlcnZlcnNbXCcqXCddKTtcblxuICAgICAgICBfY2xvbmVkLmZvckVhY2goZnVuY3Rpb24gKG9ic2VydmVyKSB7XG4gICAgICAgICAgb2JzZXJ2ZXIuYXBwbHkob2JzZXJ2ZXIsIFtldmVudF0uY29uY2F0KGFyZ3MpKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEV2ZW50RW1pdHRlcjtcbn0oKTtcblxuZnVuY3Rpb24gZGVmZXIoKSB7XG4gIHZhciByZXM7XG4gIHZhciByZWo7XG4gIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgIHJlcyA9IHJlc29sdmU7XG4gICAgcmVqID0gcmVqZWN0O1xuICB9KTtcbiAgcHJvbWlzZS5yZXNvbHZlID0gcmVzO1xuICBwcm9taXNlLnJlamVjdCA9IHJlajtcbiAgcmV0dXJuIHByb21pc2U7XG59XG5mdW5jdGlvbiBtYWtlU3RyaW5nKG9iamVjdCkge1xuICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiBcJ1wnO1xuICByZXR1cm4gXCdcJyArIG9iamVjdDtcbn1cbmZ1bmN0aW9uIGkxOG5leHRfY29weShhLCBzLCB0KSB7XG4gIGEuZm9yRWFjaChmdW5jdGlvbiAobSkge1xuICAgIGlmIChzW21dKSB0W21dID0gc1ttXTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldExhc3RPZlBhdGgob2JqZWN0LCBwYXRoLCBFbXB0eSkge1xuICBmdW5jdGlvbiBjbGVhbktleShrZXkpIHtcbiAgICByZXR1cm4ga2V5ICYmIGtleS5pbmRleE9mKFwnIyMjXCcpID4gLTEgPyBrZXkucmVwbGFjZSgvIyMjL2csIFwnLlwnKSA6IGtleTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbk5vdFRyYXZlcnNlRGVlcGVyKCkge1xuICAgIHJldHVybiAhb2JqZWN0IHx8IHR5cGVvZiBvYmplY3QgPT09IFwnc3RyaW5nXCc7XG4gIH1cblxuICB2YXIgc3RhY2sgPSB0eXBlb2YgcGF0aCAhPT0gXCdzdHJpbmdcJyA/IFtdLmNvbmNhdChwYXRoKSA6IHBhdGguc3BsaXQoXCcuXCcpO1xuXG4gIHdoaWxlIChzdGFjay5sZW5ndGggPiAxKSB7XG4gICAgaWYgKGNhbk5vdFRyYXZlcnNlRGVlcGVyKCkpIHJldHVybiB7fTtcbiAgICB2YXIga2V5ID0gY2xlYW5LZXkoc3RhY2suc2hpZnQoKSk7XG4gICAgaWYgKCFvYmplY3Rba2V5XSAmJiBFbXB0eSkgb2JqZWN0W2tleV0gPSBuZXcgRW1wdHkoKTtcblxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKSB7XG4gICAgICBvYmplY3QgPSBvYmplY3Rba2V5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqZWN0ID0ge307XG4gICAgfVxuICB9XG5cbiAgaWYgKGNhbk5vdFRyYXZlcnNlRGVlcGVyKCkpIHJldHVybiB7fTtcbiAgcmV0dXJuIHtcbiAgICBvYmo6IG9iamVjdCxcbiAgICBrOiBjbGVhbktleShzdGFjay5zaGlmdCgpKVxuICB9O1xufVxuXG5mdW5jdGlvbiBzZXRQYXRoKG9iamVjdCwgcGF0aCwgbmV3VmFsdWUpIHtcbiAgdmFyIF9nZXRMYXN0T2ZQYXRoID0gZ2V0TGFzdE9mUGF0aChvYmplY3QsIHBhdGgsIE9iamVjdCksXG4gICAgICBvYmogPSBfZ2V0TGFzdE9mUGF0aC5vYmosXG4gICAgICBrID0gX2dldExhc3RPZlBhdGguaztcblxuICBvYmpba10gPSBuZXdWYWx1ZTtcbn1cbmZ1bmN0aW9uIHB1c2hQYXRoKG9iamVjdCwgcGF0aCwgbmV3VmFsdWUsIGNvbmNhdCkge1xuICB2YXIgX2dldExhc3RPZlBhdGgyID0gZ2V0TGFzdE9mUGF0aChvYmplY3QsIHBhdGgsIE9iamVjdCksXG4gICAgICBvYmogPSBfZ2V0TGFzdE9mUGF0aDIub2JqLFxuICAgICAgayA9IF9nZXRMYXN0T2ZQYXRoMi5rO1xuXG4gIG9ialtrXSA9IG9ialtrXSB8fCBbXTtcbiAgaWYgKGNvbmNhdCkgb2JqW2tdID0gb2JqW2tdLmNvbmNhdChuZXdWYWx1ZSk7XG4gIGlmICghY29uY2F0KSBvYmpba10ucHVzaChuZXdWYWx1ZSk7XG59XG5mdW5jdGlvbiBnZXRQYXRoKG9iamVjdCwgcGF0aCkge1xuICB2YXIgX2dldExhc3RPZlBhdGgzID0gZ2V0TGFzdE9mUGF0aChvYmplY3QsIHBhdGgpLFxuICAgICAgb2JqID0gX2dldExhc3RPZlBhdGgzLm9iaixcbiAgICAgIGsgPSBfZ2V0TGFzdE9mUGF0aDMuaztcblxuICBpZiAoIW9iaikgcmV0dXJuIHVuZGVmaW5lZDtcbiAgcmV0dXJuIG9ialtrXTtcbn1cbmZ1bmN0aW9uIGdldFBhdGhXaXRoRGVmYXVsdHMoZGF0YSwgZGVmYXVsdERhdGEsIGtleSkge1xuICB2YXIgdmFsdWUgPSBnZXRQYXRoKGRhdGEsIGtleSk7XG5cbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gZ2V0UGF0aChkZWZhdWx0RGF0YSwga2V5KTtcbn1cbmZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0LCBzb3VyY2UsIG92ZXJ3cml0ZSkge1xuICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkge1xuICAgIGlmIChwcm9wICE9PSBcJ19fcHJvdG9fX1wnICYmIHByb3AgIT09IFwnY29uc3RydWN0b3JcJykge1xuICAgICAgaWYgKHByb3AgaW4gdGFyZ2V0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGFyZ2V0W3Byb3BdID09PSBcJ3N0cmluZ1wnIHx8IHRhcmdldFtwcm9wXSBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2Ygc291cmNlW3Byb3BdID09PSBcJ3N0cmluZ1wnIHx8IHNvdXJjZVtwcm9wXSBpbnN0YW5jZW9mIFN0cmluZykge1xuICAgICAgICAgIGlmIChvdmVyd3JpdGUpIHRhcmdldFtwcm9wXSA9IHNvdXJjZVtwcm9wXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWVwRXh0ZW5kKHRhcmdldFtwcm9wXSwgc291cmNlW3Byb3BdLCBvdmVyd3JpdGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXRbcHJvcF0gPSBzb3VyY2VbcHJvcF07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRhcmdldDtcbn1cbmZ1bmN0aW9uIHJlZ2V4RXNjYXBlKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcXC1cXFtcXF1cXC9cXHtcXH1cXChcXClcXCpcXCtcXD9cXC5cXFxcXFxeXFwkXFx8XS9nLCBcJ1xcXFwkJlwnKTtcbn1cbnZhciBfZW50aXR5TWFwID0ge1xuICBcJyZcJzogXCcmYW1wO1wnLFxuICBcJzxcJzogXCcmbHQ7XCcsXG4gIFwnPlwnOiBcJyZndDtcJyxcbiAgXCciXCc6IFwnJnF1b3Q7XCcsXG4gICJcJyI6IFwnJiMzOTtcJyxcbiAgXCcvXCc6IFwnJiN4MkY7XCdcbn07XG5mdW5jdGlvbiBpMThuZXh0X2VzY2FwZShkYXRhKSB7XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gXCdzdHJpbmdcJykge1xuICAgIHJldHVybiBkYXRhLnJlcGxhY2UoL1smPD4iXCdcXC9dL2csIGZ1bmN0aW9uIChzKSB7XG4gICAgICByZXR1cm4gX2VudGl0eU1hcFtzXTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBkYXRhO1xufVxudmFyIGlzSUUxMCA9IHR5cGVvZiB3aW5kb3cgIT09IFwndW5kZWZpbmVkXCcgJiYgd2luZG93Lm5hdmlnYXRvciAmJiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCAmJiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwnTVNJRVwnKSA+IC0xO1xuXG52YXIgaTE4bmV4dF9SZXNvdXJjZVN0b3JlID0gZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHtcbiAgX2luaGVyaXRzKFJlc291cmNlU3RvcmUsIF9FdmVudEVtaXR0ZXIpO1xuXG4gIGZ1bmN0aW9uIFJlc291cmNlU3RvcmUoZGF0YSkge1xuICAgIHZhciBfdGhpcztcblxuICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7XG4gICAgICBuczogW1wndHJhbnNsYXRpb25cJ10sXG4gICAgICBkZWZhdWx0TlM6IFwndHJhbnNsYXRpb25cJ1xuICAgIH07XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVzb3VyY2VTdG9yZSk7XG5cbiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihSZXNvdXJjZVN0b3JlKS5jYWxsKHRoaXMpKTtcblxuICAgIGlmIChpc0lFMTApIHtcbiAgICAgIGkxOG5leHRfRXZlbnRFbWl0dGVyLmNhbGwoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpO1xuICAgIH1cblxuICAgIF90aGlzLmRhdGEgPSBkYXRhIHx8IHt9O1xuICAgIF90aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgaWYgKF90aGlzLm9wdGlvbnMua2V5U2VwYXJhdG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgIF90aGlzLm9wdGlvbnMua2V5U2VwYXJhdG9yID0gXCcuXCc7XG4gICAgfVxuXG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKFJlc291cmNlU3RvcmUsIFt7XG4gICAga2V5OiAiYWRkTmFtZXNwYWNlcyIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZE5hbWVzcGFjZXMobnMpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMubnMuaW5kZXhPZihucykgPCAwKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5ucy5wdXNoKG5zKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJyZW1vdmVOYW1lc3BhY2VzIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTmFtZXNwYWNlcyhucykge1xuICAgICAgdmFyIGluZGV4ID0gdGhpcy5vcHRpb25zLm5zLmluZGV4T2YobnMpO1xuXG4gICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMubnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJnZXRSZXNvdXJjZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldFJlc291cmNlKGxuZywgbnMsIGtleSkge1xuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IHt9O1xuICAgICAgdmFyIGtleVNlcGFyYXRvciA9IG9wdGlvbnMua2V5U2VwYXJhdG9yICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmtleVNlcGFyYXRvciA6IHRoaXMub3B0aW9ucy5rZXlTZXBhcmF0b3I7XG4gICAgICB2YXIgcGF0aCA9IFtsbmcsIG5zXTtcbiAgICAgIGlmIChrZXkgJiYgdHlwZW9mIGtleSAhPT0gXCdzdHJpbmdcJykgcGF0aCA9IHBhdGguY29uY2F0KGtleSk7XG4gICAgICBpZiAoa2V5ICYmIHR5cGVvZiBrZXkgPT09IFwnc3RyaW5nXCcpIHBhdGggPSBwYXRoLmNvbmNhdChrZXlTZXBhcmF0b3IgPyBrZXkuc3BsaXQoa2V5U2VwYXJhdG9yKSA6IGtleSk7XG5cbiAgICAgIGlmIChsbmcuaW5kZXhPZihcJy5cJykgPiAtMSkge1xuICAgICAgICBwYXRoID0gbG5nLnNwbGl0KFwnLlwnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGdldFBhdGgodGhpcy5kYXRhLCBwYXRoKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJhZGRSZXNvdXJjZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFJlc291cmNlKGxuZywgbnMsIGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiB7XG4gICAgICAgIHNpbGVudDogZmFsc2VcbiAgICAgIH07XG4gICAgICB2YXIga2V5U2VwYXJhdG9yID0gdGhpcy5vcHRpb25zLmtleVNlcGFyYXRvcjtcbiAgICAgIGlmIChrZXlTZXBhcmF0b3IgPT09IHVuZGVmaW5lZCkga2V5U2VwYXJhdG9yID0gXCcuXCc7XG4gICAgICB2YXIgcGF0aCA9IFtsbmcsIG5zXTtcbiAgICAgIGlmIChrZXkpIHBhdGggPSBwYXRoLmNvbmNhdChrZXlTZXBhcmF0b3IgPyBrZXkuc3BsaXQoa2V5U2VwYXJhdG9yKSA6IGtleSk7XG5cbiAgICAgIGlmIChsbmcuaW5kZXhPZihcJy5cJykgPiAtMSkge1xuICAgICAgICBwYXRoID0gbG5nLnNwbGl0KFwnLlwnKTtcbiAgICAgICAgdmFsdWUgPSBucztcbiAgICAgICAgbnMgPSBwYXRoWzFdO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmFkZE5hbWVzcGFjZXMobnMpO1xuICAgICAgc2V0UGF0aCh0aGlzLmRhdGEsIHBhdGgsIHZhbHVlKTtcbiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMuZW1pdChcJ2FkZGVkXCcsIGxuZywgbnMsIGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImFkZFJlc291cmNlcyIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFJlc291cmNlcyhsbmcsIG5zLCByZXNvdXJjZXMpIHtcbiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiB7XG4gICAgICAgIHNpbGVudDogZmFsc2VcbiAgICAgIH07XG5cbiAgICAgIGZvciAodmFyIG0gaW4gcmVzb3VyY2VzKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzb3VyY2VzW21dID09PSBcJ3N0cmluZ1wnIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkocmVzb3VyY2VzW21dKSA9PT0gXCdbb2JqZWN0IEFycmF5XVwnKSB0aGlzLmFkZFJlc291cmNlKGxuZywgbnMsIG0sIHJlc291cmNlc1ttXSwge1xuICAgICAgICAgIHNpbGVudDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgdGhpcy5lbWl0KFwnYWRkZWRcJywgbG5nLCBucywgcmVzb3VyY2VzKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJhZGRSZXNvdXJjZUJ1bmRsZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFJlc291cmNlQnVuZGxlKGxuZywgbnMsIHJlc291cmNlcywgZGVlcCwgb3ZlcndyaXRlKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzVdIDoge1xuICAgICAgICBzaWxlbnQ6IGZhbHNlXG4gICAgICB9O1xuICAgICAgdmFyIHBhdGggPSBbbG5nLCBuc107XG5cbiAgICAgIGlmIChsbmcuaW5kZXhPZihcJy5cJykgPiAtMSkge1xuICAgICAgICBwYXRoID0gbG5nLnNwbGl0KFwnLlwnKTtcbiAgICAgICAgZGVlcCA9IHJlc291cmNlcztcbiAgICAgICAgcmVzb3VyY2VzID0gbnM7XG4gICAgICAgIG5zID0gcGF0aFsxXTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5hZGROYW1lc3BhY2VzKG5zKTtcbiAgICAgIHZhciBwYWNrID0gZ2V0UGF0aCh0aGlzLmRhdGEsIHBhdGgpIHx8IHt9O1xuXG4gICAgICBpZiAoZGVlcCkge1xuICAgICAgICBkZWVwRXh0ZW5kKHBhY2ssIHJlc291cmNlcywgb3ZlcndyaXRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhY2sgPSBvYmplY3RTcHJlYWRfb2JqZWN0U3ByZWFkKHt9LCBwYWNrLCByZXNvdXJjZXMpO1xuICAgICAgfVxuXG4gICAgICBzZXRQYXRoKHRoaXMuZGF0YSwgcGF0aCwgcGFjayk7XG4gICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLmVtaXQoXCdhZGRlZFwnLCBsbmcsIG5zLCByZXNvdXJjZXMpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInJlbW92ZVJlc291cmNlQnVuZGxlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlUmVzb3VyY2VCdW5kbGUobG5nLCBucykge1xuICAgICAgaWYgKHRoaXMuaGFzUmVzb3VyY2VCdW5kbGUobG5nLCBucykpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuZGF0YVtsbmddW25zXTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZW1vdmVOYW1lc3BhY2VzKG5zKTtcbiAgICAgIHRoaXMuZW1pdChcJ3JlbW92ZWRcJywgbG5nLCBucyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiaGFzUmVzb3VyY2VCdW5kbGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNSZXNvdXJjZUJ1bmRsZShsbmcsIG5zKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRSZXNvdXJjZShsbmcsIG5zKSAhPT0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImdldFJlc291cmNlQnVuZGxlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UmVzb3VyY2VCdW5kbGUobG5nLCBucykge1xuICAgICAgaWYgKCFucykgbnMgPSB0aGlzLm9wdGlvbnMuZGVmYXVsdE5TO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21wYXRpYmlsaXR5QVBJID09PSBcJ3YxXCcpIHJldHVybiBvYmplY3RTcHJlYWRfb2JqZWN0U3ByZWFkKHt9LCB7fSwgdGhpcy5nZXRSZXNvdXJjZShsbmcsIG5zKSk7XG4gICAgICByZXR1cm4gdGhpcy5nZXRSZXNvdXJjZShsbmcsIG5zKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJnZXREYXRhQnlMYW5ndWFnZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldERhdGFCeUxhbmd1YWdlKGxuZykge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0YVtsbmddO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInRvSlNPTiIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgIHJldHVybiB0aGlzLmRhdGE7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFJlc291cmNlU3RvcmU7XG59KGkxOG5leHRfRXZlbnRFbWl0dGVyKTtcblxudmFyIHBvc3RQcm9jZXNzb3IgPSB7XG4gIHByb2Nlc3NvcnM6IHt9LFxuICBhZGRQb3N0UHJvY2Vzc29yOiBmdW5jdGlvbiBhZGRQb3N0UHJvY2Vzc29yKG1vZHVsZSkge1xuICAgIHRoaXMucHJvY2Vzc29yc1ttb2R1bGUubmFtZV0gPSBtb2R1bGU7XG4gIH0sXG4gIGhhbmRsZTogZnVuY3Rpb24gaGFuZGxlKHByb2Nlc3NvcnMsIHZhbHVlLCBrZXksIG9wdGlvbnMsIHRyYW5zbGF0b3IpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgcHJvY2Vzc29ycy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9jZXNzb3IpIHtcbiAgICAgIGlmIChfdGhpcy5wcm9jZXNzb3JzW3Byb2Nlc3Nvcl0pIHZhbHVlID0gX3RoaXMucHJvY2Vzc29yc1twcm9jZXNzb3JdLnByb2Nlc3ModmFsdWUsIGtleSwgb3B0aW9ucywgdHJhbnNsYXRvcik7XG4gICAgfSk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59O1xuXG52YXIgY2hlY2tlZExvYWRlZEZvciA9IHt9O1xuXG52YXIgaTE4bmV4dF9UcmFuc2xhdG9yID0gZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHtcbiAgX2luaGVyaXRzKFRyYW5zbGF0b3IsIF9FdmVudEVtaXR0ZXIpO1xuXG4gIGZ1bmN0aW9uIFRyYW5zbGF0b3Ioc2VydmljZXMpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHJhbnNsYXRvcik7XG5cbiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihUcmFuc2xhdG9yKS5jYWxsKHRoaXMpKTtcblxuICAgIGlmIChpc0lFMTApIHtcbiAgICAgIGkxOG5leHRfRXZlbnRFbWl0dGVyLmNhbGwoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpO1xuICAgIH1cblxuICAgIGkxOG5leHRfY29weShbXCdyZXNvdXJjZVN0b3JlXCcsIFwnbGFuZ3VhZ2VVdGlsc1wnLCBcJ3BsdXJhbFJlc29sdmVyXCcsIFwnaW50ZXJwb2xhdG9yXCcsIFwnYmFja2VuZENvbm5lY3RvclwnLCBcJ2kxOG5Gb3JtYXRcJywgXCd1dGlsc1wnXSwgc2VydmljZXMsIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTtcbiAgICBfdGhpcy5vcHRpb25zID0gb3B0aW9ucztcblxuICAgIGlmIChfdGhpcy5vcHRpb25zLmtleVNlcGFyYXRvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBfdGhpcy5vcHRpb25zLmtleVNlcGFyYXRvciA9IFwnLlwnO1xuICAgIH1cblxuICAgIF90aGlzLmxvZ2dlciA9IGJhc2VMb2dnZXIuY3JlYXRlKFwndHJhbnNsYXRvclwnKTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoVHJhbnNsYXRvciwgW3tcbiAgICBrZXk6ICJjaGFuZ2VMYW5ndWFnZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUxhbmd1YWdlKGxuZykge1xuICAgICAgaWYgKGxuZykgdGhpcy5sYW5ndWFnZSA9IGxuZztcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJleGlzdHMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBleGlzdHMoa2V5KSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge1xuICAgICAgICBpbnRlcnBvbGF0aW9uOiB7fVxuICAgICAgfTtcbiAgICAgIHZhciByZXNvbHZlZCA9IHRoaXMucmVzb2x2ZShrZXksIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIHJlc29sdmVkICYmIHJlc29sdmVkLnJlcyAhPT0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImV4dHJhY3RGcm9tS2V5IixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZXh0cmFjdEZyb21LZXkoa2V5LCBvcHRpb25zKSB7XG4gICAgICB2YXIgbnNTZXBhcmF0b3IgPSBvcHRpb25zLm5zU2VwYXJhdG9yICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm5zU2VwYXJhdG9yIDogdGhpcy5vcHRpb25zLm5zU2VwYXJhdG9yO1xuICAgICAgaWYgKG5zU2VwYXJhdG9yID09PSB1bmRlZmluZWQpIG5zU2VwYXJhdG9yID0gXCc6XCc7XG4gICAgICB2YXIga2V5U2VwYXJhdG9yID0gb3B0aW9ucy5rZXlTZXBhcmF0b3IgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMua2V5U2VwYXJhdG9yIDogdGhpcy5vcHRpb25zLmtleVNlcGFyYXRvcjtcbiAgICAgIHZhciBuYW1lc3BhY2VzID0gb3B0aW9ucy5ucyB8fCB0aGlzLm9wdGlvbnMuZGVmYXVsdE5TO1xuXG4gICAgICBpZiAobnNTZXBhcmF0b3IgJiYga2V5LmluZGV4T2YobnNTZXBhcmF0b3IpID4gLTEpIHtcbiAgICAgICAgdmFyIG0gPSBrZXkubWF0Y2godGhpcy5pbnRlcnBvbGF0b3IubmVzdGluZ1JlZ2V4cCk7XG5cbiAgICAgICAgaWYgKG0gJiYgbS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgICAgbmFtZXNwYWNlczogbmFtZXNwYWNlc1xuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGFydHMgPSBrZXkuc3BsaXQobnNTZXBhcmF0b3IpO1xuICAgICAgICBpZiAobnNTZXBhcmF0b3IgIT09IGtleVNlcGFyYXRvciB8fCBuc1NlcGFyYXRvciA9PT0ga2V5U2VwYXJhdG9yICYmIHRoaXMub3B0aW9ucy5ucy5pbmRleE9mKHBhcnRzWzBdKSA+IC0xKSBuYW1lc3BhY2VzID0gcGFydHMuc2hpZnQoKTtcbiAgICAgICAga2V5ID0gcGFydHMuam9pbihrZXlTZXBhcmF0b3IpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIG5hbWVzcGFjZXMgPT09IFwnc3RyaW5nXCcpIG5hbWVzcGFjZXMgPSBbbmFtZXNwYWNlc107XG4gICAgICByZXR1cm4ge1xuICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgbmFtZXNwYWNlczogbmFtZXNwYWNlc1xuICAgICAgfTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJ0cmFuc2xhdGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2xhdGUoa2V5cywgb3B0aW9ucywgbGFzdEtleSkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIGlmIChfdHlwZW9mKG9wdGlvbnMpICE9PSBcJ29iamVjdFwnICYmIHRoaXMub3B0aW9ucy5vdmVybG9hZFRyYW5zbGF0aW9uT3B0aW9uSGFuZGxlcikge1xuICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLm92ZXJsb2FkVHJhbnNsYXRpb25PcHRpb25IYW5kbGVyKGFyZ3VtZW50cyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xuICAgICAgaWYgKGtleXMgPT09IHVuZGVmaW5lZCB8fCBrZXlzID09PSBudWxsKSByZXR1cm4gXCdcJztcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShrZXlzKSkga2V5cyA9IFtTdHJpbmcoa2V5cyldO1xuICAgICAgdmFyIGtleVNlcGFyYXRvciA9IG9wdGlvbnMua2V5U2VwYXJhdG9yICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmtleVNlcGFyYXRvciA6IHRoaXMub3B0aW9ucy5rZXlTZXBhcmF0b3I7XG5cbiAgICAgIHZhciBfdGhpcyRleHRyYWN0RnJvbUtleSA9IHRoaXMuZXh0cmFjdEZyb21LZXkoa2V5c1trZXlzLmxlbmd0aCAtIDFdLCBvcHRpb25zKSxcbiAgICAgICAgICBrZXkgPSBfdGhpcyRleHRyYWN0RnJvbUtleS5rZXksXG4gICAgICAgICAgbmFtZXNwYWNlcyA9IF90aGlzJGV4dHJhY3RGcm9tS2V5Lm5hbWVzcGFjZXM7XG5cbiAgICAgIHZhciBuYW1lc3BhY2UgPSBuYW1lc3BhY2VzW25hbWVzcGFjZXMubGVuZ3RoIC0gMV07XG4gICAgICB2YXIgbG5nID0gb3B0aW9ucy5sbmcgfHwgdGhpcy5sYW5ndWFnZTtcbiAgICAgIHZhciBhcHBlbmROYW1lc3BhY2VUb0NJTW9kZSA9IG9wdGlvbnMuYXBwZW5kTmFtZXNwYWNlVG9DSU1vZGUgfHwgdGhpcy5vcHRpb25zLmFwcGVuZE5hbWVzcGFjZVRvQ0lNb2RlO1xuXG4gICAgICBpZiAobG5nICYmIGxuZy50b0xvd2VyQ2FzZSgpID09PSBcJ2NpbW9kZVwnKSB7XG4gICAgICAgIGlmIChhcHBlbmROYW1lc3BhY2VUb0NJTW9kZSkge1xuICAgICAgICAgIHZhciBuc1NlcGFyYXRvciA9IG9wdGlvbnMubnNTZXBhcmF0b3IgfHwgdGhpcy5vcHRpb25zLm5zU2VwYXJhdG9yO1xuICAgICAgICAgIHJldHVybiBuYW1lc3BhY2UgKyBuc1NlcGFyYXRvciArIGtleTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBrZXk7XG4gICAgICB9XG5cbiAgICAgIHZhciByZXNvbHZlZCA9IHRoaXMucmVzb2x2ZShrZXlzLCBvcHRpb25zKTtcbiAgICAgIHZhciByZXMgPSByZXNvbHZlZCAmJiByZXNvbHZlZC5yZXM7XG4gICAgICB2YXIgcmVzVXNlZEtleSA9IHJlc29sdmVkICYmIHJlc29sdmVkLnVzZWRLZXkgfHwga2V5O1xuICAgICAgdmFyIHJlc0V4YWN0VXNlZEtleSA9IHJlc29sdmVkICYmIHJlc29sdmVkLmV4YWN0VXNlZEtleSB8fCBrZXk7XG4gICAgICB2YXIgcmVzVHlwZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkocmVzKTtcbiAgICAgIHZhciBub09iamVjdCA9IFtcJ1tvYmplY3QgTnVtYmVyXVwnLCBcJ1tvYmplY3QgRnVuY3Rpb25dXCcsIFwnW29iamVjdCBSZWdFeHBdXCddO1xuICAgICAgdmFyIGpvaW5BcnJheXMgPSBvcHRpb25zLmpvaW5BcnJheXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuam9pbkFycmF5cyA6IHRoaXMub3B0aW9ucy5qb2luQXJyYXlzO1xuICAgICAgdmFyIGhhbmRsZUFzT2JqZWN0SW5JMThuRm9ybWF0ID0gIXRoaXMuaTE4bkZvcm1hdCB8fCB0aGlzLmkxOG5Gb3JtYXQuaGFuZGxlQXNPYmplY3Q7XG4gICAgICB2YXIgaGFuZGxlQXNPYmplY3QgPSB0eXBlb2YgcmVzICE9PSBcJ3N0cmluZ1wnICYmIHR5cGVvZiByZXMgIT09IFwnYm9vbGVhblwnICYmIHR5cGVvZiByZXMgIT09IFwnbnVtYmVyXCc7XG5cbiAgICAgIGlmIChoYW5kbGVBc09iamVjdEluSTE4bkZvcm1hdCAmJiByZXMgJiYgaGFuZGxlQXNPYmplY3QgJiYgbm9PYmplY3QuaW5kZXhPZihyZXNUeXBlKSA8IDAgJiYgISh0eXBlb2Ygam9pbkFycmF5cyA9PT0gXCdzdHJpbmdcJyAmJiByZXNUeXBlID09PSBcJ1tvYmplY3QgQXJyYXldXCcpKSB7XG4gICAgICAgIGlmICghb3B0aW9ucy5yZXR1cm5PYmplY3RzICYmICF0aGlzLm9wdGlvbnMucmV0dXJuT2JqZWN0cykge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXCdhY2Nlc3NpbmcgYW4gb2JqZWN0IC0gYnV0IHJldHVybk9iamVjdHMgb3B0aW9ucyBpcyBub3QgZW5hYmxlZCFcJyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZXR1cm5lZE9iamVjdEhhbmRsZXIgPyB0aGlzLm9wdGlvbnMucmV0dXJuZWRPYmplY3RIYW5kbGVyKHJlc1VzZWRLZXksIHJlcywgb3B0aW9ucykgOiAia2V5IFwnIi5jb25jYXQoa2V5LCAiICgiKS5jb25jYXQodGhpcy5sYW5ndWFnZSwgIilcJyByZXR1cm5lZCBhbiBvYmplY3QgaW5zdGVhZCBvZiBzdHJpbmcuIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoa2V5U2VwYXJhdG9yKSB7XG4gICAgICAgICAgdmFyIHJlc1R5cGVJc0FycmF5ID0gcmVzVHlwZSA9PT0gXCdbb2JqZWN0IEFycmF5XVwnO1xuICAgICAgICAgIHZhciBjb3B5ID0gcmVzVHlwZUlzQXJyYXkgPyBbXSA6IHt9O1xuICAgICAgICAgIHZhciBuZXdLZXlUb1VzZSA9IHJlc1R5cGVJc0FycmF5ID8gcmVzRXhhY3RVc2VkS2V5IDogcmVzVXNlZEtleTtcblxuICAgICAgICAgIGZvciAodmFyIG0gaW4gcmVzKSB7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlcywgbSkpIHtcbiAgICAgICAgICAgICAgdmFyIGRlZXBLZXkgPSAiIi5jb25jYXQobmV3S2V5VG9Vc2UpLmNvbmNhdChrZXlTZXBhcmF0b3IpLmNvbmNhdChtKTtcbiAgICAgICAgICAgICAgY29weVttXSA9IHRoaXMudHJhbnNsYXRlKGRlZXBLZXksIG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIG9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICBqb2luQXJyYXlzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBuczogbmFtZXNwYWNlc1xuICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgIGlmIChjb3B5W21dID09PSBkZWVwS2V5KSBjb3B5W21dID0gcmVzW21dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcyA9IGNvcHk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoaGFuZGxlQXNPYmplY3RJbkkxOG5Gb3JtYXQgJiYgdHlwZW9mIGpvaW5BcnJheXMgPT09IFwnc3RyaW5nXCcgJiYgcmVzVHlwZSA9PT0gXCdbb2JqZWN0IEFycmF5XVwnKSB7XG4gICAgICAgIHJlcyA9IHJlcy5qb2luKGpvaW5BcnJheXMpO1xuICAgICAgICBpZiAocmVzKSByZXMgPSB0aGlzLmV4dGVuZFRyYW5zbGF0aW9uKHJlcywga2V5cywgb3B0aW9ucywgbGFzdEtleSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdXNlZERlZmF1bHQgPSBmYWxzZTtcbiAgICAgICAgdmFyIHVzZWRLZXkgPSBmYWxzZTtcbiAgICAgICAgdmFyIG5lZWRzUGx1cmFsSGFuZGxpbmcgPSBvcHRpb25zLmNvdW50ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG9wdGlvbnMuY291bnQgIT09IFwnc3RyaW5nXCc7XG4gICAgICAgIHZhciBoYXNEZWZhdWx0VmFsdWUgPSBUcmFuc2xhdG9yLmhhc0RlZmF1bHRWYWx1ZShvcHRpb25zKTtcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZVN1ZmZpeCA9IG5lZWRzUGx1cmFsSGFuZGxpbmcgPyB0aGlzLnBsdXJhbFJlc29sdmVyLmdldFN1ZmZpeChsbmcsIG9wdGlvbnMuY291bnQpIDogXCdcJztcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZSA9IG9wdGlvbnNbImRlZmF1bHRWYWx1ZSIuY29uY2F0KGRlZmF1bHRWYWx1ZVN1ZmZpeCldIHx8IG9wdGlvbnMuZGVmYXVsdFZhbHVlO1xuXG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkTG9va3VwKHJlcykgJiYgaGFzRGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgdXNlZERlZmF1bHQgPSB0cnVlO1xuICAgICAgICAgIHJlcyA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkTG9va3VwKHJlcykpIHtcbiAgICAgICAgICB1c2VkS2V5ID0gdHJ1ZTtcbiAgICAgICAgICByZXMgPSBrZXk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdXBkYXRlTWlzc2luZyA9IGhhc0RlZmF1bHRWYWx1ZSAmJiBkZWZhdWx0VmFsdWUgIT09IHJlcyAmJiB0aGlzLm9wdGlvbnMudXBkYXRlTWlzc2luZztcblxuICAgICAgICBpZiAodXNlZEtleSB8fCB1c2VkRGVmYXVsdCB8fCB1cGRhdGVNaXNzaW5nKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIubG9nKHVwZGF0ZU1pc3NpbmcgPyBcJ3VwZGF0ZUtleVwnIDogXCdtaXNzaW5nS2V5XCcsIGxuZywgbmFtZXNwYWNlLCBrZXksIHVwZGF0ZU1pc3NpbmcgPyBkZWZhdWx0VmFsdWUgOiByZXMpO1xuXG4gICAgICAgICAgaWYgKGtleVNlcGFyYXRvcikge1xuICAgICAgICAgICAgdmFyIGZrID0gdGhpcy5yZXNvbHZlKGtleSwgb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh7fSwgb3B0aW9ucywge1xuICAgICAgICAgICAgICBrZXlTZXBhcmF0b3I6IGZhbHNlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBpZiAoZmsgJiYgZmsucmVzKSB0aGlzLmxvZ2dlci53YXJuKFwnU2VlbXMgdGhlIGxvYWRlZCB0cmFuc2xhdGlvbnMgd2VyZSBpbiBmbGF0IEpTT04gZm9ybWF0IGluc3RlYWQgb2YgbmVzdGVkLiBFaXRoZXIgc2V0IGtleVNlcGFyYXRvcjogZmFsc2Ugb24gaW5pdCBvciBtYWtlIHN1cmUgeW91ciB0cmFuc2xhdGlvbnMgYXJlIHB1Ymxpc2hlZCBpbiBuZXN0ZWQgZm9ybWF0LlwnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgbG5ncyA9IFtdO1xuICAgICAgICAgIHZhciBmYWxsYmFja0xuZ3MgPSB0aGlzLmxhbmd1YWdlVXRpbHMuZ2V0RmFsbGJhY2tDb2Rlcyh0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmcsIG9wdGlvbnMubG5nIHx8IHRoaXMubGFuZ3VhZ2UpO1xuXG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYXZlTWlzc2luZ1RvID09PSBcJ2ZhbGxiYWNrXCcgJiYgZmFsbGJhY2tMbmdzICYmIGZhbGxiYWNrTG5nc1swXSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmYWxsYmFja0xuZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgbG5ncy5wdXNoKGZhbGxiYWNrTG5nc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc2F2ZU1pc3NpbmdUbyA9PT0gXCdhbGxcJykge1xuICAgICAgICAgICAgbG5ncyA9IHRoaXMubGFuZ3VhZ2VVdGlscy50b1Jlc29sdmVIaWVyYXJjaHkob3B0aW9ucy5sbmcgfHwgdGhpcy5sYW5ndWFnZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxuZ3MucHVzaChvcHRpb25zLmxuZyB8fCB0aGlzLmxhbmd1YWdlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgc2VuZCA9IGZ1bmN0aW9uIHNlbmQobCwgaywgZmFsbGJhY2tWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKF90aGlzMi5vcHRpb25zLm1pc3NpbmdLZXlIYW5kbGVyKSB7XG4gICAgICAgICAgICAgIF90aGlzMi5vcHRpb25zLm1pc3NpbmdLZXlIYW5kbGVyKGwsIG5hbWVzcGFjZSwgaywgdXBkYXRlTWlzc2luZyA/IGZhbGxiYWNrVmFsdWUgOiByZXMsIHVwZGF0ZU1pc3NpbmcsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYmFja2VuZENvbm5lY3RvciAmJiBfdGhpczIuYmFja2VuZENvbm5lY3Rvci5zYXZlTWlzc2luZykge1xuICAgICAgICAgICAgICBfdGhpczIuYmFja2VuZENvbm5lY3Rvci5zYXZlTWlzc2luZyhsLCBuYW1lc3BhY2UsIGssIHVwZGF0ZU1pc3NpbmcgPyBmYWxsYmFja1ZhbHVlIDogcmVzLCB1cGRhdGVNaXNzaW5nLCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgX3RoaXMyLmVtaXQoXCdtaXNzaW5nS2V5XCcsIGwsIG5hbWVzcGFjZSwgaywgcmVzKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYXZlTWlzc2luZykge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYXZlTWlzc2luZ1BsdXJhbHMgJiYgbmVlZHNQbHVyYWxIYW5kbGluZykge1xuICAgICAgICAgICAgICBsbmdzLmZvckVhY2goZnVuY3Rpb24gKGxhbmd1YWdlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMyLnBsdXJhbFJlc29sdmVyLmdldFN1ZmZpeGVzKGxhbmd1YWdlKS5mb3JFYWNoKGZ1bmN0aW9uIChzdWZmaXgpIHtcbiAgICAgICAgICAgICAgICAgIHNlbmQoW2xhbmd1YWdlXSwga2V5ICsgc3VmZml4LCBvcHRpb25zWyJkZWZhdWx0VmFsdWUiLmNvbmNhdChzdWZmaXgpXSB8fCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlbmQobG5ncywga2V5LCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJlcyA9IHRoaXMuZXh0ZW5kVHJhbnNsYXRpb24ocmVzLCBrZXlzLCBvcHRpb25zLCByZXNvbHZlZCwgbGFzdEtleSk7XG4gICAgICAgIGlmICh1c2VkS2V5ICYmIHJlcyA9PT0ga2V5ICYmIHRoaXMub3B0aW9ucy5hcHBlbmROYW1lc3BhY2VUb01pc3NpbmdLZXkpIHJlcyA9ICIiLmNvbmNhdChuYW1lc3BhY2UsICI6IikuY29uY2F0KGtleSk7XG4gICAgICAgIGlmICh1c2VkS2V5ICYmIHRoaXMub3B0aW9ucy5wYXJzZU1pc3NpbmdLZXlIYW5kbGVyKSByZXMgPSB0aGlzLm9wdGlvbnMucGFyc2VNaXNzaW5nS2V5SGFuZGxlcihyZXMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImV4dGVuZFRyYW5zbGF0aW9uIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZXh0ZW5kVHJhbnNsYXRpb24ocmVzLCBrZXksIG9wdGlvbnMsIHJlc29sdmVkLCBsYXN0S2V5KSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgaWYgKHRoaXMuaTE4bkZvcm1hdCAmJiB0aGlzLmkxOG5Gb3JtYXQucGFyc2UpIHtcbiAgICAgICAgcmVzID0gdGhpcy5pMThuRm9ybWF0LnBhcnNlKHJlcywgb3B0aW9ucywgcmVzb2x2ZWQudXNlZExuZywgcmVzb2x2ZWQudXNlZE5TLCByZXNvbHZlZC51c2VkS2V5LCB7XG4gICAgICAgICAgcmVzb2x2ZWQ6IHJlc29sdmVkXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICghb3B0aW9ucy5za2lwSW50ZXJwb2xhdGlvbikge1xuICAgICAgICBpZiAob3B0aW9ucy5pbnRlcnBvbGF0aW9uKSB0aGlzLmludGVycG9sYXRvci5pbml0KG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIG9wdGlvbnMsIHtcbiAgICAgICAgICBpbnRlcnBvbGF0aW9uOiBvYmplY3RTcHJlYWRfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLm9wdGlvbnMuaW50ZXJwb2xhdGlvbiwgb3B0aW9ucy5pbnRlcnBvbGF0aW9uKVxuICAgICAgICB9KSk7XG4gICAgICAgIHZhciBza2lwT25WYXJpYWJsZXMgPSBvcHRpb25zLmludGVycG9sYXRpb24gJiYgb3B0aW9ucy5pbnRlcnBvbGF0aW9uLnNraXBPblZhcmlhYmxlcyB8fCB0aGlzLm9wdGlvbnMuaW50ZXJwb2xhdGlvbi5za2lwT25WYXJpYWJsZXM7XG4gICAgICAgIHZhciBuZXN0QmVmO1xuXG4gICAgICAgIGlmIChza2lwT25WYXJpYWJsZXMpIHtcbiAgICAgICAgICB2YXIgbmIgPSByZXMubWF0Y2godGhpcy5pbnRlcnBvbGF0b3IubmVzdGluZ1JlZ2V4cCk7XG4gICAgICAgICAgbmVzdEJlZiA9IG5iICYmIG5iLmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkYXRhID0gb3B0aW9ucy5yZXBsYWNlICYmIHR5cGVvZiBvcHRpb25zLnJlcGxhY2UgIT09IFwnc3RyaW5nXCcgPyBvcHRpb25zLnJlcGxhY2UgOiBvcHRpb25zO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uZGVmYXVsdFZhcmlhYmxlcykgZGF0YSA9IG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLmRlZmF1bHRWYXJpYWJsZXMsIGRhdGEpO1xuICAgICAgICByZXMgPSB0aGlzLmludGVycG9sYXRvci5pbnRlcnBvbGF0ZShyZXMsIGRhdGEsIG9wdGlvbnMubG5nIHx8IHRoaXMubGFuZ3VhZ2UsIG9wdGlvbnMpO1xuXG4gICAgICAgIGlmIChza2lwT25WYXJpYWJsZXMpIHtcbiAgICAgICAgICB2YXIgbmEgPSByZXMubWF0Y2godGhpcy5pbnRlcnBvbGF0b3IubmVzdGluZ1JlZ2V4cCk7XG4gICAgICAgICAgdmFyIG5lc3RBZnQgPSBuYSAmJiBuYS5sZW5ndGg7XG4gICAgICAgICAgaWYgKG5lc3RCZWYgPCBuZXN0QWZ0KSBvcHRpb25zLm5lc3QgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLm5lc3QgIT09IGZhbHNlKSByZXMgPSB0aGlzLmludGVycG9sYXRvci5uZXN0KHJlcywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAobGFzdEtleSAmJiBsYXN0S2V5WzBdID09PSBhcmdzWzBdICYmICFvcHRpb25zLmNvbnRleHQpIHtcbiAgICAgICAgICAgIF90aGlzMy5sb2dnZXIud2FybigiSXQgc2VlbXMgeW91IGFyZSBuZXN0aW5nIHJlY3Vyc2l2ZWx5IGtleTogIi5jb25jYXQoYXJnc1swXSwgIiBpbiBrZXk6ICIpLmNvbmNhdChrZXlbMF0pKTtcblxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIF90aGlzMy50cmFuc2xhdGUuYXBwbHkoX3RoaXMzLCBhcmdzLmNvbmNhdChba2V5XSkpO1xuICAgICAgICB9LCBvcHRpb25zKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbikgdGhpcy5pbnRlcnBvbGF0b3IucmVzZXQoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHBvc3RQcm9jZXNzID0gb3B0aW9ucy5wb3N0UHJvY2VzcyB8fCB0aGlzLm9wdGlvbnMucG9zdFByb2Nlc3M7XG4gICAgICB2YXIgcG9zdFByb2Nlc3Nvck5hbWVzID0gdHlwZW9mIHBvc3RQcm9jZXNzID09PSBcJ3N0cmluZ1wnID8gW3Bvc3RQcm9jZXNzXSA6IHBvc3RQcm9jZXNzO1xuXG4gICAgICBpZiAocmVzICE9PSB1bmRlZmluZWQgJiYgcmVzICE9PSBudWxsICYmIHBvc3RQcm9jZXNzb3JOYW1lcyAmJiBwb3N0UHJvY2Vzc29yTmFtZXMubGVuZ3RoICYmIG9wdGlvbnMuYXBwbHlQb3N0UHJvY2Vzc29yICE9PSBmYWxzZSkge1xuICAgICAgICByZXMgPSBwb3N0UHJvY2Vzc29yLmhhbmRsZShwb3N0UHJvY2Vzc29yTmFtZXMsIHJlcywga2V5LCB0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnBvc3RQcm9jZXNzUGFzc1Jlc29sdmVkID8gb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh7XG4gICAgICAgICAgaTE4blJlc29sdmVkOiByZXNvbHZlZFxuICAgICAgICB9LCBvcHRpb25zKSA6IG9wdGlvbnMsIHRoaXMpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInJlc29sdmUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZXNvbHZlKGtleXMpIHtcbiAgICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgICB2YXIgZm91bmQ7XG4gICAgICB2YXIgdXNlZEtleTtcbiAgICAgIHZhciBleGFjdFVzZWRLZXk7XG4gICAgICB2YXIgdXNlZExuZztcbiAgICAgIHZhciB1c2VkTlM7XG4gICAgICBpZiAodHlwZW9mIGtleXMgPT09IFwnc3RyaW5nXCcpIGtleXMgPSBba2V5c107XG4gICAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGspIHtcbiAgICAgICAgaWYgKF90aGlzNC5pc1ZhbGlkTG9va3VwKGZvdW5kKSkgcmV0dXJuO1xuXG4gICAgICAgIHZhciBleHRyYWN0ZWQgPSBfdGhpczQuZXh0cmFjdEZyb21LZXkoaywgb3B0aW9ucyk7XG5cbiAgICAgICAgdmFyIGtleSA9IGV4dHJhY3RlZC5rZXk7XG4gICAgICAgIHVzZWRLZXkgPSBrZXk7XG4gICAgICAgIHZhciBuYW1lc3BhY2VzID0gZXh0cmFjdGVkLm5hbWVzcGFjZXM7XG4gICAgICAgIGlmIChfdGhpczQub3B0aW9ucy5mYWxsYmFja05TKSBuYW1lc3BhY2VzID0gbmFtZXNwYWNlcy5jb25jYXQoX3RoaXM0Lm9wdGlvbnMuZmFsbGJhY2tOUyk7XG4gICAgICAgIHZhciBuZWVkc1BsdXJhbEhhbmRsaW5nID0gb3B0aW9ucy5jb3VudCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBvcHRpb25zLmNvdW50ICE9PSBcJ3N0cmluZ1wnO1xuICAgICAgICB2YXIgbmVlZHNDb250ZXh0SGFuZGxpbmcgPSBvcHRpb25zLmNvbnRleHQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygb3B0aW9ucy5jb250ZXh0ID09PSBcJ3N0cmluZ1wnICYmIG9wdGlvbnMuY29udGV4dCAhPT0gXCdcJztcbiAgICAgICAgdmFyIGNvZGVzID0gb3B0aW9ucy5sbmdzID8gb3B0aW9ucy5sbmdzIDogX3RoaXM0Lmxhbmd1YWdlVXRpbHMudG9SZXNvbHZlSGllcmFyY2h5KG9wdGlvbnMubG5nIHx8IF90aGlzNC5sYW5ndWFnZSwgb3B0aW9ucy5mYWxsYmFja0xuZyk7XG4gICAgICAgIG5hbWVzcGFjZXMuZm9yRWFjaChmdW5jdGlvbiAobnMpIHtcbiAgICAgICAgICBpZiAoX3RoaXM0LmlzVmFsaWRMb29rdXAoZm91bmQpKSByZXR1cm47XG4gICAgICAgICAgdXNlZE5TID0gbnM7XG5cbiAgICAgICAgICBpZiAoIWNoZWNrZWRMb2FkZWRGb3JbIiIuY29uY2F0KGNvZGVzWzBdLCAiLSIpLmNvbmNhdChucyldICYmIF90aGlzNC51dGlscyAmJiBfdGhpczQudXRpbHMuaGFzTG9hZGVkTmFtZXNwYWNlICYmICFfdGhpczQudXRpbHMuaGFzTG9hZGVkTmFtZXNwYWNlKHVzZWROUykpIHtcbiAgICAgICAgICAgIGNoZWNrZWRMb2FkZWRGb3JbIiIuY29uY2F0KGNvZGVzWzBdLCAiLSIpLmNvbmNhdChucyldID0gdHJ1ZTtcblxuICAgICAgICAgICAgX3RoaXM0LmxvZ2dlci53YXJuKCJrZXkgXFwiIi5jb25jYXQodXNlZEtleSwgIlxcIiBmb3IgbGFuZ3VhZ2VzIFxcIiIpLmNvbmNhdChjb2Rlcy5qb2luKFwnLCBcJyksICJcXCIgd29uXCd0IGdldCByZXNvbHZlZCBhcyBuYW1lc3BhY2UgXFwiIikuY29uY2F0KHVzZWROUywgIlxcIiB3YXMgbm90IHlldCBsb2FkZWQiKSwgXCdUaGlzIG1lYW5zIHNvbWV0aGluZyBJUyBXUk9ORyBpbiB5b3VyIHNldHVwLiBZb3UgYWNjZXNzIHRoZSB0IGZ1bmN0aW9uIGJlZm9yZSBpMThuZXh0LmluaXQgLyBpMThuZXh0LmxvYWROYW1lc3BhY2UgLyBpMThuZXh0LmNoYW5nZUxhbmd1YWdlIHdhcyBkb25lLiBXYWl0IGZvciB0aGUgY2FsbGJhY2sgb3IgUHJvbWlzZSB0byByZXNvbHZlIGJlZm9yZSBhY2Nlc3NpbmcgaXQhISFcJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29kZXMuZm9yRWFjaChmdW5jdGlvbiAoY29kZSkge1xuICAgICAgICAgICAgaWYgKF90aGlzNC5pc1ZhbGlkTG9va3VwKGZvdW5kKSkgcmV0dXJuO1xuICAgICAgICAgICAgdXNlZExuZyA9IGNvZGU7XG4gICAgICAgICAgICB2YXIgZmluYWxLZXkgPSBrZXk7XG4gICAgICAgICAgICB2YXIgZmluYWxLZXlzID0gW2ZpbmFsS2V5XTtcblxuICAgICAgICAgICAgaWYgKF90aGlzNC5pMThuRm9ybWF0ICYmIF90aGlzNC5pMThuRm9ybWF0LmFkZExvb2t1cEtleXMpIHtcbiAgICAgICAgICAgICAgX3RoaXM0LmkxOG5Gb3JtYXQuYWRkTG9va3VwS2V5cyhmaW5hbEtleXMsIGtleSwgY29kZSwgbnMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyIHBsdXJhbFN1ZmZpeDtcbiAgICAgICAgICAgICAgaWYgKG5lZWRzUGx1cmFsSGFuZGxpbmcpIHBsdXJhbFN1ZmZpeCA9IF90aGlzNC5wbHVyYWxSZXNvbHZlci5nZXRTdWZmaXgoY29kZSwgb3B0aW9ucy5jb3VudCk7XG4gICAgICAgICAgICAgIGlmIChuZWVkc1BsdXJhbEhhbmRsaW5nICYmIG5lZWRzQ29udGV4dEhhbmRsaW5nKSBmaW5hbEtleXMucHVzaChmaW5hbEtleSArIHBsdXJhbFN1ZmZpeCk7XG4gICAgICAgICAgICAgIGlmIChuZWVkc0NvbnRleHRIYW5kbGluZykgZmluYWxLZXlzLnB1c2goZmluYWxLZXkgKz0gIiIuY29uY2F0KF90aGlzNC5vcHRpb25zLmNvbnRleHRTZXBhcmF0b3IpLmNvbmNhdChvcHRpb25zLmNvbnRleHQpKTtcbiAgICAgICAgICAgICAgaWYgKG5lZWRzUGx1cmFsSGFuZGxpbmcpIGZpbmFsS2V5cy5wdXNoKGZpbmFsS2V5ICs9IHBsdXJhbFN1ZmZpeCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwb3NzaWJsZUtleTtcblxuICAgICAgICAgICAgd2hpbGUgKHBvc3NpYmxlS2V5ID0gZmluYWxLZXlzLnBvcCgpKSB7XG4gICAgICAgICAgICAgIGlmICghX3RoaXM0LmlzVmFsaWRMb29rdXAoZm91bmQpKSB7XG4gICAgICAgICAgICAgICAgZXhhY3RVc2VkS2V5ID0gcG9zc2libGVLZXk7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBfdGhpczQuZ2V0UmVzb3VyY2UoY29kZSwgbnMsIHBvc3NpYmxlS2V5LCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzOiBmb3VuZCxcbiAgICAgICAgdXNlZEtleTogdXNlZEtleSxcbiAgICAgICAgZXhhY3RVc2VkS2V5OiBleGFjdFVzZWRLZXksXG4gICAgICAgIHVzZWRMbmc6IHVzZWRMbmcsXG4gICAgICAgIHVzZWROUzogdXNlZE5TXG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImlzVmFsaWRMb29rdXAiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpc1ZhbGlkTG9va3VwKHJlcykge1xuICAgICAgcmV0dXJuIHJlcyAhPT0gdW5kZWZpbmVkICYmICEoIXRoaXMub3B0aW9ucy5yZXR1cm5OdWxsICYmIHJlcyA9PT0gbnVsbCkgJiYgISghdGhpcy5vcHRpb25zLnJldHVybkVtcHR5U3RyaW5nICYmIHJlcyA9PT0gXCdcJyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0UmVzb3VyY2UiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZXNvdXJjZShjb2RlLCBucywga2V5KSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDoge307XG4gICAgICBpZiAodGhpcy5pMThuRm9ybWF0ICYmIHRoaXMuaTE4bkZvcm1hdC5nZXRSZXNvdXJjZSkgcmV0dXJuIHRoaXMuaTE4bkZvcm1hdC5nZXRSZXNvdXJjZShjb2RlLCBucywga2V5LCBvcHRpb25zKTtcbiAgICAgIHJldHVybiB0aGlzLnJlc291cmNlU3RvcmUuZ2V0UmVzb3VyY2UoY29kZSwgbnMsIGtleSwgb3B0aW9ucyk7XG4gICAgfVxuICB9XSwgW3tcbiAgICBrZXk6ICJoYXNEZWZhdWx0VmFsdWUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNEZWZhdWx0VmFsdWUob3B0aW9ucykge1xuICAgICAgdmFyIHByZWZpeCA9IFwnZGVmYXVsdFZhbHVlXCc7XG5cbiAgICAgIGZvciAodmFyIG9wdGlvbiBpbiBvcHRpb25zKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob3B0aW9ucywgb3B0aW9uKSAmJiBwcmVmaXggPT09IG9wdGlvbi5zdWJzdHJpbmcoMCwgcHJlZml4Lmxlbmd0aCkgJiYgdW5kZWZpbmVkICE9PSBvcHRpb25zW29wdGlvbl0pIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFRyYW5zbGF0b3I7XG59KGkxOG5leHRfRXZlbnRFbWl0dGVyKTtcblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcpIHtcbiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0cmluZy5zbGljZSgxKTtcbn1cblxudmFyIGkxOG5leHRfTGFuZ3VhZ2VVdGlsID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBMYW5ndWFnZVV0aWwob3B0aW9ucykge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBMYW5ndWFnZVV0aWwpO1xuXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLndoaXRlbGlzdCA9IHRoaXMub3B0aW9ucy5zdXBwb3J0ZWRMbmdzIHx8IGZhbHNlO1xuICAgIHRoaXMuc3VwcG9ydGVkTG5ncyA9IHRoaXMub3B0aW9ucy5zdXBwb3J0ZWRMbmdzIHx8IGZhbHNlO1xuICAgIHRoaXMubG9nZ2VyID0gYmFzZUxvZ2dlci5jcmVhdGUoXCdsYW5ndWFnZVV0aWxzXCcpO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKExhbmd1YWdlVXRpbCwgW3tcbiAgICBrZXk6ICJnZXRTY3JpcHRQYXJ0RnJvbUNvZGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTY3JpcHRQYXJ0RnJvbUNvZGUoY29kZSkge1xuICAgICAgaWYgKCFjb2RlIHx8IGNvZGUuaW5kZXhPZihcJy1cJykgPCAwKSByZXR1cm4gbnVsbDtcbiAgICAgIHZhciBwID0gY29kZS5zcGxpdChcJy1cJyk7XG4gICAgICBpZiAocC5sZW5ndGggPT09IDIpIHJldHVybiBudWxsO1xuICAgICAgcC5wb3AoKTtcbiAgICAgIGlmIChwW3AubGVuZ3RoIC0gMV0udG9Mb3dlckNhc2UoKSA9PT0gXCd4XCcpIHJldHVybiBudWxsO1xuICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0TGFuZ3VhZ2VDb2RlKHAuam9pbihcJy1cJykpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImdldExhbmd1YWdlUGFydEZyb21Db2RlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGFuZ3VhZ2VQYXJ0RnJvbUNvZGUoY29kZSkge1xuICAgICAgaWYgKCFjb2RlIHx8IGNvZGUuaW5kZXhPZihcJy1cJykgPCAwKSByZXR1cm4gY29kZTtcbiAgICAgIHZhciBwID0gY29kZS5zcGxpdChcJy1cJyk7XG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXRMYW5ndWFnZUNvZGUocFswXSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZm9ybWF0TGFuZ3VhZ2VDb2RlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZm9ybWF0TGFuZ3VhZ2VDb2RlKGNvZGUpIHtcbiAgICAgIGlmICh0eXBlb2YgY29kZSA9PT0gXCdzdHJpbmdcJyAmJiBjb2RlLmluZGV4T2YoXCctXCcpID4gLTEpIHtcbiAgICAgICAgdmFyIHNwZWNpYWxDYXNlcyA9IFtcJ2hhbnNcJywgXCdoYW50XCcsIFwnbGF0blwnLCBcJ2N5cmxcJywgXCdjYW5zXCcsIFwnbW9uZ1wnLCBcJ2FyYWJcJ107XG4gICAgICAgIHZhciBwID0gY29kZS5zcGxpdChcJy1cJyk7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sb3dlckNhc2VMbmcpIHtcbiAgICAgICAgICBwID0gcC5tYXAoZnVuY3Rpb24gKHBhcnQpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAocC5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICBwWzBdID0gcFswXS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIHBbMV0gPSBwWzFdLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKHNwZWNpYWxDYXNlcy5pbmRleE9mKHBbMV0udG9Mb3dlckNhc2UoKSkgPiAtMSkgcFsxXSA9IGNhcGl0YWxpemUocFsxXS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgfSBlbHNlIGlmIChwLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgIHBbMF0gPSBwWzBdLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKHBbMV0ubGVuZ3RoID09PSAyKSBwWzFdID0gcFsxXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgIGlmIChwWzBdICE9PSBcJ3NnblwnICYmIHBbMl0ubGVuZ3RoID09PSAyKSBwWzJdID0gcFsyXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgIGlmIChzcGVjaWFsQ2FzZXMuaW5kZXhPZihwWzFdLnRvTG93ZXJDYXNlKCkpID4gLTEpIHBbMV0gPSBjYXBpdGFsaXplKHBbMV0udG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgaWYgKHNwZWNpYWxDYXNlcy5pbmRleE9mKHBbMl0udG9Mb3dlckNhc2UoKSkgPiAtMSkgcFsyXSA9IGNhcGl0YWxpemUocFsyXS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwLmpvaW4oXCctXCcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNsZWFuQ29kZSB8fCB0aGlzLm9wdGlvbnMubG93ZXJDYXNlTG5nID8gY29kZS50b0xvd2VyQ2FzZSgpIDogY29kZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJpc1doaXRlbGlzdGVkIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaXNXaGl0ZWxpc3RlZChjb2RlKSB7XG4gICAgICB0aGlzLmxvZ2dlci5kZXByZWNhdGUoXCdsYW5ndWFnZVV0aWxzLmlzV2hpdGVsaXN0ZWRcJywgXCdmdW5jdGlvbiAiaXNXaGl0ZWxpc3RlZCIgd2lsbCBiZSByZW5hbWVkIHRvICJpc1N1cHBvcnRlZENvZGUiIGluIHRoZSBuZXh0IG1ham9yIC0gcGxlYXNlIG1ha2Ugc3VyZSB0byByZW5hbWUgaXRcXFwncyB1c2FnZSBhc2FwLlwnKTtcbiAgICAgIHJldHVybiB0aGlzLmlzU3VwcG9ydGVkQ29kZShjb2RlKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJpc1N1cHBvcnRlZENvZGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpc1N1cHBvcnRlZENvZGUoY29kZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5sb2FkID09PSBcJ2xhbmd1YWdlT25seVwnIHx8IHRoaXMub3B0aW9ucy5ub25FeHBsaWNpdFN1cHBvcnRlZExuZ3MpIHtcbiAgICAgICAgY29kZSA9IHRoaXMuZ2V0TGFuZ3VhZ2VQYXJ0RnJvbUNvZGUoY29kZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhdGhpcy5zdXBwb3J0ZWRMbmdzIHx8ICF0aGlzLnN1cHBvcnRlZExuZ3MubGVuZ3RoIHx8IHRoaXMuc3VwcG9ydGVkTG5ncy5pbmRleE9mKGNvZGUpID4gLTE7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0QmVzdE1hdGNoRnJvbUNvZGVzIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QmVzdE1hdGNoRnJvbUNvZGVzKGNvZGVzKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICBpZiAoIWNvZGVzKSByZXR1cm4gbnVsbDtcbiAgICAgIHZhciBmb3VuZDtcbiAgICAgIGNvZGVzLmZvckVhY2goZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgaWYgKGZvdW5kKSByZXR1cm47XG5cbiAgICAgICAgdmFyIGNsZWFuZWRMbmcgPSBfdGhpcy5mb3JtYXRMYW5ndWFnZUNvZGUoY29kZSk7XG5cbiAgICAgICAgaWYgKCFfdGhpcy5vcHRpb25zLnN1cHBvcnRlZExuZ3MgfHwgX3RoaXMuaXNTdXBwb3J0ZWRDb2RlKGNsZWFuZWRMbmcpKSBmb3VuZCA9IGNsZWFuZWRMbmc7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFmb3VuZCAmJiB0aGlzLm9wdGlvbnMuc3VwcG9ydGVkTG5ncykge1xuICAgICAgICBjb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChjb2RlKSB7XG4gICAgICAgICAgaWYgKGZvdW5kKSByZXR1cm47XG5cbiAgICAgICAgICB2YXIgbG5nT25seSA9IF90aGlzLmdldExhbmd1YWdlUGFydEZyb21Db2RlKGNvZGUpO1xuXG4gICAgICAgICAgaWYgKF90aGlzLmlzU3VwcG9ydGVkQ29kZShsbmdPbmx5KSkgcmV0dXJuIGZvdW5kID0gbG5nT25seTtcbiAgICAgICAgICBmb3VuZCA9IF90aGlzLm9wdGlvbnMuc3VwcG9ydGVkTG5ncy5maW5kKGZ1bmN0aW9uIChzdXBwb3J0ZWRMbmcpIHtcbiAgICAgICAgICAgIGlmIChzdXBwb3J0ZWRMbmcuaW5kZXhPZihsbmdPbmx5KSA9PT0gMCkgcmV0dXJuIHN1cHBvcnRlZExuZztcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghZm91bmQpIGZvdW5kID0gdGhpcy5nZXRGYWxsYmFja0NvZGVzKHRoaXMub3B0aW9ucy5mYWxsYmFja0xuZylbMF07XG4gICAgICByZXR1cm4gZm91bmQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0RmFsbGJhY2tDb2RlcyIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZhbGxiYWNrQ29kZXMoZmFsbGJhY2tzLCBjb2RlKSB7XG4gICAgICBpZiAoIWZhbGxiYWNrcykgcmV0dXJuIFtdO1xuICAgICAgaWYgKHR5cGVvZiBmYWxsYmFja3MgPT09IFwnZnVuY3Rpb25cJykgZmFsbGJhY2tzID0gZmFsbGJhY2tzKGNvZGUpO1xuICAgICAgaWYgKHR5cGVvZiBmYWxsYmFja3MgPT09IFwnc3RyaW5nXCcpIGZhbGxiYWNrcyA9IFtmYWxsYmFja3NdO1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkoZmFsbGJhY2tzKSA9PT0gXCdbb2JqZWN0IEFycmF5XVwnKSByZXR1cm4gZmFsbGJhY2tzO1xuICAgICAgaWYgKCFjb2RlKSByZXR1cm4gZmFsbGJhY2tzWyJkZWZhdWx0Il0gfHwgW107XG4gICAgICB2YXIgZm91bmQgPSBmYWxsYmFja3NbY29kZV07XG4gICAgICBpZiAoIWZvdW5kKSBmb3VuZCA9IGZhbGxiYWNrc1t0aGlzLmdldFNjcmlwdFBhcnRGcm9tQ29kZShjb2RlKV07XG4gICAgICBpZiAoIWZvdW5kKSBmb3VuZCA9IGZhbGxiYWNrc1t0aGlzLmZvcm1hdExhbmd1YWdlQ29kZShjb2RlKV07XG4gICAgICBpZiAoIWZvdW5kKSBmb3VuZCA9IGZhbGxiYWNrc1t0aGlzLmdldExhbmd1YWdlUGFydEZyb21Db2RlKGNvZGUpXTtcbiAgICAgIGlmICghZm91bmQpIGZvdW5kID0gZmFsbGJhY2tzWyJkZWZhdWx0Il07XG4gICAgICByZXR1cm4gZm91bmQgfHwgW107XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAidG9SZXNvbHZlSGllcmFyY2h5IixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdG9SZXNvbHZlSGllcmFyY2h5KGNvZGUsIGZhbGxiYWNrQ29kZSkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHZhciBmYWxsYmFja0NvZGVzID0gdGhpcy5nZXRGYWxsYmFja0NvZGVzKGZhbGxiYWNrQ29kZSB8fCB0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmcgfHwgW10sIGNvZGUpO1xuICAgICAgdmFyIGNvZGVzID0gW107XG5cbiAgICAgIHZhciBhZGRDb2RlID0gZnVuY3Rpb24gYWRkQ29kZShjKSB7XG4gICAgICAgIGlmICghYykgcmV0dXJuO1xuXG4gICAgICAgIGlmIChfdGhpczIuaXNTdXBwb3J0ZWRDb2RlKGMpKSB7XG4gICAgICAgICAgY29kZXMucHVzaChjKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpczIubG9nZ2VyLndhcm4oInJlamVjdGluZyBsYW5ndWFnZSBjb2RlIG5vdCBmb3VuZCBpbiBzdXBwb3J0ZWRMbmdzOiAiLmNvbmNhdChjKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmICh0eXBlb2YgY29kZSA9PT0gXCdzdHJpbmdcJyAmJiBjb2RlLmluZGV4T2YoXCctXCcpID4gLTEpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sb2FkICE9PSBcJ2xhbmd1YWdlT25seVwnKSBhZGRDb2RlKHRoaXMuZm9ybWF0TGFuZ3VhZ2VDb2RlKGNvZGUpKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sb2FkICE9PSBcJ2xhbmd1YWdlT25seVwnICYmIHRoaXMub3B0aW9ucy5sb2FkICE9PSBcJ2N1cnJlbnRPbmx5XCcpIGFkZENvZGUodGhpcy5nZXRTY3JpcHRQYXJ0RnJvbUNvZGUoY29kZSkpO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxvYWQgIT09IFwnY3VycmVudE9ubHlcJykgYWRkQ29kZSh0aGlzLmdldExhbmd1YWdlUGFydEZyb21Db2RlKGNvZGUpKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvZGUgPT09IFwnc3RyaW5nXCcpIHtcbiAgICAgICAgYWRkQ29kZSh0aGlzLmZvcm1hdExhbmd1YWdlQ29kZShjb2RlKSk7XG4gICAgICB9XG5cbiAgICAgIGZhbGxiYWNrQ29kZXMuZm9yRWFjaChmdW5jdGlvbiAoZmMpIHtcbiAgICAgICAgaWYgKGNvZGVzLmluZGV4T2YoZmMpIDwgMCkgYWRkQ29kZShfdGhpczIuZm9ybWF0TGFuZ3VhZ2VDb2RlKGZjKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjb2RlcztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gTGFuZ3VhZ2VVdGlsO1xufSgpO1xuXG52YXIgc2V0cyA9IFt7XG4gIGxuZ3M6IFtcJ2FjaFwnLCBcJ2FrXCcsIFwnYW1cJywgXCdhcm5cJywgXCdiclwnLCBcJ2ZpbFwnLCBcJ2d1blwnLCBcJ2xuXCcsIFwnbWZlXCcsIFwnbWdcJywgXCdtaVwnLCBcJ29jXCcsIFwncHRcJywgXCdwdC1CUlwnLCBcJ3RnXCcsIFwndGxcJywgXCd0aVwnLCBcJ3RyXCcsIFwndXpcJywgXCd3YVwnXSxcbiAgbnI6IFsxLCAyXSxcbiAgZmM6IDFcbn0sIHtcbiAgbG5nczogW1wnYWZcJywgXCdhblwnLCBcJ2FzdFwnLCBcJ2F6XCcsIFwnYmdcJywgXCdiblwnLCBcJ2NhXCcsIFwnZGFcJywgXCdkZVwnLCBcJ2RldlwnLCBcJ2VsXCcsIFwnZW5cJywgXCdlb1wnLCBcJ2VzXCcsIFwnZXRcJywgXCdldVwnLCBcJ2ZpXCcsIFwnZm9cJywgXCdmdXJcJywgXCdmeVwnLCBcJ2dsXCcsIFwnZ3VcJywgXCdoYVwnLCBcJ2hpXCcsIFwnaHVcJywgXCdoeVwnLCBcJ2lhXCcsIFwnaXRcJywgXCdrblwnLCBcJ2t1XCcsIFwnbGJcJywgXCdtYWlcJywgXCdtbFwnLCBcJ21uXCcsIFwnbXJcJywgXCduYWhcJywgXCduYXBcJywgXCduYlwnLCBcJ25lXCcsIFwnbmxcJywgXCdublwnLCBcJ25vXCcsIFwnbnNvXCcsIFwncGFcJywgXCdwYXBcJywgXCdwbXNcJywgXCdwc1wnLCBcJ3B0LVBUXCcsIFwncm1cJywgXCdzY29cJywgXCdzZVwnLCBcJ3NpXCcsIFwnc29cJywgXCdzb25cJywgXCdzcVwnLCBcJ3N2XCcsIFwnc3dcJywgXCd0YVwnLCBcJ3RlXCcsIFwndGtcJywgXCd1clwnLCBcJ3lvXCddLFxuICBucjogWzEsIDJdLFxuICBmYzogMlxufSwge1xuICBsbmdzOiBbXCdheVwnLCBcJ2JvXCcsIFwnY2dnXCcsIFwnZmFcJywgXCdodFwnLCBcJ2lkXCcsIFwnamFcJywgXCdqYm9cJywgXCdrYVwnLCBcJ2trXCcsIFwna21cJywgXCdrb1wnLCBcJ2t5XCcsIFwnbG9cJywgXCdtc1wnLCBcJ3NhaFwnLCBcJ3N1XCcsIFwndGhcJywgXCd0dFwnLCBcJ3VnXCcsIFwndmlcJywgXCd3b1wnLCBcJ3poXCddLFxuICBucjogWzFdLFxuICBmYzogM1xufSwge1xuICBsbmdzOiBbXCdiZVwnLCBcJ2JzXCcsIFwnY25yXCcsIFwnZHpcJywgXCdoclwnLCBcJ3J1XCcsIFwnc3JcJywgXCd1a1wnXSxcbiAgbnI6IFsxLCAyLCA1XSxcbiAgZmM6IDRcbn0sIHtcbiAgbG5nczogW1wnYXJcJ10sXG4gIG5yOiBbMCwgMSwgMiwgMywgMTEsIDEwMF0sXG4gIGZjOiA1XG59LCB7XG4gIGxuZ3M6IFtcJ2NzXCcsIFwnc2tcJ10sXG4gIG5yOiBbMSwgMiwgNV0sXG4gIGZjOiA2XG59LCB7XG4gIGxuZ3M6IFtcJ2NzYlwnLCBcJ3BsXCddLFxuICBucjogWzEsIDIsIDVdLFxuICBmYzogN1xufSwge1xuICBsbmdzOiBbXCdjeVwnXSxcbiAgbnI6IFsxLCAyLCAzLCA4XSxcbiAgZmM6IDhcbn0sIHtcbiAgbG5nczogW1wnZnJcJ10sXG4gIG5yOiBbMSwgMl0sXG4gIGZjOiA5XG59LCB7XG4gIGxuZ3M6IFtcJ2dhXCddLFxuICBucjogWzEsIDIsIDMsIDcsIDExXSxcbiAgZmM6IDEwXG59LCB7XG4gIGxuZ3M6IFtcJ2dkXCddLFxuICBucjogWzEsIDIsIDMsIDIwXSxcbiAgZmM6IDExXG59LCB7XG4gIGxuZ3M6IFtcJ2lzXCddLFxuICBucjogWzEsIDJdLFxuICBmYzogMTJcbn0sIHtcbiAgbG5nczogW1wnanZcJ10sXG4gIG5yOiBbMCwgMV0sXG4gIGZjOiAxM1xufSwge1xuICBsbmdzOiBbXCdrd1wnXSxcbiAgbnI6IFsxLCAyLCAzLCA0XSxcbiAgZmM6IDE0XG59LCB7XG4gIGxuZ3M6IFtcJ2x0XCddLFxuICBucjogWzEsIDIsIDEwXSxcbiAgZmM6IDE1XG59LCB7XG4gIGxuZ3M6IFtcJ2x2XCddLFxuICBucjogWzEsIDIsIDBdLFxuICBmYzogMTZcbn0sIHtcbiAgbG5nczogW1wnbWtcJ10sXG4gIG5yOiBbMSwgMl0sXG4gIGZjOiAxN1xufSwge1xuICBsbmdzOiBbXCdtbmtcJ10sXG4gIG5yOiBbMCwgMSwgMl0sXG4gIGZjOiAxOFxufSwge1xuICBsbmdzOiBbXCdtdFwnXSxcbiAgbnI6IFsxLCAyLCAxMSwgMjBdLFxuICBmYzogMTlcbn0sIHtcbiAgbG5nczogW1wnb3JcJ10sXG4gIG5yOiBbMiwgMV0sXG4gIGZjOiAyXG59LCB7XG4gIGxuZ3M6IFtcJ3JvXCddLFxuICBucjogWzEsIDIsIDIwXSxcbiAgZmM6IDIwXG59LCB7XG4gIGxuZ3M6IFtcJ3NsXCddLFxuICBucjogWzUsIDEsIDIsIDNdLFxuICBmYzogMjFcbn0sIHtcbiAgbG5nczogW1wnaGVcJywgXCdpd1wnXSxcbiAgbnI6IFsxLCAyLCAyMCwgMjFdLFxuICBmYzogMjJcbn1dO1xudmFyIF9ydWxlc1BsdXJhbHNUeXBlcyA9IHtcbiAgMTogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuID4gMSk7XG4gIH0sXG4gIDI6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiAhPSAxKTtcbiAgfSxcbiAgMzogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0sXG4gIDQ6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiAlIDEwID09IDEgJiYgbiAlIDEwMCAhPSAxMSA/IDAgOiBuICUgMTAgPj0gMiAmJiBuICUgMTAgPD0gNCAmJiAobiAlIDEwMCA8IDEwIHx8IG4gJSAxMDAgPj0gMjApID8gMSA6IDIpO1xuICB9LFxuICA1OiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMCA/IDAgOiBuID09IDEgPyAxIDogbiA9PSAyID8gMiA6IG4gJSAxMDAgPj0gMyAmJiBuICUgMTAwIDw9IDEwID8gMyA6IG4gJSAxMDAgPj0gMTEgPyA0IDogNSk7XG4gIH0sXG4gIDY6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiA9PSAxID8gMCA6IG4gPj0gMiAmJiBuIDw9IDQgPyAxIDogMik7XG4gIH0sXG4gIDc6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiA9PSAxID8gMCA6IG4gJSAxMCA+PSAyICYmIG4gJSAxMCA8PSA0ICYmIChuICUgMTAwIDwgMTAgfHwgbiAlIDEwMCA+PSAyMCkgPyAxIDogMik7XG4gIH0sXG4gIDg6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiA9PSAxID8gMCA6IG4gPT0gMiA/IDEgOiBuICE9IDggJiYgbiAhPSAxMSA/IDIgOiAzKTtcbiAgfSxcbiAgOTogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuID49IDIpO1xuICB9LFxuICAxMDogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuID09IDEgPyAwIDogbiA9PSAyID8gMSA6IG4gPCA3ID8gMiA6IG4gPCAxMSA/IDMgOiA0KTtcbiAgfSxcbiAgMTE6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiA9PSAxIHx8IG4gPT0gMTEgPyAwIDogbiA9PSAyIHx8IG4gPT0gMTIgPyAxIDogbiA+IDIgJiYgbiA8IDIwID8gMiA6IDMpO1xuICB9LFxuICAxMjogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuICUgMTAgIT0gMSB8fCBuICUgMTAwID09IDExKTtcbiAgfSxcbiAgMTM6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiAhPT0gMCk7XG4gIH0sXG4gIDE0OiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMSA/IDAgOiBuID09IDIgPyAxIDogbiA9PSAzID8gMiA6IDMpO1xuICB9LFxuICAxNTogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuICUgMTAgPT0gMSAmJiBuICUgMTAwICE9IDExID8gMCA6IG4gJSAxMCA+PSAyICYmIChuICUgMTAwIDwgMTAgfHwgbiAlIDEwMCA+PSAyMCkgPyAxIDogMik7XG4gIH0sXG4gIDE2OiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gJSAxMCA9PSAxICYmIG4gJSAxMDAgIT0gMTEgPyAwIDogbiAhPT0gMCA/IDEgOiAyKTtcbiAgfSxcbiAgMTc6IGZ1bmN0aW9uIF8obikge1xuICAgIHJldHVybiBOdW1iZXIobiA9PSAxIHx8IG4gJSAxMCA9PSAxICYmIG4gJSAxMDAgIT0gMTEgPyAwIDogMSk7XG4gIH0sXG4gIDE4OiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMCA/IDAgOiBuID09IDEgPyAxIDogMik7XG4gIH0sXG4gIDE5OiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMSA/IDAgOiBuID09IDAgfHwgbiAlIDEwMCA+IDEgJiYgbiAlIDEwMCA8IDExID8gMSA6IG4gJSAxMDAgPiAxMCAmJiBuICUgMTAwIDwgMjAgPyAyIDogMyk7XG4gIH0sXG4gIDIwOiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMSA/IDAgOiBuID09IDAgfHwgbiAlIDEwMCA+IDAgJiYgbiAlIDEwMCA8IDIwID8gMSA6IDIpO1xuICB9LFxuICAyMTogZnVuY3Rpb24gXyhuKSB7XG4gICAgcmV0dXJuIE51bWJlcihuICUgMTAwID09IDEgPyAxIDogbiAlIDEwMCA9PSAyID8gMiA6IG4gJSAxMDAgPT0gMyB8fCBuICUgMTAwID09IDQgPyAzIDogMCk7XG4gIH0sXG4gIDIyOiBmdW5jdGlvbiBfKG4pIHtcbiAgICByZXR1cm4gTnVtYmVyKG4gPT0gMSA/IDAgOiBuID09IDIgPyAxIDogKG4gPCAwIHx8IG4gPiAxMCkgJiYgbiAlIDEwID09IDAgPyAyIDogMyk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVJ1bGVzKCkge1xuICB2YXIgcnVsZXMgPSB7fTtcbiAgc2V0cy5mb3JFYWNoKGZ1bmN0aW9uIChzZXQpIHtcbiAgICBzZXQubG5ncy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICBydWxlc1tsXSA9IHtcbiAgICAgICAgbnVtYmVyczogc2V0Lm5yLFxuICAgICAgICBwbHVyYWxzOiBfcnVsZXNQbHVyYWxzVHlwZXNbc2V0LmZjXVxuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBydWxlcztcbn1cblxudmFyIGkxOG5leHRfUGx1cmFsUmVzb2x2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFBsdXJhbFJlc29sdmVyKGxhbmd1YWdlVXRpbHMpIHtcbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGx1cmFsUmVzb2x2ZXIpO1xuXG4gICAgdGhpcy5sYW5ndWFnZVV0aWxzID0gbGFuZ3VhZ2VVdGlscztcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMubG9nZ2VyID0gYmFzZUxvZ2dlci5jcmVhdGUoXCdwbHVyYWxSZXNvbHZlclwnKTtcbiAgICB0aGlzLnJ1bGVzID0gY3JlYXRlUnVsZXMoKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhQbHVyYWxSZXNvbHZlciwgW3tcbiAgICBrZXk6ICJhZGRSdWxlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkUnVsZShsbmcsIG9iaikge1xuICAgICAgdGhpcy5ydWxlc1tsbmddID0gb2JqO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImdldFJ1bGUiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSdWxlKGNvZGUpIHtcbiAgICAgIHJldHVybiB0aGlzLnJ1bGVzW2NvZGVdIHx8IHRoaXMucnVsZXNbdGhpcy5sYW5ndWFnZVV0aWxzLmdldExhbmd1YWdlUGFydEZyb21Db2RlKGNvZGUpXTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJuZWVkc1BsdXJhbCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIG5lZWRzUGx1cmFsKGNvZGUpIHtcbiAgICAgIHZhciBydWxlID0gdGhpcy5nZXRSdWxlKGNvZGUpO1xuICAgICAgcmV0dXJuIHJ1bGUgJiYgcnVsZS5udW1iZXJzLmxlbmd0aCA+IDE7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0UGx1cmFsRm9ybXNPZktleSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBsdXJhbEZvcm1zT2ZLZXkoY29kZSwga2V5KSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdWZmaXhlcyhjb2RlKS5tYXAoZnVuY3Rpb24gKHN1ZmZpeCkge1xuICAgICAgICByZXR1cm4ga2V5ICsgc3VmZml4O1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0U3VmZml4ZXMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdWZmaXhlcyhjb2RlKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgcnVsZSA9IHRoaXMuZ2V0UnVsZShjb2RlKTtcblxuICAgICAgaWYgKCFydWxlKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJ1bGUubnVtYmVycy5tYXAoZnVuY3Rpb24gKG51bWJlcikge1xuICAgICAgICByZXR1cm4gX3RoaXMuZ2V0U3VmZml4KGNvZGUsIG51bWJlcik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJnZXRTdWZmaXgiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdWZmaXgoY29kZSwgY291bnQpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB2YXIgcnVsZSA9IHRoaXMuZ2V0UnVsZShjb2RlKTtcblxuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgdmFyIGlkeCA9IHJ1bGUubm9BYnMgPyBydWxlLnBsdXJhbHMoY291bnQpIDogcnVsZS5wbHVyYWxzKE1hdGguYWJzKGNvdW50KSk7XG4gICAgICAgIHZhciBzdWZmaXggPSBydWxlLm51bWJlcnNbaWR4XTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNpbXBsaWZ5UGx1cmFsU3VmZml4ICYmIHJ1bGUubnVtYmVycy5sZW5ndGggPT09IDIgJiYgcnVsZS5udW1iZXJzWzBdID09PSAxKSB7XG4gICAgICAgICAgaWYgKHN1ZmZpeCA9PT0gMikge1xuICAgICAgICAgICAgc3VmZml4ID0gXCdwbHVyYWxcJztcbiAgICAgICAgICB9IGVsc2UgaWYgKHN1ZmZpeCA9PT0gMSkge1xuICAgICAgICAgICAgc3VmZml4ID0gXCdcJztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmV0dXJuU3VmZml4ID0gZnVuY3Rpb24gcmV0dXJuU3VmZml4KCkge1xuICAgICAgICAgIHJldHVybiBfdGhpczIub3B0aW9ucy5wcmVwZW5kICYmIHN1ZmZpeC50b1N0cmluZygpID8gX3RoaXMyLm9wdGlvbnMucHJlcGVuZCArIHN1ZmZpeC50b1N0cmluZygpIDogc3VmZml4LnRvU3RyaW5nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb21wYXRpYmlsaXR5SlNPTiA9PT0gXCd2MVwnKSB7XG4gICAgICAgICAgaWYgKHN1ZmZpeCA9PT0gMSkgcmV0dXJuIFwnXCc7XG4gICAgICAgICAgaWYgKHR5cGVvZiBzdWZmaXggPT09IFwnbnVtYmVyXCcpIHJldHVybiAiX3BsdXJhbF8iLmNvbmNhdChzdWZmaXgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgcmV0dXJuIHJldHVyblN1ZmZpeCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jb21wYXRpYmlsaXR5SlNPTiA9PT0gXCd2MlwnKSB7XG4gICAgICAgICAgcmV0dXJuIHJldHVyblN1ZmZpeCgpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5zaW1wbGlmeVBsdXJhbFN1ZmZpeCAmJiBydWxlLm51bWJlcnMubGVuZ3RoID09PSAyICYmIHJ1bGUubnVtYmVyc1swXSA9PT0gMSkge1xuICAgICAgICAgIHJldHVybiByZXR1cm5TdWZmaXgoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucHJlcGVuZCAmJiBpZHgudG9TdHJpbmcoKSA/IHRoaXMub3B0aW9ucy5wcmVwZW5kICsgaWR4LnRvU3RyaW5nKCkgOiBpZHgudG9TdHJpbmcoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIud2Fybigibm8gcGx1cmFsIHJ1bGUgZm91bmQgZm9yOiAiLmNvbmNhdChjb2RlKSk7XG4gICAgICByZXR1cm4gXCdcJztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gUGx1cmFsUmVzb2x2ZXI7XG59KCk7XG5cbnZhciBpMThuZXh0X0ludGVycG9sYXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gSW50ZXJwb2xhdG9yKCkge1xuICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcblxuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJbnRlcnBvbGF0b3IpO1xuXG4gICAgdGhpcy5sb2dnZXIgPSBiYXNlTG9nZ2VyLmNyZWF0ZShcJ2ludGVycG9sYXRvclwnKTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgdGhpcy5mb3JtYXQgPSBvcHRpb25zLmludGVycG9sYXRpb24gJiYgb3B0aW9ucy5pbnRlcnBvbGF0aW9uLmZvcm1hdCB8fCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0KG9wdGlvbnMpO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKEludGVycG9sYXRvciwgW3tcbiAgICBrZXk6ICJpbml0IixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgICAgIGlmICghb3B0aW9ucy5pbnRlcnBvbGF0aW9uKSBvcHRpb25zLmludGVycG9sYXRpb24gPSB7XG4gICAgICAgIGVzY2FwZVZhbHVlOiB0cnVlXG4gICAgICB9O1xuICAgICAgdmFyIGlPcHRzID0gb3B0aW9ucy5pbnRlcnBvbGF0aW9uO1xuICAgICAgdGhpcy5lc2NhcGUgPSBpT3B0cy5lc2NhcGUgIT09IHVuZGVmaW5lZCA/IGlPcHRzLmVzY2FwZSA6IGkxOG5leHRfZXNjYXBlO1xuICAgICAgdGhpcy5lc2NhcGVWYWx1ZSA9IGlPcHRzLmVzY2FwZVZhbHVlICE9PSB1bmRlZmluZWQgPyBpT3B0cy5lc2NhcGVWYWx1ZSA6IHRydWU7XG4gICAgICB0aGlzLnVzZVJhd1ZhbHVlVG9Fc2NhcGUgPSBpT3B0cy51c2VSYXdWYWx1ZVRvRXNjYXBlICE9PSB1bmRlZmluZWQgPyBpT3B0cy51c2VSYXdWYWx1ZVRvRXNjYXBlIDogZmFsc2U7XG4gICAgICB0aGlzLnByZWZpeCA9IGlPcHRzLnByZWZpeCA/IHJlZ2V4RXNjYXBlKGlPcHRzLnByZWZpeCkgOiBpT3B0cy5wcmVmaXhFc2NhcGVkIHx8IFwne3tcJztcbiAgICAgIHRoaXMuc3VmZml4ID0gaU9wdHMuc3VmZml4ID8gcmVnZXhFc2NhcGUoaU9wdHMuc3VmZml4KSA6IGlPcHRzLnN1ZmZpeEVzY2FwZWQgfHwgXCd9fVwnO1xuICAgICAgdGhpcy5mb3JtYXRTZXBhcmF0b3IgPSBpT3B0cy5mb3JtYXRTZXBhcmF0b3IgPyBpT3B0cy5mb3JtYXRTZXBhcmF0b3IgOiBpT3B0cy5mb3JtYXRTZXBhcmF0b3IgfHwgXCcsXCc7XG4gICAgICB0aGlzLnVuZXNjYXBlUHJlZml4ID0gaU9wdHMudW5lc2NhcGVTdWZmaXggPyBcJ1wnIDogaU9wdHMudW5lc2NhcGVQcmVmaXggfHwgXCctXCc7XG4gICAgICB0aGlzLnVuZXNjYXBlU3VmZml4ID0gdGhpcy51bmVzY2FwZVByZWZpeCA/IFwnXCcgOiBpT3B0cy51bmVzY2FwZVN1ZmZpeCB8fCBcJ1wnO1xuICAgICAgdGhpcy5uZXN0aW5nUHJlZml4ID0gaU9wdHMubmVzdGluZ1ByZWZpeCA/IHJlZ2V4RXNjYXBlKGlPcHRzLm5lc3RpbmdQcmVmaXgpIDogaU9wdHMubmVzdGluZ1ByZWZpeEVzY2FwZWQgfHwgcmVnZXhFc2NhcGUoXCckdChcJyk7XG4gICAgICB0aGlzLm5lc3RpbmdTdWZmaXggPSBpT3B0cy5uZXN0aW5nU3VmZml4ID8gcmVnZXhFc2NhcGUoaU9wdHMubmVzdGluZ1N1ZmZpeCkgOiBpT3B0cy5uZXN0aW5nU3VmZml4RXNjYXBlZCB8fCByZWdleEVzY2FwZShcJylcJyk7XG4gICAgICB0aGlzLm5lc3RpbmdPcHRpb25zU2VwYXJhdG9yID0gaU9wdHMubmVzdGluZ09wdGlvbnNTZXBhcmF0b3IgPyBpT3B0cy5uZXN0aW5nT3B0aW9uc1NlcGFyYXRvciA6IGlPcHRzLm5lc3RpbmdPcHRpb25zU2VwYXJhdG9yIHx8IFwnLFwnO1xuICAgICAgdGhpcy5tYXhSZXBsYWNlcyA9IGlPcHRzLm1heFJlcGxhY2VzID8gaU9wdHMubWF4UmVwbGFjZXMgOiAxMDAwO1xuICAgICAgdGhpcy5hbHdheXNGb3JtYXQgPSBpT3B0cy5hbHdheXNGb3JtYXQgIT09IHVuZGVmaW5lZCA/IGlPcHRzLmFsd2F5c0Zvcm1hdCA6IGZhbHNlO1xuICAgICAgdGhpcy5yZXNldFJlZ0V4cCgpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInJlc2V0IixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zKSB0aGlzLmluaXQodGhpcy5vcHRpb25zKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJyZXNldFJlZ0V4cCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2V0UmVnRXhwKCkge1xuICAgICAgdmFyIHJlZ2V4cFN0ciA9ICIiLmNvbmNhdCh0aGlzLnByZWZpeCwgIiguKz8pIikuY29uY2F0KHRoaXMuc3VmZml4KTtcbiAgICAgIHRoaXMucmVnZXhwID0gbmV3IFJlZ0V4cChyZWdleHBTdHIsIFwnZ1wnKTtcbiAgICAgIHZhciByZWdleHBVbmVzY2FwZVN0ciA9ICIiLmNvbmNhdCh0aGlzLnByZWZpeCkuY29uY2F0KHRoaXMudW5lc2NhcGVQcmVmaXgsICIoLis/KSIpLmNvbmNhdCh0aGlzLnVuZXNjYXBlU3VmZml4KS5jb25jYXQodGhpcy5zdWZmaXgpO1xuICAgICAgdGhpcy5yZWdleHBVbmVzY2FwZSA9IG5ldyBSZWdFeHAocmVnZXhwVW5lc2NhcGVTdHIsIFwnZ1wnKTtcbiAgICAgIHZhciBuZXN0aW5nUmVnZXhwU3RyID0gIiIuY29uY2F0KHRoaXMubmVzdGluZ1ByZWZpeCwgIiguKz8pIikuY29uY2F0KHRoaXMubmVzdGluZ1N1ZmZpeCk7XG4gICAgICB0aGlzLm5lc3RpbmdSZWdleHAgPSBuZXcgUmVnRXhwKG5lc3RpbmdSZWdleHBTdHIsIFwnZ1wnKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJpbnRlcnBvbGF0ZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGludGVycG9sYXRlKHN0ciwgZGF0YSwgbG5nLCBvcHRpb25zKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICB2YXIgbWF0Y2g7XG4gICAgICB2YXIgdmFsdWU7XG4gICAgICB2YXIgcmVwbGFjZXM7XG4gICAgICB2YXIgZGVmYXVsdERhdGEgPSB0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24gJiYgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uZGVmYXVsdFZhcmlhYmxlcyB8fCB7fTtcblxuICAgICAgZnVuY3Rpb24gcmVnZXhTYWZlKHZhbCkge1xuICAgICAgICByZXR1cm4gdmFsLnJlcGxhY2UoL1xcJC9nLCBcJyQkJCRcJyk7XG4gICAgICB9XG5cbiAgICAgIHZhciBoYW5kbGVGb3JtYXQgPSBmdW5jdGlvbiBoYW5kbGVGb3JtYXQoa2V5KSB7XG4gICAgICAgIGlmIChrZXkuaW5kZXhPZihfdGhpcy5mb3JtYXRTZXBhcmF0b3IpIDwgMCkge1xuICAgICAgICAgIHZhciBwYXRoID0gZ2V0UGF0aFdpdGhEZWZhdWx0cyhkYXRhLCBkZWZhdWx0RGF0YSwga2V5KTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuYWx3YXlzRm9ybWF0ID8gX3RoaXMuZm9ybWF0KHBhdGgsIHVuZGVmaW5lZCwgbG5nKSA6IHBhdGg7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcCA9IGtleS5zcGxpdChfdGhpcy5mb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICB2YXIgayA9IHAuc2hpZnQoKS50cmltKCk7XG4gICAgICAgIHZhciBmID0gcC5qb2luKF90aGlzLmZvcm1hdFNlcGFyYXRvcikudHJpbSgpO1xuICAgICAgICByZXR1cm4gX3RoaXMuZm9ybWF0KGdldFBhdGhXaXRoRGVmYXVsdHMoZGF0YSwgZGVmYXVsdERhdGEsIGspLCBmLCBsbmcsIG9wdGlvbnMpO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5yZXNldFJlZ0V4cCgpO1xuICAgICAgdmFyIG1pc3NpbmdJbnRlcnBvbGF0aW9uSGFuZGxlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5taXNzaW5nSW50ZXJwb2xhdGlvbkhhbmRsZXIgfHwgdGhpcy5vcHRpb25zLm1pc3NpbmdJbnRlcnBvbGF0aW9uSGFuZGxlcjtcbiAgICAgIHZhciBza2lwT25WYXJpYWJsZXMgPSBvcHRpb25zICYmIG9wdGlvbnMuaW50ZXJwb2xhdGlvbiAmJiBvcHRpb25zLmludGVycG9sYXRpb24uc2tpcE9uVmFyaWFibGVzIHx8IHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLnNraXBPblZhcmlhYmxlcztcbiAgICAgIHZhciB0b2RvcyA9IFt7XG4gICAgICAgIHJlZ2V4OiB0aGlzLnJlZ2V4cFVuZXNjYXBlLFxuICAgICAgICBzYWZlVmFsdWU6IGZ1bmN0aW9uIHNhZmVWYWx1ZSh2YWwpIHtcbiAgICAgICAgICByZXR1cm4gcmVnZXhTYWZlKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAgcmVnZXg6IHRoaXMucmVnZXhwLFxuICAgICAgICBzYWZlVmFsdWU6IGZ1bmN0aW9uIHNhZmVWYWx1ZSh2YWwpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuZXNjYXBlVmFsdWUgPyByZWdleFNhZmUoX3RoaXMuZXNjYXBlKHZhbCkpIDogcmVnZXhTYWZlKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1dO1xuICAgICAgdG9kb3MuZm9yRWFjaChmdW5jdGlvbiAodG9kbykge1xuICAgICAgICByZXBsYWNlcyA9IDA7XG5cbiAgICAgICAgd2hpbGUgKG1hdGNoID0gdG9kby5yZWdleC5leGVjKHN0cikpIHtcbiAgICAgICAgICB2YWx1ZSA9IGhhbmRsZUZvcm1hdChtYXRjaFsxXS50cmltKCkpO1xuXG4gICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbWlzc2luZ0ludGVycG9sYXRpb25IYW5kbGVyID09PSBcJ2Z1bmN0aW9uXCcpIHtcbiAgICAgICAgICAgICAgdmFyIHRlbXAgPSBtaXNzaW5nSW50ZXJwb2xhdGlvbkhhbmRsZXIoc3RyLCBtYXRjaCwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgIHZhbHVlID0gdHlwZW9mIHRlbXAgPT09IFwnc3RyaW5nXCcgPyB0ZW1wIDogXCdcJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2tpcE9uVmFyaWFibGVzKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gbWF0Y2hbMF07XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLndhcm4oIm1pc3NlZCB0byBwYXNzIGluIHZhcmlhYmxlICIuY29uY2F0KG1hdGNoWzFdLCAiIGZvciBpbnRlcnBvbGF0aW5nICIpLmNvbmNhdChzdHIpKTtcblxuICAgICAgICAgICAgICB2YWx1ZSA9IFwnXCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09IFwnc3RyaW5nXCcgJiYgIV90aGlzLnVzZVJhd1ZhbHVlVG9Fc2NhcGUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gbWFrZVN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UobWF0Y2hbMF0sIHRvZG8uc2FmZVZhbHVlKHZhbHVlKSk7XG4gICAgICAgICAgdG9kby5yZWdleC5sYXN0SW5kZXggPSAwO1xuICAgICAgICAgIHJlcGxhY2VzKys7XG5cbiAgICAgICAgICBpZiAocmVwbGFjZXMgPj0gX3RoaXMubWF4UmVwbGFjZXMpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3RyO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogIm5lc3QiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBuZXN0KHN0ciwgZmMpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307XG4gICAgICB2YXIgbWF0Y2g7XG4gICAgICB2YXIgdmFsdWU7XG5cbiAgICAgIHZhciBjbG9uZWRPcHRpb25zID0gb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh7fSwgb3B0aW9ucyk7XG5cbiAgICAgIGNsb25lZE9wdGlvbnMuYXBwbHlQb3N0UHJvY2Vzc29yID0gZmFsc2U7XG4gICAgICBkZWxldGUgY2xvbmVkT3B0aW9ucy5kZWZhdWx0VmFsdWU7XG5cbiAgICAgIGZ1bmN0aW9uIGhhbmRsZUhhc09wdGlvbnMoa2V5LCBpbmhlcml0ZWRPcHRpb25zKSB7XG4gICAgICAgIHZhciBzZXAgPSB0aGlzLm5lc3RpbmdPcHRpb25zU2VwYXJhdG9yO1xuICAgICAgICBpZiAoa2V5LmluZGV4T2Yoc2VwKSA8IDApIHJldHVybiBrZXk7XG4gICAgICAgIHZhciBjID0ga2V5LnNwbGl0KG5ldyBSZWdFeHAoIiIuY29uY2F0KHNlcCwgIlsgXSp7IikpKTtcbiAgICAgICAgdmFyIG9wdGlvbnNTdHJpbmcgPSAieyIuY29uY2F0KGNbMV0pO1xuICAgICAgICBrZXkgPSBjWzBdO1xuICAgICAgICBvcHRpb25zU3RyaW5nID0gdGhpcy5pbnRlcnBvbGF0ZShvcHRpb25zU3RyaW5nLCBjbG9uZWRPcHRpb25zKTtcbiAgICAgICAgb3B0aW9uc1N0cmluZyA9IG9wdGlvbnNTdHJpbmcucmVwbGFjZSgvXCcvZywgXCciXCcpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY2xvbmVkT3B0aW9ucyA9IEpTT04ucGFyc2Uob3B0aW9uc1N0cmluZyk7XG4gICAgICAgICAgaWYgKGluaGVyaXRlZE9wdGlvbnMpIGNsb25lZE9wdGlvbnMgPSBvYmplY3RTcHJlYWRfb2JqZWN0U3ByZWFkKHt9LCBpbmhlcml0ZWRPcHRpb25zLCBjbG9uZWRPcHRpb25zKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oImZhaWxlZCBwYXJzaW5nIG9wdGlvbnMgc3RyaW5nIGluIG5lc3RpbmcgZm9yIGtleSAiLmNvbmNhdChrZXkpLCBlKTtcbiAgICAgICAgICByZXR1cm4gIiIuY29uY2F0KGtleSkuY29uY2F0KHNlcCkuY29uY2F0KG9wdGlvbnNTdHJpbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIGNsb25lZE9wdGlvbnMuZGVmYXVsdFZhbHVlO1xuICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgfVxuXG4gICAgICB3aGlsZSAobWF0Y2ggPSB0aGlzLm5lc3RpbmdSZWdleHAuZXhlYyhzdHIpKSB7XG4gICAgICAgIHZhciBmb3JtYXR0ZXJzID0gW107XG4gICAgICAgIHZhciBkb1JlZHVjZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChtYXRjaFswXS5pbmNsdWRlcyh0aGlzLmZvcm1hdFNlcGFyYXRvcikgJiYgIS97Lip9Ly50ZXN0KG1hdGNoWzFdKSkge1xuICAgICAgICAgIHZhciByID0gbWF0Y2hbMV0uc3BsaXQodGhpcy5mb3JtYXRTZXBhcmF0b3IpLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGVsZW0udHJpbSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIG1hdGNoWzFdID0gci5zaGlmdCgpO1xuICAgICAgICAgIGZvcm1hdHRlcnMgPSByO1xuICAgICAgICAgIGRvUmVkdWNlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhbHVlID0gZmMoaGFuZGxlSGFzT3B0aW9ucy5jYWxsKHRoaXMsIG1hdGNoWzFdLnRyaW0oKSwgY2xvbmVkT3B0aW9ucyksIGNsb25lZE9wdGlvbnMpO1xuICAgICAgICBpZiAodmFsdWUgJiYgbWF0Y2hbMF0gPT09IHN0ciAmJiB0eXBlb2YgdmFsdWUgIT09IFwnc3RyaW5nXCcpIHJldHVybiB2YWx1ZTtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCdzdHJpbmdcJykgdmFsdWUgPSBtYWtlU3RyaW5nKHZhbHVlKTtcblxuICAgICAgICBpZiAoIXZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIud2FybigibWlzc2VkIHRvIHJlc29sdmUgIi5jb25jYXQobWF0Y2hbMV0sICIgZm9yIG5lc3RpbmcgIikuY29uY2F0KHN0cikpO1xuICAgICAgICAgIHZhbHVlID0gXCdcJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkb1JlZHVjZSkge1xuICAgICAgICAgIHZhbHVlID0gZm9ybWF0dGVycy5yZWR1Y2UoZnVuY3Rpb24gKHYsIGYpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpczIuZm9ybWF0KHYsIGYsIG9wdGlvbnMubG5nLCBvcHRpb25zKTtcbiAgICAgICAgICB9LCB2YWx1ZS50cmltKCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UobWF0Y2hbMF0sIHZhbHVlKTtcbiAgICAgICAgdGhpcy5yZWdleHAubGFzdEluZGV4ID0gMDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN0cjtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gSW50ZXJwb2xhdG9yO1xufSgpO1xuXG5mdW5jdGlvbiByZW1vdmUoYXJyLCB3aGF0KSB7XG4gIHZhciBmb3VuZCA9IGFyci5pbmRleE9mKHdoYXQpO1xuXG4gIHdoaWxlIChmb3VuZCAhPT0gLTEpIHtcbiAgICBhcnIuc3BsaWNlKGZvdW5kLCAxKTtcbiAgICBmb3VuZCA9IGFyci5pbmRleE9mKHdoYXQpO1xuICB9XG59XG5cbnZhciBpMThuZXh0X0Nvbm5lY3RvciA9IGZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7XG4gIF9pbmhlcml0cyhDb25uZWN0b3IsIF9FdmVudEVtaXR0ZXIpO1xuXG4gIGZ1bmN0aW9uIENvbm5lY3RvcihiYWNrZW5kLCBzdG9yZSwgc2VydmljZXMpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDoge307XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ29ubmVjdG9yKTtcblxuICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKENvbm5lY3RvcikuY2FsbCh0aGlzKSk7XG5cbiAgICBpZiAoaXNJRTEwKSB7XG4gICAgICBpMThuZXh0X0V2ZW50RW1pdHRlci5jYWxsKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTtcbiAgICB9XG5cbiAgICBfdGhpcy5iYWNrZW5kID0gYmFja2VuZDtcbiAgICBfdGhpcy5zdG9yZSA9IHN0b3JlO1xuICAgIF90aGlzLnNlcnZpY2VzID0gc2VydmljZXM7XG4gICAgX3RoaXMubGFuZ3VhZ2VVdGlscyA9IHNlcnZpY2VzLmxhbmd1YWdlVXRpbHM7XG4gICAgX3RoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgX3RoaXMubG9nZ2VyID0gYmFzZUxvZ2dlci5jcmVhdGUoXCdiYWNrZW5kQ29ubmVjdG9yXCcpO1xuICAgIF90aGlzLnN0YXRlID0ge307XG4gICAgX3RoaXMucXVldWUgPSBbXTtcblxuICAgIGlmIChfdGhpcy5iYWNrZW5kICYmIF90aGlzLmJhY2tlbmQuaW5pdCkge1xuICAgICAgX3RoaXMuYmFja2VuZC5pbml0KHNlcnZpY2VzLCBvcHRpb25zLmJhY2tlbmQsIG9wdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhDb25uZWN0b3IsIFt7XG4gICAga2V5OiAicXVldWVMb2FkIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcXVldWVMb2FkKGxhbmd1YWdlcywgbmFtZXNwYWNlcywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICB2YXIgdG9Mb2FkID0gW107XG4gICAgICB2YXIgcGVuZGluZyA9IFtdO1xuICAgICAgdmFyIHRvTG9hZExhbmd1YWdlcyA9IFtdO1xuICAgICAgdmFyIHRvTG9hZE5hbWVzcGFjZXMgPSBbXTtcbiAgICAgIGxhbmd1YWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChsbmcpIHtcbiAgICAgICAgdmFyIGhhc0FsbE5hbWVzcGFjZXMgPSB0cnVlO1xuICAgICAgICBuYW1lc3BhY2VzLmZvckVhY2goZnVuY3Rpb24gKG5zKSB7XG4gICAgICAgICAgdmFyIG5hbWUgPSAiIi5jb25jYXQobG5nLCAifCIpLmNvbmNhdChucyk7XG5cbiAgICAgICAgICBpZiAoIW9wdGlvbnMucmVsb2FkICYmIF90aGlzMi5zdG9yZS5oYXNSZXNvdXJjZUJ1bmRsZShsbmcsIG5zKSkge1xuICAgICAgICAgICAgX3RoaXMyLnN0YXRlW25hbWVdID0gMjtcbiAgICAgICAgICB9IGVsc2UgaWYgKF90aGlzMi5zdGF0ZVtuYW1lXSA8IDApIDsgZWxzZSBpZiAoX3RoaXMyLnN0YXRlW25hbWVdID09PSAxKSB7XG4gICAgICAgICAgICBpZiAocGVuZGluZy5pbmRleE9mKG5hbWUpIDwgMCkgcGVuZGluZy5wdXNoKG5hbWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfdGhpczIuc3RhdGVbbmFtZV0gPSAxO1xuICAgICAgICAgICAgaGFzQWxsTmFtZXNwYWNlcyA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHBlbmRpbmcuaW5kZXhPZihuYW1lKSA8IDApIHBlbmRpbmcucHVzaChuYW1lKTtcbiAgICAgICAgICAgIGlmICh0b0xvYWQuaW5kZXhPZihuYW1lKSA8IDApIHRvTG9hZC5wdXNoKG5hbWUpO1xuICAgICAgICAgICAgaWYgKHRvTG9hZE5hbWVzcGFjZXMuaW5kZXhPZihucykgPCAwKSB0b0xvYWROYW1lc3BhY2VzLnB1c2gobnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghaGFzQWxsTmFtZXNwYWNlcykgdG9Mb2FkTGFuZ3VhZ2VzLnB1c2gobG5nKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodG9Mb2FkLmxlbmd0aCB8fCBwZW5kaW5nLmxlbmd0aCkge1xuICAgICAgICB0aGlzLnF1ZXVlLnB1c2goe1xuICAgICAgICAgIHBlbmRpbmc6IHBlbmRpbmcsXG4gICAgICAgICAgbG9hZGVkOiB7fSxcbiAgICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG9Mb2FkOiB0b0xvYWQsXG4gICAgICAgIHBlbmRpbmc6IHBlbmRpbmcsXG4gICAgICAgIHRvTG9hZExhbmd1YWdlczogdG9Mb2FkTGFuZ3VhZ2VzLFxuICAgICAgICB0b0xvYWROYW1lc3BhY2VzOiB0b0xvYWROYW1lc3BhY2VzXG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImxvYWRlZCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRlZChuYW1lLCBlcnIsIGRhdGEpIHtcbiAgICAgIHZhciBzID0gbmFtZS5zcGxpdChcJ3xcJyk7XG4gICAgICB2YXIgbG5nID0gc1swXTtcbiAgICAgIHZhciBucyA9IHNbMV07XG4gICAgICBpZiAoZXJyKSB0aGlzLmVtaXQoXCdmYWlsZWRMb2FkaW5nXCcsIGxuZywgbnMsIGVycik7XG5cbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuYWRkUmVzb3VyY2VCdW5kbGUobG5nLCBucywgZGF0YSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3RhdGVbbmFtZV0gPSBlcnIgPyAtMSA6IDI7XG4gICAgICB2YXIgbG9hZGVkID0ge307XG4gICAgICB0aGlzLnF1ZXVlLmZvckVhY2goZnVuY3Rpb24gKHEpIHtcbiAgICAgICAgcHVzaFBhdGgocS5sb2FkZWQsIFtsbmddLCBucyk7XG4gICAgICAgIHJlbW92ZShxLnBlbmRpbmcsIG5hbWUpO1xuICAgICAgICBpZiAoZXJyKSBxLmVycm9ycy5wdXNoKGVycik7XG5cbiAgICAgICAgaWYgKHEucGVuZGluZy5sZW5ndGggPT09IDAgJiYgIXEuZG9uZSkge1xuICAgICAgICAgIE9iamVjdC5rZXlzKHEubG9hZGVkKS5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgICAgICBpZiAoIWxvYWRlZFtsXSkgbG9hZGVkW2xdID0gW107XG5cbiAgICAgICAgICAgIGlmIChxLmxvYWRlZFtsXS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcS5sb2FkZWRbbF0uZm9yRWFjaChmdW5jdGlvbiAobnMpIHtcbiAgICAgICAgICAgICAgICBpZiAobG9hZGVkW2xdLmluZGV4T2YobnMpIDwgMCkgbG9hZGVkW2xdLnB1c2gobnMpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBxLmRvbmUgPSB0cnVlO1xuXG4gICAgICAgICAgaWYgKHEuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgcS5jYWxsYmFjayhxLmVycm9ycyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHEuY2FsbGJhY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5lbWl0KFwnbG9hZGVkXCcsIGxvYWRlZCk7XG4gICAgICB0aGlzLnF1ZXVlID0gdGhpcy5xdWV1ZS5maWx0ZXIoZnVuY3Rpb24gKHEpIHtcbiAgICAgICAgcmV0dXJuICFxLmRvbmU7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJyZWFkIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVhZChsbmcsIG5zLCBmY05hbWUpIHtcbiAgICAgIHZhciBfdGhpczMgPSB0aGlzO1xuXG4gICAgICB2YXIgdHJpZWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IDA7XG4gICAgICB2YXIgd2FpdCA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogMzUwO1xuICAgICAgdmFyIGNhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgPyBhcmd1bWVudHNbNV0gOiB1bmRlZmluZWQ7XG4gICAgICBpZiAoIWxuZy5sZW5ndGgpIHJldHVybiBjYWxsYmFjayhudWxsLCB7fSk7XG4gICAgICByZXR1cm4gdGhpcy5iYWNrZW5kW2ZjTmFtZV0obG5nLCBucywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICBpZiAoZXJyICYmIGRhdGEgJiYgdHJpZWQgPCA1KSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpczMucmVhZC5jYWxsKF90aGlzMywgbG5nLCBucywgZmNOYW1lLCB0cmllZCArIDEsIHdhaXQgKiAyLCBjYWxsYmFjayk7XG4gICAgICAgICAgfSwgd2FpdCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInByZXBhcmVMb2FkaW5nIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcHJlcGFyZUxvYWRpbmcobGFuZ3VhZ2VzLCBuYW1lc3BhY2VzKSB7XG4gICAgICB2YXIgX3RoaXM0ID0gdGhpcztcblxuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9O1xuICAgICAgdmFyIGNhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB1bmRlZmluZWQ7XG5cbiAgICAgIGlmICghdGhpcy5iYWNrZW5kKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXCdObyBiYWNrZW5kIHdhcyBhZGRlZCB2aWEgaTE4bmV4dC51c2UuIFdpbGwgbm90IGxvYWQgcmVzb3VyY2VzLlwnKTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgbGFuZ3VhZ2VzID09PSBcJ3N0cmluZ1wnKSBsYW5ndWFnZXMgPSB0aGlzLmxhbmd1YWdlVXRpbHMudG9SZXNvbHZlSGllcmFyY2h5KGxhbmd1YWdlcyk7XG4gICAgICBpZiAodHlwZW9mIG5hbWVzcGFjZXMgPT09IFwnc3RyaW5nXCcpIG5hbWVzcGFjZXMgPSBbbmFtZXNwYWNlc107XG4gICAgICB2YXIgdG9Mb2FkID0gdGhpcy5xdWV1ZUxvYWQobGFuZ3VhZ2VzLCBuYW1lc3BhY2VzLCBvcHRpb25zLCBjYWxsYmFjayk7XG5cbiAgICAgIGlmICghdG9Mb2FkLnRvTG9hZC5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCF0b0xvYWQucGVuZGluZy5sZW5ndGgpIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICB0b0xvYWQudG9Mb2FkLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgX3RoaXM0LmxvYWRPbmUobmFtZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJsb2FkIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZChsYW5ndWFnZXMsIG5hbWVzcGFjZXMsIGNhbGxiYWNrKSB7XG4gICAgICB0aGlzLnByZXBhcmVMb2FkaW5nKGxhbmd1YWdlcywgbmFtZXNwYWNlcywge30sIGNhbGxiYWNrKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJyZWxvYWQiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQobGFuZ3VhZ2VzLCBuYW1lc3BhY2VzLCBjYWxsYmFjaykge1xuICAgICAgdGhpcy5wcmVwYXJlTG9hZGluZyhsYW5ndWFnZXMsIG5hbWVzcGFjZXMsIHtcbiAgICAgICAgcmVsb2FkOiB0cnVlXG4gICAgICB9LCBjYWxsYmFjayk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAibG9hZE9uZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRPbmUobmFtZSkge1xuICAgICAgdmFyIF90aGlzNSA9IHRoaXM7XG5cbiAgICAgIHZhciBwcmVmaXggPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFwnXCc7XG4gICAgICB2YXIgcyA9IG5hbWUuc3BsaXQoXCd8XCcpO1xuICAgICAgdmFyIGxuZyA9IHNbMF07XG4gICAgICB2YXIgbnMgPSBzWzFdO1xuICAgICAgdGhpcy5yZWFkKGxuZywgbnMsIFwncmVhZFwnLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICBpZiAoZXJyKSBfdGhpczUubG9nZ2VyLndhcm4oIiIuY29uY2F0KHByZWZpeCwgImxvYWRpbmcgbmFtZXNwYWNlICIpLmNvbmNhdChucywgIiBmb3IgbGFuZ3VhZ2UgIikuY29uY2F0KGxuZywgIiBmYWlsZWQiKSwgZXJyKTtcbiAgICAgICAgaWYgKCFlcnIgJiYgZGF0YSkgX3RoaXM1LmxvZ2dlci5sb2coIiIuY29uY2F0KHByZWZpeCwgImxvYWRlZCBuYW1lc3BhY2UgIikuY29uY2F0KG5zLCAiIGZvciBsYW5ndWFnZSAiKS5jb25jYXQobG5nKSwgZGF0YSk7XG5cbiAgICAgICAgX3RoaXM1LmxvYWRlZChuYW1lLCBlcnIsIGRhdGEpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAic2F2ZU1pc3NpbmciLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlTWlzc2luZyhsYW5ndWFnZXMsIG5hbWVzcGFjZSwga2V5LCBmYWxsYmFja1ZhbHVlLCBpc1VwZGF0ZSkge1xuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gNSAmJiBhcmd1bWVudHNbNV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s1XSA6IHt9O1xuXG4gICAgICBpZiAodGhpcy5zZXJ2aWNlcy51dGlscyAmJiB0aGlzLnNlcnZpY2VzLnV0aWxzLmhhc0xvYWRlZE5hbWVzcGFjZSAmJiAhdGhpcy5zZXJ2aWNlcy51dGlscy5oYXNMb2FkZWROYW1lc3BhY2UobmFtZXNwYWNlKSkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCJkaWQgbm90IHNhdmUga2V5IFxcIiIuY29uY2F0KGtleSwgIlxcIiBhcyB0aGUgbmFtZXNwYWNlIFxcIiIpLmNvbmNhdChuYW1lc3BhY2UsICJcXCIgd2FzIG5vdCB5ZXQgbG9hZGVkIiksIFwnVGhpcyBtZWFucyBzb21ldGhpbmcgSVMgV1JPTkcgaW4geW91ciBzZXR1cC4gWW91IGFjY2VzcyB0aGUgdCBmdW5jdGlvbiBiZWZvcmUgaTE4bmV4dC5pbml0IC8gaTE4bmV4dC5sb2FkTmFtZXNwYWNlIC8gaTE4bmV4dC5jaGFuZ2VMYW5ndWFnZSB3YXMgZG9uZS4gV2FpdCBmb3IgdGhlIGNhbGxiYWNrIG9yIFByb21pc2UgdG8gcmVzb2x2ZSBiZWZvcmUgYWNjZXNzaW5nIGl0ISEhXCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCB8fCBrZXkgPT09IG51bGwgfHwga2V5ID09PSBcJ1wnKSByZXR1cm47XG5cbiAgICAgIGlmICh0aGlzLmJhY2tlbmQgJiYgdGhpcy5iYWNrZW5kLmNyZWF0ZSkge1xuICAgICAgICB0aGlzLmJhY2tlbmQuY3JlYXRlKGxhbmd1YWdlcywgbmFtZXNwYWNlLCBrZXksIGZhbGxiYWNrVmFsdWUsIG51bGwsIG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIG9wdGlvbnMsIHtcbiAgICAgICAgICBpc1VwZGF0ZTogaXNVcGRhdGVcbiAgICAgICAgfSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWxhbmd1YWdlcyB8fCAhbGFuZ3VhZ2VzWzBdKSByZXR1cm47XG4gICAgICB0aGlzLnN0b3JlLmFkZFJlc291cmNlKGxhbmd1YWdlc1swXSwgbmFtZXNwYWNlLCBrZXksIGZhbGxiYWNrVmFsdWUpO1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBDb25uZWN0b3I7XG59KGkxOG5leHRfRXZlbnRFbWl0dGVyKTtcblxuZnVuY3Rpb24gaTE4bmV4dF9nZXQoKSB7XG4gIHJldHVybiB7XG4gICAgZGVidWc6IGZhbHNlLFxuICAgIGluaXRJbW1lZGlhdGU6IHRydWUsXG4gICAgbnM6IFtcJ3RyYW5zbGF0aW9uXCddLFxuICAgIGRlZmF1bHROUzogW1wndHJhbnNsYXRpb25cJ10sXG4gICAgZmFsbGJhY2tMbmc6IFtcJ2RldlwnXSxcbiAgICBmYWxsYmFja05TOiBmYWxzZSxcbiAgICB3aGl0ZWxpc3Q6IGZhbHNlLFxuICAgIG5vbkV4cGxpY2l0V2hpdGVsaXN0OiBmYWxzZSxcbiAgICBzdXBwb3J0ZWRMbmdzOiBmYWxzZSxcbiAgICBub25FeHBsaWNpdFN1cHBvcnRlZExuZ3M6IGZhbHNlLFxuICAgIGxvYWQ6IFwnYWxsXCcsXG4gICAgcHJlbG9hZDogZmFsc2UsXG4gICAgc2ltcGxpZnlQbHVyYWxTdWZmaXg6IHRydWUsXG4gICAga2V5U2VwYXJhdG9yOiBcJy5cJyxcbiAgICBuc1NlcGFyYXRvcjogXCc6XCcsXG4gICAgcGx1cmFsU2VwYXJhdG9yOiBcJ19cJyxcbiAgICBjb250ZXh0U2VwYXJhdG9yOiBcJ19cJyxcbiAgICBwYXJ0aWFsQnVuZGxlZExhbmd1YWdlczogZmFsc2UsXG4gICAgc2F2ZU1pc3Npbmc6IGZhbHNlLFxuICAgIHVwZGF0ZU1pc3Npbmc6IGZhbHNlLFxuICAgIHNhdmVNaXNzaW5nVG86IFwnZmFsbGJhY2tcJyxcbiAgICBzYXZlTWlzc2luZ1BsdXJhbHM6IHRydWUsXG4gICAgbWlzc2luZ0tleUhhbmRsZXI6IGZhbHNlLFxuICAgIG1pc3NpbmdJbnRlcnBvbGF0aW9uSGFuZGxlcjogZmFsc2UsXG4gICAgcG9zdFByb2Nlc3M6IGZhbHNlLFxuICAgIHBvc3RQcm9jZXNzUGFzc1Jlc29sdmVkOiBmYWxzZSxcbiAgICByZXR1cm5OdWxsOiB0cnVlLFxuICAgIHJldHVybkVtcHR5U3RyaW5nOiB0cnVlLFxuICAgIHJldHVybk9iamVjdHM6IGZhbHNlLFxuICAgIGpvaW5BcnJheXM6IGZhbHNlLFxuICAgIHJldHVybmVkT2JqZWN0SGFuZGxlcjogZmFsc2UsXG4gICAgcGFyc2VNaXNzaW5nS2V5SGFuZGxlcjogZmFsc2UsXG4gICAgYXBwZW5kTmFtZXNwYWNlVG9NaXNzaW5nS2V5OiBmYWxzZSxcbiAgICBhcHBlbmROYW1lc3BhY2VUb0NJTW9kZTogZmFsc2UsXG4gICAgb3ZlcmxvYWRUcmFuc2xhdGlvbk9wdGlvbkhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZShhcmdzKSB7XG4gICAgICB2YXIgcmV0ID0ge307XG4gICAgICBpZiAoX3R5cGVvZihhcmdzWzFdKSA9PT0gXCdvYmplY3RcJykgcmV0ID0gYXJnc1sxXTtcbiAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gXCdzdHJpbmdcJykgcmV0LmRlZmF1bHRWYWx1ZSA9IGFyZ3NbMV07XG4gICAgICBpZiAodHlwZW9mIGFyZ3NbMl0gPT09IFwnc3RyaW5nXCcpIHJldC50RGVzY3JpcHRpb24gPSBhcmdzWzJdO1xuXG4gICAgICBpZiAoX3R5cGVvZihhcmdzWzJdKSA9PT0gXCdvYmplY3RcJyB8fCBfdHlwZW9mKGFyZ3NbM10pID09PSBcJ29iamVjdFwnKSB7XG4gICAgICAgIHZhciBvcHRpb25zID0gYXJnc1szXSB8fCBhcmdzWzJdO1xuICAgICAgICBPYmplY3Qua2V5cyhvcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICByZXRba2V5XSA9IG9wdGlvbnNba2V5XTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcbiAgICBpbnRlcnBvbGF0aW9uOiB7XG4gICAgICBlc2NhcGVWYWx1ZTogdHJ1ZSxcbiAgICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHZhbHVlLCBfZm9ybWF0LCBsbmcsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfSxcbiAgICAgIHByZWZpeDogXCd7e1wnLFxuICAgICAgc3VmZml4OiBcJ319XCcsXG4gICAgICBmb3JtYXRTZXBhcmF0b3I6IFwnLFwnLFxuICAgICAgdW5lc2NhcGVQcmVmaXg6IFwnLVwnLFxuICAgICAgbmVzdGluZ1ByZWZpeDogXCckdChcJyxcbiAgICAgIG5lc3RpbmdTdWZmaXg6IFwnKVwnLFxuICAgICAgbmVzdGluZ09wdGlvbnNTZXBhcmF0b3I6IFwnLFwnLFxuICAgICAgbWF4UmVwbGFjZXM6IDEwMDAsXG4gICAgICBza2lwT25WYXJpYWJsZXM6IGZhbHNlXG4gICAgfVxuICB9O1xufVxuZnVuY3Rpb24gdHJhbnNmb3JtT3B0aW9ucyhvcHRpb25zKSB7XG4gIGlmICh0eXBlb2Ygb3B0aW9ucy5ucyA9PT0gXCdzdHJpbmdcJykgb3B0aW9ucy5ucyA9IFtvcHRpb25zLm5zXTtcbiAgaWYgKHR5cGVvZiBvcHRpb25zLmZhbGxiYWNrTG5nID09PSBcJ3N0cmluZ1wnKSBvcHRpb25zLmZhbGxiYWNrTG5nID0gW29wdGlvbnMuZmFsbGJhY2tMbmddO1xuICBpZiAodHlwZW9mIG9wdGlvbnMuZmFsbGJhY2tOUyA9PT0gXCdzdHJpbmdcJykgb3B0aW9ucy5mYWxsYmFja05TID0gW29wdGlvbnMuZmFsbGJhY2tOU107XG5cbiAgaWYgKG9wdGlvbnMud2hpdGVsaXN0KSB7XG4gICAgaWYgKG9wdGlvbnMud2hpdGVsaXN0ICYmIG9wdGlvbnMud2hpdGVsaXN0LmluZGV4T2YoXCdjaW1vZGVcJykgPCAwKSB7XG4gICAgICBvcHRpb25zLndoaXRlbGlzdCA9IG9wdGlvbnMud2hpdGVsaXN0LmNvbmNhdChbXCdjaW1vZGVcJ10pO1xuICAgIH1cblxuICAgIG9wdGlvbnMuc3VwcG9ydGVkTG5ncyA9IG9wdGlvbnMud2hpdGVsaXN0O1xuICB9XG5cbiAgaWYgKG9wdGlvbnMubm9uRXhwbGljaXRXaGl0ZWxpc3QpIHtcbiAgICBvcHRpb25zLm5vbkV4cGxpY2l0U3VwcG9ydGVkTG5ncyA9IG9wdGlvbnMubm9uRXhwbGljaXRXaGl0ZWxpc3Q7XG4gIH1cblxuICBpZiAob3B0aW9ucy5zdXBwb3J0ZWRMbmdzICYmIG9wdGlvbnMuc3VwcG9ydGVkTG5ncy5pbmRleE9mKFwnY2ltb2RlXCcpIDwgMCkge1xuICAgIG9wdGlvbnMuc3VwcG9ydGVkTG5ncyA9IG9wdGlvbnMuc3VwcG9ydGVkTG5ncy5jb25jYXQoW1wnY2ltb2RlXCddKTtcbiAgfVxuXG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBpMThuZXh0X25vb3AoKSB7fVxuXG52YXIgaTE4bmV4dF9JMThuID0gZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHtcbiAgX2luaGVyaXRzKEkxOG4sIF9FdmVudEVtaXR0ZXIpO1xuXG4gIGZ1bmN0aW9uIEkxOG4oKSB7XG4gICAgdmFyIF90aGlzO1xuXG4gICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEkxOG4pO1xuXG4gICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSTE4bikuY2FsbCh0aGlzKSk7XG5cbiAgICBpZiAoaXNJRTEwKSB7XG4gICAgICBpMThuZXh0X0V2ZW50RW1pdHRlci5jYWxsKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTtcbiAgICB9XG5cbiAgICBfdGhpcy5vcHRpb25zID0gdHJhbnNmb3JtT3B0aW9ucyhvcHRpb25zKTtcbiAgICBfdGhpcy5zZXJ2aWNlcyA9IHt9O1xuICAgIF90aGlzLmxvZ2dlciA9IGJhc2VMb2dnZXI7XG4gICAgX3RoaXMubW9kdWxlcyA9IHtcbiAgICAgIGV4dGVybmFsOiBbXVxuICAgIH07XG5cbiAgICBpZiAoY2FsbGJhY2sgJiYgIV90aGlzLmlzSW5pdGlhbGl6ZWQgJiYgIW9wdGlvbnMuaXNDbG9uZSkge1xuICAgICAgaWYgKCFfdGhpcy5vcHRpb25zLmluaXRJbW1lZGlhdGUpIHtcbiAgICAgICAgX3RoaXMuaW5pdChvcHRpb25zLCBjYWxsYmFjayk7XG5cbiAgICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKF90aGlzLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSk7XG4gICAgICB9XG5cbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5pbml0KG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgIH0sIDApO1xuICAgIH1cblxuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhJMThuLCBbe1xuICAgIGtleTogImluaXQiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwnZnVuY3Rpb25cJykge1xuICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMud2hpdGVsaXN0ICYmICFvcHRpb25zLnN1cHBvcnRlZExuZ3MpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVwcmVjYXRlKFwnd2hpdGVsaXN0XCcsIFwnb3B0aW9uICJ3aGl0ZWxpc3QiIHdpbGwgYmUgcmVuYW1lZCB0byAic3VwcG9ydGVkTG5ncyIgaW4gdGhlIG5leHQgbWFqb3IgLSBwbGVhc2UgbWFrZSBzdXJlIHRvIHJlbmFtZSB0aGlzIG9wdGlvbiBhc2FwLlwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMubm9uRXhwbGljaXRXaGl0ZWxpc3QgJiYgIW9wdGlvbnMubm9uRXhwbGljaXRTdXBwb3J0ZWRMbmdzKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlcHJlY2F0ZShcJ3doaXRlbGlzdFwnLCBcJ29wdGlvbnMgIm5vbkV4cGxpY2l0V2hpdGVsaXN0IiB3aWxsIGJlIHJlbmFtZWQgdG8gIm5vbkV4cGxpY2l0U3VwcG9ydGVkTG5ncyIgaW4gdGhlIG5leHQgbWFqb3IgLSBwbGVhc2UgbWFrZSBzdXJlIHRvIHJlbmFtZSB0aGlzIG9wdGlvbiBhc2FwLlwnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5vcHRpb25zID0gb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh7fSwgaTE4bmV4dF9nZXQoKSwgdGhpcy5vcHRpb25zLCB0cmFuc2Zvcm1PcHRpb25zKG9wdGlvbnMpKTtcbiAgICAgIHRoaXMuZm9ybWF0ID0gdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uZm9ybWF0O1xuICAgICAgaWYgKCFjYWxsYmFjaykgY2FsbGJhY2sgPSBpMThuZXh0X25vb3A7XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzT25EZW1hbmQoQ2xhc3NPck9iamVjdCkge1xuICAgICAgICBpZiAoIUNsYXNzT3JPYmplY3QpIHJldHVybiBudWxsO1xuICAgICAgICBpZiAodHlwZW9mIENsYXNzT3JPYmplY3QgPT09IFwnZnVuY3Rpb25cJykgcmV0dXJuIG5ldyBDbGFzc09yT2JqZWN0KCk7XG4gICAgICAgIHJldHVybiBDbGFzc09yT2JqZWN0O1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMub3B0aW9ucy5pc0Nsb25lKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZHVsZXMubG9nZ2VyKSB7XG4gICAgICAgICAgYmFzZUxvZ2dlci5pbml0KGNyZWF0ZUNsYXNzT25EZW1hbmQodGhpcy5tb2R1bGVzLmxvZ2dlciksIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmFzZUxvZ2dlci5pbml0KG51bGwsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbHUgPSBuZXcgaTE4bmV4dF9MYW5ndWFnZVV0aWwodGhpcy5vcHRpb25zKTtcbiAgICAgICAgdGhpcy5zdG9yZSA9IG5ldyBpMThuZXh0X1Jlc291cmNlU3RvcmUodGhpcy5vcHRpb25zLnJlc291cmNlcywgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgdmFyIHMgPSB0aGlzLnNlcnZpY2VzO1xuICAgICAgICBzLmxvZ2dlciA9IGJhc2VMb2dnZXI7XG4gICAgICAgIHMucmVzb3VyY2VTdG9yZSA9IHRoaXMuc3RvcmU7XG4gICAgICAgIHMubGFuZ3VhZ2VVdGlscyA9IGx1O1xuICAgICAgICBzLnBsdXJhbFJlc29sdmVyID0gbmV3IGkxOG5leHRfUGx1cmFsUmVzb2x2ZXIobHUsIHtcbiAgICAgICAgICBwcmVwZW5kOiB0aGlzLm9wdGlvbnMucGx1cmFsU2VwYXJhdG9yLFxuICAgICAgICAgIGNvbXBhdGliaWxpdHlKU09OOiB0aGlzLm9wdGlvbnMuY29tcGF0aWJpbGl0eUpTT04sXG4gICAgICAgICAgc2ltcGxpZnlQbHVyYWxTdWZmaXg6IHRoaXMub3B0aW9ucy5zaW1wbGlmeVBsdXJhbFN1ZmZpeFxuICAgICAgICB9KTtcbiAgICAgICAgcy5pbnRlcnBvbGF0b3IgPSBuZXcgaTE4bmV4dF9JbnRlcnBvbGF0b3IodGhpcy5vcHRpb25zKTtcbiAgICAgICAgcy51dGlscyA9IHtcbiAgICAgICAgICBoYXNMb2FkZWROYW1lc3BhY2U6IHRoaXMuaGFzTG9hZGVkTmFtZXNwYWNlLmJpbmQodGhpcylcbiAgICAgICAgfTtcbiAgICAgICAgcy5iYWNrZW5kQ29ubmVjdG9yID0gbmV3IGkxOG5leHRfQ29ubmVjdG9yKGNyZWF0ZUNsYXNzT25EZW1hbmQodGhpcy5tb2R1bGVzLmJhY2tlbmQpLCBzLnJlc291cmNlU3RvcmUsIHMsIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIHMuYmFja2VuZENvbm5lY3Rvci5vbihcJypcJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgX3RoaXMyLmVtaXQuYXBwbHkoX3RoaXMyLCBbZXZlbnRdLmNvbmNhdChhcmdzKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLm1vZHVsZXMubGFuZ3VhZ2VEZXRlY3Rvcikge1xuICAgICAgICAgIHMubGFuZ3VhZ2VEZXRlY3RvciA9IGNyZWF0ZUNsYXNzT25EZW1hbmQodGhpcy5tb2R1bGVzLmxhbmd1YWdlRGV0ZWN0b3IpO1xuICAgICAgICAgIHMubGFuZ3VhZ2VEZXRlY3Rvci5pbml0KHMsIHRoaXMub3B0aW9ucy5kZXRlY3Rpb24sIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5tb2R1bGVzLmkxOG5Gb3JtYXQpIHtcbiAgICAgICAgICBzLmkxOG5Gb3JtYXQgPSBjcmVhdGVDbGFzc09uRGVtYW5kKHRoaXMubW9kdWxlcy5pMThuRm9ybWF0KTtcbiAgICAgICAgICBpZiAocy5pMThuRm9ybWF0LmluaXQpIHMuaTE4bkZvcm1hdC5pbml0KHRoaXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50cmFuc2xhdG9yID0gbmV3IGkxOG5leHRfVHJhbnNsYXRvcih0aGlzLnNlcnZpY2VzLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB0aGlzLnRyYW5zbGF0b3Iub24oXCcqXCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiA+IDEgPyBfbGVuMiAtIDEgOiAwKSwgX2tleTIgPSAxOyBfa2V5MiA8IF9sZW4yOyBfa2V5MisrKSB7XG4gICAgICAgICAgICBhcmdzW19rZXkyIC0gMV0gPSBhcmd1bWVudHNbX2tleTJdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIF90aGlzMi5lbWl0LmFwcGx5KF90aGlzMiwgW2V2ZW50XS5jb25jYXQoYXJncykpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5tb2R1bGVzLmV4dGVybmFsLmZvckVhY2goZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICBpZiAobS5pbml0KSBtLmluaXQoX3RoaXMyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmcgJiYgIXRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3RvciAmJiAhdGhpcy5vcHRpb25zLmxuZykge1xuICAgICAgICB2YXIgY29kZXMgPSB0aGlzLnNlcnZpY2VzLmxhbmd1YWdlVXRpbHMuZ2V0RmFsbGJhY2tDb2Rlcyh0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmcpO1xuICAgICAgICBpZiAoY29kZXMubGVuZ3RoID4gMCAmJiBjb2Rlc1swXSAhPT0gXCdkZXZcJykgdGhpcy5vcHRpb25zLmxuZyA9IGNvZGVzWzBdO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3RvciAmJiAhdGhpcy5vcHRpb25zLmxuZykge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFwnaW5pdDogbm8gbGFuZ3VhZ2VEZXRlY3RvciBpcyB1c2VkIGFuZCBubyBsbmcgaXMgZGVmaW5lZFwnKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHN0b3JlQXBpID0gW1wnZ2V0UmVzb3VyY2VcJywgXCdoYXNSZXNvdXJjZUJ1bmRsZVwnLCBcJ2dldFJlc291cmNlQnVuZGxlXCcsIFwnZ2V0RGF0YUJ5TGFuZ3VhZ2VcJ107XG4gICAgICBzdG9yZUFwaS5mb3JFYWNoKGZ1bmN0aW9uIChmY05hbWUpIHtcbiAgICAgICAgX3RoaXMyW2ZjTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF90aGlzMiRzdG9yZTtcblxuICAgICAgICAgIHJldHVybiAoX3RoaXMyJHN0b3JlID0gX3RoaXMyLnN0b3JlKVtmY05hbWVdLmFwcGx5KF90aGlzMiRzdG9yZSwgYXJndW1lbnRzKTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIHN0b3JlQXBpQ2hhaW5lZCA9IFtcJ2FkZFJlc291cmNlXCcsIFwnYWRkUmVzb3VyY2VzXCcsIFwnYWRkUmVzb3VyY2VCdW5kbGVcJywgXCdyZW1vdmVSZXNvdXJjZUJ1bmRsZVwnXTtcbiAgICAgIHN0b3JlQXBpQ2hhaW5lZC5mb3JFYWNoKGZ1bmN0aW9uIChmY05hbWUpIHtcbiAgICAgICAgX3RoaXMyW2ZjTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF90aGlzMiRzdG9yZTI7XG5cbiAgICAgICAgICAoX3RoaXMyJHN0b3JlMiA9IF90aGlzMi5zdG9yZSlbZmNOYW1lXS5hcHBseShfdGhpczIkc3RvcmUyLCBhcmd1bWVudHMpO1xuXG4gICAgICAgICAgcmV0dXJuIF90aGlzMjtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgdmFyIGRlZmVycmVkID0gZGVmZXIoKTtcblxuICAgICAgdmFyIGxvYWQgPSBmdW5jdGlvbiBsb2FkKCkge1xuICAgICAgICB2YXIgZmluaXNoID0gZnVuY3Rpb24gZmluaXNoKGVyciwgdCkge1xuICAgICAgICAgIGlmIChfdGhpczIuaXNJbml0aWFsaXplZCkgX3RoaXMyLmxvZ2dlci53YXJuKFwnaW5pdDogaTE4bmV4dCBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiBZb3Ugc2hvdWxkIGNhbGwgaW5pdCBqdXN0IG9uY2UhXCcpO1xuICAgICAgICAgIF90aGlzMi5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICBpZiAoIV90aGlzMi5vcHRpb25zLmlzQ2xvbmUpIF90aGlzMi5sb2dnZXIubG9nKFwnaW5pdGlhbGl6ZWRcJywgX3RoaXMyLm9wdGlvbnMpO1xuXG4gICAgICAgICAgX3RoaXMyLmVtaXQoXCdpbml0aWFsaXplZFwnLCBfdGhpczIub3B0aW9ucyk7XG5cbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHQpO1xuICAgICAgICAgIGNhbGxiYWNrKGVyciwgdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKF90aGlzMi5sYW5ndWFnZXMgJiYgX3RoaXMyLm9wdGlvbnMuY29tcGF0aWJpbGl0eUFQSSAhPT0gXCd2MVwnICYmICFfdGhpczIuaXNJbml0aWFsaXplZCkgcmV0dXJuIGZpbmlzaChudWxsLCBfdGhpczIudC5iaW5kKF90aGlzMikpO1xuXG4gICAgICAgIF90aGlzMi5jaGFuZ2VMYW5ndWFnZShfdGhpczIub3B0aW9ucy5sbmcsIGZpbmlzaCk7XG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlc291cmNlcyB8fCAhdGhpcy5vcHRpb25zLmluaXRJbW1lZGlhdGUpIHtcbiAgICAgICAgbG9hZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0VGltZW91dChsb2FkLCAwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRlZmVycmVkO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImxvYWRSZXNvdXJjZXMiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkUmVzb3VyY2VzKGxhbmd1YWdlKSB7XG4gICAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgICAgdmFyIGNhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBpMThuZXh0X25vb3A7XG4gICAgICB2YXIgdXNlZENhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgICB2YXIgdXNlZExuZyA9IHR5cGVvZiBsYW5ndWFnZSA9PT0gXCdzdHJpbmdcJyA/IGxhbmd1YWdlIDogdGhpcy5sYW5ndWFnZTtcbiAgICAgIGlmICh0eXBlb2YgbGFuZ3VhZ2UgPT09IFwnZnVuY3Rpb25cJykgdXNlZENhbGxiYWNrID0gbGFuZ3VhZ2U7XG5cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnJlc291cmNlcyB8fCB0aGlzLm9wdGlvbnMucGFydGlhbEJ1bmRsZWRMYW5ndWFnZXMpIHtcbiAgICAgICAgaWYgKHVzZWRMbmcgJiYgdXNlZExuZy50b0xvd2VyQ2FzZSgpID09PSBcJ2NpbW9kZVwnKSByZXR1cm4gdXNlZENhbGxiYWNrKCk7XG4gICAgICAgIHZhciB0b0xvYWQgPSBbXTtcblxuICAgICAgICB2YXIgYXBwZW5kID0gZnVuY3Rpb24gYXBwZW5kKGxuZykge1xuICAgICAgICAgIGlmICghbG5nKSByZXR1cm47XG5cbiAgICAgICAgICB2YXIgbG5ncyA9IF90aGlzMy5zZXJ2aWNlcy5sYW5ndWFnZVV0aWxzLnRvUmVzb2x2ZUhpZXJhcmNoeShsbmcpO1xuXG4gICAgICAgICAgbG5ncy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgICAgICBpZiAodG9Mb2FkLmluZGV4T2YobCkgPCAwKSB0b0xvYWQucHVzaChsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoIXVzZWRMbmcpIHtcbiAgICAgICAgICB2YXIgZmFsbGJhY2tzID0gdGhpcy5zZXJ2aWNlcy5sYW5ndWFnZVV0aWxzLmdldEZhbGxiYWNrQ29kZXModGhpcy5vcHRpb25zLmZhbGxiYWNrTG5nKTtcbiAgICAgICAgICBmYWxsYmFja3MuZm9yRWFjaChmdW5jdGlvbiAobCkge1xuICAgICAgICAgICAgcmV0dXJuIGFwcGVuZChsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhcHBlbmQodXNlZExuZyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnByZWxvYWQpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucHJlbG9hZC5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwZW5kKGwpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXJ2aWNlcy5iYWNrZW5kQ29ubmVjdG9yLmxvYWQodG9Mb2FkLCB0aGlzLm9wdGlvbnMubnMsIHVzZWRDYWxsYmFjayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB1c2VkQ2FsbGJhY2sobnVsbCk7XG4gICAgICB9XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAicmVsb2FkUmVzb3VyY2VzIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gcmVsb2FkUmVzb3VyY2VzKGxuZ3MsIG5zLCBjYWxsYmFjaykge1xuICAgICAgdmFyIGRlZmVycmVkID0gZGVmZXIoKTtcbiAgICAgIGlmICghbG5ncykgbG5ncyA9IHRoaXMubGFuZ3VhZ2VzO1xuICAgICAgaWYgKCFucykgbnMgPSB0aGlzLm9wdGlvbnMubnM7XG4gICAgICBpZiAoIWNhbGxiYWNrKSBjYWxsYmFjayA9IGkxOG5leHRfbm9vcDtcbiAgICAgIHRoaXMuc2VydmljZXMuYmFja2VuZENvbm5lY3Rvci5yZWxvYWQobG5ncywgbnMsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAidXNlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXNlKG1vZHVsZSkge1xuICAgICAgaWYgKCFtb2R1bGUpIHRocm93IG5ldyBFcnJvcihcJ1lvdSBhcmUgcGFzc2luZyBhbiB1bmRlZmluZWQgbW9kdWxlISBQbGVhc2UgY2hlY2sgdGhlIG9iamVjdCB5b3UgYXJlIHBhc3NpbmcgdG8gaTE4bmV4dC51c2UoKVwnKTtcbiAgICAgIGlmICghbW9kdWxlLnR5cGUpIHRocm93IG5ldyBFcnJvcihcJ1lvdSBhcmUgcGFzc2luZyBhIHdyb25nIG1vZHVsZSEgUGxlYXNlIGNoZWNrIHRoZSBvYmplY3QgeW91IGFyZSBwYXNzaW5nIHRvIGkxOG5leHQudXNlKClcJyk7XG5cbiAgICAgIGlmIChtb2R1bGUudHlwZSA9PT0gXCdiYWNrZW5kXCcpIHtcbiAgICAgICAgdGhpcy5tb2R1bGVzLmJhY2tlbmQgPSBtb2R1bGU7XG4gICAgICB9XG5cbiAgICAgIGlmIChtb2R1bGUudHlwZSA9PT0gXCdsb2dnZXJcJyB8fCBtb2R1bGUubG9nICYmIG1vZHVsZS53YXJuICYmIG1vZHVsZS5lcnJvcikge1xuICAgICAgICB0aGlzLm1vZHVsZXMubG9nZ2VyID0gbW9kdWxlO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kdWxlLnR5cGUgPT09IFwnbGFuZ3VhZ2VEZXRlY3RvclwnKSB7XG4gICAgICAgIHRoaXMubW9kdWxlcy5sYW5ndWFnZURldGVjdG9yID0gbW9kdWxlO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kdWxlLnR5cGUgPT09IFwnaTE4bkZvcm1hdFwnKSB7XG4gICAgICAgIHRoaXMubW9kdWxlcy5pMThuRm9ybWF0ID0gbW9kdWxlO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kdWxlLnR5cGUgPT09IFwncG9zdFByb2Nlc3NvclwnKSB7XG4gICAgICAgIHBvc3RQcm9jZXNzb3IuYWRkUG9zdFByb2Nlc3Nvcihtb2R1bGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAobW9kdWxlLnR5cGUgPT09IFwnM3JkUGFydHlcJykge1xuICAgICAgICB0aGlzLm1vZHVsZXMuZXh0ZXJuYWwucHVzaChtb2R1bGUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJjaGFuZ2VMYW5ndWFnZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNoYW5nZUxhbmd1YWdlKGxuZywgY2FsbGJhY2spIHtcbiAgICAgIHZhciBfdGhpczQgPSB0aGlzO1xuXG4gICAgICB0aGlzLmlzTGFuZ3VhZ2VDaGFuZ2luZ1RvID0gbG5nO1xuICAgICAgdmFyIGRlZmVycmVkID0gZGVmZXIoKTtcbiAgICAgIHRoaXMuZW1pdChcJ2xhbmd1YWdlQ2hhbmdpbmdcJywgbG5nKTtcblxuICAgICAgdmFyIGRvbmUgPSBmdW5jdGlvbiBkb25lKGVyciwgbCkge1xuICAgICAgICBpZiAobCkge1xuICAgICAgICAgIF90aGlzNC5sYW5ndWFnZSA9IGw7XG4gICAgICAgICAgX3RoaXM0Lmxhbmd1YWdlcyA9IF90aGlzNC5zZXJ2aWNlcy5sYW5ndWFnZVV0aWxzLnRvUmVzb2x2ZUhpZXJhcmNoeShsKTtcblxuICAgICAgICAgIF90aGlzNC50cmFuc2xhdG9yLmNoYW5nZUxhbmd1YWdlKGwpO1xuXG4gICAgICAgICAgX3RoaXM0LmlzTGFuZ3VhZ2VDaGFuZ2luZ1RvID0gdW5kZWZpbmVkO1xuXG4gICAgICAgICAgX3RoaXM0LmVtaXQoXCdsYW5ndWFnZUNoYW5nZWRcJywgbCk7XG5cbiAgICAgICAgICBfdGhpczQubG9nZ2VyLmxvZyhcJ2xhbmd1YWdlQ2hhbmdlZFwnLCBsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpczQuaXNMYW5ndWFnZUNoYW5naW5nVG8gPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXM0LnQuYXBwbHkoX3RoaXM0LCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXM0LnQuYXBwbHkoX3RoaXM0LCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBzZXRMbmcgPSBmdW5jdGlvbiBzZXRMbmcobG5ncykge1xuICAgICAgICB2YXIgbCA9IHR5cGVvZiBsbmdzID09PSBcJ3N0cmluZ1wnID8gbG5ncyA6IF90aGlzNC5zZXJ2aWNlcy5sYW5ndWFnZVV0aWxzLmdldEJlc3RNYXRjaEZyb21Db2RlcyhsbmdzKTtcblxuICAgICAgICBpZiAobCkge1xuICAgICAgICAgIGlmICghX3RoaXM0Lmxhbmd1YWdlKSB7XG4gICAgICAgICAgICBfdGhpczQubGFuZ3VhZ2UgPSBsO1xuICAgICAgICAgICAgX3RoaXM0Lmxhbmd1YWdlcyA9IF90aGlzNC5zZXJ2aWNlcy5sYW5ndWFnZVV0aWxzLnRvUmVzb2x2ZUhpZXJhcmNoeShsKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIV90aGlzNC50cmFuc2xhdG9yLmxhbmd1YWdlKSBfdGhpczQudHJhbnNsYXRvci5jaGFuZ2VMYW5ndWFnZShsKTtcbiAgICAgICAgICBpZiAoX3RoaXM0LnNlcnZpY2VzLmxhbmd1YWdlRGV0ZWN0b3IpIF90aGlzNC5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yLmNhY2hlVXNlckxhbmd1YWdlKGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgX3RoaXM0LmxvYWRSZXNvdXJjZXMobCwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGRvbmUoZXJyLCBsKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICBpZiAoIWxuZyAmJiB0aGlzLnNlcnZpY2VzLmxhbmd1YWdlRGV0ZWN0b3IgJiYgIXRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3Rvci5hc3luYykge1xuICAgICAgICBzZXRMbmcodGhpcy5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yLmRldGVjdCgpKTtcbiAgICAgIH0gZWxzZSBpZiAoIWxuZyAmJiB0aGlzLnNlcnZpY2VzLmxhbmd1YWdlRGV0ZWN0b3IgJiYgdGhpcy5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yLmFzeW5jKSB7XG4gICAgICAgIHRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3Rvci5kZXRlY3Qoc2V0TG5nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldExuZyhsbmcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGVmZXJyZWQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZ2V0Rml4ZWRUIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Rml4ZWRUKGxuZywgbnMpIHtcbiAgICAgIHZhciBfdGhpczUgPSB0aGlzO1xuXG4gICAgICB2YXIgZml4ZWRUID0gZnVuY3Rpb24gZml4ZWRUKGtleSwgb3B0cykge1xuICAgICAgICB2YXIgb3B0aW9ucztcblxuICAgICAgICBpZiAoX3R5cGVvZihvcHRzKSAhPT0gXCdvYmplY3RcJykge1xuICAgICAgICAgIGZvciAodmFyIF9sZW4zID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IG5ldyBBcnJheShfbGVuMyA+IDIgPyBfbGVuMyAtIDIgOiAwKSwgX2tleTMgPSAyOyBfa2V5MyA8IF9sZW4zOyBfa2V5MysrKSB7XG4gICAgICAgICAgICByZXN0W19rZXkzIC0gMl0gPSBhcmd1bWVudHNbX2tleTNdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG9wdGlvbnMgPSBfdGhpczUub3B0aW9ucy5vdmVybG9hZFRyYW5zbGF0aW9uT3B0aW9uSGFuZGxlcihba2V5LCBvcHRzXS5jb25jYXQocmVzdCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9wdGlvbnMgPSBvYmplY3RTcHJlYWRfb2JqZWN0U3ByZWFkKHt9LCBvcHRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG9wdGlvbnMubG5nID0gb3B0aW9ucy5sbmcgfHwgZml4ZWRULmxuZztcbiAgICAgICAgb3B0aW9ucy5sbmdzID0gb3B0aW9ucy5sbmdzIHx8IGZpeGVkVC5sbmdzO1xuICAgICAgICBvcHRpb25zLm5zID0gb3B0aW9ucy5ucyB8fCBmaXhlZFQubnM7XG4gICAgICAgIHJldHVybiBfdGhpczUudChrZXksIG9wdGlvbnMpO1xuICAgICAgfTtcblxuICAgICAgaWYgKHR5cGVvZiBsbmcgPT09IFwnc3RyaW5nXCcpIHtcbiAgICAgICAgZml4ZWRULmxuZyA9IGxuZztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpeGVkVC5sbmdzID0gbG5nO1xuICAgICAgfVxuXG4gICAgICBmaXhlZFQubnMgPSBucztcbiAgICAgIHJldHVybiBmaXhlZFQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAidCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHQoKSB7XG4gICAgICB2YXIgX3RoaXMkdHJhbnNsYXRvcjtcblxuICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRvciAmJiAoX3RoaXMkdHJhbnNsYXRvciA9IHRoaXMudHJhbnNsYXRvcikudHJhbnNsYXRlLmFwcGx5KF90aGlzJHRyYW5zbGF0b3IsIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZXhpc3RzIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZXhpc3RzKCkge1xuICAgICAgdmFyIF90aGlzJHRyYW5zbGF0b3IyO1xuXG4gICAgICByZXR1cm4gdGhpcy50cmFuc2xhdG9yICYmIChfdGhpcyR0cmFuc2xhdG9yMiA9IHRoaXMudHJhbnNsYXRvcikuZXhpc3RzLmFwcGx5KF90aGlzJHRyYW5zbGF0b3IyLCBhcmd1bWVudHMpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogInNldERlZmF1bHROYW1lc3BhY2UiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZXREZWZhdWx0TmFtZXNwYWNlKG5zKSB7XG4gICAgICB0aGlzLm9wdGlvbnMuZGVmYXVsdE5TID0gbnM7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiaGFzTG9hZGVkTmFtZXNwYWNlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzTG9hZGVkTmFtZXNwYWNlKG5zKSB7XG4gICAgICB2YXIgX3RoaXM2ID0gdGhpcztcblxuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuXG4gICAgICBpZiAoIXRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFwnaGFzTG9hZGVkTmFtZXNwYWNlOiBpMThuZXh0IHdhcyBub3QgaW5pdGlhbGl6ZWRcJywgdGhpcy5sYW5ndWFnZXMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5sYW5ndWFnZXMgfHwgIXRoaXMubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFwnaGFzTG9hZGVkTmFtZXNwYWNlOiBpMThuLmxhbmd1YWdlcyB3ZXJlIHVuZGVmaW5lZCBvciBlbXB0eVwnLCB0aGlzLmxhbmd1YWdlcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdmFyIGxuZyA9IHRoaXMubGFuZ3VhZ2VzWzBdO1xuICAgICAgdmFyIGZhbGxiYWNrTG5nID0gdGhpcy5vcHRpb25zID8gdGhpcy5vcHRpb25zLmZhbGxiYWNrTG5nIDogZmFsc2U7XG4gICAgICB2YXIgbGFzdExuZyA9IHRoaXMubGFuZ3VhZ2VzW3RoaXMubGFuZ3VhZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKGxuZy50b0xvd2VyQ2FzZSgpID09PSBcJ2NpbW9kZVwnKSByZXR1cm4gdHJ1ZTtcblxuICAgICAgdmFyIGxvYWROb3RQZW5kaW5nID0gZnVuY3Rpb24gbG9hZE5vdFBlbmRpbmcobCwgbikge1xuICAgICAgICB2YXIgbG9hZFN0YXRlID0gX3RoaXM2LnNlcnZpY2VzLmJhY2tlbmRDb25uZWN0b3Iuc3RhdGVbIiIuY29uY2F0KGwsICJ8IikuY29uY2F0KG4pXTtcblxuICAgICAgICByZXR1cm4gbG9hZFN0YXRlID09PSAtMSB8fCBsb2FkU3RhdGUgPT09IDI7XG4gICAgICB9O1xuXG4gICAgICBpZiAob3B0aW9ucy5wcmVjaGVjaykge1xuICAgICAgICB2YXIgcHJlUmVzdWx0ID0gb3B0aW9ucy5wcmVjaGVjayh0aGlzLCBsb2FkTm90UGVuZGluZyk7XG4gICAgICAgIGlmIChwcmVSZXN1bHQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIHByZVJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaGFzUmVzb3VyY2VCdW5kbGUobG5nLCBucykpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKCF0aGlzLnNlcnZpY2VzLmJhY2tlbmRDb25uZWN0b3IuYmFja2VuZCkgcmV0dXJuIHRydWU7XG4gICAgICBpZiAobG9hZE5vdFBlbmRpbmcobG5nLCBucykgJiYgKCFmYWxsYmFja0xuZyB8fCBsb2FkTm90UGVuZGluZyhsYXN0TG5nLCBucykpKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJsb2FkTmFtZXNwYWNlcyIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWROYW1lc3BhY2VzKG5zLCBjYWxsYmFjaykge1xuICAgICAgdmFyIF90aGlzNyA9IHRoaXM7XG5cbiAgICAgIHZhciBkZWZlcnJlZCA9IGRlZmVyKCk7XG5cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLm5zKSB7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBucyA9PT0gXCdzdHJpbmdcJykgbnMgPSBbbnNdO1xuICAgICAgbnMuZm9yRWFjaChmdW5jdGlvbiAobikge1xuICAgICAgICBpZiAoX3RoaXM3Lm9wdGlvbnMubnMuaW5kZXhPZihuKSA8IDApIF90aGlzNy5vcHRpb25zLm5zLnB1c2gobik7XG4gICAgICB9KTtcbiAgICAgIHRoaXMubG9hZFJlc291cmNlcyhmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAibG9hZExhbmd1YWdlcyIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRMYW5ndWFnZXMobG5ncywgY2FsbGJhY2spIHtcbiAgICAgIHZhciBkZWZlcnJlZCA9IGRlZmVyKCk7XG4gICAgICBpZiAodHlwZW9mIGxuZ3MgPT09IFwnc3RyaW5nXCcpIGxuZ3MgPSBbbG5nc107XG4gICAgICB2YXIgcHJlbG9hZGVkID0gdGhpcy5vcHRpb25zLnByZWxvYWQgfHwgW107XG4gICAgICB2YXIgbmV3TG5ncyA9IGxuZ3MuZmlsdGVyKGZ1bmN0aW9uIChsbmcpIHtcbiAgICAgICAgcmV0dXJuIHByZWxvYWRlZC5pbmRleE9mKGxuZykgPCAwO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICghbmV3TG5ncy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMub3B0aW9ucy5wcmVsb2FkID0gcHJlbG9hZGVkLmNvbmNhdChuZXdMbmdzKTtcbiAgICAgIHRoaXMubG9hZFJlc291cmNlcyhmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhlcnIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQ7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiZGlyIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGlyKGxuZykge1xuICAgICAgaWYgKCFsbmcpIGxuZyA9IHRoaXMubGFuZ3VhZ2VzICYmIHRoaXMubGFuZ3VhZ2VzLmxlbmd0aCA+IDAgPyB0aGlzLmxhbmd1YWdlc1swXSA6IHRoaXMubGFuZ3VhZ2U7XG4gICAgICBpZiAoIWxuZykgcmV0dXJuIFwncnRsXCc7XG4gICAgICB2YXIgcnRsTG5ncyA9IFtcJ2FyXCcsIFwnc2h1XCcsIFwnc3FyXCcsIFwnc3NoXCcsIFwneGFhXCcsIFwneWhkXCcsIFwneXVkXCcsIFwnYWFvXCcsIFwnYWJoXCcsIFwnYWJ2XCcsIFwnYWNtXCcsIFwnYWNxXCcsIFwnYWN3XCcsIFwnYWN4XCcsIFwnYWN5XCcsIFwnYWRmXCcsIFwnYWRzXCcsIFwnYWViXCcsIFwnYWVjXCcsIFwnYWZiXCcsIFwnYWpwXCcsIFwnYXBjXCcsIFwnYXBkXCcsIFwnYXJiXCcsIFwnYXJxXCcsIFwnYXJzXCcsIFwnYXJ5XCcsIFwnYXJ6XCcsIFwnYXV6XCcsIFwnYXZsXCcsIFwnYXloXCcsIFwnYXlsXCcsIFwnYXluXCcsIFwnYXlwXCcsIFwnYmJ6XCcsIFwncGdhXCcsIFwnaGVcJywgXCdpd1wnLCBcJ3BzXCcsIFwncGJ0XCcsIFwncGJ1XCcsIFwncHN0XCcsIFwncHJwXCcsIFwncHJkXCcsIFwndWdcJywgXCd1clwnLCBcJ3lkZFwnLCBcJ3lkc1wnLCBcJ3lpaFwnLCBcJ2ppXCcsIFwneWlcJywgXCdoYm9cJywgXCdtZW5cJywgXCd4bW5cJywgXCdmYVwnLCBcJ2pwclwnLCBcJ3Blb1wnLCBcJ3Blc1wnLCBcJ3Byc1wnLCBcJ2R2XCcsIFwnc2FtXCddO1xuICAgICAgcmV0dXJuIHJ0bExuZ3MuaW5kZXhPZih0aGlzLnNlcnZpY2VzLmxhbmd1YWdlVXRpbHMuZ2V0TGFuZ3VhZ2VQYXJ0RnJvbUNvZGUobG5nKSkgPj0gMCA/IFwncnRsXCcgOiBcJ2x0clwnO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImNyZWF0ZUluc3RhbmNlIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlSW5zdGFuY2UoKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gICAgICB2YXIgY2FsbGJhY2sgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcbiAgICAgIHJldHVybiBuZXcgSTE4bihvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAiY2xvbmVJbnN0YW5jZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNsb25lSW5zdGFuY2UoKSB7XG4gICAgICB2YXIgX3RoaXM4ID0gdGhpcztcblxuICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICAgICAgdmFyIGNhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBpMThuZXh0X25vb3A7XG5cbiAgICAgIHZhciBtZXJnZWRPcHRpb25zID0gb2JqZWN0U3ByZWFkX29iamVjdFNwcmVhZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zLCB7XG4gICAgICAgIGlzQ2xvbmU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgY2xvbmUgPSBuZXcgSTE4bihtZXJnZWRPcHRpb25zKTtcbiAgICAgIHZhciBtZW1iZXJzVG9Db3B5ID0gW1wnc3RvcmVcJywgXCdzZXJ2aWNlc1wnLCBcJ2xhbmd1YWdlXCddO1xuICAgICAgbWVtYmVyc1RvQ29weS5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7XG4gICAgICAgIGNsb25lW21dID0gX3RoaXM4W21dO1xuICAgICAgfSk7XG4gICAgICBjbG9uZS5zZXJ2aWNlcyA9IG9iamVjdFNwcmVhZF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc2VydmljZXMpO1xuICAgICAgY2xvbmUuc2VydmljZXMudXRpbHMgPSB7XG4gICAgICAgIGhhc0xvYWRlZE5hbWVzcGFjZTogY2xvbmUuaGFzTG9hZGVkTmFtZXNwYWNlLmJpbmQoY2xvbmUpXG4gICAgICB9O1xuICAgICAgY2xvbmUudHJhbnNsYXRvciA9IG5ldyBpMThuZXh0X1RyYW5zbGF0b3IoY2xvbmUuc2VydmljZXMsIGNsb25lLm9wdGlvbnMpO1xuICAgICAgY2xvbmUudHJhbnNsYXRvci5vbihcJypcJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGZvciAodmFyIF9sZW40ID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuNCA+IDEgPyBfbGVuNCAtIDEgOiAwKSwgX2tleTQgPSAxOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7XG4gICAgICAgICAgYXJnc1tfa2V5NCAtIDFdID0gYXJndW1lbnRzW19rZXk0XTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNsb25lLmVtaXQuYXBwbHkoY2xvbmUsIFtldmVudF0uY29uY2F0KGFyZ3MpKTtcbiAgICAgIH0pO1xuICAgICAgY2xvbmUuaW5pdChtZXJnZWRPcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICBjbG9uZS50cmFuc2xhdG9yLm9wdGlvbnMgPSBjbG9uZS5vcHRpb25zO1xuICAgICAgY2xvbmUudHJhbnNsYXRvci5iYWNrZW5kQ29ubmVjdG9yLnNlcnZpY2VzLnV0aWxzID0ge1xuICAgICAgICBoYXNMb2FkZWROYW1lc3BhY2U6IGNsb25lLmhhc0xvYWRlZE5hbWVzcGFjZS5iaW5kKGNsb25lKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gSTE4bjtcbn0oaTE4bmV4dF9FdmVudEVtaXR0ZXIpO1xuXG52YXIgaTE4bmV4dCA9IG5ldyBpMThuZXh0X0kxOG4oKTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgZXNtX2kxOG5leHQgPSAoaTE4bmV4dCk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL2kxOG5leHQtYnJvd3Nlci1sYW5ndWFnZWRldGVjdG9yL2Rpc3QvZXNtL2kxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3Rvci5qc1xuXG5cblxudmFyIGkxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3Rvcl9hcnIgPSBbXTtcbnZhciBlYWNoID0gaTE4bmV4dEJyb3dzZXJMYW5ndWFnZURldGVjdG9yX2Fyci5mb3JFYWNoO1xudmFyIHNsaWNlID0gaTE4bmV4dEJyb3dzZXJMYW5ndWFnZURldGVjdG9yX2Fyci5zbGljZTtcbmZ1bmN0aW9uIGRlZmF1bHRzKG9iaikge1xuICBlYWNoLmNhbGwoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbiAoc291cmNlKSB7XG4gICAgaWYgKHNvdXJjZSkge1xuICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHtcbiAgICAgICAgaWYgKG9ialtwcm9wXSA9PT0gdW5kZWZpbmVkKSBvYmpbcHJvcF0gPSBzb3VyY2VbcHJvcF07XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIG9iajtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnRyb2wtcmVnZXhcbnZhciBmaWVsZENvbnRlbnRSZWdFeHAgPSAvXltcXHUwMDA5XFx1MDAyMC1cXHUwMDdlXFx1MDA4MC1cXHUwMGZmXSskLztcblxudmFyIHNlcmlhbGl6ZUNvb2tpZSA9IGZ1bmN0aW9uIHNlcmlhbGl6ZUNvb2tpZShuYW1lLCB2YWwsIG9wdGlvbnMpIHtcbiAgdmFyIG9wdCA9IG9wdGlvbnMgfHwge307XG4gIG9wdC5wYXRoID0gb3B0LnBhdGggfHwgXCcvXCc7XG4gIHZhciB2YWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudCh2YWwpO1xuICB2YXIgc3RyID0gbmFtZSArIFwnPVwnICsgdmFsdWU7XG5cbiAgaWYgKG9wdC5tYXhBZ2UgPiAwKSB7XG4gICAgdmFyIG1heEFnZSA9IG9wdC5tYXhBZ2UgLSAwO1xuICAgIGlmIChpc05hTihtYXhBZ2UpKSB0aHJvdyBuZXcgRXJyb3IoXCdtYXhBZ2Ugc2hvdWxkIGJlIGEgTnVtYmVyXCcpO1xuICAgIHN0ciArPSBcJzsgTWF4LUFnZT1cJyArIE1hdGguZmxvb3IobWF4QWdlKTtcbiAgfVxuXG4gIGlmIChvcHQuZG9tYWluKSB7XG4gICAgaWYgKCFmaWVsZENvbnRlbnRSZWdFeHAudGVzdChvcHQuZG9tYWluKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcJ29wdGlvbiBkb21haW4gaXMgaW52YWxpZFwnKTtcbiAgICB9XG5cbiAgICBzdHIgKz0gXCc7IERvbWFpbj1cJyArIG9wdC5kb21haW47XG4gIH1cblxuICBpZiAob3B0LnBhdGgpIHtcbiAgICBpZiAoIWZpZWxkQ29udGVudFJlZ0V4cC50ZXN0KG9wdC5wYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcJ29wdGlvbiBwYXRoIGlzIGludmFsaWRcJyk7XG4gICAgfVxuXG4gICAgc3RyICs9IFwnOyBQYXRoPVwnICsgb3B0LnBhdGg7XG4gIH1cblxuICBpZiAob3B0LmV4cGlyZXMpIHtcbiAgICBpZiAodHlwZW9mIG9wdC5leHBpcmVzLnRvVVRDU3RyaW5nICE9PSBcJ2Z1bmN0aW9uXCcpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCdvcHRpb24gZXhwaXJlcyBpcyBpbnZhbGlkXCcpO1xuICAgIH1cblxuICAgIHN0ciArPSBcJzsgRXhwaXJlcz1cJyArIG9wdC5leHBpcmVzLnRvVVRDU3RyaW5nKCk7XG4gIH1cblxuICBpZiAob3B0Lmh0dHBPbmx5KSBzdHIgKz0gXCc7IEh0dHBPbmx5XCc7XG4gIGlmIChvcHQuc2VjdXJlKSBzdHIgKz0gXCc7IFNlY3VyZVwnO1xuXG4gIGlmIChvcHQuc2FtZVNpdGUpIHtcbiAgICB2YXIgc2FtZVNpdGUgPSB0eXBlb2Ygb3B0LnNhbWVTaXRlID09PSBcJ3N0cmluZ1wnID8gb3B0LnNhbWVTaXRlLnRvTG93ZXJDYXNlKCkgOiBvcHQuc2FtZVNpdGU7XG5cbiAgICBzd2l0Y2ggKHNhbWVTaXRlKSB7XG4gICAgICBjYXNlIHRydWU6XG4gICAgICAgIHN0ciArPSBcJzsgU2FtZVNpdGU9U3RyaWN0XCc7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwnbGF4XCc6XG4gICAgICAgIHN0ciArPSBcJzsgU2FtZVNpdGU9TGF4XCc7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwnc3RyaWN0XCc6XG4gICAgICAgIHN0ciArPSBcJzsgU2FtZVNpdGU9U3RyaWN0XCc7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwnbm9uZVwnOlxuICAgICAgICBzdHIgKz0gXCc7IFNhbWVTaXRlPU5vbmVcJztcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCdvcHRpb24gc2FtZVNpdGUgaXMgaW52YWxpZFwnKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3RyO1xufTtcblxudmFyIGNvb2tpZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUobmFtZSwgdmFsdWUsIG1pbnV0ZXMsIGRvbWFpbikge1xuICAgIHZhciBjb29raWVPcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiB7XG4gICAgICBwYXRoOiBcJy9cJyxcbiAgICAgIHNhbWVTaXRlOiBcJ3N0cmljdFwnXG4gICAgfTtcblxuICAgIGlmIChtaW51dGVzKSB7XG4gICAgICBjb29raWVPcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29va2llT3B0aW9ucy5leHBpcmVzLnNldFRpbWUoY29va2llT3B0aW9ucy5leHBpcmVzLmdldFRpbWUoKSArIG1pbnV0ZXMgKiA2MCAqIDEwMDApO1xuICAgIH1cblxuICAgIGlmIChkb21haW4pIGNvb2tpZU9wdGlvbnMuZG9tYWluID0gZG9tYWluO1xuICAgIGRvY3VtZW50LmNvb2tpZSA9IHNlcmlhbGl6ZUNvb2tpZShuYW1lLCBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLCBjb29raWVPcHRpb25zKTtcbiAgfSxcbiAgcmVhZDogZnVuY3Rpb24gcmVhZChuYW1lKSB7XG4gICAgdmFyIG5hbWVFUSA9IG5hbWUgKyBcJz1cJztcbiAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoXCc7XCcpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGMgPSBjYVtpXTtcblxuICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSBcJyBcJykge1xuICAgICAgICBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKG5hbWUpIHtcbiAgICB0aGlzLmNyZWF0ZShuYW1lLCBcJ1wnLCAtMSk7XG4gIH1cbn07XG52YXIgY29va2llJDEgPSB7XG4gIG5hbWU6IFwnY29va2llXCcsXG4gIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKG9wdGlvbnMpIHtcbiAgICB2YXIgZm91bmQ7XG5cbiAgICBpZiAob3B0aW9ucy5sb29rdXBDb29raWUgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSBcJ3VuZGVmaW5lZFwnKSB7XG4gICAgICB2YXIgYyA9IGNvb2tpZS5yZWFkKG9wdGlvbnMubG9va3VwQ29va2llKTtcbiAgICAgIGlmIChjKSBmb3VuZCA9IGM7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvdW5kO1xuICB9LFxuICBjYWNoZVVzZXJMYW5ndWFnZTogZnVuY3Rpb24gY2FjaGVVc2VyTGFuZ3VhZ2UobG5nLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMubG9va3VwQ29va2llICYmIHR5cGVvZiBkb2N1bWVudCAhPT0gXCd1bmRlZmluZWRcJykge1xuICAgICAgY29va2llLmNyZWF0ZShvcHRpb25zLmxvb2t1cENvb2tpZSwgbG5nLCBvcHRpb25zLmNvb2tpZU1pbnV0ZXMsIG9wdGlvbnMuY29va2llRG9tYWluLCBvcHRpb25zLmNvb2tpZU9wdGlvbnMpO1xuICAgIH1cbiAgfVxufTtcblxudmFyIHF1ZXJ5c3RyaW5nID0ge1xuICBuYW1lOiBcJ3F1ZXJ5c3RyaW5nXCcsXG4gIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKG9wdGlvbnMpIHtcbiAgICB2YXIgZm91bmQ7XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCd1bmRlZmluZWRcJykge1xuICAgICAgdmFyIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7XG4gICAgICB2YXIgcGFyYW1zID0gcXVlcnkuc3BsaXQoXCcmXCcpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcG9zID0gcGFyYW1zW2ldLmluZGV4T2YoXCc9XCcpO1xuXG4gICAgICAgIGlmIChwb3MgPiAwKSB7XG4gICAgICAgICAgdmFyIGtleSA9IHBhcmFtc1tpXS5zdWJzdHJpbmcoMCwgcG9zKTtcblxuICAgICAgICAgIGlmIChrZXkgPT09IG9wdGlvbnMubG9va3VwUXVlcnlzdHJpbmcpIHtcbiAgICAgICAgICAgIGZvdW5kID0gcGFyYW1zW2ldLnN1YnN0cmluZyhwb3MgKyAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cbn07XG5cbnZhciBoYXNMb2NhbFN0b3JhZ2VTdXBwb3J0ID0gbnVsbDtcblxudmFyIGxvY2FsU3RvcmFnZUF2YWlsYWJsZSA9IGZ1bmN0aW9uIGxvY2FsU3RvcmFnZUF2YWlsYWJsZSgpIHtcbiAgaWYgKGhhc0xvY2FsU3RvcmFnZVN1cHBvcnQgIT09IG51bGwpIHJldHVybiBoYXNMb2NhbFN0b3JhZ2VTdXBwb3J0O1xuXG4gIHRyeSB7XG4gICAgaGFzTG9jYWxTdG9yYWdlU3VwcG9ydCA9IHdpbmRvdyAhPT0gXCd1bmRlZmluZWRcJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlICE9PSBudWxsO1xuICAgIHZhciB0ZXN0S2V5ID0gXCdpMThuZXh0LnRyYW5zbGF0ZS5ib29cJztcbiAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGVzdEtleSwgXCdmb29cJyk7XG4gICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRlc3RLZXkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaGFzTG9jYWxTdG9yYWdlU3VwcG9ydCA9IGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGhhc0xvY2FsU3RvcmFnZVN1cHBvcnQ7XG59O1xuXG52YXIgbG9jYWxTdG9yYWdlID0ge1xuICBuYW1lOiBcJ2xvY2FsU3RvcmFnZVwnLFxuICBsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChvcHRpb25zKSB7XG4gICAgdmFyIGZvdW5kO1xuXG4gICAgaWYgKG9wdGlvbnMubG9va3VwTG9jYWxTdG9yYWdlICYmIGxvY2FsU3RvcmFnZUF2YWlsYWJsZSgpKSB7XG4gICAgICB2YXIgbG5nID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG9wdGlvbnMubG9va3VwTG9jYWxTdG9yYWdlKTtcbiAgICAgIGlmIChsbmcpIGZvdW5kID0gbG5nO1xuICAgIH1cblxuICAgIHJldHVybiBmb3VuZDtcbiAgfSxcbiAgY2FjaGVVc2VyTGFuZ3VhZ2U6IGZ1bmN0aW9uIGNhY2hlVXNlckxhbmd1YWdlKGxuZywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zLmxvb2t1cExvY2FsU3RvcmFnZSAmJiBsb2NhbFN0b3JhZ2VBdmFpbGFibGUoKSkge1xuICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKG9wdGlvbnMubG9va3VwTG9jYWxTdG9yYWdlLCBsbmcpO1xuICAgIH1cbiAgfVxufTtcblxudmFyIGhhc1Nlc3Npb25TdG9yYWdlU3VwcG9ydCA9IG51bGw7XG5cbnZhciBzZXNzaW9uU3RvcmFnZUF2YWlsYWJsZSA9IGZ1bmN0aW9uIHNlc3Npb25TdG9yYWdlQXZhaWxhYmxlKCkge1xuICBpZiAoaGFzU2Vzc2lvblN0b3JhZ2VTdXBwb3J0ICE9PSBudWxsKSByZXR1cm4gaGFzU2Vzc2lvblN0b3JhZ2VTdXBwb3J0O1xuXG4gIHRyeSB7XG4gICAgaGFzU2Vzc2lvblN0b3JhZ2VTdXBwb3J0ID0gd2luZG93ICE9PSBcJ3VuZGVmaW5lZFwnICYmIHdpbmRvdy5zZXNzaW9uU3RvcmFnZSAhPT0gbnVsbDtcbiAgICB2YXIgdGVzdEtleSA9IFwnaTE4bmV4dC50cmFuc2xhdGUuYm9vXCc7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0odGVzdEtleSwgXCdmb29cJyk7XG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0odGVzdEtleSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBoYXNTZXNzaW9uU3RvcmFnZVN1cHBvcnQgPSBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiBoYXNTZXNzaW9uU3RvcmFnZVN1cHBvcnQ7XG59O1xuXG52YXIgc2Vzc2lvblN0b3JhZ2UgPSB7XG4gIG5hbWU6IFwnc2Vzc2lvblN0b3JhZ2VcJyxcbiAgbG9va3VwOiBmdW5jdGlvbiBsb29rdXAob3B0aW9ucykge1xuICAgIHZhciBmb3VuZDtcblxuICAgIGlmIChvcHRpb25zLmxvb2t1cFNlc3Npb25TdG9yYWdlICYmIHNlc3Npb25TdG9yYWdlQXZhaWxhYmxlKCkpIHtcbiAgICAgIHZhciBsbmcgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShvcHRpb25zLmxvb2t1cFNlc3Npb25TdG9yYWdlKTtcbiAgICAgIGlmIChsbmcpIGZvdW5kID0gbG5nO1xuICAgIH1cblxuICAgIHJldHVybiBmb3VuZDtcbiAgfSxcbiAgY2FjaGVVc2VyTGFuZ3VhZ2U6IGZ1bmN0aW9uIGNhY2hlVXNlckxhbmd1YWdlKGxuZywgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zLmxvb2t1cFNlc3Npb25TdG9yYWdlICYmIHNlc3Npb25TdG9yYWdlQXZhaWxhYmxlKCkpIHtcbiAgICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5zZXRJdGVtKG9wdGlvbnMubG9va3VwU2Vzc2lvblN0b3JhZ2UsIGxuZyk7XG4gICAgfVxuICB9XG59O1xuXG52YXIgbmF2aWdhdG9yJDEgPSB7XG4gIG5hbWU6IFwnbmF2aWdhdG9yXCcsXG4gIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKG9wdGlvbnMpIHtcbiAgICB2YXIgZm91bmQgPSBbXTtcblxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSBcJ3VuZGVmaW5lZFwnKSB7XG4gICAgICBpZiAobmF2aWdhdG9yLmxhbmd1YWdlcykge1xuICAgICAgICAvLyBjaHJvbWUgb25seTsgbm90IGFuIGFycmF5LCBzbyBjYW5cJ3QgdXNlIC5wdXNoLmFwcGx5IGluc3RlYWQgb2YgaXRlcmF0aW5nXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmF2aWdhdG9yLmxhbmd1YWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGZvdW5kLnB1c2gobmF2aWdhdG9yLmxhbmd1YWdlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG5hdmlnYXRvci51c2VyTGFuZ3VhZ2UpIHtcbiAgICAgICAgZm91bmQucHVzaChuYXZpZ2F0b3IudXNlckxhbmd1YWdlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5hdmlnYXRvci5sYW5ndWFnZSkge1xuICAgICAgICBmb3VuZC5wdXNoKG5hdmlnYXRvci5sYW5ndWFnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvdW5kLmxlbmd0aCA+IDAgPyBmb3VuZCA6IHVuZGVmaW5lZDtcbiAgfVxufTtcblxudmFyIGh0bWxUYWcgPSB7XG4gIG5hbWU6IFwnaHRtbFRhZ1wnLFxuICBsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChvcHRpb25zKSB7XG4gICAgdmFyIGZvdW5kO1xuICAgIHZhciBodG1sVGFnID0gb3B0aW9ucy5odG1sVGFnIHx8ICh0eXBlb2YgZG9jdW1lbnQgIT09IFwndW5kZWZpbmVkXCcgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBudWxsKTtcblxuICAgIGlmIChodG1sVGFnICYmIHR5cGVvZiBodG1sVGFnLmdldEF0dHJpYnV0ZSA9PT0gXCdmdW5jdGlvblwnKSB7XG4gICAgICBmb3VuZCA9IGh0bWxUYWcuZ2V0QXR0cmlidXRlKFwnbGFuZ1wnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cbn07XG5cbnZhciBpMThuZXh0QnJvd3Nlckxhbmd1YWdlRGV0ZWN0b3JfcGF0aCA9IHtcbiAgbmFtZTogXCdwYXRoXCcsXG4gIGxvb2t1cDogZnVuY3Rpb24gbG9va3VwKG9wdGlvbnMpIHtcbiAgICB2YXIgZm91bmQ7XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCd1bmRlZmluZWRcJykge1xuICAgICAgdmFyIGxhbmd1YWdlID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cXC8oW2EtekEtWi1dKikvZyk7XG5cbiAgICAgIGlmIChsYW5ndWFnZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5sb29rdXBGcm9tUGF0aEluZGV4ID09PSBcJ251bWJlclwnKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBsYW5ndWFnZVtvcHRpb25zLmxvb2t1cEZyb21QYXRoSW5kZXhdICE9PSBcJ3N0cmluZ1wnKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZvdW5kID0gbGFuZ3VhZ2Vbb3B0aW9ucy5sb29rdXBGcm9tUGF0aEluZGV4XS5yZXBsYWNlKFwnL1wnLCBcJ1wnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3VuZCA9IGxhbmd1YWdlWzBdLnJlcGxhY2UoXCcvXCcsIFwnXCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvdW5kO1xuICB9XG59O1xuXG52YXIgc3ViZG9tYWluID0ge1xuICBuYW1lOiBcJ3N1YmRvbWFpblwnLFxuICBsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChvcHRpb25zKSB7XG4gICAgdmFyIGZvdW5kO1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwndW5kZWZpbmVkXCcpIHtcbiAgICAgIHZhciBsYW5ndWFnZSA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC8oPzpodHRwW3NdKlxcOlxcL1xcLykqKC4qPylcXC4oPz1bXlxcL10qXFwuLnsyLDV9KS9naSk7XG5cbiAgICAgIGlmIChsYW5ndWFnZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5sb29rdXBGcm9tU3ViZG9tYWluSW5kZXggPT09IFwnbnVtYmVyXCcpIHtcbiAgICAgICAgICBmb3VuZCA9IGxhbmd1YWdlW29wdGlvbnMubG9va3VwRnJvbVN1YmRvbWFpbkluZGV4XS5yZXBsYWNlKFwnaHR0cDovL1wnLCBcJ1wnKS5yZXBsYWNlKFwnaHR0cHM6Ly9cJywgXCdcJykucmVwbGFjZShcJy5cJywgXCdcJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm91bmQgPSBsYW5ndWFnZVswXS5yZXBsYWNlKFwnaHR0cDovL1wnLCBcJ1wnKS5yZXBsYWNlKFwnaHR0cHM6Ly9cJywgXCdcJykucmVwbGFjZShcJy5cJywgXCdcJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGkxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3Rvcl9nZXREZWZhdWx0cygpIHtcbiAgcmV0dXJuIHtcbiAgICBvcmRlcjogW1wncXVlcnlzdHJpbmdcJywgXCdjb29raWVcJywgXCdsb2NhbFN0b3JhZ2VcJywgXCdzZXNzaW9uU3RvcmFnZVwnLCBcJ25hdmlnYXRvclwnLCBcJ2h0bWxUYWdcJ10sXG4gICAgbG9va3VwUXVlcnlzdHJpbmc6IFwnbG5nXCcsXG4gICAgbG9va3VwQ29va2llOiBcJ2kxOG5leHRcJyxcbiAgICBsb29rdXBMb2NhbFN0b3JhZ2U6IFwnaTE4bmV4dExuZ1wnLFxuICAgIGxvb2t1cFNlc3Npb25TdG9yYWdlOiBcJ2kxOG5leHRMbmdcJyxcbiAgICAvLyBjYWNoZSB1c2VyIGxhbmd1YWdlXG4gICAgY2FjaGVzOiBbXCdsb2NhbFN0b3JhZ2VcJ10sXG4gICAgZXhjbHVkZUNhY2hlRm9yOiBbXCdjaW1vZGVcJ10gLy9jb29raWVNaW51dGVzOiAxMCxcbiAgICAvL2Nvb2tpZURvbWFpbjogXCdteURvbWFpblwnXG5cbiAgfTtcbn1cblxudmFyIGkxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3Rvcl9Ccm93c2VyID1cbi8qI19fUFVSRV9fKi9cbmZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQnJvd3NlcihzZXJ2aWNlcykge1xuICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTtcblxuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCcm93c2VyKTtcblxuICAgIHRoaXMudHlwZSA9IFwnbGFuZ3VhZ2VEZXRlY3RvclwnO1xuICAgIHRoaXMuZGV0ZWN0b3JzID0ge307XG4gICAgdGhpcy5pbml0KHNlcnZpY2VzLCBvcHRpb25zKTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhCcm93c2VyLCBbe1xuICAgIGtleTogImluaXQiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KHNlcnZpY2VzKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307XG4gICAgICB2YXIgaTE4bk9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9O1xuICAgICAgdGhpcy5zZXJ2aWNlcyA9IHNlcnZpY2VzO1xuICAgICAgdGhpcy5vcHRpb25zID0gZGVmYXVsdHMob3B0aW9ucywgdGhpcy5vcHRpb25zIHx8IHt9LCBpMThuZXh0QnJvd3Nlckxhbmd1YWdlRGV0ZWN0b3JfZ2V0RGVmYXVsdHMoKSk7IC8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMubG9va3VwRnJvbVVybEluZGV4KSB0aGlzLm9wdGlvbnMubG9va3VwRnJvbVBhdGhJbmRleCA9IHRoaXMub3B0aW9ucy5sb29rdXBGcm9tVXJsSW5kZXg7XG4gICAgICB0aGlzLmkxOG5PcHRpb25zID0gaTE4bk9wdGlvbnM7XG4gICAgICB0aGlzLmFkZERldGVjdG9yKGNvb2tpZSQxKTtcbiAgICAgIHRoaXMuYWRkRGV0ZWN0b3IocXVlcnlzdHJpbmcpO1xuICAgICAgdGhpcy5hZGREZXRlY3Rvcihsb2NhbFN0b3JhZ2UpO1xuICAgICAgdGhpcy5hZGREZXRlY3RvcihzZXNzaW9uU3RvcmFnZSk7XG4gICAgICB0aGlzLmFkZERldGVjdG9yKG5hdmlnYXRvciQxKTtcbiAgICAgIHRoaXMuYWRkRGV0ZWN0b3IoaHRtbFRhZyk7XG4gICAgICB0aGlzLmFkZERldGVjdG9yKGkxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3Rvcl9wYXRoKTtcbiAgICAgIHRoaXMuYWRkRGV0ZWN0b3Ioc3ViZG9tYWluKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJhZGREZXRlY3RvciIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGFkZERldGVjdG9yKGRldGVjdG9yKSB7XG4gICAgICB0aGlzLmRldGVjdG9yc1tkZXRlY3Rvci5uYW1lXSA9IGRldGVjdG9yO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogImRldGVjdCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRldGVjdChkZXRlY3Rpb25PcmRlcikge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgaWYgKCFkZXRlY3Rpb25PcmRlcikgZGV0ZWN0aW9uT3JkZXIgPSB0aGlzLm9wdGlvbnMub3JkZXI7XG4gICAgICB2YXIgZGV0ZWN0ZWQgPSBbXTtcbiAgICAgIGRldGVjdGlvbk9yZGVyLmZvckVhY2goZnVuY3Rpb24gKGRldGVjdG9yTmFtZSkge1xuICAgICAgICBpZiAoX3RoaXMuZGV0ZWN0b3JzW2RldGVjdG9yTmFtZV0pIHtcbiAgICAgICAgICB2YXIgbG9va3VwID0gX3RoaXMuZGV0ZWN0b3JzW2RldGVjdG9yTmFtZV0ubG9va3VwKF90aGlzLm9wdGlvbnMpO1xuXG4gICAgICAgICAgaWYgKGxvb2t1cCAmJiB0eXBlb2YgbG9va3VwID09PSBcJ3N0cmluZ1wnKSBsb29rdXAgPSBbbG9va3VwXTtcbiAgICAgICAgICBpZiAobG9va3VwKSBkZXRlY3RlZCA9IGRldGVjdGVkLmNvbmNhdChsb29rdXApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLnNlcnZpY2VzLmxhbmd1YWdlVXRpbHMuZ2V0QmVzdE1hdGNoRnJvbUNvZGVzKSByZXR1cm4gZGV0ZWN0ZWQ7IC8vIG5ldyBpMThuZXh0IHYxOS41LjBcblxuICAgICAgcmV0dXJuIGRldGVjdGVkLmxlbmd0aCA+IDAgPyBkZXRlY3RlZFswXSA6IG51bGw7IC8vIGEgbGl0dGxlIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICJjYWNoZVVzZXJMYW5ndWFnZSIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGNhY2hlVXNlckxhbmd1YWdlKGxuZywgY2FjaGVzKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgaWYgKCFjYWNoZXMpIGNhY2hlcyA9IHRoaXMub3B0aW9ucy5jYWNoZXM7XG4gICAgICBpZiAoIWNhY2hlcykgcmV0dXJuO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5leGNsdWRlQ2FjaGVGb3IgJiYgdGhpcy5vcHRpb25zLmV4Y2x1ZGVDYWNoZUZvci5pbmRleE9mKGxuZykgPiAtMSkgcmV0dXJuO1xuICAgICAgY2FjaGVzLmZvckVhY2goZnVuY3Rpb24gKGNhY2hlTmFtZSkge1xuICAgICAgICBpZiAoX3RoaXMyLmRldGVjdG9yc1tjYWNoZU5hbWVdKSBfdGhpczIuZGV0ZWN0b3JzW2NhY2hlTmFtZV0uY2FjaGVVc2VyTGFuZ3VhZ2UobG5nLCBfdGhpczIub3B0aW9ucyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gQnJvd3Nlcjtcbn0oKTtcblxuaTE4bmV4dEJyb3dzZXJMYW5ndWFnZURldGVjdG9yX0Jyb3dzZXIudHlwZSA9IFwnbGFuZ3VhZ2VEZXRlY3RvclwnO1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciBpMThuZXh0QnJvd3Nlckxhbmd1YWdlRGV0ZWN0b3IgPSAoaTE4bmV4dEJyb3dzZXJMYW5ndWFnZURldGVjdG9yX0Jyb3dzZXIpO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vc3JjL3dpZGdldC9pMThuL2VuL3RyYW5zbGF0aW9uLmpzb25cbnZhciB0cmFuc2xhdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDApO1xuXG4vLyBFWFRFUk5BTCBNT0RVTEU6IC4vc3JjL3dpZGdldC9pMThuL3J1L3RyYW5zbGF0aW9uLmpzb25cbnZhciBydV90cmFuc2xhdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDEpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvaTE4bi9pbmRleC5qc1xuXG5cblxuXG5cblxuXG4vLyB0aGUgdHJhbnNsYXRpb25zXG5jb25zdCBpMThuX3Jlc291cmNlcyA9IHtcbiAgZW46IHtcbiAgICB0cmFuc2xhdGlvbjogdHJhbnNsYXRpb24sXG4gIH0sXG4gIHJ1OiB7XG4gICAgdHJhbnNsYXRpb246IHJ1X3RyYW5zbGF0aW9uLFxuICB9LFxufTtcblxuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgd2lkZ2V0X2kxOG4gPSAoKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHsgbW9kdWxlLCBsYW5nIH0gPSBzdG9yZS5nZXRTdGF0ZSgpO1xuXG4gIGNvbnN0IHNldExhbmcgPSBlc21faTE4bmV4dC5jaGFuZ2VMYW5ndWFnZS5iaW5kKGVzbV9pMThuZXh0KTtcbiAgY29uc3QgZ2V0TGFuZyA9ICgpID0+IHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1zaGFkb3cgKi9cbiAgICBjb25zdCB7IGxhbmcgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgLyogZXNsaW50LWVuYWJsZSBuby1zaGFkb3cgKi9cbiAgICByZXR1cm4gbGFuZztcbiAgfTtcbiAgaWYgKG1vZHVsZS5zdGFydExhbmdPYnNlcnZlcikge1xuICAgIG1vZHVsZS5zdGFydExhbmdPYnNlcnZlcihnZXRMYW5nLCBzZXRMYW5nKTtcbiAgfVxuXG4gIGNvbnN0IHNldERpciA9IChkaXIpID0+IHtcbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0RGlyKGRpcikpO1xuICB9O1xuICBzZXREaXIobW9kdWxlLmdldERpciA/IG1vZHVsZS5nZXREaXIoKSA6ICJsdHIiKTtcbiAgaWYgKG1vZHVsZS5zdGFydERpck9ic2VydmVyKSB7XG4gICAgbW9kdWxlLnN0YXJ0RGlyT2JzZXJ2ZXIoc2V0RGlyKTtcbiAgfVxuXG4gIGVzbV9pMThuZXh0XG4gICAgLnVzZShpbml0UmVhY3RJMThuZXh0KSAvLyBwYXNzZXMgaTE4biBkb3duIHRvIHJlYWN0LWkxOG5leHRcbiAgICAudXNlKGkxOG5leHRCcm93c2VyTGFuZ3VhZ2VEZXRlY3RvcilcbiAgICAuaW5pdCh7XG4gICAgICByZXNvdXJjZXM6IGkxOG5fcmVzb3VyY2VzLFxuICAgICAgZmFsbGJhY2tMbmc6ICJlbiIsXG4gICAgICBsbmc6IGxhbmcgPT09ICJhdXRvRGV0ZWN0IiA/IG1vZHVsZS5nZXRMYW5nKCkgOiBsYW5nLFxuXG4gICAgICBrZXlTZXBhcmF0b3I6IGZhbHNlLCAvLyB3ZSBkbyBub3QgdXNlIGtleXMgaW4gZm9ybSBtZXNzYWdlcy53ZWxjb21lXG5cbiAgICAgIGludGVycG9sYXRpb246IHtcbiAgICAgICAgZXNjYXBlVmFsdWU6IGZhbHNlLCAvLyByZWFjdCBhbHJlYWR5IHNhZmVzIGZyb20geHNzXG4gICAgICB9LFxuICAgIH0pO1xuXG4gIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRJMThOKGVzbV9pMThuZXh0KSk7XG59KTtcblxuLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd2lkZ2V0L21ha2UtZG93bmxvYWRlci5qc1xuXG5cblxuLy8g0LzRiyDQtNC+0LvQttC90Ysg0YHQstGP0LfQsNGC0Ywg0LzQvtC00YPQu9GMINGB0LrQsNGH0LjQstCw0L3QuNGPINGBINC00LjRgdC/0LXRgtGH0LXRgNC+0Lwg0L/RgNC+0LPRgNC10YHRgdCwXG4vLyDQvNC+0LTRg9C70Ywg0YHQutCw0YfQuNCy0LDQvdC40Y8g0L3QuNGH0LXQs9C+INC90LUg0LTQvtC70LbQtdC9INC30L3QsNGC0Ywg0L7QsSDQutC90L7Qv9C60LUsINC+0L0g0L/QvtC70YPRh9Cw0LXRglxuLy8g0LTQuNGB0L/QtdGC0YfQtdGAINC/0YDQvtCz0YDQtdGB0YHQsCDQsiDQstC40LTQtSDQuNC90YzQtdC60YbQuNC4XG4vLyDQutC90L7Qv9C60LAg0L3QuNGH0LXQs9C+INC90LUg0LfQvdCw0LXRgiDQviDQv9GA0L7Qs9GA0LXRgdGB0LUsINGN0YLQviDQvdC1INGC0L4g0YfRgtC+INGB0LLQvtC50YHRgtCy0LXQvdC90L4g0JLQodCV0Jwg0LLQuNC00LDQvCDQutC90L7Qv9C+0Lpcbi8vINC/0L7RjdGC0L7QvNGDINC+0L3QsCDQv9C+0LvRg9GH0LDQtdGCINC00LjRgdC/0LXRgtGH0LXRgCDQv9GA0L7Qs9GA0LXRgdGB0LAg0LIg0LLQuNC00LUg0LjQvdGM0LXQutGG0LjQuFxuLy8g0LTQuNGB0L/QtdGC0YfQtdGAINC/0YDQvtCz0YDQtdGB0YHQsCDQt9C90LDQtdGCINC60LDQuiDRg9GB0YLQvtC10L0g0LzQvtC00YPQu9GMINGB0LrQsNGH0LjQstCw0L3QuNGPINC4INC60LDQuiDRg9GB0YLRgNC+0LXQvdCwINC60L3QvtC/0LrQsFxuLy8g0YLQviDQtdGB0YLRjCDQvNGLINCyINC90LXQvCDQuNC90LrQsNC/0YHRg9C70LjRgNGD0LXQvCDQvNCw0LrRgdC40LzQsNC70YzQvdC+INGB0L/QtdGG0LjRhNC40YfQvdGL0Lkg0LrQvtC0XG5cbmNvbnN0IG1ha2VEb3dubG9hZGVyID0gZnVuY3Rpb24gKHN0b3JlLCBzYXZlRmlsZSwgZG93bmxvYWRTdHJlYW0pIHtcbiAgY29uc3QgZ2V0U3RyZWFtID0gZnVuY3Rpb24gKGluZm8sIGZsb3csIHByb2dyZXNzQ2IpIHtcbiAgICBjb25zdCByZXMgPSBkb3dubG9hZFN0cmVhbShpbmZvLCAoZSkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlID0ge1xuICAgICAgICBmbG93LFxuICAgICAgICBwcm9ncmVzczogKChlLmxvYWRlZCAvIGUudG90YWwpICogMTAwKS50b0ZpeGVkKDIpLFxuICAgICAgICBsb2FkZWQ6IChlLmxvYWRlZCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpLFxuICAgICAgICB0b3RhbDogKGUudG90YWwgLyAxMDI0IC8gMTAyNCkudG9GaXhlZCgyKSxcbiAgICAgICAgc3BlZWQ6IChlLnNwZWVkIC8gMTAyNCkudG9GaXhlZCgyKSxcbiAgICAgIH07XG4gICAgICBwcm9ncmVzc0NiKHVwZGF0ZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcztcbiAgfTtcblxuICBjb25zdCBkb3dubG9hZFZpZGVvU3RyZWFtID0gYXN5bmMgZnVuY3Rpb24gKHZpZGVvLCB1cGRhdGVyKSB7XG4gICAgY29uc3QgeyBzZW5kRXZlbnQgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgcHJvZ3Jlc3NDYiA9IChlKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGUgPSB7XG4gICAgICAgIGZsb3c6ICJ2aWRlbyIsXG4gICAgICAgIHByb2dyZXNzOiAoKGUubG9hZGVkIC8gZS50b3RhbCkgKiAxMDApLnRvRml4ZWQoMiksXG4gICAgICAgIGxvYWRlZDogKGUubG9hZGVkIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMiksXG4gICAgICAgIHRvdGFsOiAoZS50b3RhbCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpLFxuICAgICAgICBzcGVlZDogKGUuc3BlZWQgLyAxMDI0KS50b0ZpeGVkKDIpLFxuICAgICAgfTtcbiAgICAgIHVwZGF0ZXIodXBkYXRlKTtcbiAgICB9O1xuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRQcm9ncmVzcyh7IHZpZGVvOiAwIH0pKTtcbiAgICBjb25zdCB7IHJlc3VsdCwgY2FuY2VsIH0gPSBhd2FpdCBkb3dubG9hZFN0cmVhbSh2aWRlbywgcHJvZ3Jlc3NDYik7XG4gICAgY29uc3Qgc3RvcERvd25sb2FkaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgY2FuY2VsKCk7XG4gICAgICBzZW5kRXZlbnQoeyBhY3Rpb246ICJkb3dubG9hZF9jYW5jZWxlZCIgfSk7XG4gICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMucmVzZXRQcm9ncmVzcygpKTtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTdGF0dXMoImlkbGUiKSk7XG4gICAgfTtcbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0Q2FuY2VsKHN0b3BEb3dubG9hZGluZykpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3Qgc2xlZXAgPSBtcyA9PiBuZXcgUHJvbWlzZShyZXMgPT4gc2V0VGltZW91dChyZXMsIG1zKSk7XG4gIGNvbnN0IGRvd25sb2FkVmlkZW8gPSBhc3luYyAocHJvZ3Jlc3NDYiwgdmlkZW9PYmosIGF1ZGlvT2JqKSA9PiB7XG4gICAgY29uc3QgeyBzZW5kRXZlbnQgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgeyByZXN1bHQ6IHZQcm9taXNlLCBjYW5jZWw6IGNhbmNlbFZpZGVvIH0gPSBhd2FpdCBnZXRTdHJlYW0odmlkZW9PYmosICJ2aWRlbyIsIHByb2dyZXNzQ2IpO1xuICAgIGNvbnN0IHsgcmVzdWx0OiBhUHJvbWlzZSwgY2FuY2VsOiBjYW5jZWxBdWRpbyB9ID0gYXdhaXQgZ2V0U3RyZWFtKGF1ZGlvT2JqLCAiYXVkaW8iLCBwcm9ncmVzc0NiKTtcbiAgICBsZXQgc3RvcFdvcmtlcjtcbiAgICBjb25zdCBzZXRTdG9wV29ya2VyID0gZnVuY3Rpb24gKGNhbmNlbCkge1xuICAgICAgc3RvcFdvcmtlciA9IGNhbmNlbDtcbiAgICB9O1xuICAgIGNvbnN0IGNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghc3RvcFdvcmtlcikge1xuICAgICAgICBjYW5jZWxWaWRlbygpO1xuICAgICAgICBjYW5jZWxBdWRpbygpO1xuICAgICAgICBzZW5kRXZlbnQoeyBhY3Rpb246ICJkb3dubG9hZF9jYW5jZWxlZCIgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzdG9wV29ya2VyKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYXN5bmMtcHJvbWlzZS1leGVjdXRvciAqL1xuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBQcm9taXNlKGFzeW5jIChyZXMpID0+IHtcbiAgICAgIGNvbnN0IFt2YXJyLCBhYXJyXSA9IGF3YWl0IFByb21pc2UuYWxsKFt2UHJvbWlzZSwgYVByb21pc2VdKTtcbiAgICAgIC8vIFRPRE8gYmVoYXZpb3JcbiAgICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IFByb21pc2UucmFjZShbXG4gICAgICAgIG1lcmdlVmlkZW8odmFyciwgYWFyciwgc2V0U3RvcFdvcmtlciksXG4gICAgICAgIHNsZWVwKDEwMDAgKiA1ICogNjApLnRoZW4oKCkgPT4gbnVsbCksXG4gICAgICBdKTtcbiAgICAgIC8vIFRPRE8gYmVoYXZpb3JcbiAgICAgIC8qXG4gICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICBhbGVydCgiQW4gZXJyb3IgaGFzIG9jY3VycmVkIHdoZW4gbWVyZ2luZyB2aWRlbyIpO1xuICAgICAgfVxuICAgICAgKi9cbiAgICAgIHJlcyhuZXcgQmxvYihbc3RyZWFtXSwgeyB0eXBlOiAiYXBwbGljYXRpb24vb2N0ZXQtYmluYXJ5IiB9KSk7XG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coIkNBTkNFTCEhISIsIGNhbmNlbCk7XG4gICAgcmV0dXJuIHsgY2FuY2VsLCByZXN1bHQgfTtcbiAgfTtcbiAgY29uc3QgZG93bmxvYWRWaWRlb0FuZEF1ZGlvID0gYXN5bmMgZnVuY3Rpb24gKHZpZGVvLCBhdWRpbywgdXBkYXRlcikge1xuICAgIGNvbnNvbGUubG9nKCJET1dOTE9BRCBXSVRIIE1VWElNRyEhISIsIHZpZGVvLCBhdWRpbyk7XG4gICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFByb2dyZXNzKHsgdmlkZW86IDAsIGF1ZGlvOiAwLCBtdXhpbmc6IDAgfSkpO1xuICAgIHN0YXJ0V29ya2VyKHVwZGF0ZXIpO1xuICAgIGNvbnN0IHsgY2FuY2VsLCByZXN1bHQgfSA9IGF3YWl0IGRvd25sb2FkVmlkZW8odXBkYXRlciwgdmlkZW8sIGF1ZGlvKTtcbiAgICBjb25zdCBzdG9wRG93bmxvYWRpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjYW5jZWwoKTtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5yZXNldFByb2dyZXNzKCkpO1xuICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFN0YXR1cygiaWRsZSIpKTtcbiAgICB9O1xuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRDYW5jZWwoc3RvcERvd25sb2FkaW5nKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBjb25zdCBkb3dubG9hZEF1ZGlvID0gYXN5bmMgKHByb2dyZXNzQ2IsIGF1ZGlvT2JqKSA9PiBnZXRTdHJlYW0oYXVkaW9PYmosICJhdWRpbyIsIHByb2dyZXNzQ2IpO1xuICBjb25zdCBkb3dubG9hZEF1ZGlvU3RyZWFtID0gYXN5bmMgZnVuY3Rpb24gKGF1ZGlvLCB1cGRhdGVyKSB7XG4gICAgY29uc3QgeyBzZW5kRXZlbnQgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFByb2dyZXNzKHsgYXVkaW86IDAgfSkpO1xuICAgIGNvbnN0IHsgY2FuY2VsLCByZXN1bHQgfSA9IGF3YWl0IGRvd25sb2FkQXVkaW8odXBkYXRlciwgYXVkaW8pO1xuICAgIGNvbnN0IHN0b3BEb3dubG9hZGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNhbmNlbCgpO1xuICAgICAgc2VuZEV2ZW50KHsgYWN0aW9uOiAiZG93bmxvYWRfY2FuY2VsZWQiIH0pO1xuICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnJlc2V0UHJvZ3Jlc3MoKSk7XG4gICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0U3RhdHVzKCJpZGxlIikpO1xuICAgIH07XG4gICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldENhbmNlbChzdG9wRG93bmxvYWRpbmcpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiAoX2l0ZW0pIHtcbiAgICBjb25zdCB7XG4gICAgICBzdGF0dXMsXG4gICAgICBhdWRpb0luZm8sXG4gICAgICBkZWZhdWx0SXRlbSxcbiAgICAgIHNlbmRFdmVudCxcbiAgICB9ID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAvLyBjb25zdCB7IHZpZGVvLCBhdWRpbyB9ID0gdGFyZ2V0cztcbiAgICAvLyDRjdGC0LAg0YTRg9C90LrRhtC40Y8g0LLRi9C/0L7Qu9C90Y/QtdGC0YHRjyDQutCw0Log0LzQtdGC0L7QtCDRjdC60LfQtdC80L/Qu9GP0YDQsCDQutC70LDRgdGB0LAg0YHQtdGA0LLQuNGB0LAgeXVvdHViZSAvc3JjL3NlcnZpY2VzL3lvdXR1YmVcbiAgICBpZiAoc3RhdHVzID09PSAiZG93bmxvYWRpbmciKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5pbmNyZW1lbnREb3dubG9hZHMoKSk7XG4gICAgY29uc3QgaXRlbSA9IF9pdGVtIHx8IGRlZmF1bHRJdGVtO1xuICAgIGNvbnN0IHsgdGl0bGUgfSA9IGl0ZW07XG4gICAgaWYgKGl0ZW0gIT09IGRlZmF1bHRJdGVtKSB7XG4gICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0RGVmYXVsdEl0ZW0oaXRlbSkpO1xuICAgIH1cbiAgICBpZiAoImRpcmVjdFVybCIgaW4gaXRlbSkge1xuICAgICAgc2F2ZUZpbGUoaXRlbS5kaXJlY3RVcmwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTdGF0dXMoImRvd25sb2FkaW5nIikpO1xuXG4gICAgY29uc3QgdXBkYXRlciA9IChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgaWYgKGRhdGEuZmxvdyA9PT0gIm11eGluZyIpIHtcbiAgICAgICAgaWYgKGRhdGEuZW5kKSB7XG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnJlc2V0UHJvZ3Jlc3MoKSk7XG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFN0YXR1cygiaWRsZSIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0UHJvZ3Jlc3MoeyBtdXhpbmc6IGRhdGEucHJvZ3Jlc3MgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEuZmxvdyA9PT0gImF1ZGlvIikge1xuICAgICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0UHJvZ3Jlc3MoeyBhdWRpbzogZGF0YS5wcm9ncmVzcyB9KSk7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5mbG93ID09PSAidmlkZW8iKSB7XG4gICAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRQcm9ncmVzcyh7IHZpZGVvOiBkYXRhLnByb2dyZXNzIH0pKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IHNhdmUgPSBmdW5jdGlvbiAocmVzdWx0LCBmaWxlTmFtZSkge1xuICAgICAgY29uc3QgZGF0YSA9IHJlc3VsdDtcbiAgICAgIGNvbnN0IGZpbGUgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGRhdGEpO1xuICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnJlc2V0UHJvZ3Jlc3MoKSk7XG4gICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0U3RhdHVzKCJpZGxlIikpO1xuICAgICAgc2F2ZUZpbGUoZmlsZSwgZmlsZU5hbWUpO1xuICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChmaWxlKTtcbiAgICB9O1xuICAgIGNvbnNvbGUubG9nKCJET1dOTE9BRCEhISwgc2VsZWN0ZWQgaXRlbToiLCBpdGVtKTtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jYXNlLWRlY2xhcmF0aW9ucyAqL1xuICAgIHN3aXRjaCAodHJ1ZSkge1xuICAgIGNhc2UgaXRlbS5tdXhhYmxlOlxuICAgICAgLy8gdmlkZW8mYXVkaW9cbiAgICAgIGNvbnN0IGF1ZGlvT2JqID0gYXVkaW9JbmZvXG4gICAgICAgIC5maWx0ZXIocmVjID0+IHJlYy5taW1lVHlwZS5pbmNsdWRlcygiYXVkaW8vbXA0IikpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmJpdHJhdGUgLSBhLmJpdHJhdGUpWzBdLm9iajtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRvd25sb2FkVmlkZW9BbmRBdWRpbyhpdGVtLm9iaiwgYXVkaW9PYmosIHVwZGF0ZXIpO1xuICAgICAgc2F2ZShyZXN1bHQsIGAke3RpdGxlfS5tcDRgKTtcbiAgICAgIHNlbmRFdmVudCh7IGFjdGlvbjogImRvd25sb2FkX3N1Y2Nlc3MiLCBmb3JtYXQ6IGl0ZW0ucXVhbGl0eUxhYmVsIH0pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSBpdGVtLm1pbWVUeXBlLmluY2x1ZGVzKCJhdWRpbyIpOlxuICAgICAgLy8gYXVkaW9TdHJlYW1cbiAgICAgIGNvbnN0IGF1ZGlvRmlsZSA9IGF3YWl0IGRvd25sb2FkQXVkaW9TdHJlYW0oaXRlbS5vYmosIHVwZGF0ZXIpO1xuICAgICAgc2F2ZShhdWRpb0ZpbGUsIGAke3RpdGxlfS5tNGFgKTtcbiAgICAgIHNlbmRFdmVudCh7IGFjdGlvbjogImRvd25sb2FkX3N1Y2Nlc3MiLCBmb3JtYXQ6IGAke2l0ZW0uYXVkaW9RdWFsaXR5fWAgfSk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgLy8gdmlkZW9TdHJlYW1cbiAgICAgIGNvbnN0IHZpZGVvRmlsZSA9IGF3YWl0IGRvd25sb2FkVmlkZW9TdHJlYW0oaXRlbSwgdXBkYXRlcik7XG4gICAgICBzYXZlKHZpZGVvRmlsZSwgYCR7dGl0bGV9Lm1wNGApO1xuICAgICAgc2VuZEV2ZW50KHsgYWN0aW9uOiAiZG93bmxvYWRfc3VjY2VzcyIsIGZvcm1hdDogaXRlbS5xdWFsaXR5TGFiZWwgfSk7XG4gICAgfVxuICAgIC8qIGVzbGludC1lbmFibGUgbm8tY2FzZS1kZWNsYXJhdGlvbnMgKi9cbiAgfTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIG1ha2VfZG93bmxvYWRlciA9IChtYWtlRG93bmxvYWRlcik7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC90aGVtZXMvaW5kZXguanNcbi8vIGNvbnN0IGxpZ2h0ID0gcmVxdWlyZSgiLi9kZWJ1Zy5qc29uIik7XG5jb25zdCBsaWdodCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vbGlnaHQuanNvbiAqLyA4Nik7XG5cbmNvbnN0IGRhcmsgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2RhcmsuanNvbiAqLyA4Nyk7XG5cbmNvbnN0IHRoZW1lcyA9IHtcbiAgZGVmYXVsdDogbGlnaHQsXG4gIGRhcmssXG59O1xuLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLyB2YXIgd2lkZ2V0X3RoZW1lcyA9ICh0aGVtZXMpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvcmVuZGVyLXdpZGdldC5qc3hcblxuXG5cblxuIC8vIGltcG9ydCAqIGFzIG9rIGZyb20gInNlcnZpY2VzL29rIjtcblxuXG5cblxuLyogZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby11c2VsZXNzLXBhdGgtc2VnbWVudHMgKi9cblxuXG5cblxubGV0IHN0YXJ0ZWQgPSBmYWxzZTtcblxuY29uc3QgZ2V0UmVuZGVyV2lkZ2V0ID0gZnVuY3Rpb24gKHN0b3JlKSB7XG4gIGNvbnN0IHtcbiAgICBzZW5kRXZlbnRcbiAgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gIGNvbnN0IG1vZHVsZXMgPSB7XG4gICAgeW91dHViZToge1xuICAgICAgZG93bmxvYWQ6IG1ha2VfZG93bmxvYWRlcihzdG9yZSwgc2F2ZV9maWxlLCBkb3dubG9hZF9zdHJlYW0pLFxuICAgICAgLi4ueW91dHViZV9uYW1lc3BhY2VPYmplY3RcbiAgICB9LFxuICAgIHlvdXR1YmVFbWJlZDoge1xuICAgICAgZG93bmxvYWQ6IG1ha2VfZG93bmxvYWRlcihzdG9yZSwgc2F2ZV9maWxlLCBkb3dubG9hZF9zdHJlYW0pLFxuICAgICAgLi4uZW1iZWRfbmFtZXNwYWNlT2JqZWN0XG4gICAgfVxuICAgIC8qXG4gICAgb2s6IHtcbiAgICAgIGRvd25sb2FkZXI6IG1ha2VEb3dubG9hZGVyKHN0b3JlLCBzYXZlRmlsZSwgb2suZG93bmxvYWRTdHJlYW0pLFxuICAgICAgLi4ub2ssXG4gICAgfSxcbiAgICAqL1xuXG4gIH07XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiAoc2VydmljZSwgV2lkZ2V0KSB7XG4gICAgaWYgKHN0YXJ0ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdGFydGVkID0gdHJ1ZTtcbiAgICBjb25zdCBtb2R1bGUgPSBtb2R1bGVzW3NlcnZpY2VdO1xuXG4gICAgY29uc3QgdXBkYXRlQ29udGVudExpbWl0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29udGVudExpbWl0ID0gYXdhaXQgZ2V0X2NvbnRlbnRfbGltaXQoKTtcbiAgICAgIGNvbnNvbGUubG9nKGBDb250ZW50IGxpbWl0OiAke2NvbnRlbnRMaW1pdH1gKTtcbiAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRDb250ZW50TGltaXQoY29udGVudExpbWl0KSk7XG4gICAgICBzZXRUaW1lb3V0KHVwZGF0ZUNvbnRlbnRMaW1pdCwgMTAwMDApO1xuICAgIH07XG5cbiAgICB1cGRhdGVDb250ZW50TGltaXQoKTtcbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0U2VydmljZShzZXJ2aWNlKSk7XG4gICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldE1vZHVsZShtb2R1bGUpKTtcbiAgICB3aWRnZXRfaTE4bihzdG9yZSk7XG5cbiAgICBjb25zdCBzZXRUaGVtZSA9IHRoZW1lID0+IHtcbiAgICAgIGNvbnN0IHNldHRpbmdzVGhlbWUgPSBzdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgICBpZiAoIXNldHRpbmdzVGhlbWUgfHwgc2V0dGluZ3NUaGVtZS5uYW1lICE9PSB0aGVtZSkge1xuICAgICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0VGhlbWUoe1xuICAgICAgICAgIG5hbWU6IHRoZW1lLFxuICAgICAgICAgIC4uLndpZGdldF90aGVtZXNbdGhlbWVdXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgc2V0VGhlbWUobW9kdWxlLmdldFRoZW1lID8gbW9kdWxlLmdldFRoZW1lKCkgOiAiZGVmYXVsdCIpO1xuXG4gICAgaWYgKG1vZHVsZS5zdGFydFRoZW1lT2JzZXJ2ZXIpIHtcbiAgICAgIG1vZHVsZS5zdGFydFRoZW1lT2JzZXJ2ZXIoc2V0VGhlbWUpO1xuICAgIH1cblxuICAgIE9iamVjdChyZWFjdF9kb21bInJlbmRlciJdKSggLyojX19QVVJFX18qL3JlYWN0X2RlZmF1bHQuYS5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfUHJvdmlkZXIsIHtcbiAgICAgIHN0b3JlOiBzdG9yZVxuICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdF9kZWZhdWx0LmEuY3JlYXRlRWxlbWVudChXaWRnZXQsIG51bGwpKSwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVuaWRvd25sb2FkZXIiKSk7XG4gICAgc2VuZEV2ZW50KHtcbiAgICAgIGFjdGlvbjogImluc2VydFdpZGdldCJcbiAgICB9KTtcbiAgfTtcbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIHJlbmRlcl93aWRnZXQgPSAoZ2V0UmVuZGVyV2lkZ2V0KTtcbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dpZGdldC91cGRhdGVWaWRlb0luZm8uanNcblxuXG5jb25zdCBnZXREZWZhdWx0VmlkZW8gPSBmdW5jdGlvbiAoc3RyZWFtcywgdmlkZW8pIHtcbiAgaWYgKHN0cmVhbXMpIHtcbiAgICBjb25zdCBzdHJlYW1zTWF4ID0gTWF0aC5tYXgoLi4uc3RyZWFtcy5tYXAoc3RyZWFtID0+IHN0cmVhbS5xdWFsaXR5TnVtKSk7XG4gICAgaWYgKHN0cmVhbXNNYXgpIHtcbiAgICAgIHJldHVybiBzdHJlYW1zLmZpbmQoc3RyZWFtID0+IHN0cmVhbS5xdWFsaXR5TnVtID09PSBzdHJlYW1zTWF4KTtcbiAgICB9XG4gIH1cbiAgaWYgKHZpZGVvKSB7XG4gICAgY29uc3QgdmlkZW9NYXggPSBNYXRoLm1heCguLi52aWRlby5tYXAoc3RyZWFtID0+IHN0cmVhbS5xdWFsaXR5TnVtKSk7XG4gICAgaWYgKHZpZGVvTWF4KSB7XG4gICAgICByZXR1cm4gdmlkZW8uZmluZChzdHJlYW0gPT4gc3RyZWFtLnF1YWxpdHlOdW0gPT09IHZpZGVvTWF4KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB3aWRnZXRfdXBkYXRlVmlkZW9JbmZvID0gKGZ1bmN0aW9uIChzdG9yZSkge1xuICBjb25zdCB1cGRhdGVWaWRlb0luZm8gPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuZXhhY3RNYXRjaCkge1xuICAgICAgaWYgKCF0aGlzLmV4YWN0TWF0Y2goKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHsgbW9kdWxlLCBzZW5kRXZlbnQgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgeyBnZXRWaWRlb0luZm8gfSA9IG1vZHVsZTtcblxuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTdGF0dXMoImdldHRpbmdJbmZvIikpO1xuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRWaWRlb0luZm8obnVsbCkpO1xuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRBdWRpb0luZm8obnVsbCkpO1xuICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTdHJlYW1JbmZvKG51bGwpKTtcbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0RGVmYXVsdEl0ZW0obnVsbCkpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCB7IHN0YXR1cyB9ID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAgIGlmIChzdGF0dXMgPT09ICJnZXR0aW5nSW5mbyIpIHtcbiAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFN0YXR1cygiaWRsZSIpKTtcbiAgICAgIH1cbiAgICB9LCAxNzAwMCk7XG4gICAgbGV0IGNvdW50ID0gMztcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1hd2FpdC1pbi1sb29wICovXG4gICAgd2hpbGUgKGNvdW50LS0gIT09IDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHZpZGVvSW5mbyA9IGF3YWl0IGdldFZpZGVvSW5mbyh3aW5kb3cubG9jYXRpb24uaHJlZik7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICBpc0xpdmVTdHJlYW0sXG4gICAgICAgICAgZXhwaXJlcyxcbiAgICAgICAgICB2aWRlbyxcbiAgICAgICAgICBhdWRpbyxcbiAgICAgICAgICBzdHJlYW1zLFxuICAgICAgICB9ID0gdmlkZW9JbmZvO1xuICAgICAgICBjb25zb2xlLmxvZygiVklERU8gSU5GTyBSRVNFSVZFRCIsIHZpZGVvSW5mbyk7XG4gICAgICAgIGlmIChpc0xpdmVTdHJlYW0pIHtcbiAgICAgICAgICBpZiAoaXNMaXZlU3RyZWFtID09PSAidHJ1ZSIgfHxcbiAgICAgICAgICAgICh0eXBlb2YgaXNMaXZlU3RyZWFtID09PSAib2JqZWN0IiAmJlxuICAgICAgICAgICAgIGlzTGl2ZVN0cmVhbS5saXZlU3RyZWFtYWJpbGl0eVJlbmRlcmVyICYmXG4gICAgICAgICAgICAgKCEoImRpc3BsYXlFbmRzY3JlZW4iIGluIGlzTGl2ZVN0cmVhbS5saXZlU3RyZWFtYWJpbGl0eVJlbmRlcmVyKSB8fCBpc0xpdmVTdHJlYW0ubGl2ZVN0cmVhbWFiaWxpdHlSZW5kZXJlci5kaXNwbGF5RW5kc2NyZWVuID09PSBmYWxzZSkpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBzZW5kRXZlbnQoeyBhY3Rpb246ICJsaXZlU3RyZWFtIiB9KTtcbiAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRTdGF0dXMoImxpdmVTdHJlYW0iKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCJWSURFT0lORk8hISEhIiwgZXhwaXJlcyk7XG4gICAgICAgIGlmIChleHBpcmVzICYmIE51bWJlci5pc0ludGVnZXIoZXhwaXJlcykpIHtcbiAgICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcbiAgICAgICAgICBpZiAoZXhwaXJlcyA+IHRpbWVzdGFtcCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYHZpZGVvIGluZm8gd2lsbCBiZSB1cGRhdGVkIGFmdGVyICR7KChleHBpcmVzIC0gdGltZXN0YW1wKSAvIDYwKS50b0ZpeGVkKDEpfSBtaW51dGVzYCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHVwZGF0ZVZpZGVvSW5mbyh3aW5kb3cubG9jYXRpb24uaHJlZiksIChleHBpcmVzIC0gdGltZXN0YW1wKSAqIDEwMDApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJhZCB0aW1pbmciKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVmYXVsdFZpZGVvID0gZ2V0RGVmYXVsdFZpZGVvKHN0cmVhbXMsIHZpZGVvKTtcbiAgICAgICAgaWYgKGRlZmF1bHRWaWRlbykge1xuICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRWaWRlb0luZm8odmlkZW8pKTtcbiAgICAgICAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0U3RyZWFtSW5mbyhzdHJlYW1zKSk7XG4gICAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldERlZmF1bHRJdGVtKGRlZmF1bHRWaWRlbykpO1xuICAgICAgICB9XG4gICAgICAgIHN0b3JlLmRpc3BhdGNoKGFjdGlvbnNfYWN0aW9ucy5zZXRBdWRpb0luZm8oYXVkaW8pKTtcbiAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aW9uc19hY3Rpb25zLnNldFN0YXR1cygiaWRsZSIpKTtcblxuICAgICAgICBzZW5kRXZlbnQoeyBhY3Rpb246ICJ1cGRhdGVJbmZvX3N1Y2Nlc3MiIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIG5vdGhpbmdcbiAgICAgIH1cbiAgICB9XG4gICAgc2VuZEV2ZW50KHsgYWN0aW9uOiAidXBkYXRlSW5mb19mYWlsdXJlIiB9KTtcbiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWF3YWl0LWluLWxvb3AgKi9cbiAgICBzdG9yZS5kaXNwYXRjaChhY3Rpb25zX2FjdGlvbnMuc2V0U3RhdHVzKCJ1bmF2YWlsYWJsZSIpKTtcbiAgfTtcbiAgcmV0dXJuIHVwZGF0ZVZpZGVvSW5mbztcbn0pO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93aWRnZXQvaW5kZXguanNcblxuXG5cblxuXG5cbmNvbnN0IHJlbmRlcldpZGdldCA9IHJlbmRlcl93aWRnZXQod2lkZ2V0X3N0b3JlKTtcbmNvbnN0IHNyY193aWRnZXRfdXBkYXRlVmlkZW9JbmZvID0gd2lkZ2V0X3VwZGF0ZVZpZGVvSW5mbyh3aWRnZXRfc3RvcmUpO1xuXG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dlYmV4dC9jb250ZW50LXNjcmlwdC5qc1xuXG5cblxuXG5cblxuLy8gaW1wb3J0IHsgT0sgfSBmcm9tICJzZXJ2aWNlcy9vayI7XG5cblxuXG5jb25zdCBzZXRVZGxIZWxwZXJJbmZvID0gKCkgPT4ge1xuICBjb25zdCB7IGhvc3RuYW1lIH0gPSB3aW5kb3cubG9jYXRpb247XG4gIGlmICgoaG9zdG5hbWUuc3RhcnRzV2l0aCgidW5pZG93bmxvYWRlci5jb20iKSAmJiBob3N0bmFtZS5lbmRzV2l0aCgiLnN0YWNrZGVwbG95LnJ1IikpIHx8XG4gICAgaG9zdG5hbWUgPT09ICJ1bmlkb3dubG9hZGVyLmNvbSIgfHxcbiAgICBob3N0bmFtZSA9PT0gImdldHVkbC5ydSIgfHxcbiAgICBob3N0bmFtZSA9PT0gImdldHVuaWRvd25sb2FkZXIucnUiXG4gICkge1xuICAgIGNvbnN0IHsgaGFzaCwgdHlwZSwgdmVyc2lvbiB9ID0gY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXTtcbiAgICBjb25zdCB1ZGxIZWxwZXJJbmZvID0geyBoYXNoLCB0eXBlLCB2ZXJzaW9uIH07XG4gICAgdW5zYWZlX3dpbmRvdy5zZXQoInVkbF9oZWxwZXJfaW5mbyIsIHVkbEhlbHBlckluZm8pO1xuXG4gICAgY29uc29sZS5sb2coIndpbmRvdy51ZGxfaGVscGVyX2luZm86IiwgdWRsSGVscGVySW5mbyk7XG4gIH1cbn07XG5cbmNvbnN0IGNvbnRlbnRTY3JpcHQgPSAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKCJ1ZGw6IGNvbnRlbnRTY3JpcHQiKTtcbiAgY29uc3QgYXBwSG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7XG4gIGNvbnN0IGhhbmRsZXJzID0gW1xuICAgIC8vIG5ldyBPSyhhcHBIb2xkZXIsIHsgb25Mb2NhdGlvbkNoYW5nZWQ6IHVwZGF0ZVZpZGVvSW5mbywgb25JbnNlcnQ6IHJlbmRlcldpZGdldC5iaW5kKG51bGwsICJvayIsIFdpZGdldCkgfSksXG4gICAgbmV3IHlvdXR1YmVfWW91dHViZShhcHBIb2xkZXIsIHsgb25Mb2NhdGlvbkNoYW5nZWQ6IHNyY193aWRnZXRfdXBkYXRlVmlkZW9JbmZvLCBvbkluc2VydDogcmVuZGVyV2lkZ2V0LmJpbmQobnVsbCwgInlvdXR1YmUiLCB3aWRnZXRfd2lkZ2V0KSB9KSxcbiAgICBuZXcgZW1iZWRfWW91dHViZUVtYmVkKGFwcEhvbGRlciwgeyBvbkxvY2F0aW9uQ2hhbmdlZDogc3JjX3dpZGdldF91cGRhdGVWaWRlb0luZm8sIG9uSW5zZXJ0OiByZW5kZXJXaWRnZXQuYmluZChudWxsLCAieW91dHViZUVtYmVkIiwgd2lkZ2V0X2VtYmVkKSB9KSxcbiAgXTtcbiAgZnVuY3Rpb24gZ2V0RG93bmxvYWRCdXR0b24oKSB7XG4gICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICBhcHBIb2xkZXIuaWQgPSAidW5pZG93bmxvYWRlciI7XG4gICAgICByZXR1cm4gdGhpcy53aWRnZXQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoYW5kbGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGhhbmRsZXIgPSBoYW5kbGVyc1tpXTtcbiAgICBpZiAoaGFuZGxlci5jaGVja1NlcnZpY2Uod2luZG93LmxvY2F0aW9uKSkge1xuICAgICAgaGFuZGxlci5zdGFydCh1dGlsc19jdHhbImEiIC8qIGRlZmF1bHQgKi9dLCBnZXREb3dubG9hZEJ1dHRvbik7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbn07XG5cbi8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gdmFyIGNvbnRlbnRfc2NyaXB0ID0gKGNvbnRlbnRTY3JpcHQpO1xuXG4vLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93ZWJleHQvYWRzLmpzXG5cblxuXG5cbmNvbnN0IGFkc19zZW5kRXZlbnQgPSBhbmFseXRpY3MoY29uZmlnWyJhIiAvKiBkZWZhdWx0ICovXS5hbmFseXRpY3NVcmwsIHsgZ2V0U3RhdGU6ICgpID0+ICh7IHNlcnZpY2VOYW1lOiAidW5rbm93biIsIGRlZmF1bHRWaWRlbzogInVua25vd24iIH0pIH0pO1xuXG5jb25zdCBzZW5kRGFpbHkgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxhc3RMb2FkZWQgPSBhd2FpdCBnbG9iYWxfc3RvcmFnZV90bS5nZXQoInlhbmRleE1hcmtldEFkdmlzZXJMYXN0TG9hZGVkIik7XG4gIGlmICghbGFzdExvYWRlZCB8fCAoRGF0ZS5ub3coKSAtIGxhc3RMb2FkZWQgPiAyNCAqIDYwICogNjAgKiAxMDAwKSkge1xuICAgIGdsb2JhbF9zdG9yYWdlX3RtLnNldCgieWFuZGV4TWFya2V0QWR2aXNlckxhc3RMb2FkZWQiLCBEYXRlLm5vdygpKTtcbiAgICBhZHNfc2VuZEV2ZW50KHsgYWN0aW9uOiAieWFuZGV4TWFya2V0QWR2aXNlckRhaWx5IiB9KTtcbiAgfVxufTtcblxuZnVuY3Rpb24geWFuZGV4TWFya2V0QWR2aXNlckxvYWQoKSB7XG4gIC8vIGNvbnNvbGUubG9nKCJ1ZGw6IHlhbmRleE1hcmtldEFkdmlzZXJMb2FkIik7XG5cbiAgY29uc3QgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm9wZW4oIkdFVCIsICJodHRwczovL3lhc3RhdGljLm5ldC9zb3ZldG5pay9fL2pzL3NvdmV0bmlrLm1pbi5qcyIsIHRydWUpO1xuICByZXF1ZXN0LnNlbmQobnVsbCk7XG4gIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChyZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQgJiYgcmVxdWVzdC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgY29uc3QgdHlwZSA9IHJlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpO1xuICAgICAgaWYgKHR5cGUuaW5kZXhPZigidGV4dCIpICE9PSAxKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCJ1ZGw6IFlhbmRleC5NYXJrZXQgQWR2aXNlciBsb2FkZWQiKTtcblxuICAgICAgICAoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgY29uc3Qgc2NyaXB0ID0gZC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtcbiAgICAgICAgICBzY3JpcHQuaW5uZXJIVE1MID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gICAgICAgIH0pKGRvY3VtZW50KSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiB5YW5kZXhNYXJrZXRBZHZpc2VyQ2hlY2soKSB7XG4gIGNvbnN0IGxvYWRZYW5kZXhNYXJrZXRBZHZpc2VyID0gYXdhaXQgZ2xvYmFsX3N0b3JhZ2VfdG0uZ2V0KCJsb2FkWWFuZGV4TWFya2V0QWR2aXNlciIpO1xuICBpZiAobG9hZFlhbmRleE1hcmtldEFkdmlzZXIgIT09IGZhbHNlKSB7XG4gICAgLy8gY29uc29sZS5sb2coInVkbDogbG9hZFlhbmRleE1hcmtldEFkdmlzZXIgPSIsIGxvYWRZYW5kZXhNYXJrZXRBZHZpc2VyKTtcblxuICAgIHNlbmREYWlseSgpO1xuICAgIHlhbmRleE1hcmtldEFkdmlzZXJMb2FkKCk7XG4gIH1cbn1cblxuY29uc3QgYWRzID0gKCkgPT4ge1xuICAvLyBjb25zb2xlLmxvZygidWRsOiBhZHMiKTtcblxuICAoKGZ1bmN0aW9uIChkKSB7XG4gICAgY29uc3Qgc2NyaXB0ID0gZC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtcbiAgICBzY3JpcHQuc3JjID0gImh0dHBzOi8vYXdheWJpcmQucnUvcHJjci9sZHJfNzY4XzI4Nzk4X1VlNjR6VS5qcyI7XG4gICAgZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gIH0pKGRvY3VtZW50KSk7XG5cbiAgeWFuZGV4TWFya2V0QWR2aXNlckNoZWNrKCk7XG59O1xuXG4vKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovIHZhciB3ZWJleHRfYWRzID0gKGFkcyk7XG5cbi8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dlYmV4dC9jb250ZW50LXNjcmlwdC11c2Vyc2NyaXB0LmpzXG5cblxuXG5cbmNvbnNvbGUubG9nKCJ1ZGw6IGNvbnRlbnQtc2NyaXB0LXVzZXJzY3JpcHQiKTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgImV2ZW50IiwgeyB3cml0YWJsZTogdHJ1ZSB9KTtcblxuaWYgKCFpbl9pZnJhbWUoKSkge1xuICBzZXRVZGxIZWxwZXJJbmZvKCk7XG59XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgKCkgPT4ge1xuICBjb250ZW50X3NjcmlwdCgpO1xuICBpZiAoIWluX2lmcmFtZSgpKSB7XG4gICAgd2ViZXh0X2FkcygpO1xuICB9XG59LCBmYWxzZSk7XG5cblxuLy8jIHNvdXJjZVVSTD13ZWJwYWNrOi8vLy4vc3JjL3dlYmV4dC9jb250ZW50LXNjcmlwdC11c2Vyc2NyaXB0LmpzXytfMTgyX21vZHVsZXM/Jyl9XSk7`